<!doctype html><html class="theme-next mist use-motion" lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css"><meta name="keywords" content="python,pandas,"><link rel="alternate" href="/atom.xml" title="Abracdabra" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0"><meta name="description" content="时间序列123456789from __future__ import divisionfrom pandas import Series, DataFrameimport pandas as pdfrom numpy.random import randnimport numpy as nppd.options.display.max_rows = 12np.set_printoptions(p"><meta property="og:type" content="article"><meta property="og:title" content="python data analysis learning note Ch10"><meta property="og:url" content="http://yoursite.com/2017/03/08/python-data-analysis-learning-note-Ch10/index.html"><meta property="og:site_name" content="Abracdabra"><meta property="og:description" content="时间序列123456789from __future__ import divisionfrom pandas import Series, DataFrameimport pandas as pdfrom numpy.random import randnimport numpy as nppd.options.display.max_rows = 12np.set_printoptions(p"><meta property="og:image" content="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_270_1.png"><meta property="og:image" content="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_272_1.png"><meta property="og:image" content="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_274_1.png"><meta property="og:image" content="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_276_2.png"><meta property="og:image" content="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_279_3.png"><meta property="og:image" content="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_282_1.png"><meta property="og:image" content="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_284_2.png"><meta property="og:image" content="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_288_7.png"><meta property="og:image" content="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_291_2.png"><meta property="og:image" content="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_292_2.png"><meta property="og:image" content="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_294_2.png"><meta property="og:updated_time" content="2017-03-08T09:24:48.113Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="python data analysis learning note Ch10"><meta name="twitter:description" content="时间序列123456789from __future__ import divisionfrom pandas import Series, DataFrameimport pandas as pdfrom numpy.random import randnimport numpy as nppd.options.display.max_rows = 12np.set_printoptions(p"><meta name="twitter:image" content="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_270_1.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://yoursite.com/2017/03/08/python-data-analysis-learning-note-Ch10/"><title>python data analysis learning note Ch10 | Abracdabra</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?dc405a79ad500922134d14cdf288f646";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Abracdabra</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Do it yourself</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>Categories</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>About</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>Tags</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>Sitemap</a></li><li class="menu-item menu-item-commonweal"><a href="/404.html" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div><span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/08/python-data-analysis-learning-note-Ch10/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracdabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracdabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline">python data analysis learning note Ch10</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-08T17:16:30+08:00">2017-03-08 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/03/08/python-data-analysis-learning-note-Ch10/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2017/03/08/python-data-analysis-learning-note-Ch10/" itemprop="commentsCount"></span> </a></span><span id="/2017/03/08/python-data-analysis-learning-note-Ch10/" class="leancloud_visitors" data-flag-title="python data analysis learning note Ch10"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="时间序列"><a href="#时间序列" class="headerlink" title="时间序列"></a>时间序列</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line">pd.options.display.max_rows = <span class="number">12</span></div><div class="line">np.set_printoptions(precision=<span class="number">4</span>, suppress=<span class="keyword">True</span>)</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">plt.rc(<span class="string">'figure'</span>, figsize=(<span class="number">12</span>, <span class="number">4</span>))</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</div><div class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">%matplotlib inline</div></pre></td></tr></table></figure><h2 id="日期和时间数据类型及工具"><a href="#日期和时间数据类型及工具" class="headerlink" title="日期和时间数据类型及工具"></a>日期和时间数据类型及工具</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line">now = datetime.now()</div><div class="line">now</div></pre></td></tr></table></figure><pre><code>datetime.datetime(2017, 3, 8, 14, 47, 50, 32019)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">now.year, now.month, now.day</div></pre></td></tr></table></figure><pre><code>(2017, 3, 8)
</code></pre><p>返回值（天数，秒数）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">delta = datetime(<span class="number">2011</span>, <span class="number">1</span>, <span class="number">7</span>) - datetime(<span class="number">2008</span>, <span class="number">6</span>, <span class="number">24</span>, <span class="number">8</span>, <span class="number">15</span>)</div><div class="line">delta</div></pre></td></tr></table></figure><pre><code>datetime.timedelta(926, 56700)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">delta.days</div></pre></td></tr></table></figure><pre><code>926
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">delta.seconds</div></pre></td></tr></table></figure><pre><code>56700
</code></pre><p><code>timedelta</code> 天数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</div><div class="line">start = datetime(<span class="number">2011</span>, <span class="number">1</span>, <span class="number">7</span>)</div><div class="line">start + timedelta(<span class="number">12</span>)</div></pre></td></tr></table></figure><pre><code>datetime.datetime(2011, 1, 19, 0, 0)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">start - <span class="number">2</span> * timedelta(<span class="number">12</span>)</div></pre></td></tr></table></figure><pre><code>datetime.datetime(2010, 12, 14, 0, 0)
</code></pre><h3 id="字符串和datatime的相互转换"><a href="#字符串和datatime的相互转换" class="headerlink" title="字符串和datatime的相互转换"></a>字符串和<code>datatime</code>的相互转换</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">stamp = datetime(<span class="number">2011</span>, <span class="number">1</span>, <span class="number">3</span>)</div></pre></td></tr></table></figure><p>使用<code>str</code>直接转换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">str(stamp)</div></pre></td></tr></table></figure><pre><code>&apos;2011-01-03 00:00:00&apos;
</code></pre><p>格式化转换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">stamp.strftime(<span class="string">'%Y-%m-%d'</span>)</div></pre></td></tr></table></figure><pre><code>&apos;2011-01-03&apos;
</code></pre><p>逆转换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">value = <span class="string">'2011-01-03'</span></div><div class="line">datetime.strptime(value, <span class="string">'%Y-%m-%d'</span>)</div></pre></td></tr></table></figure><pre><code>datetime.datetime(2011, 1, 3, 0, 0)
</code></pre><p>批量转换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">datestrs = [<span class="string">'7/6/2011'</span>, <span class="string">'8/6/2011'</span>]</div><div class="line">[datetime.strptime(x, <span class="string">'%m/%d/%Y'</span>) <span class="keyword">for</span> x <span class="keyword">in</span> datestrs]</div></pre></td></tr></table></figure><pre><code>[datetime.datetime(2011, 7, 6, 0, 0), datetime.datetime(2011, 8, 6, 0, 0)]
</code></pre><p>总是写格式很麻烦，直接调用<code>parser</code>解析</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> dateutil.parser <span class="keyword">import</span> parse</div><div class="line">parse(<span class="string">'2011-01-03'</span>)</div></pre></td></tr></table></figure><pre><code>datetime.datetime(2011, 1, 3, 0, 0)
</code></pre><p>可以解析任意格式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">parse(<span class="string">'Jan 31, 1997 10:45 PM'</span>)</div></pre></td></tr></table></figure><pre><code>datetime.datetime(1997, 1, 31, 22, 45)
</code></pre><p>指定格式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">parse(<span class="string">'6/12/2011'</span>, dayfirst=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><pre><code>datetime.datetime(2011, 12, 6, 0, 0)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">datestrs</div></pre></td></tr></table></figure><pre><code>[&apos;7/6/2011&apos;, &apos;8/6/2011&apos;]
</code></pre><p><code>pandas</code>的<code>API</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pd.to_datetime(datestrs)</div><div class="line"><span class="comment"># note: output changed (no '00:00:00' anymore)</span></div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&apos;2011-07-06&apos;, &apos;2011-08-06&apos;], dtype=&apos;datetime64[ns]&apos;, freq=None)
</code></pre><p><code>None</code>也可以转换，只不过会变成缺失值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">idx = pd.to_datetime(datestrs + [<span class="keyword">None</span>])</div><div class="line">idx</div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&apos;2011-07-06&apos;, &apos;2011-08-06&apos;, &apos;NaT&apos;], dtype=&apos;datetime64[ns]&apos;, freq=None)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">idx[<span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>NaT
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.isnull(idx)</div></pre></td></tr></table></figure><pre><code>array([False, False,  True], dtype=bool)
</code></pre><h2 id="时间序列基础"><a href="#时间序列基础" class="headerlink" title="时间序列基础"></a>时间序列基础</h2><p>将行索引变成时间类型，也就是时间戳</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line">dates = [datetime(<span class="number">2011</span>, <span class="number">1</span>, <span class="number">2</span>), datetime(<span class="number">2011</span>, <span class="number">1</span>, <span class="number">5</span>), datetime(<span class="number">2011</span>, <span class="number">1</span>, <span class="number">7</span>),</div><div class="line">         datetime(<span class="number">2011</span>, <span class="number">1</span>, <span class="number">8</span>), datetime(<span class="number">2011</span>, <span class="number">1</span>, <span class="number">10</span>), datetime(<span class="number">2011</span>, <span class="number">1</span>, <span class="number">12</span>)]</div><div class="line">ts = Series(np.random.randn(<span class="number">6</span>), index=dates)</div><div class="line">ts</div></pre></td></tr></table></figure><pre><code>2011-01-02   -0.296854
2011-01-05   -1.968663
2011-01-07   -0.484492
2011-01-08   -0.517927
2011-01-10   -0.348697
2011-01-12    0.102276
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">type(ts)</div><div class="line"><span class="comment"># note: output changed to "pandas.core.series.Series"</span></div></pre></td></tr></table></figure><pre><code>pandas.core.series.Series
</code></pre><p>拥有一个特定的类型</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.index</div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&apos;2011-01-02&apos;, &apos;2011-01-05&apos;, &apos;2011-01-07&apos;, &apos;2011-01-08&apos;,
               &apos;2011-01-10&apos;, &apos;2011-01-12&apos;],
              dtype=&apos;datetime64[ns]&apos;, freq=None)
</code></pre><p>可以直接进行加法运算，相同的时间戳会进行匹配</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts + ts[::<span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>2011-01-02   -0.593708
2011-01-05         NaN
2011-01-07   -0.968984
2011-01-08         NaN
2011-01-10   -0.697394
2011-01-12         NaN
dtype: float64
</code></pre><p>以纳秒形式存储时间戳</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ts.index.dtype</div><div class="line"><span class="comment"># note: output changed from dtype('datetime64[ns]') to dtype('&lt;M8[ns]')</span></div></pre></td></tr></table></figure><pre><code>dtype(&apos;&lt;M8[ns]&apos;)
</code></pre><p>行索引就会变成时间戳类型</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">stamp = ts.index[<span class="number">0</span>]</div><div class="line">stamp</div><div class="line"><span class="comment"># note: output changed from &lt;Timestamp: 2011-01-02 00:00:00&gt; to Timestamp('2011-01-02 00:00:00')</span></div></pre></td></tr></table></figure><pre><code>Timestamp(&apos;2011-01-02 00:00:00&apos;)
</code></pre><h3 id="索引、选取、子集构造"><a href="#索引、选取、子集构造" class="headerlink" title="索引、选取、子集构造"></a>索引、选取、子集构造</h3><p>时间戳索引与正常索引行为一样</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">stamp = ts.index[<span class="number">2</span>]</div><div class="line">ts[stamp]</div></pre></td></tr></table></figure><pre><code>-0.4844920247591406
</code></pre><p>可以直接通过传入与行索引相匹配的时间戳进行索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts[<span class="string">'1/10/2011'</span>]</div></pre></td></tr></table></figure><pre><code>-0.34869693931763396
</code></pre><p>换个格式也可以，会自动转换为<code>datatime</code>，只要最后转换成的时间戳是相同的，任意格式都可以</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts[<span class="string">'20110110'</span>]</div></pre></td></tr></table></figure><pre><code>-0.34869693931763396
</code></pre><p>通过<code>periods</code>参数来指定往后顺延的时间长短</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">longer_ts = Series(np.random.randn(<span class="number">1000</span>),</div><div class="line">                   index=pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">1000</span>))</div><div class="line">longer_ts</div></pre></td></tr></table></figure><pre><code>2000-01-01    0.871808
2000-01-02   -0.025158
2000-01-03    0.132813
2000-01-04   -2.006494
2000-01-05   -0.988423
2000-01-06    0.775930
                ...   
2002-09-21   -0.186519
2002-09-22    0.881745
2002-09-23   -1.335826
2002-09-24    0.418774
2002-09-25    0.970405
2002-09-26    0.636320
Freq: D, dtype: float64
</code></pre><p>时间戳的特殊之处在于可以进行年份以及月份等的选取，相当于一个多维索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">longer_ts[<span class="string">'2001'</span>]</div></pre></td></tr></table></figure><pre><code>2001-01-01   -1.799866
2001-01-02    0.499890
2001-01-03   -0.409970
2001-01-04   -0.808111
2001-01-05   -1.220433
2001-01-06    0.581235
                ...   
2001-12-26   -0.312186
2001-12-27   -0.804940
2001-12-28   -0.572741
2001-12-29   -0.175605
2001-12-30    0.693675
2001-12-31   -0.196274
Freq: D, dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">longer_ts[<span class="string">'2001-05'</span>]</div></pre></td></tr></table></figure><pre><code>2001-05-01   -2.783535
2001-05-02    1.386292
2001-05-03    0.153705
2001-05-04   -0.571590
2001-05-05   -0.933012
2001-05-06    0.579244
                ...   
2001-05-26    0.080809
2001-05-27    0.652650
2001-05-28    0.862616
2001-05-29   -0.967580
2001-05-30    0.907069
2001-05-31    0.551137
Freq: D, dtype: float64
</code></pre><p>同样可以进行切片，只不过是按照时间的先后度量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts[datetime(<span class="number">2011</span>, <span class="number">1</span>, <span class="number">7</span>):]</div></pre></td></tr></table></figure><pre><code>2011-01-07   -0.484492
2011-01-08   -0.517927
2011-01-10   -0.348697
2011-01-12    0.102276
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts</div></pre></td></tr></table></figure><pre><code>2011-01-02   -0.296854
2011-01-05   -1.968663
2011-01-07   -0.484492
2011-01-08   -0.517927
2011-01-10   -0.348697
2011-01-12    0.102276
dtype: float64
</code></pre><p>而且切片不需要进行索引匹配，只需要指定时间范围即可切片</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts[<span class="string">'1/6/2011'</span>:<span class="string">'1/11/2011'</span>]</div></pre></td></tr></table></figure><pre><code>2011-01-07   -0.484492
2011-01-08   -0.517927
2011-01-10   -0.348697
dtype: float64
</code></pre><p>一个可以实现同样功能的内置方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.truncate(after=<span class="string">'1/9/2011'</span>)</div></pre></td></tr></table></figure><pre><code>2011-01-02   -0.296854
2011-01-05   -1.968663
2011-01-07   -0.484492
2011-01-08   -0.517927
dtype: float64
</code></pre><p>这里的<code>freq</code>参数指定了选取的频率，这里的是每一个星期三</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">dates = pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">100</span>, freq=<span class="string">'W-WED'</span>)</div><div class="line">long_df = DataFrame(np.random.randn(<span class="number">100</span>, <span class="number">4</span>),</div><div class="line">                    index=dates,</div><div class="line">                    columns=[<span class="string">'Colorado'</span>, <span class="string">'Texas'</span>, <span class="string">'New York'</span>, <span class="string">'Ohio'</span>])</div><div class="line">long_df.ix[<span class="string">'5-2001'</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Colorado</th><br><th>Texas</th><br><th>New York</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2001-05-02</th><br><td>0.506207</td><br><td>-1.116218</td><br><td>0.656575</td><br><td>0.212606</td><br></tr><br><tr><br><th>2001-05-09</th><br><td>-1.306963</td><br><td>-0.054373</td><br><td>-1.165053</td><br><td>-1.319361</td><br></tr><br><tr><br><th>2001-05-16</th><br><td>0.891692</td><br><td>-0.463900</td><br><td>1.642267</td><br><td>0.644972</td><br></tr><br><tr><br><th>2001-05-23</th><br><td>-0.025283</td><br><td>2.363886</td><br><td>-0.367988</td><br><td>0.827882</td><br></tr><br><tr><br><th>2001-05-30</th><br><td>-1.501301</td><br><td>-2.534553</td><br><td>0.256369</td><br><td>0.268207</td><br></tr><br><br></tbody><br></table><br></div><h3 id="带有重复索引的时间序列"><a href="#带有重复索引的时间序列" class="headerlink" title="带有重复索引的时间序列"></a>带有重复索引的时间序列</h3><p>直接创建时间戳索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dates = pd.DatetimeIndex([<span class="string">'1/1/2000'</span>, <span class="string">'1/2/2000'</span>, <span class="string">'1/2/2000'</span>, <span class="string">'1/2/2000'</span>,</div><div class="line">                          <span class="string">'1/3/2000'</span>])</div><div class="line">dup_ts = Series(np.arange(<span class="number">5</span>), index=dates)</div><div class="line">dup_ts</div></pre></td></tr></table></figure><pre><code>2000-01-01    0
2000-01-02    1
2000-01-02    2
2000-01-02    3
2000-01-03    4
dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dup_ts.index.is_unique</div></pre></td></tr></table></figure><pre><code>False
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dup_ts[<span class="string">'1/3/2000'</span>]  <span class="comment"># not duplicated</span></div></pre></td></tr></table></figure><pre><code>4
</code></pre><p>如果有重复的时间索引，则会将满足条件的全部输出</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dup_ts[<span class="string">'1/2/2000'</span>]  <span class="comment"># duplicated</span></div></pre></td></tr></table></figure><pre><code>2000-01-02    1
2000-01-02    2
2000-01-02    3
dtype: int32
</code></pre><p>因此可以直接根据时间戳进行索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">grouped = dup_ts.groupby(level=<span class="number">0</span>)</div><div class="line">grouped.mean()</div></pre></td></tr></table></figure><pre><code>2000-01-01    0
2000-01-02    2
2000-01-03    4
dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grouped.count()</div></pre></td></tr></table></figure><pre><code>2000-01-01    1
2000-01-02    3
2000-01-03    1
dtype: int64
</code></pre><h2 id="日期的范围、频率以及移动"><a href="#日期的范围、频率以及移动" class="headerlink" title="日期的范围、频率以及移动"></a>日期的范围、频率以及移动</h2><p><code>pandas</code>中的时间序列一般被认为是不规则的，也就是说没有固定的频率。但是有时候需要以某种相对固定的频率进行分析，比如每日、每月、每15分钟等（这样自然会在时间序列中引入缺失值）。<code>pandas</code>拥有一整套标准时间序列频率以及用于重采样、频率推断、生成固定频率日期范围的工具</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts</div></pre></td></tr></table></figure><pre><code>2011-01-02   -0.296854
2011-01-05   -1.968663
2011-01-07   -0.484492
2011-01-08   -0.517927
2011-01-10   -0.348697
2011-01-12    0.102276
dtype: float64
</code></pre><p>例如，我们可以将之前那个时间序列转换为一个具有固定频率（每日）的时间序列。只需要调用resample即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.resample(<span class="string">'D'</span>).mean()</div></pre></td></tr></table></figure><pre><code>2011-01-02   -0.296854
2011-01-03         NaN
2011-01-04         NaN
2011-01-05   -1.968663
2011-01-06         NaN
2011-01-07   -0.484492
2011-01-08   -0.517927
2011-01-09         NaN
2011-01-10   -0.348697
2011-01-11         NaN
2011-01-12    0.102276
Freq: D, dtype: float64
</code></pre><h3 id="生成日期范围"><a href="#生成日期范围" class="headerlink" title="生成日期范围"></a>生成日期范围</h3><p><code>data_range</code>函数， 指定始末</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">index = pd.date_range(<span class="string">'4/1/2012'</span>, <span class="string">'6/1/2012'</span>)</div><div class="line">index</div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&apos;2012-04-01&apos;, &apos;2012-04-02&apos;, &apos;2012-04-03&apos;, &apos;2012-04-04&apos;,
               &apos;2012-04-05&apos;, &apos;2012-04-06&apos;, &apos;2012-04-07&apos;, &apos;2012-04-08&apos;,
               &apos;2012-04-09&apos;, &apos;2012-04-10&apos;, &apos;2012-04-11&apos;, &apos;2012-04-12&apos;,
               &apos;2012-04-13&apos;, &apos;2012-04-14&apos;, &apos;2012-04-15&apos;, &apos;2012-04-16&apos;,
               &apos;2012-04-17&apos;, &apos;2012-04-18&apos;, &apos;2012-04-19&apos;, &apos;2012-04-20&apos;,
               &apos;2012-04-21&apos;, &apos;2012-04-22&apos;, &apos;2012-04-23&apos;, &apos;2012-04-24&apos;,
               &apos;2012-04-25&apos;, &apos;2012-04-26&apos;, &apos;2012-04-27&apos;, &apos;2012-04-28&apos;,
               &apos;2012-04-29&apos;, &apos;2012-04-30&apos;, &apos;2012-05-01&apos;, &apos;2012-05-02&apos;,
               &apos;2012-05-03&apos;, &apos;2012-05-04&apos;, &apos;2012-05-05&apos;, &apos;2012-05-06&apos;,
               &apos;2012-05-07&apos;, &apos;2012-05-08&apos;, &apos;2012-05-09&apos;, &apos;2012-05-10&apos;,
               &apos;2012-05-11&apos;, &apos;2012-05-12&apos;, &apos;2012-05-13&apos;, &apos;2012-05-14&apos;,
               &apos;2012-05-15&apos;, &apos;2012-05-16&apos;, &apos;2012-05-17&apos;, &apos;2012-05-18&apos;,
               &apos;2012-05-19&apos;, &apos;2012-05-20&apos;, &apos;2012-05-21&apos;, &apos;2012-05-22&apos;,
               &apos;2012-05-23&apos;, &apos;2012-05-24&apos;, &apos;2012-05-25&apos;, &apos;2012-05-26&apos;,
               &apos;2012-05-27&apos;, &apos;2012-05-28&apos;, &apos;2012-05-29&apos;, &apos;2012-05-30&apos;,
               &apos;2012-05-31&apos;, &apos;2012-06-01&apos;],
              dtype=&apos;datetime64[ns]&apos;, freq=&apos;D&apos;)
</code></pre><p>只指定起始， 以及长度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.date_range(start=<span class="string">'4/1/2012'</span>, periods=<span class="number">20</span>)</div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&apos;2012-04-01&apos;, &apos;2012-04-02&apos;, &apos;2012-04-03&apos;, &apos;2012-04-04&apos;,
               &apos;2012-04-05&apos;, &apos;2012-04-06&apos;, &apos;2012-04-07&apos;, &apos;2012-04-08&apos;,
               &apos;2012-04-09&apos;, &apos;2012-04-10&apos;, &apos;2012-04-11&apos;, &apos;2012-04-12&apos;,
               &apos;2012-04-13&apos;, &apos;2012-04-14&apos;, &apos;2012-04-15&apos;, &apos;2012-04-16&apos;,
               &apos;2012-04-17&apos;, &apos;2012-04-18&apos;, &apos;2012-04-19&apos;, &apos;2012-04-20&apos;],
              dtype=&apos;datetime64[ns]&apos;, freq=&apos;D&apos;)
</code></pre><p>只指定结尾，以及长度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.date_range(end=<span class="string">'6/1/2012'</span>, periods=<span class="number">20</span>)</div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&apos;2012-05-13&apos;, &apos;2012-05-14&apos;, &apos;2012-05-15&apos;, &apos;2012-05-16&apos;,
               &apos;2012-05-17&apos;, &apos;2012-05-18&apos;, &apos;2012-05-19&apos;, &apos;2012-05-20&apos;,
               &apos;2012-05-21&apos;, &apos;2012-05-22&apos;, &apos;2012-05-23&apos;, &apos;2012-05-24&apos;,
               &apos;2012-05-25&apos;, &apos;2012-05-26&apos;, &apos;2012-05-27&apos;, &apos;2012-05-28&apos;,
               &apos;2012-05-29&apos;, &apos;2012-05-30&apos;, &apos;2012-05-31&apos;, &apos;2012-06-01&apos;],
              dtype=&apos;datetime64[ns]&apos;, freq=&apos;D&apos;)
</code></pre><p>指定始末，以及采样频率， <code>BM = business end of month</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.date_range(<span class="string">'1/1/2000'</span>, <span class="string">'12/1/2000'</span>, freq=<span class="string">'BM'</span>)</div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&apos;2000-01-31&apos;, &apos;2000-02-29&apos;, &apos;2000-03-31&apos;, &apos;2000-04-28&apos;,
               &apos;2000-05-31&apos;, &apos;2000-06-30&apos;, &apos;2000-07-31&apos;, &apos;2000-08-31&apos;,
               &apos;2000-09-29&apos;, &apos;2000-10-31&apos;, &apos;2000-11-30&apos;],
              dtype=&apos;datetime64[ns]&apos;, freq=&apos;BM&apos;)
</code></pre><p>默认peroids指的是天数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.date_range(<span class="string">'5/2/2012 12:56:31'</span>, periods=<span class="number">5</span>)</div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&apos;2012-05-02 12:56:31&apos;, &apos;2012-05-03 12:56:31&apos;,
               &apos;2012-05-04 12:56:31&apos;, &apos;2012-05-05 12:56:31&apos;,
               &apos;2012-05-06 12:56:31&apos;],
              dtype=&apos;datetime64[ns]&apos;, freq=&apos;D&apos;)
</code></pre><p>可以省略时间戳</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.date_range(<span class="string">'5/2/2012 12:56:31'</span>, periods=<span class="number">5</span>, normalize=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&apos;2012-05-02&apos;, &apos;2012-05-03&apos;, &apos;2012-05-04&apos;, &apos;2012-05-05&apos;,
               &apos;2012-05-06&apos;],
              dtype=&apos;datetime64[ns]&apos;, freq=&apos;D&apos;)
</code></pre><h3 id="频率和日期偏移量"><a href="#频率和日期偏移量" class="headerlink" title="频率和日期偏移量"></a>频率和日期偏移量</h3><p>偏移量可以采用特定单位的时间对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pandas.tseries.offsets <span class="keyword">import</span> Hour, Minute</div><div class="line">hour = Hour()</div><div class="line">hour</div></pre></td></tr></table></figure><pre><code>&lt;Hour&gt;
</code></pre><p>4个小时，简单粗暴</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">four_hours = Hour(<span class="number">4</span>)</div><div class="line">four_hours</div></pre></td></tr></table></figure><pre><code>&lt;4 * Hours&gt;
</code></pre><p>每隔四个小时进行采样</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.date_range(<span class="string">'1/1/2000'</span>, <span class="string">'1/3/2000 23:59'</span>, freq=<span class="string">'4h'</span>)</div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&apos;2000-01-01 00:00:00&apos;, &apos;2000-01-01 04:00:00&apos;,
               &apos;2000-01-01 08:00:00&apos;, &apos;2000-01-01 12:00:00&apos;,
               &apos;2000-01-01 16:00:00&apos;, &apos;2000-01-01 20:00:00&apos;,
               &apos;2000-01-02 00:00:00&apos;, &apos;2000-01-02 04:00:00&apos;,
               &apos;2000-01-02 08:00:00&apos;, &apos;2000-01-02 12:00:00&apos;,
               &apos;2000-01-02 16:00:00&apos;, &apos;2000-01-02 20:00:00&apos;,
               &apos;2000-01-03 00:00:00&apos;, &apos;2000-01-03 04:00:00&apos;,
               &apos;2000-01-03 08:00:00&apos;, &apos;2000-01-03 12:00:00&apos;,
               &apos;2000-01-03 16:00:00&apos;, &apos;2000-01-03 20:00:00&apos;],
              dtype=&apos;datetime64[ns]&apos;, freq=&apos;4H&apos;)
</code></pre><p>两个半小时</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Hour(<span class="number">2</span>) + Minute(<span class="number">30</span>)</div></pre></td></tr></table></figure><pre><code>&lt;150 * Minutes&gt;
</code></pre><p>也可以直接使用这种类似于自然语言的形式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">10</span>, freq=<span class="string">'1h30min'</span>)</div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&apos;2000-01-01 00:00:00&apos;, &apos;2000-01-01 01:30:00&apos;,
               &apos;2000-01-01 03:00:00&apos;, &apos;2000-01-01 04:30:00&apos;,
               &apos;2000-01-01 06:00:00&apos;, &apos;2000-01-01 07:30:00&apos;,
               &apos;2000-01-01 09:00:00&apos;, &apos;2000-01-01 10:30:00&apos;,
               &apos;2000-01-01 12:00:00&apos;, &apos;2000-01-01 13:30:00&apos;],
              dtype=&apos;datetime64[ns]&apos;, freq=&apos;90T&apos;)
</code></pre><h4 id="Week-of-month-dates-（WOM日期）"><a href="#Week-of-month-dates-（WOM日期）" class="headerlink" title="Week of month dates （WOM日期）"></a>Week of month dates （WOM日期）</h4><p>每月第三个星期五</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rng = pd.date_range(<span class="string">'1/1/2012'</span>, <span class="string">'9/1/2012'</span>, freq=<span class="string">'WOM-3FRI'</span>)</div><div class="line">list(rng)</div></pre></td></tr></table></figure><pre><code>[Timestamp(&apos;2012-01-20 00:00:00&apos;, offset=&apos;WOM-3FRI&apos;),
 Timestamp(&apos;2012-02-17 00:00:00&apos;, offset=&apos;WOM-3FRI&apos;),
 Timestamp(&apos;2012-03-16 00:00:00&apos;, offset=&apos;WOM-3FRI&apos;),
 Timestamp(&apos;2012-04-20 00:00:00&apos;, offset=&apos;WOM-3FRI&apos;),
 Timestamp(&apos;2012-05-18 00:00:00&apos;, offset=&apos;WOM-3FRI&apos;),
 Timestamp(&apos;2012-06-15 00:00:00&apos;, offset=&apos;WOM-3FRI&apos;),
 Timestamp(&apos;2012-07-20 00:00:00&apos;, offset=&apos;WOM-3FRI&apos;),
 Timestamp(&apos;2012-08-17 00:00:00&apos;, offset=&apos;WOM-3FRI&apos;)]
</code></pre><h3 id="移动（超前或滞后）数据"><a href="#移动（超前或滞后）数据" class="headerlink" title="移动（超前或滞后）数据"></a>移动（超前或滞后）数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ts = Series(np.random.randn(<span class="number">4</span>),</div><div class="line">            index=pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">4</span>, freq=<span class="string">'M'</span>))</div><div class="line">ts</div></pre></td></tr></table></figure><pre><code>2000-01-31    1.294798
2000-02-29   -1.907732
2000-03-31   -1.407750
2000-04-30    0.544825
Freq: M, dtype: float64
</code></pre><p>整体数据前移</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.shift(<span class="number">2</span>)</div></pre></td></tr></table></figure><pre><code>2000-01-31         NaN
2000-02-29         NaN
2000-03-31    1.294798
2000-04-30   -1.907732
Freq: M, dtype: float64
</code></pre><p>整体数据后移，有点类似于位运算中的移位操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.shift(<span class="number">-2</span>)</div></pre></td></tr></table></figure><pre><code>2000-01-31   -1.407750
2000-02-29    0.544825
2000-03-31         NaN
2000-04-30         NaN
Freq: M, dtype: float64
</code></pre><p>移位之后数据对齐</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts / ts.shift(<span class="number">1</span>) - <span class="number">1</span></div></pre></td></tr></table></figure><pre><code>2000-01-31         NaN
2000-02-29   -2.473382
2000-03-31   -0.262082
2000-04-30   -1.387018
Freq: M, dtype: float64
</code></pre><p>加入<code>freq</code>之后就是在行索引上进行时间前移</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.shift(<span class="number">2</span>, freq=<span class="string">'M'</span>)</div></pre></td></tr></table></figure><pre><code>2000-03-31    1.294798
2000-04-30   -1.907732
2000-05-31   -1.407750
2000-06-30    0.544825
Freq: M, dtype: float64
</code></pre><p>在天数上进行前移</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.shift(<span class="number">3</span>, freq=<span class="string">'D'</span>)</div></pre></td></tr></table></figure><pre><code>2000-02-03    1.294798
2000-03-03   -1.907732
2000-04-03   -1.407750
2000-05-03    0.544825
dtype: float64
</code></pre><p>另一种实现方式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.shift(<span class="number">1</span>, freq=<span class="string">'3D'</span>)</div></pre></td></tr></table></figure><pre><code>2000-02-03    1.294798
2000-03-03   -1.907732
2000-04-03   -1.407750
2000-05-03    0.544825
dtype: float64
</code></pre><p>换一个频率</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.shift(<span class="number">1</span>, freq=<span class="string">'90T'</span>)</div></pre></td></tr></table></figure><pre><code>2000-01-31 01:30:00    1.294798
2000-02-29 01:30:00   -1.907732
2000-03-31 01:30:00   -1.407750
2000-04-30 01:30:00    0.544825
Freq: M, dtype: float64
</code></pre><h4 id="通过偏移量对日期进行位移"><a href="#通过偏移量对日期进行位移" class="headerlink" title="通过偏移量对日期进行位移"></a>通过偏移量对日期进行位移</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pandas.tseries.offsets <span class="keyword">import</span> Day, MonthEnd</div><div class="line">now = datetime(<span class="number">2011</span>, <span class="number">11</span>, <span class="number">17</span>)</div><div class="line">now + <span class="number">3</span> * Day()</div></pre></td></tr></table></figure><pre><code>Timestamp(&apos;2011-11-20 00:00:00&apos;)
</code></pre><p>直接移位到月末，是一个相对位移</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">now + MonthEnd()</div></pre></td></tr></table></figure><pre><code>Timestamp(&apos;2011-11-30 00:00:00&apos;)
</code></pre><p>传入的参数表示第几个月的月末</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">now + MonthEnd(<span class="number">2</span>)</div></pre></td></tr></table></figure><pre><code>Timestamp(&apos;2011-12-31 00:00:00&apos;)
</code></pre><p>换一种方式实现，“主语”不同</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">offset = MonthEnd()</div><div class="line">offset.rollforward(now)</div></pre></td></tr></table></figure><pre><code>Timestamp(&apos;2011-11-30 00:00:00&apos;)
</code></pre><p>往回走，上一个月的月末</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">offset.rollback(now)</div></pre></td></tr></table></figure><pre><code>Timestamp(&apos;2011-10-31 00:00:00&apos;)
</code></pre><p>对日期进行移位之后分组</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ts = Series(np.random.randn(<span class="number">20</span>),</div><div class="line">            index=pd.date_range(<span class="string">'1/15/2000'</span>, periods=<span class="number">20</span>, freq=<span class="string">'4d'</span>))</div><div class="line">ts.groupby(offset.rollforward).mean()</div></pre></td></tr></table></figure><pre><code>2000-01-31   -0.610639
2000-02-29    0.029121
2000-03-31   -0.089587
dtype: float64
</code></pre><p>另一种方式也可以达到相同的效果</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.resample(<span class="string">'M'</span>, how=<span class="string">'mean'</span>)</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:1: FutureWarning: how in .resample() is deprecated
the new syntax is .resample(...).mean()
  if __name__ == &apos;__main__&apos;:





2000-01-31   -0.610639
2000-02-29    0.029121
2000-03-31   -0.089587
Freq: M, dtype: float64
</code></pre><h2 id="时区处理"><a href="#时区处理" class="headerlink" title="时区处理"></a>时区处理</h2><p>显示一些时区</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pytz</div><div class="line">pytz.common_timezones[<span class="number">-5</span>:]</div></pre></td></tr></table></figure><pre><code>[&apos;US/Eastern&apos;, &apos;US/Hawaii&apos;, &apos;US/Mountain&apos;, &apos;US/Pacific&apos;, &apos;UTC&apos;]
</code></pre><p>显示某个时区的具体信息</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tz = pytz.timezone(<span class="string">'US/Eastern'</span>)</div><div class="line">tz</div></pre></td></tr></table></figure><pre><code>&lt;DstTzInfo &apos;US/Eastern&apos; LMT-1 day, 19:04:00 STD&gt;
</code></pre><h3 id="本地化和转换"><a href="#本地化和转换" class="headerlink" title="本地化和转换"></a>本地化和转换</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rng = pd.date_range(<span class="string">'3/9/2012 9:30'</span>, periods=<span class="number">6</span>, freq=<span class="string">'D'</span>)</div><div class="line">ts = Series(np.random.randn(len(rng)), index=rng)</div><div class="line">ts</div></pre></td></tr></table></figure><pre><code>2012-03-09 09:30:00    0.065144
2012-03-10 09:30:00   -0.391505
2012-03-11 09:30:00    1.207495
2012-03-12 09:30:00    1.516354
2012-03-13 09:30:00   -0.253149
2012-03-14 09:30:00   -0.768138
Freq: D, dtype: float64
</code></pre><p>没有指定时区的时候默认时区为None</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">print(ts.index.tz)</div></pre></td></tr></table></figure><pre><code>None
</code></pre><p>​</p><p>指定时区</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.date_range(<span class="string">'3/9/2012 9:30'</span>, periods=<span class="number">10</span>, freq=<span class="string">'D'</span>, tz=<span class="string">'UTC'</span>)</div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&apos;2012-03-09 09:30:00+00:00&apos;, &apos;2012-03-10 09:30:00+00:00&apos;,
               &apos;2012-03-11 09:30:00+00:00&apos;, &apos;2012-03-12 09:30:00+00:00&apos;,
               &apos;2012-03-13 09:30:00+00:00&apos;, &apos;2012-03-14 09:30:00+00:00&apos;,
               &apos;2012-03-15 09:30:00+00:00&apos;, &apos;2012-03-16 09:30:00+00:00&apos;,
               &apos;2012-03-17 09:30:00+00:00&apos;, &apos;2012-03-18 09:30:00+00:00&apos;],
              dtype=&apos;datetime64[ns, UTC]&apos;, freq=&apos;D&apos;)
</code></pre><p>进行时区的转换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ts_utc = ts.tz_localize(<span class="string">'UTC'</span>)</div><div class="line">ts_utc</div></pre></td></tr></table></figure><pre><code>2012-03-09 09:30:00+00:00    0.065144
2012-03-10 09:30:00+00:00   -0.391505
2012-03-11 09:30:00+00:00    1.207495
2012-03-12 09:30:00+00:00    1.516354
2012-03-13 09:30:00+00:00   -0.253149
2012-03-14 09:30:00+00:00   -0.768138
Freq: D, dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts_utc.index</div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&apos;2012-03-09 09:30:00+00:00&apos;, &apos;2012-03-10 09:30:00+00:00&apos;,
               &apos;2012-03-11 09:30:00+00:00&apos;, &apos;2012-03-12 09:30:00+00:00&apos;,
               &apos;2012-03-13 09:30:00+00:00&apos;, &apos;2012-03-14 09:30:00+00:00&apos;],
              dtype=&apos;datetime64[ns, UTC]&apos;, freq=&apos;D&apos;)
</code></pre><p>继续转换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts_utc.tz_convert(<span class="string">'US/Eastern'</span>)</div></pre></td></tr></table></figure><pre><code>2012-03-09 04:30:00-05:00    0.065144
2012-03-10 04:30:00-05:00   -0.391505
2012-03-11 05:30:00-04:00    1.207495
2012-03-12 05:30:00-04:00    1.516354
2012-03-13 05:30:00-04:00   -0.253149
2012-03-14 05:30:00-04:00   -0.768138
Freq: D, dtype: float64
</code></pre><p>依旧是转换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ts_eastern = ts.tz_localize(<span class="string">'US/Eastern'</span>)</div><div class="line">ts_eastern.tz_convert(<span class="string">'UTC'</span>)</div></pre></td></tr></table></figure><pre><code>2012-03-09 14:30:00+00:00    0.065144
2012-03-10 14:30:00+00:00   -0.391505
2012-03-11 13:30:00+00:00    1.207495
2012-03-12 13:30:00+00:00    1.516354
2012-03-13 13:30:00+00:00   -0.253149
2012-03-14 13:30:00+00:00   -0.768138
Freq: D, dtype: float64
</code></pre><p>转转转</p><p>ts_eastern.tz_convert(‘Europe/Berlin’)</p><p>转换之前必须要进行本地化</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.index.tz_localize(<span class="string">'Asia/Shanghai'</span>)</div></pre></td></tr></table></figure><h3 id="操作时区意识型TimeStamp对象"><a href="#操作时区意识型TimeStamp对象" class="headerlink" title="操作时区意识型TimeStamp对象"></a>操作时区意识型<code>TimeStamp</code>对象</h3><p>初始化时间戳，本地化，时区转换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">stamp = pd.Timestamp(<span class="string">'2011-03-12 04:00'</span>)</div><div class="line">stamp_utc = stamp.tz_localize(<span class="string">'utc'</span>)</div><div class="line">stamp_utc.tz_convert(<span class="string">'US/Eastern'</span>)</div></pre></td></tr></table></figure><pre><code>Timestamp(&apos;2011-03-11 23:00:00-0500&apos;, tz=&apos;US/Eastern&apos;)
</code></pre><p>显式地初始化</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">stamp_moscow = pd.Timestamp(<span class="string">'2011-03-12 04:00'</span>, tz=<span class="string">'Europe/Moscow'</span>)</div><div class="line">stamp_moscow</div></pre></td></tr></table></figure><pre><code>Timestamp(&apos;2011-03-12 04:00:00+0300&apos;, tz=&apos;Europe/Moscow&apos;)
</code></pre><p>自1970年1月1日起计算的纳秒数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">stamp_utc.value</div></pre></td></tr></table></figure><pre><code>1299902400000000000
</code></pre><p>这个值是绝对的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">stamp_utc.tz_convert(<span class="string">'US/Eastern'</span>).value</div></pre></td></tr></table></figure><pre><code>1299902400000000000
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 30 minutes before DST transition</span></div><div class="line"><span class="keyword">from</span> pandas.tseries.offsets <span class="keyword">import</span> Hour</div><div class="line">stamp = pd.Timestamp(<span class="string">'2012-03-12 01:30'</span>, tz=<span class="string">'US/Eastern'</span>)</div><div class="line">stamp</div></pre></td></tr></table></figure><pre><code>Timestamp(&apos;2012-03-12 01:30:00-0400&apos;, tz=&apos;US/Eastern&apos;)
</code></pre><p>进行时间的位移</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">stamp + Hour()</div></pre></td></tr></table></figure><pre><code>Timestamp(&apos;2012-03-12 02:30:00-0400&apos;, tz=&apos;US/Eastern&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 90 minutes before DST transition</span></div><div class="line">stamp = pd.Timestamp(<span class="string">'2012-11-04 00:30'</span>, tz=<span class="string">'US/Eastern'</span>)</div><div class="line">stamp</div></pre></td></tr></table></figure><pre><code>Timestamp(&apos;2012-11-04 00:30:00-0400&apos;, tz=&apos;US/Eastern&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">stamp + <span class="number">2</span> * Hour()</div></pre></td></tr></table></figure><pre><code>Timestamp(&apos;2012-11-04 01:30:00-0500&apos;, tz=&apos;US/Eastern&apos;)
</code></pre><h3 id="不同时区之间的运算"><a href="#不同时区之间的运算" class="headerlink" title="不同时区之间的运算"></a>不同时区之间的运算</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rng = pd.date_range(<span class="string">'3/7/2012 9:30'</span>, periods=<span class="number">10</span>, freq=<span class="string">'B'</span>)</div><div class="line">ts = Series(np.random.randn(len(rng)), index=rng)</div><div class="line">ts</div></pre></td></tr></table></figure><pre><code>2012-03-07 09:30:00   -0.461750
2012-03-08 09:30:00    0.947394
2012-03-09 09:30:00    0.703239
2012-03-12 09:30:00    0.266519
2012-03-13 09:30:00    0.302334
2012-03-14 09:30:00   -0.000725
2012-03-15 09:30:00    0.305446
2012-03-16 09:30:00   -1.605358
2012-03-19 09:30:00    1.306474
2012-03-20 09:30:00    0.865511
Freq: B, dtype: float64
</code></pre><p>最终结果会变成<code>UTC</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ts1 = ts[:<span class="number">7</span>].tz_localize(<span class="string">'Europe/London'</span>)</div><div class="line">ts2 = ts1[<span class="number">2</span>:].tz_convert(<span class="string">'Europe/Moscow'</span>)</div><div class="line">result = ts1 + ts2</div><div class="line">result.index</div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&apos;2012-03-07 09:30:00+00:00&apos;, &apos;2012-03-08 09:30:00+00:00&apos;,
               &apos;2012-03-09 09:30:00+00:00&apos;, &apos;2012-03-12 09:30:00+00:00&apos;,
               &apos;2012-03-13 09:30:00+00:00&apos;, &apos;2012-03-14 09:30:00+00:00&apos;,
               &apos;2012-03-15 09:30:00+00:00&apos;],
              dtype=&apos;datetime64[ns, UTC]&apos;, freq=&apos;B&apos;)
</code></pre><h2 id="时期及其算术运算"><a href="#时期及其算术运算" class="headerlink" title="时期及其算术运算"></a>时期及其算术运算</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p = pd.Period(<span class="number">2007</span>, freq=<span class="string">'A-DEC'</span>)</div><div class="line">p</div></pre></td></tr></table></figure><pre><code>Period(&apos;2007&apos;, &apos;A-DEC&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p + <span class="number">5</span></div></pre></td></tr></table></figure><pre><code>Period(&apos;2012&apos;, &apos;A-DEC&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p - <span class="number">2</span></div></pre></td></tr></table></figure><pre><code>Period(&apos;2005&apos;, &apos;A-DEC&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.Period(<span class="string">'2014'</span>, freq=<span class="string">'A-DEC'</span>) - p</div></pre></td></tr></table></figure><pre><code>7
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rng = pd.period_range(<span class="string">'1/1/2000'</span>, <span class="string">'6/30/2000'</span>, freq=<span class="string">'M'</span>)</div><div class="line">rng</div></pre></td></tr></table></figure><pre><code>PeriodIndex([&apos;2000-01&apos;, &apos;2000-02&apos;, &apos;2000-03&apos;, &apos;2000-04&apos;, &apos;2000-05&apos;, &apos;2000-06&apos;], dtype=&apos;int64&apos;, freq=&apos;M&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Series(np.random.randn(<span class="number">6</span>), index=rng)</div></pre></td></tr></table></figure><pre><code>2000-01    0.061389
2000-02    0.059265
2000-03    0.779627
2000-04   -0.068995
2000-05   -0.451276
2000-06   -1.531821
Freq: M, dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">values = [<span class="string">'2001Q3'</span>, <span class="string">'2002Q2'</span>, <span class="string">'2003Q1'</span>]</div><div class="line">index = pd.PeriodIndex(values, freq=<span class="string">'Q-DEC'</span>)</div><div class="line">index</div></pre></td></tr></table></figure><pre><code>PeriodIndex([&apos;2001Q3&apos;, &apos;2002Q2&apos;, &apos;2003Q1&apos;], dtype=&apos;int64&apos;, freq=&apos;Q-DEC&apos;)
</code></pre><h3 id="时区的频率转换"><a href="#时区的频率转换" class="headerlink" title="时区的频率转换"></a>时区的频率转换</h3><p>以十二月为结尾的一个年时期</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p = pd.Period(<span class="string">'2007'</span>, freq=<span class="string">'A-DEC'</span>)</div><div class="line">p.asfreq(<span class="string">'M'</span>, how=<span class="string">'start'</span>)</div></pre></td></tr></table></figure><pre><code>Period(&apos;2007-01&apos;, &apos;M&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p.asfreq(<span class="string">'M'</span>, how=<span class="string">'end'</span>)</div></pre></td></tr></table></figure><pre><code>Period(&apos;2007-12&apos;, &apos;M&apos;)
</code></pre><p>以六月份结尾的一个年时期</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p = pd.Period(<span class="string">'2007'</span>, freq=<span class="string">'A-JUN'</span>)</div><div class="line">p.asfreq(<span class="string">'M'</span>, <span class="string">'start'</span>)</div></pre></td></tr></table></figure><pre><code>Period(&apos;2006-07&apos;, &apos;M&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p.asfreq(<span class="string">'M'</span>, <span class="string">'end'</span>)</div></pre></td></tr></table></figure><pre><code>Period(&apos;2007-06&apos;, &apos;M&apos;)
</code></pre><p>2007年8月是属于以六月结尾的2008年的时期中</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p = pd.Period(<span class="string">'Aug-2007'</span>, <span class="string">'M'</span>)</div><div class="line">p.asfreq(<span class="string">'A-JUN'</span>)</div></pre></td></tr></table></figure><pre><code>Period(&apos;2008&apos;, &apos;A-JUN&apos;)
</code></pre><p>相当于一个批量操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rng = pd.period_range(<span class="string">'2006'</span>, <span class="string">'2009'</span>, freq=<span class="string">'A-DEC'</span>)</div><div class="line">ts = Series(np.random.randn(len(rng)), index=rng)</div><div class="line">ts</div></pre></td></tr></table></figure><pre><code>2006    0.634252
2007   -0.738716
2008    0.398145
2009   -1.226529
Freq: A-DEC, dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.asfreq(<span class="string">'M'</span>, how=<span class="string">'start'</span>)</div></pre></td></tr></table></figure><pre><code>2006-01    0.634252
2007-01   -0.738716
2008-01    0.398145
2009-01   -1.226529
Freq: M, dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.asfreq(<span class="string">'B'</span>, how=<span class="string">'end'</span>)</div></pre></td></tr></table></figure><pre><code>2006-12-29    0.634252
2007-12-31   -0.738716
2008-12-31    0.398145
2009-12-31   -1.226529
Freq: B, dtype: float64
</code></pre><h3 id="按季度计算的时间频率"><a href="#按季度计算的时间频率" class="headerlink" title="按季度计算的时间频率"></a>按季度计算的时间频率</h3><p>以一月为截止的第四个季度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p = pd.Period(<span class="string">'2012Q4'</span>, freq=<span class="string">'Q-JAN'</span>)</div><div class="line">p</div></pre></td></tr></table></figure><pre><code>Period(&apos;2012Q4&apos;, &apos;Q-JAN&apos;)
</code></pre><p>第四个季度的起始日</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p.asfreq(<span class="string">'D'</span>, <span class="string">'start'</span>)</div></pre></td></tr></table></figure><pre><code>Period(&apos;2011-11-01&apos;, &apos;D&apos;)
</code></pre><p>结束日</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p.asfreq(<span class="string">'D'</span>, <span class="string">'end'</span>)</div></pre></td></tr></table></figure><pre><code>Period(&apos;2012-01-31&apos;, &apos;D&apos;)
</code></pre><p>截止日前一天的下午四点</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p4pm = (p.asfreq(<span class="string">'B'</span>, <span class="string">'e'</span>) - <span class="number">1</span>).asfreq(<span class="string">'T'</span>, <span class="string">'s'</span>) + <span class="number">16</span> * <span class="number">60</span></div><div class="line">p4pm</div></pre></td></tr></table></figure><pre><code>Period(&apos;2012-01-30 16:00&apos;, &apos;T&apos;)
</code></pre><p>转化成时间戳对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">p4pm.to_timestamp()</div></pre></td></tr></table></figure><pre><code>Timestamp(&apos;2012-01-30 16:00:00&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rng = pd.period_range(<span class="string">'2011Q3'</span>, <span class="string">'2012Q4'</span>, freq=<span class="string">'Q-JAN'</span>)</div><div class="line">ts = Series(np.arange(len(rng)), index=rng)</div><div class="line">ts</div></pre></td></tr></table></figure><pre><code>2011Q3    0
2011Q4    1
2012Q1    2
2012Q2    3
2012Q3    4
2012Q4    5
Freq: Q-JAN, dtype: int32
</code></pre><p>批量转化为时间戳</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">new_rng = (rng.asfreq(<span class="string">'B'</span>, <span class="string">'e'</span>) - <span class="number">1</span>).asfreq(<span class="string">'T'</span>, <span class="string">'s'</span>) + <span class="number">16</span> * <span class="number">60</span></div><div class="line">ts.index = new_rng.to_timestamp()</div><div class="line">ts</div></pre></td></tr></table></figure><pre><code>2010-10-28 16:00:00    0
2011-01-28 16:00:00    1
2011-04-28 16:00:00    2
2011-07-28 16:00:00    3
2011-10-28 16:00:00    4
2012-01-30 16:00:00    5
dtype: int32
</code></pre><h3 id="将时间戳转化为时期（以及其逆过程）"><a href="#将时间戳转化为时期（以及其逆过程）" class="headerlink" title="将时间戳转化为时期（以及其逆过程）"></a>将时间戳转化为时期（以及其逆过程）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">rng = pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">3</span>, freq=<span class="string">'M'</span>)</div><div class="line">ts = Series(randn(<span class="number">3</span>), index=rng)</div><div class="line">pts = ts.to_period()</div><div class="line">ts</div></pre></td></tr></table></figure><pre><code>2000-01-31    0.239752
2000-02-29   -0.469201
2000-03-31    2.835243
Freq: M, dtype: float64
</code></pre><p>默认以月份为单位进行转化</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pts</div></pre></td></tr></table></figure><pre><code>2000-01    0.239752
2000-02   -0.469201
2000-03    2.835243
Freq: M, dtype: float64
</code></pre><p>转化为月份为单位的时期</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rng = pd.date_range(<span class="string">'1/29/2000'</span>, periods=<span class="number">6</span>, freq=<span class="string">'D'</span>)</div><div class="line">ts2 = Series(randn(<span class="number">6</span>), index=rng)</div><div class="line">ts2.to_period(<span class="string">'M'</span>)</div></pre></td></tr></table></figure><pre><code>2000-01    1.126773
2000-01   -0.979309
2000-01   -0.784376
2000-02   -1.490820
2000-02    1.125043
2000-02    0.421830
Freq: M, dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pts = ts.to_period()</div><div class="line">pts</div></pre></td></tr></table></figure><pre><code>2000-01    0.239752
2000-02   -0.469201
2000-03    2.835243
Freq: M, dtype: float64
</code></pre><p>逆向转换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pts.to_timestamp(how=<span class="string">'end'</span>)</div></pre></td></tr></table></figure><pre><code>2000-01-31    0.239752
2000-02-29   -0.469201
2000-03-31    2.835243
Freq: M, dtype: float64
</code></pre><h3 id="通过数组创建PeriodIndex"><a href="#通过数组创建PeriodIndex" class="headerlink" title="通过数组创建PeriodIndex"></a>通过数组创建<code>PeriodIndex</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data = pd.read_csv(<span class="string">'ch08/macrodata.csv'</span>)</div><div class="line">data.year</div></pre></td></tr></table></figure><pre><code>0      1959.0
1      1959.0
2      1959.0
3      1959.0
4      1960.0
5      1960.0
        ...  
197    2008.0
198    2008.0
199    2008.0
200    2009.0
201    2009.0
202    2009.0
Name: year, dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.quarter</div></pre></td></tr></table></figure><pre><code>0      1.0
1      2.0
2      3.0
3      4.0
4      1.0
5      2.0
      ... 
197    2.0
198    3.0
199    4.0
200    1.0
201    2.0
202    3.0
Name: quarter, dtype: float64
</code></pre><p>将年份和季度数据统一起来转化为时期索引数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">index = pd.PeriodIndex(year=data.year, quarter=data.quarter, freq=<span class="string">'Q-DEC'</span>)</div><div class="line">index</div></pre></td></tr></table></figure><pre><code>PeriodIndex([&apos;1959Q1&apos;, &apos;1959Q2&apos;, &apos;1959Q3&apos;, &apos;1959Q4&apos;, &apos;1960Q1&apos;, &apos;1960Q2&apos;,
             &apos;1960Q3&apos;, &apos;1960Q4&apos;, &apos;1961Q1&apos;, &apos;1961Q2&apos;,
             ...
             &apos;2007Q2&apos;, &apos;2007Q3&apos;, &apos;2007Q4&apos;, &apos;2008Q1&apos;, &apos;2008Q2&apos;, &apos;2008Q3&apos;,
             &apos;2008Q4&apos;, &apos;2009Q1&apos;, &apos;2009Q2&apos;, &apos;2009Q3&apos;],
            dtype=&apos;int64&apos;, length=203, freq=&apos;Q-DEC&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data.index = index</div><div class="line">data.infl</div></pre></td></tr></table></figure><pre><code>1959Q1    0.00
1959Q2    2.34
1959Q3    2.74
1959Q4    0.27
1960Q1    2.31
1960Q2    0.14
          ... 
2008Q2    8.53
2008Q3   -3.16
2008Q4   -8.79
2009Q1    0.94
2009Q2    3.37
2009Q3    3.56
Freq: Q-DEC, Name: infl, dtype: float64
</code></pre><h2 id="重采样以及频率转换"><a href="#重采样以及频率转换" class="headerlink" title="重采样以及频率转换"></a>重采样以及频率转换</h2><p>相当于进行了一次分组操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rng = pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">100</span>, freq=<span class="string">'D'</span>)</div><div class="line">ts = Series(randn(len(rng)), index=rng)</div><div class="line">ts.resample(<span class="string">'M'</span>, how=<span class="string">'mean'</span>)</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:3: FutureWarning: how in .resample() is deprecated
the new syntax is .resample(...).mean()
  app.launch_new_instance()





2000-01-31   -0.055153
2000-02-29    0.189412
2000-03-31   -0.075940
2000-04-30   -0.239036
Freq: M, dtype: float64
</code></pre><p>换个索引的形式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.resample(<span class="string">'M'</span>, how=<span class="string">'mean'</span>, kind=<span class="string">'period'</span>)</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:1: FutureWarning: how in .resample() is deprecated
the new syntax is .resample(...).mean()
  if __name__ == &apos;__main__&apos;:





2000-01   -0.055153
2000-02    0.189412
2000-03   -0.075940
2000-04   -0.239036
Freq: M, dtype: float64
</code></pre><h3 id="降采样"><a href="#降采样" class="headerlink" title="降采样"></a>降采样</h3><p>按照分钟进行采样</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rng = pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">12</span>, freq=<span class="string">'T'</span>)</div><div class="line">ts = Series(np.arange(<span class="number">12</span>), index=rng)</div><div class="line">ts</div></pre></td></tr></table></figure><pre><code>2000-01-01 00:00:00     0
2000-01-01 00:01:00     1
2000-01-01 00:02:00     2
2000-01-01 00:03:00     3
2000-01-01 00:04:00     4
2000-01-01 00:05:00     5
2000-01-01 00:06:00     6
2000-01-01 00:07:00     7
2000-01-01 00:08:00     8
2000-01-01 00:09:00     9
2000-01-01 00:10:00    10
2000-01-01 00:11:00    11
Freq: T, dtype: int32
</code></pre><p>每5分钟降采样</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ts.resample(<span class="string">'5min'</span>).sum()</div><div class="line"><span class="comment"># note: output changed (as the default changed from closed='right', label='right' to closed='left', label='left'</span></div></pre></td></tr></table></figure><pre><code>2000-01-01 00:00:00    10
2000-01-01 00:05:00    35
2000-01-01 00:10:00    21
Freq: 5T, dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.resample(<span class="string">'5min'</span>, closed=<span class="string">'left'</span>).sum()</div></pre></td></tr></table></figure><pre><code>2000-01-01 00:00:00    10
2000-01-01 00:05:00    35
2000-01-01 00:10:00    21
Freq: 5T, dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.resample(<span class="string">'5min'</span>, closed=<span class="string">'left'</span>, label=<span class="string">'left'</span>).sum()</div></pre></td></tr></table></figure><pre><code>2000-01-01 00:00:00    10
2000-01-01 00:05:00    35
2000-01-01 00:10:00    21
Freq: 5T, dtype: int32
</code></pre><p>加了个时间的偏移</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.resample(<span class="string">'5min'</span>, loffset=<span class="string">'-1s'</span>).sum()</div></pre></td></tr></table></figure><pre><code>1999-12-31 23:59:59    10
2000-01-01 00:04:59    35
2000-01-01 00:09:59    21
Freq: 5T, dtype: int32
</code></pre><h4 id="Open-High-Low-Close-OHLC-降采样"><a href="#Open-High-Low-Close-OHLC-降采样" class="headerlink" title="Open-High-Low-Close (OHLC) 降采样"></a>Open-High-Low-Close (OHLC) 降采样</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts</div></pre></td></tr></table></figure><pre><code>2000-01-01 00:00:00     0
2000-01-01 00:01:00     1
2000-01-01 00:02:00     2
2000-01-01 00:03:00     3
2000-01-01 00:04:00     4
2000-01-01 00:05:00     5
2000-01-01 00:06:00     6
2000-01-01 00:07:00     7
2000-01-01 00:08:00     8
2000-01-01 00:09:00     9
2000-01-01 00:10:00    10
2000-01-01 00:11:00    11
Freq: T, dtype: int32
</code></pre><p>以5分钟为单位</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ts.resample(<span class="string">'5min'</span>).ohlc()</div><div class="line"><span class="comment"># note: output changed because of changed defaults</span></div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>open</th><br><th>high</th><br><th>low</th><br><th>close</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000-01-01 00:00:00</th><br><td>0</td><br><td>4</td><br><td>0</td><br><td>4</td><br></tr><br><tr><br><th>2000-01-01 00:05:00</th><br><td>5</td><br><td>9</td><br><td>5</td><br><td>9</td><br></tr><br><tr><br><th>2000-01-01 00:10:00</th><br><td>10</td><br><td>11</td><br><td>10</td><br><td>11</td><br></tr><br><br></tbody><br></table><br></div><h4 id="通过GroupBy进行重采样"><a href="#通过GroupBy进行重采样" class="headerlink" title="通过GroupBy进行重采样"></a>通过GroupBy进行重采样</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rng = pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">100</span>, freq=<span class="string">'D'</span>)</div><div class="line">ts = Series(np.arange(<span class="number">100</span>), index=rng)</div><div class="line">ts.groupby(<span class="keyword">lambda</span> x: x.month).mean()</div></pre></td></tr></table></figure><pre><code>1    15
2    45
3    75
4    95
dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.groupby(<span class="keyword">lambda</span> x: x.weekday).mean()</div></pre></td></tr></table></figure><pre><code>0    47.5
1    48.5
2    49.5
3    50.5
4    51.5
5    49.0
6    50.0
dtype: float64
</code></pre><h3 id="升采样和插值"><a href="#升采样和插值" class="headerlink" title="升采样和插值"></a>升采样和插值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.random.randn(<span class="number">2</span>, <span class="number">4</span>),</div><div class="line">                  index=pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">2</span>, freq=<span class="string">'W-WED'</span>),</div><div class="line">                  columns=[<span class="string">'Colorado'</span>, <span class="string">'Texas'</span>, <span class="string">'New York'</span>, <span class="string">'Ohio'</span>])</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Colorado</th><br><th>Texas</th><br><th>New York</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000-01-05</th><br><td>0.360773</td><br><td>0.506429</td><br><td>1.166424</td><br><td>1.402336</td><br></tr><br><tr><br><th>2000-01-12</th><br><td>-0.587124</td><br><td>0.612993</td><br><td>-0.796000</td><br><td>-0.341138</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">df_daily = frame.resample(<span class="string">'D'</span>).mean()</div><div class="line">df_daily</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Colorado</th><br><th>Texas</th><br><th>New York</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000-01-05</th><br><td>0.360773</td><br><td>0.506429</td><br><td>1.166424</td><br><td>1.402336</td><br></tr><br><tr><br><th>2000-01-06</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2000-01-07</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2000-01-08</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2000-01-09</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2000-01-10</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2000-01-11</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2000-01-12</th><br><td>-0.587124</td><br><td>0.612993</td><br><td>-0.796000</td><br><td>-0.341138</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.resample(<span class="string">'D'</span>).ffill()</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Colorado</th><br><th>Texas</th><br><th>New York</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000-01-05</th><br><td>0.360773</td><br><td>0.506429</td><br><td>1.166424</td><br><td>1.402336</td><br></tr><br><tr><br><th>2000-01-06</th><br><td>0.360773</td><br><td>0.506429</td><br><td>1.166424</td><br><td>1.402336</td><br></tr><br><tr><br><th>2000-01-07</th><br><td>0.360773</td><br><td>0.506429</td><br><td>1.166424</td><br><td>1.402336</td><br></tr><br><tr><br><th>2000-01-08</th><br><td>0.360773</td><br><td>0.506429</td><br><td>1.166424</td><br><td>1.402336</td><br></tr><br><tr><br><th>2000-01-09</th><br><td>0.360773</td><br><td>0.506429</td><br><td>1.166424</td><br><td>1.402336</td><br></tr><br><tr><br><th>2000-01-10</th><br><td>0.360773</td><br><td>0.506429</td><br><td>1.166424</td><br><td>1.402336</td><br></tr><br><tr><br><th>2000-01-11</th><br><td>0.360773</td><br><td>0.506429</td><br><td>1.166424</td><br><td>1.402336</td><br></tr><br><tr><br><th>2000-01-12</th><br><td>-0.587124</td><br><td>0.612993</td><br><td>-0.796000</td><br><td>-0.341138</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.resample(<span class="string">'D'</span>).ffill(limit=<span class="number">2</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Colorado</th><br><th>Texas</th><br><th>New York</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000-01-05</th><br><td>0.360773</td><br><td>0.506429</td><br><td>1.166424</td><br><td>1.402336</td><br></tr><br><tr><br><th>2000-01-06</th><br><td>0.360773</td><br><td>0.506429</td><br><td>1.166424</td><br><td>1.402336</td><br></tr><br><tr><br><th>2000-01-07</th><br><td>0.360773</td><br><td>0.506429</td><br><td>1.166424</td><br><td>1.402336</td><br></tr><br><tr><br><th>2000-01-08</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2000-01-09</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2000-01-10</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2000-01-11</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2000-01-12</th><br><td>-0.587124</td><br><td>0.612993</td><br><td>-0.796000</td><br><td>-0.341138</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.resample(<span class="string">'W-THU'</span>).ffill()</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Colorado</th><br><th>Texas</th><br><th>New York</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000-01-06</th><br><td>0.360773</td><br><td>0.506429</td><br><td>1.166424</td><br><td>1.402336</td><br></tr><br><tr><br><th>2000-01-13</th><br><td>-0.587124</td><br><td>0.612993</td><br><td>-0.796000</td><br><td>-0.341138</td><br></tr><br><br></tbody><br></table><br></div><h3 id="通过时期进行重采样"><a href="#通过时期进行重采样" class="headerlink" title="通过时期进行重采样"></a>通过时期进行重采样</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.random.randn(<span class="number">24</span>, <span class="number">4</span>),</div><div class="line">                  index=pd.period_range(<span class="string">'1-2000'</span>, <span class="string">'12-2001'</span>, freq=<span class="string">'M'</span>),</div><div class="line">                  columns=[<span class="string">'Colorado'</span>, <span class="string">'Texas'</span>, <span class="string">'New York'</span>, <span class="string">'Ohio'</span>])</div><div class="line">frame[:<span class="number">5</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Colorado</th><br><th>Texas</th><br><th>New York</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000-01</th><br><td>-0.254340</td><br><td>0.401110</td><br><td>-0.931350</td><br><td>-0.872552</td><br></tr><br><tr><br><th>2000-02</th><br><td>0.390968</td><br><td>-0.815357</td><br><td>-1.656213</td><br><td>-2.251621</td><br></tr><br><tr><br><th>2000-03</th><br><td>0.206297</td><br><td>0.197394</td><br><td>0.927518</td><br><td>-0.657257</td><br></tr><br><tr><br><th>2000-04</th><br><td>-0.451709</td><br><td>0.908598</td><br><td>-0.187902</td><br><td>-0.498082</td><br></tr><br><tr><br><th>2000-05</th><br><td>-0.215150</td><br><td>-0.042141</td><br><td>-0.738733</td><br><td>2.499246</td><br></tr><br><br></tbody><br></table><br></div><p>以年为单位</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">annual_frame = frame.resample(<span class="string">'A-DEC'</span>).mean()</div><div class="line">annual_frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Colorado</th><br><th>Texas</th><br><th>New York</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000</th><br><td>-0.049383</td><br><td>0.037021</td><br><td>-0.272851</td><br><td>-0.140984</td><br></tr><br><tr><br><th>2001</th><br><td>-0.183766</td><br><td>-0.291993</td><br><td>0.340941</td><br><td>0.209276</td><br></tr><br><br></tbody><br></table><br></div><p>以季度为单位</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Q-DEC: Quarterly, year ending in December</span></div><div class="line">annual_frame.resample(<span class="string">'Q-DEC'</span>).ffill()</div><div class="line"><span class="comment"># note: output changed, default value changed from convention='end' to convention='start' + 'start' changed to span-like</span></div><div class="line"><span class="comment"># also the following cells</span></div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Colorado</th><br><th>Texas</th><br><th>New York</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000Q1</th><br><td>-0.049383</td><br><td>0.037021</td><br><td>-0.272851</td><br><td>-0.140984</td><br></tr><br><tr><br><th>2000Q2</th><br><td>-0.049383</td><br><td>0.037021</td><br><td>-0.272851</td><br><td>-0.140984</td><br></tr><br><tr><br><th>2000Q3</th><br><td>-0.049383</td><br><td>0.037021</td><br><td>-0.272851</td><br><td>-0.140984</td><br></tr><br><tr><br><th>2000Q4</th><br><td>-0.049383</td><br><td>0.037021</td><br><td>-0.272851</td><br><td>-0.140984</td><br></tr><br><tr><br><th>2001Q1</th><br><td>-0.183766</td><br><td>-0.291993</td><br><td>0.340941</td><br><td>0.209276</td><br></tr><br><tr><br><th>2001Q2</th><br><td>-0.183766</td><br><td>-0.291993</td><br><td>0.340941</td><br><td>0.209276</td><br></tr><br><tr><br><th>2001Q3</th><br><td>-0.183766</td><br><td>-0.291993</td><br><td>0.340941</td><br><td>0.209276</td><br></tr><br><tr><br><th>2001Q4</th><br><td>-0.183766</td><br><td>-0.291993</td><br><td>0.340941</td><br><td>0.209276</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">annual_frame.resample(<span class="string">'Q-DEC'</span>, fill_method=<span class="string">'ffill'</span>, convention=<span class="string">'start'</span>)</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:1: FutureWarning: fill_method is deprecated to .resample()
the new syntax is .resample(...).ffill()
  if __name__ == &apos;__main__&apos;:
</code></pre><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Colorado</th><br><th>Texas</th><br><th>New York</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000Q1</th><br><td>-0.049383</td><br><td>0.037021</td><br><td>-0.272851</td><br><td>-0.140984</td><br></tr><br><tr><br><th>2000Q2</th><br><td>-0.049383</td><br><td>0.037021</td><br><td>-0.272851</td><br><td>-0.140984</td><br></tr><br><tr><br><th>2000Q3</th><br><td>-0.049383</td><br><td>0.037021</td><br><td>-0.272851</td><br><td>-0.140984</td><br></tr><br><tr><br><th>2000Q4</th><br><td>-0.049383</td><br><td>0.037021</td><br><td>-0.272851</td><br><td>-0.140984</td><br></tr><br><tr><br><th>2001Q1</th><br><td>-0.183766</td><br><td>-0.291993</td><br><td>0.340941</td><br><td>0.209276</td><br></tr><br><tr><br><th>2001Q2</th><br><td>-0.183766</td><br><td>-0.291993</td><br><td>0.340941</td><br><td>0.209276</td><br></tr><br><tr><br><th>2001Q3</th><br><td>-0.183766</td><br><td>-0.291993</td><br><td>0.340941</td><br><td>0.209276</td><br></tr><br><tr><br><th>2001Q4</th><br><td>-0.183766</td><br><td>-0.291993</td><br><td>0.340941</td><br><td>0.209276</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">annual_frame.resample(<span class="string">'Q-MAR'</span>, fill_method=<span class="string">'ffill'</span>)</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:1: FutureWarning: fill_method is deprecated to .resample()
the new syntax is .resample(...).ffill()
  if __name__ == &apos;__main__&apos;:
</code></pre><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Colorado</th><br><th>Texas</th><br><th>New York</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000Q4</th><br><td>-0.049383</td><br><td>0.037021</td><br><td>-0.272851</td><br><td>-0.140984</td><br></tr><br><tr><br><th>2001Q1</th><br><td>-0.049383</td><br><td>0.037021</td><br><td>-0.272851</td><br><td>-0.140984</td><br></tr><br><tr><br><th>2001Q2</th><br><td>-0.049383</td><br><td>0.037021</td><br><td>-0.272851</td><br><td>-0.140984</td><br></tr><br><tr><br><th>2001Q3</th><br><td>-0.049383</td><br><td>0.037021</td><br><td>-0.272851</td><br><td>-0.140984</td><br></tr><br><tr><br><th>2001Q4</th><br><td>-0.183766</td><br><td>-0.291993</td><br><td>0.340941</td><br><td>0.209276</td><br></tr><br><tr><br><th>2002Q1</th><br><td>-0.183766</td><br><td>-0.291993</td><br><td>0.340941</td><br><td>0.209276</td><br></tr><br><tr><br><th>2002Q2</th><br><td>-0.183766</td><br><td>-0.291993</td><br><td>0.340941</td><br><td>0.209276</td><br></tr><br><tr><br><th>2002Q3</th><br><td>-0.183766</td><br><td>-0.291993</td><br><td>0.340941</td><br><td>0.209276</td><br></tr><br><br></tbody><br></table><br></div><h2 id="时间序列绘图"><a href="#时间序列绘图" class="headerlink" title="时间序列绘图"></a>时间序列绘图</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">close_px_all = pd.read_csv(<span class="string">'ch09/stock_px.csv'</span>, parse_dates=<span class="keyword">True</span>, index_col=<span class="number">0</span>)</div><div class="line">close_px = close_px_all[[<span class="string">'AAPL'</span>, <span class="string">'MSFT'</span>, <span class="string">'XOM'</span>]]</div><div class="line">close_px = close_px.resample(<span class="string">'B'</span>, fill_method=<span class="string">'ffill'</span>)</div><div class="line">close_px.info()</div></pre></td></tr></table></figure><pre><code>&lt;class &apos;pandas.core.frame.DataFrame&apos;&gt;
DatetimeIndex: 2292 entries, 2003-01-02 to 2011-10-14
Freq: B
Data columns (total 3 columns):
AAPL    2292 non-null float64
MSFT    2292 non-null float64
XOM     2292 non-null float64
dtypes: float64(3)
memory usage: 71.6 KB


C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:3: FutureWarning: fill_method is deprecated to .resample()
the new syntax is .resample(...).ffill()
  app.launch_new_instance()
</code></pre><p>按年绘图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">close_px[<span class="string">'AAPL'</span>].plot()</div></pre></td></tr></table></figure><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1fb1f85a080&gt;
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_270_1.png" alt="png"></p><p>按月绘图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">close_px.ix[<span class="string">'2009'</span>].plot()</div></pre></td></tr></table></figure><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1fb20c4d550&gt;
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_272_1.png" alt="png"></p><p>按天绘图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">close_px[<span class="string">'AAPL'</span>].ix[<span class="string">'01-2011'</span>:<span class="string">'03-2011'</span>].plot()</div></pre></td></tr></table></figure><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1fb21235668&gt;
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_274_1.png" alt="png"></p><p>按季度绘图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">appl_q = close_px[<span class="string">'AAPL'</span>].resample(<span class="string">'Q-DEC'</span>, fill_method=<span class="string">'ffill'</span>)</div><div class="line">appl_q.ix[<span class="string">'2009'</span>:].plot()</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:1: FutureWarning: fill_method is deprecated to .resample()
the new syntax is .resample(...).ffill()
  if __name__ == &apos;__main__&apos;:





&lt;matplotlib.axes._subplots.AxesSubplot at 0x1fb21346c50&gt;
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_276_2.png" alt="png"></p><h2 id="移动窗口函数"><a href="#移动窗口函数" class="headerlink" title="移动窗口函数"></a>移动窗口函数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">close_px = close_px.asfreq(<span class="string">'B'</span>).fillna(method=<span class="string">'ffill'</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">close_px.AAPL.plot()</div><div class="line">pd.rolling_mean(close_px.AAPL, <span class="number">250</span>).plot()</div></pre></td></tr></table></figure><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1fb213b95f8&gt;



C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:2: FutureWarning: pd.rolling_mean is deprecated for Series and will be removed in a future version, replace with 
    Series.rolling(window=250,center=False).mean()
  from ipykernel import kernelapp as app





&lt;matplotlib.axes._subplots.AxesSubplot at 0x1fb213b95f8&gt;
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_279_3.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plt.figure()</div></pre></td></tr></table></figure><pre><code>&lt;matplotlib.figure.Figure at 0x1fb212fb550&gt;




&lt;matplotlib.figure.Figure at 0x1fb212fb550&gt;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">appl_std250 = pd.rolling_std(close_px.AAPL, <span class="number">250</span>, min_periods=<span class="number">10</span>)</div><div class="line">appl_std250[<span class="number">5</span>:<span class="number">12</span>]</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:1: FutureWarning: pd.rolling_std is deprecated for Series and will be removed in a future version, replace with 
    Series.rolling(window=250,min_periods=10,center=False).std()
  if __name__ == &apos;__main__&apos;:





2003-01-09         NaN
2003-01-10         NaN
2003-01-13         NaN
2003-01-14         NaN
2003-01-15    0.077496
2003-01-16    0.074760
2003-01-17    0.112368
Freq: B, Name: AAPL, dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">appl_std250.plot()</div></pre></td></tr></table></figure><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1fb21466ba8&gt;
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_282_1.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Define expanding mean in terms of rolling_mean</span></div><div class="line">expanding_mean = <span class="keyword">lambda</span> x: rolling_mean(x, len(x), min_periods=<span class="number">1</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.rolling_mean(close_px, <span class="number">60</span>).plot(logy=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:1: FutureWarning: pd.rolling_mean is deprecated for DataFrame and will be removed in a future version, replace with 
    DataFrame.rolling(window=60,center=False).mean()
  if __name__ == &apos;__main__&apos;:





&lt;matplotlib.axes._subplots.AxesSubplot at 0x1fb21571208&gt;
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_284_2.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plt.close(<span class="string">'all'</span>)</div></pre></td></tr></table></figure><h3 id="指数加权函数"><a href="#指数加权函数" class="headerlink" title="指数加权函数"></a>指数加权函数</h3><p>更好的拟合</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">fig, axes = plt.subplots(nrows=<span class="number">2</span>, ncols=<span class="number">1</span>, sharex=<span class="keyword">True</span>, sharey=<span class="keyword">True</span>,</div><div class="line">                         figsize=(<span class="number">12</span>, <span class="number">7</span>))</div><div class="line"></div><div class="line">aapl_px = close_px.AAPL[<span class="string">'2005'</span>:<span class="string">'2009'</span>]</div><div class="line"></div><div class="line">ma60 = pd.rolling_mean(aapl_px, <span class="number">60</span>, min_periods=<span class="number">50</span>)</div><div class="line">ewma60 = pd.ewma(aapl_px, span=<span class="number">60</span>)</div><div class="line"></div><div class="line">aapl_px.plot(style=<span class="string">'k-'</span>, ax=axes[<span class="number">0</span>])</div><div class="line">ma60.plot(style=<span class="string">'k--'</span>, ax=axes[<span class="number">0</span>])</div><div class="line">aapl_px.plot(style=<span class="string">'k-'</span>, ax=axes[<span class="number">1</span>])</div><div class="line">ewma60.plot(style=<span class="string">'k--'</span>, ax=axes[<span class="number">1</span>])</div><div class="line">axes[<span class="number">0</span>].set_title(<span class="string">'Simple MA'</span>)</div><div class="line">axes[<span class="number">1</span>].set_title(<span class="string">'Exponentially-weighted MA'</span>)</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:6: FutureWarning: pd.rolling_mean is deprecated for Series and will be removed in a future version, replace with 
    Series.rolling(window=60,min_periods=50,center=False).mean()
C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:7: FutureWarning: pd.ewm_mean is deprecated for Series and will be removed in a future version, replace with 
    Series.ewm(span=60,ignore_na=False,min_periods=0,adjust=True).mean()





&lt;matplotlib.axes._subplots.AxesSubplot at 0x1fb21983b70&gt;






&lt;matplotlib.axes._subplots.AxesSubplot at 0x1fb21983b70&gt;






&lt;matplotlib.axes._subplots.AxesSubplot at 0x1fb219c9a20&gt;






&lt;matplotlib.axes._subplots.AxesSubplot at 0x1fb219c9a20&gt;






&lt;matplotlib.text.Text at 0x1fb219b10b8&gt;






&lt;matplotlib.text.Text at 0x1fb219efcc0&gt;
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_288_7.png" alt="png"></p><h3 id="二元移动窗口函数"><a href="#二元移动窗口函数" class="headerlink" title="二元移动窗口函数"></a>二元移动窗口函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">close_px</div><div class="line">spx_px = close_px_all[<span class="string">'SPX'</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>AAPL</th><br><th>MSFT</th><br><th>XOM</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2003-01-02</th><br><td>7.40</td><br><td>21.11</td><br><td>29.22</td><br></tr><br><tr><br><th>2003-01-03</th><br><td>7.45</td><br><td>21.14</td><br><td>29.24</td><br></tr><br><tr><br><th>2003-01-06</th><br><td>7.45</td><br><td>21.52</td><br><td>29.96</td><br></tr><br><tr><br><th>2003-01-07</th><br><td>7.43</td><br><td>21.93</td><br><td>28.95</td><br></tr><br><tr><br><th>2003-01-08</th><br><td>7.28</td><br><td>21.31</td><br><td>28.83</td><br></tr><br><tr><br><th>2003-01-09</th><br><td>7.34</td><br><td>21.93</td><br><td>29.44</td><br></tr><br><tr><br><th>…</th><br><td>…</td><br><td>…</td><br><td>…</td><br></tr><br><tr><br><th>2011-10-07</th><br><td>369.80</td><br><td>26.25</td><br><td>73.56</td><br></tr><br><tr><br><th>2011-10-10</th><br><td>388.81</td><br><td>26.94</td><br><td>76.28</td><br></tr><br><tr><br><th>2011-10-11</th><br><td>400.29</td><br><td>27.00</td><br><td>76.27</td><br></tr><br><tr><br><th>2011-10-12</th><br><td>402.19</td><br><td>26.96</td><br><td>77.16</td><br></tr><br><tr><br><th>2011-10-13</th><br><td>408.43</td><br><td>27.18</td><br><td>76.37</td><br></tr><br><tr><br><th>2011-10-14</th><br><td>422.00</td><br><td>27.27</td><br><td>78.11</td><br></tr><br><br></tbody><br></table><br><p>2292 rows × 3 columns</p><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">spx_rets = spx_px / spx_px.shift(<span class="number">1</span>) - <span class="number">1</span></div><div class="line">returns = close_px.pct_change()</div><div class="line">corr = pd.rolling_corr(returns.AAPL, spx_rets, <span class="number">125</span>, min_periods=<span class="number">100</span>)</div><div class="line">corr.plot()</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:3: FutureWarning: pd.rolling_corr is deprecated for Series and will be removed in a future version, replace with 
    Series.rolling(window=125,min_periods=100).corr(other=&lt;Series&gt;)
  app.launch_new_instance()





&lt;matplotlib.axes._subplots.AxesSubplot at 0x1fb21a93438&gt;
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_291_2.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">corr = pd.rolling_corr(returns, spx_rets, <span class="number">125</span>, min_periods=<span class="number">100</span>)</div><div class="line">corr.plot()</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:1: FutureWarning: pd.rolling_corr is deprecated for DataFrame and will be removed in a future version, replace with 
    DataFrame.rolling(window=125,min_periods=100).corr(other=&lt;Series&gt;)
  if __name__ == &apos;__main__&apos;:





&lt;matplotlib.axes._subplots.AxesSubplot at 0x1fb22b21438&gt;
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_292_2.png" alt="png"></p><h3 id="用户自定义移动窗口函数"><a href="#用户自定义移动窗口函数" class="headerlink" title="用户自定义移动窗口函数"></a>用户自定义移动窗口函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> percentileofscore</div><div class="line">score_at_2percent = <span class="keyword">lambda</span> x: percentileofscore(x, <span class="number">0.02</span>)</div><div class="line">result = pd.rolling_apply(returns.AAPL, <span class="number">250</span>, score_at_2percent)</div><div class="line">result.plot()</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:3: FutureWarning: pd.rolling_apply is deprecated for Series and will be removed in a future version, replace with 
    Series.rolling(window=250,center=False).apply(kwargs=&lt;dict&gt;,args=&lt;tuple&gt;,func=&lt;function&gt;)
  app.launch_new_instance()





&lt;matplotlib.axes._subplots.AxesSubplot at 0x1fb3dbdd2e8&gt;
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch10/output_294_2.png" alt="png"></p><h2 id="性能和内存使用方面的注意事项"><a href="#性能和内存使用方面的注意事项" class="headerlink" title="性能和内存使用方面的注意事项"></a>性能和内存使用方面的注意事项</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rng = pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">10000000</span>, freq=<span class="string">'10ms'</span>)</div><div class="line">ts = Series(np.random.randn(len(rng)), index=rng)</div><div class="line">ts</div></pre></td></tr></table></figure><pre><code>2000-01-01 00:00:00.000   -0.428577
2000-01-01 00:00:00.010    1.650203
2000-01-01 00:00:00.020   -0.064777
2000-01-01 00:00:00.030   -0.219433
2000-01-01 00:00:00.040    1.907433
2000-01-01 00:00:00.050    0.103347
                             ...   
2000-01-02 03:46:39.940    0.989446
2000-01-02 03:46:39.950    2.333137
2000-01-02 03:46:39.960    0.354455
2000-01-02 03:46:39.970    0.353224
2000-01-02 03:46:39.980   -0.862868
2000-01-02 03:46:39.990    2.007468
Freq: 10L, dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ts.resample(<span class="string">'15min'</span>).ohlc().info()</div></pre></td></tr></table></figure><pre><code>&lt;class &apos;pandas.core.frame.DataFrame&apos;&gt;
DatetimeIndex: 11112 entries, 2000-01-01 00:00:00 to 2000-04-25 17:45:00
Freq: 15T
Data columns (total 4 columns):
open     11112 non-null float64
high     11112 non-null float64
low      11112 non-null float64
close    11112 non-null float64
dtypes: float64(4)
memory usage: 434.1 KB
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">%timeit ts.resample(<span class="string">'15min'</span>).ohlc()</div></pre></td></tr></table></figure><pre><code>10 loops, best of 3: 123 ms per loop
</code></pre><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rng = pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">10000000</span>, freq=<span class="string">'1s'</span>)</div><div class="line">ts = Series(np.random.randn(len(rng)), index=rng)</div><div class="line">%timeit ts.resample(<span class="string">'15s'</span>).ohlc()</div></pre></td></tr></table></figure><pre><code>1 loop, best of 3: 192 ms per loop
</code></pre><p>​</p></div><div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/python/" rel="tag"># python</a> <a href="/tags/pandas/" rel="tag"># pandas</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/03/08/cs231n-Assignment-1-two-layer-net/" rel="next" title="cs231n Assignment#1 two layer net"><i class="fa fa-chevron-left"></i> cs231n Assignment#1 two layer net</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2017/03/08/GFW-Break/" rel="prev" title="GFW Break">GFW Break <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"><div class="addthis_inline_share_toolbox"><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-58f731508143741d" async></script></div></div></div></div><div class="comments" id="comments"><div id="hypercomments_widget"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview">Overview</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Ewan Li"><p class="site-author-name" itemprop="name">Ewan Li</p><p class="site-description motion-element" itemprop="description">Ewan's IT Blog</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">68</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-tags"><a href="/tags"><span class="site-state-item-count">40</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ewanlee" target="_blank" title="Github"><i class="fa fa-fw fa-globe"></i> Github </a></span><span class="links-of-author-item"><a href="http://weibo.com/3946248928/profile?topnav=1&wvr=6" target="_blank" title="Weibo"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#时间序列"><span class="nav-number">1.</span> <span class="nav-text">时间序列</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#日期和时间数据类型及工具"><span class="nav-number">1.1.</span> <span class="nav-text">日期和时间数据类型及工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串和datatime的相互转换"><span class="nav-number">1.1.1.</span> <span class="nav-text">字符串和datatime的相互转换</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#时间序列基础"><span class="nav-number">1.2.</span> <span class="nav-text">时间序列基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#索引、选取、子集构造"><span class="nav-number">1.2.1.</span> <span class="nav-text">索引、选取、子集构造</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#带有重复索引的时间序列"><span class="nav-number">1.2.2.</span> <span class="nav-text">带有重复索引的时间序列</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#日期的范围、频率以及移动"><span class="nav-number">1.3.</span> <span class="nav-text">日期的范围、频率以及移动</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#生成日期范围"><span class="nav-number">1.3.1.</span> <span class="nav-text">生成日期范围</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#频率和日期偏移量"><span class="nav-number">1.3.2.</span> <span class="nav-text">频率和日期偏移量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Week-of-month-dates-（WOM日期）"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">Week of month dates （WOM日期）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#移动（超前或滞后）数据"><span class="nav-number">1.3.3.</span> <span class="nav-text">移动（超前或滞后）数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#通过偏移量对日期进行位移"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">通过偏移量对日期进行位移</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#时区处理"><span class="nav-number">1.4.</span> <span class="nav-text">时区处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#本地化和转换"><span class="nav-number">1.4.1.</span> <span class="nav-text">本地化和转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#操作时区意识型TimeStamp对象"><span class="nav-number">1.4.2.</span> <span class="nav-text">操作时区意识型TimeStamp对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#不同时区之间的运算"><span class="nav-number">1.4.3.</span> <span class="nav-text">不同时区之间的运算</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#时期及其算术运算"><span class="nav-number">1.5.</span> <span class="nav-text">时期及其算术运算</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#时区的频率转换"><span class="nav-number">1.5.1.</span> <span class="nav-text">时区的频率转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#按季度计算的时间频率"><span class="nav-number">1.5.2.</span> <span class="nav-text">按季度计算的时间频率</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#将时间戳转化为时期（以及其逆过程）"><span class="nav-number">1.5.3.</span> <span class="nav-text">将时间戳转化为时期（以及其逆过程）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通过数组创建PeriodIndex"><span class="nav-number">1.5.4.</span> <span class="nav-text">通过数组创建PeriodIndex</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重采样以及频率转换"><span class="nav-number">1.6.</span> <span class="nav-text">重采样以及频率转换</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#降采样"><span class="nav-number">1.6.1.</span> <span class="nav-text">降采样</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Open-High-Low-Close-OHLC-降采样"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">Open-High-Low-Close (OHLC) 降采样</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#通过GroupBy进行重采样"><span class="nav-number">1.6.1.2.</span> <span class="nav-text">通过GroupBy进行重采样</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#升采样和插值"><span class="nav-number">1.6.2.</span> <span class="nav-text">升采样和插值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通过时期进行重采样"><span class="nav-number">1.6.3.</span> <span class="nav-text">通过时期进行重采样</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#时间序列绘图"><span class="nav-number">1.7.</span> <span class="nav-text">时间序列绘图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#移动窗口函数"><span class="nav-number">1.8.</span> <span class="nav-text">移动窗口函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#指数加权函数"><span class="nav-number">1.8.1.</span> <span class="nav-text">指数加权函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#二元移动窗口函数"><span class="nav-number">1.8.2.</span> <span class="nav-text">二元移动窗口函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用户自定义移动窗口函数"><span class="nav-number">1.8.3.</span> <span class="nav-text">用户自定义移动窗口函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#性能和内存使用方面的注意事项"><span class="nav-number">1.9.</span> <span class="nav-text">性能和内存使用方面的注意事项</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2017</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Ewan Li</span></div><div class="powered-by">Powered by <a class="theme-link" href="https://hexo.io">Hexo</a></div><div class="theme-info">Theme - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user">本站访客数</i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span>人次</span> <span class="site-pv"><i class="fa fa-eye">本站总访问量</i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script><script type="text/javascript">_hcwp=window._hcwp||[],_hcwp.push({widget:"Bloggerstream",widget_id:89825,selector:".hc-comment-count",label:"{%COUNT%}"}),_hcwp.push({widget:"Stream",widget_id:89825,xid:"2017/03/08/python-data-analysis-learning-note-Ch10/"}),function(){if(!("HC_LOAD_INIT"in window)){HC_LOAD_INIT=!0;var t=(navigator.language||navigator.systemLanguage||navigator.userLanguage||"en").substr(0,2).toLowerCase(),e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https":"http")+"://w.hypercomments.com/widget/hc/89825/"+t+"/widget.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(e,a.nextSibling)}}()</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path,searchFunc=function(e,t,a){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var r=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),c=document.getElementById(t),n=document.getElementById(a);c.addEventListener("input",function(){var e=0,t='<ul class="search-result-list">',a=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length>1&&r.forEach(function(r){var c=!1,n=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),o=decodeURIComponent(r.url),i=-1,l=-1,p=-1;if(""!=n&&a.forEach(function(e,t){i=n.indexOf(e),l=s.indexOf(e),(i>=0||l>=0)&&(c=!0,0==t&&(p=l))}),c){e+=1,t+="<li><a href='"+o+"' class='search-result-title'>"+n+"</a>";var h=r.content.trim().replace(/<[^>]+>/g,"");if(p>=0){var u=p-20,d=p+80;u<0&&(u=0),0==u&&(d=50),d>h.length&&(d=h.length);var f=h.substring(u,d);a.forEach(function(e){var t=new RegExp(e,"gi");f=f.replace(t,'<b class="search-keyword">'+e+"</b>")}),t+='<p class="search-result">'+f+"...</p>"}t+="</li>"}}),t+="</ul>",0==e&&(t='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==a&&(t='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),n.innerHTML=t}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("e27VKX5tTklQLCtF7iNMmhcA-gzGzoHsz","nnQn2znNgXXEdK7W2bVJ3bfK")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var r=e[i],s=r.get("url"),l=r.get("time"),c=document.getElementById(s);$(c).find(t).text(l)}for(var i=0;i<n.length;i++){var s=n[i],c=document.getElementById(s),u=$(c).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script></body></html>