<!doctype html><html class="theme-next mist use-motion" lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css"><meta name="keywords" content="python,pandas,"><link rel="alternate" href="/atom.xml" title="Abracdabra" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0"><meta name="description" content="Numpy高级应用123456from __future__ import divisionfrom numpy.random import randnfrom pandas import Seriesimport numpy as npnp.set_printoptions(precision=4)import sys12from IPython.core.interactiveshell im"><meta property="og:type" content="article"><meta property="og:title" content="python data analysis learning note Ch12"><meta property="og:url" content="http://yoursite.com/2017/03/09/python-data-analysis-learning-note-Ch12/index.html"><meta property="og:site_name" content="Abracdabra"><meta property="og:description" content="Numpy高级应用123456from __future__ import divisionfrom numpy.random import randnfrom pandas import Seriesimport numpy as npnp.set_printoptions(precision=4)import sys12from IPython.core.interactiveshell im"><meta property="og:updated_time" content="2017-03-09T06:03:38.128Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="python data analysis learning note Ch12"><meta name="twitter:description" content="Numpy高级应用123456from __future__ import divisionfrom numpy.random import randnfrom pandas import Seriesimport numpy as npnp.set_printoptions(precision=4)import sys12from IPython.core.interactiveshell im"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://yoursite.com/2017/03/09/python-data-analysis-learning-note-Ch12/"><title>python data analysis learning note Ch12 | Abracdabra</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?dc405a79ad500922134d14cdf288f646";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Abracdabra</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Do it yourself</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>Categories</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>About</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>Tags</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>Sitemap</a></li><li class="menu-item menu-item-commonweal"><a href="/404.html" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div><span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/09/python-data-analysis-learning-note-Ch12/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracdabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracdabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline">python data analysis learning note Ch12</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-09T14:02:20+08:00">2017-03-09 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/03/09/python-data-analysis-learning-note-Ch12/#comments" itemprop="discussionUrl"><span class="post-comments-count ds-thread-count" data-thread-key="2017/03/09/python-data-analysis-learning-note-Ch12/" itemprop="commentCount"></span> </a></span><span id="/2017/03/09/python-data-analysis-learning-note-Ch12/" class="leancloud_visitors" data-flag-title="python data analysis learning note Ch12"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="Numpy高级应用"><a href="#Numpy高级应用" class="headerlink" title="Numpy高级应用"></a>Numpy高级应用</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line">np.set_printoptions(precision=<span class="number">4</span>)</div><div class="line"><span class="keyword">import</span> sys</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</div><div class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></div></pre></td></tr></table></figure><h2 id="ndarray对象的内部机制"><a href="#ndarray对象的内部机制" class="headerlink" title="ndarray对象的内部机制"></a>ndarray对象的内部机制</h2><h3 id="NumPy-数据类型体系"><a href="#NumPy-数据类型体系" class="headerlink" title="NumPy 数据类型体系"></a>NumPy 数据类型体系</h3><p>检测类型是否是某种类型的子类</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ints = np.ones(<span class="number">10</span>, dtype=np.uint16)</div><div class="line">floats = np.ones(<span class="number">10</span>, dtype=np.float32)</div><div class="line">np.issubdtype(ints.dtype, np.integer)</div><div class="line">np.issubdtype(floats.dtype, np.floating)</div></pre></td></tr></table></figure><pre><code>True






True
</code></pre><p>输出某种类型的所有父类</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.float64.mro()</div></pre></td></tr></table></figure><pre><code>[numpy.float64,
 numpy.floating,
 numpy.inexact,
 numpy.number,
 numpy.generic,
 float,
 object]
</code></pre><h2 id="高级数组操作"><a href="#高级数组操作" class="headerlink" title="高级数组操作"></a>高级数组操作</h2><h3 id="数组重塑"><a href="#数组重塑" class="headerlink" title="数组重塑"></a>数组重塑</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">8</span>)</div><div class="line">arr</div><div class="line">arr.reshape((<span class="number">4</span>, <span class="number">2</span>))</div></pre></td></tr></table></figure><pre><code>array([0, 1, 2, 3, 4, 5, 6, 7])






array([[0, 1],
       [2, 3],
       [4, 5],
       [6, 7]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr.reshape((<span class="number">4</span>, <span class="number">2</span>)).reshape((<span class="number">2</span>, <span class="number">4</span>))</div></pre></td></tr></table></figure><pre><code>array([[0, 1, 2, 3],
       [4, 5, 6, 7]])
</code></pre><p>-1代表自动选择合适的维度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">15</span>)</div><div class="line">arr.reshape((<span class="number">5</span>, <span class="number">-1</span>))</div></pre></td></tr></table></figure><pre><code>array([[ 0,  1,  2],
       [ 3,  4,  5],
       [ 6,  7,  8],
       [ 9, 10, 11],
       [12, 13, 14]])
</code></pre><p>用其他数组的shape进行重塑</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">other_arr = np.ones((<span class="number">3</span>, <span class="number">5</span>))</div><div class="line">other_arr.shape</div><div class="line">arr.reshape(other_arr.shape)</div></pre></td></tr></table></figure><pre><code>(3, 5)






array([[ 0,  1,  2,  3,  4],
       [ 5,  6,  7,  8,  9],
       [10, 11, 12, 13, 14]])
</code></pre><p>拉直</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">15</span>).reshape((<span class="number">5</span>, <span class="number">3</span>))</div><div class="line">arr</div><div class="line">arr.ravel()</div></pre></td></tr></table></figure><pre><code>array([[ 0,  1,  2],
       [ 3,  4,  5],
       [ 6,  7,  8],
       [ 9, 10, 11],
       [12, 13, 14]])






array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14])
</code></pre><p>会产生一个副本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr.flatten()</div></pre></td></tr></table></figure><pre><code>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14])
</code></pre><h3 id="C-vs-Fortran-顺序"><a href="#C-vs-Fortran-顺序" class="headerlink" title="C vs. Fortran 顺序"></a>C vs. Fortran 顺序</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>, <span class="number">4</span>))</div><div class="line">arr</div><div class="line">arr.ravel()</div><div class="line">arr.ravel(<span class="string">'F'</span>)</div></pre></td></tr></table></figure><pre><code>array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])






array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11])






array([ 0,  4,  8,  1,  5,  9,  2,  6, 10,  3,  7, 11])
</code></pre><h3 id="数组的合并以及拆分"><a href="#数组的合并以及拆分" class="headerlink" title="数组的合并以及拆分"></a>数组的合并以及拆分</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr1 = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]])</div><div class="line">arr2 = np.array([[<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>], [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]])</div><div class="line">np.concatenate([arr1, arr2], axis=<span class="number">0</span>)</div><div class="line">np.concatenate([arr1, arr2], axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><pre><code>array([[ 1,  2,  3],
       [ 4,  5,  6],
       [ 7,  8,  9],
       [10, 11, 12]])






array([[ 1,  2,  3,  7,  8,  9],
       [ 4,  5,  6, 10, 11, 12]])
</code></pre><p>更方便的方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">np.vstack((arr1, arr2))</div><div class="line">np.hstack((arr1, arr2))</div></pre></td></tr></table></figure><pre><code>array([[ 1,  2,  3],
       [ 4,  5,  6],
       [ 7,  8,  9],
       [10, 11, 12]])






array([[ 1,  2,  3,  7,  8,  9],
       [ 4,  5,  6, 10, 11, 12]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line">arr = randn(<span class="number">5</span>, <span class="number">2</span>)</div><div class="line">arr</div><div class="line">first, second, third = np.split(arr, [<span class="number">1</span>, <span class="number">3</span>])</div><div class="line">first</div><div class="line">second</div><div class="line">third</div></pre></td></tr></table></figure><pre><code>array([[ 0.9659,  1.3079],
       [-1.7632,  0.0904],
       [-0.6033,  0.2266],
       [-0.4417, -1.8609],
       [-1.2463, -0.6249]])






array([[ 0.9659,  1.3079]])






array([[-1.7632,  0.0904],
       [-0.6033,  0.2266]])






array([[-0.4417, -1.8609],
       [-1.2463, -0.6249]])
</code></pre><h4 id="堆叠辅助类"><a href="#堆叠辅助类" class="headerlink" title="堆叠辅助类"></a>堆叠辅助类</h4><p>更…简洁…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">6</span>)</div><div class="line">arr1 = arr.reshape((<span class="number">3</span>, <span class="number">2</span>))</div><div class="line">arr2 = randn(<span class="number">3</span>, <span class="number">2</span>)</div><div class="line">np.r_[arr1, arr2]</div><div class="line">np.c_[np.r_[arr1, arr2], arr]</div></pre></td></tr></table></figure><pre><code>array([[ 0.    ,  1.    ],
       [ 2.    ,  3.    ],
       [ 4.    ,  5.    ],
       [ 0.0376,  1.8236],
       [ 0.9025, -0.053 ],
       [-0.6849,  1.6728]])






array([[ 0.    ,  1.    ,  0.    ],
       [ 2.    ,  3.    ,  1.    ],
       [ 4.    ,  5.    ,  2.    ],
       [ 0.0376,  1.8236,  3.    ],
       [ 0.9025, -0.053 ,  4.    ],
       [-0.6849,  1.6728,  5.    ]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.c_[<span class="number">1</span>:<span class="number">6</span>, <span class="number">-10</span>:<span class="number">-5</span>]</div></pre></td></tr></table></figure><pre><code>array([[  1, -10],
       [  2,  -9],
       [  3,  -8],
       [  4,  -7],
       [  5,  -6]])
</code></pre><h3 id="元素的重复操作-tile-and-repeat"><a href="#元素的重复操作-tile-and-repeat" class="headerlink" title="元素的重复操作: tile and repeat"></a>元素的重复操作: tile and repeat</h3><p>元素级重复</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">3</span>)</div><div class="line">arr.repeat(<span class="number">3</span>)</div></pre></td></tr></table></figure><pre><code>array([0, 0, 0, 1, 1, 1, 2, 2, 2])
</code></pre><p>指定重复次数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr.repeat([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</div></pre></td></tr></table></figure><pre><code>array([0, 0, 1, 1, 1, 2, 2, 2, 2])
</code></pre><p>多维数组需要指定<code>axis</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">2</span>, <span class="number">2</span>)</div><div class="line">arr</div><div class="line">arr.repeat(<span class="number">2</span>, axis=<span class="number">0</span>)</div></pre></td></tr></table></figure><pre><code>array([[-0.4628,  1.1142],
       [ 0.3637,  0.4341]])






array([[-0.4628,  1.1142],
       [-0.4628,  1.1142],
       [ 0.3637,  0.4341],
       [ 0.3637,  0.4341]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr.repeat([<span class="number">2</span>, <span class="number">3</span>], axis=<span class="number">0</span>)</div><div class="line">arr.repeat([<span class="number">2</span>, <span class="number">3</span>], axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><pre><code>array([[-0.4628,  1.1142],
       [-0.4628,  1.1142],
       [ 0.3637,  0.4341],
       [ 0.3637,  0.4341],
       [ 0.3637,  0.4341]])






array([[-0.4628, -0.4628,  1.1142,  1.1142,  1.1142],
       [ 0.3637,  0.3637,  0.4341,  0.4341,  0.4341]])
</code></pre><p>块级重复</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr</div><div class="line">np.tile(arr, <span class="number">2</span>)</div></pre></td></tr></table></figure><pre><code>array([[-0.4628,  1.1142],
       [ 0.3637,  0.4341]])






array([[-0.4628,  1.1142, -0.4628,  1.1142],
       [ 0.3637,  0.4341,  0.3637,  0.4341]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr</div><div class="line">np.tile(arr, (<span class="number">2</span>, <span class="number">1</span>))</div><div class="line">np.tile(arr, (<span class="number">3</span>, <span class="number">2</span>))</div></pre></td></tr></table></figure><pre><code>array([[-0.4628,  1.1142],
       [ 0.3637,  0.4341]])






array([[-0.4628,  1.1142],
       [ 0.3637,  0.4341],
       [-0.4628,  1.1142],
       [ 0.3637,  0.4341]])






array([[-0.4628,  1.1142, -0.4628,  1.1142],
       [ 0.3637,  0.4341,  0.3637,  0.4341],
       [-0.4628,  1.1142, -0.4628,  1.1142],
       [ 0.3637,  0.4341,  0.3637,  0.4341],
       [-0.4628,  1.1142, -0.4628,  1.1142],
       [ 0.3637,  0.4341,  0.3637,  0.4341]])
</code></pre><h3 id="花式索引的等价函数-take-and-put"><a href="#花式索引的等价函数-take-and-put" class="headerlink" title="花式索引的等价函数: take and put"></a>花式索引的等价函数: take and put</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">10</span>) * <span class="number">100</span></div><div class="line">inds = [<span class="number">7</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>]</div><div class="line">arr[inds]</div></pre></td></tr></table></figure><pre><code>array([700, 100, 200, 600])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">arr.take(inds)</div><div class="line">arr.put(inds, <span class="number">42</span>)</div><div class="line">arr</div><div class="line">arr.put(inds, [<span class="number">40</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>])</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([700, 100, 200, 600])






array([  0,  42,  42, 300, 400, 500,  42,  42, 800, 900])






array([  0,  41,  42, 300, 400, 500,  43,  40, 800, 900])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">inds = [<span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>]</div><div class="line">arr = randn(<span class="number">2</span>, <span class="number">4</span>)</div><div class="line">arr</div><div class="line">arr.take(inds, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><pre><code>array([[ 0.2772, -1.3059, -1.4607, -0.4856],
       [ 1.5585, -0.4521, -1.6259, -1.6644]])






array([[-1.4607,  0.2772, -1.4607, -1.3059],
       [-1.6259,  1.5585, -1.6259, -0.4521]])
</code></pre><h2 id="广播"><a href="#广播" class="headerlink" title="广播"></a>广播</h2><p>每一个元素都乘以4</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">5</span>)</div><div class="line">arr</div><div class="line">arr * <span class="number">4</span></div></pre></td></tr></table></figure><pre><code>array([0, 1, 2, 3, 4])






array([ 0,  4,  8, 12, 16])
</code></pre><p>每一维对应减去均值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">4</span>, <span class="number">3</span>)</div><div class="line">arr.mean(<span class="number">0</span>)</div><div class="line">demeaned = arr - arr.mean(<span class="number">0</span>)</div><div class="line">demeaned</div><div class="line">demeaned.mean(<span class="number">0</span>)</div></pre></td></tr></table></figure><pre><code>array([-0.1556,  0.3494, -0.2545])






array([[-0.3753,  0.5353,  1.3534],
       [-0.4282,  0.5606,  0.8935],
       [-0.0956, -0.9767, -1.2444],
       [ 0.899 , -0.1192, -1.0024]])






array([ -5.5511e-17,  -1.3878e-17,   0.0000e+00])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">arr</div><div class="line">row_means = arr.mean(<span class="number">1</span>)</div><div class="line">row_means.reshape((<span class="number">4</span>, <span class="number">1</span>))</div><div class="line">demeaned = arr - row_means.reshape((<span class="number">4</span>, <span class="number">1</span>))</div><div class="line">demeaned.mean(<span class="number">1</span>)</div></pre></td></tr></table></figure><pre><code>array([[-0.5308,  0.8848,  1.0989],
       [-0.5837,  0.91  ,  0.639 ],
       [-0.2511, -0.6273, -1.4989],
       [ 0.7434,  0.2302, -1.2569]])






array([[ 0.4843],
       [ 0.3218],
       [-0.7924],
       [-0.0944]])






array([  7.4015e-17,   0.0000e+00,   0.0000e+00,   0.0000e+00])
</code></pre><h3 id="沿其他轴向广播"><a href="#沿其他轴向广播" class="headerlink" title="沿其他轴向广播"></a>沿其他轴向广播</h3><p>维度不对应</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr - arr.mean(<span class="number">1</span>)</div></pre></td></tr></table></figure><pre><code>---------------------------------------------------------------------------

ValueError                                Traceback (most recent call last)

&lt;ipython-input-31-7b87b85a20b2&gt; in &lt;module&gt;()
----&gt; 1 arr - arr.mean(1)


ValueError: operands could not be broadcast together with shapes (4,3) (4,) 
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr - arr.mean(<span class="number">1</span>).reshape((<span class="number">4</span>, <span class="number">1</span>))</div></pre></td></tr></table></figure><pre><code>array([[-1.0151,  0.4005,  0.6146],
       [-0.9055,  0.5882,  0.3173],
       [ 0.5413,  0.1652, -0.7065],
       [ 0.8378,  0.3246, -1.1625]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = np.zeros((<span class="number">4</span>, <span class="number">4</span>))</div><div class="line">arr_3d = arr[:, np.newaxis]</div><div class="line">arr_3d</div><div class="line">arr_3d.shape</div></pre></td></tr></table></figure><pre><code>array([[[ 0.,  0.,  0.,  0.]],

       [[ 0.,  0.,  0.,  0.]],

       [[ 0.,  0.,  0.,  0.]],

       [[ 0.,  0.,  0.,  0.]]])






(4, 1, 4)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr_1d = np.random.normal(size=<span class="number">3</span>)</div><div class="line">arr_1d</div><div class="line">arr_1d[:, np.newaxis]</div><div class="line">arr_1d[np.newaxis, :]</div></pre></td></tr></table></figure><pre><code>array([-1.1083,  0.5576,  1.2277])






array([[-1.1083],
       [ 0.5576],
       [ 1.2277]])






array([[-1.1083,  0.5576,  1.2277]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</div><div class="line">arr</div><div class="line">depth_means = arr.mean(<span class="number">2</span>)</div><div class="line">depth_means</div><div class="line">demeaned = arr - depth_means[:, :, np.newaxis]</div><div class="line">demeaned.mean(<span class="number">2</span>)</div></pre></td></tr></table></figure><pre><code>array([[[-1.9966, -0.2431, -0.992 ,  0.8283, -0.5073],
        [-0.3938, -0.1332, -0.7427,  0.3094, -0.9241],
        [ 1.1069, -0.5383, -0.9288,  0.0233, -0.4678],
        [-1.2015,  0.6905,  1.6706, -0.1703, -1.3975]],

       [[-0.3048, -1.7181, -0.189 ,  0.6263,  1.1194],
        [ 0.0823, -0.7132, -0.5162,  1.5305, -1.199 ],
        [ 0.5777,  1.2935,  0.1547, -1.3637,  0.4251],
        [ 0.4923,  1.4004,  0.3646,  0.1594, -0.7334]],

       [[ 1.3836, -0.5313,  0.2826,  0.4739, -1.3435],
        [-1.141 , -0.3084,  1.1364,  1.1326,  0.3064],
        [-0.9692,  1.0229, -0.0246,  1.4484, -1.137 ],
        [ 1.7033, -1.8358,  1.2087, -0.5463,  0.5904]]])






array([[-0.5822, -0.3769, -0.1609, -0.0816],
       [-0.0932, -0.1631,  0.2174,  0.3367],
       [ 0.0531,  0.2252,  0.0681,  0.2241]])






array([[  8.8818e-17,   0.0000e+00,  -4.4409e-17,  -8.8818e-17],
       [  0.0000e+00,   0.0000e+00,   2.7756e-17,   8.8818e-17],
       [  4.4409e-17,   5.5511e-17,   4.4409e-17,   0.0000e+00]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">demean_axis</span><span class="params">(arr, axis=<span class="number">0</span>)</span>:</span></div><div class="line">    means = arr.mean(axis)</div><div class="line"></div><div class="line">    <span class="comment"># This generalized things like [:, :, np.newaxis] to N dimensions</span></div><div class="line">    indexer = [slice(<span class="keyword">None</span>)] * arr.ndim <span class="comment"># like :</span></div><div class="line">    indexer[axis] = np.newaxis</div><div class="line">    <span class="keyword">return</span> arr - means[indexer]</div></pre></td></tr></table></figure><h3 id="通过广播设置数组的值"><a href="#通过广播设置数组的值" class="headerlink" title="通过广播设置数组的值"></a>通过广播设置数组的值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.zeros((<span class="number">4</span>, <span class="number">3</span>))</div><div class="line">arr[:] = <span class="number">5</span></div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[ 5.,  5.,  5.],
       [ 5.,  5.,  5.],
       [ 5.,  5.,  5.],
       [ 5.,  5.,  5.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">col = np.array([<span class="number">1.28</span>, <span class="number">-0.42</span>, <span class="number">0.44</span>, <span class="number">1.6</span>])</div><div class="line">arr[:] = col[:, np.newaxis]</div><div class="line">arr</div><div class="line">arr[:<span class="number">2</span>] = [[<span class="number">-1.37</span>], [<span class="number">0.509</span>]]</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[ 1.28,  1.28,  1.28],
       [-0.42, -0.42, -0.42],
       [ 0.44,  0.44,  0.44],
       [ 1.6 ,  1.6 ,  1.6 ]])






array([[-1.37 , -1.37 , -1.37 ],
       [ 0.509,  0.509,  0.509],
       [ 0.44 ,  0.44 ,  0.44 ],
       [ 1.6  ,  1.6  ,  1.6  ]])
</code></pre><h2 id="ufunc高级应用"><a href="#ufunc高级应用" class="headerlink" title="ufunc高级应用"></a>ufunc高级应用</h2><h3 id="ufunc实例方法"><a href="#ufunc实例方法" class="headerlink" title="ufunc实例方法"></a>ufunc实例方法</h3><p><code>reduce</code>通过一系列的二元运算对其值进行聚合（可指明轴向）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">10</span>)</div><div class="line">np.add.reduce(arr)</div><div class="line">arr.sum()</div></pre></td></tr></table></figure><pre><code>45






45
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.random.seed(<span class="number">12346</span>)</div></pre></td></tr></table></figure><p>这里聚合的是逻辑与操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">5</span>, <span class="number">5</span>)</div><div class="line">arr</div><div class="line">arr[::<span class="number">2</span>].sort(<span class="number">1</span>) <span class="comment"># sort a few rows</span></div><div class="line">arr</div><div class="line">arr[:, :<span class="number">-1</span>] &lt; arr[:, <span class="number">1</span>:]</div><div class="line">np.logical_and.reduce(arr[:, :<span class="number">-1</span>] &lt; arr[:, <span class="number">1</span>:], axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><pre><code>array([[-0.7066,  0.4268, -0.2776, -0.8283, -2.7628],
       [ 0.9835,  0.4378, -0.8496,  0.7188,  0.7329],
       [ 0.5047, -0.7893,  0.5392,  1.2907,  0.8676],
       [ 0.4113,  0.4459, -0.3172, -1.0493,  1.3459],
       [ 0.356 , -0.0915, -0.535 , -0.036 , -0.2591]])






array([[-2.7628, -0.8283, -0.7066, -0.2776,  0.4268],
       [ 0.9835,  0.4378, -0.8496,  0.7188,  0.7329],
       [-0.7893,  0.5047,  0.5392,  0.8676,  1.2907],
       [ 0.4113,  0.4459, -0.3172, -1.0493,  1.3459],
       [-0.535 , -0.2591, -0.0915, -0.036 ,  0.356 ]])






array([[ True,  True,  True,  True],
       [False, False,  True,  True],
       [ True,  True,  True,  True],
       [ True, False, False,  True],
       [ True,  True,  True,  True]], dtype=bool)






array([ True, False,  True, False,  True], dtype=bool)
</code></pre><p>相对于<code>reduce</code>只输出最后结果，<code>accumulate</code>保留中间结果</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">15</span>).reshape((<span class="number">3</span>, <span class="number">5</span>))</div><div class="line">np.add.accumulate(arr, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><pre><code>array([[ 0,  1,  3,  6, 10],
       [ 5, 11, 18, 26, 35],
       [10, 21, 33, 46, 60]], dtype=int32)
</code></pre><p><code>outer</code>计算两个数组的叉积</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">3</span>).repeat([<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>])</div><div class="line">arr</div><div class="line">np.multiply.outer(arr, np.arange(<span class="number">5</span>))</div></pre></td></tr></table></figure><pre><code>array([0, 1, 1, 2, 2])






array([[0, 0, 0, 0, 0],
       [0, 1, 2, 3, 4],
       [0, 1, 2, 3, 4],
       [0, 2, 4, 6, 8],
       [0, 2, 4, 6, 8]])
</code></pre><p><code>outer</code>输出结果的维度是输入两个数组的维度之和</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = np.subtract.outer(randn(<span class="number">3</span>, <span class="number">4</span>), randn(<span class="number">5</span>))</div><div class="line">result.shape</div></pre></td></tr></table></figure><pre><code>(3, 4, 5)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">10</span>)</div><div class="line">np.add.reduceat(arr, [<span class="number">0</span>, <span class="number">5</span>, <span class="number">8</span>])</div></pre></td></tr></table></figure><pre><code>array([10, 18, 17], dtype=int32)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.multiply.outer(np.arange(<span class="number">4</span>), np.arange(<span class="number">5</span>))</div><div class="line">arr</div><div class="line">np.add.reduceat(arr, [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>], axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><pre><code>array([[ 0,  0,  0,  0,  0],
       [ 0,  1,  2,  3,  4],
       [ 0,  2,  4,  6,  8],
       [ 0,  3,  6,  9, 12]])






array([[ 0,  0,  0],
       [ 1,  5,  4],
       [ 2, 10,  8],
       [ 3, 15, 12]], dtype=int32)
</code></pre><h3 id="自定义-ufuncs"><a href="#自定义-ufuncs" class="headerlink" title="自定义 ufuncs"></a>自定义 ufuncs</h3><p>两种不同的调用方式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_elements</span><span class="params">(x, y)</span>:</span></div><div class="line">    <span class="keyword">return</span> x + y</div><div class="line">add_them = np.frompyfunc(add_elements, <span class="number">2</span>, <span class="number">1</span>) <span class="comment"># 2 input and 1 output</span></div><div class="line">add_them(np.arange(<span class="number">8</span>), np.arange(<span class="number">8</span>))</div></pre></td></tr></table></figure><pre><code>array([0, 2, 4, 6, 8, 10, 12, 14], dtype=object)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">add_them = np.vectorize(add_elements, otypes=[np.float64])</div><div class="line">add_them(np.arange(<span class="number">8</span>), np.arange(<span class="number">8</span>))</div></pre></td></tr></table></figure><pre><code>array([  0.,   2.,   4.,   6.,   8.,  10.,  12.,  14.])
</code></pre><p>自己实现的还是比不上内置优化过的函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">10000</span>)</div><div class="line">%timeit add_them(arr, arr)</div><div class="line">%timeit np.add(arr, arr)</div></pre></td></tr></table></figure><pre><code>100 loops, best of 3: 1.81 ms per loop
The slowest run took 16.51 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 3.65 µs per loop
</code></pre><h2 id="结构化和记录式数组"><a href="#结构化和记录式数组" class="headerlink" title="结构化和记录式数组"></a>结构化和记录式数组</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dtype = [(<span class="string">'x'</span>, np.float64), (<span class="string">'y'</span>, np.int32)]</div><div class="line">sarr = np.array([(<span class="number">1.5</span>, <span class="number">6</span>), (np.pi, <span class="number">-2</span>)], dtype=dtype)</div><div class="line">sarr</div></pre></td></tr></table></figure><pre><code>array([(1.5, 6), (3.141592653589793, -2)], 
      dtype=[(&#39;x&#39;, &#39;&lt;f8&#39;), (&#39;y&#39;, &#39;&lt;i4&#39;)])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sarr[<span class="number">0</span>]</div><div class="line">sarr[<span class="number">0</span>][<span class="string">'y'</span>]</div></pre></td></tr></table></figure><pre><code>(1.5, 6)






6
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sarr[<span class="string">'x'</span>]</div></pre></td></tr></table></figure><pre><code>array([ 1.5   ,  3.1416])
</code></pre><h3 id="嵌套dtype和多维字段"><a href="#嵌套dtype和多维字段" class="headerlink" title="嵌套dtype和多维字段"></a>嵌套<code>dtype</code>和多维字段</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dtype = [(<span class="string">'x'</span>, np.int64, <span class="number">3</span>), (<span class="string">'y'</span>, np.int32)]</div><div class="line">arr = np.zeros(<span class="number">4</span>, dtype=dtype)</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([([0, 0, 0], 0), ([0, 0, 0], 0), ([0, 0, 0], 0), ([0, 0, 0], 0)], 
      dtype=[(&#39;x&#39;, &#39;&lt;i8&#39;, (3,)), (&#39;y&#39;, &#39;&lt;i4&#39;)])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr[<span class="number">0</span>][<span class="string">'x'</span>]</div></pre></td></tr></table></figure><pre><code>array([0, 0, 0], dtype=int64)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr[<span class="string">'x'</span>]</div></pre></td></tr></table></figure><pre><code>array([[0, 0, 0],
       [0, 0, 0],
       [0, 0, 0],
       [0, 0, 0]], dtype=int64)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">dtype = [(<span class="string">'x'</span>, [(<span class="string">'a'</span>, <span class="string">'f8'</span>), (<span class="string">'b'</span>, <span class="string">'f4'</span>)]), (<span class="string">'y'</span>, np.int32)]</div><div class="line">data = np.array([((<span class="number">1</span>, <span class="number">2</span>), <span class="number">5</span>), ((<span class="number">3</span>, <span class="number">4</span>), <span class="number">6</span>)], dtype=dtype)</div><div class="line">data[<span class="string">'x'</span>]</div><div class="line">data[<span class="string">'y'</span>]</div><div class="line">data[<span class="string">'x'</span>][<span class="string">'a'</span>]</div></pre></td></tr></table></figure><pre><code>array([(1.0, 2.0), (3.0, 4.0)], 
      dtype=[(&#39;a&#39;, &#39;&lt;f8&#39;), (&#39;b&#39;, &#39;&lt;f4&#39;)])






array([5, 6])






array([ 1.,  3.])
</code></pre><h2 id="更多有关排序的话题"><a href="#更多有关排序的话题" class="headerlink" title="更多有关排序的话题"></a>更多有关排序的话题</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">6</span>)</div><div class="line">arr.sort()</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([-1.3918, -0.2089,  0.2316,  0.728 ,  0.8356,  1.9956])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">3</span>, <span class="number">5</span>)</div><div class="line">arr</div><div class="line">arr[:, <span class="number">0</span>].sort()  <span class="comment"># Sort first column values in-place</span></div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[ -2.9812e-01,   1.2037e+00,  -1.5768e-02,   7.4395e-01,
          8.6880e-01],
       [ -4.2865e-01,   7.1886e-01,  -1.4510e+00,   1.0510e-01,
         -1.7942e+00],
       [ -2.8792e-04,   6.1168e-01,  -9.1210e-02,  -1.2799e+00,
         -4.0230e-02]])






array([[ -4.2865e-01,   1.2037e+00,  -1.5768e-02,   7.4395e-01,
          8.6880e-01],
       [ -2.9812e-01,   7.1886e-01,  -1.4510e+00,   1.0510e-01,
         -1.7942e+00],
       [ -2.8792e-04,   6.1168e-01,  -9.1210e-02,  -1.2799e+00,
         -4.0230e-02]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">5</span>)</div><div class="line">arr</div><div class="line">np.sort(arr)</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([-0.9699, -0.5626,  1.1172,  0.2791, -1.1148])






array([-1.1148, -0.9699, -0.5626,  0.2791,  1.1172])






array([-0.9699, -0.5626,  1.1172,  0.2791, -1.1148])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">3</span>, <span class="number">5</span>)</div><div class="line">arr</div><div class="line">arr.sort(axis=<span class="number">1</span>)</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[ 0.2266,  0.3405,  2.6439, -1.6262, -0.3976],
       [-1.4821,  1.068 , -0.252 , -0.9331,  2.2639],
       [-0.2311,  1.1472,  0.9287, -0.9023,  1.1761]])






array([[-1.6262, -0.3976,  0.2266,  0.3405,  2.6439],
       [-1.4821, -0.9331, -0.252 ,  1.068 ,  2.2639],
       [-0.9023, -0.2311,  0.9287,  1.1472,  1.1761]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr[:, ::<span class="number">-1</span>]</div></pre></td></tr></table></figure><pre><code>array([[ 2.6439,  0.3405,  0.2266, -0.3976, -1.6262],
       [ 2.2639,  1.068 , -0.252 , -0.9331, -1.4821],
       [ 1.1761,  1.1472,  0.9287, -0.2311, -0.9023]])
</code></pre><h3 id="间接排序-argsort-and-lexsort"><a href="#间接排序-argsort-and-lexsort" class="headerlink" title="间接排序: argsort and lexsort"></a>间接排序: argsort and lexsort</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">values = np.array([<span class="number">5</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>])</div><div class="line">indexer = values.argsort()</div><div class="line">indexer</div><div class="line">values[indexer]</div></pre></td></tr></table></figure><pre><code>array([1, 2, 4, 3, 0], dtype=int64)






array([0, 1, 2, 3, 5])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">3</span>, <span class="number">5</span>)</div><div class="line">arr[<span class="number">0</span>] = values</div><div class="line">arr</div><div class="line">arr[:, arr[<span class="number">0</span>].argsort()]</div></pre></td></tr></table></figure><pre><code>array([[ 5.    ,  0.    ,  1.    ,  3.    ,  2.    ],
       [ 0.422 ,  0.1187,  1.1352,  1.4363, -1.2487],
       [ 0.1909, -1.0984,  0.7886, -0.5827,  1.1592]])






array([[ 0.    ,  1.    ,  2.    ,  3.    ,  5.    ],
       [ 0.1187,  1.1352, -1.2487,  1.4363,  0.422 ],
       [-1.0984,  0.7886,  1.1592, -0.5827,  0.1909]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">first_name = np.array([<span class="string">'Bob'</span>, <span class="string">'Jane'</span>, <span class="string">'Steve'</span>, <span class="string">'Bill'</span>, <span class="string">'Barbara'</span>])</div><div class="line">last_name = np.array([<span class="string">'Jones'</span>, <span class="string">'Arnold'</span>, <span class="string">'Arnold'</span>, <span class="string">'Jones'</span>, <span class="string">'Walters'</span>])</div><div class="line">sorter = np.lexsort((first_name, last_name))</div><div class="line">zip(last_name[sorter], first_name[sorter])</div></pre></td></tr></table></figure><pre><code>&lt;zip at 0x1d1284f87c8&gt;
</code></pre><h3 id="其他排序算法"><a href="#其他排序算法" class="headerlink" title="其他排序算法"></a>其他排序算法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">values = np.array([<span class="string">'2:first'</span>, <span class="string">'2:second'</span>, <span class="string">'1:first'</span>, <span class="string">'1:second'</span>, <span class="string">'1:third'</span>])</div><div class="line">key = np.array([<span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>])</div><div class="line">indexer = key.argsort(kind=<span class="string">'mergesort'</span>)</div><div class="line">indexer</div><div class="line">values.take(indexer)</div></pre></td></tr></table></figure><pre><code>array([2, 3, 4, 0, 1], dtype=int64)






array([&#39;1:first&#39;, &#39;1:second&#39;, &#39;1:third&#39;, &#39;2:first&#39;, &#39;2:second&#39;], 
      dtype=&#39;&lt;U8&#39;)
</code></pre><h3 id="numpy-searchsorted-在有序数组中查找元素"><a href="#numpy-searchsorted-在有序数组中查找元素" class="headerlink" title="numpy.searchsorted: 在有序数组中查找元素"></a>numpy.searchsorted: 在有序数组中查找元素</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = np.array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">15</span>])</div><div class="line">arr.searchsorted(<span class="number">9</span>)</div></pre></td></tr></table></figure><pre><code>3
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr.searchsorted([<span class="number">0</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">16</span>])</div></pre></td></tr></table></figure><pre><code>array([0, 3, 3, 5], dtype=int64)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.array([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>])</div><div class="line">arr.searchsorted([<span class="number">0</span>, <span class="number">1</span>])</div><div class="line">arr.searchsorted([<span class="number">0</span>, <span class="number">1</span>], side=<span class="string">'right'</span>)</div></pre></td></tr></table></figure><pre><code>array([0, 3], dtype=int64)






array([3, 7], dtype=int64)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data = np.floor(np.random.uniform(<span class="number">0</span>, <span class="number">10000</span>, size=<span class="number">50</span>))</div><div class="line">bins = np.array([<span class="number">0</span>, <span class="number">100</span>, <span class="number">1000</span>, <span class="number">5000</span>, <span class="number">10000</span>])</div><div class="line">data</div></pre></td></tr></table></figure><pre><code>array([  143.,  8957.,   309.,  2349.,  5503.,  2754.,  4408.,  4259.,
        3313.,  3364.,  2492.,  9977.,  4704.,  5538.,  6089.,  5864.,
        6926.,  3677.,  8698.,  1832.,  8931.,  6631.,  5322.,  3712.,
        9350.,  3945.,  9514.,  3683.,  8568.,  8247.,  7087.,  7630.,
        3392.,  8320.,  1973.,   982.,  1672.,  7052.,  6230.,  3894.,
        1832.,  9488.,   755.,  8522.,  1858.,  5417.,  6162.,  7517.,
        9827.,  4458.])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">labels = bins.searchsorted(data)</div><div class="line">labels</div></pre></td></tr></table></figure><pre><code>array([2, 4, 2, 3, 4, 3, 3, 3, 3, 3, 3, 4, 3, 4, 4, 4, 4, 3, 4, 3, 4, 4, 4,
       3, 4, 3, 4, 3, 4, 4, 4, 4, 3, 4, 3, 2, 3, 4, 4, 3, 3, 4, 2, 4, 3, 4,
       4, 4, 4, 3], dtype=int64)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Series(data).groupby(labels).mean()</div></pre></td></tr></table></figure><pre><code>2     547.250000
3    3178.550000
4    7591.038462
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.digitize(data, bins)</div></pre></td></tr></table></figure><pre><code>array([2, 4, 2, 3, 4, 3, 3, 3, 3, 3, 3, 4, 3, 4, 4, 4, 4, 3, 4, 3, 4, 4, 4,
       3, 4, 3, 4, 3, 4, 4, 4, 4, 3, 4, 3, 2, 3, 4, 4, 3, 3, 4, 2, 4, 3, 4,
       4, 4, 4, 3], dtype=int64)
</code></pre><h2 id="NumPy-matrix-class"><a href="#NumPy-matrix-class" class="headerlink" title="NumPy matrix class"></a>NumPy matrix class</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">X =  np.array([[ <span class="number">8.82768214</span>,  <span class="number">3.82222409</span>, <span class="number">-1.14276475</span>,  <span class="number">2.04411587</span>],</div><div class="line">               [ <span class="number">3.82222409</span>,  <span class="number">6.75272284</span>,  <span class="number">0.83909108</span>,  <span class="number">2.08293758</span>],</div><div class="line">               [<span class="number">-1.14276475</span>,  <span class="number">0.83909108</span>,  <span class="number">5.01690521</span>,  <span class="number">0.79573241</span>],</div><div class="line">               [ <span class="number">2.04411587</span>,  <span class="number">2.08293758</span>,  <span class="number">0.79573241</span>,  <span class="number">6.24095859</span>]])</div><div class="line">X[:, <span class="number">0</span>]  <span class="comment"># one-dimensional</span></div><div class="line">y = X[:, :<span class="number">1</span>]  <span class="comment"># two-dimensional by slicing</span></div><div class="line">X</div><div class="line">y</div></pre></td></tr></table></figure><pre><code>array([ 8.8277,  3.8222, -1.1428,  2.0441])






array([[ 8.8277,  3.8222, -1.1428,  2.0441],
       [ 3.8222,  6.7527,  0.8391,  2.0829],
       [-1.1428,  0.8391,  5.0169,  0.7957],
       [ 2.0441,  2.0829,  0.7957,  6.241 ]])






array([[ 8.8277],
       [ 3.8222],
       [-1.1428],
       [ 2.0441]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.dot(y.T, np.dot(X, y))</div></pre></td></tr></table></figure><pre><code>array([[ 1195.468]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Xm = np.matrix(X)</div><div class="line">ym = Xm[:, <span class="number">0</span>]</div><div class="line">Xm</div><div class="line">ym</div><div class="line">ym.T * Xm * ym</div></pre></td></tr></table></figure><pre><code>matrix([[ 8.8277,  3.8222, -1.1428,  2.0441],
        [ 3.8222,  6.7527,  0.8391,  2.0829],
        [-1.1428,  0.8391,  5.0169,  0.7957],
        [ 2.0441,  2.0829,  0.7957,  6.241 ]])






matrix([[ 8.8277],
        [ 3.8222],
        [-1.1428],
        [ 2.0441]])






matrix([[ 1195.468]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Xm.I * X</div></pre></td></tr></table></figure><pre><code>matrix([[  1.0000e+00,   6.9616e-17,  -4.0136e-17,   8.1258e-17],
        [ -2.3716e-17,   1.0000e+00,   2.2230e-17,  -2.5721e-17],
        [  1.0957e-16,   5.0783e-18,   1.0000e+00,   7.8658e-18],
        [ -5.7092e-17,  -3.7777e-18,   6.2391e-18,   1.0000e+00]])
</code></pre><h2 id="高级数组输入输出"><a href="#高级数组输入输出" class="headerlink" title="高级数组输入输出"></a>高级数组输入输出</h2><h3 id="内存映像文件"><a href="#内存映像文件" class="headerlink" title="内存映像文件"></a>内存映像文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mmap = np.memmap(<span class="string">'mymmap'</span>, dtype=<span class="string">'float64'</span>, mode=<span class="string">'w+'</span>, shape=(<span class="number">10000</span>, <span class="number">10000</span>))</div><div class="line">mmap</div></pre></td></tr></table></figure><pre><code>memmap([[ 0.,  0.,  0., ...,  0.,  0.,  0.],
       [ 0.,  0.,  0., ...,  0.,  0.,  0.],
       [ 0.,  0.,  0., ...,  0.,  0.,  0.],
       ..., 
       [ 0.,  0.,  0., ...,  0.,  0.,  0.],
       [ 0.,  0.,  0., ...,  0.,  0.,  0.],
       [ 0.,  0.,  0., ...,  0.,  0.,  0.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">section = mmap[:<span class="number">5</span>]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">section[:] = np.random.randn(<span class="number">5</span>, <span class="number">10000</span>)</div><div class="line">mmap.flush()</div><div class="line">mmap</div><div class="line"><span class="keyword">del</span> mmap</div></pre></td></tr></table></figure><pre><code>memmap([[-1.273 , -0.1547,  0.7817, ...,  0.3421,  1.0272, -1.8742],
       [-0.3544, -3.1195,  0.1256, ..., -0.4476,  0.4863, -0.8311],
       [-1.1117,  0.8186,  2.3934, ...,  0.1061,  1.4123,  0.6489],
       ..., 
       [ 0.    ,  0.    ,  0.    , ...,  0.    ,  0.    ,  0.    ],
       [ 0.    ,  0.    ,  0.    , ...,  0.    ,  0.    ,  0.    ],
       [ 0.    ,  0.    ,  0.    , ...,  0.    ,  0.    ,  0.    ]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mmap = np.memmap(<span class="string">'mymmap'</span>, dtype=<span class="string">'float64'</span>, shape=(<span class="number">10000</span>, <span class="number">10000</span>))</div><div class="line">mmap</div></pre></td></tr></table></figure><pre><code>memmap([[-1.273 , -0.1547,  0.7817, ...,  0.3421,  1.0272, -1.8742],
       [-0.3544, -3.1195,  0.1256, ..., -0.4476,  0.4863, -0.8311],
       [-1.1117,  0.8186,  2.3934, ...,  0.1061,  1.4123,  0.6489],
       ..., 
       [ 0.    ,  0.    ,  0.    , ...,  0.    ,  0.    ,  0.    ],
       [ 0.    ,  0.    ,  0.    , ...,  0.    ,  0.    ,  0.    ],
       [ 0.    ,  0.    ,  0.    , ...,  0.    ,  0.    ,  0.    ]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">%xdel mmap</div><div class="line">!<span class="keyword">del</span> mymmap</div></pre></td></tr></table></figure><pre><code>NameError: name &#39;mmap&#39; is not defined
C:\Users\Ewan\Downloads\pydata-book-master\mymmap


The process cannot access the file because it is being used by another process.
</code></pre><p>​</p><h2 id="性能建议"><a href="#性能建议" class="headerlink" title="性能建议"></a>性能建议</h2><h3 id="连续内存的重要性"><a href="#连续内存的重要性" class="headerlink" title="连续内存的重要性"></a>连续内存的重要性</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">arr_c = np.ones((<span class="number">1000</span>, <span class="number">1000</span>), order=<span class="string">'C'</span>)</div><div class="line">arr_f = np.ones((<span class="number">1000</span>, <span class="number">1000</span>), order=<span class="string">'F'</span>)</div><div class="line">arr_c.flags</div><div class="line">arr_f.flags</div><div class="line">arr_f.flags.f_contiguous</div></pre></td></tr></table></figure><pre><code>  C_CONTIGUOUS : True
  F_CONTIGUOUS : False
  OWNDATA : True
  WRITEABLE : True
  ALIGNED : True
  UPDATEIFCOPY : False






  C_CONTIGUOUS : False
  F_CONTIGUOUS : True
  OWNDATA : True
  WRITEABLE : True
  ALIGNED : True
  UPDATEIFCOPY : False






True
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">%timeit arr_c.sum(<span class="number">1</span>)</div><div class="line">%timeit arr_f.sum(<span class="number">1</span>)</div></pre></td></tr></table></figure><pre><code>1000 loops, best of 3: 848 µs per loop
1000 loops, best of 3: 582 µs per loop
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr_f.copy(<span class="string">'C'</span>).flags</div></pre></td></tr></table></figure><pre><code>  C_CONTIGUOUS : True
  F_CONTIGUOUS : False
  OWNDATA : True
  WRITEABLE : True
  ALIGNED : True
  UPDATEIFCOPY : False
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr_c[:<span class="number">50</span>].flags.contiguous</div><div class="line">arr_c[:, :<span class="number">50</span>].flags</div></pre></td></tr></table></figure><pre><code>True






  C_CONTIGUOUS : False
  F_CONTIGUOUS : False
  OWNDATA : False
  WRITEABLE : True
  ALIGNED : True
  UPDATEIFCOPY : False
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">%xdel arr_c</div><div class="line">%xdel arr_f</div><div class="line">%cd ..</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Downloads
</code></pre><p>​</p><h2 id="其他加速手段-Cython-f2py-C"><a href="#其他加速手段-Cython-f2py-C" class="headerlink" title="其他加速手段: Cython, f2py, C"></a>其他加速手段: Cython, f2py, C</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">from numpy cimport ndarray, float64_t</div><div class="line"></div><div class="line">def sum_elements(ndarray[float64_t] arr):</div><div class="line">    cdef Py_ssize_t i, n = len(arr)</div><div class="line">    cdef float64_t result = 0</div><div class="line"></div><div class="line">    for i in range(n):</div><div class="line">        result += arr[i]</div><div class="line"></div><div class="line">    return result</div></pre></td></tr></table></figure></div><div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/python/" rel="tag"># python</a> <a href="/tags/pandas/" rel="tag"># pandas</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2017/03/08/GFW-Break/" rel="next" title="GFW Break"><i class="fa fa-chevron-left"></i> GFW Break</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2017/03/16/Installing-ptproc-on-Ubuntu-16-04-LTS/" rel="prev" title="Installing ptproc on Ubuntu 16.04 LTS">Installing ptproc on Ubuntu 16.04 LTS <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"><div class="ds-share flat" data-thread-key="2017/03/09/python-data-analysis-learning-note-Ch12/" data-title="python data analysis learning note Ch12" data-content="" data-url="http://yoursite.com/2017/03/09/python-data-analysis-learning-note-Ch12/"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li><li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li><li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li><li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li><li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div></div></div></div><p>热评文章</p><div class="ds-top-threads" data-range="weekly" data-num-items="4"></div><div class="comments" id="comments"><div class="ds-thread" data-thread-key="2017/03/09/python-data-analysis-learning-note-Ch12/" data-title="python data analysis learning note Ch12" data-url="http://yoursite.com/2017/03/09/python-data-analysis-learning-note-Ch12/"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview">Overview</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Ewan Li"><p class="site-author-name" itemprop="name">Ewan Li</p><p class="site-description motion-element" itemprop="description">Ewan's IT Blog</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">37</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-tags"><a href="/tags"><span class="site-state-item-count">26</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ewanlee" target="_blank" title="Github"><i class="fa fa-fw fa-globe"></i> Github </a></span><span class="links-of-author-item"><a href="http://weibo.com/3946248928/profile?topnav=1&wvr=6" target="_blank" title="Weibo"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Numpy高级应用"><span class="nav-number">1.</span> <span class="nav-text">Numpy高级应用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ndarray对象的内部机制"><span class="nav-number">1.1.</span> <span class="nav-text">ndarray对象的内部机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#NumPy-数据类型体系"><span class="nav-number">1.1.1.</span> <span class="nav-text">NumPy 数据类型体系</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#高级数组操作"><span class="nav-number">1.2.</span> <span class="nav-text">高级数组操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#数组重塑"><span class="nav-number">1.2.1.</span> <span class="nav-text">数组重塑</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#C-vs-Fortran-顺序"><span class="nav-number">1.2.2.</span> <span class="nav-text">C vs. Fortran 顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数组的合并以及拆分"><span class="nav-number">1.2.3.</span> <span class="nav-text">数组的合并以及拆分</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#堆叠辅助类"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">堆叠辅助类</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#元素的重复操作-tile-and-repeat"><span class="nav-number">1.2.4.</span> <span class="nav-text">元素的重复操作: tile and repeat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#花式索引的等价函数-take-and-put"><span class="nav-number">1.2.5.</span> <span class="nav-text">花式索引的等价函数: take and put</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#广播"><span class="nav-number">1.3.</span> <span class="nav-text">广播</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#沿其他轴向广播"><span class="nav-number">1.3.1.</span> <span class="nav-text">沿其他轴向广播</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通过广播设置数组的值"><span class="nav-number">1.3.2.</span> <span class="nav-text">通过广播设置数组的值</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ufunc高级应用"><span class="nav-number">1.4.</span> <span class="nav-text">ufunc高级应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ufunc实例方法"><span class="nav-number">1.4.1.</span> <span class="nav-text">ufunc实例方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义-ufuncs"><span class="nav-number">1.4.2.</span> <span class="nav-text">自定义 ufuncs</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结构化和记录式数组"><span class="nav-number">1.5.</span> <span class="nav-text">结构化和记录式数组</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#嵌套dtype和多维字段"><span class="nav-number">1.5.1.</span> <span class="nav-text">嵌套dtype和多维字段</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更多有关排序的话题"><span class="nav-number">1.6.</span> <span class="nav-text">更多有关排序的话题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#间接排序-argsort-and-lexsort"><span class="nav-number">1.6.1.</span> <span class="nav-text">间接排序: argsort and lexsort</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#其他排序算法"><span class="nav-number">1.6.2.</span> <span class="nav-text">其他排序算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#numpy-searchsorted-在有序数组中查找元素"><span class="nav-number">1.6.3.</span> <span class="nav-text">numpy.searchsorted: 在有序数组中查找元素</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NumPy-matrix-class"><span class="nav-number">1.7.</span> <span class="nav-text">NumPy matrix class</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#高级数组输入输出"><span class="nav-number">1.8.</span> <span class="nav-text">高级数组输入输出</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#内存映像文件"><span class="nav-number">1.8.1.</span> <span class="nav-text">内存映像文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#性能建议"><span class="nav-number">1.9.</span> <span class="nav-text">性能建议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#连续内存的重要性"><span class="nav-number">1.9.1.</span> <span class="nav-text">连续内存的重要性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他加速手段-Cython-f2py-C"><span class="nav-number">1.10.</span> <span class="nav-text">其他加速手段: Cython, f2py, C</span></a></li></ol></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2017</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Ewan Li</span></div><div class="powered-by">Powered by <a class="theme-link" href="https://hexo.io">Hexo</a></div><div class="theme-info">Theme - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user">本站访客数</i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span>人次</span> <span class="site-pv"><i class="fa fa-eye">本站总访问量</i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script><script type="text/javascript">var duoshuoQuery={short_name:"ewanlee"};!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.id="duoshuo-script",t.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()</script><script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script><script src="/js/src/hook-duoshuo.js"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path,searchFunc=function(e,t,a){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var r=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),c=document.getElementById(t),n=document.getElementById(a);c.addEventListener("input",function(){var e=0,t='<ul class="search-result-list">',a=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length>1&&r.forEach(function(r){var c=!1,n=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),o=decodeURIComponent(r.url),i=-1,l=-1,p=-1;if(""!=n&&a.forEach(function(e,t){i=n.indexOf(e),l=s.indexOf(e),(i>=0||l>=0)&&(c=!0,0==t&&(p=l))}),c){e+=1,t+="<li><a href='"+o+"' class='search-result-title'>"+n+"</a>";var h=r.content.trim().replace(/<[^>]+>/g,"");if(p>=0){var u=p-20,d=p+80;u<0&&(u=0),0==u&&(d=50),d>h.length&&(d=h.length);var f=h.substring(u,d);a.forEach(function(e){var t=new RegExp(e,"gi");f=f.replace(t,'<b class="search-keyword">'+e+"</b>")}),t+='<p class="search-result">'+f+"...</p>"}t+="</li>"}}),t+="</ul>",0==e&&(t='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==a&&(t='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),n.innerHTML=t}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("e27VKX5tTklQLCtF7iNMmhcA-gzGzoHsz","nnQn2znNgXXEdK7W2bVJ3bfK")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var r=e[i],s=r.get("url"),l=r.get("time"),c=document.getElementById(s);$(c).find(t).text(l)}for(var i=0;i<n.length;i++){var s=n[i],c=document.getElementById(s),u=$(c).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script></body></html>