<!doctype html><html class="theme-next mist use-motion" lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css"><meta name="keywords" content="machine learning,"><link rel="alternate" href="/atom.xml" title="Abracadabra" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0"><meta name="description" content="This is a detailed EDA of the data, shown in the second video of “Exploratory data analysis” lecture (week 2).PLEASE NOTE: the dataset cannot be published, so this notebook is read-only.Load dataIn th"><meta property="og:type" content="article"><meta property="og:title" content="Exploratory Data Analysis"><meta property="og:url" content="http://yoursite.com/2018/10/16/Exploratory-Data-Analysis/index.html"><meta property="og:site_name" content="Abracadabra"><meta property="og:description" content="This is a detailed EDA of the data, shown in the second video of “Exploratory data analysis” lecture (week 2).PLEASE NOTE: the dataset cannot be published, so this notebook is read-only.Load dataIn th"><meta property="og:image" content="https://raw.githubusercontent.com/ewanlee/blog-image-hosting/master/output_36_0.png"><meta property="og:image" content="https://github.com/ewanlee/blog-image-hosting/blob/master/output_39_0.png?raw=true"><meta property="og:updated_time" content="2018-10-16T07:15:25.325Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Exploratory Data Analysis"><meta name="twitter:description" content="This is a detailed EDA of the data, shown in the second video of “Exploratory data analysis” lecture (week 2).PLEASE NOTE: the dataset cannot be published, so this notebook is read-only.Load dataIn th"><meta name="twitter:image" content="https://raw.githubusercontent.com/ewanlee/blog-image-hosting/master/output_36_0.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://yoursite.com/2018/10/16/Exploratory-Data-Analysis/"><title>Exploratory Data Analysis | Abracadabra</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?dc405a79ad500922134d14cdf288f646";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Abracadabra</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Do it yourself</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-categories"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>Categories</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>About</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>Tags</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>Sitemap</a></li><li class="menu-item menu-item-commonweal"><a href="/404.html" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div><span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/16/Exploratory-Data-Analysis/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracadabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracadabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Exploratory Data Analysis</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-16T14:39:40+08:00">2018-10-16 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2018/10/16/Exploratory-Data-Analysis/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2018/10/16/Exploratory-Data-Analysis/" itemprop="commentsCount"></span> </a></span><span id="/2018/10/16/Exploratory-Data-Analysis/" class="leancloud_visitors" data-flag-title="Exploratory Data Analysis"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><p>This is a detailed EDA of the data, shown in the second video of “Exploratory data analysis” lecture (week 2).</p><p><strong>PLEASE NOTE</strong>: the dataset cannot be published, so this notebook is read-only.</p><h2 id="Load-data"><a href="#Load-data" class="headerlink" title="Load data"></a>Load data</h2><p>In this competition hosted by <em>solutions.se</em>, the task was to predict the advertisement cost for a particular ad.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">%matplotlib inline</div><div class="line"></div><div class="line">data_path = <span class="string">'./data'</span></div><div class="line">train = pd.read_csv(<span class="string">'%s/train.csv.gz'</span> % data_path, parse_dates=[<span class="string">'Date'</span>])</div><div class="line">test  = pd.read_csv(<span class="string">'%s/test.csv.gz'</span> % data_path,  parse_dates=[<span class="string">'Date'</span>])</div></pre></td></tr></table></figure><p>Let’s look at the data (notice that the table is transposed, so we can see all feature names).</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">train.head().T</div></pre></td></tr></table></figure><a id="more"></a><table border="1" class="dataframe"><br><br><br><thead><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br><th>3</th><br><th>4</th><br></tr><br></thead><br><tbody><br><tr><br><th>AdGroupId</th><br><td>78db034136</td><br><td>68a0110c69</td><br><td>21af1035af</td><br><td>f63fda0c33</td><br><td>cd868ebdcc</td><br></tr><br><tr><br><th>AdGroupName</th><br><td>6d91d 25866 9c594</td><br><td>2657d cb2d0 6d91d</td><br><td>6d91d e33a0 9a99b</td><br><td>59991 9c594</td><br><td>6d91d 25866 9a99b</td><br></tr><br><tr><br><th>AdNetworkType2</th><br><td>s</td><br><td>s</td><br><td>s</td><br><td>s</td><br><td>s</td><br></tr><br><tr><br><th>AveragePosition</th><br><td>1.2</td><br><td>2</td><br><td>1</td><br><td>1</td><br><td>1.1</td><br></tr><br><tr><br><th>CampaignId</th><br><td>273823cb71</td><br><td>273823cb71</td><br><td>273823cb71</td><br><td>273823cb71</td><br><td>273823cb71</td><br></tr><br><tr><br><th>CampaignName</th><br><td>2657d 16cb2 74532 b4842 0136e 35aca f140d</td><br><td>2657d 16cb2 74532 b4842 0136e 35aca f140d</td><br><td>2657d 16cb2 74532 b4842 0136e 35aca f140d</td><br><td>2657d 16cb2 74532 b4842 0136e 35aca f140d</td><br><td>2657d 16cb2 74532 b4842 0136e 35aca f140d</td><br></tr><br><tr><br><th>Clicks</th><br><td>0</td><br><td>0</td><br><td>0</td><br><td>0</td><br><td>3</td><br></tr><br><tr><br><th>Conversions</th><br><td>0</td><br><td>0</td><br><td>0</td><br><td>0</td><br><td>0</td><br></tr><br><tr><br><th>ConversionsManyPerClick</th><br><td>0</td><br><td>0</td><br><td>0</td><br><td>0</td><br><td>0</td><br></tr><br><tr><br><th>Cost</th><br><td>0</td><br><td>0</td><br><td>0</td><br><td>0</td><br><td>0.94</td><br></tr><br><tr><br><th>Date</th><br><td>2014-01-01 00:00:00</td><br><td>2014-01-01 00:00:00</td><br><td>2014-01-01 00:00:00</td><br><td>2014-01-01 00:00:00</td><br><td>2014-01-01 00:00:00</td><br></tr><br><tr><br><th>DestinationUrl</th><br><td>98035d60fc</td><br><td>c25f23cd08</td><br><td>01f87f7639</td><br><td>5c0e89f532</td><br><td>8888b55dde</td><br></tr><br><tr><br><th>Device</th><br><td>t</td><br><td>t</td><br><td>t</td><br><td>d</td><br><td>d</td><br></tr><br><tr><br><th>FirstPageCpc</th><br><td>1.06</td><br><td>2.94</td><br><td>0.42</td><br><td>1.75</td><br><td>0.17</td><br></tr><br><tr><br><th>Impressions</th><br><td>32</td><br><td>1</td><br><td>4</td><br><td>1</td><br><td>22</td><br></tr><br><tr><br><th>KeywordMatchType</th><br><td>b</td><br><td>b</td><br><td>b</td><br><td>b</td><br><td>b</td><br></tr><br><tr><br><th>KeywordText</th><br><td>jze 10 +uxsgk</td><br><td>+jze +dznvgyhjclr</td><br><td>jze 100 +gzpxyk</td><br><td>jze 10 +uxsgk 1950k</td><br><td>jze 10 mykj +gzpxyk</td><br></tr><br><tr><br><th>MaxCpc</th><br><td>0.28</td><br><td>1</td><br><td>0.22</td><br><td>0.54</td><br><td>0.12</td><br></tr><br><tr><br><th>QualityScore</th><br><td>1</td><br><td>1</td><br><td>1</td><br><td>1</td><br><td>1</td><br></tr><br><tr><br><th>Slot</th><br><td>s_2</td><br><td>s_2</td><br><td>s_1</td><br><td>s_2</td><br><td>s_1</td><br></tr><br><tr><br><th>TopOfPageCpc</th><br><td>1.07</td><br><td>5.02</td><br><td>0.42</td><br><td>4</td><br><td>0.25</td><br></tr><br><tr><br><th>KeywordId</th><br><td>7d20d63df9</td><br><td>a617d4f037</td><br><td>6e0b7024d2</td><br><td>9c2ea0cdf8</td><br><td>4c8ba7affd</td><br></tr><br></tbody><br></table><p>We see a lot of features with not obvious names. If you search for the <em>CampaignId</em>, <em>AdGroupName</em>, <em>AdNetworkType2</em> using any web search engine, you will find this dataset was exported from Google AdWords. So what is the required domain knowledge here? The knowledge of how web advertisement and Google AdWords work! After you have learned it, the features will make sense to you and you can proceed.</p><p>For the sake of the story I will briefly describe Google AdWords system now. Basically every time a user queries a search engine, Google AdWords decides what ad will be shown along with the actual search results. On the other side of AdWords, the advertisers manage the ads – they can set a multiple keywords, that a user should query in order to their ad to be shown. If the keywords are set properly and are relevant to the ad, then the ad will be shown to relevant users and the ad will get clicked. Advertisers pay to Google for some type of events, happened with their ad: for example for a click event, i.e. the user saw this ad and clicked it. AdWords uses complex algorithms to decide which ad to show to a particular user with a particular search query. The advertisers can only indirectly influence AdWords decesion process by changing keywords and several other parameters. So at a high level, the task is to predict what will be the costs for the advertiser (how much he will pay to Google, column <em>Cost</em>) when the parameters (e.g. keywords) are changed.</p><p>The ads are grouped in groups, there are features <em>AdGroupId</em> <em>AdGroupName</em> describing them. A campaign corresponds to some specific parameters that an advertiser sets. Similarly, there are ID and name features <em>CampaignId</em>, <em>CampaignName</em>. And finally there is some information about keywords: <em>KeywordId</em> and <em>KeywordText</em>. Slot is $1$ when ad is shown on top of the page, and $2$ when on the side. Device is a categorical variable and can be either “tablet”, “mobile” or “pc”. And finally the <em>Date</em> is just the date, for which clicks were aggregated.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">test.head().T</div></pre></td></tr></table></figure><table border="1" class="dataframe"><br><thead><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br><th>3</th><br><th>4</th><br></tr><br></thead><br><tbody><br><tr><br><th>Id</th><br><td>0</td><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br></tr><br><tr><br><th>AdGroupId</th><br><td>00096e7611</td><br><td>00096e7611</td><br><td>00096e7611</td><br><td>00096e7611</td><br><td>00096e7611</td><br></tr><br><tr><br><th>AdGroupName</th><br><td>c8037 75b01 9a99b 3b678 52ba4 2657d</td><br><td>c8037 75b01 9a99b 3b678 52ba4 2657d</td><br><td>c8037 75b01 9a99b 3b678 52ba4 2657d</td><br><td>c8037 75b01 9a99b 3b678 52ba4 2657d</td><br><td>c8037 75b01 9a99b 3b678 52ba4 2657d</td><br></tr><br><tr><br><th>AdNetworkType2</th><br><td>s</td><br><td>s</td><br><td>s</td><br><td>s</td><br><td>s</td><br></tr><br><tr><br><th>AveragePosition</th><br><td>1</td><br><td>1</td><br><td>1</td><br><td>1</td><br><td>1</td><br></tr><br><tr><br><th>CampaignId</th><br><td>e62b4bc4c3</td><br><td>e62b4bc4c3</td><br><td>e62b4bc4c3</td><br><td>e62b4bc4c3</td><br><td>e62b4bc4c3</td><br></tr><br><tr><br><th>CampaignName</th><br><td>2657d 16cb2 74532 06feb 0136e 3a15d</td><br><td>2657d 16cb2 74532 06feb 0136e 3a15d</td><br><td>2657d 16cb2 74532 06feb 0136e 3a15d</td><br><td>2657d 16cb2 74532 06feb 0136e 3a15d</td><br><td>2657d 16cb2 74532 06feb 0136e 3a15d</td><br></tr><br><tr><br><th>Date</th><br><td>2014-06-01 00:00:00</td><br><td>2014-06-01 00:00:00</td><br><td>2014-06-01 00:00:00</td><br><td>2014-06-01 00:00:00</td><br><td>2014-06-01 00:00:00</td><br></tr><br><tr><br><th>DestinationUrl</th><br><td>f5aad09031</td><br><td>f5aad09031</td><br><td>f5aad09031</td><br><td>f5aad09031</td><br><td>f5aad09031</td><br></tr><br><tr><br><th>Device</th><br><td>t</td><br><td>d</td><br><td>m</td><br><td>t</td><br><td>d</td><br></tr><br><tr><br><th>KeywordId</th><br><td>539778bb80</td><br><td>539778bb80</td><br><td>539778bb80</td><br><td>539778bb80</td><br><td>539778bb80</td><br></tr><br><tr><br><th>KeywordMatchType</th><br><td>e</td><br><td>e</td><br><td>e</td><br><td>e</td><br><td>e</td><br></tr><br><tr><br><th>KeywordText</th><br><td>tcjnw gzpxyk nyss ewzhy</td><br><td>tcjnw gzpxyk nyss ewzhy</td><br><td>tcjnw gzpxyk nyss ewzhy</td><br><td>tcjnw gzpxyk nyss ewzhy</td><br><td>tcjnw gzpxyk nyss ewzhy</td><br></tr><br><tr><br><th>Slot</th><br><td>s_1</td><br><td>s_1</td><br><td>s_1</td><br><td>s_2</td><br><td>s_2</td><br></tr><br></tbody><br></table><p>Notice there is diffrent number of columns in test and train – our target is <em>Cost</em> column, but it is closly related to several other features, e.g. <em>Clicks</em>, <em>Conversions</em>. All of the related columns were deleted from the test set to avoid data leakages.</p><h1 id="Let’s-analyze"><a href="#Let’s-analyze" class="headerlink" title="Let’s analyze"></a>Let’s analyze</h1><p>Are we ready to modeling? Not yet. Take a look at this statistic:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">print</span> <span class="string">'Train min/max date: %s / %s'</span> % (train.Date.min().date(), train.Date.max().date())</div><div class="line"><span class="keyword">print</span> <span class="string">'Test  min/max date: %s / %s'</span> % ( test.Date.min().date(),  test.Date.max().date())</div><div class="line"><span class="keyword">print</span> <span class="string">''</span></div><div class="line"><span class="keyword">print</span> <span class="string">'Number of days in train: %d'</span> % ((train.Date.max() - train.Date.min()).days + <span class="number">1</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">'Number of days in test:  %d'</span> % (( test.Date.max() -  test.Date.min()).days + <span class="number">1</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">''</span></div><div class="line"><span class="keyword">print</span> <span class="string">'Train shape: %d rows'</span> % train.shape[<span class="number">0</span>]</div><div class="line"><span class="keyword">print</span> <span class="string">'Test shape: %d rows'</span>  % test.shape[<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>Train min/max date: 2014-01-01 / 2014-05-31
Test  min/max date: 2014-06-01 / 2014-06-14

Number of days in train: 151
Number of days in test:  14

Train shape: 3493820 rows
Test shape: 8951040 rows
</code></pre><p>Train period is more than 10 times larger than the test period, but train set has fewer rows, how could that happen?</p><p>At this point I suggest you to stop and think yourself, what could be a reason, why this did happen. Unfortunately we cannot share the data for this competition, but the information from above should be enough to get a right idea.</p><p>Alternatively, you can go along for the explanation, if you want.</p><h1 id="Investigation"><a href="#Investigation" class="headerlink" title="Investigation"></a>Investigation</h1><p>Let’s take a look how many rows with each date we have in train and test.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">test.Date.value_counts()</div></pre></td></tr></table></figure><pre><code>2014-06-02    639360
2014-06-12    639360
2014-06-09    639360
2014-06-14    639360
2014-06-01    639360
2014-06-11    639360
2014-06-08    639360
2014-06-05    639360
2014-06-10    639360
2014-06-07    639360
2014-06-04    639360
2014-06-06    639360
2014-06-03    639360
2014-06-13    639360
Name: Date, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># print only first 10</span></div><div class="line">train.Date.value_counts().head(<span class="number">10</span>)</div></pre></td></tr></table></figure><pre><code>2014-01-01    36869
2014-01-04    36427
2014-01-05    36137
2014-01-02    34755
2014-01-03    34693
2014-01-06    31349
2014-04-07    30950
2014-02-09    30101
2014-01-26    29830
2014-02-08    29187
Name: Date, dtype: int64
</code></pre><p>Interesting, for the test set we have the same number of rows for every date, while in train set the number of rows is different for each day. It looks like that for each day in the test set a loop through some kind of IDs had been run. But what about train set? So far we don’t know, but let’s find the test IDs first.</p><h3 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h3><p>So now we know, that there is $639360$ different IDs. It should be easy to find the columns, that form ID, because if the ID is [‘col1’, ‘col2’], then to compute the number of combinations we should just multiply the number of unique elements in each.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">test_nunique = test.nunique()</div><div class="line">test_nunique</div></pre></td></tr></table></figure><pre><code>Id                  8951040
AdGroupId             13548
AdGroupName            2281
AdNetworkType2            2
AveragePosition         131
CampaignId              252
CampaignName            252
Date                     14
DestinationUrl        52675
Device                    3
KeywordId             12285
KeywordMatchType          3
KeywordText           11349
Slot                      4
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> itertools</div><div class="line"></div><div class="line"><span class="comment"># This function looks for a combination of elements </span></div><div class="line"><span class="comment"># with product of 639360 </span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_prod</span><span class="params">(data)</span>:</span></div><div class="line">    <span class="comment"># combinations of not more than 5 features</span></div><div class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">5</span>):</div><div class="line">        <span class="comment"># iterate through all combinations</span></div><div class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> itertools.combinations(range(len(data)), n):</div><div class="line">            <span class="keyword">if</span> data[list(c)].prod() == <span class="number">639360</span>:</div><div class="line">                <span class="keyword">print</span> test_nunique.index[c]</div><div class="line">                <span class="keyword">return</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'Nothing found'</span></div><div class="line"></div><div class="line">    </div><div class="line">find_prod(test_nunique.values)</div></pre></td></tr></table></figure><pre><code>Nothing found
</code></pre><p>Hmm, nothing found! The problem is that some features are tied, and the number of their combinations does not equal to product of individual unique number of elements. For example it does not make sense to create all possible combinations of <em>DestinationUrl</em> and <em>AdGroupId</em> as <em>DestinationUrl</em> belong to exactly one <em>AdGroupId</em>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">test.groupby(<span class="string">'DestinationUrl'</span>).AdGroupId.nunique()</div></pre></td></tr></table></figure><pre><code>DestinationUrl
00010d62df    1
000249f717    1
00054cf3f8    1
000684bf0b    1
00072a9fa7    1
00077a6729    1
0007cc191f    1
0009388900    1
001144cae4    1
00115f6477    1
00141a299f    1
00169dc49b    1
0018b27e06    1
001b0b3d06    1
001ef8368e    1
00205e056a    1
002082ab8b    1
0020c585ea    1
0021419f7e    1
00225519cc    1
002498dc88    1
0026171436    1
00265dc4bb    1
0026833e5c    1
0027ffbad9    1
002b1deb25    1
002c55ccef    1
002e44290f    1
0030ca870e    1
0032b64beb    1
             ..
ffda377018    1
ffda3c412a    1
ffda5b53d6    1
ffda8c0d8c    1
ffdbf5d179    1
ffdc872fcf    1
ffde114af5    1
ffde41a800    1
ffe2fb7007    1
ffe4a040d4    1
ffe685e937    1
ffe8c3da53    1
ffe8f82e08    1
ffeb9fda9d    1
ffebd1d253    1
ffebea724f    1
ffecf398b1    1
ffecf3e7d4    1
ffed185438    1
fff02d7269    1
fff10adcb0    1
fff12e5f19    1
fff132d5bd    1
fff19836a0    1
fff3539204    1
fff4c5d255    1
fff55db78a    1
fff8c11ad9    1
fff90ea351    1
fffb248bf0    1
Name: AdGroupId, Length: 52675, dtype: int64
</code></pre><p>So, now let’s try to find ID differently. Let’s try to find a list of columns, such that threre is exazctly $639360$ unique combinations of their values <strong>in the test set</strong> (not overall). So, we want to find <code>columns</code>, such that:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">test[columns].drop_duplicates().shape[<span class="number">0</span>]  == <span class="number">639360</span></div></pre></td></tr></table></figure><p>We could do it with a similar loop.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> itertools</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_ncombinations</span><span class="params">(data)</span>:</span></div><div class="line">    <span class="comment"># combinations of not more than 5 features</span></div><div class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">5</span>):</div><div class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> itertools.combinations(range(data.shape[<span class="number">1</span>]), n):</div><div class="line">            <span class="keyword">print</span> c</div><div class="line">            columns = test.columns[list(c)]</div><div class="line">            <span class="keyword">if</span> test[columns].drop_duplicates().shape[<span class="number">0</span>] == <span class="number">639360</span>:</div><div class="line">                <span class="keyword">print</span> columns</div><div class="line">                <span class="keyword">return</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'Nothing found'</span></div><div class="line"></div><div class="line">    </div><div class="line">find_ncombinations(test)</div></pre></td></tr></table></figure><p>But it will take forever to compute. So it is easier to find the combination manually.</p><p>So after some time of trials and errors I figured out, that the four features <em>KeywordId, AdGroupId, Device, Slot</em> form the index. The number of unique rows is exactly <em>639360</em> as we wanted to find.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">columns = [<span class="string">'KeywordId'</span>, <span class="string">'AdGroupId'</span>, <span class="string">'Device'</span>, <span class="string">'Slot'</span>]</div><div class="line">test[columns].drop_duplicates().shape</div></pre></td></tr></table></figure><pre><code>(639360, 4)
</code></pre><p>Looks reasonable. For each <em>AdGroupId</em> there is a <strong>distinct set</strong> of possible <em>KeywordId’s</em>, but <em>Device</em> and <em>Slot</em> variants are the same for each ad. And the target is to predict what will be the daily cost for using different <em>KeywordId’s</em>, <em>Device</em> type, <em>Slot</em> type to advertise ads from <em>AdGroups</em>.</p><h3 id="Train"><a href="#Train" class="headerlink" title="Train"></a>Train</h3><p>To this end, we found how test set was constructed, but what about the train set? Let us plot something, probably we will find it out.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</div><div class="line">sns.set(palette=<span class="string">'pastel'</span>)</div><div class="line">sns.set(font_scale=<span class="number">2</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># from absolute dates to relative</span></div><div class="line">train[<span class="string">'date_diff'</span>] =  (train.Date - train.Date.min()).dt.days</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># group by the index, that we've found</span></div><div class="line">g= train.groupby([<span class="string">'KeywordId'</span>, <span class="string">'AdGroupId'</span>, <span class="string">'Device'</span>, <span class="string">'Slot'</span>])</div><div class="line"></div><div class="line"><span class="comment"># and for each index show average relative date versus </span></div><div class="line"><span class="comment"># the number of rows with that index</span></div><div class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">12</span>))</div><div class="line">plt.scatter(g.date_diff.mean(),g.size(),edgecolor = <span class="string">'none'</span>,alpha = <span class="number">0.2</span>, s=<span class="number">20</span>, c=<span class="string">'b'</span>)</div><div class="line">plt.xlabel(<span class="string">'Group mean relative date'</span>)</div><div class="line">plt.ylabel(<span class="string">'Group size'</span>)</div><div class="line">plt.title(<span class="string">'Train'</span>);</div></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ewanlee/blog-image-hosting/master/output_36_0.png" alt="png"></p><p>Looks interesting, isn’t it? That is something we need to explain! How the same plot looks for the test set?</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># from absolute dates to relative</span></div><div class="line">test[<span class="string">'date_diff'</span>] =  (test.Date - test.Date.min()).dt.days</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># group by the index, that we've found</span></div><div class="line">g= test.groupby([<span class="string">'KeywordId'</span>, <span class="string">'AdGroupId'</span>, <span class="string">'Device'</span>, <span class="string">'Slot'</span>])</div><div class="line"></div><div class="line"><span class="comment"># and for each index show average relative date versus </span></div><div class="line"><span class="comment"># the number of rows with that index</span></div><div class="line">plt.figure(figsize=(<span class="number">12</span>,<span class="number">12</span>))</div><div class="line">plt.scatter(g.date_diff.mean(),g.size(),edgecolor = <span class="string">'none'</span>,alpha = <span class="number">0.2</span>, s=<span class="number">20</span>, c=<span class="string">'b'</span>)</div><div class="line">plt.xlabel(<span class="string">'Group mean relative date'</span>)</div><div class="line">plt.ylabel(<span class="string">'Group size'</span>)</div><div class="line">plt.ylim(<span class="number">-2</span>, <span class="number">30</span>)</div><div class="line">plt.title(<span class="string">'Test'</span>);</div></pre></td></tr></table></figure><p><img src="https://github.com/ewanlee/blog-image-hosting/blob/master/output_39_0.png?raw=true" alt="png"></p><p>Just a dot!</p><p>Now let’s think, what we actually plotted? We grouped the data by the ID that we’ve found previously and we plotted average <em>Date</em> in the group versus the size of each group. We found that ID is an aggregation index – so for each date the <em>Cost</em> is aggreagated for each possible index. So group size shows for how many days we have <em>Const</em> information for each ID and mean relative date shows some information about these days.</p><p>For test set it is expectable that both average date and the size of the groups are the same for each group: the size of each group is $14$ (as we have $14$ test days) and mean date is $6.5$, because for each group (index) we have $14$ different days, and $\frac{0 + 1 + \dots + 13}{14} = 6.5$.</p><p>And now we can explain everything for the train set. Look at the top of the triangle: for those points (groups) we have <em>Cost</em> information for all the days in the train period, while on the sides we see groups, for which we have very few rows.</p><p>But why for some groups we have smaller number of rows, than number of days? Let’s look at the <em>Impressions</em> column.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">train.Impressions.value_counts()</div></pre></td></tr></table></figure><pre><code>1         1602929
2          565896
3          287128
4          175197
5          119092
6           86651
7           66443
8           53007
9           42984
10          35731
11          30248
12          25950
13          22629
14          20126
15          17503
16          15682
17          14100
18          12848
19          11597
20          10724
21           9864
22           8931
23           8316
24           7953
25           7168
26           6684
27           6196
28           5863
29           5556
30           5223
           ...   
4978            1
15210           1
9076            1
13174           1
116535          1
4979            1
17273           1
90974           1
4976            1
5906            1
7023            1
60282           1
7955            1
13881           1
2921            1
4970            1
7019            1
17249           1
23394           1
28210           1
11116           1
15929           1
7017            1
95761           1
2923            1
15213           1
9070            1
5692            1
13162           1
13922           1
Name: Impressions, Length: 8135, dtype: int64
</code></pre><p>We never have $0$ value in <em>Imressions</em> column. But in reality, of course, some ads with some combination of keyword, slot, device were never shown. So this looks like a nice explanation for the data: in the train set we <strong>only</strong> have information about ads (IDs, groups) which were shown at least once. And for the test set, we, of course, want to predict <em>Cost</em> <strong>for every</strong> possible ID.</p><p>What it means for competitors, is that if one would just fit a model on the train set as is, the predictions for the test set will be biased by a lot. The predictions will be much higher than they should be, as we are only given a specific subset of rows as <code>train.csv</code> file.</p><p>So, before modeling we should first extend the trainset and inject rows with <code>0</code> impressions. Such change will make train set very similar to the test set and the models will generalize nicely.</p></div><div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/machine-learning/" rel="tag"># machine learning</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2018/10/15/数据预处理相关技术/" rel="next" title="数据预处理相关技术"><i class="fa fa-chevron-left"></i> 数据预处理相关技术</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/2018/10/16/Processing-anonymized-features/" rel="prev" title="Processing Anonymized Features">Processing Anonymized Features <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"><div class="addthis_inline_share_toolbox"><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-58f731508143741d" async></script></div></div></div></div><div class="comments" id="comments"><div id="hypercomments_widget"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview">Overview</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Ewan Li"><p class="site-author-name" itemprop="name">Ewan Li</p><p class="site-description motion-element" itemprop="description">Ewan's IT Blog</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">128</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-tags"><a href="/tags"><span class="site-state-item-count">63</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ewanlee" target="_blank" title="Github"><i class="fa fa-fw fa-globe"></i> Github </a></span><span class="links-of-author-item"><a href="https://twitter.com/tomaxent" target="_blank" title="Twitter"><i class="fa fa-fw fa-twitter"></i> Twitter</a></span></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Load-data"><span class="nav-number">1.</span> <span class="nav-text">Load data</span></a></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#Let’s-analyze"><span class="nav-number"></span> <span class="nav-text">Let’s analyze</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Investigation"><span class="nav-number"></span> <span class="nav-text">Investigation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Test"><span class="nav-number">0.1.</span> <span class="nav-text">Test</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Train"><span class="nav-number">0.2.</span> <span class="nav-text">Train</span></a></li></ol></li></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Ewan Li</span></div><div class="powered-by">Powered by <a class="theme-link" href="https://hexo.io">Hexo</a></div><div class="theme-info">Theme - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user">本站访客数</i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span>人次</span> <span class="site-pv"><i class="fa fa-eye">本站总访问量</i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script><script type="text/javascript">_hcwp=window._hcwp||[],_hcwp.push({widget:"Bloggerstream",widget_id:89825,selector:".hc-comment-count",label:"{%COUNT%}"}),_hcwp.push({widget:"Stream",widget_id:89825,xid:"2018/10/16/Exploratory-Data-Analysis/"}),function(){if(!("HC_LOAD_INIT"in window)){HC_LOAD_INIT=!0;var t=(navigator.language||navigator.systemLanguage||navigator.userLanguage||"en").substr(0,2).toLowerCase(),e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https":"http")+"://w.hypercomments.com/widget/hc/89825/"+t+"/widget.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(e,a.nextSibling)}}()</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path,searchFunc=function(e,t,a){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var r=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),c=document.getElementById(t),n=document.getElementById(a);c.addEventListener("input",function(){var e=0,t='<ul class="search-result-list">',a=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length>1&&r.forEach(function(r){var c=!1,n=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),o=decodeURIComponent(r.url),i=-1,l=-1,p=-1;if(""!=n&&a.forEach(function(e,t){i=n.indexOf(e),l=s.indexOf(e),(i>=0||l>=0)&&(c=!0,0==t&&(p=l))}),c){e+=1,t+="<li><a href='"+o+"' class='search-result-title'>"+n+"</a>";var h=r.content.trim().replace(/<[^>]+>/g,"");if(p>=0){var u=p-20,d=p+80;u<0&&(u=0),0==u&&(d=50),d>h.length&&(d=h.length);var f=h.substring(u,d);a.forEach(function(e){var t=new RegExp(e,"gi");f=f.replace(t,'<b class="search-keyword">'+e+"</b>")}),t+='<p class="search-result">'+f+"...</p>"}t+="</li>"}}),t+="</ul>",0==e&&(t='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==a&&(t='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),n.innerHTML=t}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("e27VKX5tTklQLCtF7iNMmhcA-gzGzoHsz","nnQn2znNgXXEdK7W2bVJ3bfK")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var r=e[i],s=r.get("url"),l=r.get("time"),c=document.getElementById(s);$(c).find(t).text(l)}for(var i=0;i<n.length;i++){var s=n[i],c=document.getElementById(s),u=$(c).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script></body></html>