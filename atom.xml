<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Abracdabra</title>
  <subtitle>Do it yourself</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2017-03-07T07:39:13.235Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Ewan Li</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title></title>
    <link href="http://yoursite.com/2017/03/07/python%20data%20analysis%20learning%20note%2009/"/>
    <id>http://yoursite.com/2017/03/07/python data analysis learning note 09/</id>
    <published>2017-03-07T07:38:40.324Z</published>
    <updated>2017-03-07T07:39:13.235Z</updated>
    
    <content type="html"><![CDATA[<!DOCTYPE html><html><head><meta charset="utf-8"><title>ch09</title><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><style type="text/css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->/*!
*
* Twitter Bootstrap
*
*//*!
 * Bootstrap v3.3.6 (http://getbootstrap.com)
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 *//*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}/*! Source: https://github.com/h5bp/html5-boilerplate/blob/master/src/css/main.css */@media print{*,:after,:before{background:0 0!important;color:#000!important;box-shadow:none!important;text-shadow:none!important}a,a:visited{text-decoration:underline}a[href]:after{content:" (" attr(href) ")"}abbr[title]:after{content:" (" attr(title) ")"}a[href^="javascript:"]:after,a[href^="#"]:after{content:""}blockquote,pre{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}img,tr{page-break-inside:avoid}img{max-width:100%!important}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}.navbar{display:none}.btn>.caret,.dropup>.btn>.caret{border-top-color:#000!important}.label{border:1px solid #000}.table{border-collapse:collapse!important}.table td,.table th{background-color:#fff!important}.table-bordered td,.table-bordered th{border:1px solid #ddd!important}}@font-face{font-family:'Glyphicons Halflings';src:url(../components/bootstrap/fonts/glyphicons-halflings-regular.eot);src:url(../components/bootstrap/fonts/glyphicons-halflings-regular.eot?#iefix) format('embedded-opentype'),url(../components/bootstrap/fonts/glyphicons-halflings-regular.woff2) format('woff2'),url(../components/bootstrap/fonts/glyphicons-halflings-regular.woff) format('woff'),url(../components/bootstrap/fonts/glyphicons-halflings-regular.ttf) format('truetype'),url(../components/bootstrap/fonts/glyphicons-halflings-regular.svg#glyphicons_halflingsregular) format('svg')}.glyphicon{position:relative;top:1px;display:inline-block;font-family:'Glyphicons Halflings';font-style:normal;font-weight:400;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.glyphicon-asterisk:before{content:"\002a"}.glyphicon-plus:before{content:"\002b"}.glyphicon-eur:before,.glyphicon-euro:before{content:"\20ac"}.glyphicon-minus:before{content:"\2212"}.glyphicon-cloud:before{content:"\2601"}.glyphicon-envelope:before{content:"\2709"}.glyphicon-pencil:before{content:"\270f"}.glyphicon-glass:before{content:"\e001"}.glyphicon-music:before{content:"\e002"}.glyphicon-search:before{content:"\e003"}.glyphicon-heart:before{content:"\e005"}.glyphicon-star:before{content:"\e006"}.glyphicon-star-empty:before{content:"\e007"}.glyphicon-user:before{content:"\e008"}.glyphicon-film:before{content:"\e009"}.glyphicon-th-large:before{content:"\e010"}.glyphicon-th:before{content:"\e011"}.glyphicon-th-list:before{content:"\e012"}.glyphicon-ok:before{content:"\e013"}.glyphicon-remove:before{content:"\e014"}.glyphicon-zoom-in:before{content:"\e015"}.glyphicon-zoom-out:before{content:"\e016"}.glyphicon-off:before{content:"\e017"}.glyphicon-signal:before{content:"\e018"}.glyphicon-cog:before{content:"\e019"}.glyphicon-trash:before{content:"\e020"}.glyphicon-home:before{content:"\e021"}.glyphicon-file:before{content:"\e022"}.glyphicon-time:before{content:"\e023"}.glyphicon-road:before{content:"\e024"}.glyphicon-download-alt:before{content:"\e025"}.glyphicon-download:before{content:"\e026"}.glyphicon-upload:before{content:"\e027"}.glyphicon-inbox:before{content:"\e028"}.glyphicon-play-circle:before{content:"\e029"}.glyphicon-repeat:before{content:"\e030"}.glyphicon-refresh:before{content:"\e031"}.glyphicon-list-alt:before{content:"\e032"}.glyphicon-lock:before{content:"\e033"}.glyphicon-flag:before{content:"\e034"}.glyphicon-headphones:before{content:"\e035"}.glyphicon-volume-off:before{content:"\e036"}.glyphicon-volume-down:before{content:"\e037"}.glyphicon-volume-up:before{content:"\e038"}.glyphicon-qrcode:before{content:"\e039"}.glyphicon-barcode:before{content:"\e040"}.glyphicon-tag:before{content:"\e041"}.glyphicon-tags:before{content:"\e042"}.glyphicon-book:before{content:"\e043"}.glyphicon-bookmark:before{content:"\e044"}.glyphicon-print:before{content:"\e045"}.glyphicon-camera:before{content:"\e046"}.glyphicon-font:before{content:"\e047"}.glyphicon-bold:before{content:"\e048"}.glyphicon-italic:before{content:"\e049"}.glyphicon-text-height:before{content:"\e050"}.glyphicon-text-width:before{content:"\e051"}.glyphicon-align-left:before{content:"\e052"}.glyphicon-align-center:before{content:"\e053"}.glyphicon-align-right:before{content:"\e054"}.glyphicon-align-justify:before{content:"\e055"}.glyphicon-list:before{content:"\e056"}.glyphicon-indent-left:before{content:"\e057"}.glyphicon-indent-right:before{content:"\e058"}.glyphicon-facetime-video:before{content:"\e059"}.glyphicon-picture:before{content:"\e060"}.glyphicon-map-marker:before{content:"\e062"}.glyphicon-adjust:before{content:"\e063"}.glyphicon-tint:before{content:"\e064"}.glyphicon-edit:before{content:"\e065"}.glyphicon-share:before{content:"\e066"}.glyphicon-check:before{content:"\e067"}.glyphicon-move:before{content:"\e068"}.glyphicon-step-backward:before{content:"\e069"}.glyphicon-fast-backward:before{content:"\e070"}.glyphicon-backward:before{content:"\e071"}.glyphicon-play:before{content:"\e072"}.glyphicon-pause:before{content:"\e073"}.glyphicon-stop:before{content:"\e074"}.glyphicon-forward:before{content:"\e075"}.glyphicon-fast-forward:before{content:"\e076"}.glyphicon-step-forward:before{content:"\e077"}.glyphicon-eject:before{content:"\e078"}.glyphicon-chevron-left:before{content:"\e079"}.glyphicon-chevron-right:before{content:"\e080"}.glyphicon-plus-sign:before{content:"\e081"}.glyphicon-minus-sign:before{content:"\e082"}.glyphicon-remove-sign:before{content:"\e083"}.glyphicon-ok-sign:before{content:"\e084"}.glyphicon-question-sign:before{content:"\e085"}.glyphicon-info-sign:before{content:"\e086"}.glyphicon-screenshot:before{content:"\e087"}.glyphicon-remove-circle:before{content:"\e088"}.glyphicon-ok-circle:before{content:"\e089"}.glyphicon-ban-circle:before{content:"\e090"}.glyphicon-arrow-left:before{content:"\e091"}.glyphicon-arrow-right:before{content:"\e092"}.glyphicon-arrow-up:before{content:"\e093"}.glyphicon-arrow-down:before{content:"\e094"}.glyphicon-share-alt:before{content:"\e095"}.glyphicon-resize-full:before{content:"\e096"}.glyphicon-resize-small:before{content:"\e097"}.glyphicon-exclamation-sign:before{content:"\e101"}.glyphicon-gift:before{content:"\e102"}.glyphicon-leaf:before{content:"\e103"}.glyphicon-fire:before{content:"\e104"}.glyphicon-eye-open:before{content:"\e105"}.glyphicon-eye-close:before{content:"\e106"}.glyphicon-warning-sign:before{content:"\e107"}.glyphicon-plane:before{content:"\e108"}.glyphicon-calendar:before{content:"\e109"}.glyphicon-random:before{content:"\e110"}.glyphicon-comment:before{content:"\e111"}.glyphicon-magnet:before{content:"\e112"}.glyphicon-chevron-up:before{content:"\e113"}.glyphicon-chevron-down:before{content:"\e114"}.glyphicon-retweet:before{content:"\e115"}.glyphicon-shopping-cart:before{content:"\e116"}.glyphicon-folder-close:before{content:"\e117"}.glyphicon-folder-open:before{content:"\e118"}.glyphicon-resize-vertical:before{content:"\e119"}.glyphicon-resize-horizontal:before{content:"\e120"}.glyphicon-hdd:before{content:"\e121"}.glyphicon-bullhorn:before{content:"\e122"}.glyphicon-bell:before{content:"\e123"}.glyphicon-certificate:before{content:"\e124"}.glyphicon-thumbs-up:before{content:"\e125"}.glyphicon-thumbs-down:before{content:"\e126"}.glyphicon-hand-right:before{content:"\e127"}.glyphicon-hand-left:before{content:"\e128"}.glyphicon-hand-up:before{content:"\e129"}.glyphicon-hand-down:before{content:"\e130"}.glyphicon-circle-arrow-right:before{content:"\e131"}.glyphicon-circle-arrow-left:before{content:"\e132"}.glyphicon-circle-arrow-up:before{content:"\e133"}.glyphicon-circle-arrow-down:before{content:"\e134"}.glyphicon-globe:before{content:"\e135"}.glyphicon-wrench:before{content:"\e136"}.glyphicon-tasks:before{content:"\e137"}.glyphicon-filter:before{content:"\e138"}.glyphicon-briefcase:before{content:"\e139"}.glyphicon-fullscreen:before{content:"\e140"}.glyphicon-dashboard:before{content:"\e141"}.glyphicon-paperclip:before{content:"\e142"}.glyphicon-heart-empty:before{content:"\e143"}.glyphicon-link:before{content:"\e144"}.glyphicon-phone:before{content:"\e145"}.glyphicon-pushpin:before{content:"\e146"}.glyphicon-usd:before{content:"\e148"}.glyphicon-gbp:before{content:"\e149"}.glyphicon-sort:before{content:"\e150"}.glyphicon-sort-by-alphabet:before{content:"\e151"}.glyphicon-sort-by-alphabet-alt:before{content:"\e152"}.glyphicon-sort-by-order:before{content:"\e153"}.glyphicon-sort-by-order-alt:before{content:"\e154"}.glyphicon-sort-by-attributes:before{content:"\e155"}.glyphicon-sort-by-attributes-alt:before{content:"\e156"}.glyphicon-unchecked:before{content:"\e157"}.glyphicon-expand:before{content:"\e158"}.glyphicon-collapse-down:before{content:"\e159"}.glyphicon-collapse-up:before{content:"\e160"}.glyphicon-log-in:before{content:"\e161"}.glyphicon-flash:before{content:"\e162"}.glyphicon-log-out:before{content:"\e163"}.glyphicon-new-window:before{content:"\e164"}.glyphicon-record:before{content:"\e165"}.glyphicon-save:before{content:"\e166"}.glyphicon-open:before{content:"\e167"}.glyphicon-saved:before{content:"\e168"}.glyphicon-import:before{content:"\e169"}.glyphicon-export:before{content:"\e170"}.glyphicon-send:before{content:"\e171"}.glyphicon-floppy-disk:before{content:"\e172"}.glyphicon-floppy-saved:before{content:"\e173"}.glyphicon-floppy-remove:before{content:"\e174"}.glyphicon-floppy-save:before{content:"\e175"}.glyphicon-floppy-open:before{content:"\e176"}.glyphicon-credit-card:before{content:"\e177"}.glyphicon-transfer:before{content:"\e178"}.glyphicon-cutlery:before{content:"\e179"}.glyphicon-header:before{content:"\e180"}.glyphicon-compressed:before{content:"\e181"}.glyphicon-earphone:before{content:"\e182"}.glyphicon-phone-alt:before{content:"\e183"}.glyphicon-tower:before{content:"\e184"}.glyphicon-stats:before{content:"\e185"}.glyphicon-sd-video:before{content:"\e186"}.glyphicon-hd-video:before{content:"\e187"}.glyphicon-subtitles:before{content:"\e188"}.glyphicon-sound-stereo:before{content:"\e189"}.glyphicon-sound-dolby:before{content:"\e190"}.glyphicon-sound-5-1:before{content:"\e191"}.glyphicon-sound-6-1:before{content:"\e192"}.glyphicon-sound-7-1:before{content:"\e193"}.glyphicon-copyright-mark:before{content:"\e194"}.glyphicon-registration-mark:before{content:"\e195"}.glyphicon-cloud-download:before{content:"\e197"}.glyphicon-cloud-upload:before{content:"\e198"}.glyphicon-tree-conifer:before{content:"\e199"}.glyphicon-tree-deciduous:before{content:"\e200"}.glyphicon-cd:before{content:"\e201"}.glyphicon-save-file:before{content:"\e202"}.glyphicon-open-file:before{content:"\e203"}.glyphicon-level-up:before{content:"\e204"}.glyphicon-copy:before{content:"\e205"}.glyphicon-paste:before{content:"\e206"}.glyphicon-alert:before{content:"\e209"}.glyphicon-equalizer:before{content:"\e210"}.glyphicon-king:before{content:"\e211"}.glyphicon-queen:before{content:"\e212"}.glyphicon-pawn:before{content:"\e213"}.glyphicon-bishop:before{content:"\e214"}.glyphicon-knight:before{content:"\e215"}.glyphicon-baby-formula:before{content:"\e216"}.glyphicon-tent:before{content:"\26fa"}.glyphicon-blackboard:before{content:"\e218"}.glyphicon-bed:before{content:"\e219"}.glyphicon-apple:before{content:"\f8ff"}.glyphicon-erase:before{content:"\e221"}.glyphicon-hourglass:before{content:"\231b"}.glyphicon-lamp:before{content:"\e223"}.glyphicon-duplicate:before{content:"\e224"}.glyphicon-piggy-bank:before{content:"\e225"}.glyphicon-scissors:before{content:"\e226"}.glyphicon-bitcoin:before{content:"\e227"}.glyphicon-btc:before{content:"\e227"}.glyphicon-xbt:before{content:"\e227"}.glyphicon-yen:before{content:"\00a5"}.glyphicon-jpy:before{content:"\00a5"}.glyphicon-ruble:before{content:"\20bd"}.glyphicon-rub:before{content:"\20bd"}.glyphicon-scale:before{content:"\e230"}.glyphicon-ice-lolly:before{content:"\e231"}.glyphicon-ice-lolly-tasted:before{content:"\e232"}.glyphicon-education:before{content:"\e233"}.glyphicon-option-horizontal:before{content:"\e234"}.glyphicon-option-vertical:before{content:"\e235"}.glyphicon-menu-hamburger:before{content:"\e236"}.glyphicon-modal-window:before{content:"\e237"}.glyphicon-oil:before{content:"\e238"}.glyphicon-grain:before{content:"\e239"}.glyphicon-sunglasses:before{content:"\e240"}.glyphicon-text-size:before{content:"\e241"}.glyphicon-text-color:before{content:"\e242"}.glyphicon-text-background:before{content:"\e243"}.glyphicon-object-align-top:before{content:"\e244"}.glyphicon-object-align-bottom:before{content:"\e245"}.glyphicon-object-align-horizontal:before{content:"\e246"}.glyphicon-object-align-left:before{content:"\e247"}.glyphicon-object-align-vertical:before{content:"\e248"}.glyphicon-object-align-right:before{content:"\e249"}.glyphicon-triangle-right:before{content:"\e250"}.glyphicon-triangle-left:before{content:"\e251"}.glyphicon-triangle-bottom:before{content:"\e252"}.glyphicon-triangle-top:before{content:"\e253"}.glyphicon-console:before{content:"\e254"}.glyphicon-superscript:before{content:"\e255"}.glyphicon-subscript:before{content:"\e256"}.glyphicon-menu-left:before{content:"\e257"}.glyphicon-menu-right:before{content:"\e258"}.glyphicon-menu-down:before{content:"\e259"}.glyphicon-menu-up:before{content:"\e260"}*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}html{font-size:10px;-webkit-tap-highlight-color:transparent}body{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:13px;line-height:1.42857143;color:#000;background-color:#fff}button,input,select,textarea{font-family:inherit;font-size:inherit;line-height:inherit}a{color:#337ab7;text-decoration:none}a:focus,a:hover{color:#23527c;text-decoration:underline}a:focus{outline:thin dotted;outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}figure{margin:0}img{vertical-align:middle}.carousel-inner>.item>a>img,.carousel-inner>.item>img,.img-responsive,.thumbnail a>img,.thumbnail>img{display:block;max-width:100%;height:auto}.img-rounded{border-radius:3px}.img-thumbnail{padding:4px;line-height:1.42857143;background-color:#fff;border:1px solid #ddd;border-radius:2px;-webkit-transition:all .2s ease-in-out;-o-transition:all .2s ease-in-out;transition:all .2s ease-in-out;display:inline-block;max-width:100%;height:auto}.img-circle{border-radius:50%}hr{margin-top:18px;margin-bottom:18px;border:0;border-top:1px solid #eee}.sr-only{position:absolute;width:1px;height:1px;margin:-1px;padding:0;overflow:hidden;clip:rect(0,0,0,0);border:0}.sr-only-focusable:active,.sr-only-focusable:focus{position:static;width:auto;height:auto;margin:0;overflow:visible;clip:auto}[role=button]{cursor:pointer}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{font-family:inherit;font-weight:500;line-height:1.1;color:inherit}.h1 .small,.h1 small,.h2 .small,.h2 small,.h3 .small,.h3 small,.h4 .small,.h4 small,.h5 .small,.h5 small,.h6 .small,.h6 small,h1 .small,h1 small,h2 .small,h2 small,h3 .small,h3 small,h4 .small,h4 small,h5 .small,h5 small,h6 .small,h6 small{font-weight:400;line-height:1;color:#777}.h1,.h2,.h3,h1,h2,h3{margin-top:18px;margin-bottom:9px}.h1 .small,.h1 small,.h2 .small,.h2 small,.h3 .small,.h3 small,h1 .small,h1 small,h2 .small,h2 small,h3 .small,h3 small{font-size:65%}.h4,.h5,.h6,h4,h5,h6{margin-top:9px;margin-bottom:9px}.h4 .small,.h4 small,.h5 .small,.h5 small,.h6 .small,.h6 small,h4 .small,h4 small,h5 .small,h5 small,h6 .small,h6 small{font-size:75%}.h1,h1{font-size:33px}.h2,h2{font-size:27px}.h3,h3{font-size:23px}.h4,h4{font-size:17px}.h5,h5{font-size:13px}.h6,h6{font-size:12px}p{margin:0 0 9px}.lead{margin-bottom:18px;font-size:14px;font-weight:300;line-height:1.4}@media (min-width:768px){.lead{font-size:19.5px}}.small,small{font-size:92%}.mark,mark{background-color:#fcf8e3;padding:.2em}.text-left{text-align:left}.text-right{text-align:right}.text-center{text-align:center}.text-justify{text-align:justify}.text-nowrap{white-space:nowrap}.text-lowercase{text-transform:lowercase}.text-uppercase{text-transform:uppercase}.text-capitalize{text-transform:capitalize}.text-muted{color:#777}.text-primary{color:#337ab7}a.text-primary:focus,a.text-primary:hover{color:#286090}.text-success{color:#3c763d}a.text-success:focus,a.text-success:hover{color:#2b542c}.text-info{color:#31708f}a.text-info:focus,a.text-info:hover{color:#245269}.text-warning{color:#8a6d3b}a.text-warning:focus,a.text-warning:hover{color:#66512c}.text-danger{color:#a94442}a.text-danger:focus,a.text-danger:hover{color:#843534}.bg-primary{color:#fff;background-color:#337ab7}a.bg-primary:focus,a.bg-primary:hover{background-color:#286090}.bg-success{background-color:#dff0d8}a.bg-success:focus,a.bg-success:hover{background-color:#c1e2b3}.bg-info{background-color:#d9edf7}a.bg-info:focus,a.bg-info:hover{background-color:#afd9ee}.bg-warning{background-color:#fcf8e3}a.bg-warning:focus,a.bg-warning:hover{background-color:#f7ecb5}.bg-danger{background-color:#f2dede}a.bg-danger:focus,a.bg-danger:hover{background-color:#e4b9b9}.page-header{padding-bottom:8px;margin:36px 0 18px;border-bottom:1px solid #eee}ol,ul{margin-top:0;margin-bottom:9px}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}.list-unstyled{padding-left:0;list-style:none}.list-inline{padding-left:0;list-style:none;margin-left:-5px}.list-inline>li{display:inline-block;padding-left:5px;padding-right:5px}dl{margin-top:0;margin-bottom:18px}dd,dt{line-height:1.42857143}dt{font-weight:700}dd{margin-left:0}@media (min-width:541px){.dl-horizontal dt{float:left;width:160px;clear:left;text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.dl-horizontal dd{margin-left:180px}}abbr[data-original-title],abbr[title]{cursor:help;border-bottom:1px dotted #777}.initialism{font-size:90%;text-transform:uppercase}blockquote{padding:9px 18px;margin:0 0 18px;font-size:inherit;border-left:5px solid #eee}blockquote ol:last-child,blockquote p:last-child,blockquote ul:last-child{margin-bottom:0}blockquote .small,blockquote footer,blockquote small{display:block;font-size:80%;line-height:1.42857143;color:#777}blockquote .small:before,blockquote footer:before,blockquote small:before{content:'\2014 \00A0'}.blockquote-reverse,blockquote.pull-right{padding-right:15px;padding-left:0;border-right:5px solid #eee;border-left:0;text-align:right}.blockquote-reverse .small:before,.blockquote-reverse footer:before,.blockquote-reverse small:before,blockquote.pull-right .small:before,blockquote.pull-right footer:before,blockquote.pull-right small:before{content:''}.blockquote-reverse .small:after,.blockquote-reverse footer:after,.blockquote-reverse small:after,blockquote.pull-right .small:after,blockquote.pull-right footer:after,blockquote.pull-right small:after{content:'\00A0 \2014'}address{margin-bottom:18px;font-style:normal;line-height:1.42857143}code,kbd,pre,samp{font-family:monospace}code{padding:2px 4px;font-size:90%;color:#c7254e;background-color:#f9f2f4;border-radius:2px}kbd{padding:2px 4px;font-size:90%;color:#888;background-color:transparent;border-radius:1px;box-shadow:inset 0 -1px 0 rgba(0,0,0,.25)}kbd kbd{padding:0;font-size:100%;font-weight:700;box-shadow:none}pre{display:block;padding:8.5px;margin:0 0 9px;font-size:12px;line-height:1.42857143;word-break:break-all;word-wrap:break-word;color:#333;background-color:#f5f5f5;border:1px solid #ccc;border-radius:2px}pre code{padding:0;font-size:inherit;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0}.pre-scrollable{max-height:340px;overflow-y:scroll}.container{margin-right:auto;margin-left:auto;padding-left:0;padding-right:0}@media (min-width:768px){.container{width:768px}}@media (min-width:992px){.container{width:940px}}@media (min-width:1200px){.container{width:1140px}}.container-fluid{margin-right:auto;margin-left:auto;padding-left:0;padding-right:0}.row{margin-left:0;margin-right:0}.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9{position:relative;min-height:1px;padding-left:0;padding-right:0}.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9{float:left}.col-xs-12{width:100%}.col-xs-11{width:91.66666667%}.col-xs-10{width:83.33333333%}.col-xs-9{width:75%}.col-xs-8{width:66.66666667%}.col-xs-7{width:58.33333333%}.col-xs-6{width:50%}.col-xs-5{width:41.66666667%}.col-xs-4{width:33.33333333%}.col-xs-3{width:25%}.col-xs-2{width:16.66666667%}.col-xs-1{width:8.33333333%}.col-xs-pull-12{right:100%}.col-xs-pull-11{right:91.66666667%}.col-xs-pull-10{right:83.33333333%}.col-xs-pull-9{right:75%}.col-xs-pull-8{right:66.66666667%}.col-xs-pull-7{right:58.33333333%}.col-xs-pull-6{right:50%}.col-xs-pull-5{right:41.66666667%}.col-xs-pull-4{right:33.33333333%}.col-xs-pull-3{right:25%}.col-xs-pull-2{right:16.66666667%}.col-xs-pull-1{right:8.33333333%}.col-xs-pull-0{right:auto}.col-xs-push-12{left:100%}.col-xs-push-11{left:91.66666667%}.col-xs-push-10{left:83.33333333%}.col-xs-push-9{left:75%}.col-xs-push-8{left:66.66666667%}.col-xs-push-7{left:58.33333333%}.col-xs-push-6{left:50%}.col-xs-push-5{left:41.66666667%}.col-xs-push-4{left:33.33333333%}.col-xs-push-3{left:25%}.col-xs-push-2{left:16.66666667%}.col-xs-push-1{left:8.33333333%}.col-xs-push-0{left:auto}.col-xs-offset-12{margin-left:100%}.col-xs-offset-11{margin-left:91.66666667%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-0{margin-left:0}@media (min-width:768px){.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9{float:left}.col-sm-12{width:100%}.col-sm-11{width:91.66666667%}.col-sm-10{width:83.33333333%}.col-sm-9{width:75%}.col-sm-8{width:66.66666667%}.col-sm-7{width:58.33333333%}.col-sm-6{width:50%}.col-sm-5{width:41.66666667%}.col-sm-4{width:33.33333333%}.col-sm-3{width:25%}.col-sm-2{width:16.66666667%}.col-sm-1{width:8.33333333%}.col-sm-pull-12{right:100%}.col-sm-pull-11{right:91.66666667%}.col-sm-pull-10{right:83.33333333%}.col-sm-pull-9{right:75%}.col-sm-pull-8{right:66.66666667%}.col-sm-pull-7{right:58.33333333%}.col-sm-pull-6{right:50%}.col-sm-pull-5{right:41.66666667%}.col-sm-pull-4{right:33.33333333%}.col-sm-pull-3{right:25%}.col-sm-pull-2{right:16.66666667%}.col-sm-pull-1{right:8.33333333%}.col-sm-pull-0{right:auto}.col-sm-push-12{left:100%}.col-sm-push-11{left:91.66666667%}.col-sm-push-10{left:83.33333333%}.col-sm-push-9{left:75%}.col-sm-push-8{left:66.66666667%}.col-sm-push-7{left:58.33333333%}.col-sm-push-6{left:50%}.col-sm-push-5{left:41.66666667%}.col-sm-push-4{left:33.33333333%}.col-sm-push-3{left:25%}.col-sm-push-2{left:16.66666667%}.col-sm-push-1{left:8.33333333%}.col-sm-push-0{left:auto}.col-sm-offset-12{margin-left:100%}.col-sm-offset-11{margin-left:91.66666667%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-0{margin-left:0}}@media (min-width:992px){.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{float:left}.col-md-12{width:100%}.col-md-11{width:91.66666667%}.col-md-10{width:83.33333333%}.col-md-9{width:75%}.col-md-8{width:66.66666667%}.col-md-7{width:58.33333333%}.col-md-6{width:50%}.col-md-5{width:41.66666667%}.col-md-4{width:33.33333333%}.col-md-3{width:25%}.col-md-2{width:16.66666667%}.col-md-1{width:8.33333333%}.col-md-pull-12{right:100%}.col-md-pull-11{right:91.66666667%}.col-md-pull-10{right:83.33333333%}.col-md-pull-9{right:75%}.col-md-pull-8{right:66.66666667%}.col-md-pull-7{right:58.33333333%}.col-md-pull-6{right:50%}.col-md-pull-5{right:41.66666667%}.col-md-pull-4{right:33.33333333%}.col-md-pull-3{right:25%}.col-md-pull-2{right:16.66666667%}.col-md-pull-1{right:8.33333333%}.col-md-pull-0{right:auto}.col-md-push-12{left:100%}.col-md-push-11{left:91.66666667%}.col-md-push-10{left:83.33333333%}.col-md-push-9{left:75%}.col-md-push-8{left:66.66666667%}.col-md-push-7{left:58.33333333%}.col-md-push-6{left:50%}.col-md-push-5{left:41.66666667%}.col-md-push-4{left:33.33333333%}.col-md-push-3{left:25%}.col-md-push-2{left:16.66666667%}.col-md-push-1{left:8.33333333%}.col-md-push-0{left:auto}.col-md-offset-12{margin-left:100%}.col-md-offset-11{margin-left:91.66666667%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-9{margin-left:75%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-6{margin-left:50%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-3{margin-left:25%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-0{margin-left:0}}@media (min-width:1200px){.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9{float:left}.col-lg-12{width:100%}.col-lg-11{width:91.66666667%}.col-lg-10{width:83.33333333%}.col-lg-9{width:75%}.col-lg-8{width:66.66666667%}.col-lg-7{width:58.33333333%}.col-lg-6{width:50%}.col-lg-5{width:41.66666667%}.col-lg-4{width:33.33333333%}.col-lg-3{width:25%}.col-lg-2{width:16.66666667%}.col-lg-1{width:8.33333333%}.col-lg-pull-12{right:100%}.col-lg-pull-11{right:91.66666667%}.col-lg-pull-10{right:83.33333333%}.col-lg-pull-9{right:75%}.col-lg-pull-8{right:66.66666667%}.col-lg-pull-7{right:58.33333333%}.col-lg-pull-6{right:50%}.col-lg-pull-5{right:41.66666667%}.col-lg-pull-4{right:33.33333333%}.col-lg-pull-3{right:25%}.col-lg-pull-2{right:16.66666667%}.col-lg-pull-1{right:8.33333333%}.col-lg-pull-0{right:auto}.col-lg-push-12{left:100%}.col-lg-push-11{left:91.66666667%}.col-lg-push-10{left:83.33333333%}.col-lg-push-9{left:75%}.col-lg-push-8{left:66.66666667%}.col-lg-push-7{left:58.33333333%}.col-lg-push-6{left:50%}.col-lg-push-5{left:41.66666667%}.col-lg-push-4{left:33.33333333%}.col-lg-push-3{left:25%}.col-lg-push-2{left:16.66666667%}.col-lg-push-1{left:8.33333333%}.col-lg-push-0{left:auto}.col-lg-offset-12{margin-left:100%}.col-lg-offset-11{margin-left:91.66666667%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-0{margin-left:0}}table{background-color:transparent}caption{padding-top:8px;padding-bottom:8px;color:#777;text-align:left}th{text-align:left}.table{width:100%;max-width:100%;margin-bottom:18px}.table>tbody>tr>td,.table>tbody>tr>th,.table>tfoot>tr>td,.table>tfoot>tr>th,.table>thead>tr>td,.table>thead>tr>th{padding:8px;line-height:1.42857143;vertical-align:top;border-top:1px solid #ddd}.table>thead>tr>th{vertical-align:bottom;border-bottom:2px solid #ddd}.table>caption+thead>tr:first-child>td,.table>caption+thead>tr:first-child>th,.table>colgroup+thead>tr:first-child>td,.table>colgroup+thead>tr:first-child>th,.table>thead:first-child>tr:first-child>td,.table>thead:first-child>tr:first-child>th{border-top:0}.table>tbody+tbody{border-top:2px solid #ddd}.table .table{background-color:#fff}.table-condensed>tbody>tr>td,.table-condensed>tbody>tr>th,.table-condensed>tfoot>tr>td,.table-condensed>tfoot>tr>th,.table-condensed>thead>tr>td,.table-condensed>thead>tr>th{padding:5px}.table-bordered{border:1px solid #ddd}.table-bordered>tbody>tr>td,.table-bordered>tbody>tr>th,.table-bordered>tfoot>tr>td,.table-bordered>tfoot>tr>th,.table-bordered>thead>tr>td,.table-bordered>thead>tr>th{border:1px solid #ddd}.table-bordered>thead>tr>td,.table-bordered>thead>tr>th{border-bottom-width:2px}.table-striped>tbody>tr:nth-of-type(odd){background-color:#f9f9f9}.table-hover>tbody>tr:hover{background-color:#f5f5f5}table col[class*=col-]{position:static;float:none;display:table-column}table td[class*=col-],table th[class*=col-]{position:static;float:none;display:table-cell}.table>tbody>tr.active>td,.table>tbody>tr.active>th,.table>tbody>tr>td.active,.table>tbody>tr>th.active,.table>tfoot>tr.active>td,.table>tfoot>tr.active>th,.table>tfoot>tr>td.active,.table>tfoot>tr>th.active,.table>thead>tr.active>td,.table>thead>tr.active>th,.table>thead>tr>td.active,.table>thead>tr>th.active{background-color:#f5f5f5}.table-hover>tbody>tr.active:hover>td,.table-hover>tbody>tr.active:hover>th,.table-hover>tbody>tr:hover>.active,.table-hover>tbody>tr>td.active:hover,.table-hover>tbody>tr>th.active:hover{background-color:#e8e8e8}.table>tbody>tr.success>td,.table>tbody>tr.success>th,.table>tbody>tr>td.success,.table>tbody>tr>th.success,.table>tfoot>tr.success>td,.table>tfoot>tr.success>th,.table>tfoot>tr>td.success,.table>tfoot>tr>th.success,.table>thead>tr.success>td,.table>thead>tr.success>th,.table>thead>tr>td.success,.table>thead>tr>th.success{background-color:#dff0d8}.table-hover>tbody>tr.success:hover>td,.table-hover>tbody>tr.success:hover>th,.table-hover>tbody>tr:hover>.success,.table-hover>tbody>tr>td.success:hover,.table-hover>tbody>tr>th.success:hover{background-color:#d0e9c6}.table>tbody>tr.info>td,.table>tbody>tr.info>th,.table>tbody>tr>td.info,.table>tbody>tr>th.info,.table>tfoot>tr.info>td,.table>tfoot>tr.info>th,.table>tfoot>tr>td.info,.table>tfoot>tr>th.info,.table>thead>tr.info>td,.table>thead>tr.info>th,.table>thead>tr>td.info,.table>thead>tr>th.info{background-color:#d9edf7}.table-hover>tbody>tr.info:hover>td,.table-hover>tbody>tr.info:hover>th,.table-hover>tbody>tr:hover>.info,.table-hover>tbody>tr>td.info:hover,.table-hover>tbody>tr>th.info:hover{background-color:#c4e3f3}.table>tbody>tr.warning>td,.table>tbody>tr.warning>th,.table>tbody>tr>td.warning,.table>tbody>tr>th.warning,.table>tfoot>tr.warning>td,.table>tfoot>tr.warning>th,.table>tfoot>tr>td.warning,.table>tfoot>tr>th.warning,.table>thead>tr.warning>td,.table>thead>tr.warning>th,.table>thead>tr>td.warning,.table>thead>tr>th.warning{background-color:#fcf8e3}.table-hover>tbody>tr.warning:hover>td,.table-hover>tbody>tr.warning:hover>th,.table-hover>tbody>tr:hover>.warning,.table-hover>tbody>tr>td.warning:hover,.table-hover>tbody>tr>th.warning:hover{background-color:#faf2cc}.table>tbody>tr.danger>td,.table>tbody>tr.danger>th,.table>tbody>tr>td.danger,.table>tbody>tr>th.danger,.table>tfoot>tr.danger>td,.table>tfoot>tr.danger>th,.table>tfoot>tr>td.danger,.table>tfoot>tr>th.danger,.table>thead>tr.danger>td,.table>thead>tr.danger>th,.table>thead>tr>td.danger,.table>thead>tr>th.danger{background-color:#f2dede}.table-hover>tbody>tr.danger:hover>td,.table-hover>tbody>tr.danger:hover>th,.table-hover>tbody>tr:hover>.danger,.table-hover>tbody>tr>td.danger:hover,.table-hover>tbody>tr>th.danger:hover{background-color:#ebcccc}.table-responsive{overflow-x:auto;min-height:.01%}@media screen and (max-width:767px){.table-responsive{width:100%;margin-bottom:13.5px;overflow-y:hidden;-ms-overflow-style:-ms-autohiding-scrollbar;border:1px solid #ddd}.table-responsive>.table{margin-bottom:0}.table-responsive>.table>tbody>tr>td,.table-responsive>.table>tbody>tr>th,.table-responsive>.table>tfoot>tr>td,.table-responsive>.table>tfoot>tr>th,.table-responsive>.table>thead>tr>td,.table-responsive>.table>thead>tr>th{white-space:nowrap}.table-responsive>.table-bordered{border:0}.table-responsive>.table-bordered>tbody>tr>td:first-child,.table-responsive>.table-bordered>tbody>tr>th:first-child,.table-responsive>.table-bordered>tfoot>tr>td:first-child,.table-responsive>.table-bordered>tfoot>tr>th:first-child,.table-responsive>.table-bordered>thead>tr>td:first-child,.table-responsive>.table-bordered>thead>tr>th:first-child{border-left:0}.table-responsive>.table-bordered>tbody>tr>td:last-child,.table-responsive>.table-bordered>tbody>tr>th:last-child,.table-responsive>.table-bordered>tfoot>tr>td:last-child,.table-responsive>.table-bordered>tfoot>tr>th:last-child,.table-responsive>.table-bordered>thead>tr>td:last-child,.table-responsive>.table-bordered>thead>tr>th:last-child{border-right:0}.table-responsive>.table-bordered>tbody>tr:last-child>td,.table-responsive>.table-bordered>tbody>tr:last-child>th,.table-responsive>.table-bordered>tfoot>tr:last-child>td,.table-responsive>.table-bordered>tfoot>tr:last-child>th{border-bottom:0}}fieldset{padding:0;margin:0;border:0;min-width:0}legend{display:block;width:100%;padding:0;margin-bottom:18px;font-size:19.5px;line-height:inherit;color:#333;border:0;border-bottom:1px solid #e5e5e5}label{display:inline-block;max-width:100%;margin-bottom:5px;font-weight:700}input[type=search]{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}input[type=checkbox],input[type=radio]{margin:4px 0 0;margin-top:1px\9;line-height:normal}input[type=file]{display:block}input[type=range]{display:block;width:100%}select[multiple],select[size]{height:auto}input[type=file]:focus,input[type=checkbox]:focus,input[type=radio]:focus{outline:thin dotted;outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}output{display:block;padding-top:7px;font-size:13px;line-height:1.42857143;color:#555}.form-control{display:block;width:100%;height:32px;padding:6px 12px;font-size:13px;line-height:1.42857143;color:#555;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:2px;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075);-webkit-transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;-o-transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}.form-control:focus{border-color:#66afe9;outline:0;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)}.form-control::-moz-placeholder{color:#999;opacity:1}.form-control:-ms-input-placeholder{color:#999}.form-control::-webkit-input-placeholder{color:#999}.form-control::-ms-expand{border:0;background-color:transparent}.form-control[disabled],.form-control[readonly],fieldset[disabled] .form-control{background-color:#eee;opacity:1}.form-control[disabled],fieldset[disabled] .form-control{cursor:not-allowed}textarea.form-control{height:auto}input[type=search]{-webkit-appearance:none}@media screen and (-webkit-min-device-pixel-ratio:0){input[type=date].form-control,input[type=time].form-control,input[type=datetime-local].form-control,input[type=month].form-control{line-height:32px}.input-group-sm input[type=date],.input-group-sm input[type=time],.input-group-sm input[type=datetime-local],.input-group-sm input[type=month],input[type=date].input-sm,input[type=time].input-sm,input[type=datetime-local].input-sm,input[type=month].input-sm{line-height:30px}.input-group-lg input[type=date],.input-group-lg input[type=time],.input-group-lg input[type=datetime-local],.input-group-lg input[type=month],input[type=date].input-lg,input[type=time].input-lg,input[type=datetime-local].input-lg,input[type=month].input-lg{line-height:45px}}.form-group{margin-bottom:15px}.checkbox,.radio{position:relative;display:block;margin-top:10px;margin-bottom:10px}.checkbox label,.radio label{min-height:18px;padding-left:20px;margin-bottom:0;font-weight:400;cursor:pointer}.checkbox input[type=checkbox],.checkbox-inline input[type=checkbox],.radio input[type=radio],.radio-inline input[type=radio]{position:absolute;margin-left:-20px;margin-top:4px\9}.checkbox+.checkbox,.radio+.radio{margin-top:-5px}.checkbox-inline,.radio-inline{position:relative;display:inline-block;padding-left:20px;margin-bottom:0;vertical-align:middle;font-weight:400;cursor:pointer}.checkbox-inline+.checkbox-inline,.radio-inline+.radio-inline{margin-top:0;margin-left:10px}fieldset[disabled] input[type=checkbox],fieldset[disabled] input[type=radio],input[type=checkbox].disabled,input[type=checkbox][disabled],input[type=radio].disabled,input[type=radio][disabled]{cursor:not-allowed}.checkbox-inline.disabled,.radio-inline.disabled,fieldset[disabled] .checkbox-inline,fieldset[disabled] .radio-inline{cursor:not-allowed}.checkbox.disabled label,.radio.disabled label,fieldset[disabled] .checkbox label,fieldset[disabled] .radio label{cursor:not-allowed}.form-control-static{padding-top:7px;padding-bottom:7px;margin-bottom:0;min-height:31px}.form-control-static.input-lg,.form-control-static.input-sm{padding-left:0;padding-right:0}.input-sm{height:30px;padding:5px 10px;font-size:12px;line-height:1.5;border-radius:1px}select.input-sm{height:30px;line-height:30px}select[multiple].input-sm,textarea.input-sm{height:auto}.form-group-sm .form-control{height:30px;padding:5px 10px;font-size:12px;line-height:1.5;border-radius:1px}.form-group-sm select.form-control{height:30px;line-height:30px}.form-group-sm select[multiple].form-control,.form-group-sm textarea.form-control{height:auto}.form-group-sm .form-control-static{height:30px;min-height:30px;padding:6px 10px;font-size:12px;line-height:1.5}.input-lg{height:45px;padding:10px 16px;font-size:17px;line-height:1.3333333;border-radius:3px}select.input-lg{height:45px;line-height:45px}select[multiple].input-lg,textarea.input-lg{height:auto}.form-group-lg .form-control{height:45px;padding:10px 16px;font-size:17px;line-height:1.3333333;border-radius:3px}.form-group-lg select.form-control{height:45px;line-height:45px}.form-group-lg select[multiple].form-control,.form-group-lg textarea.form-control{height:auto}.form-group-lg .form-control-static{height:45px;min-height:35px;padding:11px 16px;font-size:17px;line-height:1.3333333}.has-feedback{position:relative}.has-feedback .form-control{padding-right:40px}.form-control-feedback{position:absolute;top:0;right:0;z-index:2;display:block;width:32px;height:32px;line-height:32px;text-align:center;pointer-events:none}.form-group-lg .form-control+.form-control-feedback,.input-group-lg+.form-control-feedback,.input-lg+.form-control-feedback{width:45px;height:45px;line-height:45px}.form-group-sm .form-control+.form-control-feedback,.input-group-sm+.form-control-feedback,.input-sm+.form-control-feedback{width:30px;height:30px;line-height:30px}.has-success .checkbox,.has-success .checkbox-inline,.has-success .control-label,.has-success .help-block,.has-success .radio,.has-success .radio-inline,.has-success.checkbox label,.has-success.checkbox-inline label,.has-success.radio label,.has-success.radio-inline label{color:#3c763d}.has-success .form-control{border-color:#3c763d;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-success .form-control:focus{border-color:#2b542c;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #67b168;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #67b168}.has-success .input-group-addon{color:#3c763d;border-color:#3c763d;background-color:#dff0d8}.has-success .form-control-feedback{color:#3c763d}.has-warning .checkbox,.has-warning .checkbox-inline,.has-warning .control-label,.has-warning .help-block,.has-warning .radio,.has-warning .radio-inline,.has-warning.checkbox label,.has-warning.checkbox-inline label,.has-warning.radio label,.has-warning.radio-inline label{color:#8a6d3b}.has-warning .form-control{border-color:#8a6d3b;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-warning .form-control:focus{border-color:#66512c;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #c0a16b;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #c0a16b}.has-warning .input-group-addon{color:#8a6d3b;border-color:#8a6d3b;background-color:#fcf8e3}.has-warning .form-control-feedback{color:#8a6d3b}.has-error .checkbox,.has-error .checkbox-inline,.has-error .control-label,.has-error .help-block,.has-error .radio,.has-error .radio-inline,.has-error.checkbox label,.has-error.checkbox-inline label,.has-error.radio label,.has-error.radio-inline label{color:#a94442}.has-error .form-control{border-color:#a94442;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-error .form-control:focus{border-color:#843534;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #ce8483;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #ce8483}.has-error .input-group-addon{color:#a94442;border-color:#a94442;background-color:#f2dede}.has-error .form-control-feedback{color:#a94442}.has-feedback label~.form-control-feedback{top:23px}.has-feedback label.sr-only~.form-control-feedback{top:0}.help-block{display:block;margin-top:5px;margin-bottom:10px;color:#404040}@media (min-width:768px){.form-inline .form-group{display:inline-block;margin-bottom:0;vertical-align:middle}.form-inline .form-control{display:inline-block;width:auto;vertical-align:middle}.form-inline .form-control-static{display:inline-block}.form-inline .input-group{display:inline-table;vertical-align:middle}.form-inline .input-group .form-control,.form-inline .input-group .input-group-addon,.form-inline .input-group .input-group-btn{width:auto}.form-inline .input-group>.form-control{width:100%}.form-inline .control-label{margin-bottom:0;vertical-align:middle}.form-inline .checkbox,.form-inline .radio{display:inline-block;margin-top:0;margin-bottom:0;vertical-align:middle}.form-inline .checkbox label,.form-inline .radio label{padding-left:0}.form-inline .checkbox input[type=checkbox],.form-inline .radio input[type=radio]{position:relative;margin-left:0}.form-inline .has-feedback .form-control-feedback{top:0}}.form-horizontal .checkbox,.form-horizontal .checkbox-inline,.form-horizontal .radio,.form-horizontal .radio-inline{margin-top:0;margin-bottom:0;padding-top:7px}.form-horizontal .checkbox,.form-horizontal .radio{min-height:25px}.form-horizontal .form-group{margin-left:0;margin-right:0}@media (min-width:768px){.form-horizontal .control-label{text-align:right;margin-bottom:0;padding-top:7px}}.form-horizontal .has-feedback .form-control-feedback{right:0}@media (min-width:768px){.form-horizontal .form-group-lg .control-label{padding-top:11px;font-size:17px}}@media (min-width:768px){.form-horizontal .form-group-sm .control-label{padding-top:6px;font-size:12px}}.btn{display:inline-block;margin-bottom:0;font-weight:400;text-align:center;vertical-align:middle;touch-action:manipulation;cursor:pointer;background-image:none;border:1px solid transparent;white-space:nowrap;padding:6px 12px;font-size:13px;line-height:1.42857143;border-radius:2px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.btn.active.focus,.btn.active:focus,.btn.focus,.btn:active.focus,.btn:active:focus,.btn:focus{outline:thin dotted;outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}.btn.focus,.btn:focus,.btn:hover{color:#333;text-decoration:none}.btn.active,.btn:active{outline:0;background-image:none;-webkit-box-shadow:inset 0 3px 5px rgba(0,0,0,.125);box-shadow:inset 0 3px 5px rgba(0,0,0,.125)}.btn.disabled,.btn[disabled],fieldset[disabled] .btn{cursor:not-allowed;opacity:.65;filter:alpha(opacity=65);-webkit-box-shadow:none;box-shadow:none}a.btn.disabled,fieldset[disabled] a.btn{pointer-events:none}.btn-default{color:#333;background-color:#fff;border-color:#ccc}.btn-default.focus,.btn-default:focus{color:#333;background-color:#e6e6e6;border-color:#8c8c8c}.btn-default:hover{color:#333;background-color:#e6e6e6;border-color:#adadad}.btn-default.active,.btn-default:active,.open>.dropdown-toggle.btn-default{color:#333;background-color:#e6e6e6;border-color:#adadad}.btn-default.active.focus,.btn-default.active:focus,.btn-default.active:hover,.btn-default:active.focus,.btn-default:active:focus,.btn-default:active:hover,.open>.dropdown-toggle.btn-default.focus,.open>.dropdown-toggle.btn-default:focus,.open>.dropdown-toggle.btn-default:hover{color:#333;background-color:#d4d4d4;border-color:#8c8c8c}.btn-default.active,.btn-default:active,.open>.dropdown-toggle.btn-default{background-image:none}.btn-default.disabled.focus,.btn-default.disabled:focus,.btn-default.disabled:hover,.btn-default[disabled].focus,.btn-default[disabled]:focus,.btn-default[disabled]:hover,fieldset[disabled] .btn-default.focus,fieldset[disabled] .btn-default:focus,fieldset[disabled] .btn-default:hover{background-color:#fff;border-color:#ccc}.btn-default .badge{color:#fff;background-color:#333}.btn-primary{color:#fff;background-color:#337ab7;border-color:#2e6da4}.btn-primary.focus,.btn-primary:focus{color:#fff;background-color:#286090;border-color:#122b40}.btn-primary:hover{color:#fff;background-color:#286090;border-color:#204d74}.btn-primary.active,.btn-primary:active,.open>.dropdown-toggle.btn-primary{color:#fff;background-color:#286090;border-color:#204d74}.btn-primary.active.focus,.btn-primary.active:focus,.btn-primary.active:hover,.btn-primary:active.focus,.btn-primary:active:focus,.btn-primary:active:hover,.open>.dropdown-toggle.btn-primary.focus,.open>.dropdown-toggle.btn-primary:focus,.open>.dropdown-toggle.btn-primary:hover{color:#fff;background-color:#204d74;border-color:#122b40}.btn-primary.active,.btn-primary:active,.open>.dropdown-toggle.btn-primary{background-image:none}.btn-primary.disabled.focus,.btn-primary.disabled:focus,.btn-primary.disabled:hover,.btn-primary[disabled].focus,.btn-primary[disabled]:focus,.btn-primary[disabled]:hover,fieldset[disabled] .btn-primary.focus,fieldset[disabled] .btn-primary:focus,fieldset[disabled] .btn-primary:hover{background-color:#337ab7;border-color:#2e6da4}.btn-primary .badge{color:#337ab7;background-color:#fff}.btn-success{color:#fff;background-color:#5cb85c;border-color:#4cae4c}.btn-success.focus,.btn-success:focus{color:#fff;background-color:#449d44;border-color:#255625}.btn-success:hover{color:#fff;background-color:#449d44;border-color:#398439}.btn-success.active,.btn-success:active,.open>.dropdown-toggle.btn-success{color:#fff;background-color:#449d44;border-color:#398439}.btn-success.active.focus,.btn-success.active:focus,.btn-success.active:hover,.btn-success:active.focus,.btn-success:active:focus,.btn-success:active:hover,.open>.dropdown-toggle.btn-success.focus,.open>.dropdown-toggle.btn-success:focus,.open>.dropdown-toggle.btn-success:hover{color:#fff;background-color:#398439;border-color:#255625}.btn-success.active,.btn-success:active,.open>.dropdown-toggle.btn-success{background-image:none}.btn-success.disabled.focus,.btn-success.disabled:focus,.btn-success.disabled:hover,.btn-success[disabled].focus,.btn-success[disabled]:focus,.btn-success[disabled]:hover,fieldset[disabled] .btn-success.focus,fieldset[disabled] .btn-success:focus,fieldset[disabled] .btn-success:hover{background-color:#5cb85c;border-color:#4cae4c}.btn-success .badge{color:#5cb85c;background-color:#fff}.btn-info{color:#fff;background-color:#5bc0de;border-color:#46b8da}.btn-info.focus,.btn-info:focus{color:#fff;background-color:#31b0d5;border-color:#1b6d85}.btn-info:hover{color:#fff;background-color:#31b0d5;border-color:#269abc}.btn-info.active,.btn-info:active,.open>.dropdown-toggle.btn-info{color:#fff;background-color:#31b0d5;border-color:#269abc}.btn-info.active.focus,.btn-info.active:focus,.btn-info.active:hover,.btn-info:active.focus,.btn-info:active:focus,.btn-info:active:hover,.open>.dropdown-toggle.btn-info.focus,.open>.dropdown-toggle.btn-info:focus,.open>.dropdown-toggle.btn-info:hover{color:#fff;background-color:#269abc;border-color:#1b6d85}.btn-info.active,.btn-info:active,.open>.dropdown-toggle.btn-info{background-image:none}.btn-info.disabled.focus,.btn-info.disabled:focus,.btn-info.disabled:hover,.btn-info[disabled].focus,.btn-info[disabled]:focus,.btn-info[disabled]:hover,fieldset[disabled] .btn-info.focus,fieldset[disabled] .btn-info:focus,fieldset[disabled] .btn-info:hover{background-color:#5bc0de;border-color:#46b8da}.btn-info .badge{color:#5bc0de;background-color:#fff}.btn-warning{color:#fff;background-color:#f0ad4e;border-color:#eea236}.btn-warning.focus,.btn-warning:focus{color:#fff;background-color:#ec971f;border-color:#985f0d}.btn-warning:hover{color:#fff;background-color:#ec971f;border-color:#d58512}.btn-warning.active,.btn-warning:active,.open>.dropdown-toggle.btn-warning{color:#fff;background-color:#ec971f;border-color:#d58512}.btn-warning.active.focus,.btn-warning.active:focus,.btn-warning.active:hover,.btn-warning:active.focus,.btn-warning:active:focus,.btn-warning:active:hover,.open>.dropdown-toggle.btn-warning.focus,.open>.dropdown-toggle.btn-warning:focus,.open>.dropdown-toggle.btn-warning:hover{color:#fff;background-color:#d58512;border-color:#985f0d}.btn-warning.active,.btn-warning:active,.open>.dropdown-toggle.btn-warning{background-image:none}.btn-warning.disabled.focus,.btn-warning.disabled:focus,.btn-warning.disabled:hover,.btn-warning[disabled].focus,.btn-warning[disabled]:focus,.btn-warning[disabled]:hover,fieldset[disabled] .btn-warning.focus,fieldset[disabled] .btn-warning:focus,fieldset[disabled] .btn-warning:hover{background-color:#f0ad4e;border-color:#eea236}.btn-warning .badge{color:#f0ad4e;background-color:#fff}.btn-danger{color:#fff;background-color:#d9534f;border-color:#d43f3a}.btn-danger.focus,.btn-danger:focus{color:#fff;background-color:#c9302c;border-color:#761c19}.btn-danger:hover{color:#fff;background-color:#c9302c;border-color:#ac2925}.btn-danger.active,.btn-danger:active,.open>.dropdown-toggle.btn-danger{color:#fff;background-color:#c9302c;border-color:#ac2925}.btn-danger.active.focus,.btn-danger.active:focus,.btn-danger.active:hover,.btn-danger:active.focus,.btn-danger:active:focus,.btn-danger:active:hover,.open>.dropdown-toggle.btn-danger.focus,.open>.dropdown-toggle.btn-danger:focus,.open>.dropdown-toggle.btn-danger:hover{color:#fff;background-color:#ac2925;border-color:#761c19}.btn-danger.active,.btn-danger:active,.open>.dropdown-toggle.btn-danger{background-image:none}.btn-danger.disabled.focus,.btn-danger.disabled:focus,.btn-danger.disabled:hover,.btn-danger[disabled].focus,.btn-danger[disabled]:focus,.btn-danger[disabled]:hover,fieldset[disabled] .btn-danger.focus,fieldset[disabled] .btn-danger:focus,fieldset[disabled] .btn-danger:hover{background-color:#d9534f;border-color:#d43f3a}.btn-danger .badge{color:#d9534f;background-color:#fff}.btn-link{color:#337ab7;font-weight:400;border-radius:0}.btn-link,.btn-link.active,.btn-link:active,.btn-link[disabled],fieldset[disabled] .btn-link{background-color:transparent;-webkit-box-shadow:none;box-shadow:none}.btn-link,.btn-link:active,.btn-link:focus,.btn-link:hover{border-color:transparent}.btn-link:focus,.btn-link:hover{color:#23527c;text-decoration:underline;background-color:transparent}.btn-link[disabled]:focus,.btn-link[disabled]:hover,fieldset[disabled] .btn-link:focus,fieldset[disabled] .btn-link:hover{color:#777;text-decoration:none}.btn-group-lg>.btn,.btn-lg{padding:10px 16px;font-size:17px;line-height:1.3333333;border-radius:3px}.btn-group-sm>.btn,.btn-sm{padding:5px 10px;font-size:12px;line-height:1.5;border-radius:1px}.btn-group-xs>.btn,.btn-xs{padding:1px 5px;font-size:12px;line-height:1.5;border-radius:1px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:5px}input[type=button].btn-block,input[type=reset].btn-block,input[type=submit].btn-block{width:100%}.fade{opacity:0;-webkit-transition:opacity .15s linear;-o-transition:opacity .15s linear;transition:opacity .15s linear}.fade.in{opacity:1}.collapse{display:none}.collapse.in{display:block}tr.collapse.in{display:table-row}tbody.collapse.in{display:table-row-group}.collapsing{position:relative;height:0;overflow:hidden;-webkit-transition-property:height,visibility;transition-property:height,visibility;-webkit-transition-duration:.35s;transition-duration:.35s;-webkit-transition-timing-function:ease;transition-timing-function:ease}.caret{display:inline-block;width:0;height:0;margin-left:2px;vertical-align:middle;border-top:4px dashed;border-top:4px solid\9;border-right:4px solid transparent;border-left:4px solid transparent}.dropdown,.dropup{position:relative}.dropdown-toggle:focus{outline:0}.dropdown-menu{position:absolute;top:100%;left:0;z-index:1000;display:none;float:left;min-width:160px;padding:5px 0;margin:2px 0 0;list-style:none;font-size:13px;text-align:left;background-color:#fff;border:1px solid #ccc;border:1px solid rgba(0,0,0,.15);border-radius:2px;-webkit-box-shadow:0 6px 12px rgba(0,0,0,.175);box-shadow:0 6px 12px rgba(0,0,0,.175);background-clip:padding-box}.dropdown-menu.pull-right{right:0;left:auto}.dropdown-menu .divider{height:1px;margin:8px 0;overflow:hidden;background-color:#e5e5e5}.dropdown-menu>li>a{display:block;padding:3px 20px;clear:both;font-weight:400;line-height:1.42857143;color:#333;white-space:nowrap}.dropdown-menu>li>a:focus,.dropdown-menu>li>a:hover{text-decoration:none;color:#262626;background-color:#f5f5f5}.dropdown-menu>.active>a,.dropdown-menu>.active>a:focus,.dropdown-menu>.active>a:hover{color:#fff;text-decoration:none;outline:0;background-color:#337ab7}.dropdown-menu>.disabled>a,.dropdown-menu>.disabled>a:focus,.dropdown-menu>.disabled>a:hover{color:#777}.dropdown-menu>.disabled>a:focus,.dropdown-menu>.disabled>a:hover{text-decoration:none;background-color:transparent;background-image:none;filter:progid:DXImageTransform.Microsoft.gradient(enabled=false);cursor:not-allowed}.open>.dropdown-menu{display:block}.open>a{outline:0}.dropdown-menu-right{left:auto;right:0}.dropdown-menu-left{left:0;right:auto}.dropdown-header{display:block;padding:3px 20px;font-size:12px;line-height:1.42857143;color:#777;white-space:nowrap}.dropdown-backdrop{position:fixed;left:0;right:0;bottom:0;top:0;z-index:990}.pull-right>.dropdown-menu{right:0;left:auto}.dropup .caret,.navbar-fixed-bottom .dropdown .caret{border-top:0;border-bottom:4px dashed;border-bottom:4px solid\9;content:""}.dropup .dropdown-menu,.navbar-fixed-bottom .dropdown .dropdown-menu{top:auto;bottom:100%;margin-bottom:2px}@media (min-width:541px){.navbar-right .dropdown-menu{left:auto;right:0}.navbar-right .dropdown-menu-left{left:0;right:auto}}.btn-group,.btn-group-vertical{position:relative;display:inline-block;vertical-align:middle}.btn-group-vertical>.btn,.btn-group>.btn{position:relative;float:left}.btn-group-vertical>.btn.active,.btn-group-vertical>.btn:active,.btn-group-vertical>.btn:focus,.btn-group-vertical>.btn:hover,.btn-group>.btn.active,.btn-group>.btn:active,.btn-group>.btn:focus,.btn-group>.btn:hover{z-index:2}.btn-group .btn+.btn,.btn-group .btn+.btn-group,.btn-group .btn-group+.btn,.btn-group .btn-group+.btn-group{margin-left:-1px}.btn-toolbar{margin-left:-5px}.btn-toolbar .btn,.btn-toolbar .btn-group,.btn-toolbar .input-group{float:left}.btn-toolbar>.btn,.btn-toolbar>.btn-group,.btn-toolbar>.input-group{margin-left:5px}.btn-group>.btn:not(:first-child):not(:last-child):not(.dropdown-toggle){border-radius:0}.btn-group>.btn:first-child{margin-left:0}.btn-group>.btn:first-child:not(:last-child):not(.dropdown-toggle){border-bottom-right-radius:0;border-top-right-radius:0}.btn-group>.btn:last-child:not(:first-child),.btn-group>.dropdown-toggle:not(:first-child){border-bottom-left-radius:0;border-top-left-radius:0}.btn-group>.btn-group{float:left}.btn-group>.btn-group:not(:first-child):not(:last-child)>.btn{border-radius:0}.btn-group>.btn-group:first-child:not(:last-child)>.btn:last-child,.btn-group>.btn-group:first-child:not(:last-child)>.dropdown-toggle{border-bottom-right-radius:0;border-top-right-radius:0}.btn-group>.btn-group:last-child:not(:first-child)>.btn:first-child{border-bottom-left-radius:0;border-top-left-radius:0}.btn-group .dropdown-toggle:active,.btn-group.open .dropdown-toggle{outline:0}.btn-group>.btn+.dropdown-toggle{padding-left:8px;padding-right:8px}.btn-group>.btn-lg+.dropdown-toggle{padding-left:12px;padding-right:12px}.btn-group.open .dropdown-toggle{-webkit-box-shadow:inset 0 3px 5px rgba(0,0,0,.125);box-shadow:inset 0 3px 5px rgba(0,0,0,.125)}.btn-group.open .dropdown-toggle.btn-link{-webkit-box-shadow:none;box-shadow:none}.btn .caret{margin-left:0}.btn-lg .caret{border-width:5px 5px 0;border-bottom-width:0}.dropup .btn-lg .caret{border-width:0 5px 5px}.btn-group-vertical>.btn,.btn-group-vertical>.btn-group,.btn-group-vertical>.btn-group>.btn{display:block;float:none;width:100%;max-width:100%}.btn-group-vertical>.btn-group>.btn{float:none}.btn-group-vertical>.btn+.btn,.btn-group-vertical>.btn+.btn-group,.btn-group-vertical>.btn-group+.btn,.btn-group-vertical>.btn-group+.btn-group{margin-top:-1px;margin-left:0}.btn-group-vertical>.btn:not(:first-child):not(:last-child){border-radius:0}.btn-group-vertical>.btn:first-child:not(:last-child){border-top-right-radius:2px;border-top-left-radius:2px;border-bottom-right-radius:0;border-bottom-left-radius:0}.btn-group-vertical>.btn:last-child:not(:first-child){border-top-right-radius:0;border-top-left-radius:0;border-bottom-right-radius:2px;border-bottom-left-radius:2px}.btn-group-vertical>.btn-group:not(:first-child):not(:last-child)>.btn{border-radius:0}.btn-group-vertical>.btn-group:first-child:not(:last-child)>.btn:last-child,.btn-group-vertical>.btn-group:first-child:not(:last-child)>.dropdown-toggle{border-bottom-right-radius:0;border-bottom-left-radius:0}.btn-group-vertical>.btn-group:last-child:not(:first-child)>.btn:first-child{border-top-right-radius:0;border-top-left-radius:0}.btn-group-justified{display:table;width:100%;table-layout:fixed;border-collapse:separate}.btn-group-justified>.btn,.btn-group-justified>.btn-group{float:none;display:table-cell;width:1%}.btn-group-justified>.btn-group .btn{width:100%}.btn-group-justified>.btn-group .dropdown-menu{left:auto}[data-toggle=buttons]>.btn input[type=checkbox],[data-toggle=buttons]>.btn input[type=radio],[data-toggle=buttons]>.btn-group>.btn input[type=checkbox],[data-toggle=buttons]>.btn-group>.btn input[type=radio]{position:absolute;clip:rect(0,0,0,0);pointer-events:none}.input-group{position:relative;display:table;border-collapse:separate}.input-group[class*=col-]{float:none;padding-left:0;padding-right:0}.input-group .form-control{position:relative;z-index:2;float:left;width:100%;margin-bottom:0}.input-group .form-control:focus{z-index:3}.input-group-lg>.form-control,.input-group-lg>.input-group-addon,.input-group-lg>.input-group-btn>.btn{height:45px;padding:10px 16px;font-size:17px;line-height:1.3333333;border-radius:3px}select.input-group-lg>.form-control,select.input-group-lg>.input-group-addon,select.input-group-lg>.input-group-btn>.btn{height:45px;line-height:45px}select[multiple].input-group-lg>.form-control,select[multiple].input-group-lg>.input-group-addon,select[multiple].input-group-lg>.input-group-btn>.btn,textarea.input-group-lg>.form-control,textarea.input-group-lg>.input-group-addon,textarea.input-group-lg>.input-group-btn>.btn{height:auto}.input-group-sm>.form-control,.input-group-sm>.input-group-addon,.input-group-sm>.input-group-btn>.btn{height:30px;padding:5px 10px;font-size:12px;line-height:1.5;border-radius:1px}select.input-group-sm>.form-control,select.input-group-sm>.input-group-addon,select.input-group-sm>.input-group-btn>.btn{height:30px;line-height:30px}select[multiple].input-group-sm>.form-control,select[multiple].input-group-sm>.input-group-addon,select[multiple].input-group-sm>.input-group-btn>.btn,textarea.input-group-sm>.form-control,textarea.input-group-sm>.input-group-addon,textarea.input-group-sm>.input-group-btn>.btn{height:auto}.input-group .form-control,.input-group-addon,.input-group-btn{display:table-cell}.input-group .form-control:not(:first-child):not(:last-child),.input-group-addon:not(:first-child):not(:last-child),.input-group-btn:not(:first-child):not(:last-child){border-radius:0}.input-group-addon,.input-group-btn{width:1%;white-space:nowrap;vertical-align:middle}.input-group-addon{padding:6px 12px;font-size:13px;font-weight:400;line-height:1;color:#555;text-align:center;background-color:#eee;border:1px solid #ccc;border-radius:2px}.input-group-addon.input-sm{padding:5px 10px;font-size:12px;border-radius:1px}.input-group-addon.input-lg{padding:10px 16px;font-size:17px;border-radius:3px}.input-group-addon input[type=checkbox],.input-group-addon input[type=radio]{margin-top:0}.input-group .form-control:first-child,.input-group-addon:first-child,.input-group-btn:first-child>.btn,.input-group-btn:first-child>.btn-group>.btn,.input-group-btn:first-child>.dropdown-toggle,.input-group-btn:last-child>.btn-group:not(:last-child)>.btn,.input-group-btn:last-child>.btn:not(:last-child):not(.dropdown-toggle){border-bottom-right-radius:0;border-top-right-radius:0}.input-group-addon:first-child{border-right:0}.input-group .form-control:last-child,.input-group-addon:last-child,.input-group-btn:first-child>.btn-group:not(:first-child)>.btn,.input-group-btn:first-child>.btn:not(:first-child),.input-group-btn:last-child>.btn,.input-group-btn:last-child>.btn-group>.btn,.input-group-btn:last-child>.dropdown-toggle{border-bottom-left-radius:0;border-top-left-radius:0}.input-group-addon:last-child{border-left:0}.input-group-btn{position:relative;font-size:0;white-space:nowrap}.input-group-btn>.btn{position:relative}.input-group-btn>.btn+.btn{margin-left:-1px}.input-group-btn>.btn:active,.input-group-btn>.btn:focus,.input-group-btn>.btn:hover{z-index:2}.input-group-btn:first-child>.btn,.input-group-btn:first-child>.btn-group{margin-right:-1px}.input-group-btn:last-child>.btn,.input-group-btn:last-child>.btn-group{z-index:2;margin-left:-1px}.nav{margin-bottom:0;padding-left:0;list-style:none}.nav>li{position:relative;display:block}.nav>li>a{position:relative;display:block;padding:10px 15px}.nav>li>a:focus,.nav>li>a:hover{text-decoration:none;background-color:#eee}.nav>li.disabled>a{color:#777}.nav>li.disabled>a:focus,.nav>li.disabled>a:hover{color:#777;text-decoration:none;background-color:transparent;cursor:not-allowed}.nav .open>a,.nav .open>a:focus,.nav .open>a:hover{background-color:#eee;border-color:#337ab7}.nav .nav-divider{height:1px;margin:8px 0;overflow:hidden;background-color:#e5e5e5}.nav>li>a>img{max-width:none}.nav-tabs{border-bottom:1px solid #ddd}.nav-tabs>li{float:left;margin-bottom:-1px}.nav-tabs>li>a{margin-right:2px;line-height:1.42857143;border:1px solid transparent;border-radius:2px 2px 0 0}.nav-tabs>li>a:hover{border-color:#eee #eee #ddd}.nav-tabs>li.active>a,.nav-tabs>li.active>a:focus,.nav-tabs>li.active>a:hover{color:#555;background-color:#fff;border:1px solid #ddd;border-bottom-color:transparent;cursor:default}.nav-tabs.nav-justified{width:100%;border-bottom:0}.nav-tabs.nav-justified>li{float:none}.nav-tabs.nav-justified>li>a{text-align:center;margin-bottom:5px}.nav-tabs.nav-justified>.dropdown .dropdown-menu{top:auto;left:auto}@media (min-width:768px){.nav-tabs.nav-justified>li{display:table-cell;width:1%}.nav-tabs.nav-justified>li>a{margin-bottom:0}}.nav-tabs.nav-justified>li>a{margin-right:0;border-radius:2px}.nav-tabs.nav-justified>.active>a,.nav-tabs.nav-justified>.active>a:focus,.nav-tabs.nav-justified>.active>a:hover{border:1px solid #ddd}@media (min-width:768px){.nav-tabs.nav-justified>li>a{border-bottom:1px solid #ddd;border-radius:2px 2px 0 0}.nav-tabs.nav-justified>.active>a,.nav-tabs.nav-justified>.active>a:focus,.nav-tabs.nav-justified>.active>a:hover{border-bottom-color:#fff}}.nav-pills>li{float:left}.nav-pills>li>a{border-radius:2px}.nav-pills>li+li{margin-left:2px}.nav-pills>li.active>a,.nav-pills>li.active>a:focus,.nav-pills>li.active>a:hover{color:#fff;background-color:#337ab7}.nav-stacked>li{float:none}.nav-stacked>li+li{margin-top:2px;margin-left:0}.nav-justified{width:100%}.nav-justified>li{float:none}.nav-justified>li>a{text-align:center;margin-bottom:5px}.nav-justified>.dropdown .dropdown-menu{top:auto;left:auto}@media (min-width:768px){.nav-justified>li{display:table-cell;width:1%}.nav-justified>li>a{margin-bottom:0}}.nav-tabs-justified{border-bottom:0}.nav-tabs-justified>li>a{margin-right:0;border-radius:2px}.nav-tabs-justified>.active>a,.nav-tabs-justified>.active>a:focus,.nav-tabs-justified>.active>a:hover{border:1px solid #ddd}@media (min-width:768px){.nav-tabs-justified>li>a{border-bottom:1px solid #ddd;border-radius:2px 2px 0 0}.nav-tabs-justified>.active>a,.nav-tabs-justified>.active>a:focus,.nav-tabs-justified>.active>a:hover{border-bottom-color:#fff}}.tab-content>.tab-pane{display:none}.tab-content>.active{display:block}.nav-tabs .dropdown-menu{margin-top:-1px;border-top-right-radius:0;border-top-left-radius:0}.navbar{position:relative;min-height:30px;margin-bottom:18px;border:1px solid transparent}@media (min-width:541px){.navbar{border-radius:2px}}@media (min-width:541px){.navbar-header{float:left}}.navbar-collapse{overflow-x:visible;padding-right:0;padding-left:0;border-top:1px solid transparent;box-shadow:inset 0 1px 0 rgba(255,255,255,.1);-webkit-overflow-scrolling:touch}.navbar-collapse.in{overflow-y:auto}@media (min-width:541px){.navbar-collapse{width:auto;border-top:0;box-shadow:none}.navbar-collapse.collapse{display:block!important;height:auto!important;padding-bottom:0;overflow:visible!important}.navbar-collapse.in{overflow-y:visible}.navbar-fixed-bottom .navbar-collapse,.navbar-fixed-top .navbar-collapse,.navbar-static-top .navbar-collapse{padding-left:0;padding-right:0}}.navbar-fixed-bottom .navbar-collapse,.navbar-fixed-top .navbar-collapse{max-height:340px}@media (max-device-width:540px) and (orientation:landscape){.navbar-fixed-bottom .navbar-collapse,.navbar-fixed-top .navbar-collapse{max-height:200px}}.container-fluid>.navbar-collapse,.container-fluid>.navbar-header,.container>.navbar-collapse,.container>.navbar-header{margin-right:0;margin-left:0}@media (min-width:541px){.container-fluid>.navbar-collapse,.container-fluid>.navbar-header,.container>.navbar-collapse,.container>.navbar-header{margin-right:0;margin-left:0}}.navbar-static-top{z-index:1000;border-width:0 0 1px}@media (min-width:541px){.navbar-static-top{border-radius:0}}.navbar-fixed-bottom,.navbar-fixed-top{position:fixed;right:0;left:0;z-index:1030}@media (min-width:541px){.navbar-fixed-bottom,.navbar-fixed-top{border-radius:0}}.navbar-fixed-top{top:0;border-width:0 0 1px}.navbar-fixed-bottom{bottom:0;margin-bottom:0;border-width:1px 0 0}.navbar-brand{float:left;padding:6px 0;font-size:17px;line-height:18px;height:30px}.navbar-brand:focus,.navbar-brand:hover{text-decoration:none}.navbar-brand>img{display:block}@media (min-width:541px){.navbar>.container .navbar-brand,.navbar>.container-fluid .navbar-brand{margin-left:0}}.navbar-toggle{position:relative;float:right;margin-right:0;padding:9px 10px;margin-top:-2px;margin-bottom:-2px;background-color:transparent;background-image:none;border:1px solid transparent;border-radius:2px}.navbar-toggle:focus{outline:0}.navbar-toggle .icon-bar{display:block;width:22px;height:2px;border-radius:1px}.navbar-toggle .icon-bar+.icon-bar{margin-top:4px}@media (min-width:541px){.navbar-toggle{display:none}}.navbar-nav{margin:3px 0}.navbar-nav>li>a{padding-top:10px;padding-bottom:10px;line-height:18px}@media (max-width:540px){.navbar-nav .open .dropdown-menu{position:static;float:none;width:auto;margin-top:0;background-color:transparent;border:0;box-shadow:none}.navbar-nav .open .dropdown-menu .dropdown-header,.navbar-nav .open .dropdown-menu>li>a{padding:5px 15px 5px 25px}.navbar-nav .open .dropdown-menu>li>a{line-height:18px}.navbar-nav .open .dropdown-menu>li>a:focus,.navbar-nav .open .dropdown-menu>li>a:hover{background-image:none}}@media (min-width:541px){.navbar-nav{float:left;margin:0}.navbar-nav>li{float:left}.navbar-nav>li>a{padding-top:6px;padding-bottom:6px}}.navbar-form{margin-left:0;margin-right:0;padding:10px 0;border-top:1px solid transparent;border-bottom:1px solid transparent;-webkit-box-shadow:inset 0 1px 0 rgba(255,255,255,.1),0 1px 0 rgba(255,255,255,.1);box-shadow:inset 0 1px 0 rgba(255,255,255,.1),0 1px 0 rgba(255,255,255,.1);margin-top:-1px;margin-bottom:-1px}@media (min-width:768px){.navbar-form .form-group{display:inline-block;margin-bottom:0;vertical-align:middle}.navbar-form .form-control{display:inline-block;width:auto;vertical-align:middle}.navbar-form .form-control-static{display:inline-block}.navbar-form .input-group{display:inline-table;vertical-align:middle}.navbar-form .input-group .form-control,.navbar-form .input-group .input-group-addon,.navbar-form .input-group .input-group-btn{width:auto}.navbar-form .input-group>.form-control{width:100%}.navbar-form .control-label{margin-bottom:0;vertical-align:middle}.navbar-form .checkbox,.navbar-form .radio{display:inline-block;margin-top:0;margin-bottom:0;vertical-align:middle}.navbar-form .checkbox label,.navbar-form .radio label{padding-left:0}.navbar-form .checkbox input[type=checkbox],.navbar-form .radio input[type=radio]{position:relative;margin-left:0}.navbar-form .has-feedback .form-control-feedback{top:0}}@media (max-width:540px){.navbar-form .form-group{margin-bottom:5px}.navbar-form .form-group:last-child{margin-bottom:0}}@media (min-width:541px){.navbar-form{width:auto;border:0;margin-left:0;margin-right:0;padding-top:0;padding-bottom:0;-webkit-box-shadow:none;box-shadow:none}}.navbar-nav>li>.dropdown-menu{margin-top:0;border-top-right-radius:0;border-top-left-radius:0}.navbar-fixed-bottom .navbar-nav>li>.dropdown-menu{margin-bottom:0;border-top-right-radius:2px;border-top-left-radius:2px;border-bottom-right-radius:0;border-bottom-left-radius:0}.navbar-btn{margin-top:-1px;margin-bottom:-1px}.navbar-btn.btn-sm{margin-top:0;margin-bottom:0}.navbar-btn.btn-xs{margin-top:4px;margin-bottom:4px}.navbar-text{margin-top:6px;margin-bottom:6px}@media (min-width:541px){.navbar-text{float:left;margin-left:0;margin-right:0}}@media (min-width:541px){.navbar-left{float:left!important;float:left}.navbar-right{float:right!important;float:right;margin-right:0}.navbar-right~.navbar-right{margin-right:0}}.navbar-default{background-color:#f8f8f8;border-color:#e7e7e7}.navbar-default .navbar-brand{color:#777}.navbar-default .navbar-brand:focus,.navbar-default .navbar-brand:hover{color:#5e5e5e;background-color:transparent}.navbar-default .navbar-text{color:#777}.navbar-default .navbar-nav>li>a{color:#777}.navbar-default .navbar-nav>li>a:focus,.navbar-default .navbar-nav>li>a:hover{color:#333;background-color:transparent}.navbar-default .navbar-nav>.active>a,.navbar-default .navbar-nav>.active>a:focus,.navbar-default .navbar-nav>.active>a:hover{color:#555;background-color:#e7e7e7}.navbar-default .navbar-nav>.disabled>a,.navbar-default .navbar-nav>.disabled>a:focus,.navbar-default .navbar-nav>.disabled>a:hover{color:#ccc;background-color:transparent}.navbar-default .navbar-toggle{border-color:#ddd}.navbar-default .navbar-toggle:focus,.navbar-default .navbar-toggle:hover{background-color:#ddd}.navbar-default .navbar-toggle .icon-bar{background-color:#888}.navbar-default .navbar-collapse,.navbar-default .navbar-form{border-color:#e7e7e7}.navbar-default .navbar-nav>.open>a,.navbar-default .navbar-nav>.open>a:focus,.navbar-default .navbar-nav>.open>a:hover{background-color:#e7e7e7;color:#555}@media (max-width:540px){.navbar-default .navbar-nav .open .dropdown-menu>li>a{color:#777}.navbar-default .navbar-nav .open .dropdown-menu>li>a:focus,.navbar-default .navbar-nav .open .dropdown-menu>li>a:hover{color:#333;background-color:transparent}.navbar-default .navbar-nav .open .dropdown-menu>.active>a,.navbar-default .navbar-nav .open .dropdown-menu>.active>a:focus,.navbar-default .navbar-nav .open .dropdown-menu>.active>a:hover{color:#555;background-color:#e7e7e7}.navbar-default .navbar-nav .open .dropdown-menu>.disabled>a,.navbar-default .navbar-nav .open .dropdown-menu>.disabled>a:focus,.navbar-default .navbar-nav .open .dropdown-menu>.disabled>a:hover{color:#ccc;background-color:transparent}}.navbar-default .navbar-link{color:#777}.navbar-default .navbar-link:hover{color:#333}.navbar-default .btn-link{color:#777}.navbar-default .btn-link:focus,.navbar-default .btn-link:hover{color:#333}.navbar-default .btn-link[disabled]:focus,.navbar-default .btn-link[disabled]:hover,fieldset[disabled] .navbar-default .btn-link:focus,fieldset[disabled] .navbar-default .btn-link:hover{color:#ccc}.navbar-inverse{background-color:#222;border-color:#080808}.navbar-inverse .navbar-brand{color:#9d9d9d}.navbar-inverse .navbar-brand:focus,.navbar-inverse .navbar-brand:hover{color:#fff;background-color:transparent}.navbar-inverse .navbar-text{color:#9d9d9d}.navbar-inverse .navbar-nav>li>a{color:#9d9d9d}.navbar-inverse .navbar-nav>li>a:focus,.navbar-inverse .navbar-nav>li>a:hover{color:#fff;background-color:transparent}.navbar-inverse .navbar-nav>.active>a,.navbar-inverse .navbar-nav>.active>a:focus,.navbar-inverse .navbar-nav>.active>a:hover{color:#fff;background-color:#080808}.navbar-inverse .navbar-nav>.disabled>a,.navbar-inverse .navbar-nav>.disabled>a:focus,.navbar-inverse .navbar-nav>.disabled>a:hover{color:#444;background-color:transparent}.navbar-inverse .navbar-toggle{border-color:#333}.navbar-inverse .navbar-toggle:focus,.navbar-inverse .navbar-toggle:hover{background-color:#333}.navbar-inverse .navbar-toggle .icon-bar{background-color:#fff}.navbar-inverse .navbar-collapse,.navbar-inverse .navbar-form{border-color:#101010}.navbar-inverse .navbar-nav>.open>a,.navbar-inverse .navbar-nav>.open>a:focus,.navbar-inverse .navbar-nav>.open>a:hover{background-color:#080808;color:#fff}@media (max-width:540px){.navbar-inverse .navbar-nav .open .dropdown-menu>.dropdown-header{border-color:#080808}.navbar-inverse .navbar-nav .open .dropdown-menu .divider{background-color:#080808}.navbar-inverse .navbar-nav .open .dropdown-menu>li>a{color:#9d9d9d}.navbar-inverse .navbar-nav .open .dropdown-menu>li>a:focus,.navbar-inverse .navbar-nav .open .dropdown-menu>li>a:hover{color:#fff;background-color:transparent}.navbar-inverse .navbar-nav .open .dropdown-menu>.active>a,.navbar-inverse .navbar-nav .open .dropdown-menu>.active>a:focus,.navbar-inverse .navbar-nav .open .dropdown-menu>.active>a:hover{color:#fff;background-color:#080808}.navbar-inverse .navbar-nav .open .dropdown-menu>.disabled>a,.navbar-inverse .navbar-nav .open .dropdown-menu>.disabled>a:focus,.navbar-inverse .navbar-nav .open .dropdown-menu>.disabled>a:hover{color:#444;background-color:transparent}}.navbar-inverse .navbar-link{color:#9d9d9d}.navbar-inverse .navbar-link:hover{color:#fff}.navbar-inverse .btn-link{color:#9d9d9d}.navbar-inverse .btn-link:focus,.navbar-inverse .btn-link:hover{color:#fff}.navbar-inverse .btn-link[disabled]:focus,.navbar-inverse .btn-link[disabled]:hover,fieldset[disabled] .navbar-inverse .btn-link:focus,fieldset[disabled] .navbar-inverse .btn-link:hover{color:#444}.breadcrumb{padding:8px 15px;margin-bottom:18px;list-style:none;background-color:#f5f5f5;border-radius:2px}.breadcrumb>li{display:inline-block}.breadcrumb>li+li:before{content:"/\00a0";padding:0 5px;color:#5e5e5e}.breadcrumb>.active{color:#777}.pagination{display:inline-block;padding-left:0;margin:18px 0;border-radius:2px}.pagination>li{display:inline}.pagination>li>a,.pagination>li>span{position:relative;float:left;padding:6px 12px;line-height:1.42857143;text-decoration:none;color:#337ab7;background-color:#fff;border:1px solid #ddd;margin-left:-1px}.pagination>li:first-child>a,.pagination>li:first-child>span{margin-left:0;border-bottom-left-radius:2px;border-top-left-radius:2px}.pagination>li:last-child>a,.pagination>li:last-child>span{border-bottom-right-radius:2px;border-top-right-radius:2px}.pagination>li>a:focus,.pagination>li>a:hover,.pagination>li>span:focus,.pagination>li>span:hover{z-index:2;color:#23527c;background-color:#eee;border-color:#ddd}.pagination>.active>a,.pagination>.active>a:focus,.pagination>.active>a:hover,.pagination>.active>span,.pagination>.active>span:focus,.pagination>.active>span:hover{z-index:3;color:#fff;background-color:#337ab7;border-color:#337ab7;cursor:default}.pagination>.disabled>a,.pagination>.disabled>a:focus,.pagination>.disabled>a:hover,.pagination>.disabled>span,.pagination>.disabled>span:focus,.pagination>.disabled>span:hover{color:#777;background-color:#fff;border-color:#ddd;cursor:not-allowed}.pagination-lg>li>a,.pagination-lg>li>span{padding:10px 16px;font-size:17px;line-height:1.3333333}.pagination-lg>li:first-child>a,.pagination-lg>li:first-child>span{border-bottom-left-radius:3px;border-top-left-radius:3px}.pagination-lg>li:last-child>a,.pagination-lg>li:last-child>span{border-bottom-right-radius:3px;border-top-right-radius:3px}.pagination-sm>li>a,.pagination-sm>li>span{padding:5px 10px;font-size:12px;line-height:1.5}.pagination-sm>li:first-child>a,.pagination-sm>li:first-child>span{border-bottom-left-radius:1px;border-top-left-radius:1px}.pagination-sm>li:last-child>a,.pagination-sm>li:last-child>span{border-bottom-right-radius:1px;border-top-right-radius:1px}.pager{padding-left:0;margin:18px 0;list-style:none;text-align:center}.pager li{display:inline}.pager li>a,.pager li>span{display:inline-block;padding:5px 14px;background-color:#fff;border:1px solid #ddd;border-radius:15px}.pager li>a:focus,.pager li>a:hover{text-decoration:none;background-color:#eee}.pager .next>a,.pager .next>span{float:right}.pager .previous>a,.pager .previous>span{float:left}.pager .disabled>a,.pager .disabled>a:focus,.pager .disabled>a:hover,.pager .disabled>span{color:#777;background-color:#fff;cursor:not-allowed}.label{display:inline;padding:.2em .6em .3em;font-size:75%;font-weight:700;line-height:1;color:#fff;text-align:center;white-space:nowrap;vertical-align:baseline;border-radius:.25em}a.label:focus,a.label:hover{color:#fff;text-decoration:none;cursor:pointer}.label:empty{display:none}.btn .label{position:relative;top:-1px}.label-default{background-color:#777}.label-default[href]:focus,.label-default[href]:hover{background-color:#5e5e5e}.label-primary{background-color:#337ab7}.label-primary[href]:focus,.label-primary[href]:hover{background-color:#286090}.label-success{background-color:#5cb85c}.label-success[href]:focus,.label-success[href]:hover{background-color:#449d44}.label-info{background-color:#5bc0de}.label-info[href]:focus,.label-info[href]:hover{background-color:#31b0d5}.label-warning{background-color:#f0ad4e}.label-warning[href]:focus,.label-warning[href]:hover{background-color:#ec971f}.label-danger{background-color:#d9534f}.label-danger[href]:focus,.label-danger[href]:hover{background-color:#c9302c}.badge{display:inline-block;min-width:10px;padding:3px 7px;font-size:12px;font-weight:700;color:#fff;line-height:1;vertical-align:middle;white-space:nowrap;text-align:center;background-color:#777;border-radius:10px}.badge:empty{display:none}.btn .badge{position:relative;top:-1px}.btn-group-xs>.btn .badge,.btn-xs .badge{top:0;padding:1px 5px}a.badge:focus,a.badge:hover{color:#fff;text-decoration:none;cursor:pointer}.list-group-item.active>.badge,.nav-pills>.active>a>.badge{color:#337ab7;background-color:#fff}.list-group-item>.badge{float:right}.list-group-item>.badge+.badge{margin-right:5px}.nav-pills>li>a>.badge{margin-left:3px}.jumbotron{padding-top:30px;padding-bottom:30px;margin-bottom:30px;color:inherit;background-color:#eee}.jumbotron .h1,.jumbotron h1{color:inherit}.jumbotron p{margin-bottom:15px;font-size:20px;font-weight:200}.jumbotron>hr{border-top-color:#d5d5d5}.container .jumbotron,.container-fluid .jumbotron{border-radius:3px;padding-left:0;padding-right:0}.jumbotron .container{max-width:100%}@media screen and (min-width:768px){.jumbotron{padding-top:48px;padding-bottom:48px}.container .jumbotron,.container-fluid .jumbotron{padding-left:60px;padding-right:60px}.jumbotron .h1,.jumbotron h1{font-size:59px}}.thumbnail{display:block;padding:4px;margin-bottom:18px;line-height:1.42857143;background-color:#fff;border:1px solid #ddd;border-radius:2px;-webkit-transition:border .2s ease-in-out;-o-transition:border .2s ease-in-out;transition:border .2s ease-in-out}.thumbnail a>img,.thumbnail>img{margin-left:auto;margin-right:auto}a.thumbnail.active,a.thumbnail:focus,a.thumbnail:hover{border-color:#337ab7}.thumbnail .caption{padding:9px;color:#000}.alert{padding:15px;margin-bottom:18px;border:1px solid transparent;border-radius:2px}.alert h4{margin-top:0;color:inherit}.alert .alert-link{font-weight:700}.alert>p,.alert>ul{margin-bottom:0}.alert>p+p{margin-top:5px}.alert-dismissable,.alert-dismissible{padding-right:35px}.alert-dismissable .close,.alert-dismissible .close{position:relative;top:-2px;right:-21px;color:inherit}.alert-success{background-color:#dff0d8;border-color:#d6e9c6;color:#3c763d}.alert-success hr{border-top-color:#c9e2b3}.alert-success .alert-link{color:#2b542c}.alert-info{background-color:#d9edf7;border-color:#bce8f1;color:#31708f}.alert-info hr{border-top-color:#a6e1ec}.alert-info .alert-link{color:#245269}.alert-warning{background-color:#fcf8e3;border-color:#faebcc;color:#8a6d3b}.alert-warning hr{border-top-color:#f7e1b5}.alert-warning .alert-link{color:#66512c}.alert-danger{background-color:#f2dede;border-color:#ebccd1;color:#a94442}.alert-danger hr{border-top-color:#e4b9c0}.alert-danger .alert-link{color:#843534}@-webkit-keyframes progress-bar-stripes{from{background-position:40px 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:40px 0}to{background-position:0 0}}.progress{overflow:hidden;height:18px;margin-bottom:18px;background-color:#f5f5f5;border-radius:2px;-webkit-box-shadow:inset 0 1px 2px rgba(0,0,0,.1);box-shadow:inset 0 1px 2px rgba(0,0,0,.1)}.progress-bar{float:left;width:0;height:100%;font-size:12px;line-height:18px;color:#fff;text-align:center;background-color:#337ab7;-webkit-box-shadow:inset 0 -1px 0 rgba(0,0,0,.15);box-shadow:inset 0 -1px 0 rgba(0,0,0,.15);-webkit-transition:width .6s ease;-o-transition:width .6s ease;transition:width .6s ease}.progress-bar-striped,.progress-striped .progress-bar{background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:-o-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-size:40px 40px}.progress-bar.active,.progress.active .progress-bar{-webkit-animation:progress-bar-stripes 2s linear infinite;-o-animation:progress-bar-stripes 2s linear infinite;animation:progress-bar-stripes 2s linear infinite}.progress-bar-success{background-color:#5cb85c}.progress-striped .progress-bar-success{background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:-o-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent)}.progress-bar-info{background-color:#5bc0de}.progress-striped .progress-bar-info{background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:-o-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent)}.progress-bar-warning{background-color:#f0ad4e}.progress-striped .progress-bar-warning{background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:-o-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent)}.progress-bar-danger{background-color:#d9534f}.progress-striped .progress-bar-danger{background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:-o-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent)}.media{margin-top:15px}.media:first-child{margin-top:0}.media,.media-body{zoom:1;overflow:hidden}.media-body{width:10000px}.media-object{display:block}.media-object.img-thumbnail{max-width:none}.media-right,.media>.pull-right{padding-left:10px}.media-left,.media>.pull-left{padding-right:10px}.media-body,.media-left,.media-right{display:table-cell;vertical-align:top}.media-middle{vertical-align:middle}.media-bottom{vertical-align:bottom}.media-heading{margin-top:0;margin-bottom:5px}.media-list{padding-left:0;list-style:none}.list-group{margin-bottom:20px;padding-left:0}.list-group-item{position:relative;display:block;padding:10px 15px;margin-bottom:-1px;background-color:#fff;border:1px solid #ddd}.list-group-item:first-child{border-top-right-radius:2px;border-top-left-radius:2px}.list-group-item:last-child{margin-bottom:0;border-bottom-right-radius:2px;border-bottom-left-radius:2px}a.list-group-item,button.list-group-item{color:#555}a.list-group-item .list-group-item-heading,button.list-group-item .list-group-item-heading{color:#333}a.list-group-item:focus,a.list-group-item:hover,button.list-group-item:focus,button.list-group-item:hover{text-decoration:none;color:#555;background-color:#f5f5f5}button.list-group-item{width:100%;text-align:left}.list-group-item.disabled,.list-group-item.disabled:focus,.list-group-item.disabled:hover{background-color:#eee;color:#777;cursor:not-allowed}.list-group-item.disabled .list-group-item-heading,.list-group-item.disabled:focus .list-group-item-heading,.list-group-item.disabled:hover .list-group-item-heading{color:inherit}.list-group-item.disabled .list-group-item-text,.list-group-item.disabled:focus .list-group-item-text,.list-group-item.disabled:hover .list-group-item-text{color:#777}.list-group-item.active,.list-group-item.active:focus,.list-group-item.active:hover{z-index:2;color:#fff;background-color:#337ab7;border-color:#337ab7}.list-group-item.active .list-group-item-heading,.list-group-item.active .list-group-item-heading>.small,.list-group-item.active .list-group-item-heading>small,.list-group-item.active:focus .list-group-item-heading,.list-group-item.active:focus .list-group-item-heading>.small,.list-group-item.active:focus .list-group-item-heading>small,.list-group-item.active:hover .list-group-item-heading,.list-group-item.active:hover .list-group-item-heading>.small,.list-group-item.active:hover .list-group-item-heading>small{color:inherit}.list-group-item.active .list-group-item-text,.list-group-item.active:focus .list-group-item-text,.list-group-item.active:hover .list-group-item-text{color:#c7ddef}.list-group-item-success{color:#3c763d;background-color:#dff0d8}a.list-group-item-success,button.list-group-item-success{color:#3c763d}a.list-group-item-success .list-group-item-heading,button.list-group-item-success .list-group-item-heading{color:inherit}a.list-group-item-success:focus,a.list-group-item-success:hover,button.list-group-item-success:focus,button.list-group-item-success:hover{color:#3c763d;background-color:#d0e9c6}a.list-group-item-success.active,a.list-group-item-success.active:focus,a.list-group-item-success.active:hover,button.list-group-item-success.active,button.list-group-item-success.active:focus,button.list-group-item-success.active:hover{color:#fff;background-color:#3c763d;border-color:#3c763d}.list-group-item-info{color:#31708f;background-color:#d9edf7}a.list-group-item-info,button.list-group-item-info{color:#31708f}a.list-group-item-info .list-group-item-heading,button.list-group-item-info .list-group-item-heading{color:inherit}a.list-group-item-info:focus,a.list-group-item-info:hover,button.list-group-item-info:focus,button.list-group-item-info:hover{color:#31708f;background-color:#c4e3f3}a.list-group-item-info.active,a.list-group-item-info.active:focus,a.list-group-item-info.active:hover,button.list-group-item-info.active,button.list-group-item-info.active:focus,button.list-group-item-info.active:hover{color:#fff;background-color:#31708f;border-color:#31708f}.list-group-item-warning{color:#8a6d3b;background-color:#fcf8e3}a.list-group-item-warning,button.list-group-item-warning{color:#8a6d3b}a.list-group-item-warning .list-group-item-heading,button.list-group-item-warning .list-group-item-heading{color:inherit}a.list-group-item-warning:focus,a.list-group-item-warning:hover,button.list-group-item-warning:focus,button.list-group-item-warning:hover{color:#8a6d3b;background-color:#faf2cc}a.list-group-item-warning.active,a.list-group-item-warning.active:focus,a.list-group-item-warning.active:hover,button.list-group-item-warning.active,button.list-group-item-warning.active:focus,button.list-group-item-warning.active:hover{color:#fff;background-color:#8a6d3b;border-color:#8a6d3b}.list-group-item-danger{color:#a94442;background-color:#f2dede}a.list-group-item-danger,button.list-group-item-danger{color:#a94442}a.list-group-item-danger .list-group-item-heading,button.list-group-item-danger .list-group-item-heading{color:inherit}a.list-group-item-danger:focus,a.list-group-item-danger:hover,button.list-group-item-danger:focus,button.list-group-item-danger:hover{color:#a94442;background-color:#ebcccc}a.list-group-item-danger.active,a.list-group-item-danger.active:focus,a.list-group-item-danger.active:hover,button.list-group-item-danger.active,button.list-group-item-danger.active:focus,button.list-group-item-danger.active:hover{color:#fff;background-color:#a94442;border-color:#a94442}.list-group-item-heading{margin-top:0;margin-bottom:5px}.list-group-item-text{margin-bottom:0;line-height:1.3}.panel{margin-bottom:18px;background-color:#fff;border:1px solid transparent;border-radius:2px;-webkit-box-shadow:0 1px 1px rgba(0,0,0,.05);box-shadow:0 1px 1px rgba(0,0,0,.05)}.panel-body{padding:15px}.panel-heading{padding:10px 15px;border-bottom:1px solid transparent;border-top-right-radius:1px;border-top-left-radius:1px}.panel-heading>.dropdown .dropdown-toggle{color:inherit}.panel-title{margin-top:0;margin-bottom:0;font-size:15px;color:inherit}.panel-title>.small,.panel-title>.small>a,.panel-title>a,.panel-title>small,.panel-title>small>a{color:inherit}.panel-footer{padding:10px 15px;background-color:#f5f5f5;border-top:1px solid #ddd;border-bottom-right-radius:1px;border-bottom-left-radius:1px}.panel>.list-group,.panel>.panel-collapse>.list-group{margin-bottom:0}.panel>.list-group .list-group-item,.panel>.panel-collapse>.list-group .list-group-item{border-width:1px 0;border-radius:0}.panel>.list-group:first-child .list-group-item:first-child,.panel>.panel-collapse>.list-group:first-child .list-group-item:first-child{border-top:0;border-top-right-radius:1px;border-top-left-radius:1px}.panel>.list-group:last-child .list-group-item:last-child,.panel>.panel-collapse>.list-group:last-child .list-group-item:last-child{border-bottom:0;border-bottom-right-radius:1px;border-bottom-left-radius:1px}.panel>.panel-heading+.panel-collapse>.list-group .list-group-item:first-child{border-top-right-radius:0;border-top-left-radius:0}.panel-heading+.list-group .list-group-item:first-child{border-top-width:0}.list-group+.panel-footer{border-top-width:0}.panel>.panel-collapse>.table,.panel>.table,.panel>.table-responsive>.table{margin-bottom:0}.panel>.panel-collapse>.table caption,.panel>.table caption,.panel>.table-responsive>.table caption{padding-left:15px;padding-right:15px}.panel>.table-responsive:first-child>.table:first-child,.panel>.table:first-child{border-top-right-radius:1px;border-top-left-radius:1px}.panel>.table-responsive:first-child>.table:first-child>tbody:first-child>tr:first-child,.panel>.table-responsive:first-child>.table:first-child>thead:first-child>tr:first-child,.panel>.table:first-child>tbody:first-child>tr:first-child,.panel>.table:first-child>thead:first-child>tr:first-child{border-top-left-radius:1px;border-top-right-radius:1px}.panel>.table-responsive:first-child>.table:first-child>tbody:first-child>tr:first-child td:first-child,.panel>.table-responsive:first-child>.table:first-child>tbody:first-child>tr:first-child th:first-child,.panel>.table-responsive:first-child>.table:first-child>thead:first-child>tr:first-child td:first-child,.panel>.table-responsive:first-child>.table:first-child>thead:first-child>tr:first-child th:first-child,.panel>.table:first-child>tbody:first-child>tr:first-child td:first-child,.panel>.table:first-child>tbody:first-child>tr:first-child th:first-child,.panel>.table:first-child>thead:first-child>tr:first-child td:first-child,.panel>.table:first-child>thead:first-child>tr:first-child th:first-child{border-top-left-radius:1px}.panel>.table-responsive:first-child>.table:first-child>tbody:first-child>tr:first-child td:last-child,.panel>.table-responsive:first-child>.table:first-child>tbody:first-child>tr:first-child th:last-child,.panel>.table-responsive:first-child>.table:first-child>thead:first-child>tr:first-child td:last-child,.panel>.table-responsive:first-child>.table:first-child>thead:first-child>tr:first-child th:last-child,.panel>.table:first-child>tbody:first-child>tr:first-child td:last-child,.panel>.table:first-child>tbody:first-child>tr:first-child th:last-child,.panel>.table:first-child>thead:first-child>tr:first-child td:last-child,.panel>.table:first-child>thead:first-child>tr:first-child th:last-child{border-top-right-radius:1px}.panel>.table-responsive:last-child>.table:last-child,.panel>.table:last-child{border-bottom-right-radius:1px;border-bottom-left-radius:1px}.panel>.table-responsive:last-child>.table:last-child>tbody:last-child>tr:last-child,.panel>.table-responsive:last-child>.table:last-child>tfoot:last-child>tr:last-child,.panel>.table:last-child>tbody:last-child>tr:last-child,.panel>.table:last-child>tfoot:last-child>tr:last-child{border-bottom-left-radius:1px;border-bottom-right-radius:1px}.panel>.table-responsive:last-child>.table:last-child>tbody:last-child>tr:last-child td:first-child,.panel>.table-responsive:last-child>.table:last-child>tbody:last-child>tr:last-child th:first-child,.panel>.table-responsive:last-child>.table:last-child>tfoot:last-child>tr:last-child td:first-child,.panel>.table-responsive:last-child>.table:last-child>tfoot:last-child>tr:last-child th:first-child,.panel>.table:last-child>tbody:last-child>tr:last-child td:first-child,.panel>.table:last-child>tbody:last-child>tr:last-child th:first-child,.panel>.table:last-child>tfoot:last-child>tr:last-child td:first-child,.panel>.table:last-child>tfoot:last-child>tr:last-child th:first-child{border-bottom-left-radius:1px}.panel>.table-responsive:last-child>.table:last-child>tbody:last-child>tr:last-child td:last-child,.panel>.table-responsive:last-child>.table:last-child>tbody:last-child>tr:last-child th:last-child,.panel>.table-responsive:last-child>.table:last-child>tfoot:last-child>tr:last-child td:last-child,.panel>.table-responsive:last-child>.table:last-child>tfoot:last-child>tr:last-child th:last-child,.panel>.table:last-child>tbody:last-child>tr:last-child td:last-child,.panel>.table:last-child>tbody:last-child>tr:last-child th:last-child,.panel>.table:last-child>tfoot:last-child>tr:last-child td:last-child,.panel>.table:last-child>tfoot:last-child>tr:last-child th:last-child{border-bottom-right-radius:1px}.panel>.panel-body+.table,.panel>.panel-body+.table-responsive,.panel>.table+.panel-body,.panel>.table-responsive+.panel-body{border-top:1px solid #ddd}.panel>.table>tbody:first-child>tr:first-child td,.panel>.table>tbody:first-child>tr:first-child th{border-top:0}.panel>.table-bordered,.panel>.table-responsive>.table-bordered{border:0}.panel>.table-bordered>tbody>tr>td:first-child,.panel>.table-bordered>tbody>tr>th:first-child,.panel>.table-bordered>tfoot>tr>td:first-child,.panel>.table-bordered>tfoot>tr>th:first-child,.panel>.table-bordered>thead>tr>td:first-child,.panel>.table-bordered>thead>tr>th:first-child,.panel>.table-responsive>.table-bordered>tbody>tr>td:first-child,.panel>.table-responsive>.table-bordered>tbody>tr>th:first-child,.panel>.table-responsive>.table-bordered>tfoot>tr>td:first-child,.panel>.table-responsive>.table-bordered>tfoot>tr>th:first-child,.panel>.table-responsive>.table-bordered>thead>tr>td:first-child,.panel>.table-responsive>.table-bordered>thead>tr>th:first-child{border-left:0}.panel>.table-bordered>tbody>tr>td:last-child,.panel>.table-bordered>tbody>tr>th:last-child,.panel>.table-bordered>tfoot>tr>td:last-child,.panel>.table-bordered>tfoot>tr>th:last-child,.panel>.table-bordered>thead>tr>td:last-child,.panel>.table-bordered>thead>tr>th:last-child,.panel>.table-responsive>.table-bordered>tbody>tr>td:last-child,.panel>.table-responsive>.table-bordered>tbody>tr>th:last-child,.panel>.table-responsive>.table-bordered>tfoot>tr>td:last-child,.panel>.table-responsive>.table-bordered>tfoot>tr>th:last-child,.panel>.table-responsive>.table-bordered>thead>tr>td:last-child,.panel>.table-responsive>.table-bordered>thead>tr>th:last-child{border-right:0}.panel>.table-bordered>tbody>tr:first-child>td,.panel>.table-bordered>tbody>tr:first-child>th,.panel>.table-bordered>thead>tr:first-child>td,.panel>.table-bordered>thead>tr:first-child>th,.panel>.table-responsive>.table-bordered>tbody>tr:first-child>td,.panel>.table-responsive>.table-bordered>tbody>tr:first-child>th,.panel>.table-responsive>.table-bordered>thead>tr:first-child>td,.panel>.table-responsive>.table-bordered>thead>tr:first-child>th{border-bottom:0}.panel>.table-bordered>tbody>tr:last-child>td,.panel>.table-bordered>tbody>tr:last-child>th,.panel>.table-bordered>tfoot>tr:last-child>td,.panel>.table-bordered>tfoot>tr:last-child>th,.panel>.table-responsive>.table-bordered>tbody>tr:last-child>td,.panel>.table-responsive>.table-bordered>tbody>tr:last-child>th,.panel>.table-responsive>.table-bordered>tfoot>tr:last-child>td,.panel>.table-responsive>.table-bordered>tfoot>tr:last-child>th{border-bottom:0}.panel>.table-responsive{border:0;margin-bottom:0}.panel-group{margin-bottom:18px}.panel-group .panel{margin-bottom:0;border-radius:2px}.panel-group .panel+.panel{margin-top:5px}.panel-group .panel-heading{border-bottom:0}.panel-group .panel-heading+.panel-collapse>.list-group,.panel-group .panel-heading+.panel-collapse>.panel-body{border-top:1px solid #ddd}.panel-group .panel-footer{border-top:0}.panel-group .panel-footer+.panel-collapse .panel-body{border-bottom:1px solid #ddd}.panel-default{border-color:#ddd}.panel-default>.panel-heading{color:#333;background-color:#f5f5f5;border-color:#ddd}.panel-default>.panel-heading+.panel-collapse>.panel-body{border-top-color:#ddd}.panel-default>.panel-heading .badge{color:#f5f5f5;background-color:#333}.panel-default>.panel-footer+.panel-collapse>.panel-body{border-bottom-color:#ddd}.panel-primary{border-color:#337ab7}.panel-primary>.panel-heading{color:#fff;background-color:#337ab7;border-color:#337ab7}.panel-primary>.panel-heading+.panel-collapse>.panel-body{border-top-color:#337ab7}.panel-primary>.panel-heading .badge{color:#337ab7;background-color:#fff}.panel-primary>.panel-footer+.panel-collapse>.panel-body{border-bottom-color:#337ab7}.panel-success{border-color:#d6e9c6}.panel-success>.panel-heading{color:#3c763d;background-color:#dff0d8;border-color:#d6e9c6}.panel-success>.panel-heading+.panel-collapse>.panel-body{border-top-color:#d6e9c6}.panel-success>.panel-heading .badge{color:#dff0d8;background-color:#3c763d}.panel-success>.panel-footer+.panel-collapse>.panel-body{border-bottom-color:#d6e9c6}.panel-info{border-color:#bce8f1}.panel-info>.panel-heading{color:#31708f;background-color:#d9edf7;border-color:#bce8f1}.panel-info>.panel-heading+.panel-collapse>.panel-body{border-top-color:#bce8f1}.panel-info>.panel-heading .badge{color:#d9edf7;background-color:#31708f}.panel-info>.panel-footer+.panel-collapse>.panel-body{border-bottom-color:#bce8f1}.panel-warning{border-color:#faebcc}.panel-warning>.panel-heading{color:#8a6d3b;background-color:#fcf8e3;border-color:#faebcc}.panel-warning>.panel-heading+.panel-collapse>.panel-body{border-top-color:#faebcc}.panel-warning>.panel-heading .badge{color:#fcf8e3;background-color:#8a6d3b}.panel-warning>.panel-footer+.panel-collapse>.panel-body{border-bottom-color:#faebcc}.panel-danger{border-color:#ebccd1}.panel-danger>.panel-heading{color:#a94442;background-color:#f2dede;border-color:#ebccd1}.panel-danger>.panel-heading+.panel-collapse>.panel-body{border-top-color:#ebccd1}.panel-danger>.panel-heading .badge{color:#f2dede;background-color:#a94442}.panel-danger>.panel-footer+.panel-collapse>.panel-body{border-bottom-color:#ebccd1}.embed-responsive{position:relative;display:block;height:0;padding:0;overflow:hidden}.embed-responsive .embed-responsive-item,.embed-responsive embed,.embed-responsive iframe,.embed-responsive object,.embed-responsive video{position:absolute;top:0;left:0;bottom:0;height:100%;width:100%;border:0}.embed-responsive-16by9{padding-bottom:56.25%}.embed-responsive-4by3{padding-bottom:75%}.well{min-height:20px;padding:19px;margin-bottom:20px;background-color:#f5f5f5;border:1px solid #e3e3e3;border-radius:2px;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.05);box-shadow:inset 0 1px 1px rgba(0,0,0,.05)}.well blockquote{border-color:#ddd;border-color:rgba(0,0,0,.15)}.well-lg{padding:24px;border-radius:3px}.well-sm{padding:9px;border-radius:1px}.close{float:right;font-size:19.5px;font-weight:700;line-height:1;color:#000;text-shadow:0 1px 0 #fff;opacity:.2;filter:alpha(opacity=20)}.close:focus,.close:hover{color:#000;text-decoration:none;cursor:pointer;opacity:.5;filter:alpha(opacity=50)}button.close{padding:0;cursor:pointer;background:0 0;border:0;-webkit-appearance:none}.modal-open{overflow:hidden}.modal{display:none;overflow:hidden;position:fixed;top:0;right:0;bottom:0;left:0;z-index:1050;-webkit-overflow-scrolling:touch;outline:0}.modal.fade .modal-dialog{-webkit-transform:translate(0,-25%);-ms-transform:translate(0,-25%);-o-transform:translate(0,-25%);transform:translate(0,-25%);-webkit-transition:-webkit-transform .3s ease-out;-moz-transition:-moz-transform .3s ease-out;-o-transition:-o-transform .3s ease-out;transition:transform .3s ease-out}.modal.in .modal-dialog{-webkit-transform:translate(0,0);-ms-transform:translate(0,0);-o-transform:translate(0,0);transform:translate(0,0)}.modal-open .modal{overflow-x:hidden;overflow-y:auto}.modal-dialog{position:relative;width:auto;margin:10px}.modal-content{position:relative;background-color:#fff;border:1px solid #999;border:1px solid rgba(0,0,0,.2);border-radius:3px;-webkit-box-shadow:0 3px 9px rgba(0,0,0,.5);box-shadow:0 3px 9px rgba(0,0,0,.5);background-clip:padding-box;outline:0}.modal-backdrop{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1040;background-color:#000}.modal-backdrop.fade{opacity:0;filter:alpha(opacity=0)}.modal-backdrop.in{opacity:.5;filter:alpha(opacity=50)}.modal-header{padding:15px;border-bottom:1px solid #e5e5e5}.modal-header .close{margin-top:-2px}.modal-title{margin:0;line-height:1.42857143}.modal-body{position:relative;padding:15px}.modal-footer{padding:15px;text-align:right;border-top:1px solid #e5e5e5}.modal-footer .btn+.btn{margin-left:5px;margin-bottom:0}.modal-footer .btn-group .btn+.btn{margin-left:-1px}.modal-footer .btn-block+.btn-block{margin-left:0}.modal-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}@media (min-width:768px){.modal-dialog{width:600px;margin:30px auto}.modal-content{-webkit-box-shadow:0 5px 15px rgba(0,0,0,.5);box-shadow:0 5px 15px rgba(0,0,0,.5)}.modal-sm{width:300px}}@media (min-width:992px){.modal-lg{width:900px}}.tooltip{position:absolute;z-index:1070;display:block;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-style:normal;font-weight:400;letter-spacing:normal;line-break:auto;line-height:1.42857143;text-align:left;text-align:start;text-decoration:none;text-shadow:none;text-transform:none;white-space:normal;word-break:normal;word-spacing:normal;word-wrap:normal;font-size:12px;opacity:0;filter:alpha(opacity=0)}.tooltip.in{opacity:.9;filter:alpha(opacity=90)}.tooltip.top{margin-top:-3px;padding:5px 0}.tooltip.right{margin-left:3px;padding:0 5px}.tooltip.bottom{margin-top:3px;padding:5px 0}.tooltip.left{margin-left:-3px;padding:0 5px}.tooltip-inner{max-width:200px;padding:3px 8px;color:#fff;text-align:center;background-color:#000;border-radius:2px}.tooltip-arrow{position:absolute;width:0;height:0;border-color:transparent;border-style:solid}.tooltip.top .tooltip-arrow{bottom:0;left:50%;margin-left:-5px;border-width:5px 5px 0;border-top-color:#000}.tooltip.top-left .tooltip-arrow{bottom:0;right:5px;margin-bottom:-5px;border-width:5px 5px 0;border-top-color:#000}.tooltip.top-right .tooltip-arrow{bottom:0;left:5px;margin-bottom:-5px;border-width:5px 5px 0;border-top-color:#000}.tooltip.right .tooltip-arrow{top:50%;left:0;margin-top:-5px;border-width:5px 5px 5px 0;border-right-color:#000}.tooltip.left .tooltip-arrow{top:50%;right:0;margin-top:-5px;border-width:5px 0 5px 5px;border-left-color:#000}.tooltip.bottom .tooltip-arrow{top:0;left:50%;margin-left:-5px;border-width:0 5px 5px;border-bottom-color:#000}.tooltip.bottom-left .tooltip-arrow{top:0;right:5px;margin-top:-5px;border-width:0 5px 5px;border-bottom-color:#000}.tooltip.bottom-right .tooltip-arrow{top:0;left:5px;margin-top:-5px;border-width:0 5px 5px;border-bottom-color:#000}.popover{position:absolute;top:0;left:0;z-index:1060;display:none;max-width:276px;padding:1px;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-style:normal;font-weight:400;letter-spacing:normal;line-break:auto;line-height:1.42857143;text-align:left;text-align:start;text-decoration:none;text-shadow:none;text-transform:none;white-space:normal;word-break:normal;word-spacing:normal;word-wrap:normal;font-size:13px;background-color:#fff;background-clip:padding-box;border:1px solid #ccc;border:1px solid rgba(0,0,0,.2);border-radius:3px;-webkit-box-shadow:0 5px 10px rgba(0,0,0,.2);box-shadow:0 5px 10px rgba(0,0,0,.2)}.popover.top{margin-top:-10px}.popover.right{margin-left:10px}.popover.bottom{margin-top:10px}.popover.left{margin-left:-10px}.popover-title{margin:0;padding:8px 14px;font-size:13px;background-color:#f7f7f7;border-bottom:1px solid #ebebeb;border-radius:2px 2px 0 0}.popover-content{padding:9px 14px}.popover>.arrow,.popover>.arrow:after{position:absolute;display:block;width:0;height:0;border-color:transparent;border-style:solid}.popover>.arrow{border-width:11px}.popover>.arrow:after{border-width:10px;content:""}.popover.top>.arrow{left:50%;margin-left:-11px;border-bottom-width:0;border-top-color:#999;border-top-color:rgba(0,0,0,.25);bottom:-11px}.popover.top>.arrow:after{content:" ";bottom:1px;margin-left:-10px;border-bottom-width:0;border-top-color:#fff}.popover.right>.arrow{top:50%;left:-11px;margin-top:-11px;border-left-width:0;border-right-color:#999;border-right-color:rgba(0,0,0,.25)}.popover.right>.arrow:after{content:" ";left:1px;bottom:-10px;border-left-width:0;border-right-color:#fff}.popover.bottom>.arrow{left:50%;margin-left:-11px;border-top-width:0;border-bottom-color:#999;border-bottom-color:rgba(0,0,0,.25);top:-11px}.popover.bottom>.arrow:after{content:" ";top:1px;margin-left:-10px;border-top-width:0;border-bottom-color:#fff}.popover.left>.arrow{top:50%;right:-11px;margin-top:-11px;border-right-width:0;border-left-color:#999;border-left-color:rgba(0,0,0,.25)}.popover.left>.arrow:after{content:" ";right:1px;border-right-width:0;border-left-color:#fff;bottom:-10px}.carousel{position:relative}.carousel-inner{position:relative;overflow:hidden;width:100%}.carousel-inner>.item{display:none;position:relative;-webkit-transition:.6s ease-in-out left;-o-transition:.6s ease-in-out left;transition:.6s ease-in-out left}.carousel-inner>.item>a>img,.carousel-inner>.item>img{line-height:1}@media all and (transform-3d),(-webkit-transform-3d){.carousel-inner>.item{-webkit-transition:-webkit-transform .6s ease-in-out;-moz-transition:-moz-transform .6s ease-in-out;-o-transition:-o-transform .6s ease-in-out;transition:transform .6s ease-in-out;-webkit-backface-visibility:hidden;-moz-backface-visibility:hidden;backface-visibility:hidden;-webkit-perspective:1000px;-moz-perspective:1000px;perspective:1000px}.carousel-inner>.item.active.right,.carousel-inner>.item.next{-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0);left:0}.carousel-inner>.item.active.left,.carousel-inner>.item.prev{-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0);left:0}.carousel-inner>.item.active,.carousel-inner>.item.next.left,.carousel-inner>.item.prev.right{-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0);left:0}}.carousel-inner>.active,.carousel-inner>.next,.carousel-inner>.prev{display:block}.carousel-inner>.active{left:0}.carousel-inner>.next,.carousel-inner>.prev{position:absolute;top:0;width:100%}.carousel-inner>.next{left:100%}.carousel-inner>.prev{left:-100%}.carousel-inner>.next.left,.carousel-inner>.prev.right{left:0}.carousel-inner>.active.left{left:-100%}.carousel-inner>.active.right{left:100%}.carousel-control{position:absolute;top:0;left:0;bottom:0;width:15%;opacity:.5;filter:alpha(opacity=50);font-size:20px;color:#fff;text-align:center;text-shadow:0 1px 2px rgba(0,0,0,.6);background-color:rgba(0,0,0,0)}.carousel-control.left{background-image:-webkit-linear-gradient(left,rgba(0,0,0,.5) 0,rgba(0,0,0,.0001) 100%);background-image:-o-linear-gradient(left,rgba(0,0,0,.5) 0,rgba(0,0,0,.0001) 100%);background-image:linear-gradient(to right,rgba(0,0,0,.5) 0,rgba(0,0,0,.0001) 100%);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#80000000', endColorstr='#00000000', GradientType=1)}.carousel-control.right{left:auto;right:0;background-image:-webkit-linear-gradient(left,rgba(0,0,0,.0001) 0,rgba(0,0,0,.5) 100%);background-image:-o-linear-gradient(left,rgba(0,0,0,.0001) 0,rgba(0,0,0,.5) 100%);background-image:linear-gradient(to right,rgba(0,0,0,.0001) 0,rgba(0,0,0,.5) 100%);background-repeat:repeat-x;filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#00000000', endColorstr='#80000000', GradientType=1)}.carousel-control:focus,.carousel-control:hover{outline:0;color:#fff;text-decoration:none;opacity:.9;filter:alpha(opacity=90)}.carousel-control .glyphicon-chevron-left,.carousel-control .glyphicon-chevron-right,.carousel-control .icon-next,.carousel-control .icon-prev{position:absolute;top:50%;margin-top:-10px;z-index:5;display:inline-block}.carousel-control .glyphicon-chevron-left,.carousel-control .icon-prev{left:50%;margin-left:-10px}.carousel-control .glyphicon-chevron-right,.carousel-control .icon-next{right:50%;margin-right:-10px}.carousel-control .icon-next,.carousel-control .icon-prev{width:20px;height:20px;line-height:1;font-family:serif}.carousel-control .icon-prev:before{content:'\2039'}.carousel-control .icon-next:before{content:'\203a'}.carousel-indicators{position:absolute;bottom:10px;left:50%;z-index:15;width:60%;margin-left:-30%;padding-left:0;list-style:none;text-align:center}.carousel-indicators li{display:inline-block;width:10px;height:10px;margin:1px;text-indent:-999px;border:1px solid #fff;border-radius:10px;cursor:pointer;background-color:#000\9;background-color:rgba(0,0,0,0)}.carousel-indicators .active{margin:0;width:12px;height:12px;background-color:#fff}.carousel-caption{position:absolute;left:15%;right:15%;bottom:20px;z-index:10;padding-top:20px;padding-bottom:20px;color:#fff;text-align:center;text-shadow:0 1px 2px rgba(0,0,0,.6)}.carousel-caption .btn{text-shadow:none}@media screen and (min-width:768px){.carousel-control .glyphicon-chevron-left,.carousel-control .glyphicon-chevron-right,.carousel-control .icon-next,.carousel-control .icon-prev{width:30px;height:30px;margin-top:-10px;font-size:30px}.carousel-control .glyphicon-chevron-left,.carousel-control .icon-prev{margin-left:-10px}.carousel-control .glyphicon-chevron-right,.carousel-control .icon-next{margin-right:-10px}.carousel-caption{left:20%;right:20%;padding-bottom:30px}.carousel-indicators{bottom:20px}}.btn-group-vertical>.btn-group:after,.btn-group-vertical>.btn-group:before,.btn-toolbar:after,.btn-toolbar:before,.clearfix:after,.clearfix:before,.container-fluid:after,.container-fluid:before,.container:after,.container:before,.dl-horizontal dd:after,.dl-horizontal dd:before,.form-horizontal .form-group:after,.form-horizontal .form-group:before,.item_buttons:after,.item_buttons:before,.modal-footer:after,.modal-footer:before,.modal-header:after,.modal-header:before,.nav:after,.nav:before,.navbar-collapse:after,.navbar-collapse:before,.navbar-header:after,.navbar-header:before,.navbar:after,.navbar:before,.pager:after,.pager:before,.panel-body:after,.panel-body:before,.row:after,.row:before{content:" ";display:table}.btn-group-vertical>.btn-group:after,.btn-toolbar:after,.clearfix:after,.container-fluid:after,.container:after,.dl-horizontal dd:after,.form-horizontal .form-group:after,.item_buttons:after,.modal-footer:after,.modal-header:after,.nav:after,.navbar-collapse:after,.navbar-header:after,.navbar:after,.pager:after,.panel-body:after,.row:after{clear:both}.center-block{display:block;margin-left:auto;margin-right:auto}.pull-right{float:right!important}.pull-left{float:left!important}.hide{display:none!important}.show{display:block!important}.invisible{visibility:hidden}.text-hide{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0}.hidden{display:none!important}.affix{position:fixed}@-ms-viewport{width:device-width}.visible-lg,.visible-md,.visible-sm,.visible-xs{display:none!important}.visible-lg-block,.visible-lg-inline,.visible-lg-inline-block,.visible-md-block,.visible-md-inline,.visible-md-inline-block,.visible-sm-block,.visible-sm-inline,.visible-sm-inline-block,.visible-xs-block,.visible-xs-inline,.visible-xs-inline-block{display:none!important}@media (max-width:767px){.visible-xs{display:block!important}table.visible-xs{display:table!important}tr.visible-xs{display:table-row!important}td.visible-xs,th.visible-xs{display:table-cell!important}}@media (max-width:767px){.visible-xs-block{display:block!important}}@media (max-width:767px){.visible-xs-inline{display:inline!important}}@media (max-width:767px){.visible-xs-inline-block{display:inline-block!important}}@media (min-width:768px) and (max-width:991px){.visible-sm{display:block!important}table.visible-sm{display:table!important}tr.visible-sm{display:table-row!important}td.visible-sm,th.visible-sm{display:table-cell!important}}@media (min-width:768px) and (max-width:991px){.visible-sm-block{display:block!important}}@media (min-width:768px) and (max-width:991px){.visible-sm-inline{display:inline!important}}@media (min-width:768px) and (max-width:991px){.visible-sm-inline-block{display:inline-block!important}}@media (min-width:992px) and (max-width:1199px){.visible-md{display:block!important}table.visible-md{display:table!important}tr.visible-md{display:table-row!important}td.visible-md,th.visible-md{display:table-cell!important}}@media (min-width:992px) and (max-width:1199px){.visible-md-block{display:block!important}}@media (min-width:992px) and (max-width:1199px){.visible-md-inline{display:inline!important}}@media (min-width:992px) and (max-width:1199px){.visible-md-inline-block{display:inline-block!important}}@media (min-width:1200px){.visible-lg{display:block!important}table.visible-lg{display:table!important}tr.visible-lg{display:table-row!important}td.visible-lg,th.visible-lg{display:table-cell!important}}@media (min-width:1200px){.visible-lg-block{display:block!important}}@media (min-width:1200px){.visible-lg-inline{display:inline!important}}@media (min-width:1200px){.visible-lg-inline-block{display:inline-block!important}}@media (max-width:767px){.hidden-xs{display:none!important}}@media (min-width:768px) and (max-width:991px){.hidden-sm{display:none!important}}@media (min-width:992px) and (max-width:1199px){.hidden-md{display:none!important}}@media (min-width:1200px){.hidden-lg{display:none!important}}.visible-print{display:none!important}@media print{.visible-print{display:block!important}table.visible-print{display:table!important}tr.visible-print{display:table-row!important}td.visible-print,th.visible-print{display:table-cell!important}}.visible-print-block{display:none!important}@media print{.visible-print-block{display:block!important}}.visible-print-inline{display:none!important}@media print{.visible-print-inline{display:inline!important}}.visible-print-inline-block{display:none!important}@media print{.visible-print-inline-block{display:inline-block!important}}@media print{.hidden-print{display:none!important}}/*!
*
* Font Awesome
*
*//*!
 *  Font Awesome 4.2.0 by @davegandy - http://fontawesome.io - @fontawesome
 *  License - http://fontawesome.io/license (Font: SIL OFL 1.1, CSS: MIT License)
 */@font-face{font-family:FontAwesome;src:url(../components/font-awesome/fonts/fontawesome-webfont.eot?v=4.2.0);src:url(../components/font-awesome/fonts/fontawesome-webfont.eot?#iefix&v=4.2.0) format('embedded-opentype'),url(../components/font-awesome/fonts/fontawesome-webfont.woff?v=4.2.0) format('woff'),url(../components/font-awesome/fonts/fontawesome-webfont.ttf?v=4.2.0) format('truetype'),url(../components/font-awesome/fonts/fontawesome-webfont.svg?v=4.2.0#fontawesomeregular) format('svg');font-weight:400;font-style:normal}.fa{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fa-lg{font-size:1.33333333em;line-height:.75em;vertical-align:-15%}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-fw{width:1.28571429em;text-align:center}.fa-ul{padding-left:0;margin-left:2.14285714em;list-style-type:none}.fa-ul>li{position:relative}.fa-li{position:absolute;left:-2.14285714em;width:2.14285714em;top:.14285714em;text-align:center}.fa-li.fa-lg{left:-1.85714286em}.fa-border{padding:.2em .25em .15em;border:solid .08em #eee;border-radius:.1em}.pull-right{float:right}.pull-left{float:left}.fa.pull-left{margin-right:.3em}.fa.pull-right{margin-left:.3em}.fa-spin{-webkit-animation:fa-spin 2s infinite linear;animation:fa-spin 2s infinite linear}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}.fa-rotate-90{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=1);-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=2);-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=3);-webkit-transform:rotate(270deg);-ms-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1);-webkit-transform:scale(-1,1);-ms-transform:scale(-1,1);transform:scale(-1,1)}.fa-flip-vertical{filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1);-webkit-transform:scale(1,-1);-ms-transform:scale(1,-1);transform:scale(1,-1)}:root .fa-flip-horizontal,:root .fa-flip-vertical,:root .fa-rotate-180,:root .fa-rotate-270,:root .fa-rotate-90{filter:none}.fa-stack{position:relative;display:inline-block;width:2em;height:2em;line-height:2em;vertical-align:middle}.fa-stack-1x,.fa-stack-2x{position:absolute;left:0;width:100%;text-align:center}.fa-stack-1x{line-height:inherit}.fa-stack-2x{font-size:2em}.fa-inverse{color:#fff}.fa-glass:before{content:"\f000"}.fa-music:before{content:"\f001"}.fa-search:before{content:"\f002"}.fa-envelope-o:before{content:"\f003"}.fa-heart:before{content:"\f004"}.fa-star:before{content:"\f005"}.fa-star-o:before{content:"\f006"}.fa-user:before{content:"\f007"}.fa-film:before{content:"\f008"}.fa-th-large:before{content:"\f009"}.fa-th:before{content:"\f00a"}.fa-th-list:before{content:"\f00b"}.fa-check:before{content:"\f00c"}.fa-close:before,.fa-remove:before,.fa-times:before{content:"\f00d"}.fa-search-plus:before{content:"\f00e"}.fa-search-minus:before{content:"\f010"}.fa-power-off:before{content:"\f011"}.fa-signal:before{content:"\f012"}.fa-cog:before,.fa-gear:before{content:"\f013"}.fa-trash-o:before{content:"\f014"}.fa-home:before{content:"\f015"}.fa-file-o:before{content:"\f016"}.fa-clock-o:before{content:"\f017"}.fa-road:before{content:"\f018"}.fa-download:before{content:"\f019"}.fa-arrow-circle-o-down:before{content:"\f01a"}.fa-arrow-circle-o-up:before{content:"\f01b"}.fa-inbox:before{content:"\f01c"}.fa-play-circle-o:before{content:"\f01d"}.fa-repeat:before,.fa-rotate-right:before{content:"\f01e"}.fa-refresh:before{content:"\f021"}.fa-list-alt:before{content:"\f022"}.fa-lock:before{content:"\f023"}.fa-flag:before{content:"\f024"}.fa-headphones:before{content:"\f025"}.fa-volume-off:before{content:"\f026"}.fa-volume-down:before{content:"\f027"}.fa-volume-up:before{content:"\f028"}.fa-qrcode:before{content:"\f029"}.fa-barcode:before{content:"\f02a"}.fa-tag:before{content:"\f02b"}.fa-tags:before{content:"\f02c"}.fa-book:before{content:"\f02d"}.fa-bookmark:before{content:"\f02e"}.fa-print:before{content:"\f02f"}.fa-camera:before{content:"\f030"}.fa-font:before{content:"\f031"}.fa-bold:before{content:"\f032"}.fa-italic:before{content:"\f033"}.fa-text-height:before{content:"\f034"}.fa-text-width:before{content:"\f035"}.fa-align-left:before{content:"\f036"}.fa-align-center:before{content:"\f037"}.fa-align-right:before{content:"\f038"}.fa-align-justify:before{content:"\f039"}.fa-list:before{content:"\f03a"}.fa-dedent:before,.fa-outdent:before{content:"\f03b"}.fa-indent:before{content:"\f03c"}.fa-video-camera:before{content:"\f03d"}.fa-image:before,.fa-photo:before,.fa-picture-o:before{content:"\f03e"}.fa-pencil:before{content:"\f040"}.fa-map-marker:before{content:"\f041"}.fa-adjust:before{content:"\f042"}.fa-tint:before{content:"\f043"}.fa-edit:before,.fa-pencil-square-o:before{content:"\f044"}.fa-share-square-o:before{content:"\f045"}.fa-check-square-o:before{content:"\f046"}.fa-arrows:before{content:"\f047"}.fa-step-backward:before{content:"\f048"}.fa-fast-backward:before{content:"\f049"}.fa-backward:before{content:"\f04a"}.fa-play:before{content:"\f04b"}.fa-pause:before{content:"\f04c"}.fa-stop:before{content:"\f04d"}.fa-forward:before{content:"\f04e"}.fa-fast-forward:before{content:"\f050"}.fa-step-forward:before{content:"\f051"}.fa-eject:before{content:"\f052"}.fa-chevron-left:before{content:"\f053"}.fa-chevron-right:before{content:"\f054"}.fa-plus-circle:before{content:"\f055"}.fa-minus-circle:before{content:"\f056"}.fa-times-circle:before{content:"\f057"}.fa-check-circle:before{content:"\f058"}.fa-question-circle:before{content:"\f059"}.fa-info-circle:before{content:"\f05a"}.fa-crosshairs:before{content:"\f05b"}.fa-times-circle-o:before{content:"\f05c"}.fa-check-circle-o:before{content:"\f05d"}.fa-ban:before{content:"\f05e"}.fa-arrow-left:before{content:"\f060"}.fa-arrow-right:before{content:"\f061"}.fa-arrow-up:before{content:"\f062"}.fa-arrow-down:before{content:"\f063"}.fa-mail-forward:before,.fa-share:before{content:"\f064"}.fa-expand:before{content:"\f065"}.fa-compress:before{content:"\f066"}.fa-plus:before{content:"\f067"}.fa-minus:before{content:"\f068"}.fa-asterisk:before{content:"\f069"}.fa-exclamation-circle:before{content:"\f06a"}.fa-gift:before{content:"\f06b"}.fa-leaf:before{content:"\f06c"}.fa-fire:before{content:"\f06d"}.fa-eye:before{content:"\f06e"}.fa-eye-slash:before{content:"\f070"}.fa-exclamation-triangle:before,.fa-warning:before{content:"\f071"}.fa-plane:before{content:"\f072"}.fa-calendar:before{content:"\f073"}.fa-random:before{content:"\f074"}.fa-comment:before{content:"\f075"}.fa-magnet:before{content:"\f076"}.fa-chevron-up:before{content:"\f077"}.fa-chevron-down:before{content:"\f078"}.fa-retweet:before{content:"\f079"}.fa-shopping-cart:before{content:"\f07a"}.fa-folder:before{content:"\f07b"}.fa-folder-open:before{content:"\f07c"}.fa-arrows-v:before{content:"\f07d"}.fa-arrows-h:before{content:"\f07e"}.fa-bar-chart-o:before,.fa-bar-chart:before{content:"\f080"}.fa-twitter-square:before{content:"\f081"}.fa-facebook-square:before{content:"\f082"}.fa-camera-retro:before{content:"\f083"}.fa-key:before{content:"\f084"}.fa-cogs:before,.fa-gears:before{content:"\f085"}.fa-comments:before{content:"\f086"}.fa-thumbs-o-up:before{content:"\f087"}.fa-thumbs-o-down:before{content:"\f088"}.fa-star-half:before{content:"\f089"}.fa-heart-o:before{content:"\f08a"}.fa-sign-out:before{content:"\f08b"}.fa-linkedin-square:before{content:"\f08c"}.fa-thumb-tack:before{content:"\f08d"}.fa-external-link:before{content:"\f08e"}.fa-sign-in:before{content:"\f090"}.fa-trophy:before{content:"\f091"}.fa-github-square:before{content:"\f092"}.fa-upload:before{content:"\f093"}.fa-lemon-o:before{content:"\f094"}.fa-phone:before{content:"\f095"}.fa-square-o:before{content:"\f096"}.fa-bookmark-o:before{content:"\f097"}.fa-phone-square:before{content:"\f098"}.fa-twitter:before{content:"\f099"}.fa-facebook:before{content:"\f09a"}.fa-github:before{content:"\f09b"}.fa-unlock:before{content:"\f09c"}.fa-credit-card:before{content:"\f09d"}.fa-rss:before{content:"\f09e"}.fa-hdd-o:before{content:"\f0a0"}.fa-bullhorn:before{content:"\f0a1"}.fa-bell:before{content:"\f0f3"}.fa-certificate:before{content:"\f0a3"}.fa-hand-o-right:before{content:"\f0a4"}.fa-hand-o-left:before{content:"\f0a5"}.fa-hand-o-up:before{content:"\f0a6"}.fa-hand-o-down:before{content:"\f0a7"}.fa-arrow-circle-left:before{content:"\f0a8"}.fa-arrow-circle-right:before{content:"\f0a9"}.fa-arrow-circle-up:before{content:"\f0aa"}.fa-arrow-circle-down:before{content:"\f0ab"}.fa-globe:before{content:"\f0ac"}.fa-wrench:before{content:"\f0ad"}.fa-tasks:before{content:"\f0ae"}.fa-filter:before{content:"\f0b0"}.fa-briefcase:before{content:"\f0b1"}.fa-arrows-alt:before{content:"\f0b2"}.fa-group:before,.fa-users:before{content:"\f0c0"}.fa-chain:before,.fa-link:before{content:"\f0c1"}.fa-cloud:before{content:"\f0c2"}.fa-flask:before{content:"\f0c3"}.fa-cut:before,.fa-scissors:before{content:"\f0c4"}.fa-copy:before,.fa-files-o:before{content:"\f0c5"}.fa-paperclip:before{content:"\f0c6"}.fa-floppy-o:before,.fa-save:before{content:"\f0c7"}.fa-square:before{content:"\f0c8"}.fa-bars:before,.fa-navicon:before,.fa-reorder:before{content:"\f0c9"}.fa-list-ul:before{content:"\f0ca"}.fa-list-ol:before{content:"\f0cb"}.fa-strikethrough:before{content:"\f0cc"}.fa-underline:before{content:"\f0cd"}.fa-table:before{content:"\f0ce"}.fa-magic:before{content:"\f0d0"}.fa-truck:before{content:"\f0d1"}.fa-pinterest:before{content:"\f0d2"}.fa-pinterest-square:before{content:"\f0d3"}.fa-google-plus-square:before{content:"\f0d4"}.fa-google-plus:before{content:"\f0d5"}.fa-money:before{content:"\f0d6"}.fa-caret-down:before{content:"\f0d7"}.fa-caret-up:before{content:"\f0d8"}.fa-caret-left:before{content:"\f0d9"}.fa-caret-right:before{content:"\f0da"}.fa-columns:before{content:"\f0db"}.fa-sort:before,.fa-unsorted:before{content:"\f0dc"}.fa-sort-desc:before,.fa-sort-down:before{content:"\f0dd"}.fa-sort-asc:before,.fa-sort-up:before{content:"\f0de"}.fa-envelope:before{content:"\f0e0"}.fa-linkedin:before{content:"\f0e1"}.fa-rotate-left:before,.fa-undo:before{content:"\f0e2"}.fa-gavel:before,.fa-legal:before{content:"\f0e3"}.fa-dashboard:before,.fa-tachometer:before{content:"\f0e4"}.fa-comment-o:before{content:"\f0e5"}.fa-comments-o:before{content:"\f0e6"}.fa-bolt:before,.fa-flash:before{content:"\f0e7"}.fa-sitemap:before{content:"\f0e8"}.fa-umbrella:before{content:"\f0e9"}.fa-clipboard:before,.fa-paste:before{content:"\f0ea"}.fa-lightbulb-o:before{content:"\f0eb"}.fa-exchange:before{content:"\f0ec"}.fa-cloud-download:before{content:"\f0ed"}.fa-cloud-upload:before{content:"\f0ee"}.fa-user-md:before{content:"\f0f0"}.fa-stethoscope:before{content:"\f0f1"}.fa-suitcase:before{content:"\f0f2"}.fa-bell-o:before{content:"\f0a2"}.fa-coffee:before{content:"\f0f4"}.fa-cutlery:before{content:"\f0f5"}.fa-file-text-o:before{content:"\f0f6"}.fa-building-o:before{content:"\f0f7"}.fa-hospital-o:before{content:"\f0f8"}.fa-ambulance:before{content:"\f0f9"}.fa-medkit:before{content:"\f0fa"}.fa-fighter-jet:before{content:"\f0fb"}.fa-beer:before{content:"\f0fc"}.fa-h-square:before{content:"\f0fd"}.fa-plus-square:before{content:"\f0fe"}.fa-angle-double-left:before{content:"\f100"}.fa-angle-double-right:before{content:"\f101"}.fa-angle-double-up:before{content:"\f102"}.fa-angle-double-down:before{content:"\f103"}.fa-angle-left:before{content:"\f104"}.fa-angle-right:before{content:"\f105"}.fa-angle-up:before{content:"\f106"}.fa-angle-down:before{content:"\f107"}.fa-desktop:before{content:"\f108"}.fa-laptop:before{content:"\f109"}.fa-tablet:before{content:"\f10a"}.fa-mobile-phone:before,.fa-mobile:before{content:"\f10b"}.fa-circle-o:before{content:"\f10c"}.fa-quote-left:before{content:"\f10d"}.fa-quote-right:before{content:"\f10e"}.fa-spinner:before{content:"\f110"}.fa-circle:before{content:"\f111"}.fa-mail-reply:before,.fa-reply:before{content:"\f112"}.fa-github-alt:before{content:"\f113"}.fa-folder-o:before{content:"\f114"}.fa-folder-open-o:before{content:"\f115"}.fa-smile-o:before{content:"\f118"}.fa-frown-o:before{content:"\f119"}.fa-meh-o:before{content:"\f11a"}.fa-gamepad:before{content:"\f11b"}.fa-keyboard-o:before{content:"\f11c"}.fa-flag-o:before{content:"\f11d"}.fa-flag-checkered:before{content:"\f11e"}.fa-terminal:before{content:"\f120"}.fa-code:before{content:"\f121"}.fa-mail-reply-all:before,.fa-reply-all:before{content:"\f122"}.fa-star-half-empty:before,.fa-star-half-full:before,.fa-star-half-o:before{content:"\f123"}.fa-location-arrow:before{content:"\f124"}.fa-crop:before{content:"\f125"}.fa-code-fork:before{content:"\f126"}.fa-chain-broken:before,.fa-unlink:before{content:"\f127"}.fa-question:before{content:"\f128"}.fa-info:before{content:"\f129"}.fa-exclamation:before{content:"\f12a"}.fa-superscript:before{content:"\f12b"}.fa-subscript:before{content:"\f12c"}.fa-eraser:before{content:"\f12d"}.fa-puzzle-piece:before{content:"\f12e"}.fa-microphone:before{content:"\f130"}.fa-microphone-slash:before{content:"\f131"}.fa-shield:before{content:"\f132"}.fa-calendar-o:before{content:"\f133"}.fa-fire-extinguisher:before{content:"\f134"}.fa-rocket:before{content:"\f135"}.fa-maxcdn:before{content:"\f136"}.fa-chevron-circle-left:before{content:"\f137"}.fa-chevron-circle-right:before{content:"\f138"}.fa-chevron-circle-up:before{content:"\f139"}.fa-chevron-circle-down:before{content:"\f13a"}.fa-html5:before{content:"\f13b"}.fa-css3:before{content:"\f13c"}.fa-anchor:before{content:"\f13d"}.fa-unlock-alt:before{content:"\f13e"}.fa-bullseye:before{content:"\f140"}.fa-ellipsis-h:before{content:"\f141"}.fa-ellipsis-v:before{content:"\f142"}.fa-rss-square:before{content:"\f143"}.fa-play-circle:before{content:"\f144"}.fa-ticket:before{content:"\f145"}.fa-minus-square:before{content:"\f146"}.fa-minus-square-o:before{content:"\f147"}.fa-level-up:before{content:"\f148"}.fa-level-down:before{content:"\f149"}.fa-check-square:before{content:"\f14a"}.fa-pencil-square:before{content:"\f14b"}.fa-external-link-square:before{content:"\f14c"}.fa-share-square:before{content:"\f14d"}.fa-compass:before{content:"\f14e"}.fa-caret-square-o-down:before,.fa-toggle-down:before{content:"\f150"}.fa-caret-square-o-up:before,.fa-toggle-up:before{content:"\f151"}.fa-caret-square-o-right:before,.fa-toggle-right:before{content:"\f152"}.fa-eur:before,.fa-euro:before{content:"\f153"}.fa-gbp:before{content:"\f154"}.fa-dollar:before,.fa-usd:before{content:"\f155"}.fa-inr:before,.fa-rupee:before{content:"\f156"}.fa-cny:before,.fa-jpy:before,.fa-rmb:before,.fa-yen:before{content:"\f157"}.fa-rouble:before,.fa-rub:before,.fa-ruble:before{content:"\f158"}.fa-krw:before,.fa-won:before{content:"\f159"}.fa-bitcoin:before,.fa-btc:before{content:"\f15a"}.fa-file:before{content:"\f15b"}.fa-file-text:before{content:"\f15c"}.fa-sort-alpha-asc:before{content:"\f15d"}.fa-sort-alpha-desc:before{content:"\f15e"}.fa-sort-amount-asc:before{content:"\f160"}.fa-sort-amount-desc:before{content:"\f161"}.fa-sort-numeric-asc:before{content:"\f162"}.fa-sort-numeric-desc:before{content:"\f163"}.fa-thumbs-up:before{content:"\f164"}.fa-thumbs-down:before{content:"\f165"}.fa-youtube-square:before{content:"\f166"}.fa-youtube:before{content:"\f167"}.fa-xing:before{content:"\f168"}.fa-xing-square:before{content:"\f169"}.fa-youtube-play:before{content:"\f16a"}.fa-dropbox:before{content:"\f16b"}.fa-stack-overflow:before{content:"\f16c"}.fa-instagram:before{content:"\f16d"}.fa-flickr:before{content:"\f16e"}.fa-adn:before{content:"\f170"}.fa-bitbucket:before{content:"\f171"}.fa-bitbucket-square:before{content:"\f172"}.fa-tumblr:before{content:"\f173"}.fa-tumblr-square:before{content:"\f174"}.fa-long-arrow-down:before{content:"\f175"}.fa-long-arrow-up:before{content:"\f176"}.fa-long-arrow-left:before{content:"\f177"}.fa-long-arrow-right:before{content:"\f178"}.fa-apple:before{content:"\f179"}.fa-windows:before{content:"\f17a"}.fa-android:before{content:"\f17b"}.fa-linux:before{content:"\f17c"}.fa-dribbble:before{content:"\f17d"}.fa-skype:before{content:"\f17e"}.fa-foursquare:before{content:"\f180"}.fa-trello:before{content:"\f181"}.fa-female:before{content:"\f182"}.fa-male:before{content:"\f183"}.fa-gittip:before{content:"\f184"}.fa-sun-o:before{content:"\f185"}.fa-moon-o:before{content:"\f186"}.fa-archive:before{content:"\f187"}.fa-bug:before{content:"\f188"}.fa-vk:before{content:"\f189"}.fa-weibo:before{content:"\f18a"}.fa-renren:before{content:"\f18b"}.fa-pagelines:before{content:"\f18c"}.fa-stack-exchange:before{content:"\f18d"}.fa-arrow-circle-o-right:before{content:"\f18e"}.fa-arrow-circle-o-left:before{content:"\f190"}.fa-caret-square-o-left:before,.fa-toggle-left:before{content:"\f191"}.fa-dot-circle-o:before{content:"\f192"}.fa-wheelchair:before{content:"\f193"}.fa-vimeo-square:before{content:"\f194"}.fa-try:before,.fa-turkish-lira:before{content:"\f195"}.fa-plus-square-o:before{content:"\f196"}.fa-space-shuttle:before{content:"\f197"}.fa-slack:before{content:"\f198"}.fa-envelope-square:before{content:"\f199"}.fa-wordpress:before{content:"\f19a"}.fa-openid:before{content:"\f19b"}.fa-bank:before,.fa-institution:before,.fa-university:before{content:"\f19c"}.fa-graduation-cap:before,.fa-mortar-board:before{content:"\f19d"}.fa-yahoo:before{content:"\f19e"}.fa-google:before{content:"\f1a0"}.fa-reddit:before{content:"\f1a1"}.fa-reddit-square:before{content:"\f1a2"}.fa-stumbleupon-circle:before{content:"\f1a3"}.fa-stumbleupon:before{content:"\f1a4"}.fa-delicious:before{content:"\f1a5"}.fa-digg:before{content:"\f1a6"}.fa-pied-piper:before{content:"\f1a7"}.fa-pied-piper-alt:before{content:"\f1a8"}.fa-drupal:before{content:"\f1a9"}.fa-joomla:before{content:"\f1aa"}.fa-language:before{content:"\f1ab"}.fa-fax:before{content:"\f1ac"}.fa-building:before{content:"\f1ad"}.fa-child:before{content:"\f1ae"}.fa-paw:before{content:"\f1b0"}.fa-spoon:before{content:"\f1b1"}.fa-cube:before{content:"\f1b2"}.fa-cubes:before{content:"\f1b3"}.fa-behance:before{content:"\f1b4"}.fa-behance-square:before{content:"\f1b5"}.fa-steam:before{content:"\f1b6"}.fa-steam-square:before{content:"\f1b7"}.fa-recycle:before{content:"\f1b8"}.fa-automobile:before,.fa-car:before{content:"\f1b9"}.fa-cab:before,.fa-taxi:before{content:"\f1ba"}.fa-tree:before{content:"\f1bb"}.fa-spotify:before{content:"\f1bc"}.fa-deviantart:before{content:"\f1bd"}.fa-soundcloud:before{content:"\f1be"}.fa-database:before{content:"\f1c0"}.fa-file-pdf-o:before{content:"\f1c1"}.fa-file-word-o:before{content:"\f1c2"}.fa-file-excel-o:before{content:"\f1c3"}.fa-file-powerpoint-o:before{content:"\f1c4"}.fa-file-image-o:before,.fa-file-photo-o:before,.fa-file-picture-o:before{content:"\f1c5"}.fa-file-archive-o:before,.fa-file-zip-o:before{content:"\f1c6"}.fa-file-audio-o:before,.fa-file-sound-o:before{content:"\f1c7"}.fa-file-movie-o:before,.fa-file-video-o:before{content:"\f1c8"}.fa-file-code-o:before{content:"\f1c9"}.fa-vine:before{content:"\f1ca"}.fa-codepen:before{content:"\f1cb"}.fa-jsfiddle:before{content:"\f1cc"}.fa-life-bouy:before,.fa-life-buoy:before,.fa-life-ring:before,.fa-life-saver:before,.fa-support:before{content:"\f1cd"}.fa-circle-o-notch:before{content:"\f1ce"}.fa-ra:before,.fa-rebel:before{content:"\f1d0"}.fa-empire:before,.fa-ge:before{content:"\f1d1"}.fa-git-square:before{content:"\f1d2"}.fa-git:before{content:"\f1d3"}.fa-hacker-news:before{content:"\f1d4"}.fa-tencent-weibo:before{content:"\f1d5"}.fa-qq:before{content:"\f1d6"}.fa-wechat:before,.fa-weixin:before{content:"\f1d7"}.fa-paper-plane:before,.fa-send:before{content:"\f1d8"}.fa-paper-plane-o:before,.fa-send-o:before{content:"\f1d9"}.fa-history:before{content:"\f1da"}.fa-circle-thin:before{content:"\f1db"}.fa-header:before{content:"\f1dc"}.fa-paragraph:before{content:"\f1dd"}.fa-sliders:before{content:"\f1de"}.fa-share-alt:before{content:"\f1e0"}.fa-share-alt-square:before{content:"\f1e1"}.fa-bomb:before{content:"\f1e2"}.fa-futbol-o:before,.fa-soccer-ball-o:before{content:"\f1e3"}.fa-tty:before{content:"\f1e4"}.fa-binoculars:before{content:"\f1e5"}.fa-plug:before{content:"\f1e6"}.fa-slideshare:before{content:"\f1e7"}.fa-twitch:before{content:"\f1e8"}.fa-yelp:before{content:"\f1e9"}.fa-newspaper-o:before{content:"\f1ea"}.fa-wifi:before{content:"\f1eb"}.fa-calculator:before{content:"\f1ec"}.fa-paypal:before{content:"\f1ed"}.fa-google-wallet:before{content:"\f1ee"}.fa-cc-visa:before{content:"\f1f0"}.fa-cc-mastercard:before{content:"\f1f1"}.fa-cc-discover:before{content:"\f1f2"}.fa-cc-amex:before{content:"\f1f3"}.fa-cc-paypal:before{content:"\f1f4"}.fa-cc-stripe:before{content:"\f1f5"}.fa-bell-slash:before{content:"\f1f6"}.fa-bell-slash-o:before{content:"\f1f7"}.fa-trash:before{content:"\f1f8"}.fa-copyright:before{content:"\f1f9"}.fa-at:before{content:"\f1fa"}.fa-eyedropper:before{content:"\f1fb"}.fa-paint-brush:before{content:"\f1fc"}.fa-birthday-cake:before{content:"\f1fd"}.fa-area-chart:before{content:"\f1fe"}.fa-pie-chart:before{content:"\f200"}.fa-line-chart:before{content:"\f201"}.fa-lastfm:before{content:"\f202"}.fa-lastfm-square:before{content:"\f203"}.fa-toggle-off:before{content:"\f204"}.fa-toggle-on:before{content:"\f205"}.fa-bicycle:before{content:"\f206"}.fa-bus:before{content:"\f207"}.fa-ioxhost:before{content:"\f208"}.fa-angellist:before{content:"\f209"}.fa-cc:before{content:"\f20a"}.fa-ils:before,.fa-shekel:before,.fa-sheqel:before{content:"\f20b"}.fa-meanpath:before{content:"\f20c"}/*!
*
* IPython base
*
*/.modal.fade .modal-dialog{-webkit-transform:translate(0,0);-ms-transform:translate(0,0);-o-transform:translate(0,0);transform:translate(0,0)}code{color:#000}pre{font-size:inherit;line-height:inherit}label{font-weight:400}.border-box-sizing{box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box}.corner-all{border-radius:2px}.no-padding{padding:0}.hbox{display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}.hbox>*{-webkit-box-flex:0;-moz-box-flex:0;box-flex:0;flex:none}.vbox{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}.vbox>*{-webkit-box-flex:0;-moz-box-flex:0;box-flex:0;flex:none}.hbox.reverse,.reverse,.vbox.reverse{-webkit-box-direction:reverse;-moz-box-direction:reverse;box-direction:reverse;flex-direction:row-reverse}.box-flex0,.hbox.box-flex0,.vbox.box-flex0{-webkit-box-flex:0;-moz-box-flex:0;box-flex:0;flex:none;width:auto}.box-flex1,.hbox.box-flex1,.vbox.box-flex1{-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}.box-flex,.hbox.box-flex,.vbox.box-flex{-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}.box-flex2,.hbox.box-flex2,.vbox.box-flex2{-webkit-box-flex:2;-moz-box-flex:2;box-flex:2;flex:2}.box-group1{-webkit-box-flex-group:1;-moz-box-flex-group:1;box-flex-group:1}.box-group2{-webkit-box-flex-group:2;-moz-box-flex-group:2;box-flex-group:2}.hbox.start,.start,.vbox.start{-webkit-box-pack:start;-moz-box-pack:start;box-pack:start;justify-content:flex-start}.end,.hbox.end,.vbox.end{-webkit-box-pack:end;-moz-box-pack:end;box-pack:end;justify-content:flex-end}.center,.hbox.center,.vbox.center{-webkit-box-pack:center;-moz-box-pack:center;box-pack:center;justify-content:center}.baseline,.hbox.baseline,.vbox.baseline{-webkit-box-pack:baseline;-moz-box-pack:baseline;box-pack:baseline;justify-content:baseline}.hbox.stretch,.stretch,.vbox.stretch{-webkit-box-pack:stretch;-moz-box-pack:stretch;box-pack:stretch;justify-content:stretch}.align-start,.hbox.align-start,.vbox.align-start{-webkit-box-align:start;-moz-box-align:start;box-align:start;align-items:flex-start}.align-end,.hbox.align-end,.vbox.align-end{-webkit-box-align:end;-moz-box-align:end;box-align:end;align-items:flex-end}.align-center,.hbox.align-center,.vbox.align-center{-webkit-box-align:center;-moz-box-align:center;box-align:center;align-items:center}.align-baseline,.hbox.align-baseline,.vbox.align-baseline{-webkit-box-align:baseline;-moz-box-align:baseline;box-align:baseline;align-items:baseline}.align-stretch,.hbox.align-stretch,.vbox.align-stretch{-webkit-box-align:stretch;-moz-box-align:stretch;box-align:stretch;align-items:stretch}div.error{margin:2em;text-align:center}div.error>h1{font-size:500%;line-height:normal}div.error>p{font-size:200%;line-height:normal}div.traceback-wrapper{text-align:left;max-width:800px;margin:auto}body{background-color:#fff;position:absolute;left:0;right:0;top:0;bottom:0;overflow:visible}body>#header{display:none;background-color:#fff;position:relative;z-index:100}body>#header #header-container{padding-bottom:5px;padding-top:5px;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box}body>#header .header-bar{width:100%;height:1px;background:#e7e7e7;margin-bottom:-1px}@media print{body>#header{display:none!important}}#header-spacer{width:100%;visibility:hidden}@media print{#header-spacer{display:none}}#ipython_notebook{padding-left:0;padding-top:1px;padding-bottom:1px}@media (max-width:991px){#ipython_notebook{margin-left:10px}}#noscript{width:auto;padding-top:16px;padding-bottom:16px;text-align:center;font-size:22px;color:red;font-weight:700}#ipython_notebook img{height:28px}#site{width:100%;display:none;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;overflow:auto}@media print{#site{height:auto!important}}.ui-button .ui-button-text{padding:.2em .8em;font-size:77%}input.ui-button{padding:.3em .9em}span#login_widget{float:right}#logout,span#login_widget>.button{color:#333;background-color:#fff;border-color:#ccc}#logout.focus,#logout:focus,span#login_widget>.button.focus,span#login_widget>.button:focus{color:#333;background-color:#e6e6e6;border-color:#8c8c8c}#logout:hover,span#login_widget>.button:hover{color:#333;background-color:#e6e6e6;border-color:#adadad}#logout.active,#logout:active,.open>.dropdown-toggle#logout,.open>.dropdown-togglespan#login_widget>.button,span#login_widget>.button.active,span#login_widget>.button:active{color:#333;background-color:#e6e6e6;border-color:#adadad}#logout.active.focus,#logout.active:focus,#logout.active:hover,#logout:active.focus,#logout:active:focus,#logout:active:hover,.open>.dropdown-toggle#logout.focus,.open>.dropdown-toggle#logout:focus,.open>.dropdown-toggle#logout:hover,.open>.dropdown-togglespan#login_widget>.button.focus,.open>.dropdown-togglespan#login_widget>.button:focus,.open>.dropdown-togglespan#login_widget>.button:hover,span#login_widget>.button.active.focus,span#login_widget>.button.active:focus,span#login_widget>.button.active:hover,span#login_widget>.button:active.focus,span#login_widget>.button:active:focus,span#login_widget>.button:active:hover{color:#333;background-color:#d4d4d4;border-color:#8c8c8c}#logout.active,#logout:active,.open>.dropdown-toggle#logout,.open>.dropdown-togglespan#login_widget>.button,span#login_widget>.button.active,span#login_widget>.button:active{background-image:none}#logout.disabled.focus,#logout.disabled:focus,#logout.disabled:hover,#logout[disabled].focus,#logout[disabled]:focus,#logout[disabled]:hover,fieldset[disabled] #logout.focus,fieldset[disabled] #logout:focus,fieldset[disabled] #logout:hover,fieldset[disabled] span#login_widget>.button.focus,fieldset[disabled] span#login_widget>.button:focus,fieldset[disabled] span#login_widget>.button:hover,span#login_widget>.button.disabled.focus,span#login_widget>.button.disabled:focus,span#login_widget>.button.disabled:hover,span#login_widget>.button[disabled].focus,span#login_widget>.button[disabled]:focus,span#login_widget>.button[disabled]:hover{background-color:#fff;border-color:#ccc}#logout .badge,span#login_widget>.button .badge{color:#fff;background-color:#333}.nav-header{text-transform:none}#header>span{margin-top:10px}.modal_stretch .modal-dialog{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;min-height:80vh}.modal_stretch .modal-dialog .modal-body{max-height:calc(100vh - 200px);overflow:auto;flex:1}@media (min-width:768px){.modal .modal-dialog{width:700px}}@media (min-width:768px){select.form-control{margin-left:12px;margin-right:12px}}/*!
*
* IPython auth
*
*/.center-nav{display:inline-block;margin-bottom:-4px}/*!
*
* IPython tree view
*
*/.alternate_upload{background-color:none;display:inline}.alternate_upload.form{padding:0;margin:0}.alternate_upload input.fileinput{text-align:center;vertical-align:middle;display:inline;opacity:0;z-index:2;width:12ex;margin-right:-12ex}.alternate_upload .btn-upload{height:22px}ul#tabs{margin-bottom:4px}ul#tabs a{padding-top:6px;padding-bottom:4px}ul.breadcrumb a:focus,ul.breadcrumb a:hover{text-decoration:none}ul.breadcrumb i.icon-home{font-size:16px;margin-right:4px}ul.breadcrumb span{color:#5e5e5e}.list_toolbar{padding:4px 0 4px 0;vertical-align:middle}.list_toolbar .tree-buttons{padding-top:1px}.dynamic-buttons{padding-top:3px;display:inline-block}.list_toolbar [class*=span]{min-height:24px}.list_header{font-weight:700;background-color:#EEE}.list_placeholder{font-weight:700;padding-top:4px;padding-bottom:4px;padding-left:7px;padding-right:7px}.list_container{margin-top:4px;margin-bottom:20px;border:1px solid #ddd;border-radius:2px}.list_container>div{border-bottom:1px solid #ddd}.list_container>div:hover .list-item{background-color:red}.list_container>div:last-child{border:none}.list_item:hover .list_item{background-color:#ddd}.list_item a{text-decoration:none}.list_item:hover{background-color:#fafafa}.list_header>div,.list_item>div{padding-top:4px;padding-bottom:4px;padding-left:7px;padding-right:7px;line-height:22px}.list_header>div input,.list_item>div input{margin-right:7px;margin-left:14px;vertical-align:baseline;line-height:22px;position:relative;top:-1px}.list_header>div .item_link,.list_item>div .item_link{margin-left:-1px;vertical-align:baseline;line-height:22px}.new-file input[type=checkbox]{visibility:hidden}.item_name{line-height:22px;height:24px}.item_icon{font-size:14px;color:#5e5e5e;margin-right:7px;margin-left:7px;line-height:22px;vertical-align:baseline}.item_buttons{line-height:1em;margin-left:-5px}.item_buttons .btn,.item_buttons .btn-group,.item_buttons .input-group{float:left}.item_buttons>.btn,.item_buttons>.btn-group,.item_buttons>.input-group{margin-left:5px}.item_buttons .btn{min-width:13ex}.item_buttons .running-indicator{padding-top:4px;color:#5cb85c}.item_buttons .kernel-name{padding-top:4px;color:#5bc0de;margin-right:7px;float:left}.toolbar_info{height:24px;line-height:24px}.list_item input:not([type=checkbox]){padding-top:3px;padding-bottom:3px;height:22px;line-height:14px;margin:0}.highlight_text{color:#00f}#project_name{display:inline-block;padding-left:7px;margin-left:-2px}#project_name>.breadcrumb{padding:0;margin-bottom:0;background-color:transparent;font-weight:700}#tree-selector{padding-right:0}#button-select-all{min-width:50px}#select-all{margin-left:7px;margin-right:2px}.menu_icon{margin-right:2px}.tab-content .row{margin-left:0;margin-right:0}.folder_icon:before{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:"\f114"}.folder_icon:before.pull-left{margin-right:.3em}.folder_icon:before.pull-right{margin-left:.3em}.notebook_icon:before{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:"\f02d";position:relative;top:-1px}.notebook_icon:before.pull-left{margin-right:.3em}.notebook_icon:before.pull-right{margin-left:.3em}.running_notebook_icon:before{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:"\f02d";position:relative;top:-1px;color:#5cb85c}.running_notebook_icon:before.pull-left{margin-right:.3em}.running_notebook_icon:before.pull-right{margin-left:.3em}.file_icon:before{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:"\f016";position:relative;top:-2px}.file_icon:before.pull-left{margin-right:.3em}.file_icon:before.pull-right{margin-left:.3em}#notebook_toolbar .pull-right{padding-top:0;margin-right:-1px}ul#new-menu{left:auto;right:0}.kernel-menu-icon{padding-right:12px;width:24px;content:"\f096"}.kernel-menu-icon:before{content:"\f096"}.kernel-menu-icon-current:before{content:"\f00c"}#tab_content{padding-top:20px}#running .panel-group .panel{margin-top:3px;margin-bottom:1em}#running .panel-group .panel .panel-heading{background-color:#EEE;padding-top:4px;padding-bottom:4px;padding-left:7px;padding-right:7px;line-height:22px}#running .panel-group .panel .panel-heading a:focus,#running .panel-group .panel .panel-heading a:hover{text-decoration:none}#running .panel-group .panel .panel-body{padding:0}#running .panel-group .panel .panel-body .list_container{margin-top:0;margin-bottom:0;border:0;border-radius:0}#running .panel-group .panel .panel-body .list_container .list_item{border-bottom:1px solid #ddd}#running .panel-group .panel .panel-body .list_container .list_item:last-child{border-bottom:0}.delete-button{display:none}.duplicate-button{display:none}.rename-button{display:none}.shutdown-button{display:none}.dynamic-instructions{display:inline-block;padding-top:4px}/*!
*
* IPython text editor webapp
*
*/.selected-keymap i.fa{padding:0 5px}.selected-keymap i.fa:before{content:"\f00c"}#mode-menu{overflow:auto;max-height:20em}.edit_app #header{-webkit-box-shadow:0 0 12px 1px rgba(87,87,87,.2);box-shadow:0 0 12px 1px rgba(87,87,87,.2)}.edit_app #menubar .navbar{margin-bottom:-1px}.dirty-indicator{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;width:20px}.dirty-indicator.pull-left{margin-right:.3em}.dirty-indicator.pull-right{margin-left:.3em}.dirty-indicator-dirty{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;width:20px}.dirty-indicator-dirty.pull-left{margin-right:.3em}.dirty-indicator-dirty.pull-right{margin-left:.3em}.dirty-indicator-clean{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;width:20px}.dirty-indicator-clean.pull-left{margin-right:.3em}.dirty-indicator-clean.pull-right{margin-left:.3em}.dirty-indicator-clean:before{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:"\f00c"}.dirty-indicator-clean:before.pull-left{margin-right:.3em}.dirty-indicator-clean:before.pull-right{margin-left:.3em}#filename{font-size:16pt;display:table;padding:0 5px}#current-mode{padding-left:5px;padding-right:5px}#texteditor-backdrop{padding-top:20px;padding-bottom:20px}@media not print{#texteditor-backdrop{background-color:#EEE}}@media print{#texteditor-backdrop #texteditor-container .CodeMirror-gutter,#texteditor-backdrop #texteditor-container .CodeMirror-gutters{background-color:#fff}}@media not print{#texteditor-backdrop #texteditor-container .CodeMirror-gutter,#texteditor-backdrop #texteditor-container .CodeMirror-gutters{background-color:#fff}}@media not print{#texteditor-backdrop #texteditor-container{padding:0;background-color:#fff;-webkit-box-shadow:0 0 12px 1px rgba(87,87,87,.2);box-shadow:0 0 12px 1px rgba(87,87,87,.2)}}/*!
*
* IPython notebook
*
*/.ansibold{font-weight:700}.ansiblack{color:#000}.ansired{color:#8b0000}.ansigreen{color:#006400}.ansiyellow{color:#c4a000}.ansiblue{color:#00008b}.ansipurple{color:#9400d3}.ansicyan{color:#4682b4}.ansigray{color:gray}.ansibgblack{background-color:#000}.ansibgred{background-color:red}.ansibggreen{background-color:green}.ansibgyellow{background-color:#ff0}.ansibgblue{background-color:#00f}.ansibgpurple{background-color:#ff00ff}.ansibgcyan{background-color:#0ff}.ansibggray{background-color:gray}div.cell{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;border-radius:2px;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;border-width:1px;border-style:solid;border-color:transparent;width:100%;padding:5px;margin:0;outline:0;border-left-width:1px;padding-left:5px;background:linear-gradient(to right,transparent -40px,transparent 1px,transparent 1px,transparent 100%)}div.cell.jupyter-soft-selected{border-left-color:#90CAF9;border-left-color:#E3F2FD;border-left-width:1px;padding-left:5px;border-right-color:#E3F2FD;border-right-width:1px;background:#E3F2FD}@media print{div.cell.jupyter-soft-selected{border-color:transparent}}div.cell.selected{border-color:#ababab;border-left-width:0;padding-left:6px;background:linear-gradient(to right,#42A5F5 -40px,#42A5F5 5px,transparent 5px,transparent 100%)}@media print{div.cell.selected{border-color:transparent}}div.cell.selected.jupyter-soft-selected{border-left-width:0;padding-left:6px;background:linear-gradient(to right,#42A5F5 -40px,#42A5F5 7px,#E3F2FD 7px,#E3F2FD 100%)}.edit_mode div.cell.selected{border-color:#66BB6A;border-left-width:0;padding-left:6px;background:linear-gradient(to right,#66BB6A -40px,#66BB6A 5px,transparent 5px,transparent 100%)}@media print{.edit_mode div.cell.selected{border-color:transparent}}.prompt{min-width:14ex;padding:.4em;margin:0;font-family:monospace;text-align:right;line-height:1.21429em;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}@media (max-width:540px){.prompt{text-align:left}}div.inner_cell{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}@-moz-document url-prefix(){div.inner_cell{overflow-x:hidden}}div.input_area{border:1px solid #cfcfcf;border-radius:2px;background:#f7f7f7;line-height:1.21429em}div.prompt:empty{padding-top:0;padding-bottom:0}div.unrecognized_cell{padding:5px 5px 5px 0;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}div.unrecognized_cell .inner_cell{border-radius:2px;padding:5px;font-weight:700;color:red;border:1px solid #cfcfcf;background:#eaeaea}div.unrecognized_cell .inner_cell a{color:inherit;text-decoration:none}div.unrecognized_cell .inner_cell a:hover{color:inherit;text-decoration:none}@media (max-width:540px){div.unrecognized_cell>div.prompt{display:none}}@media print{div.code_cell{page-break-inside:avoid}}div.input{page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}@media (max-width:540px){div.input{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}}div.input_prompt{color:#303F9F;border-top:1px solid transparent}div.input_area>div.highlight{margin:.4em;border:none;padding:0;background-color:transparent}div.input_area>div.highlight>pre{margin:0;border:none;padding:0;background-color:transparent}.CodeMirror{line-height:1.21429em;font-size:14px;height:auto;background:0 0}.CodeMirror-scroll{overflow-y:hidden;overflow-x:auto}.CodeMirror-lines{padding:.4em}.CodeMirror-linenumber{padding:0 8px 0 4px}.CodeMirror-gutters{border-bottom-left-radius:2px;border-top-left-radius:2px}.CodeMirror pre{padding:0;border:0;border-radius:0}.highlight-base{color:#000}.highlight-variable{color:#000}.highlight-variable-2{color:#1a1a1a}.highlight-variable-3{color:#333}.highlight-string{color:#BA2121}.highlight-comment{color:#408080;font-style:italic}.highlight-number{color:#080}.highlight-atom{color:#88F}.highlight-keyword{color:green;font-weight:700}.highlight-builtin{color:green}.highlight-error{color:red}.highlight-operator{color:#A2F;font-weight:700}.highlight-meta{color:#A2F}.highlight-def{color:#00f}.highlight-string-2{color:#f50}.highlight-qualifier{color:#555}.highlight-bracket{color:#997}.highlight-tag{color:#170}.highlight-attribute{color:#00c}.highlight-header{color:#00f}.highlight-quote{color:#090}.highlight-link{color:#00c}.cm-s-ipython span.cm-keyword{color:green;font-weight:700}.cm-s-ipython span.cm-atom{color:#88F}.cm-s-ipython span.cm-number{color:#080}.cm-s-ipython span.cm-def{color:#00f}.cm-s-ipython span.cm-variable{color:#000}.cm-s-ipython span.cm-operator{color:#A2F;font-weight:700}.cm-s-ipython span.cm-variable-2{color:#1a1a1a}.cm-s-ipython span.cm-variable-3{color:#333}.cm-s-ipython span.cm-comment{color:#408080;font-style:italic}.cm-s-ipython span.cm-string{color:#BA2121}.cm-s-ipython span.cm-string-2{color:#f50}.cm-s-ipython span.cm-meta{color:#A2F}.cm-s-ipython span.cm-qualifier{color:#555}.cm-s-ipython span.cm-builtin{color:green}.cm-s-ipython span.cm-bracket{color:#997}.cm-s-ipython span.cm-tag{color:#170}.cm-s-ipython span.cm-attribute{color:#00c}.cm-s-ipython span.cm-header{color:#00f}.cm-s-ipython span.cm-quote{color:#090}.cm-s-ipython span.cm-link{color:#00c}.cm-s-ipython span.cm-error{color:red}.cm-s-ipython span.cm-tab{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=);background-position:right;background-repeat:no-repeat}div.output_wrapper{position:relative;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;z-index:1}div.output_scroll{height:24em;width:100%;overflow:auto;border-radius:2px;-webkit-box-shadow:inset 0 2px 8px rgba(0,0,0,.8);box-shadow:inset 0 2px 8px rgba(0,0,0,.8);display:block}div.output_collapsed{margin:0;padding:0;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}div.out_prompt_overlay{height:100%;padding:0 .4em;position:absolute;border-radius:2px}div.out_prompt_overlay:hover{-webkit-box-shadow:inset 0 0 1px #000;box-shadow:inset 0 0 1px #000;background:rgba(240,240,240,.5)}div.output_prompt{color:#D84315}div.output_area{padding:0;page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}div.output_area .MathJax_Display{text-align:left!important}div.output_area .rendered_html table{margin-left:0;margin-right:0}div.output_area .rendered_html img{margin-left:0;margin-right:0}div.output_area img,div.output_area svg{max-width:100%;height:auto}div.output_area img.unconfined,div.output_area svg.unconfined{max-width:none}.output{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}@media (max-width:540px){div.output_area{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}}div.output_area pre{margin:0;padding:0;border:0;vertical-align:baseline;color:#000;background-color:transparent;border-radius:0}div.output_subarea{overflow-x:auto;padding:.4em;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1;max-width:calc(100% - 14ex)}div.output_scroll div.output_subarea{overflow-x:visible}div.output_text{text-align:left;color:#000;line-height:1.21429em}div.output_stderr{background:#fdd}div.output_latex{text-align:left}div.output_javascript:empty{padding:0}.js-error{color:#8b0000}div.raw_input_container{line-height:1.21429em;padding-top:5px}input.raw_input{font-family:monospace;font-size:inherit;color:inherit;width:auto;vertical-align:baseline;padding:0 .25em;margin:0 .25em}input.raw_input:focus{box-shadow:none}p.p-space{margin-bottom:10px}div.output_unrecognized{padding:5px;font-weight:700;color:red}div.output_unrecognized a{color:inherit;text-decoration:none}div.output_unrecognized a:hover{color:inherit;text-decoration:none}.rendered_html{color:#000}.rendered_html em{font-style:italic}.rendered_html strong{font-weight:700}.rendered_html u{text-decoration:underline}.rendered_html :link{text-decoration:underline}.rendered_html :visited{text-decoration:underline}.rendered_html h1{font-size:185.7%;margin:1.08em 0 0 0;font-weight:700;line-height:1}.rendered_html h2{font-size:157.1%;margin:1.27em 0 0 0;font-weight:700;line-height:1}.rendered_html h3{font-size:128.6%;margin:1.55em 0 0 0;font-weight:700;line-height:1}.rendered_html h4{font-size:100%;margin:2em 0 0 0;font-weight:700;line-height:1}.rendered_html h5{font-size:100%;margin:2em 0 0 0;font-weight:700;line-height:1;font-style:italic}.rendered_html h6{font-size:100%;margin:2em 0 0 0;font-weight:700;line-height:1;font-style:italic}.rendered_html h1:first-child{margin-top:.538em}.rendered_html h2:first-child{margin-top:.636em}.rendered_html h3:first-child{margin-top:.777em}.rendered_html h4:first-child{margin-top:1em}.rendered_html h5:first-child{margin-top:1em}.rendered_html h6:first-child{margin-top:1em}.rendered_html ul{list-style:disc;margin:0 2em;padding-left:0}.rendered_html ul ul{list-style:square;margin:0 2em}.rendered_html ul ul ul{list-style:circle;margin:0 2em}.rendered_html ol{list-style:decimal;margin:0 2em;padding-left:0}.rendered_html ol ol{list-style:upper-alpha;margin:0 2em}.rendered_html ol ol ol{list-style:lower-alpha;margin:0 2em}.rendered_html ol ol ol ol{list-style:lower-roman;margin:0 2em}.rendered_html ol ol ol ol ol{list-style:decimal;margin:0 2em}.rendered_html *+ul{margin-top:1em}.rendered_html *+ol{margin-top:1em}.rendered_html hr{color:#000;background-color:#000}.rendered_html pre{margin:1em 2em}.rendered_html code,.rendered_html pre{border:0;background-color:#fff;color:#000;font-size:100%;padding:0}.rendered_html blockquote{margin:1em 2em}.rendered_html table{margin-left:auto;margin-right:auto;border:1px solid #000;border-collapse:collapse}.rendered_html td,.rendered_html th,.rendered_html tr{border:1px solid #000;border-collapse:collapse;margin:1em 2em}.rendered_html td,.rendered_html th{text-align:left;vertical-align:middle;padding:4px}.rendered_html th{font-weight:700}.rendered_html *+table{margin-top:1em}.rendered_html p{text-align:left}.rendered_html *+p{margin-top:1em}.rendered_html img{display:block;margin-left:auto;margin-right:auto}.rendered_html *+img{margin-top:1em}.rendered_html img,.rendered_html svg{max-width:100%;height:auto}.rendered_html img.unconfined,.rendered_html svg.unconfined{max-width:none}div.text_cell{display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}@media (max-width:540px){div.text_cell>div.prompt{display:none}}div.text_cell_render{outline:0;resize:none;width:inherit;border-style:none;padding:.5em .5em .5em .4em;color:#000;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box}a.anchor-link:link{text-decoration:none;padding:0 20px;visibility:hidden}h1:hover .anchor-link,h2:hover .anchor-link,h3:hover .anchor-link,h4:hover .anchor-link,h5:hover .anchor-link,h6:hover .anchor-link{visibility:visible}.text_cell.rendered .input_area{display:none}.text_cell.rendered .rendered_html{overflow-x:auto;overflow-y:hidden}.text_cell.unrendered .text_cell_render{display:none}.cm-header-1,.cm-header-2,.cm-header-3,.cm-header-4,.cm-header-5,.cm-header-6{font-weight:700;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif}.cm-header-1{font-size:185.7%}.cm-header-2{font-size:157.1%}.cm-header-3{font-size:128.6%}.cm-header-4{font-size:110%}.cm-header-5{font-size:100%;font-style:italic}.cm-header-6{font-size:100%;font-style:italic}/*!
*
* IPython notebook webapp
*
*/@media (max-width:767px){.notebook_app{padding-left:0;padding-right:0}}#ipython-main-app{box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;height:100%}div#notebook_panel{margin:0;padding:0;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;height:100%}div#notebook{font-size:14px;line-height:20px;overflow-y:hidden;overflow-x:auto;width:100%;padding-top:20px;margin:0;outline:0;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;min-height:100%}@media not print{#notebook-container{padding:15px;background-color:#fff;min-height:0;-webkit-box-shadow:0 0 12px 1px rgba(87,87,87,.2);box-shadow:0 0 12px 1px rgba(87,87,87,.2)}}@media print{#notebook-container{width:100%}}div.ui-widget-content{border:1px solid #ababab;outline:0}pre.dialog{background-color:#f7f7f7;border:1px solid #ddd;border-radius:2px;padding:.4em;padding-left:2em}p.dialog{padding:.2em}code,kbd,pre,samp{white-space:pre-wrap}#fonttest{font-family:monospace}p{margin-bottom:0}.end_space{min-height:100px;transition:height .2s ease}.notebook_app>#header{-webkit-box-shadow:0 0 12px 1px rgba(87,87,87,.2);box-shadow:0 0 12px 1px rgba(87,87,87,.2)}@media not print{.notebook_app{background-color:#EEE}}kbd{border-style:solid;border-width:1px;box-shadow:none;margin:2px;padding-left:2px;padding-right:2px;padding-top:1px;padding-bottom:1px}.celltoolbar{border:thin solid #CFCFCF;border-bottom:none;background:#EEE;border-radius:2px 2px 0 0;width:100%;height:29px;padding-right:4px;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch;-webkit-box-pack:end;-moz-box-pack:end;box-pack:end;justify-content:flex-end;display:-webkit-flex}@media print{.celltoolbar{display:none}}.ctb_hideshow{display:none;vertical-align:bottom}.ctb_global_show .ctb_show.ctb_hideshow{display:block}.ctb_global_show .ctb_show+.input_area,.ctb_global_show .ctb_show+div.text_cell_input,.ctb_global_show .ctb_show~div.text_cell_render{border-top-right-radius:0;border-top-left-radius:0}.ctb_global_show .ctb_show~div.text_cell_render{border:1px solid #cfcfcf}.celltoolbar{font-size:87%;padding-top:3px}.celltoolbar select{display:block;width:100%;height:32px;padding:6px 12px;font-size:13px;line-height:1.42857143;color:#555;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:2px;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075);-webkit-transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;-o-transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;height:30px;padding:5px 10px;font-size:12px;line-height:1.5;border-radius:1px;width:inherit;font-size:inherit;height:22px;padding:0;display:inline-block}.celltoolbar select:focus{border-color:#66afe9;outline:0;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)}.celltoolbar select::-moz-placeholder{color:#999;opacity:1}.celltoolbar select:-ms-input-placeholder{color:#999}.celltoolbar select::-webkit-input-placeholder{color:#999}.celltoolbar select::-ms-expand{border:0;background-color:transparent}.celltoolbar select[disabled],.celltoolbar select[readonly],fieldset[disabled] .celltoolbar select{background-color:#eee;opacity:1}.celltoolbar select[disabled],fieldset[disabled] .celltoolbar select{cursor:not-allowed}textarea.celltoolbar select{height:auto}select.celltoolbar select{height:30px;line-height:30px}select[multiple].celltoolbar select,textarea.celltoolbar select{height:auto}.celltoolbar label{margin-left:5px;margin-right:5px}.completions{position:absolute;z-index:110;overflow:hidden;border:1px solid #ababab;border-radius:2px;-webkit-box-shadow:0 6px 10px -1px #adadad;box-shadow:0 6px 10px -1px #adadad;line-height:1}.completions select{background:#fff;outline:0;border:none;padding:0;margin:0;overflow:auto;font-family:monospace;font-size:110%;color:#000;width:auto}.completions select option.context{color:#286090}#kernel_logo_widget{float:right!important;float:right}#kernel_logo_widget .current_kernel_logo{display:none;margin-top:-1px;margin-bottom:-1px;width:32px;height:32px}#menubar{box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;margin-top:1px}#menubar .navbar{border-top:1px;border-radius:0 0 2px 2px;margin-bottom:0}#menubar .navbar-toggle{float:left;padding-top:7px;padding-bottom:7px;border:none}#menubar .navbar-collapse{clear:left}.nav-wrapper{border-bottom:1px solid #e7e7e7}i.menu-icon{padding-top:4px}ul#help_menu li a{overflow:hidden;padding-right:2.2em}ul#help_menu li a i{margin-right:-1.2em}.dropdown-submenu{position:relative}.dropdown-submenu>.dropdown-menu{top:0;left:100%;margin-top:-6px;margin-left:-1px}.dropdown-submenu:hover>.dropdown-menu{display:block}.dropdown-submenu>a:after{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:block;content:"\f0da";float:right;color:#333;margin-top:2px;margin-right:-10px}.dropdown-submenu>a:after.pull-left{margin-right:.3em}.dropdown-submenu>a:after.pull-right{margin-left:.3em}.dropdown-submenu:hover>a:after{color:#262626}.dropdown-submenu.pull-left{float:none}.dropdown-submenu.pull-left>.dropdown-menu{left:-100%;margin-left:10px}#notification_area{float:right!important;float:right;z-index:10}.indicator_area{float:right!important;float:right;color:#777;margin-left:5px;margin-right:5px;width:11px;z-index:10;text-align:center;width:auto}#kernel_indicator{float:right!important;float:right;color:#777;margin-left:5px;margin-right:5px;width:11px;z-index:10;text-align:center;width:auto;border-left:1px solid}#kernel_indicator .kernel_indicator_name{padding-left:5px;padding-right:5px}#modal_indicator{float:right!important;float:right;color:#777;margin-left:5px;margin-right:5px;width:11px;z-index:10;text-align:center;width:auto}#readonly-indicator{float:right!important;float:right;color:#777;margin-left:5px;margin-right:5px;width:11px;z-index:10;text-align:center;width:auto;margin-top:2px;margin-bottom:0;margin-left:0;margin-right:0;display:none}.modal_indicator:before{width:1.28571429em;text-align:center}.edit_mode .modal_indicator:before{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:"\f040"}.edit_mode .modal_indicator:before.pull-left{margin-right:.3em}.edit_mode .modal_indicator:before.pull-right{margin-left:.3em}.command_mode .modal_indicator:before{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:' '}.command_mode .modal_indicator:before.pull-left{margin-right:.3em}.command_mode .modal_indicator:before.pull-right{margin-left:.3em}.kernel_idle_icon:before{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:"\f10c"}.kernel_idle_icon:before.pull-left{margin-right:.3em}.kernel_idle_icon:before.pull-right{margin-left:.3em}.kernel_busy_icon:before{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:"\f111"}.kernel_busy_icon:before.pull-left{margin-right:.3em}.kernel_busy_icon:before.pull-right{margin-left:.3em}.kernel_dead_icon:before{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:"\f1e2"}.kernel_dead_icon:before.pull-left{margin-right:.3em}.kernel_dead_icon:before.pull-right{margin-left:.3em}.kernel_disconnected_icon:before{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:"\f127"}.kernel_disconnected_icon:before.pull-left{margin-right:.3em}.kernel_disconnected_icon:before.pull-right{margin-left:.3em}.notification_widget{color:#777;z-index:10;background:rgba(240,240,240,.5);margin-right:4px;color:#333;background-color:#fff;border-color:#ccc}.notification_widget.focus,.notification_widget:focus{color:#333;background-color:#e6e6e6;border-color:#8c8c8c}.notification_widget:hover{color:#333;background-color:#e6e6e6;border-color:#adadad}.notification_widget.active,.notification_widget:active,.open>.dropdown-toggle.notification_widget{color:#333;background-color:#e6e6e6;border-color:#adadad}.notification_widget.active.focus,.notification_widget.active:focus,.notification_widget.active:hover,.notification_widget:active.focus,.notification_widget:active:focus,.notification_widget:active:hover,.open>.dropdown-toggle.notification_widget.focus,.open>.dropdown-toggle.notification_widget:focus,.open>.dropdown-toggle.notification_widget:hover{color:#333;background-color:#d4d4d4;border-color:#8c8c8c}.notification_widget.active,.notification_widget:active,.open>.dropdown-toggle.notification_widget{background-image:none}.notification_widget.disabled.focus,.notification_widget.disabled:focus,.notification_widget.disabled:hover,.notification_widget[disabled].focus,.notification_widget[disabled]:focus,.notification_widget[disabled]:hover,fieldset[disabled] .notification_widget.focus,fieldset[disabled] .notification_widget:focus,fieldset[disabled] .notification_widget:hover{background-color:#fff;border-color:#ccc}.notification_widget .badge{color:#fff;background-color:#333}.notification_widget.warning{color:#fff;background-color:#f0ad4e;border-color:#eea236}.notification_widget.warning.focus,.notification_widget.warning:focus{color:#fff;background-color:#ec971f;border-color:#985f0d}.notification_widget.warning:hover{color:#fff;background-color:#ec971f;border-color:#d58512}.notification_widget.warning.active,.notification_widget.warning:active,.open>.dropdown-toggle.notification_widget.warning{color:#fff;background-color:#ec971f;border-color:#d58512}.notification_widget.warning.active.focus,.notification_widget.warning.active:focus,.notification_widget.warning.active:hover,.notification_widget.warning:active.focus,.notification_widget.warning:active:focus,.notification_widget.warning:active:hover,.open>.dropdown-toggle.notification_widget.warning.focus,.open>.dropdown-toggle.notification_widget.warning:focus,.open>.dropdown-toggle.notification_widget.warning:hover{color:#fff;background-color:#d58512;border-color:#985f0d}.notification_widget.warning.active,.notification_widget.warning:active,.open>.dropdown-toggle.notification_widget.warning{background-image:none}.notification_widget.warning.disabled.focus,.notification_widget.warning.disabled:focus,.notification_widget.warning.disabled:hover,.notification_widget.warning[disabled].focus,.notification_widget.warning[disabled]:focus,.notification_widget.warning[disabled]:hover,fieldset[disabled] .notification_widget.warning.focus,fieldset[disabled] .notification_widget.warning:focus,fieldset[disabled] .notification_widget.warning:hover{background-color:#f0ad4e;border-color:#eea236}.notification_widget.warning .badge{color:#f0ad4e;background-color:#fff}.notification_widget.success{color:#fff;background-color:#5cb85c;border-color:#4cae4c}.notification_widget.success.focus,.notification_widget.success:focus{color:#fff;background-color:#449d44;border-color:#255625}.notification_widget.success:hover{color:#fff;background-color:#449d44;border-color:#398439}.notification_widget.success.active,.notification_widget.success:active,.open>.dropdown-toggle.notification_widget.success{color:#fff;background-color:#449d44;border-color:#398439}.notification_widget.success.active.focus,.notification_widget.success.active:focus,.notification_widget.success.active:hover,.notification_widget.success:active.focus,.notification_widget.success:active:focus,.notification_widget.success:active:hover,.open>.dropdown-toggle.notification_widget.success.focus,.open>.dropdown-toggle.notification_widget.success:focus,.open>.dropdown-toggle.notification_widget.success:hover{color:#fff;background-color:#398439;border-color:#255625}.notification_widget.success.active,.notification_widget.success:active,.open>.dropdown-toggle.notification_widget.success{background-image:none}.notification_widget.success.disabled.focus,.notification_widget.success.disabled:focus,.notification_widget.success.disabled:hover,.notification_widget.success[disabled].focus,.notification_widget.success[disabled]:focus,.notification_widget.success[disabled]:hover,fieldset[disabled] .notification_widget.success.focus,fieldset[disabled] .notification_widget.success:focus,fieldset[disabled] .notification_widget.success:hover{background-color:#5cb85c;border-color:#4cae4c}.notification_widget.success .badge{color:#5cb85c;background-color:#fff}.notification_widget.info{color:#fff;background-color:#5bc0de;border-color:#46b8da}.notification_widget.info.focus,.notification_widget.info:focus{color:#fff;background-color:#31b0d5;border-color:#1b6d85}.notification_widget.info:hover{color:#fff;background-color:#31b0d5;border-color:#269abc}.notification_widget.info.active,.notification_widget.info:active,.open>.dropdown-toggle.notification_widget.info{color:#fff;background-color:#31b0d5;border-color:#269abc}.notification_widget.info.active.focus,.notification_widget.info.active:focus,.notification_widget.info.active:hover,.notification_widget.info:active.focus,.notification_widget.info:active:focus,.notification_widget.info:active:hover,.open>.dropdown-toggle.notification_widget.info.focus,.open>.dropdown-toggle.notification_widget.info:focus,.open>.dropdown-toggle.notification_widget.info:hover{color:#fff;background-color:#269abc;border-color:#1b6d85}.notification_widget.info.active,.notification_widget.info:active,.open>.dropdown-toggle.notification_widget.info{background-image:none}.notification_widget.info.disabled.focus,.notification_widget.info.disabled:focus,.notification_widget.info.disabled:hover,.notification_widget.info[disabled].focus,.notification_widget.info[disabled]:focus,.notification_widget.info[disabled]:hover,fieldset[disabled] .notification_widget.info.focus,fieldset[disabled] .notification_widget.info:focus,fieldset[disabled] .notification_widget.info:hover{background-color:#5bc0de;border-color:#46b8da}.notification_widget.info .badge{color:#5bc0de;background-color:#fff}.notification_widget.danger{color:#fff;background-color:#d9534f;border-color:#d43f3a}.notification_widget.danger.focus,.notification_widget.danger:focus{color:#fff;background-color:#c9302c;border-color:#761c19}.notification_widget.danger:hover{color:#fff;background-color:#c9302c;border-color:#ac2925}.notification_widget.danger.active,.notification_widget.danger:active,.open>.dropdown-toggle.notification_widget.danger{color:#fff;background-color:#c9302c;border-color:#ac2925}.notification_widget.danger.active.focus,.notification_widget.danger.active:focus,.notification_widget.danger.active:hover,.notification_widget.danger:active.focus,.notification_widget.danger:active:focus,.notification_widget.danger:active:hover,.open>.dropdown-toggle.notification_widget.danger.focus,.open>.dropdown-toggle.notification_widget.danger:focus,.open>.dropdown-toggle.notification_widget.danger:hover{color:#fff;background-color:#ac2925;border-color:#761c19}.notification_widget.danger.active,.notification_widget.danger:active,.open>.dropdown-toggle.notification_widget.danger{background-image:none}.notification_widget.danger.disabled.focus,.notification_widget.danger.disabled:focus,.notification_widget.danger.disabled:hover,.notification_widget.danger[disabled].focus,.notification_widget.danger[disabled]:focus,.notification_widget.danger[disabled]:hover,fieldset[disabled] .notification_widget.danger.focus,fieldset[disabled] .notification_widget.danger:focus,fieldset[disabled] .notification_widget.danger:hover{background-color:#d9534f;border-color:#d43f3a}.notification_widget.danger .badge{color:#d9534f;background-color:#fff}div#pager{background-color:#fff;font-size:14px;line-height:20px;overflow:hidden;display:none;position:fixed;bottom:0;width:100%;max-height:50%;padding-top:8px;-webkit-box-shadow:0 0 12px 1px rgba(87,87,87,.2);box-shadow:0 0 12px 1px rgba(87,87,87,.2);z-index:100;top:auto!important}div#pager pre{line-height:1.21429em;color:#000;background-color:#f7f7f7;padding:.4em}div#pager #pager-button-area{position:absolute;top:8px;right:20px}div#pager #pager-contents{position:relative;overflow:auto;width:100%;height:100%}div#pager #pager-contents #pager-container{position:relative;padding:15px 0;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box}div#pager .ui-resizable-handle{top:0;height:8px;background:#f7f7f7;border-top:1px solid #cfcfcf;border-bottom:1px solid #cfcfcf}div#pager .ui-resizable-handle::after{content:'';top:2px;left:50%;height:3px;width:30px;margin-left:-15px;position:absolute;border-top:1px solid #cfcfcf}.quickhelp{display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch;line-height:1.8em}.shortcut_key{display:inline-block;width:20ex;text-align:right;font-family:monospace}.shortcut_descr{display:inline-block;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}span.save_widget{margin-top:6px}span.save_widget span.filename{height:1em;line-height:1em;padding:3px;margin-left:16px;border:none;font-size:146.5%;border-radius:2px}span.save_widget span.filename:hover{background-color:#e6e6e6}span.autosave_status,span.checkpoint_status{font-size:small}@media (max-width:767px){span.save_widget{font-size:small}span.autosave_status,span.checkpoint_status{display:none}}@media (min-width:768px) and (max-width:991px){span.checkpoint_status{display:none}span.autosave_status{font-size:x-small}}.toolbar{padding:0;margin-left:-5px;margin-top:2px;margin-bottom:5px;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box}.toolbar label,.toolbar select{width:auto;vertical-align:middle;margin-right:2px;margin-bottom:0;display:inline;font-size:92%;margin-left:.3em;margin-right:.3em;padding:0;padding-top:3px}.toolbar .btn{padding:2px 8px}.toolbar .btn-group{margin-top:0;margin-left:5px}#maintoolbar{margin-bottom:-3px;margin-top:-8px;border:0;min-height:27px;margin-left:0;padding-top:11px;padding-bottom:3px}#maintoolbar .navbar-text{float:none;vertical-align:middle;text-align:right;margin-left:5px;margin-right:0;margin-top:0}.select-xs{height:24px}.dropdown-menu>li>a.pulse,.pulse,li.pulse.open>a.dropdown-toggle,li.pulse>a.dropdown-toggle{background-color:#F37626;color:#fff}@-moz-keyframes fadeOut{from{opacity:1}to{opacity:0}}@-webkit-keyframes fadeOut{from{opacity:1}to{opacity:0}}@-moz-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-webkit-keyframes fadeIn{from{opacity:0}to{opacity:1}}.bigtooltip{overflow:auto;height:200px;-webkit-transition-property:height;-webkit-transition-duration:.5s;-moz-transition-property:height;-moz-transition-duration:.5s;transition-property:height;transition-duration:.5s}.smalltooltip{-webkit-transition-property:height;-webkit-transition-duration:.5s;-moz-transition-property:height;-moz-transition-duration:.5s;transition-property:height;transition-duration:.5s;text-overflow:ellipsis;overflow:hidden;height:80px}.tooltipbuttons{position:absolute;padding-right:15px;top:0;right:0}.tooltiptext{padding-right:30px}.ipython_tooltip{max-width:700px;-webkit-animation:fadeOut .4s;-moz-animation:fadeOut .4s;animation:fadeOut .4s;-webkit-animation:fadeIn .4s;-moz-animation:fadeIn .4s;animation:fadeIn .4s;vertical-align:middle;background-color:#f7f7f7;overflow:visible;border:#ababab 1px solid;outline:0;padding:3px;margin:0;padding-left:7px;font-family:monospace;min-height:50px;-moz-box-shadow:0 6px 10px -1px #adadad;-webkit-box-shadow:0 6px 10px -1px #adadad;box-shadow:0 6px 10px -1px #adadad;border-radius:2px;position:absolute;z-index:1000}.ipython_tooltip a{float:right}.ipython_tooltip .tooltiptext pre{border:0;border-radius:0;font-size:100%;background-color:#f7f7f7}.pretooltiparrow{left:0;margin:0;top:-16px;width:40px;height:16px;overflow:hidden;position:absolute}.pretooltiparrow:before{background-color:#f7f7f7;border:1px #ababab solid;z-index:11;content:"";position:absolute;left:15px;top:10px;width:25px;height:25px;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-o-transform:rotate(45deg)}ul.typeahead-list i{margin-left:-10px;width:18px}ul.typeahead-list{max-height:80vh;overflow:auto}ul.typeahead-list>li>a{white-space:normal}.cmd-palette .modal-body{padding:7px}.cmd-palette form{background:#fff}.cmd-palette input{outline:0}.no-shortcut{display:none}.command-shortcut:before{content:"(command)";padding-right:3px;color:#777}.edit-shortcut:before{content:"(edit)";padding-right:3px;color:#777}#find-and-replace #replace-preview .insert,#find-and-replace #replace-preview .match{background-color:#BBDEFB;border-color:#90CAF9;border-style:solid;border-width:1px;border-radius:0}#find-and-replace #replace-preview .replace .match{background-color:#FFCDD2;border-color:#EF9A9A;border-radius:0}#find-and-replace #replace-preview .replace .insert{background-color:#C8E6C9;border-color:#A5D6A7;border-radius:0}#find-and-replace #replace-preview{max-height:60vh;overflow:auto}#find-and-replace #replace-preview pre{padding:5px 10px}.terminal-app{background:#EEE}.terminal-app #header{background:#fff;-webkit-box-shadow:0 0 12px 1px rgba(87,87,87,.2);box-shadow:0 0 12px 1px rgba(87,87,87,.2)}.terminal-app .terminal{float:left;font-family:monospace;color:#fff;background:#000;padding:.4em;border-radius:2px;-webkit-box-shadow:0 0 12px 1px rgba(87,87,87,.4);box-shadow:0 0 12px 1px rgba(87,87,87,.4)}.terminal-app .terminal,.terminal-app .terminal dummy-screen{line-height:1em;font-size:14px}.terminal-app .terminal-cursor{color:#000;background:#fff}.terminal-app #terminado-container{margin-top:20px}</style><style type="text/css">.highlight .hll{background-color:#ffc}.highlight{background:#f8f8f8}.highlight .c{color:#408080;font-style:italic}.highlight .err{border:1px solid red}.highlight .k{color:green;font-weight:700}.highlight .o{color:#666}.highlight .ch{color:#408080;font-style:italic}.highlight .cm{color:#408080;font-style:italic}.highlight .cp{color:#BC7A00}.highlight .cpf{color:#408080;font-style:italic}.highlight .c1{color:#408080;font-style:italic}.highlight .cs{color:#408080;font-style:italic}.highlight .gd{color:#A00000}.highlight .ge{font-style:italic}.highlight .gr{color:red}.highlight .gh{color:navy;font-weight:700}.highlight .gi{color:#00A000}.highlight .go{color:#888}.highlight .gp{color:navy;font-weight:700}.highlight .gs{font-weight:700}.highlight .gu{color:purple;font-weight:700}.highlight .gt{color:#04D}.highlight .kc{color:green;font-weight:700}.highlight .kd{color:green;font-weight:700}.highlight .kn{color:green;font-weight:700}.highlight .kp{color:green}.highlight .kr{color:green;font-weight:700}.highlight .kt{color:#B00040}.highlight .m{color:#666}.highlight .s{color:#BA2121}.highlight .na{color:#7D9029}.highlight .nb{color:green}.highlight .nc{color:#00F;font-weight:700}.highlight .no{color:#800}.highlight .nd{color:#A2F}.highlight .ni{color:#999;font-weight:700}.highlight .ne{color:#D2413A;font-weight:700}.highlight .nf{color:#00F}.highlight .nl{color:#A0A000}.highlight .nn{color:#00F;font-weight:700}.highlight .nt{color:green;font-weight:700}.highlight .nv{color:#19177C}.highlight .ow{color:#A2F;font-weight:700}.highlight .w{color:#bbb}.highlight .mb{color:#666}.highlight .mf{color:#666}.highlight .mh{color:#666}.highlight .mi{color:#666}.highlight .mo{color:#666}.highlight .sb{color:#BA2121}.highlight .sc{color:#BA2121}.highlight .sd{color:#BA2121;font-style:italic}.highlight .s2{color:#BA2121}.highlight .se{color:#B62;font-weight:700}.highlight .sh{color:#BA2121}.highlight .si{color:#B68;font-weight:700}.highlight .sx{color:green}.highlight .sr{color:#B68}.highlight .s1{color:#BA2121}.highlight .ss{color:#19177C}.highlight .bp{color:green}.highlight .vc{color:#19177C}.highlight .vg{color:#19177C}.highlight .vi{color:#19177C}.highlight .il{color:#666}</style><style type="text/css">.ansi-black-fg{color:#3E424D}.ansi-black-bg{background-color:#3E424D}.ansi-black-intense-fg{color:#282C36}.ansi-black-intense-bg{background-color:#282C36}.ansi-red-fg{color:#E75C58}.ansi-red-bg{background-color:#E75C58}.ansi-red-intense-fg{color:#B22B31}.ansi-red-intense-bg{background-color:#B22B31}.ansi-green-fg{color:#00A250}.ansi-green-bg{background-color:#00A250}.ansi-green-intense-fg{color:#007427}.ansi-green-intense-bg{background-color:#007427}.ansi-yellow-fg{color:#DDB62B}.ansi-yellow-bg{background-color:#DDB62B}.ansi-yellow-intense-fg{color:#B27D12}.ansi-yellow-intense-bg{background-color:#B27D12}.ansi-blue-fg{color:#208FFB}.ansi-blue-bg{background-color:#208FFB}.ansi-blue-intense-fg{color:#0065CA}.ansi-blue-intense-bg{background-color:#0065CA}.ansi-magenta-fg{color:#D160C4}.ansi-magenta-bg{background-color:#D160C4}.ansi-magenta-intense-fg{color:#A03196}.ansi-magenta-intense-bg{background-color:#A03196}.ansi-cyan-fg{color:#60C6C8}.ansi-cyan-bg{background-color:#60C6C8}.ansi-cyan-intense-fg{color:#258F8F}.ansi-cyan-intense-bg{background-color:#258F8F}.ansi-white-fg{color:#C5C1B4}.ansi-white-bg{background-color:#C5C1B4}.ansi-white-intense-fg{color:#A1A6B2}.ansi-white-intense-bg{background-color:#A1A6B2}.ansi-bold{font-weight:700}</style><style type="text/css">body{overflow:visible;padding:8px}div#notebook{overflow:visible;border-top:none}@media print{div.cell{display:block;page-break-inside:avoid}div.output_wrapper{display:block;page-break-inside:avoid}div.output{display:block;page-break-inside:avoid}}</style><link rel="stylesheet" href="custom.css"><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });</script><!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body><div tabindex="-1" id="notebook" class="border-box-sizing"><div class="container" id="notebook-container"><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h1 id="&#25968;&#25454;&#32858;&#21512;&#19982;&#20998;&#32452;&#36816;&#31639;">&#25968;&#25454;&#32858;&#21512;&#19982;&#20998;&#32452;&#36816;&#31639;<a class="anchor-link" href="#&#25968;&#25454;&#32858;&#21512;&#19982;&#20998;&#32452;&#36816;&#31639;">&#182;</a></h1></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[236]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">randn</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">Series</span><span class="p">,</span> <span class="n">DataFrame</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[237]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">notebook_repr_html</span> <span class="o">=</span> <span class="bp">False</span>
<span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[238]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h2 id="GroupBy-&#26426;&#21046;">GroupBy &#26426;&#21046;<a class="anchor-link" href="#GroupBy-&#26426;&#21046;">&#182;</a></h2></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[239]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;key1&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">],</span>
                <span class="s1">&#39;key2&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">],</span>
                <span class="s1">&#39;data1&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
                <span class="s1">&#39;data2&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">)})</span>
<span class="n">df</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[239]:</div><div class="output_text output_subarea output_execute_result"><pre>      data1     data2 key1 key2
0 -0.204708  1.393406    a  one
1  0.478943  0.092908    a  two
2 -0.519439  0.281746    b  one
3 -0.555730  0.769023    b  two
4  1.965781  1.246435    a  one</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[240]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;data1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">])</span>
<span class="n">grouped</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[240]:</div><div class="output_text output_subarea output_execute_result"><pre>&lt;pandas.core.groupby.SeriesGroupBy object at 0x0000000008BAFA90&gt;</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>变量<code>groupby</code>是一个<code>GroupBy</code>对象。它实际还没有进行任何计算，只有进行计算之后才能显示结果</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[241]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">grouped</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[241]:</div><div class="output_text output_subarea output_execute_result"><pre>key1
a    0.746672
b   -0.537585
Name: data1, dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[242]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">means</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;data1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;key2&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">means</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[242]:</div><div class="output_text output_subarea output_execute_result"><pre>key1  key2
a     one     0.880536
      two     0.478943
b     one    -0.519439
      two    -0.555730
Name: data1, dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[243]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">means</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[243]:</div><div class="output_text output_subarea output_execute_result"><pre>key2       one       two
key1                    
a     0.880536  0.478943
b    -0.519439 -0.555730</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>只要长度相同即可</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[244]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;California&#39;</span><span class="p">,</span> <span class="s1">&#39;California&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;Ohio&#39;</span><span class="p">])</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">2005</span><span class="p">,</span> <span class="mi">2006</span><span class="p">,</span> <span class="mi">2005</span><span class="p">,</span> <span class="mi">2006</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;data1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">states</span><span class="p">,</span> <span class="n">years</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[244]:</div><div class="output_text output_subarea output_execute_result"><pre>California  2005    0.478943
            2006   -0.519439
Ohio        2005   -0.380219
            2006    1.965781
Name: data1, dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>只要数值型数据才会出现在结果中</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[245]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;key1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[245]:</div><div class="output_text output_subarea output_execute_result"><pre>         data1     data2
key1                    
a     0.746672  0.910916
b    -0.537585  0.525384</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[246]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[246]:</div><div class="output_text output_subarea output_execute_result"><pre>              data1     data2
key1 key2                    
a    one   0.880536  1.319920
     two   0.478943  0.092908
b    one  -0.519439  0.281746
     two  -0.555730  0.769023</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[247]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[247]:</div><div class="output_text output_subarea output_execute_result"><pre>key1  key2
a     one     2
      two     1
b     one     1
      two     1
dtype: int64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="&#23545;&#20998;&#32452;&#36827;&#34892;&#36845;&#20195;">&#23545;&#20998;&#32452;&#36827;&#34892;&#36845;&#20195;<a class="anchor-link" href="#&#23545;&#20998;&#32452;&#36827;&#34892;&#36845;&#20195;">&#182;</a></h3></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>显示分组数据（要通过这种迭代的方式才能显示）</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[248]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;key1&#39;</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[248]:</div><div class="output_text output_subarea output_execute_result"><pre>&lt;pandas.core.groupby.DataFrameGroupBy object at 0x0000000034BC8CF8&gt;</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[249]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">df</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;key1&#39;</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[249]:</div><div class="output_text output_subarea output_execute_result"><pre>      data1     data2 key1 key2
0 -0.204708  1.393406    a  one
1  0.478943  0.092908    a  two
2 -0.519439  0.281746    b  one
3 -0.555730  0.769023    b  two
4  1.965781  1.246435    a  one</pre></div></div><div class="output_area"><div class="prompt"></div><div class="output_subarea output_stream output_stdout output_text"><pre>a
      data1     data2 key1 key2
0 -0.204708  1.393406    a  one
1  0.478943  0.092908    a  two
4  1.965781  1.246435    a  one
b
      data1     data2 key1 key2
2 -0.519439  0.281746    b  one
3 -0.555730  0.769023    b  two
</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>同样进行迭代才能显示结果</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[250]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="k">for</span> <span class="p">(</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">),</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">((</span><span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt"></div><div class="output_subarea output_stream output_stdout output_text"><pre>(&#39;a&#39;, &#39;one&#39;)
      data1     data2 key1 key2
0 -0.204708  1.393406    a  one
4  1.965781  1.246435    a  one
(&#39;a&#39;, &#39;two&#39;)
      data1     data2 key1 key2
1  0.478943  0.092908    a  two
(&#39;b&#39;, &#39;one&#39;)
      data1     data2 key1 key2
2 -0.519439  0.281746    b  one
(&#39;b&#39;, &#39;two&#39;)
     data1     data2 key1 key2
3 -0.55573  0.769023    b  two
</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>将分组结果转化成一个字典（要先转化为一个列表）</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[251]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">pieces</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;key1&#39;</span><span class="p">)))</span>
<span class="n">pieces</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[251]:</div><div class="output_text output_subarea output_execute_result"><pre>      data1     data2 key1 key2
2 -0.519439  0.281746    b  one
3 -0.555730  0.769023    b  two</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>显示每一项的数据类型</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[252]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[252]:</div><div class="output_text output_subarea output_execute_result"><pre>data1    float64
data2    float64
key1      object
key2      object
dtype: object</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>对列进行分组...按照数据类型来？！</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[253]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">dict</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">grouped</span><span class="p">))</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[253]:</div><div class="output_text output_subarea output_execute_result"><pre>{dtype(&#39;float64&#39;):       data1     data2
 0 -0.204708  1.393406
 1  0.478943  0.092908
 2 -0.519439  0.281746
 3 -0.555730  0.769023
 4  1.965781  1.246435, dtype(&#39;O&#39;):   key1 key2
 0    a  one
 1    a  two
 2    b  one
 3    b  two
 4    a  one}</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="&#36873;&#25321;&#19968;&#21015;&#25110;&#19968;&#32452;&#21015;">&#36873;&#25321;&#19968;&#21015;&#25110;&#19968;&#32452;&#21015;<a class="anchor-link" href="#&#36873;&#25321;&#19968;&#21015;&#25110;&#19968;&#32452;&#21015;">&#182;</a></h3></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[254]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;key1&#39;</span><span class="p">)[</span><span class="s1">&#39;data1&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;key1&#39;</span><span class="p">)[[</span><span class="s1">&#39;data2&#39;</span><span class="p">]]</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[254]:</div><div class="output_text output_subarea output_execute_result"><pre>&lt;pandas.core.groupby.SeriesGroupBy object at 0x0000000034BDC2E8&gt;</pre></div></div><div class="output_area"><div class="prompt output_prompt">Out[254]:</div><div class="output_text output_subarea output_execute_result"><pre>&lt;pandas.core.groupby.DataFrameGroupBy object at 0x0000000015EDF2B0&gt;</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>上述代码是以下代码的语法糖</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[255]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;data1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[[</span><span class="s1">&#39;data2&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">])</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[255]:</div><div class="output_text output_subarea output_execute_result"><pre>&lt;pandas.core.groupby.SeriesGroupBy object at 0x0000000034BDC8D0&gt;</pre></div></div><div class="output_area"><div class="prompt output_prompt">Out[255]:</div><div class="output_text output_subarea output_execute_result"><pre>&lt;pandas.core.groupby.DataFrameGroupBy object at 0x0000000034BDC898&gt;</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[256]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">])[[</span><span class="s1">&#39;data2&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[256]:</div><div class="output_text output_subarea output_execute_result"><pre>              data2
key1 key2          
a    one   1.319920
     two   0.092908
b    one   0.281746
     two   0.769023</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[257]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">s_grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">])[</span><span class="s1">&#39;data2&#39;</span><span class="p">]</span>
<span class="n">s_grouped</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[257]:</div><div class="output_text output_subarea output_execute_result"><pre>&lt;pandas.core.groupby.SeriesGroupBy object at 0x0000000034BDC6A0&gt;</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[258]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">s_grouped</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[258]:</div><div class="output_text output_subarea output_execute_result"><pre>key1  key2
a     one     1.319920
      two     0.092908
b     one     0.281746
      two     0.769023
Name: data2, dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="&#36890;&#36807;&#23383;&#20856;&#25110;Series&#36827;&#34892;&#20998;&#32452;">&#36890;&#36807;&#23383;&#20856;&#25110;Series&#36827;&#34892;&#20998;&#32452;<a class="anchor-link" href="#&#36890;&#36807;&#23383;&#20856;&#25110;Series&#36827;&#34892;&#20998;&#32452;">&#182;</a></h3></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[259]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">people</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                   <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">],</span>
                   <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Joe&#39;</span><span class="p">,</span> <span class="s1">&#39;Steve&#39;</span><span class="p">,</span> <span class="s1">&#39;Wes&#39;</span><span class="p">,</span> <span class="s1">&#39;Jim&#39;</span><span class="p">,</span> <span class="s1">&#39;Travis&#39;</span><span class="p">])</span>
<span class="n">people</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c1"># Add a few NA values</span>
<span class="n">people</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[259]:</div><div class="output_text output_subarea output_execute_result"><pre>               a         b         c         d         e
Joe     1.007189 -1.296221  0.274992  0.228913  1.352917
Steve   0.886429 -2.001637 -0.371843  1.669025 -0.438570
Wes    -0.539741       NaN       NaN -1.021228 -0.577087
Jim     0.124121  0.302614  0.523772  0.000940  1.343810
Travis -0.713544 -0.831154 -2.370232 -1.860761 -0.860757</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[260]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span>
           <span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span> <span class="p">:</span> <span class="s1">&#39;orange&#39;</span><span class="p">}</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>会跳过NA值</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[261]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">by_column</span> <span class="o">=</span> <span class="n">people</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">by_column</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[261]:</div><div class="output_text output_subarea output_execute_result"><pre>            blue       red
Joe     0.503905  1.063885
Steve   1.297183 -1.553778
Wes    -1.021228 -1.116829
Jim     0.524712  1.770545
Travis -4.230992 -2.405455</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>上述功能同样可以通过Series实现</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[262]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">map_series</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
<span class="n">map_series</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[262]:</div><div class="output_text output_subarea output_execute_result"><pre>a       red
b       red
c      blue
d      blue
e       red
f    orange
dtype: object</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[263]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">people</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">map_series</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[263]:</div><div class="output_text output_subarea output_execute_result"><pre>        blue  red
Joe        2    3
Steve      2    3
Wes        1    2
Jim        2    3
Travis     2    3</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="&#36890;&#36807;&#20989;&#25968;&#36827;&#34892;&#20998;&#32452;">&#36890;&#36807;&#20989;&#25968;&#36827;&#34892;&#20998;&#32452;<a class="anchor-link" href="#&#36890;&#36807;&#20989;&#25968;&#36827;&#34892;&#20998;&#32452;">&#182;</a></h3></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>根据人名长度进行分组</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[264]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">people</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[264]:</div><div class="output_text output_subarea output_execute_result"><pre>          a         b         c         d         e
3  0.591569 -0.993608  0.798764 -0.791374  2.119639
5  0.886429 -2.001637 -0.371843  1.669025 -0.438570
6 -0.713544 -0.831154 -2.370232 -1.860761 -0.860757</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>再加一个分组度量</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[265]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">key_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">]</span>
<span class="n">people</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="nb">len</span><span class="p">,</span> <span class="n">key_list</span><span class="p">])</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[265]:</div><div class="output_text output_subarea output_execute_result"><pre>              a         b         c         d         e
3 one -0.539741 -1.296221  0.274992 -1.021228 -0.577087
  two  0.124121  0.302614  0.523772  0.000940  1.343810
5 one  0.886429 -2.001637 -0.371843  1.669025 -0.438570
6 two -0.713544 -0.831154 -2.370232 -1.860761 -0.860757</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="&#26681;&#25454;&#32034;&#24341;&#32423;&#21035;&#20998;&#32452;">&#26681;&#25454;&#32034;&#24341;&#32423;&#21035;&#20998;&#32452;<a class="anchor-link" href="#&#26681;&#25454;&#32034;&#24341;&#32423;&#21035;&#20998;&#32452;">&#182;</a></h3></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[266]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">([[</span><span class="s1">&#39;US&#39;</span><span class="p">,</span> <span class="s1">&#39;US&#39;</span><span class="p">,</span> <span class="s1">&#39;US&#39;</span><span class="p">,</span> <span class="s1">&#39;JP&#39;</span><span class="p">,</span> <span class="s1">&#39;JP&#39;</span><span class="p">],</span>
                                    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cty&#39;</span><span class="p">,</span> <span class="s1">&#39;tenor&#39;</span><span class="p">])</span>
<span class="n">hier_df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">hier_df</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[266]:</div><div class="output_text output_subarea output_execute_result"><pre>cty          US                            JP          
tenor         1         3         5         1         3
0      0.560145 -1.265934  0.119827 -1.063512  0.332883
1     -2.359419 -0.199543 -1.541996 -0.970736 -1.307030
2      0.286350  0.377984 -0.753887  0.331286  1.349742
3      0.069877  0.246674 -0.011862  1.004812  1.327195</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[267]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">hier_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;cty&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[267]:</div><div class="output_text output_subarea output_execute_result"><pre>cty  JP  US
0     2   3
1     2   3
2     2   3
3     2   3</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h2 id="&#25968;&#25454;&#32858;&#21512;">&#25968;&#25454;&#32858;&#21512;<a class="anchor-link" href="#&#25968;&#25454;&#32858;&#21512;">&#182;</a></h2></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[268]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">df</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[268]:</div><div class="output_text output_subarea output_execute_result"><pre>      data1     data2 key1 key2
0 -0.204708  1.393406    a  one
1  0.478943  0.092908    a  two
2 -0.519439  0.281746    b  one
3 -0.555730  0.769023    b  two
4  1.965781  1.246435    a  one</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>对分组后的数据进行相应操作</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[269]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;key1&#39;</span><span class="p">)</span>
<span class="n">grouped</span><span class="p">[</span><span class="s1">&#39;data1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[269]:</div><div class="output_text output_subarea output_execute_result"><pre>key1
a    1.668413
b   -0.523068
Name: data1, dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>通过函数进行聚合操作</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[270]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">peak_to_peak</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">arr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">arr</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">grouped</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">peak_to_peak</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[270]:</div><div class="output_text output_subarea output_execute_result"><pre>         data1     data2
key1                    
a     2.170488  1.300498
b     0.036292  0.487276</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>列出分组后数据的一些常用属性</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[271]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">grouped</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[271]:</div><div class="output_text output_subarea output_execute_result"><pre>               data1     data2
key1                          
a    count  3.000000  3.000000
     mean   0.746672  0.910916
     std    1.109736  0.712217
     min   -0.204708  0.092908
     25%    0.137118  0.669671
     50%    0.478943  1.246435
     75%    1.222362  1.319920
     max    1.965781  1.393406
b    count  2.000000  2.000000
     mean  -0.537585  0.525384
     std    0.025662  0.344556
     min   -0.555730  0.281746
     25%   -0.546657  0.403565
     50%   -0.537585  0.525384
     75%   -0.528512  0.647203
     max   -0.519439  0.769023</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>导入一个数据集用于接下来更加高级的聚合操作</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[272]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">tips</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;ch08/tips.csv&#39;</span><span class="p">)</span>
<span class="c1"># Add tip percentage of total bill</span>
<span class="n">tips</span><span class="p">[</span><span class="s1">&#39;tip_pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tips</span><span class="p">[</span><span class="s1">&#39;tip&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">tips</span><span class="p">[</span><span class="s1">&#39;total_bill&#39;</span><span class="p">]</span>
<span class="n">tips</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[272]:</div><div class="output_text output_subarea output_execute_result"><pre>   total_bill   tip     sex smoker  day    time  size_   tip_pct
0       16.99  1.01  Female     No  Sun  Dinner      2  0.059447
1       10.34  1.66    Male     No  Sun  Dinner      3  0.160542
2       21.01  3.50    Male     No  Sun  Dinner      3  0.166587
3       23.68  3.31    Male     No  Sun  Dinner      2  0.139780
4       24.59  3.61  Female     No  Sun  Dinner      4  0.146808
5       25.29  4.71    Male     No  Sun  Dinner      4  0.186240</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="&#38754;&#21521;&#21015;&#30340;&#22810;&#20989;&#25968;&#24212;&#29992;">&#38754;&#21521;&#21015;&#30340;&#22810;&#20989;&#25968;&#24212;&#29992;<a class="anchor-link" href="#&#38754;&#21521;&#21015;&#30340;&#22810;&#20989;&#25968;&#24212;&#29992;">&#182;</a></h3></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>根据性别以及是否吸烟进行分类</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[273]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;smoker&#39;</span><span class="p">])</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>算出不同类型的顾客所给的小费占总花费的比例的平均值</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[274]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">grouped_pct</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="s1">&#39;tip_pct&#39;</span><span class="p">]</span>
<span class="n">grouped_pct</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[274]:</div><div class="output_text output_subarea output_execute_result"><pre>sex     smoker
Female  No        0.156921
        Yes       0.182150
Male    No        0.160669
        Yes       0.152771
Name: tip_pct, dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>同时算出比例的均值、标准差以及范围大小</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[275]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">grouped_pct</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="n">peak_to_peak</span><span class="p">])</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[275]:</div><div class="output_text output_subarea output_execute_result"><pre>                   mean       std  peak_to_peak
sex    smoker                                  
Female No      0.156921  0.036421      0.195876
       Yes     0.182150  0.071595      0.360233
Male   No      0.160669  0.041849      0.220186
       Yes     0.152771  0.090588      0.674707</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>起一个别名</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[276]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">grouped_pct</span><span class="o">.</span><span class="n">agg</span><span class="p">([(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">)])</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[276]:</div><div class="output_text output_subarea output_execute_result"><pre>                    foo       bar
sex    smoker                    
Female No      0.156921  0.036421
       Yes     0.182150  0.071595
Male   No      0.160669  0.041849
       Yes     0.152771  0.090588</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>对分组后的数据的两个属性分别做三个不同的操作</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[277]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">functions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">]</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">grouped</span><span class="p">[</span><span class="s1">&#39;tip_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;total_bill&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">functions</span><span class="p">)</span>
<span class="n">result</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[277]:</div><div class="output_text output_subarea output_execute_result"><pre>              tip_pct                     total_bill                  
                count      mean       max      count       mean    max
sex    smoker                                                         
Female No          54  0.156921  0.252672         54  18.105185  35.83
       Yes         33  0.182150  0.416667         33  17.977879  44.30
Male   No          97  0.160669  0.291990         97  19.791237  48.33
       Yes         60  0.152771  0.710345         60  22.284500  50.81</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>提取出上述两个属性中的一个</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[278]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;tip_pct&#39;</span><span class="p">]</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[278]:</div><div class="output_text output_subarea output_execute_result"><pre>               count      mean       max
sex    smoker                           
Female No         54  0.156921  0.252672
       Yes        33  0.182150  0.416667
Male   No         97  0.160669  0.291990
       Yes        60  0.152771  0.710345</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>对多个属性进行多个操作的同时进行起别名的操作</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[279]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">ftuples</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Durchschnitt&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Abweichung&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">)]</span>
<span class="n">grouped</span><span class="p">[</span><span class="s1">&#39;tip_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;total_bill&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">ftuples</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[279]:</div><div class="output_text output_subarea output_execute_result"><pre>                   tip_pct              total_bill           
              Durchschnitt Abweichung Durchschnitt Abweichung
sex    smoker                                                
Female No         0.156921   0.001327    18.105185  53.092422
       Yes        0.182150   0.005126    17.977879  84.451517
Male   No         0.160669   0.001751    19.791237  76.152961
       Yes        0.152771   0.008206    22.284500  98.244673</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>对不同的列进行不同的操作</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[280]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">grouped</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;tip&#39;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="s1">&#39;size_&#39;</span> <span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[280]:</div><div class="output_text output_subarea output_execute_result"><pre>               size_   tip
sex    smoker             
Female No        140   5.2
       Yes        74   6.5
Male   No        263   9.0
       Yes       150  10.0</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>对不同的列进行数量不同类型不同的操作</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[281]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">grouped</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;tip_pct&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">],</span>
             <span class="s1">&#39;size_&#39;</span> <span class="p">:</span> <span class="s1">&#39;sum&#39;</span><span class="p">})</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[281]:</div><div class="output_text output_subarea output_execute_result"><pre>                tip_pct                               size_
                    min       max      mean       std   sum
sex    smoker                                              
Female No      0.056797  0.252672  0.156921  0.036421   140
       Yes     0.056433  0.416667  0.182150  0.071595    74
Male   No      0.071804  0.291990  0.160669  0.041849   263
       Yes     0.035638  0.710345  0.152771  0.090588   150</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="&#20197;&#26080;&#32034;&#24341;&#30340;&#24418;&#24335;&#36820;&#22238;&#32858;&#21512;&#25968;&#25454;">&#20197;&#26080;&#32034;&#24341;&#30340;&#24418;&#24335;&#36820;&#22238;&#32858;&#21512;&#25968;&#25454;<a class="anchor-link" href="#&#20197;&#26080;&#32034;&#24341;&#30340;&#24418;&#24335;&#36820;&#22238;&#32858;&#21512;&#25968;&#25454;">&#182;</a></h3></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[282]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;smoker&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[282]:</div><div class="output_text output_subarea output_execute_result"><pre>      sex smoker  total_bill       tip     size_   tip_pct
0  Female     No   18.105185  2.773519  2.592593  0.156921
1  Female    Yes   17.977879  2.931515  2.242424  0.182150
2    Male     No   19.791237  3.113402  2.711340  0.160669
3    Male    Yes   22.284500  3.051167  2.500000  0.152771</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[283]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;smoker&#39;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[283]:</div><div class="output_text output_subarea output_execute_result"><pre>               total_bill       tip     size_   tip_pct
sex    smoker                                          
Female No       18.105185  2.773519  2.592593  0.156921
       Yes      17.977879  2.931515  2.242424  0.182150
Male   No       19.791237  3.113402  2.711340  0.160669
       Yes      22.284500  3.051167  2.500000  0.152771</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h2 id="&#20998;&#32452;&#32423;&#36816;&#31639;&#21644;&#36716;&#25442;">&#20998;&#32452;&#32423;&#36816;&#31639;&#21644;&#36716;&#25442;<a class="anchor-link" href="#&#20998;&#32452;&#32423;&#36816;&#31639;&#21644;&#36716;&#25442;">&#182;</a></h2></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[284]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">df</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[284]:</div><div class="output_text output_subarea output_execute_result"><pre>      data1     data2 key1 key2
0 -0.204708  1.393406    a  one
1  0.478943  0.092908    a  two
2 -0.519439  0.281746    b  one
3 -0.555730  0.769023    b  two
4  1.965781  1.246435    a  one</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[285]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">k1_means</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;key1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s1">&#39;mean_&#39;</span><span class="p">)</span>
<span class="n">k1_means</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[285]:</div><div class="output_text output_subarea output_execute_result"><pre>      mean_data1  mean_data2
key1                        
a       0.746672    0.910916
b      -0.537585    0.525384</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>保留原索引</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[286]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">k1_means</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[286]:</div><div class="output_text output_subarea output_execute_result"><pre>      data1     data2 key1 key2  mean_data1  mean_data2
0 -0.204708  1.393406    a  one    0.746672    0.910916
1  0.478943  0.092908    a  two    0.746672    0.910916
4  1.965781  1.246435    a  one    0.746672    0.910916
2 -0.519439  0.281746    b  one   -0.537585    0.525384
3 -0.555730  0.769023    b  two   -0.537585    0.525384</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>另一个例子，以更简洁的方式实现上述功能</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[287]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">people</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[287]:</div><div class="output_text output_subarea output_execute_result"><pre>               a         b         c         d         e
Joe     1.007189 -1.296221  0.274992  0.228913  1.352917
Steve   0.886429 -2.001637 -0.371843  1.669025 -0.438570
Wes    -0.539741       NaN       NaN -1.021228 -0.577087
Jim     0.124121  0.302614  0.523772  0.000940  1.343810
Travis -0.713544 -0.831154 -2.370232 -1.860761 -0.860757</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[288]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">key</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;one&#39;</span><span class="p">]</span>
<span class="n">people</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[288]:</div><div class="output_text output_subarea output_execute_result"><pre>            a         b         c         d         e
one -0.082032 -1.063687 -1.047620 -0.884358 -0.028309
two  0.505275 -0.849512  0.075965  0.834983  0.452620</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>将聚合后的结果放回原来数据中合适的位置（标量进行广播）</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[289]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">people</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[289]:</div><div class="output_text output_subarea output_execute_result"><pre>               a         b         c         d         e
Joe    -0.082032 -1.063687 -1.047620 -0.884358 -0.028309
Steve   0.505275 -0.849512  0.075965  0.834983  0.452620
Wes    -0.082032 -1.063687 -1.047620 -0.884358 -0.028309
Jim     0.505275 -0.849512  0.075965  0.834983  0.452620
Travis -0.082032 -1.063687 -1.047620 -0.884358 -0.028309</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>同时减去均值</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[290]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">demean</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">arr</span> <span class="o">-</span> <span class="n">arr</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">demeaned</span> <span class="o">=</span> <span class="n">people</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">demean</span><span class="p">)</span>
<span class="n">demeaned</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[290]:</div><div class="output_text output_subarea output_execute_result"><pre>               a         b         c         d         e
Joe     1.089221 -0.232534  1.322612  1.113271  1.381226
Steve   0.381154 -1.152125 -0.447807  0.834043 -0.891190
Wes    -0.457709       NaN       NaN -0.136869 -0.548778
Jim    -0.381154  1.152125  0.447807 -0.834043  0.891190
Travis -0.631512  0.232534 -1.322612 -0.976402 -0.832448</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>检验一下</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[291]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">demeaned</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[291]:</div><div class="output_text output_subarea output_execute_result"><pre>                a             b    c             d    e
one  0.000000e+00 -1.110223e-16  0.0  7.401487e-17  0.0
two -2.775558e-17  0.000000e+00  0.0  0.000000e+00  0.0</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="Apply:-&#19968;&#33324;&#24615;&#30340;-&#8220;&#25286;&#20998;-&#24212;&#29992;-&#21512;&#24182;&#8221;">Apply: &#19968;&#33324;&#24615;&#30340; &#8220;&#25286;&#20998;-&#24212;&#29992;-&#21512;&#24182;&#8221;<a class="anchor-link" href="#Apply:-&#19968;&#33324;&#24615;&#30340;-&#8220;&#25286;&#20998;-&#24212;&#29992;-&#21512;&#24182;&#8221;">&#182;</a></h3></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>小费数据，根据某一个属性从大到小进行排序</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[292]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">top</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;tip_pct&#39;</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">column</span><span class="p">)[</span><span class="o">-</span><span class="n">n</span><span class="p">:]</span>
<span class="n">top</span><span class="p">(</span><span class="n">tips</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[292]:</div><div class="output_text output_subarea output_execute_result"><pre>     total_bill   tip     sex smoker  day    time  size_   tip_pct
109       14.31  4.00  Female    Yes  Sat  Dinner      2  0.279525
183       23.17  6.50    Male    Yes  Sun  Dinner      4  0.280535
232       11.61  3.39    Male     No  Sat  Dinner      2  0.291990
67         3.07  1.00  Female    Yes  Sat  Dinner      1  0.325733
178        9.60  4.00  Female    Yes  Sun  Dinner      2  0.416667
172        7.25  5.15    Male    Yes  Sun  Dinner      2  0.710345</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>在分组后的数据集上进行上述排序操作，说明分组后的每一组都是一个DataFrame对象</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[293]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;smoker&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[293]:</div><div class="output_text output_subarea output_execute_result"><pre>            total_bill   tip     sex smoker   day    time  size_   tip_pct
smoker                                                                    
No     88        24.71  5.85    Male     No  Thur   Lunch      2  0.236746
       185       20.69  5.00    Male     No   Sun  Dinner      5  0.241663
       51        10.29  2.60  Female     No   Sun  Dinner      2  0.252672
       149        7.51  2.00    Male     No  Thur   Lunch      2  0.266312
       232       11.61  3.39    Male     No   Sat  Dinner      2  0.291990
Yes    109       14.31  4.00  Female    Yes   Sat  Dinner      2  0.279525
       183       23.17  6.50    Male    Yes   Sun  Dinner      4  0.280535
       67         3.07  1.00  Female    Yes   Sat  Dinner      1  0.325733
       178        9.60  4.00  Female    Yes   Sun  Dinner      2  0.416667
       172        7.25  5.15    Male    Yes   Sun  Dinner      2  0.710345</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[294]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;smoker&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="s1">&#39;total_bill&#39;</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[294]:</div><div class="output_text output_subarea output_execute_result"><pre>                 total_bill    tip     sex smoker   day    time  size_  \
smoker day                                                               
No     Fri  94        22.75   3.25  Female     No   Fri  Dinner      2   
       Sat  212       48.33   9.00    Male     No   Sat  Dinner      4   
       Sun  156       48.17   5.00    Male     No   Sun  Dinner      6   
       Thur 142       41.19   5.00    Male     No  Thur   Lunch      5   
Yes    Fri  95        40.17   4.73    Male    Yes   Fri  Dinner      4   
       Sat  170       50.81  10.00    Male    Yes   Sat  Dinner      3   
       Sun  182       45.35   3.50    Male    Yes   Sun  Dinner      3   
       Thur 197       43.11   5.00  Female    Yes  Thur   Lunch      4   

                  tip_pct  
smoker day                 
No     Fri  94   0.142857  
       Sat  212  0.186220  
       Sun  156  0.103799  
       Thur 142  0.121389  
Yes    Fri  95   0.117750  
       Sat  170  0.196812  
       Sun  182  0.077178  
       Thur 197  0.115982  </pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>获取分组后数据某一列的统计数据</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[295]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;smoker&#39;</span><span class="p">)[</span><span class="s1">&#39;tip_pct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">result</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[295]:</div><div class="output_text output_subarea output_execute_result"><pre>smoker       
No      count    151.000000
        mean       0.159328
        std        0.039910
        min        0.056797
        25%        0.136906
        50%        0.155625
        75%        0.185014
        max        0.291990
Yes     count     93.000000
        mean       0.163196
        std        0.085119
        min        0.035638
        25%        0.106771
        50%        0.153846
        75%        0.195059
        max        0.710345
Name: tip_pct, dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[296]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="s1">&#39;smoker&#39;</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[296]:</div><div class="output_text output_subarea output_execute_result"><pre>smoker          No        Yes
count   151.000000  93.000000
mean      0.159328   0.163196
std       0.039910   0.085119
min       0.056797   0.035638
25%       0.136906   0.106771
50%       0.155625   0.153846
75%       0.185014   0.195059
max       0.291990   0.710345</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>grouped 根据性别以及是否吸烟进行分组</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[297]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="n">grouped</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[297]:</div><div class="output_text output_subarea output_execute_result"><pre>                     total_bill        tip      size_    tip_pct
sex    smoker                                                   
Female No     count   54.000000  54.000000  54.000000  54.000000
              mean    18.105185   2.773519   2.592593   0.156921
              std      7.286455   1.128425   1.073146   0.036421
              min      7.250000   1.000000   1.000000   0.056797
              25%     12.650000   2.000000   2.000000   0.139708
              50%     16.690000   2.680000   2.000000   0.149691
              75%     20.862500   3.437500   3.000000   0.181630
              max     35.830000   5.200000   6.000000   0.252672
       Yes    count   33.000000  33.000000  33.000000  33.000000
              mean    17.977879   2.931515   2.242424   0.182150
              std      9.189751   1.219916   0.613917   0.071595
              min      3.070000   1.000000   1.000000   0.056433
              25%     12.760000   2.000000   2.000000   0.152439
              50%     16.270000   2.880000   2.000000   0.173913
              75%     22.120000   3.500000   2.000000   0.198216
              max     44.300000   6.500000   4.000000   0.416667
Male   No     count   97.000000  97.000000  97.000000  97.000000
              mean    19.791237   3.113402   2.711340   0.160669
              std      8.726566   1.489559   0.989094   0.041849
              min      7.510000   1.250000   2.000000   0.071804
              25%     13.810000   2.000000   2.000000   0.131810
              50%     18.240000   2.740000   2.000000   0.157604
              75%     22.820000   3.710000   3.000000   0.186220
              max     48.330000   9.000000   6.000000   0.291990
       Yes    count   60.000000  60.000000  60.000000  60.000000
              mean    22.284500   3.051167   2.500000   0.152771
              std      9.911845   1.500120   0.892530   0.090588
              min      7.250000   1.000000   1.000000   0.035638
              25%     15.272500   2.000000   2.000000   0.101845
              50%     20.390000   3.000000   2.000000   0.141015
              75%     28.572500   3.820000   3.000000   0.191697
              max     50.810000  10.000000   5.000000   0.710345</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h4 id="&#31105;&#27490;&#20998;&#32452;&#38190;">&#31105;&#27490;&#20998;&#32452;&#38190;<a class="anchor-link" href="#&#31105;&#27490;&#20998;&#32452;&#38190;">&#182;</a></h4></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[298]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;smoker&#39;</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[298]:</div><div class="output_text output_subarea output_execute_result"><pre>            total_bill   tip     sex smoker   day    time  size_   tip_pct
smoker                                                                    
No     88        24.71  5.85    Male     No  Thur   Lunch      2  0.236746
       185       20.69  5.00    Male     No   Sun  Dinner      5  0.241663
       51        10.29  2.60  Female     No   Sun  Dinner      2  0.252672
       149        7.51  2.00    Male     No  Thur   Lunch      2  0.266312
       232       11.61  3.39    Male     No   Sat  Dinner      2  0.291990
Yes    109       14.31  4.00  Female    Yes   Sat  Dinner      2  0.279525
       183       23.17  6.50    Male    Yes   Sun  Dinner      4  0.280535
       67         3.07  1.00  Female    Yes   Sat  Dinner      1  0.325733
       178        9.60  4.00  Female    Yes   Sun  Dinner      2  0.416667
       172        7.25  5.15    Male    Yes   Sun  Dinner      2  0.710345</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[299]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;smoker&#39;</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[299]:</div><div class="output_text output_subarea output_execute_result"><pre>     total_bill   tip     sex smoker   day    time  size_   tip_pct
88        24.71  5.85    Male     No  Thur   Lunch      2  0.236746
185       20.69  5.00    Male     No   Sun  Dinner      5  0.241663
51        10.29  2.60  Female     No   Sun  Dinner      2  0.252672
149        7.51  2.00    Male     No  Thur   Lunch      2  0.266312
232       11.61  3.39    Male     No   Sat  Dinner      2  0.291990
109       14.31  4.00  Female    Yes   Sat  Dinner      2  0.279525
183       23.17  6.50    Male    Yes   Sun  Dinner      4  0.280535
67         3.07  1.00  Female    Yes   Sat  Dinner      1  0.325733
178        9.60  4.00  Female    Yes   Sun  Dinner      2  0.416667
172        7.25  5.15    Male    Yes   Sun  Dinner      2  0.710345</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="&#20998;&#20301;&#25968;&#19982;&#26742;&#20998;&#26512;">&#20998;&#20301;&#25968;&#19982;&#26742;&#20998;&#26512;<a class="anchor-link" href="#&#20998;&#20301;&#25968;&#19982;&#26742;&#20998;&#26512;">&#182;</a></h3></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[300]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;data1&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span>
                   <span class="s1">&#39;data2&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1000</span><span class="p">)})</span>
<span class="n">factor</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">data1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">factor</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[300]:</div><div class="output_text output_subarea output_execute_result"><pre>0     (-1.23, 0.489]
1    (-2.956, -1.23]
2     (-1.23, 0.489]
3     (0.489, 2.208]
4     (-1.23, 0.489]
5     (0.489, 2.208]
6     (-1.23, 0.489]
7     (-1.23, 0.489]
8     (0.489, 2.208]
9     (0.489, 2.208]
Name: data1, dtype: category
Categories (4, object): [(-2.956, -1.23] &lt; (-1.23, 0.489] &lt; (0.489, 2.208] &lt; (2.208, 3.928]]</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[301]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">get_stats</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">group</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">group</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
            <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">group</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">group</span><span class="o">.</span><span class="n">mean</span><span class="p">()}</span>

<span class="n">grouped</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">data2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
<span class="n">grouped</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_stats</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>

<span class="c1">#ADAPT the output is not sorted in the book while this is the case now (swap first two lines)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[301]:</div><div class="output_text output_subarea output_execute_result"><pre>                 count       max      mean       min
data1                                               
(-2.956, -1.23]   95.0  1.670835 -0.039521 -3.399312
(-1.23, 0.489]   598.0  3.260383 -0.002051 -2.989741
(0.489, 2.208]   297.0  2.954439  0.081822 -3.745356
(2.208, 3.928]    10.0  1.765640  0.024750 -1.929776</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[302]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="c1"># Return quantile numbers</span>
<span class="n">grouping</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">data1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">grouped</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">data2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">grouping</span><span class="p">)</span>
<span class="n">grouped</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_stats</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[302]:</div><div class="output_text output_subarea output_execute_result"><pre>       count       max      mean       min
data1                                     
0      100.0  1.670835 -0.049902 -3.399312
1      100.0  2.628441  0.030989 -1.950098
2      100.0  2.527939 -0.067179 -2.925113
3      100.0  3.260383  0.065713 -2.315555
4      100.0  2.074345 -0.111653 -2.047939
5      100.0  2.184810  0.052130 -2.989741
6      100.0  2.458842 -0.021489 -2.223506
7      100.0  2.954439 -0.026459 -3.056990
8      100.0  2.735527  0.103406 -3.745356
9      100.0  2.377020  0.220122 -2.064111</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="Example:-&#29992;&#29305;&#23450;&#20998;&#32452;&#30340;&#20540;&#22635;&#20805;&#32570;&#22833;&#20540;">Example: &#29992;&#29305;&#23450;&#20998;&#32452;&#30340;&#20540;&#22635;&#20805;&#32570;&#22833;&#20540;<a class="anchor-link" href="#Example:-&#29992;&#29305;&#23450;&#20998;&#32452;&#30340;&#20540;&#22635;&#20805;&#32570;&#22833;&#20540;">&#182;</a></h3></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>填一些缺失值进去</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[303]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="n">s</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">s</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[303]:</div><div class="output_text output_subarea output_execute_result"><pre>0         NaN
1   -0.125921
2         NaN
3   -0.884475
4         NaN
5    0.227290
dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>用均值填充缺失值</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[304]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">s</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[304]:</div><div class="output_text output_subarea output_execute_result"><pre>0   -0.261035
1   -0.125921
2   -0.261035
3   -0.884475
4   -0.261035
5    0.227290
dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>同样，填一些缺失值</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[305]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">states</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ohio&#39;</span><span class="p">,</span> <span class="s1">&#39;New York&#39;</span><span class="p">,</span> <span class="s1">&#39;Vermont&#39;</span><span class="p">,</span> <span class="s1">&#39;Florida&#39;</span><span class="p">,</span>
          <span class="s1">&#39;Oregon&#39;</span><span class="p">,</span> <span class="s1">&#39;Nevada&#39;</span><span class="p">,</span> <span class="s1">&#39;California&#39;</span><span class="p">,</span> <span class="s1">&#39;Idaho&#39;</span><span class="p">]</span>
<span class="n">group_key</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;East&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;West&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">states</span><span class="p">)</span>
<span class="n">data</span><span class="p">[[</span><span class="s1">&#39;Vermont&#39;</span><span class="p">,</span> <span class="s1">&#39;Nevada&#39;</span><span class="p">,</span> <span class="s1">&#39;Idaho&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">data</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[305]:</div><div class="output_text output_subarea output_execute_result"><pre>Ohio          0.922264
New York     -2.153545
Vermont            NaN
Florida      -0.375842
Oregon        0.329939
Nevada             NaN
California    1.105913
Idaho              NaN
dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>计算分组均值</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[306]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">group_key</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[306]:</div><div class="output_text output_subarea output_execute_result"><pre>East   -0.535707
West    0.717926
dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>这里的<code>g</code>指代调用<code>apply</code>的主体，也就是<code>data.groupby(group_key)</code>分组后的结果</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[307]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">fill_mean</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">group_key</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fill_mean</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[307]:</div><div class="output_text output_subarea output_execute_result"><pre>Ohio          0.922264
New York     -2.153545
Vermont      -0.535707
Florida      -0.375842
Oregon        0.329939
Nevada        0.717926
California    1.105913
Idaho         0.717926
dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>由于<code>groupby</code>操作后得到的结果类似于一个字典，字典<code>key</code>是组名，<code>value</code>是一个<code>DataFrame Object</code></p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[308]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">fill_values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;East&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;West&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
<span class="n">fill_func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">fill_values</span><span class="p">[</span><span class="n">g</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>

<span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">group_key</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fill_func</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[308]:</div><div class="output_text output_subarea output_execute_result"><pre>Ohio          0.922264
New York     -2.153545
Vermont       0.500000
Florida      -0.375842
Oregon        0.329939
Nevada       -1.000000
California    1.105913
Idaho        -1.000000
dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="Example:-&#38543;&#26426;&#37319;&#26679;&#21644;&#25490;&#21015;">Example: &#38543;&#26426;&#37319;&#26679;&#21644;&#25490;&#21015;<a class="anchor-link" href="#Example:-&#38543;&#26426;&#37319;&#26679;&#21644;&#25490;&#21015;">&#182;</a></h3></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>构造扑克牌</p><p>红桃<code>Hearts</code>, 黑桃<code>Spades</code>, 梅花<code>Clubs</code>, 方片<code>Diamonds</code></p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[309]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="c1"># Hearts, Spades, Clubs, Diamonds</span>
<span class="n">suits</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">]</span>
<span class="n">card_val</span> <span class="o">=</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">base_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;J&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">]</span>
<span class="n">cards</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">suit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">]:</span>
    <span class="n">cards</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">+</span> <span class="n">suit</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">base_names</span><span class="p">)</span>

<span class="n">deck</span> <span class="o">=</span> <span class="n">Series</span><span class="p">(</span><span class="n">card_val</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">cards</span><span class="p">)</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[310]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">deck</span><span class="p">[:</span><span class="mi">13</span><span class="p">]</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[310]:</div><div class="output_text output_subarea output_execute_result"><pre>AH      1
2H      2
3H      3
4H      4
5H      5
6H      6
7H      7
8H      8
9H      9
10H    10
JH     10
KH     10
QH     10
dtype: int64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>随机抽牌</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[311]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="n">deck</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">deck</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">deck</span><span class="p">))[:</span><span class="n">n</span><span class="p">])</span>
<span class="n">draw</span><span class="p">(</span><span class="n">deck</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[311]:</div><div class="output_text output_subarea output_execute_result"><pre>AD     1
8C     8
5H     5
KC    10
2C     2
dtype: int64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>分类抽牌</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[312]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">get_suit</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">card</span><span class="p">:</span> <span class="n">card</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># last letter is suit</span>
<span class="n">deck</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">get_suit</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[312]:</div><div class="output_text output_subarea output_execute_result"><pre>C  2C     2
   3C     3
D  KD    10
   8D     8
H  KH    10
   3H     3
S  2S     2
   4S     4
dtype: int64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>去掉分组键</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[313]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="c1"># alternatively</span>
<span class="n">deck</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">get_suit</span><span class="p">,</span> <span class="n">group_keys</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">draw</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[313]:</div><div class="output_text output_subarea output_execute_result"><pre>KC    10
JC    10
AD     1
5D     5
5H     5
6H     6
7S     7
KS    10
dtype: int64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="Example:-&#20998;&#32452;&#21152;&#26435;&#24179;&#22343;&#25968;&#21644;&#30456;&#20851;&#31995;&#25968;">Example: &#20998;&#32452;&#21152;&#26435;&#24179;&#22343;&#25968;&#21644;&#30456;&#20851;&#31995;&#25968;<a class="anchor-link" href="#Example:-&#20998;&#32452;&#21152;&#26435;&#24179;&#22343;&#25968;&#21644;&#30456;&#20851;&#31995;&#25968;">&#182;</a></h3></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[314]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span>
                <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
                <span class="s1">&#39;weights&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">8</span><span class="p">)})</span>
<span class="n">df</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[314]:</div><div class="output_text output_subarea output_execute_result"><pre>  category      data   weights
0        a  1.561587  0.957515
1        a  1.219984  0.347267
2        a -0.482239  0.581362
3        a  0.315667  0.217091
4        b -0.047852  0.894406
5        b -0.454145  0.918564
6        b -0.556774  0.277825
7        b  0.253321  0.955905</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[315]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">get_wavg</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="n">g</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">])</span>
<span class="n">grouped</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_wavg</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[315]:</div><div class="output_text output_subarea output_execute_result"><pre>category
a    0.811643
b   -0.122262
dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p><code>stock</code>数据集</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[316]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">close_px</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;ch09/stock_px.csv&#39;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">close_px</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt"></div><div class="output_subarea output_stream output_stdout output_text"><pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 2214 entries, 2003-01-02 to 2011-10-14
Data columns (total 4 columns):
AAPL    2214 non-null float64
MSFT    2214 non-null float64
XOM     2214 non-null float64
SPX     2214 non-null float64
dtypes: float64(4)
memory usage: 86.5 KB
</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[317]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">close_px</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[317]:</div><div class="output_text output_subarea output_execute_result"><pre>              AAPL   MSFT    XOM      SPX
2011-10-11  400.29  27.00  76.27  1195.54
2011-10-12  402.19  26.96  77.16  1207.25
2011-10-13  408.43  27.18  76.37  1203.66
2011-10-14  422.00  27.27  78.11  1224.58</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>计算相关系数</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[318]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">rets</span> <span class="o">=</span> <span class="n">close_px</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">spx_corr</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;SPX&#39;</span><span class="p">])</span>
<span class="n">by_year</span> <span class="o">=</span> <span class="n">rets</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<span class="n">by_year</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">spx_corr</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[318]:</div><div class="output_text output_subarea output_execute_result"><pre>          AAPL      MSFT       XOM  SPX
2003  0.541124  0.745174  0.661265  1.0
2004  0.374283  0.588531  0.557742  1.0
2005  0.467540  0.562374  0.631010  1.0
2006  0.428267  0.406126  0.518514  1.0
2007  0.508118  0.658770  0.786264  1.0
2008  0.681434  0.804626  0.828303  1.0
2009  0.707103  0.654902  0.797921  1.0
2010  0.710105  0.730118  0.839057  1.0
2011  0.691931  0.800996  0.859975  1.0</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p><code>lambda</code>看来有很大用处</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[319]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="c1"># Annual correlation of Apple with Microsoft</span>
<span class="n">by_year</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">g</span><span class="p">:</span> <span class="n">g</span><span class="p">[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="s1">&#39;MSFT&#39;</span><span class="p">]))</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[319]:</div><div class="output_text output_subarea output_execute_result"><pre>2003    0.480868
2004    0.259024
2005    0.300093
2006    0.161735
2007    0.417738
2008    0.611901
2009    0.432738
2010    0.571946
2011    0.581987
dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="Example:-&#20998;&#32452;&#32423;&#32447;&#22411;&#22238;&#24402;">Example: &#20998;&#32452;&#32423;&#32447;&#22411;&#22238;&#24402;<a class="anchor-link" href="#Example:-&#20998;&#32452;&#32423;&#32447;&#22411;&#22238;&#24402;">&#182;</a></h3></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[320]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="kn">as</span> <span class="nn">sm</span>
<span class="k">def</span> <span class="nf">regress</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">yvar</span><span class="p">,</span> <span class="n">xvars</span><span class="p">):</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">yvar</span><span class="p">]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">xvars</span><span class="p">]</span>
    <span class="n">X</span><span class="p">[</span><span class="s1">&#39;intercept&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>这样传参</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[321]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">by_year</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">regress</span><span class="p">,</span> <span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;SPX&#39;</span><span class="p">])</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[321]:</div><div class="output_text output_subarea output_execute_result"><pre>           SPX  intercept
2003  1.195406   0.000710
2004  1.363463   0.004201
2005  1.766415   0.003246
2006  1.645496   0.000080
2007  1.198761   0.003438
2008  0.968016  -0.001110
2009  0.879103   0.002954
2010  1.052608   0.001261
2011  0.806605   0.001514</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h2 id="&#36879;&#35270;&#34920;&#21644;&#20132;&#21449;&#34920;">&#36879;&#35270;&#34920;&#21644;&#20132;&#21449;&#34920;<a class="anchor-link" href="#&#36879;&#35270;&#34920;&#21644;&#20132;&#21449;&#34920;">&#182;</a></h2></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[322]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">tips</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[322]:</div><div class="output_text output_subarea output_execute_result"><pre>   total_bill   tip     sex smoker  day    time  size_   tip_pct
0       16.99  1.01  Female     No  Sun  Dinner      2  0.059447
1       10.34  1.66    Male     No  Sun  Dinner      3  0.160542
2       21.01  3.50    Male     No  Sun  Dinner      3  0.166587
3       23.68  3.31    Male     No  Sun  Dinner      2  0.139780
4       24.59  3.61  Female     No  Sun  Dinner      4  0.146808
5       25.29  4.71    Male     No  Sun  Dinner      4  0.186240
6        8.77  2.00    Male     No  Sun  Dinner      2  0.228050
7       26.88  3.12    Male     No  Sun  Dinner      4  0.116071
8       15.04  1.96    Male     No  Sun  Dinner      2  0.130319
9       14.78  3.23    Male     No  Sun  Dinner      2  0.218539</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p><code>pivot_table</code>默认情况相当于分组后进行<code>mean()</code>操作</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[323]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">tips</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;smoker&#39;</span><span class="p">])</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[323]:</div><div class="output_text output_subarea output_execute_result"><pre>                  size_       tip   tip_pct  total_bill
sex    smoker                                          
Female No      2.592593  2.773519  0.156921   18.105185
       Yes     2.242424  2.931515  0.182150   17.977879
Male   No      2.711340  3.113402  0.160669   19.791237
       Yes     2.500000  3.051167  0.152771   22.284500</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>指定分组度量</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[324]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">tips</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">([</span><span class="s1">&#39;tip_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;size_&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">],</span>
                 <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;smoker&#39;</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[324]:</div><div class="output_text output_subarea output_execute_result"><pre>              tip_pct               size_          
smoker             No       Yes        No       Yes
sex    day                                         
Female Fri   0.165296  0.209129  2.500000  2.000000
       Sat   0.147993  0.163817  2.307692  2.200000
       Sun   0.165710  0.237075  3.071429  2.500000
       Thur  0.155971  0.163073  2.480000  2.428571
Male   Fri   0.138005  0.144730  2.000000  2.125000
       Sat   0.162132  0.139067  2.656250  2.629630
       Sun   0.158291  0.173964  2.883721  2.600000
       Thur  0.165706  0.164417  2.500000  2.300000</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>增加ALL列</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[325]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">tips</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">([</span><span class="s1">&#39;tip_pct&#39;</span><span class="p">,</span> <span class="s1">&#39;size_&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">],</span>
                 <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;smoker&#39;</span><span class="p">,</span> <span class="n">margins</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[325]:</div><div class="output_text output_subarea output_execute_result"><pre>              tip_pct                         size_                    
smoker             No       Yes       All        No       Yes       All
sex    day                                                             
Female Fri   0.165296  0.209129  0.199388  2.500000  2.000000  2.111111
       Sat   0.147993  0.163817  0.156470  2.307692  2.200000  2.250000
       Sun   0.165710  0.237075  0.181569  3.071429  2.500000  2.944444
       Thur  0.155971  0.163073  0.157525  2.480000  2.428571  2.468750
Male   Fri   0.138005  0.144730  0.143385  2.000000  2.125000  2.100000
       Sat   0.162132  0.139067  0.151577  2.656250  2.629630  2.644068
       Sun   0.158291  0.173964  0.162344  2.883721  2.600000  2.810345
       Thur  0.165706  0.164417  0.165276  2.500000  2.300000  2.433333
All          0.159328  0.163196  0.160803  2.668874  2.408602  2.569672</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>更换一个分组度量</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[326]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">tips</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="s1">&#39;tip_pct&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;smoker&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">,</span>
                 <span class="n">aggfunc</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">margins</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[326]:</div><div class="output_text output_subarea output_execute_result"><pre>day             Fri   Sat   Sun  Thur    All
sex    smoker                               
Female No       2.0  13.0  14.0  25.0   54.0
       Yes      7.0  15.0   4.0   7.0   33.0
Male   No       2.0  32.0  43.0  20.0   97.0
       Yes      8.0  27.0  15.0  10.0   60.0
All            19.0  87.0  76.0  62.0  244.0</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>分组计数并填充（可能存在空组合）</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[327]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">tips</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="s1">&#39;size_&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;smoker&#39;</span><span class="p">],</span>
                 <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[327]:</div><div class="output_text output_subarea output_execute_result"><pre>day                   Fri  Sat  Sun  Thur
time   sex    smoker                     
Dinner Female No        2   30   43     2
              Yes       8   33   10     0
       Male   No        4   85  124     0
              Yes      12   71   39     0
Lunch  Female No        3    0    0    60
              Yes       6    0    0    17
       Male   No        0    0    0    50
              Yes       5    0    0    23</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="&#20132;&#21449;&#34920;:-crosstab">&#20132;&#21449;&#34920;: crosstab<a class="anchor-link" href="#&#20132;&#21449;&#34920;:-crosstab">&#182;</a></h3></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[328]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">Sample    Gender    Handedness</span>
<span class="s2">1    Female    Right-handed</span>
<span class="s2">2    Male    Left-handed</span>
<span class="s2">3    Female    Right-handed</span>
<span class="s2">4    Male    Right-handed</span>
<span class="s2">5    Male    Left-handed</span>
<span class="s2">6    Male    Right-handed</span>
<span class="s2">7    Female    Right-handed</span>
<span class="s2">8    Female    Left-handed</span>
<span class="s2">9    Male    Right-handed</span>
<span class="s2">10    Female    Right-handed&quot;&quot;&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[329]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">data</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[329]:</div><div class="output_text output_subarea output_execute_result"><pre>   Sample  Gender    Handedness
0       1  Female  Right-handed
1       2    Male   Left-handed
2       3  Female  Right-handed
3       4    Male  Right-handed
4       5    Male   Left-handed
5       6    Male  Right-handed
6       7  Female  Right-handed
7       8  Female   Left-handed
8       9    Male  Right-handed
9      10  Female  Right-handed</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>交叉表就是在...计数...</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[330]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Gender</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">Handedness</span><span class="p">,</span> <span class="n">margins</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[330]:</div><div class="output_text output_subarea output_execute_result"><pre>Handedness  Left-handed  Right-handed  All
Gender                                    
Female                1             4    5
Male                  2             3    5
All                   3             7   10</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[331]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">([</span><span class="n">tips</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">tips</span><span class="o">.</span><span class="n">day</span><span class="p">],</span> <span class="n">tips</span><span class="o">.</span><span class="n">smoker</span><span class="p">,</span> <span class="n">margins</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[331]:</div><div class="output_text output_subarea output_execute_result"><pre>smoker        No  Yes  All
time   day                
Dinner Fri     3    9   12
       Sat    45   42   87
       Sun    57   19   76
       Thur    1    0    1
Lunch  Fri     1    6    7
       Thur   44   17   61
All          151   93  244</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h2 id="Example:-2012-&#32852;&#37030;&#36873;&#20030;&#22996;&#21592;&#20250;&#25968;&#25454;&#24211;">Example: 2012 &#32852;&#37030;&#36873;&#20030;&#22996;&#21592;&#20250;&#25968;&#25454;&#24211;<a class="anchor-link" href="#Example:-2012-&#32852;&#37030;&#36873;&#20030;&#22996;&#21592;&#20250;&#25968;&#25454;&#24211;">&#182;</a></h2></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>这个数据库包括赞助人的姓名，职业、雇主、地址以及出资额等信息</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[332]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">fec</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;ch09/P00000001-ALL.csv&#39;</span><span class="p">)</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[333]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">fec</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt"></div><div class="output_subarea output_stream output_stdout output_text"><pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1001731 entries, 0 to 1001730
Data columns (total 16 columns):
cmte_id              1001731 non-null object
cand_id              1001731 non-null object
cand_nm              1001731 non-null object
contbr_nm            1001731 non-null object
contbr_city          1001712 non-null object
contbr_st            1001727 non-null object
contbr_zip           1001620 non-null object
contbr_employer      988002 non-null object
contbr_occupation    993301 non-null object
contb_receipt_amt    1001731 non-null float64
contb_receipt_dt     1001731 non-null object
receipt_desc         14166 non-null object
memo_cd              92482 non-null object
memo_text            97770 non-null object
form_tp              1001731 non-null object
file_num             1001731 non-null int64
dtypes: float64(1), int64(1), object(14)
memory usage: 122.3+ MB
</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[334]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">fec</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="mi">123456</span><span class="p">]</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[334]:</div><div class="output_text output_subarea output_execute_result"><pre>cmte_id                             C00431445
cand_id                             P80003338
cand_nm                         Obama, Barack
contbr_nm                         ELLMAN, IRA
contbr_city                             TEMPE
contbr_st                                  AZ
contbr_zip                          852816719
contbr_employer      ARIZONA STATE UNIVERSITY
contbr_occupation                   PROFESSOR
contb_receipt_amt                          50
contb_receipt_dt                    01-DEC-11
receipt_desc                              NaN
memo_cd                                   NaN
memo_text                                 NaN
form_tp                                 SA17A
file_num                               772372
Name: 123456, dtype: object</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>输出全部候选人名单</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[335]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">unique_cands</span> <span class="o">=</span> <span class="n">fec</span><span class="o">.</span><span class="n">cand_nm</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">unique_cands</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[335]:</div><div class="output_text output_subarea output_execute_result"><pre>array([&#39;Bachmann, Michelle&#39;, &#39;Romney, Mitt&#39;, &#39;Obama, Barack&#39;,
       &#34;Roemer, Charles E. &#39;Buddy&#39; III&#34;, &#39;Pawlenty, Timothy&#39;,
       &#39;Johnson, Gary Earl&#39;, &#39;Paul, Ron&#39;, &#39;Santorum, Rick&#39;, &#39;Cain, Herman&#39;,
       &#39;Gingrich, Newt&#39;, &#39;McCotter, Thaddeus G&#39;, &#39;Huntsman, Jon&#39;,
       &#39;Perry, Rick&#39;], dtype=object)</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[336]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">unique_cands</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[336]:</div><div class="output_text output_subarea output_execute_result"><pre>&#39;Obama, Barack&#39;</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>政党映射</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[337]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">parties</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Bachmann, Michelle&#39;</span><span class="p">:</span> <span class="s1">&#39;Republican&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Cain, Herman&#39;</span><span class="p">:</span> <span class="s1">&#39;Republican&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Gingrich, Newt&#39;</span><span class="p">:</span> <span class="s1">&#39;Republican&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Huntsman, Jon&#39;</span><span class="p">:</span> <span class="s1">&#39;Republican&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Johnson, Gary Earl&#39;</span><span class="p">:</span> <span class="s1">&#39;Republican&#39;</span><span class="p">,</span>
           <span class="s1">&#39;McCotter, Thaddeus G&#39;</span><span class="p">:</span> <span class="s1">&#39;Republican&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Obama, Barack&#39;</span><span class="p">:</span> <span class="s1">&#39;Democrat&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Paul, Ron&#39;</span><span class="p">:</span> <span class="s1">&#39;Republican&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Pawlenty, Timothy&#39;</span><span class="p">:</span> <span class="s1">&#39;Republican&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Perry, Rick&#39;</span><span class="p">:</span> <span class="s1">&#39;Republican&#39;</span><span class="p">,</span>
           <span class="s2">&quot;Roemer, Charles E. &#39;Buddy&#39; III&quot;</span><span class="p">:</span> <span class="s1">&#39;Republican&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Romney, Mitt&#39;</span><span class="p">:</span> <span class="s1">&#39;Republican&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Santorum, Rick&#39;</span><span class="p">:</span> <span class="s1">&#39;Republican&#39;</span><span class="p">}</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[338]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">fec</span><span class="o">.</span><span class="n">cand_nm</span><span class="p">[</span><span class="mi">123456</span><span class="p">:</span><span class="mi">123461</span><span class="p">]</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[338]:</div><div class="output_text output_subarea output_execute_result"><pre>123456    Obama, Barack
123457    Obama, Barack
123458    Obama, Barack
123459    Obama, Barack
123460    Obama, Barack
Name: cand_nm, dtype: object</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[339]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">fec</span><span class="o">.</span><span class="n">cand_nm</span><span class="p">[</span><span class="mi">123456</span><span class="p">:</span><span class="mi">123461</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">parties</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[339]:</div><div class="output_text output_subarea output_execute_result"><pre>123456    Democrat
123457    Democrat
123458    Democrat
123459    Democrat
123460    Democrat
Name: cand_nm, dtype: object</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>根据以上创建的映射，在原数据集中添加一列<code>party</code></p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[340]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="c1"># Add it as a column</span>
<span class="n">fec</span><span class="p">[</span><span class="s1">&#39;party&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fec</span><span class="o">.</span><span class="n">cand_nm</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">parties</span><span class="p">)</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[341]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">fec</span><span class="p">[</span><span class="s1">&#39;party&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[341]:</div><div class="output_text output_subarea output_execute_result"><pre>Democrat      593746
Republican    407985
Name: party, dtype: int64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>看看出资额是正是负</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[342]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="p">(</span><span class="n">fec</span><span class="o">.</span><span class="n">contb_receipt_amt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[342]:</div><div class="output_text output_subarea output_execute_result"><pre>True     991475
False     10256
Name: contb_receipt_amt, dtype: int64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>调整出资额为正</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[343]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">fec</span> <span class="o">=</span> <span class="n">fec</span><span class="p">[</span><span class="n">fec</span><span class="o">.</span><span class="n">contb_receipt_amt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>筛选候选人</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[344]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">fec_mrbo</span> <span class="o">=</span> <span class="n">fec</span><span class="p">[</span><span class="n">fec</span><span class="o">.</span><span class="n">cand_nm</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;Obama, Barack&#39;</span><span class="p">,</span> <span class="s1">&#39;Romney, Mitt&#39;</span><span class="p">])]</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="&#26681;&#25454;&#32844;&#19994;&#21644;&#38599;&#20027;&#32479;&#35745;&#36190;&#21161;&#20449;&#24687;">&#26681;&#25454;&#32844;&#19994;&#21644;&#38599;&#20027;&#32479;&#35745;&#36190;&#21161;&#20449;&#24687;<a class="anchor-link" href="#&#26681;&#25454;&#32844;&#19994;&#21644;&#38599;&#20027;&#32479;&#35745;&#36190;&#21161;&#20449;&#24687;">&#182;</a></h3></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>统计职业信息</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[345]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">fec</span><span class="o">.</span><span class="n">contbr_occupation</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[345]:</div><div class="output_text output_subarea output_execute_result"><pre>RETIRED                                   233990
INFORMATION REQUESTED                      35107
ATTORNEY                                   34286
HOMEMAKER                                  29931
PHYSICIAN                                  23432
INFORMATION REQUESTED PER BEST EFFORTS     21138
ENGINEER                                   14334
TEACHER                                    13990
CONSULTANT                                 13273
PROFESSOR                                  12555
Name: contbr_occupation, dtype: int64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>筛选出一些不符合规格的信息映射到正常信息</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[346]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">occ_mapping</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s1">&#39;INFORMATION REQUESTED PER BEST EFFORTS&#39;</span> <span class="p">:</span> <span class="s1">&#39;NOT PROVIDED&#39;</span><span class="p">,</span>
   <span class="s1">&#39;INFORMATION REQUESTED&#39;</span> <span class="p">:</span> <span class="s1">&#39;NOT PROVIDED&#39;</span><span class="p">,</span>
   <span class="s1">&#39;INFORMATION REQUESTED (BEST EFFORTS)&#39;</span> <span class="p">:</span> <span class="s1">&#39;NOT PROVIDED&#39;</span><span class="p">,</span>
   <span class="s1">&#39;C.E.O.&#39;</span><span class="p">:</span> <span class="s1">&#39;CEO&#39;</span>
<span class="p">}</span>

<span class="c1"># If no mapping provided, return x</span>
<span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">occ_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">fec</span><span class="o">.</span><span class="n">contbr_occupation</span> <span class="o">=</span> <span class="n">fec</span><span class="o">.</span><span class="n">contbr_occupation</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>以上巧妙运用了get方法</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[347]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">emp_mapping</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s1">&#39;INFORMATION REQUESTED PER BEST EFFORTS&#39;</span> <span class="p">:</span> <span class="s1">&#39;NOT PROVIDED&#39;</span><span class="p">,</span>
   <span class="s1">&#39;INFORMATION REQUESTED&#39;</span> <span class="p">:</span> <span class="s1">&#39;NOT PROVIDED&#39;</span><span class="p">,</span>
   <span class="s1">&#39;SELF&#39;</span> <span class="p">:</span> <span class="s1">&#39;SELF-EMPLOYED&#39;</span><span class="p">,</span>
   <span class="s1">&#39;SELF EMPLOYED&#39;</span> <span class="p">:</span> <span class="s1">&#39;SELF-EMPLOYED&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># If no mapping provided, return x</span>
<span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">emp_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">fec</span><span class="o">.</span><span class="n">contbr_employer</span> <span class="o">=</span> <span class="n">fec</span><span class="o">.</span><span class="n">contbr_employer</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>根据职业以及候选人政党分组，统计出资额总和</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[348]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">by_occupation</span> <span class="o">=</span> <span class="n">fec</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="s1">&#39;contb_receipt_amt&#39;</span><span class="p">,</span>
                                <span class="n">index</span><span class="o">=</span><span class="s1">&#39;contbr_occupation&#39;</span><span class="p">,</span>
                                <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;party&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[362]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">over_2mm</span> <span class="o">=</span> <span class="n">by_occupation</span><span class="p">[</span><span class="n">by_occupation</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2000000</span><span class="p">]</span>
<span class="n">over_2mm</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[362]:</div><div class="output_text output_subarea output_execute_result"><pre>party                 Democrat    Republican
contbr_occupation                           
ATTORNEY           11141982.97  7.477194e+06
CEO                 2074974.79  4.211041e+06
CONSULTANT          2459912.71  2.544725e+06
ENGINEER             951525.55  1.818374e+06
EXECUTIVE           1355161.05  4.138850e+06
HOMEMAKER           4248875.80  1.363428e+07
INVESTOR             884133.00  2.431769e+06
LAWYER              3160478.87  3.912243e+05
MANAGER              762883.22  1.444532e+06
NOT PROVIDED        4866973.96  2.056547e+07
OWNER               1001567.36  2.408287e+06
PHYSICIAN           3735124.94  3.594320e+06
PRESIDENT           1878509.95  4.720924e+06
PROFESSOR           2165071.08  2.967027e+05
REAL ESTATE          528902.09  1.625902e+06
RETIRED            25305116.38  2.356124e+07
SELF-EMPLOYED        672393.40  1.640253e+06</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[350]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">over_2mm</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[350]:</div><div class="output_text output_subarea output_execute_result"><pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x340fb4e0&gt;</pre></div></div><div class="output_area"><div class="prompt"></div><div class="output_png output_subarea"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcgAAAEJCAYAAAAQFbf7AAAABHNCSVQICAgIfAhkiAAAAAlwSFlz
AAALEgAACxIB0t1+/AAAIABJREFUeJzt3Xm8XdPdx/HPN6EkYiihhiBpqoYMkoiZ1lCNtmpoqcQ8
Vc1DS0vxCC1FjCH0MSV4TC0Vam5JikorgwhBEEKDIjElxJDk9/yx14mdk3PvPefmnDvl+369zsvZ
a6+999r3tJa99t7fpYjAzMzMFtauuRtgZmbWErmDNDMzK8EdpJmZWQnuIM3MzEpwB2lmZlaCO0gz
M7MS3EGamZmV4A7SzMysBHeQZmZmJSzV3A2wxuvcuXN07dq1uZthZtZqjB8/fkZErFpOXXeQrVjX
rl0ZN25cczfDzKzVkPR6uXU9xGpmZlZCzTtISadJmixpkqSJkjaXNFrSlLQ8UdIdqe5gSSeV2Me8
XN2JkrqWqDNC0mu5Ok+m8oMkhaTv5erunsr2TMuF9jwj6Z+S1s+V9y9xrG0kPSXpxfQ5PJXvJGmM
JKXl9pKelrRVOrc3i85jJUnbSfoo1Zsi6TFJu1Tjb29mZo1X0yFWSVsCuwD9IuJzSZ2Br6XV+0ZE
ueODcyKiTxn1To6IO0qUPwsMBP6elgcBzxTV2TcixqXObgiwa6kDSFoduAXYPSImpHN6SNKbEXGf
pEOBQ4FrgWOBcRHxpKTvA5dExIVF+wN4PCJ2Sct9gJGS5kTEI/We7VtPw+AV661SkcEfVW9fZmat
XK2vINcAZkTE5wARMSMi3qrxMUt5HNhM0tKSOgHfAibWUfextL4uRwMjImICZOcE/Bo4Ja0/EThV
Ug/gGOA3lTQ0IiYCZ6dtzcysmdS6g3wYWFvSS5KulPTd3Lqbc0ONQxrYT4dc3bvqqTckV+/mXHmQ
XT0OAHYD7qlnHz8mu+KsSw9gfFHZuFRORLwNXAqMAX4fEe/n6p2Ya9+oeo4xAdignvVmZlZjNR1i
jYjZkjYBtgW2B26XVLjSasohVoDbgOOAFYFfAb8tWn+zpDnANLKh0cUxDDgvIkYUlS8yxFoH1bki
GwI+HKD9CqvS9bPhde5k2nk/KuNQZmZWSs1f84iIecBoYLSkZ4EDq7FfScOBvsBbEfHDMtrxlKRe
wKcR8VK695dXbof9PLAJcHeubBNgcu5Y8yVFGfuqS1/ghVIrIuJq4GqAZdZYb3GOYWZm9aj1Qzrr
A/Mj4uVU1Ad4Hei5uPuOiIMbsdkpwGeLeehhwL8l/SUiJkpaBTif7L7hYpPUGzgDOKwa+zMzs8ap
9RVkJ+BySSsBc4FXyIYH7+CrIU3IHuQpvIZxuqQTCjuIiC4VHG+IpNNzy5vlV0bEA5WeAHCfpC/T
9zERsZek/YBrJC1PNhx6aUT8tYx9nZi2Ldg9/XNbSU8DHYF3geMafIIV6LXWiozzMKqZWU0owqN0
rVX//v3DSTpmZuWTND4iFnm/vRQn6ZiZmZXgDtLMzKwEd5BmZmYluIM0MzMrYYmd7krSPLLEnKWA
14D9I+LDFIT+AjAlV/1isoi5ZYCVgQ7Am2nd7mTvefaPiBmV7jcibpQ0DZiVytoDfyFL4an/lZRq
Z7GamVVLG8h2XmI7SHLpPJJuIOsAz0nrppZI7rkx1T2IrDNckJVaFDpQ6X4Ltk8dbCeyIID/pUqh
CmZmVjkPsWbGAGu1hP1GxGzgCGB3SSvXoE1mZlaGJb6DlNQe2JGFA8y7F83buG1T7jciPiYbnl2v
0uOamVl1LMlDrB0kTSS7wnsB+FtuXX1DoU2135KB5ZWElZuZNZtT7qvJbptyEoYl+QqycK9wXbLO
6OiWst8UYdcVeKl4XURcHRH9I6J/+45+QMfMrFaW5A4SgIj4lGwarF9JqtoVdWP3mx7SuRIYGREf
VKs9ZmZWmSV5iHWBiHha0iRgEPA46V5hrsr1ETG0xvsdpexx2HbAXcDvGtq/w8rNzGrHYeWtmMPK
zcwq47ByMzOzxeQO0szMrAR3kGZmZiW4gzQzMyuhxT7F2pjQ77RdH+Bp4AcR8WBuf7MjolM9xzsI
GMJXIeQA+wAvApcCOwABfAb8DLiNOsLLI2JacTskrQI8kuqsDswD3kvLmwFz0vkW3BYR59XzJ6p+
WHkbCBc2M6uWFttB0vjQ70HAE+mfD9ZRpy6350PI07EHAWsCvSNivqQuwCcRsXlafxBF4eWl2hER
M4HC+QwGZkfEhbnjzFmM9B4zM6uyltxB5o0BejdUKb1HuBewE/C4pGUbnDKqYWsAb0fEfICImN5M
7TAzsybU4jvIXOj3dbni4hfuj42Ix4GtgNciYqqk0cCPgDsrONzekrbJLW8J/Al4IgWLPwL8X0Q8
3cB+GtOODkXn9IeIuL24UjlZrE2ZVWhm1la15A6yMaHfg8juDZL+eQCVdZCLDLEC0yWtT3YPcgfg
EUl7RcQji26+WO0oa4g1Iq4mmy+SZdZYzykPZmY10pI7yDkR0UdSR+AhsnuQdca9pSvNnwK7STqN
LCh8FUnLR8SsxWlIRHwOPAA8IOkdYHe+euCmydphZmZNp8W/5lFB6PeOwKSIWDsiukbEumRXbXss
zvEl9ZO0Zvrejuxe6OtN3Q4zM2taLfkKcoFyQr+BvmQh33l3AkcCNwIdJeUfsLk4Ii4uql98D/Io
YAXgGknLpLKngCvqae6gBtpRl+J7kA9GxCn11HdYuZlZDTmsvBVzWLmZWWUcVm5mZraY3EGamZmV
4A7SzMyshFbZQUqaJ2mipOck/Tm9ClJc/ldJK+W26SHpUUlTJL0s6YyUeIOkgyS9l7adKKmQ6zpC
0mu58idT+Tck3SvpGUnPS7o/lbeTNDQd/1lJYyV1S+tWlHSjpFckTU3fV0zrukqak47xfFq3dNP+
Vc3MLK9VdpCkdyQjoifwBXBEifL3yd6dRFIH4B7gvIhYH9iYLO3mqNw+b0/b9omIA3LlJ+fKt0pl
ZwN/i4iNI2IjoPC06d58ldvai+zVjg/TuuuAVyPiWxHRnSyA/drccQrhB72ALmSB6PUrhJVXM7Dc
zMyA1ttB5j0OfKtE+RiyFB7IZuX4Z0Q8DAverTyGrzq2Sq0BLHhlJCIm5coXym2NiA8kfQvYBPhd
bh9nA/0ldc/vOCLmkb1KshZmZtZsWnUHmYIDfsDC00Tl81vvSUU9gPH5OhExFegkaYVUtHduKPXg
XNUhufKbU9kw4DpJoySdVggSIMtt/XGqe5Gkvql8I2Bi6vwKx58HTExty7d9WWBzKp+JxMzMqqhV
BAWUkH+p/nG+CjKvL7+1IaVyWCEbYr0jXxARD0n6JrAzWQf9tKSeEVEyt7XM4xfCD7oB9+WuShdS
Z1j5KfeVeZjGcQC6mS1pWusV5JzcfcFjI+KLfDmwLlkG6tGp/HmyIc4FUgc3OyI+bkwDIuL9iLgl
IvYHxgLfSeWfR8QDEXEycC5ZbuvzQJ8UVVc4fjuy+SGfT0WFe5DdgU0k7VrHca+OiP4R0b99R997
NDOrldbaQdarRH7rzcA2kr4HCx7aGQpc0Jj9S9oh9+Ts8mSd2ht15bZGxCvA08Dpud2cDkxI6/Jt
n0F2b/TUxrTNzMyqo7UOsTYon98aETdJ2g24XNIwoD1wE/VnqhYMkZTv2DYjuxq9QtJcsv/IuDYi
xkrambpzWw9Nx5+alsekslJGAoMlbZvmuSzJWaxmZrXjLNZWzFmsZmaVcRarmZnZYnIHaWZmVoI7
SDMzsxLcQZqZmZXQJjrISsPLi8LBC58D0rpDUtD4pLTdbql8hKQ90/fRKfR8kqQXJV1RFIw+r2jf
p+S2G5er1z+VDcjVnZ32vSA03czMml5bec2jEBBAioM7Ari4qPwGsuCAc9I2hRfzF5DUBTgN6BcR
H0nqBKxaxzH3jYhxkr4G/AG4G/hucXtKWE3SDyLigUJBRDwEPJTaMBo4KSIafjy1EFa+JBj8UXO3
wMyWMG3iCrJIOeHldVkNmAXMBoiI2RHxWn0bpBSfXwPrSNq4jPYNIeuEzcysBWtTHWQF4eWQsk9z
n22BZ4B3gNckDZf043KOm4LHnwE2SEUdiva9d676GOALSds36iTNzKxJtJUh1saEly8yxAqQ0nA2
JetQL5G0SUQMLqMNyn2vb4gV4PdkUXO/KWO/xe0rHVZeZQ4nN7MlXVu5gqw0vLxOkXkqIv4ADAR+
2tA26Qq1F1kn3KCIeBToAGxRTv2ibR1WbmbWBNpKB1mvEuHlJUlaU1K/XFEf4PX69i1pabKHdP5T
1xRVdfg92b1LMzNrgdrKEGuD8uHlZMOw3XPDsgDXkz2JemGakeMz4D2yJ2JLuVnS58AywN+B3XLr
OhTt+8GIOKWoPfdLem9xzslh5WZmteOw8lbMYeVmZpVxWLmZmdlicgdpZmZWQkX3INPTmt/IbxcR
b1S7UWZmZs2t7A5S0rHAmWQv0s9PxQH0rkG7zMzMmlUlQ6zHA+tHRI+I6JU+La5zrCe4fHZRvYNS
yPhOksZIUipvL+lpSVtJWj+FiU+U9IKkq1Od7STdm9vXDySNk/R82vaiVD5Y0km5ektJek/SeUVt
KRliXoM/j5mZlamSIdb/AK0hMbqu4PKSIuJvkg4FDgWuBY4FxkXEk5IeAi6JiLvT/noVby+pJ3AF
8KOIeDENQx9ex+F2Al4C9pJ0aiz8CPEiIeYNao1h5Q4dN7NWopIO8lVgtKT7gM8LhRFRZ+fTAjxO
eUPAJwJPSBoDHANslsrXAKYXKkXEsyW2/TVwTkS8mOrMA66q4ziDgMuAI4EtgSdz6woh5uV3kGZm
VjOVDLG+QZZl+jVg+dynRSoRXL5QgDhwdqFuRLwNXEoWJP77iHg/rboEeFTSA5JOzM/5mNMTGF9G
e5YFvgf8FbiVrLPMc4i5mVkLUvYVZEScBZDmSCQiZte/RbOpK7h8oQBxSQcB+ZdFhwHnRcSIQkFE
DE/DrDuTJeX8oswprUrZBRgVEXMk3QmcIemEdMVZ0GCIeVOFldfMKfcBDkM3s5av7CtIST0lPQ1M
BiZLGi+pR+2a1mh1BZfXKyLmkz2VW1z+VkRcHxG7AXPJrhjzJgOblHGIQcD3JE0ju+JcBdih6FgN
hpg7rNzMrGlUMsR6NfDLiFg3ItYFfgVcU5tmtQySdk5h5EhanaxTe7Oo2hDgt5K+neq1k3RE0X5W
ALYF1omIrhHRlWxmkeJhVnCIuZlZi1DJQzrLRcSowkJEjJa0XA3a1JJ8H7hM0mdp+eSI+K+kwsTI
RMQkSScAt6ZXSgK4t2g/ewCPRsTnubK7gQskLZOvWEmIucPKzcxqp+ywckl3AROAm1LRfsAmEbFH
jdpmDXBYuZlZZWoVVn4IsCrwl/RZNZWZmZm1OZU8xfoB2aTDZmZmbV6DHaSkSyPiBEl/pfRTnrvW
pGVmZmbNqJwryMI9xwtr2RAzM7OWpMEOMiIKKTF9IuKy/DpJxwP/qEXDmoOkLmSBARuR3Z+9FzgZ
+DdwcERMTAk9HwJHRMT/pe3GAz8ni7W7nuxvNSmtew7YJSKmpXcgZwGFcIDHIuI4SSOA75Jl3Yrs
dZpHGmxwc2WxOk/VzJYAlTykc2CJsoOq1I5ml2bz+AswMiLWA74NdALOAf4JbJWqbkwWOL5V2m45
oDvwTFo/nSxTtS7b54IM8vd0T05JPycAf6zOWZmZWWM12EFKGpTuP3aTdE/uMwp4v6HtW5EdgM8i
YjgsCB0/kexJ3Sf5qoPciqwDK8TWbQaMz0XG3Qv0kLR+I9sxBlirkduamVmVlHMP8kngbaAzcFGu
fBYwqRaNaiY9KAodj4iPJb1Blp6T7yDPAgZJWj4t52flmA9cAPyW0lfdoyQVOtMbIuKSovU7AyPr
auTiZLE6/9TMrHzl3IN8HXidbHqmJdUHwNdS3NwGwBRgLLA5WQd5eVH9W4DTJHUrsa/tI2JGifIh
ks4FulDP3zoiriaL/WOZNdYrL+XBzMwqVklY+RaSxkqaLekLSfMkfVzLxjWx5ykKHU8ZqusAr5Bd
Je4FvJ0mOv4XsDXZEOuY/HYRMZfsarvOWTlKODkivp22ub6R52BmZlVSyUM6V5CFa79MNuPEYWRP
fLYVjwAdJR0AIKk9WSc3IiI+JesgT+CrznAMcADw34go9VjnCLL5H1etsB1XAO0kDaj4DMzMrGoq
CSsnIl6R1D49kDI8TX91am2a1rQiIiTtAVwp6Qyy/3i4n+xeImRPsl5C6iAj4u3UiT5Zx/6+kDQU
uKxoVf4e5KSIOKBEOwozejxUX5sdVm5mVjuVhJU/RnZFdC3wX7IHdw6KiMZOIGyLyWHlZmaVqVVY
+f6p/jHAJ8DawE8rb56ZmVnLV0lY+euSvgZ0JXuhfkpEfFGrhpmZmTWnsjtIST8ie0F+KlkcWjdJ
v4iIB2rVODMzs+ZSyUM6F5G9w/cKgKTuwH2AO0gzM2tzKukgZxU6x+RVsjSdikgK4OKI+FVaPgno
FBGD0/LhwC9T9Y/JgrufkHQX0I0sH3VV4LVU56iIeDK3/xF8Ffw9Hzg6IsbUFwieho4vAHYhm9Lr
+bTd9BSpd15EPJQ7xgnA+sD5wL0R0VPSdsDd6e/SEXgHuCAi7k3bDCYLNH8v9+fYjiyyrs7t6tVc
YeVm1rJ4AoGaqKSDHCfpfuBPZJ3IXsBYST8BiIi/lLmfz4GfSPpDcaKMpF2AXwDbRMQMSf2AkZI2
i4g9Up3tgJMiYpd6jnFyRNwh6fvA/5LNspEv354sjWa9VH4usDywfkTMk3Qw8BdJmwO3AgNZ+JWL
gWSvYRR7vNAuSX1S2+fkZua4JCIWmjYsy0hvcDszM2tilTzFuizZ1c13ya583iMLDPgx2ZVXueaS
dU4nllj3G7JObAZAREwAbgCOrmD/eY8B3ypRviAQXFJH4GDgxELgeAos/5wswPwO4EfpKhNJXYE1
gcfrO3BETATOJnvqt2yN3c7MzKqrkqdYD67icYcBkyRdUFS+SGA4MI7Sod/l+DHwbInyfCD4t4A3
IqI4Nm8c0CMiHpH0FPADsqHQgcCf0gv9DR1/Atl8kgUnStovff8gIrYvc7sFFiesvC1w4LqZNZVK
nmIdTja0upCIOKTSg6ZZMm4EjgPmVLp9GYZIOp3sKvfQovIGA8FLKAyzFjrIQ+uvvkBxD7rIEGuZ
2y3gsHIzs6ZRyRDrvWRPrd5Hllu6AjB7MY59KVlHs1yubJHA8LQ8ucJ9n5wmJN4pIp4rKi8OBJ8K
rJOmrqrruHcDO6Z7oh0jovgqty59gRcqbPvibGdmZlVSyRDrnfllSbcCTzT2wBHxvqQ/kXWShc7q
AuB8STtHxMz0wMpBZNNKVdMVwCGSBkTEQ5JuAC6WdER6SOcAsidKH01tnZ2eZr2e7GqyQZJ6A2eQ
hbqXrZLtnMVqZlY7FYWVF1kPWG0xj38RuYdRIuIeSWsBT6bXQWYB+0XE24t5nIWUCAQ/FbgQeEnS
fOBFYI9YOKj2VuAusiHWumybAtw7Au8CxxU9iZq/Bwmwe5nbmZlZE6skrHwWC9+D/C9wavGVpTUd
h5WbmVWmkrDySoZYi+/RmZmZtVllP6QjaQ9JK+aWV5K0e33bmJmZtVaVPMV6ZkQsyDOKiA+BM6vf
JDMzs+ZXSQdZqu7iPORTU5JC0v/llpeS9J6ke4vqjZT0r6KywZI+lbRarmx2UZ3d0zE2KCpfT9K9
kqZKGi9plKTvpHUHpTZMzH02ktRV0py0/LykGyUtXc2/h5mZVabSLNaLyVJwIIt/K/d9wObwCdBT
UoeImAPsBLyZryBpJbL3HWdL+mZEvJpbPQP4Fdk7k6UMInvNZRDpSlrSsmTviZ4UEfeksp5Af7LY
O4DbI2KhGLkUXzc1IvpIag/8DfgZcHO9Z1itsHIHHZuZLaKSK8hjgS+A24HbgM9ofEZqU7kfKLwo
OIhF32H8CfBXsvMpfn3jemBvSSsX71RSJ2Absnc489vtC4wpdI4AEfFcRIwot8EpD/YpUlasmZk1
j7I7yIj4JCJOiYj+EbFpRPw2Ij6pZeOq4DZgYLqy6w38u2h9odO8NX3Pm03WSR5fYr+7AQ9GxEvA
TEmF9J8eZDmq9dm7aIi1Q35lauvmwIMN7MfMzGqokizWvwF7pYdzkPR14LaIGFCrxi2uiJiUhi8H
kV1NLiDpG2RhB0+k4IAvJfUsiqYbCkyUVJyfOgi4LH2/LS0vMtyc5rBcD3gpIn6SiksNsQJ0lzSR
bM7L+yJiUqlzqjSs3OHeZmaNU8kQa+dC5wgQER+w+Ek6TeEespSc4uHVnwFfB16TNA3oStFVZDrf
W8gNJach1x2Aa9N2JwM/U9bLTQb65bbfgywqb5Fh2hKmRkQfoDuwiaRdS1WKiKvTVXz/9h09WbKZ
Wa1U0kHOl7ROYUHSupSY3aMFuh44KyKKp70aBOwcEV0joivZwzqlYuQuJpvEuXC1vSdwU0Ssm7Zd
G3gN2JasM926qHPrWElj01yYp5DF35mZWTOp5CnW04AnJP2DbDqmbUlDfS1ZREwnGypdIA27rgv8
K1fvNUkfSdq8aPsZaai0MMHzIOD8osPcCQyKiMck7UIWfH4p2QTTs4Df5+ruLWmb3PJRwFtF+xsJ
DJa0bUTUOTGzw8rNzGqn7CxWAEmdgS3S4r/S1Y41E2exmplVpiZZrMlWwHdyy/fWVdHMzKw1qySL
9TyyVx6eT5/jJZ1bq4aZmZk1p0quIH8I9ImI+QBpkuGngd/WomFmZmbNqZKnWAFWyn33OwZmZtZm
VdJB/gF4WtKIdPU4HjinNs1qGsUB5EXrJkq6Lbe8cXqRv7A8KAWML52We0maJOkcSefn6q0r6dU0
PdhoSVNyKTp3pDqDJb2ZCysvTvUxM7MmVsmEybdKGg1smop+ExH/LayX1CMiJle5fc1C0oZAe2Bb
SculSL1ngXUkLR8Rs8geWHoB6EuWnboV8CTZKx0TJY2IiBfIEnfOiIgPU2LOvhFR6tHTSyLiQknr
AeMl3RERX9bb0FJh5Q4eNzOrioqGWCPi7Yi4J33+W7T6piq2q7kNIjufh8lyV0n3XseR5aRCFiww
jKxjJP3zn2nmkBOBYZJ+CCwfEfXPypETES8Dn5Kl/JiZWTOp9B5kfVTFfTW3vckyVotDzP8JbCVp
OWA+MJqFO8gnASLifuAD4AayIIC8m3NDrEOKDyypH/ByRLxbvdMxM7NKVXPC49YQO9cgSf2BGRHx
hqQ3geslrRwR75N1gL8CHgfGRsRUSd+StCrQKSKm5nY1DOgQEVOKDlHXEOuJkg4Gvg38uJ721R9W
fsp9lZxuzTgk3cxau2peQbYVg4ANUhD5VGAF4Kdp3b/I7sFuDYxJZdPJMlzHLLwb5qdPuS6JiB7p
WNelaa8W4bByM7OmUVYHqczaDVT7ogrtaVaS2pHN8tErF2K+G2mYNT2c8x/gYL7qEMcAJ5ANvy62
NNnyOODAauzPzMwap6wh1jRf4v1Ar3rqbFHXuhaso6TpueVrgDcjIh8e/hiwkaQ1IuJtso5wt4j4
T1o/BjiXdP+xDDdLmpO+z4iI75WoczZwi6RrCsEMpTis3MysdsoOK0/vPl4REWNr2yQrl8PKzcwq
U6uw8s2BfSW9DnxC9tRqRETvRrTRzMysRaukgxxQs1aYmZm1MJUk6bye3tHbhuyVjn9GxISatczM
zKwZVTLd1f+Qvfi+CtAZGC7p9Fo1zMzMrDlV8pDOFGDjiPgsLXcAJkbE+jVsX6NJmh0RnSR1BV4D
jouIy9O6K8hepQhg54gYlNuuM1nGahfgIWANoPDU6SsRsaek9YH/JZvdZBmy4IA7gUJI+beAN9N2
kyLiAEnbABeTvVcJcHFEXJ2OORj4OfAe8DXgdxFxa0Pn2H/N9jHu8E4V/mWqwHmvZtZK1eohnbeA
ZYHP0vIyZJ1Aa/Au2QTP/xsR+fc17wIuktQxIj5NZXsCf42Iz+sJFx9K9mL/3ZDN5BERz5J1qKRQ
95MK20laHbgF2D0iJqRO+CFJb0ZEIfqm8rByMzOrmQaHWCVdLmko8BEwOU13NRx4Dviw1g2skveA
Ryh6+T4iPgb+wcLRbgPJMljrswZZgk5hP882UP9oYEThnm1EzAB+DZxSXNFh5WZmLUM5V5CFq6fx
ZFdcBaNpXfmr5wMPSLq+qPxWYF/gdklrkmWhPppbn3+x/28RcTJwCfCopCfJZvwYHhH1/cdCD7L7
t3njUvlCHFZuZtYyNNhBRsQNAJKOj4jL8uskHV+rhlVbRLwq6d/APkWr7gOulLQCWczcnRExL7d+
kSHWiBgu6SFgZ7Ioul9I2jgiPl+MJlYnrLwODg83M6tMJWHlpbJBD6pSO5rKucBvyE3NleZvfBDY
g/KGVwvbvRUR10fEbsBcoGc91Z8nmz8ybxMgP8G0w8rNzFqQcu5BDpL0V6CbpHtyn1HA+7VvYvVE
xItknVXxFdqtwC+Bb7DorByLkLSzpKXT99XJXn2p74GlYcBBkvqkbVYhG/K9oEQbHVZuZtYClHMP
8kngbbJ3Hy/Klc8CJtWiUTV2DvB0UdnfgBuB62LR915KhYt/H7hMUuGJ3pMj4r91HTAi3pa0H3CN
pOXJrmAvjYi/1rGJw8rNzJpZ2e9BWsvjsHIzs8pU8h5kJUk6P5H0sqSPJH0saZakjxvfTDMzs5ar
kqCAC4AfR8QLtWqMmZlZS1HJU6zvuHM0M7MlRSVXkOMk3Q6MBBa87xcRf6l6q8zMzJpZJR3kCmQR
aN/PlQVQsw6yEDieWz4I6B8Rx6Tlw8lezwD4GPhlRDyR1o0GvgmsW3gyVdJI4Hu5EPMXgCm5Q14c
ETdKmgb8JyK2zR17IrBURPTMlV0K7AWsXXjaNN9GSe2A4cA84FCy0PRZaRngsYg4TtII4LtkcX5K
5/FIg3+gt56GwX4X0loBB9xbK1TJfJAH17IhlZK0C/ALYJuImJEi2kZK2iz3ysWHwNbAE5JWIstQ
zZsaEX3qOMTyktaOiP9I2rDE8duRhQv8h6xzG1W0XsAfgaWBgyMiUvj59imLtdjJEXGHpO2Bq4H1
GvwjmJlfpOYeAAAbX0lEQVRZzVTyFGsXSXdJejd97pTUpZaNa8BvyDqVGQApCPwGsmDwgtvI0nEA
fkJlV7t/AvZO3wexaMLOdmRJOFel9cWGkgUIHFDfu4wljAHWqqC+mZnVQCVDrMPJpmzaKy3vl8p2
qnajcjqkoc2ClYF70vceZAHqecUJNI+QvZzfnqyjPBw4I7e+e9H+j42Ix9P3O8nO70Ky5J19gf1z
dQud5t3AuZKWzk1PtQ/Z8O12ETG3qI2jJBWGWG+IiEuK1u9Mdp+3pMZmsbYWzow1s5aikg5y1YjI
/9t4hKQTqt2gInPyQ6CF+3sVbD8PeIKsc+wQEdPSMGdBfUOsM4EPJA0k6+wK80Ui6WvAD8nuFc5K
IegDgHtTlQnABsBmwD+L9lvXEOsQSeeSTdS8ZV0nlCZZvhpgmTXWc8qDmVmNVPKax0xJ+0lqnz77
kXUizaWcAHDIhlmHkg2ZVup2shzV4uHVAcBKwLPpgZ5tWHiY9UWymUFul7TIlFZ1ODkivk02dFw8
JZeZmTWxSjrIQ8j+pf9fsmzWPWne2TwuAM5Pwd+kIPCDgCuL6j0O/IEyZ+koclc6zkNF5YOAwyKi
a0R0BboBO0nqWKgQEU8CRwL3SlqngmNeAbSTNKAR7TUzsyqpZIj1bODAiPgAQNLKZPfnDqlFwxoS
EfdIWgt4UlKQvT6xX0S8XVQvyNpZSvE9yOsjYmhu21lks25QGJpNneDOwBG5ep9IeoKiWUIi4q+S
OgMPSiq8MpK/BzkpIg4obq+k3wO/ZtGOeSEOKzczq52yw8olPR0RfRsqs6bjsHIzs8rUJKycbNjv
67mDrExlV6BmZmatRiUd3EXAGEl/Tst7kc2taGZm1uZUkqRzo6RxwA6p6CcR8XxtmmVmZta8Khoi
TR2iO0UzM2vz2sQ9xPRU6LO5otuAIcBTwIkR8Viq9zBwTUT8Ob2/uEhweKp3EnAY8BnwJXB5LsS8
f+FFf0nbASeRpe4cn/azEVkA+jzgQbJ3IvsDfwbOi4gFIQCSlgLeBPoC5/JVYDnApxGxVb0n3tbC
yh1obWYtSJvoIClK3CmQdBRZ1NwmZO9tzo+IP+eqLJJqI+kIsvi8zSLiY0krkIWS1yklDA1P20/L
7zel/0D2PmYXSetGxOup7HvA5Ih4K71GcnJE3FHBeZuZWY1U8hRrqxMR/yYL/x5MdoV2TBmb/RY4
MiI+Tvv4OCJuqEJb5pOl+QzMFQ+kcQEGZmZWY23lCrI41PwPEXF7+n4q2ZRUl0bEK0XbLRQcDlwH
LB8Rr9aonbcC15AlAC1DynPNrR8i6fT0fXJE7Fu8g2qHlTsc3MystLbSQZYcYk2+Q3Zfr2eJdQsN
sabh1PqUSlUoOzA8IsZJ6iRpfWBD4N8R8X6uSoNDrA4rNzNrGm16iFXScmRZqjsAq0n6YX3107Dq
bEnfrKPKTODrueWVgVIzc9TnVrKhVQ+vmpm1YG3lCrIu/wP8KSJeTA/s3Cbp0Yj4rJ5t/gAMk7R3
ekinE9k7nzcCo8nmhPyfNMfkftQzd2MdbiWb03JF4NAKt12Is1jNzGqnrXSQxfcgHwRuInv6dGOA
iHha0kNk00mdleqVCg6/CugEjJX0JdlrHhelOr8DrpL0DKB0nP+rpKER8YKkT4DxEfFJ0er8PUjI
nqT9opL9m5lZdZQdVm4tj8PKzVqfL7/8kunTp/PZZ/UNZNniWnbZZenSpQtLL730QuWVhJW3lStI
M7NWYfr06Sy//PJ07dp1wTR6Vl0RwcyZM5k+fTrdunVr9H7a9EM6ZmYtzWeffcYqq6zizrGGJLHK
Kqss9lW6O0gzsybmzrH2qvE3bpMdpKR5kibmPqek8tFpRpJCvf6SRueWN0t1XpY0QdJ9knqldYNT
RiuSRkh6M73sj6TOKWIOSV0lzSk6/gFp3TRJz+bKh+b291oqe0bSjk3zlzIzq9zIkSN5/vm2P29F
W70HWV9wwGqSfhARD+QLJX2DLApun4h4MpVtA3Rn4SD0gnnAIWRPvRabWs/xF8l/TU6OiDskbU8W
BLBeHdt/pZZh5Q4ON7MS5s6dy8iRI9lll13YaKONmrs5NdUmryAbMAQ4rUT5McANhc4RICKeiIi6
3nO8FDgxzchRTWOAtaq8TzOzBaZNm8YGG2zAvvvuy4Ybbsiee+7Jp59+ytlnn82mm25Kz549Ofzw
wym85bDddttxwgkn0L9/f84//3zuueceTj75ZPr06cPUqVPp16/fgn2//PLLCy23Zm21g+xQNMS5
d27dGOCLdKWW1wOYUMEx3gCeIAsOKNa96Pjb5taNypWfWGLbnak8fMDMrCJTpkzhqKOO4oUXXmCF
FVbgyiuv5JhjjmHs2LE899xzzJkzh3vvvXdB/S+++IJx48Zx2mmnseuuuzJkyBAmTpxI9+7dWXHF
FZk4MXsVffjw4Rx88MHNdVpVtSQOsQL8HjidLDSgJEn/BlYAHo6I4+uo9gfgbuC+ovLGDLEOkXQu
0AXYssT6QrsaHVbuYHIzK1h77bXZeuutAdhvv/0YOnQo3bp144ILLuDTTz/l/fffp0ePHvz4xz8G
YO+9965zX4cddhjDhw/n4osv5vbbb+epp55qknOotbZ6BVmviHgU6ABskSueDPTL1dkcOIMsEq6u
/bwMTAR+VoVmnRwR3ybrtK+v55hXR0T/iOjfvmMbmizZzJpU8VOekjjqqKO44447ePbZZ/n5z3++
0GsSyy23XJ37+ulPf8oDDzzAvffeyyabbMIqq6xSs3Y3pSWyg0x+D/w6tzwMOEjSVrmyjmXs5xzg
pCq26wqgnaQBVdynmdlC3njjDcaMGQPALbfcwjbbbANA586dmT17NnfcUffEQssvvzyzZs1asLzs
sssyYMAAjjzyyDYzvAptd4h1kWzWiDglXyEi7pf0Xm75v+le5fmS1gLeJZup4+z6DhQRkyVNIHf1
SboHmVu+PiKGpu+l8l/z+wtJhc77ofqO7bByM2us9ddfn2HDhnHIIYew0UYbceSRR/LBBx/Qs2dP
Vl99dTbddNM6tx04cCA///nPGTp0KHfccQfdu3dn33335a677uL73/9+E55FbTmLtRVzFqtZ6/PC
Cy+w4YYbNmsbpk2bxi677MJzzz1XtX1eeOGFfPTRR/zud7+r2j4XV6m/tbNYzcysyeyxxx5MnTqV
Rx99tLmbUlXuIM3MljBdu3at6tXjXXfdVbV9tSRL8kM6ZmZmdXIHaWZmVkKL7CAlrS7pNklTJY2X
dL+kb0vqIelRSVNSoPgZSi/zSDpI0nxJvXP7eU5S1/T9kBQUPimV75bKR0vqn9umq6Tn0vftJN1b
1LZ7UgrOK5I+yqXibJ7Wf0PSXEmHFW03XdLtueWBkq6VdFhuH1/kwszPqfbf1czMytfi7kGmDu8u
slzUgalsY+AbwAjgyIh4WFJH4E7gKLJ3GAGmk+Ws7l20zy6pvF9EfCSpE7BqY9oXEbumfX4POCYi
di+q8jOyOLtBwLVF6zaXtH5ETMnt79pCPUnTgW0j4sOyGlPLsPJyONDczNqwlngFuT3wZUT8sVAQ
Ec8A3wb+GREPp7JPyQLG8+833gv0kLR+0T5XA2YBs9O2syPitRq1fxBwAvBNSWsUrbsI+G2Njmtm
Vpb27dvTp08fevTowcYbb8xFF13E/Pnzm7tZ9br00kv59NNPm/SYLe4KEugJjC9R3qO4PCKmSuok
aYVUNB+4gKwTOjBX9RngHeA1SY8Af4mIv1a74Wk4d+WIGC/pz2RXk5flqtwKHCOpW7WPbWatU9dT
iqOcF085mcsdOnRYEC7+7rvvss8++/Dxxx9z1llnVbUtlYgIIoJ27Upft1166aXst99+dOxYTsBZ
dbTEDnJx3QKclu+EImKepJ2BTYEdgUskbRIRg4FSSQmNTU8YCBTuM94GXMnCHeRcsqvIU4BRjTnA
4oSVV5ODz83ahtVWW42rr76aTTfdlMGDBzN//nxOOeUURo8ezeeff87RRx/NL37xC0aPHs2ZZ57J
SiutxLPPPsvPfvYzevXqxWWXXcacOXMYOXIk3bt3Z9q0aRxyyCHMmDGDVVddleHDh7POOuvwzjvv
cMQRR/Dqq68CcNVVV7HmmmsyYMAANt98c8aPH8/999/Peeedx9ixY5kzZw577rknZ511FkOHDuWt
t95i++23p3Pnzowa1ah/fVasJQ6xTgY2KVH+fHG5pG8CsyPi40JZRBQ6oYVm6ojMUxHxB7KO7Kdp
1Uzg67mqK5NFzDXGIOAwSdOAvwD9UhvzRpB10o2a89Fh5WZWbd/85jeZN28e7777Ltdddx0rrrgi
Y8eOZezYsVxzzTW89lp2R+qZZ57hj3/8Iy+88AI33XQTL730Ek899RSHHXYYl19+OQDHHnssBx54
IJMmTWLffffluOOOA+C4447ju9/9Ls888wwTJkygR48eQDZ/5FFHHcXkyZNZd911Oeeccxg3bhyT
Jk3iH//4B5MmTeK4445jzTXXZNSoUU3WOULL7CAfBZZJV0oApCdTpwDbpIdjkNQBGEo2pFpsBPA9
0oM4ktaUlM9K7QO8nr6PBvYrPA1LNjRb8S8gaSNgqYhYKyK6RkRXssmZB+brRcQXqd11TaFlZtZs
Hn74YW688Ub69OnD5ptvzsyZM3n55ZcB2HTTTVljjTVYZpll6N69+4Lc1V69ejFt2jQAxowZwz77
7APA/vvvzxNPPAHAo48+ypFHHglk90BXXDH7D/x1112XLbb4amKlP/3pT/Tr14++ffsyefJknn/+
+SY571Ja3BBrCuveA7hU0m+Az4BpZA++7AZcLmkY0B64iWz2i+J9fCFpKF8Nby4NXChpzbS/94Aj
0rqrgQ2AZyQFMA44Nbe7HdPTpQV7RcSYEk0fRPb0bd6dwA3AuUXl11CFh3UcVm5m1fDqq6/Svn17
VlttNSKCyy+/nAEDFp5QaPTo0SyzzDILltu1a7dguV27dsydO7dRx85Po/Xaa69x4YUXMnbsWL7+
9a9z0EEHLTTlVlNrcR0kQES8Rd1zLG5XxzYjyK4cC8tDya7UCnaoY7svyJ6GLbVuNNm8kaXW/R34
e275jBJ1JgC90vcuufI5wOol6ncpLjMzq6X33nuPI444gmOOOQZJDBgwgKuuuooddtiBpZdempde
eom11ir/jtBWW23Fbbfdxv7778/NN9/MtttuC8COO+7IVVddxQknnMC8efOYPXv2Itt+/PHHLLfc
cqy44oq88847PPDAA2y33XbAV1Nsde7cuSrnXY4W2UGamVntzJkzhz59+vDll1+y1FJLsf/++/PL
X/4SgMMOO4xp06bRr18/IoJVV12VkSNHlr3vyy+/nIMPPpghQ4YseEgH4LLLLuPwww/nuuuuo337
9lx11VWsscbCb8JtvPHG9O3blw022IC1116brbfeesG6ww8/nJ133nnBvcim4OmuWjFPd2XW+rSE
6a6WFIs73VVLfEjHzMys2bmDNDMzK8H3IKtM0urApWShBB+SJficQJbmMyVX9eKIuFHSisDlwFaA
gH8Cx0ZEw0GnzZ3FWgvOdzWzFsIdZBU1ELQ+NSL6lNjsOuC5iDgg1T+LLLx8r6ZptZmZleIOsrpK
Bq0XptwqJulbZOlA+dlHzgZekdQ9IqbWsK1mZlYPd5DVVVfQOkB3SRNzy8eSRdxNjIh5hcKUGzuR
LJzdHaSZWTNxB9l0FhlilbRrpTtpjrByB5ObtS3t27enV69ezJ07l27dunHTTTex0korVfUYgwcP
plOnTpx00kkLlU+bNo1ddtmF5557jnHjxnHjjTcydOjQOvbSvNxBVtdkYM8K6j8P9JHULiLmA0hq
R5YVWzKAMCKuJovHY5k11vNLrGatXbUftCvjQbf8dFcHHnggw4YN47TTTqtuO8rQv39/+vcv65XE
ZuHXPKqrrqD1tUtVjohXgKeB03PFpwMT0jozs5racsstefPNNxcsDxkyhE033ZTevXtz5plnAtlV
3wYbbMC+++7LhhtuyJ577rlg8uKuXbsyY0Y2AdK4ceMWRMNBNvvHlltuyXrrrcc111yzyLFHjx7N
LrvsAsDs2bM5+OCD6dWrF7179+bOO+8E4Mgjj6R///706NFjQXsKxz3zzDPp168fvXr14sUXX6zu
HwZfQVZVA0Hrxfcgr095sYeSBbAX7jeOSWUNcli5mS2OefPm8cgjj3Doodm/ch5++GFefvllnnrq
KSKCXXfdlccee4x11lmHKVOmcN1117H11ltzyCGHcOWVVy4yfFps0qRJ/Otf/+KTTz6hb9++/OhH
df/76ne/+x0rrrgizz77LAAffPABAOeccw4rr7wy8+bNY8cdd2TSpEn07t0bgM6dOzNhwgSuvPJK
LrzwQq699tpq/FkW8BVklUXEWxHxs4joHhE9IuJHEfFyRHSIiD65z9BU/4OI2C/V756+f9jc52Fm
bVchi3X11VfnnXfeYaeddgKyDvLhhx+mb9++9OvXjxdffHHBVFf5bNT99ttvwTRW9dltt93o0KED
nTt3Zvvtt+epp56qs+7f//53jj766AXLX/96Nk1vfdNf/eQnPwFgk002WTDdVjW5gzQzW8IU7kG+
/vrrRATDhg0DICI49dRTmThxIhMnTuSVV15ZcHX51ZS5LLS81FJLMX/+fIBFpqaqa5tyFaa/euSR
R5g0aRI/+tGPFjpGYbqt9u3bN3q6rfq4gzQzW0J17NiRoUOHctFFFzF37lwGDBjA9ddfv2Aqqjff
fJN3330XgDfeeIMxY7KpcG+55Ra22WYbILsXOH589nZb4b5hwd13381nn33GzJkzGT16NJtuummd
bdlpp50WdNSQDbGWmv6qKbmDNDNbgvXt25fevXtz66238v3vf5999tmHLbfckl69erHnnnsya9Ys
ANZff32GDRvGhhtuyAcffMCRRx4JwJlnnsnxxx9P//79ad++/UL77t27N9tvvz1bbLEFZ5xxBmuu
uWad7Tj99NP54IMP6NmzJxtvvDGjRo1aaPqrffbZZ6Hpr5qCp7tqxTzdlVnr0xqnu8q/u9iaLO50
V23uKVZJu5PloW4ILA3clFatA3yUPjOBVUqUz4iI70nqQRYgvhbZVfaNwO/TU6oHAUOAN4Flgf+N
iEvSsQcDvwa6RsS7qWx2RHRK3+cBz+aaexuwPLBURPwm1VkXGAX0a/BhnbYYVt4aOFDdbInQ5jpI
YBDwBDAoIs4ke+keSSOAeyPijnzl4nJJHYB7gCMj4mFJHYE7gaOAwgD57RFxjKRVgCmS7oiI/6R1
M4BfAb8p0bY5JdJ0OgATJY2IiBeAy4Az/CSrmbUUXbt2bXVXj9XQpu5BSuoEbEP2HuHARu5mH+Cf
EfEwQER8ChwDnFJcMSJmAq8Aa+SKrwf2lrRyOQeLiDnAicAwST8Elo+ImxvZdjMzq5K2dgW5G/Bg
RLwkaaakTSKirvDwuvSgKHA8IqZK6iRphXy5pHXIhlkn5Ypnk3WSxwNnsrAORWEBf4iI2yPifkmH
AjeQdfB1ao4sVityyn3N3YJGcaZuyxERFb/yYJWpxvM1beoKkmx49bb0/ba0XAt7S5pEdvV4ZUR8
VrR+KHCgpOWLyucUhQXcnls3DBgbEVOoR0RcHRH9I6J/+46+/2jW2iy77LLMnDmzKv8Ct9Iigpkz
Z7Lssssu1n7azBVkGtLcAeglKYD2QEg6OSr7X+LzwHeK9v1NYHZEfJz+q69wD7I/8LCkeyLiv4X6
EfGhpFuAoynf/PQxszasS5cuTJ8+nffee6+5m9KmLbvssnTp0mWx9tFmOkiyWTRuiohfFAok/QPY
Fnisgv3cDPxW0vci4u/pIZqhwAXFFSNinKSbyIZTTy1afTEwlrb1NzazxbT00kvTrVu35m6GlaEt
/ct7EHB+UdmdqbzsDjIi5kjajSxAfBjZlehNwBV1bHI+MEHSuUX7mSHpLrIHcAqK70E+GBGLPPxT
LoeVm5nVjoMCWjEHBZiZVaaSoIC29pCOmZlZVfgKshWTNAuo96nXNqwzWSjDksjnvmTyuVfHuhGx
ajkV29I9yCXRlHKHCtoaSeN87ksen7vPvSl5iNXMzKwEd5BmZmYluINs3a5u7gY0I5/7ksnnvmRq
lnP3QzpmZmYl+ArSzMysBHeQLZyknSVNkfSKpEVSd5QZmtZPktSvOdpZC2Wc+3aSPpI0MX3+pzna
WQuSrpf0rqSSk/C18d+9oXNvk7+7pLUljZL0vKTJko4vUadN/u5lnnvT/+4R4U8L/ZDF3E0Fvgl8
DXgG2Kiozg+BBwABWwD/bu52N+G5b0c22XWzt7cG5/8doB/wXB3r2+TvXua5t8nfnWxe2X7p+/LA
S0vQ/9/LOfcm/919BdmybQa8EhGvRsQXZFN47VZUZzfgxsj8C1hJ0hrFO2qFyjn3NisiHgPer6dK
W/3dyzn3Niki3o6ICen7LOAFYK2iam3ydy/z3JucO8iWbS3gP7nl6Sz6P5py6rRG5Z7XVmmo6QFJ
PZqmaS1CW/3dy9Wmf3dJXYG+wL+LVrX5372ec4cm/t2dpGOt2QRgnYiYLemHwEhgvWZuk9Vem/7d
JXUim4nohIj4uLnb05QaOPcm/919BdmyvQmsnVvuksoqrdMaNXheEfFxRMxO3+8HlpbUuema2Kza
6u/eoLb8u0tamqyDuDki/lKiSpv93Rs69+b43d1BtmxjgfUkdZP0NWAgcE9RnXuAA9LTbVsAH0XE
203d0Bpo8NwlrS5J6ftmZP97ntnkLW0ebfV3b1Bb/d3TOV0HvBARF9dRrU3+7uWce3P87h5ibcEi
Yq6kY4CHyJ7qvD4iJks6Iq3/I3A/2ZNtrwCfAgc3V3urqcxz3xM4UtJcYA4wMNLjbq2dpFvJntrr
LGk6cCawNLTt3x3KOve2+rtvDewPPKuvJlb/LbAOtPnfvZxzb/Lf3Uk6ZmZmJXiI1czMrAR3kGZm
ZiW4gzQzMyvBHaSZmVkJ7iDNzKxVaCjIvqjuJblg85ckfVjx8fwUq5mZtQaSvgPMJsuj7VnBdscC
fSPikEqO5ytIMzNrFUoF2UvqLulBSeMlPS5pgxKbDgJurfR4DgowM7PW7GrgiIh4WdLmwJXADoWV
ktYFugGPVrpjd5BmZtYqpXDzrYA/pxQ6gGWKqg0E7oiIeZXu3x2kmZm1Vu2ADyOiTz11BgJHN3bn
ZmZmrU6aEus1SXtBFnouaePC+nQ/8uvAmMbs3x2kmZm1CinIfgywvqTpkg4F9gUOlfQMMBnYLbfJ
QOC2xoaa+zUPMzOzEnwFaWZmVoI7SDMzsxLcQZqZmZXgDtLMzKwEd5BmZmYluIM0MzMrwR2kmZlZ
Ce4gzczMSvh/pN/1YIm2SP8AAAAASUVORK5CYII="></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[373]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">get_top_amounts</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">totals</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">key</span><span class="p">)[</span><span class="s1">&#39;contb_receipt_amt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># Order totals by key in descending order</span>
    <span class="k">return</span> <span class="n">totals</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()[</span><span class="o">-</span><span class="n">n</span><span class="p">:]</span>
</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[374]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">fec_mrbo</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;cand_nm&#39;</span><span class="p">)</span>
<span class="n">grouped</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_top_amounts</span><span class="p">,</span> <span class="s1">&#39;contbr_occupation&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[374]:</div><div class="output_text output_subarea output_execute_result"><pre>cand_nm        contbr_occupation                     
Obama, Barack  CONSULTANT                                 2459912.71
               LAWYER                                     3160478.87
               PHYSICIAN                                  3735124.94
               HOMEMAKER                                  4248875.80
               INFORMATION REQUESTED                      4866973.96
               ATTORNEY                                  11141982.97
               RETIRED                                   25305116.38
Romney, Mitt   C.E.O.                                     1968386.11
               EXECUTIVE                                  2300947.03
               PRESIDENT                                  2491244.89
               ATTORNEY                                   5364718.82
               HOMEMAKER                                  8147446.22
               INFORMATION REQUESTED PER BEST EFFORTS    11396894.84
               RETIRED                                   11508473.59
Name: contb_receipt_amt, dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[375]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">grouped</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_top_amounts</span><span class="p">,</span> <span class="s1">&#39;contbr_employer&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[375]:</div><div class="output_text output_subarea output_execute_result"><pre>cand_nm        contbr_employer                       
Obama, Barack  MICROSOFT                                   215585.36
               VOLUNTEER                                   257104.00
               STUDENT                                     318831.45
               SELF EMPLOYED                               469290.00
               SELF                                       1076531.20
               HOMEMAKER                                  2605408.54
               INFORMATION REQUESTED                      5053480.37
               NOT EMPLOYED                               8586308.70
               SELF-EMPLOYED                             17080985.96
               RETIRED                                   22694358.85
Romney, Mitt   H.I.G. CAPITAL                              139500.00
               BARCLAYS CAPITAL                            162750.00
               GOLDMAN SACH &amp; CO.                          238250.00
               MORGAN STANLEY                              267266.00
               CREDIT SUISSE                               281150.00
               STUDENT                                     496490.94
               SELF-EMPLOYED                              7409860.98
               HOMEMAKER                                  8147196.22
               RETIRED                                   11506225.71
               INFORMATION REQUESTED PER BEST EFFORTS    12059527.24
Name: contb_receipt_amt, dtype: float64</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="&#26681;&#25454;&#20986;&#36164;&#39069;&#20998;&#32452;">&#26681;&#25454;&#20986;&#36164;&#39069;&#20998;&#32452;<a class="anchor-link" href="#&#26681;&#25454;&#20986;&#36164;&#39069;&#20998;&#32452;">&#182;</a></h3></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>不出意外果然要用到桶</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[376]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">])</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">fec_mrbo</span><span class="o">.</span><span class="n">contb_receipt_amt</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
<span class="n">labels</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[376]:</div><div class="output_text output_subarea output_execute_result"><pre>411      (10, 100]
412    (100, 1000]
413    (100, 1000]
414      (10, 100]
415      (10, 100]
416      (10, 100]
417    (100, 1000]
418      (10, 100]
419    (100, 1000]
420      (10, 100]
Name: contb_receipt_amt, dtype: category
Categories (8, object): [(0, 1] &lt; (1, 10] &lt; (10, 100] &lt; (100, 1000] &lt; (1000, 10000] &lt; (10000, 100000] &lt; (100000, 1000000] &lt; (1000000, 10000000]]</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[377]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">fec_mrbo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cand_nm&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="p">])</span>
<span class="n">grouped</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[377]:</div><div class="output_text output_subarea output_execute_result"><pre>cand_nm              Obama, Barack  Romney, Mitt
contb_receipt_amt                               
(0, 1]                       493.0          77.0
(1, 10]                    40070.0        3681.0
(10, 100]                 372280.0       31853.0
(100, 1000]               153991.0       43357.0
(1000, 10000]              22284.0       26186.0
(10000, 100000]                2.0           1.0
(100000, 1000000]              3.0           NaN
(1000000, 10000000]            4.0           NaN</pre></div></div></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[356]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">bucket_sums</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">contb_receipt_amt</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">bucket_sums</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[356]:</div><div class="output_text output_subarea output_execute_result"><pre>cand_nm              Obama, Barack  Romney, Mitt
contb_receipt_amt                               
(0, 1]                      318.24         77.00
(1, 10]                  337267.62      29819.66
(10, 100]              20288981.41    1987783.76
(100, 1000]            54798531.46   22363381.69
(1000, 10000]          51753705.67   63942145.42
(10000, 100000]           59100.00      12700.00
(100000, 1000000]       1490683.08           NaN
(1000000, 10000000]     7148839.76           NaN</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>计算比例</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[357]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">normed_sums</span> <span class="o">=</span> <span class="n">bucket_sums</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">bucket_sums</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">normed_sums</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[357]:</div><div class="output_text output_subarea output_execute_result"><pre>cand_nm              Obama, Barack  Romney, Mitt
contb_receipt_amt                               
(0, 1]                    0.805182      0.194818
(1, 10]                   0.918767      0.081233
(10, 100]                 0.910769      0.089231
(100, 1000]               0.710176      0.289824
(1000, 10000]             0.447326      0.552674
(10000, 100000]           0.823120      0.176880
(100000, 1000000]         1.000000           NaN
(1000000, 10000000]       1.000000           NaN</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p>画个图看看</p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[358]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">normed_sums</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">,</span> <span class="n">stacked</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[358]:</div><div class="output_text output_subarea output_execute_result"><pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x14c4db00&gt;</pre></div></div><div class="output_area"><div class="prompt"></div><div class="output_png output_subarea"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAcoAAAD8CAYAAAD3yOTYAAAABHNCSVQICAgIfAhkiAAAAAlwSFlz
AAALEgAACxIB0t1+/AAAIABJREFUeJzt3Xt8VNW5//HPQyRc5B6UpoACShUUi8pFqRaEIqAIKuoR
EbFYUamXavWIbY96tLVYarUo9dbSij8rogcR0CqXAmoFISIiSJWLERIpyC1cEpAkz++P2YlDTCYz
MJOZJN/365VXZq+99trPSnjlYe299trm7oiIiEj56iQ7ABERkVSmRCkiIhKBEqWIiEgESpQiIiIR
KFGKiIhEoEQpIiISgRKliIhIBEqUIiIiEShRioiIRHBUsgOQI9eyZUtv165dssMQEalWPvjgg23u
fkxl9ZQoa4B27dqRlZWV7DBERKoVM/simnq69CoiIhKBEqWIiEgESpQiIiIR6B5lDXXw4EFycnLY
v39/skORw1C/fn3atGlD3bp1kx2KSK2nRFlD5eTk0LhxY9q1a4eZJTsciYG7s337dnJycmjfvn2y
wxGp9XTptYbav38/GRkZSpLVkJmRkZGhqwEiKUKJsgZTkqy+9LsTSR269FoDfJybR7txrx9S9uyQ
TA7m7EpSRBIPW3YWMKjM71UkFtn1r0p2CIl1f16VnEYjShERkQiUKKXaefIP43nuqceTHYaI1BJK
lCIiIhHoHqUk3KxXpvLc049jZnTsdArnD76YZyc+wsGDX9OseQt+O/EZMo45lif/MJ7NuTnkbsxm
85c5jLjuJkaMvgGAZyf+npmvTKVFy5Z8J7M1nbt0rfB8110+mFNPP5Nl773Lnt15/O+EiZzRsxev
Tfs7C956nYKCfDZ+vp5rbriZg18fZPb0l0hPr8ek56bRtHnzqvqxiEg1oUQpCbXu0zU8M/H3TJnx
Fs1bZJC3cydmxv+bORczY/qLU/jrkxO5895fA5C9/jP+/NIs9u3by9De3bli5GjWrlnNmzOnM+2t
tykqLOTKQX0iJkqAosIi/j57Pu/8cw5PPfY7nnlxRmk8L725iAMHDnDRuWdw2z33M+3Nt5lw/y+Y
9X9TufonNyX8ZyIi1YsSpSTU0vfe4fwLh9K8RQYATZs3Z+2a1dw1djTbtv6HgwcP0rrt8aX1z+17
Pun16pFerx4tWh7Djm1bWb50MX0HDqZBg4YA9O4/qNLz9hs0GIDOXbry5aaNpeXde53L0Y0ac3Sj
xjRq3ITePxoIwIknd2btv1fHrd8iUnMk9B6lmTUws0VmlhZsv2lmu8xsdpl67c3sfTNbZ2YvmVl6
UG5mNjEoX2lmZ4QdM9DMPg32jQsrb2Fmc81sbfC90mtpZjbZzLaa2aoy5RW2ZWb3BOf+1MwGhJWf
aWYfB/smWvBAnJnVC/q2Luhru7BjRgXnWGtmo8LKXzCzHWZ2WTQ/7+pi/L13M/zan/B/897jf8Y/
ytcHvnmwPj29XunnOnXqUFhYdFjnKGmnTloaRUWFpeV109MPaT+9Xr2wcxUiIlJWoifzjAamu3vJ
X7sJwMhy6j0MPOruJwI7geuC8kFAx+BrDPAkQJB4JwX7OwPDzaxzcMw4YL67dwTmB9uV+RswsJzy
ctsKznUlcEpw3J9K/jMQxHh9WNwl7V4H7Az6+GjQZ8ysBXAf0BPoAdxXkpDdfQQwM4r4U1aPXucy
5/XX2LVzBwB5O3eyZ89ujv3OdwGY+fKLlbZxZs9eLHjrdfYXFLBv7x7envdmQmMWEQmX6EuvI4DS
J17dfb6Z9QmvEIy4+obVew64n1DCGQpMcXcHlphZMzPLBNoB69x9Q9DG1KDuJ8H3PmFtLQTujhSk
u78dPsILU1FbQ4Gp7n4A+NzM1gE9zCwbaOLuS4K4pgAXA/8Ijrk/aOsV4Img7wOAue6+IzhmLqHk
GjGDmNkYQv95IK1JpS/oTpoTT+rE9bf8nNGXXUhaWhonn3IaN90+jjtvupYmTZvRo9e5fLkp8rtT
O3X5PgMuuoTLB5xLi5YtOeX7p1dR9CIiCUyUweXTDu6eXUnVDGCXu5dc98oBWgefWwObwuqW7Cuv
vGfwuZW7bw4+/wdodVgdiNxWa2BJOXEdDD6XLS85ZhOAuxeaWR6hvlfUx4jc/RngGYB6mR09+i5V
vSGXD2fI5cMPKTtvwAXfqnfTHYcO/qfPX1z6+fpb7+T6W++M6nx/efmbK/vNW2Twj8UrARh6xVUM
veKblUpKysvbJyJSIpGXXlsCSV1DLRiJxiWJxLMtERGpPhJ56bUAqB9Fve1AMzM7KhhVtgFyg325
QNuwuiX76lZQDrDFzDLdfXNwmXbrEfShorYqiis3+FxeXCXH5JjZUUBTQn3P5ZvLuyXHLDyCmGuN
h355Jyuy3j+k7KrRN3Lxf41IUkQiUhMlLFG6+04zSzOz+u5e4fuC3N3NbAFwGTAVGAW8FuyeCdwc
3IPsCeQFSesroKOZtSeUaK7km3ucM4M2xoe3ZWatCd3v7BdDN8ptKyj/u5n9AfguoUk7S929yMx2
m9lZwPvANcDjZdpaHPT1n0Hf3wIeCptRez5wTwwx1lq/+M3vkx2CiNQCiZ71Ogc4p2TDzN4BXgb6
mVlO2GMVdwN3BJNiMoC/BOVvABuAdcCzwFgI3eMDbgbeAtYA09y95CG48UB/M1sL/CjYBsgEyp3/
b2YvEkpgJwVxlcy6Lbet4FzTCE0eehP4adjM3rHAn4OY1xOayEPQp4ygj3cQzKANJvE8CCwLvh4o
mdgjIiLJl+hZr5OA24F5AO5+bnmVgtmrPcopd+CnFRzzBqFEWrZ8O1DeqPGsIJ7y2hpeQXlFbeHu
vwF+U055FnBqOeX7gcsraGsyMLm8fSIiklwJTZTuvtzMFphZWtiIKync/Ylknv9wmNkLQC9Cj5OI
iEgSJHwJu2C0JIchWHAgLoY88a94NQXAzJt/UGmdLZtzeeiXd7Fh7acUFxfzwx8N4I5fPkDd9HRe
m/Z3Vq/8kF/8ekJc4zocg84+jYZHNyItLY2ioiJuvutX5T6+Ei/LFr/Lc08/zhN/eylh5xCR+NFr
tiQh3J3br7+G8wZcyKx3PmDm21nk79vH4797MNmhlevP02Yx7a13eOTp53j4vojrU3xLUVFSL5aI
SIJpUfQaoEvrpmSNv/CQsjVr1tCpTbOEnfO0StqeP38+LZoczb0//+YW83PPTKJ9+/b86Q8P07ZF
Q7J2buXWqy8mNzeXq6++mvvuuw+Aiy++mE2bNrF//35uu+02xowZA0CjRo246aabeOONN8jMzOSh
hx7iv//7v9m4cSOPPfYYQ4YMITs7m5EjR7Jv3z4AnnjiCXr16hUx1rppdTjlu01p2bIZBzbDsS0z
SvsXKZYbbriBefPmMWnSJP75z38ya9YsCgoK6NWrF08//TRmxrp167jxxhv56quvSEtL4+WXX+aE
YxrRpH5dTmvTjGXLljFmzBheeeUVTjjhhEPiWrOnAdllfq8isclLdgA1ghKlJMTq1as588wzDylr
0qQJxx13HOvWrQNg6dKlrFq1ioYNG9K9e3cuvPBCunXrxuTJk2nRogUFBQV0796dYcOGkZGRwb59
++jbty8TJkzgkksu4Ve/+hVz587lk08+YdSoUQwZMoRjjz2WuXPnUr9+fdauXcvw4cPJysqqNN7z
zjsPd2fDhg1MmzattDxSLD179uSRRx4BoHPnztx7770AjBw5ktmzZ3PRRRcxYsQIxo0bxyWXXML+
/fspLi5m06bQQkzvvfcet9xyC6+99hrHHXdcXH7uIhJ/SpSSNP379ycjI/T6rUsvvZR3332Xbt26
MXHiRF599VUANm3axNq1a8nIyCA9PZ2BA0NrzHfp0oV69epRt25dunTpQnZ2NgAHDx7k5ptvZsWK
FaSlpfHZZ59FFcuCBQto2bIl69evp1+/fvTp04dGjRpVGEtaWhrDhg075Pjf/e535Ofns2PHDk45
5RT69OlDbm4ul1xyCQD163+z/saaNWsYM2YMc+bM4bvf/e6R/SBFJKGUKCUhOnfuzCuvHDpZd/fu
3WzcuJETTzyR5cuXE7yBrJSZsXDhQubNm8fixYtp2LAhffr0Yf/+0HoVdevWLT2mTp061CvnFVmP
PvoorVq14qOPPqK4uPiQ5BSNE044gVatWvHJJ5+Qn59fYSz169cnLS30wpj9+/czduxYsrKyaNu2
Lffff39pvYpkZmayf/9+PvzwQyVKkRSnyTySEP369SM/P58pU6YAoQkvP//5z7n22mtp2DD0Aua5
c+eyY8cOCgoKmDFjBj/4wQ/Iy8ujefPmNGzYkH//+98sWbIk0mm+JS8vj8zMTOrUqcPzzz9/yESb
k08+udLjt27dyueff87xxx8fdSwlSbFly5bs3bu39D8IjRs3pk2bNsyYMQOAAwcOkJ+fD0CzZs14
/fXXueeee1i4cGFMfRSRqqURZS1R1ZNCzIxXX32VsWPH8uCDD1JcXMwFF1zAQw89VFqnR48eDBs2
jJycHK6++mq6detGly5deOqpp+jUqRMnnXQSZ511VkznHTt2LMOGDWPKlCkMHDiQo48+GoBt27YR
Wr+ifOeddx5paWkcPHiQ8ePH06pVKwYOHBhVLM2aNeP666/n1FNP5Tvf+Q7du3cv3ff8889zww03
cO+991K3bl1efvnl0n2tWrVi9uzZDBo0iMmTJ9OzZ8/ymheRJLNIfzykeujWrZuXnbCyZs0aOnXq
lKSIUs/s2bPZsGEDt956a7JDiZp+hyKJZWYfuHu3yuppRCm1wuDBg5MdgohUU7pHKSIiEoESpYiI
SARKlCIiIhEoUYqIiESgRCkiIhKBZr3WFvc3jXN7lS+2nJaWRpcuXSgsLKR9+/Y8//zzNGuWuIXa
46ldu3a0bduWd955p7Ssa9euFBYWsmrVKrKyspgyZQoTJ05k4cKFpKenly6+PmPGDL73ve/RuXPn
ZIUvInGkEaUkTIMGDVixYgWrVq2iRYsWTJo0KdkhxWTPnj2lC5ivWbPmkH0la9ICLFy4kPfee690
34wZM/jkk0+qLlARSSglSqkSZ599Nrm5uUDoXZV33XUXp556Kl26dOGll0IvMF64cCG9e/dm6NCh
dOjQgXHjxvHCCy/Qo0cPunTpwvr16wG49tprufXWW+nVqxcdOnQ4ZE3ZCRMm0L17d0477bTS13bd
e++9PPbYY6V1fvnLX/LHP/6x0pivuOKK0thefPFFhg8fXrpv4cKFDB48mOzsbJ566ikeffRRunbt
yqJFi5g5cyZ33XUXXbt2LY1ZRKovJUpJuKKiIubPn8+QIUMAmD59OitWrOCjjz5i3rx53HXXXWze
vBmAjz76iKeeeoo1a9bw/PPP89lnn7F06VJ+8pOf8Pjjj5e2uXnzZt59911mz57NuHHjAJgzZw5r
165l6dKlrFixgg8++IC3336b0aNHl645W1xczNSpU7n66qsrjXvYsGFMnz4dgFmzZnHRRRd9q067
du248cYbuf3221mxYgW9e/dmyJAhTJgwgRUrVnzrHZMiUv3oHqUkTEFBAV27diU3N5dOnTrRv39/
AN59912GDx9OWloarVq1onfv3ixbtowmTZrQvXt3MjMzgdCbPM4//3wg9FqtBQsWlLZ98cUXU6dO
HTp37syWLVuAUKKcM2cOp59+OgB79+5l7dq1/PCHPyQjI4MPP/yQLVu2cPrpp5e+3iuSjIwMmjdv
ztSpU+nUqVPpYu4iUrsoUdYAH+fm0W7c64eUPTskk4M5u0q3T4vzOVeGtV2RevUbMGX2QgoK8rlp
xDB+8ZvfM2L0DWzbc4BNO/JL29iZ/zXZ2/Zy9IE6HPA6peUFB4vZuOtrGufs4vPt+ezYW8DKnF3s
3Pc1/9lbWFqvqNhZmbOLrbv3M/LG27j86h9/K9b+lwzn9088zbatWxly+ZWVxn+wqJjVX+bRq/9F
3HjTWB74wyTWbN7N/oNFrMzZxfqv9rJ7/0FW5uxiy+797ClM+6Y/+77mi+37ovoZRbJlZwGDyvxe
4y27/lUJbV8koaKYVBgPuvQqCdegQUPufuBhnn/mCQoLCzm959m8NetVioqK2LF9G8vff49Tu555
xOfp1bsvM156gfx9ewHYsvlLtm/7CoB+Awfzr4XzWb1yOb169ys9ZmifHhHb7DvwQq696VZ+EHZM
WQ2PbsS+4JwADRs1Yt/evRXWF5HqRSPKWmLlT75I6vk7nXoaHTudwj9ee4XBl/4XKz9YyuXnn4OZ
8bNf/C8tj23F5+vXHtE5evXuy+frPmPk0NDl2oZHN+KhPz5NRstjqJueTvde59C4SdPSFy7v3LE9
4qu3AI5u1JjRY38WsU7v/gO584ZRLJzzBuMeeJiBQy7lgbt/xt//+jSPPPUcbdu1P6J+iUhy6TVb
NUC9zI6eOeqxQ8qeHZJJq+M6JCmi1FNcXMyVg3oz4am/cXz70ASbRfPeJGfjF4wYfUOSoyvflo0b
uH7m5oSeQ5depVo7wkuves2WSGD9Z//mlh9fSd8Bg0uTJEDvHw1MYlQiUl0oUUqNd8L3TuaNf61I
dhgiUk2l3GQeM2tgZovMLC3YftPMdpnZ7DL12pvZ+2a2zsxeMrP0oNzMbGJQvtLMzgg7ZqCZfRrs
GxdFLCeb2WIzO2Bmd5bZV25bZtbCzOaa2drge/OwffcE9T81swFh5Wea2cfBvolmZkH57Wa20cye
iPXn6Hil998kdbk7jn5/Iqkg5RIlMBqY7u5FwfYEYGQ59R4GHnX3E4GdwHVB+SCgY/A1BngSIEi8
k4L9nYHhZlbZYpw7gFuB34cXVtLWOGC+u3cE5gfbBPuvBE4BBgJ/KvnPQBDj9WFxDwRw90eBeyuJ
sVxf7DpIYf5uJctqyN0pzN/NF7sOJjsUESE1L72OAEpnGLj7fDPrE14hGHH1Dav3HHA/oYQzFJji
oQyxxMyamVkm0A5Y5+4bgjamBnUrXJTT3bcCW83swjK7ekRoayhQEu9zwELg7qB8qrsfAD43s3VA
DzPLBpq4+5KgrSnAxcA/Iv+YInv8/Z3cAhzfbBuGHUlTUsUc54tdB3n8/Z3JDkVESLFEGVw+7eDu
2ZVUzQB2uXthsJ0DtA4+twY2hdUt2Vdeec/DDDVSW63cvWSq4n+AVmHHLCknroPB57LlEZnZGEIj
ZtKaHPOt/bsPFPObt7dX1oyIiFQi1S69tgSObDmTFBKMahNy7dPdn3H3bu7eLa1hnF+hJSIipVIt
URYA9aOotx1oZmYlI+I2QG7wORdoG1a3ZF9F5YcjUltbgku9BN+3RhFXmzjFJSIicZZSidLddwJp
ZhYxWQYjtQXAZUHRKOC14PNM4Jpg9utZQF5wKXQZ0DGYLZtOaGLNTAAzu9nMbo4h1ArbCr6PqiCu
K82snpm1JzRpZ2kQ224zOyu493pN2DEiIpJkKXWPMjAHOAeYB2Bm7wAnA43MLAe4zt3fIjRBZqqZ
/Rr4EPhLcPwbwAXAOiAf+DGAuxcGyfAtIA2Y7O6rg2NOBv5VNhAz+w6QBTQBis3sZ0Bnd98doa3x
wDQzuw74ArgiOP9qM5tGaMJPIfDTsJm9Y4G/AQ0ITeI5ook8IiISPym3hF3w3OPt7l7eIyGJOuds
4FJ3/7qqzhktM7sW6ObuFY54y1vCTiQaWsJOqrUqWsIupS69Arj7cmBB2DOGVXHOwSmaJG8H7gF2
JzsWEZHaKhUvveLuk5MdQyoIFhx4NNlxiIjUZik3ohQREUklKTmilNh0ad2UrPFlFw8SiUbVvCFe
pDqLekRpZj+IpkxERKQmieXS6+NRlomIiNQYlV56NbOzgV7AMWZ2R9iuJoSeIRQREamxorlHmQ40
Cuo2DivfzTcr44iIiNRIlSZKd18ELDKzv7n7F1UQk4iISMqIZdbrMWb2GHB8+HHuflrcoxIREUkR
sSTKF4C7gI+B4sSEIyIiklpiSZRfufvMyquJiIjUHLEkyvvM7M/AfOBASaG7T497VCIiIikilkT5
Y0Kvo6rLN5deHVCiFBGRGiuWRNnd3U9KWCQiIiIpKJaVed4zs84Ji0RERCQFxTKiPAtYYWafE7pH
aYDr8RAREanJYkmUAxMWhYiISIqKOlGWrMpjZscC9RMWkYiISAqJ5TVbQ8xsLfA5sAjIBv6RoLhE
RERSQiyTeR4kdJ/yM3dvD/QDliQkKhERkRQRyz3Kg+6+3czqmFkdd18QrP0qSfZxbh7txr2e7DBE
ar3s+lclO4Ta5f68KjlNLIlyl5k1At4GXjCzrcC+xIQlIiKSGmK59DoUyAduB94E1gMXJSIoERGR
VBHLrNeS0WMx8FzZ/Wa22N3PjldgIiIiqSCWEWVl9MiIiIjUOPFMlB7HtkRERFJCPBNl0phZAzNb
ZGZpwfabZrbLzGaXqdfezN43s3Vm9pKZpQflZmYTg/KVZnZGFOe8OajvZtYyrLzCtsxsoJl9Guwb
F1bewszmmtna4HvzoPxcM/vEzFYd+U9JREQORzwTpcWxrViNBqa7e1GwPQEYWU69h4FH3f1EYCdw
XVA+COgYfI0BnozinP8CfgR8Uaa83LaCJD4p2N8ZGB62yPw4YL67dyT0vs9xAO7+DnBBFLGIiEiC
xLIyz8OVlJWXmKrKCOC1kg13nw/sCa9gZgb0BV4Jip4DLg4+DwWmeMgSoJmZZUY6obt/6O7Z5eyq
qK0ewDp33+DuXwNTg7olx5RMkAqPS0REkiyWEWX/csoGlXxw96RcHgwun3aoIGmFywB2uXthsJ0D
tA4+twY2hdUN3xeritqKdI5W7r45+PwfoFVlJzGzMWaWZWZZRflV89CtiEhtVOnjIWZ2EzAW6GBm
K8N2NSZ0+THZWgK7kh1EvLi7m1mlE6Pc/RngGYB6mR01kUpEJEGieY7y74QWP/8twb2zwB5335GQ
qGJTQHSPpmwndBn0qGBU2QbIDfblAm3D6obvi1VFbdWNcI4tZpbp7puDy7RbD/PcIiISZ5VeenX3
PHfPdvfhhC5fDgWGAO0SHFtU3H0nkGZmEZOluzuwALgsKBrFN/c1ZwLXBDNWzwLySi6Fmtl8M4vl
MmxFbS0DOgYzb9OBK4O6JceMKicuERFJslgm8/wPoYkmGYQud/7VzH6VqMBiNAc4p2TDzN4BXgb6
mVmOmQ0Idt0N3GFm6wj14y9B+RvABmAd8CyhS82YWR3gROBbI2czu9XMcgiNDFea2Z8jtRWMYm8G
3gLWANPcfXVwzHigf/Aasx8F2yIikgIsNNCKoqLZp8D33X1/sN0AWOHuJyUwvqgEzyre7u5xnXlr
ZqcCo939jni2G2MM7YDZ7n5qRXXqZXb0zFF6kYtIsuntIVXsCN8eYmYfuHu3yurFMuv1Sw69F1iP
w7+PF1fuvhxYULLgQBzbXZXkJHkuMAvYlqwYRERqu1hes5UHrDazuYSWq+sPLDWziQDufmsC4oua
u09O5vkTIVhwoEuy4xARqc1iSZSvBl8lFsY3FBERkdQT9T1KSV3dunXzrKysZIchIlKtRHuPMpoF
B6a5+xVm9jHlvCHE3U87zBhFRERSXjSXXm8Lvg9OZCAiIiKpKJoFBzYH30vektEx+LyVcp4vFBER
qUliWXDgekJv3ng6KGoDzEhEUCIiIqkilucofwr8ANgN4O5rgWMTEZSIiEiqiCVRHgjeowiAmR1F
OZN7REREapJYEuUiM/sF0MDM+hNaS3VWYsISERFJDbEkynHAV8DHwA2EFv9OlUXRRUREEiKWlXka
AJPd/VmAYF3VBkB+IgITERFJBbGMKOcTSowlGgDz4huOiIhIaoklUdZ3970lG8HnhvEPSUREJHXE
kij3Be99BMDMzgQK4h+SiIhI6ojlHuXPgJfN7EvAgO8A/5WQqERERFJE1InS3ZeZ2cnASUHRp+5+
MDFhiYiIpIZYlrBrCNwN3Obuq4B2ZqaF0kVEpEaL5R7lX4GvgbOD7Vzg13GPSEREJIXEkihPcPff
AQcB3D2f0L1KERGRGiuWyTxfm1kDgvVdzewE4EBCopKYfJybR7txryc7DBGp5bLrX1W1J7w/r0pO
E0uivA94E2hrZi8QepPItYkISkREJFVElSjNzIB/A5cCZxG65Hqbu29LYGwiIiJJF1WidHc3szfc
vQuga3wiIlJrxDKZZ7mZdU9YJCIiIikolnuUPYERZvYFsI/Q5Vd399MSEpmIiEgKiGVEOQA4AegL
XAQMDr4DYGbN4xta4phZAzNbFLwqDDN708x2mdnsMvXam9n7ZrbOzF4ys/Qo2o6pLQuZGJSvLFlP
N4hxhZl9bWYt49d7ERGJRdSJ0t2/KO8rrMr8BMSXKKOB6e5eFGxPAEaWU+9h4FF3PxHYCVwXRdux
tjUI6Bh8jQGeBHD3AnfvCnwZVY9ERCQhYhlRVqY6LT4wAnitZMPd5wN7wisEM337Aq8ERc8BF1fW
8GG0NRSY4iFLgGZmlhlrh0REJDHimSg9jm0lTHDJs4O7Z1dSNQPY5e6FwXYO0PowTxuprdbAprC6
UZ3HzMaYWZaZZRXlV81DtyIitVE8E2V10RLYlewgjpS7P+Pu3dy9W1rDpskOR0SkxqqNl14LgPpR
1NtO6DJoyczgNoQWgj8ckdrKBdqG1T2S84iISJzFlCjN7Awzu9XMbimZnRmmXxzjShh33wmkmVnE
ZOnuDiwALguKRhHc1zSzHmY2JYZzVtgWMBO4Jpj9ehaQ5+6bo21bREQSK5b3Ud5LaBJKBqHLl381
s1+V7Hf3HfEPL2HmAOeUbJjZO8DLQD8zyzGzAcGuu4E7zGwdoX7/JSg/jtDI9FsOo603gA3AOuBZ
YGx8uigiIvEQy4IDI4Dvu/t+ADMbD6yger6TchJwOzAPwN3PLa+Su28AepSzq2fQRnnHxNRWMNr8
aVRRi4hIlYslUX5J6N7e/mC7HtX0Xpq7LzezBWaWFvYsZSzH35WIuMIFrzRbDNQFihN9PhERKV+l
idLMHif06EcesNrM5gbb/YGliQ0vcdx9crJjiMTdC4CuyY5DRKS2i2ZEmRV8/wB4Nax8IdXk2UkR
EZHDVWkNl2NXAAAJu0lEQVSidPfnAMzsNnf/Y/g+M7stUYFJ9Lq0bkrW+AuTHYaI1Ho1c/GTWB4P
GVVO2bVxikNERCQlRXOPcjhwFdDezGaG7WoMVKdHQkRERGIWzT3K94DNhJ6dfCSsfA+wMhFBiYiI
pIpo7lF+AXwBnJ34cERERFJLLCvzXGpma80sz8x2m9keM9udyOBERESSLZYFB34HXOTuaxIVjIiI
SKqJZdbrFiVJERGpbWIZUWaZ2UvADOBASaG7T497VCIiIikilkTZBMgHzg8rc0CJUkREaqyoE6W7
/ziRgYiIiKSiWGa9tjGzV81sa/D1f2bWJpHBiYiIJFssk3n+CswEvht8zQrKREREaqxYEuUx7v5X
dy8Mvv4GHJOguERERFJCLIlyu5ldbWZpwdfVwPZEBSYiIpIKYkmUo4ErgP8QWvv1MvT2EBERqeFi
eTzkAWCUu+8EMLMWwO8JJVAREZEaKZYR5WklSRLA3XcAp8c/JBERkdQRy4iyjpk1LzOijOV4SZCP
c/NoN+71ZIchIgJAdv2rquZE9+dVyWliSXSPAIvN7OVg+3LgN/EPSUREJHXEsjLPFDPLAvoGRZe6
+yeJCUtERCQ1xHTpNEiMSo4iIlJrxDKZR0REpNZRohQREYlAiVJERCQCJcoomVkDM1tkZmnB9ptm
tsvMZkd5/A/NbLmZFZrZZWX2jTKztcHXqLDyF8xsR9n6IiJSdZQoozcamO7uRcH2BGBkDMdvJLTk
39/DC4PnUe8DegI9gPvMrDmAu48g9MYWERFJEiXK6I0AXivZcPf5wJ5oD3b3bHdfCRSX2TUAmOvu
O4LFHOYCAytrz8zGmFmWmWUV5VfNQ7ciIrWREmUUzCwd6ODu2QlovjWwKWw7JyiLyN2fcfdu7t4t
rWHTBIQlIiKgRBmtlsCuZAchIiJVT4kyOgVA/QS1nQu0DdtuE5SJiEgKUKKMQnDvMM3MKk2WZvZb
M7skhubfAs43s+bBJJ7zgzIREUkBSpTRmwOcU7JhZu8ALwP9zCzHzAYEu7oQern1Icysu5nlEFpM
/mkzWw2lryt7EFgWfD0QlImISArQa7KiNwm4HZgH4O7nVlCvrrsvLlvo7ssIXVb9FnefDEyOU5wi
IhJHGlFGyd2XAwtKFhyIUG9ApP2xMLMXgN7A/ni1KSIisdGIMgbByK8qzzeiKs8nIiLfphGliIhI
BBpR1gBdWjcla/yFyQ5DRCRQs1YL04hSREQkAiVKERGRCJQoRUREIlCiFBERiUCJUkREJAIlShER
kQiUKEVERCJQohQREYlAiVJERCQCJUoREZEIlChFREQiUKIUERGJQIlSREQkAiVKERGRCJQoRURE
IlCiFBERiUCJUkREJIKjkh2AHLmPc/NoN+71ZIchIkmSXf+qZIeQHPfnVclpNKIUERGJQIlSREQk
AiVKERGRCJQoRUREIlCiFBERiUCJ8giZWQMzW2RmacH2KDNbG3yNiuL4H5rZcjMrNLPLwspPMLMV
ZrY3kfGLiEhkejzkyI0Gprt7kZm1AO4DugEOfGBmM919Z4TjNwLXAneGF7r7eqCrEqWISHJpRHnk
RgCvBZ8HAHPdfUeQHOcCAyMd7O7Z7r4SKE5smCIicjiUKI+AmaUDHdw9OyhqDWwKq5ITlCXi3GPM
LMvMsoryq+ahWxGR2kiJ8si0BHYl48Tu/oy7d3P3bmkNmyYjBBGRWkGJ8sgUAPXDtnOBtmHbbYIy
ERGpppQoj0BwHzLNzEqS5VvA+WbW3MyaA+cHZZjZb83skiSFKiIih0mJ8sjNAc4BcPcdwIPAsuDr
gaAMoAvwn7IHm1l3M8sBLgeeNrPVVRK1iIhERY+HHLlJwO3APAB3nwxMLqdeXXdfXLbQ3ZcRukQr
IiIpSCPKI+Tuy4EFJQsORKg3IJZ2SxYcALYcSXwiInJkNKKMg2AUGe821wNd492uiIjERiNKERGR
CDSirAG6tG5K1vgLkx2GiCSNFh1JJI0oRUREIlCiFBERiUCJUkREJAIlShERkQiUKEVERCJQohQR
EYlAiVJERCQCJUoREZEIzN2THYMcITPbA3ya7DiSqCWwLdlBJJH6X3v7X5v7Dkfe/+Pd/ZjKKmll
nprhU3fvluwgksXMstR/9T/ZcSRDbe47VF3/delVREQkAiVKERGRCJQoa4Znkh1Akqn/tVtt7n9t
7jtUUf81mUdERCQCjShFREQiUKKsRsxsoJl9ambrzGxcOfvNzCYG+1ea2RnJiDNRouj/iKDfH5vZ
e2b2/WTEmQiV9T2sXnczKzSzy6oyvkSLpv9m1sfMVpjZajNbVNUxJlIU//abmtksM/so6P+PkxFn
IpjZZDPbamarKtif+L977q6vavAFpAHrgQ5AOvAR0LlMnQuAfwAGnAW8n+y4q7j/vYDmwedBNaX/
0fQ9rN4/gTeAy5IddxX/7psBnwDHBdvHJjvuKu7/L4CHg8/HADuA9GTHHqf+/xA4A1hVwf6E/93T
iLL66AGsc/cN7v41MBUYWqbOUGCKhywBmplZZlUHmiCV9t/d33P3ncHmEqBNFceYKNH87gFuAf4P
2FqVwVWBaPp/FTDd3TcCuHtN+hlE038HGpuZAY0IJcrCqg0zMdz9bUL9qUjC/+4pUVYfrYFNYds5
QVmsdaqrWPt2HaH/ZdYElfbdzFoDlwBPVmFcVSWa3/33gOZmttDMPjCza6osusSLpv9PAJ2AL4GP
gdvcvbhqwku6hP/d08o8UuOY2XmEEuU5yY6lCj0G3O3uxaFBRa1zFHAm0A9oACw2syXu/llyw6oy
A4AVQF/gBGCumb3j7ruTG1bNoERZfeQCbcO22wRlsdaprqLqm5mdBvwZGOTu26sotkSLpu/dgKlB
kmwJXGBmhe4+o2pCTKho+p8DbHf3fcA+M3sb+D5QExJlNP3/MTDeQzft1pnZ58DJwNKqCTGpEv53
T5deq49lQEcza29m6cCVwMwydWYC1wSzwM4C8tx9c1UHmiCV9t/MjgOmAyNr2Eii0r67e3t3b+fu
7YBXgLE1JElCdP/2XwPOMbOjzKwh0BNYU8VxJko0/d9IaDSNmbUCTgI2VGmUyZPwv3saUVYT7l5o
ZjcDbxGaBTfZ3Veb2Y3B/qcIzXa8AFgH5BP6X2aNEGX/7wUygD8FI6tCrwELRkfZ9xormv67+xoz
exNYCRQDf3b3ch8nqG6i/P0/CPzNzD4mNPvzbnevEW8VMbMXgT5ASzPLAe4D6kLV/d3TyjwiIiIR
6NKriIhIBEqUIiIiEShRioiIRKBEKSIiEoESpYiISARKlCIiIhEoUYqIiESgRCkiIhLB/we+C93j
Q1nBiAAAAABJRU5ErkJggg=="></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><h3 id="&#26681;&#25454;&#24030;&#32479;&#35745;&#36190;&#21161;&#20449;&#24687;">&#26681;&#25454;&#24030;&#32479;&#35745;&#36190;&#21161;&#20449;&#24687;<a class="anchor-link" href="#&#26681;&#25454;&#24030;&#32479;&#35745;&#36190;&#21161;&#20449;&#24687;">&#182;</a></h3></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[359]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">fec_mrbo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cand_nm&#39;</span><span class="p">,</span> <span class="s1">&#39;contbr_st&#39;</span><span class="p">])</span>
<span class="n">totals</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">contb_receipt_amt</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">totals</span> <span class="o">=</span> <span class="n">totals</span><span class="p">[</span><span class="n">totals</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100000</span><span class="p">]</span>
<span class="n">totals</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[359]:</div><div class="output_text output_subarea output_execute_result"><pre>cand_nm    Obama, Barack  Romney, Mitt
contbr_st                             
AK             281840.15      86204.24
AL             543123.48     527303.51
AR             359247.28     105556.00
AZ            1506476.98    1888436.23
CA           23824984.24   11237636.60
CO            2132429.49    1506714.12
CT            2068291.26    3499475.45
DC            4373538.80    1025137.50
DE             336669.14      82712.00
FL            7318178.58    8338458.81</pre></div></div></div></div></div><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="text_cell_render border-box-sizing rendered_html"><p><code>Mitt is so...poorly...</code></p></div></div></div><div class="cell border-box-sizing code_cell rendered"><div class="input"><div class="prompt input_prompt">In&nbsp;[360]:</div><div class="inner_cell"><div class="input_area"><div class="highlight hl-ipython2"><pre><span></span><span class="n">percent</span> <span class="o">=</span> <span class="n">totals</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">totals</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">percent</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div></div></div></div><div class="output_wrapper"><div class="output"><div class="output_area"><div class="prompt output_prompt">Out[360]:</div><div class="output_text output_subarea output_execute_result"><pre>cand_nm    Obama, Barack  Romney, Mitt
contbr_st                             
AK              0.765778      0.234222
AL              0.507390      0.492610
AR              0.772902      0.227098
AZ              0.443745      0.556255
CA              0.679498      0.320502
CO              0.585970      0.414030
CT              0.371476      0.628524
DC              0.810113      0.189887
DE              0.802776      0.197224
FL              0.467417      0.532583</pre></div></div></div></div></div></div></div><!-- hexo-inject:begin --><script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });</script><script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:end --></body></html>]]></content>
    
    <summary type="html">
    
      &lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;title&gt;ch09&lt;/title&gt;&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/re
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>python data analysis learning note 09</title>
    <link href="http://yoursite.com/2017/03/07/python-data-analysis-learning-note-09/"/>
    <id>http://yoursite.com/2017/03/07/python-data-analysis-learning-note-09/</id>
    <published>2017-03-07T07:37:24.000Z</published>
    <updated>2017-03-07T07:37:24.055Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>cs231n Lecture4 note</title>
    <link href="http://yoursite.com/2017/03/06/cs231n-Lecture4-note/"/>
    <id>http://yoursite.com/2017/03/06/cs231n-Lecture4-note/</id>
    <published>2017-03-06T10:58:31.000Z</published>
    <updated>2017-03-06T12:44:06.198Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><strong>Motivation</strong>. In this section we will develop expertise with an intuitive understanding of <strong>backpropagation</strong>, which is a way of computing gradients of expressions through recursive application of <strong>chain rule</strong>. Understanding of this process and its subtleties is critical for you to understand, and effectively develop, design and debug Neural Networks.</p><p><strong>Problem statement</strong>. The core problem studied in this section is as follows: We are given some function $f(x)$ where $x$ is a vector of inputs and we are interested in computing the gradient of $f$ at $x$ (i.e. $\Delta f(x)$ ).</p><h1 id="Modularity-Sigmoid-example"><a href="#Modularity-Sigmoid-example" class="headerlink" title="Modularity: Sigmoid example"></a>Modularity: Sigmoid example</h1><script type="math/tex;mode=display">f(w,x) = \frac{1}{1+e^{-(w_0x_0 + w_1x_1 + w_2)}}</script><p>The function is made up of multiple gates. In addition to the ones described already above (add, mul, max), there are four more:</p><script type="math/tex;mode=display">f(x) = \frac{1}{x} 
\hspace{1in} \rightarrow \hspace{1in} 
\frac{df}{dx} = -1/x^2 
\\\\
f_c(x) = c + x
\hspace{1in} \rightarrow \hspace{1in} 
\frac{df}{dx} = 1 
\\\\
f(x) = e^x
\hspace{1in} \rightarrow \hspace{1in} 
\frac{df}{dx} = e^x
\\\\
f_a(x) = ax
\hspace{1in} \rightarrow \hspace{1in} 
\frac{df}{dx} = a</script><p>The full circuit then looks as follows:</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/lecture-note/04/circuit.png" alt="circuit"></p><p>In the example above, we see a long chain of function applications that operates on the result of the dot product between <strong>w,x</strong>. The function that these operations implement is called the <em>sigmoid function</em> $\sigma (x)$. It turns out that the derivative of the sigmoid function with respect to its input simplifies if you perform the derivation (after a fun tricky part where we add and subtract a 1 in the numerator):</p><script type="math/tex;mode=display">\sigma(x) = \frac{1}{1+e^{-x}} \\\\
\rightarrow \hspace{0.3in} \frac{d\sigma(x)}{dx} = \frac{e^{-x}}{(1+e^{-x})^2} = \left( \frac{1 + e^{-x} - 1}{1 + e^{-x}} \right) \left( \frac{1}{1+e^{-x}} \right) 
= \left( 1 - \sigma(x) \right) \sigma(x)</script><p>As we see, the gradient turns out to simplify and becomes surprisingly simple. For example, the sigmoid expression receives the input 1.0 and computes the output 0.73 during the forward pass. The derivation above shows that the <em>local</em> gradient would simply be (1 - 0.73) * 0.73 ~= 0.2, as the circuit computed before (see the image above), except this way it would be done with a single, simple and efficient expression (and with less numerical issues). Therefore, in any real practical application it would be very useful to group these operations into a single gate. Lets see the backprop for this neuron in code:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">w = [<span class="number">2</span>,<span class="number">-3</span>,<span class="number">-3</span>] <span class="comment"># assume some random weights and data</span></div><div class="line">x = [<span class="number">-1</span>, <span class="number">-2</span>]</div><div class="line"></div><div class="line"><span class="comment"># forward pass</span></div><div class="line">dot = w[<span class="number">0</span>]*x[<span class="number">0</span>] + w[<span class="number">1</span>]*x[<span class="number">1</span>] + w[<span class="number">2</span>]</div><div class="line">f = <span class="number">1.0</span> / (<span class="number">1</span> + math.exp(-dot)) <span class="comment"># sigmoid function</span></div><div class="line"></div><div class="line"><span class="comment"># backward pass through the neuron (backpropagation)</span></div><div class="line">ddot = (<span class="number">1</span> - f) * f <span class="comment"># gradient on dot variable, using the sigmoid gradient derivation</span></div><div class="line">dx = [w[<span class="number">0</span>] * ddot, w[<span class="number">1</span>] * ddot] <span class="comment"># backprop into x</span></div><div class="line">dw = [x[<span class="number">0</span>] * ddot, x[<span class="number">1</span>] * ddot, <span class="number">1.0</span> * ddot] <span class="comment"># backprop into w</span></div><div class="line"><span class="comment"># we're done! we have the gradients on the inputs to the circuit</span></div></pre></td></tr></table></figure><p><strong>Implementation protip: staged backpropagation</strong>. As shown in the code above, in practice it is always helpful to break down the forward pass into stages that are easily backpropped through. For example here we created an intermediate variable <code>dot</code> which holds the output of the dot product between <code>w</code> and <code>x</code>. During backward pass we then successively compute (in reverse order) the corresponding variables (e.g. <code>ddot</code>, and ultimately <code>dw, dx</code>) that hold the gradients of those variables.</p><h1 id="Backprop-in-practice-Staged-computation"><a href="#Backprop-in-practice-Staged-computation" class="headerlink" title="Backprop in practice: Staged computation"></a>Backprop in practice: Staged computation</h1><p>Suppose that we have a function of the form:</p><script type="math/tex;mode=display">f(x,y) = \frac{x + \sigma(y)}{\sigma(x) + (x+y)^2}</script><p>Here is how we would structure the forward pass of such expression:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">x = <span class="number">3</span> <span class="comment"># example values</span></div><div class="line">y = <span class="number">-4</span></div><div class="line"></div><div class="line"><span class="comment"># forward pass</span></div><div class="line">sigy = <span class="number">1.0</span> / (<span class="number">1</span> + math.exp(-y)) <span class="comment"># sigmoid in numerator   #(1)</span></div><div class="line">num = x + sigy <span class="comment"># numerator                               #(2)</span></div><div class="line">sigx = <span class="number">1.0</span> / (<span class="number">1</span> + math.exp(-x)) <span class="comment"># sigmoid in denominator #(3)</span></div><div class="line">xpy = x + y                                              <span class="comment">#(4)</span></div><div class="line">xpysqr = xpy**<span class="number">2</span>                                          <span class="comment">#(5)</span></div><div class="line">den = sigx + xpysqr <span class="comment"># denominator                        #(6)</span></div><div class="line">invden = <span class="number">1.0</span> / den                                       <span class="comment">#(7)</span></div><div class="line">f = num * invden <span class="comment"># done!                                 #(8)</span></div></pre></td></tr></table></figure><p>For each row, we also highlight which part of the forward pass it refers to:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># backprop f = num * invden</span></div><div class="line">dnum = invden <span class="comment"># gradient on numerator                             #(8)</span></div><div class="line">dinvden = num                                                     <span class="comment">#(8)</span></div><div class="line"><span class="comment"># backprop invden = 1.0 / den </span></div><div class="line">dden = (<span class="number">-1.0</span> / (den**<span class="number">2</span>)) * dinvden                                <span class="comment">#(7)</span></div><div class="line"><span class="comment"># backprop den = sigx + xpysqr</span></div><div class="line">dsigx = (<span class="number">1</span>) * dden                                                <span class="comment">#(6)</span></div><div class="line">dxpysqr = (<span class="number">1</span>) * dden                                              <span class="comment">#(6)</span></div><div class="line"><span class="comment"># backprop xpysqr = xpy**2</span></div><div class="line">dxpy = (<span class="number">2</span> * xpy) * dxpysqr                                        <span class="comment">#(5)</span></div><div class="line"><span class="comment"># backprop xpy = x + y</span></div><div class="line">dx = (<span class="number">1</span>) * dxpy                                                   <span class="comment">#(4)</span></div><div class="line">dy = (<span class="number">1</span>) * dxpy                                                   <span class="comment">#(4)</span></div><div class="line"><span class="comment"># backprop sigx = 1.0 / (1 + math.exp(-x))</span></div><div class="line">dx += ((<span class="number">1</span> - sigx) * sigx) * dsigx <span class="comment"># Notice += !! See notes below  #(3)</span></div><div class="line"><span class="comment"># backprop num = x + sigy</span></div><div class="line">dx += (<span class="number">1</span>) * dnum                                                  <span class="comment">#(2)</span></div><div class="line">dsigy = (<span class="number">1</span>) * dnum                                                <span class="comment">#(2)</span></div><div class="line"><span class="comment"># backprop sigy = 1.0 / (1 + math.exp(-y))</span></div><div class="line">dy += ((<span class="number">1</span> - sigy) * sigy) * dsigy                                 <span class="comment">#(1)</span></div><div class="line"><span class="comment"># done! phew</span></div></pre></td></tr></table></figure><p>Notice a few things:</p><p><strong>Cache forward pass variables</strong>. To compute the backward pass it is very helpful to have some of the variables that were used in the forward pass. In practice you want to structure your code so that you cache these variables, and so that they are available during backpropagation. If this is too difficult, it is possible (but wasteful) to recompute them.</p><p><strong>Gradients add up at forks</strong>. The forward expression involves the variables <strong>x,y</strong> multiple times, so when we perform backpropagation we must be careful to use <code>+=</code> instead of <code>=</code> to accumulate the gradient on these variables (otherwise we would overwrite it). This follows the <em>multivariable chain rule</em> in Calculus, which states that if a variable branches out to different parts of the circuit, then the gradients that flow back to it will add.</p><h1 id="Patterns-in-backward-flow"><a href="#Patterns-in-backward-flow" class="headerlink" title="Patterns in backward flow"></a>Patterns in backward flow</h1><p>It is interesting to note that in many cases the backward-flowing gradient can be interpreted on an intuitive level. For example, the three most commonly used gates in neural networks (<em>add,mul,max</em>), all have very simple interpretations in terms of how they act during backpropagation. Consider this example circuit:</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/lecture-note/04/pattern.png" alt="pattern"></p><p>Looking at the diagram above as an example, we can see that:</p><p>The <strong>add gate</strong> always takes the gradient on its output and distributes it equally to all of its inputs, regardless of what their values were during the forward pass. This follows from the fact that the local gradient for the add operation is simply +1.0, so the gradients on all inputs will exactly equal the gradients on the output because it will be multiplied by x1.0 (and remain unchanged). In the example circuit above, note that the + gate routed the gradient of 2.00 to both of its inputs, equally and unchanged.</p><p>The <strong>max gate</strong> routes the gradient. Unlike the add gate which distributed the gradient unchanged to all its inputs, the max gate distributes the gradient (unchanged) to exactly one of its inputs (the input that had the highest value during the forward pass). This is because the local gradient for a max gate is 1.0 for the highest value, and 0.0 for all other values. In the example circuit above, the max operation routed the gradient of 2.00 to the <strong>z</strong> variable, which had a higher value than <strong>w</strong>, and the gradient on <strong>w</strong> remains zero.</p><p>The <strong>multiply gate</strong> is a little less easy to interpret. Its local gradients are the input values (except switched), and this is multiplied by the gradient on its output during the chain rule. In the example above, the gradient on <strong>x</strong> is -8.00, which is -4.00 x 2.00.</p><p><em>Unintuitive effects and their consequences</em>. Notice that if one of the inputs to the multiply gate is very small and the other is very big, then the multiply gate will do something slightly unintuitive: it will assign a relatively huge gradient to the small input and a tiny gradient to the large input. Note that in linear classifiers where the weights are dot producted $w^T x_i$ (multiplied) with the inputs, this implies that the scale of the data has an effect on the magnitude of the gradient for the weights. For example, if you multiplied all input data examples xixi by 1000 during preprocessing, then the gradient on the weights will be 1000 times larger, and you’d have to lower the learning rate by that factor to compensate. This is why preprocessing matters a lot, sometimes in subtle ways! And having intuitive understanding for how the gradients flow can help you debug some of these cases.</p><h1 id="Extras"><a href="#Extras" class="headerlink" title="Extras"></a>Extras</h1><p>Some extra materials provided in <a href="https://github.com/ewanlee/ewanlee.github.io/blob/master/2017/03/06/cs231n-Lecture4-note/sources/lecun-98b.pdf" target="_blank" rel="external">here</a> and <a href="https://github.com/ewanlee/ewanlee.github.io/blob/master/2017/03/06/cs231n-Lecture4-note/sources/vecDerivs.pdf" target="_blank" rel="external">here</a>.</p><p>Optional: [<a href="http://colah.github.io/posts/2015-08-Backprop/" target="_blank" rel="external">1</a>, <a href="http://neuralnetworksanddeeplearning.com/chap2.html" target="_blank" rel="external">2</a>, <a href="https://www.youtube.com/watch?v=q0pm3BrIUFo" target="_blank" rel="external">3</a>]</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;Motivation&lt;/strong&gt;. I
    
    </summary>
    
    
      <category term="machine learning" scheme="http://yoursite.com/tags/machine-learning/"/>
    
      <category term="deep learning" scheme="http://yoursite.com/tags/deep-learning/"/>
    
  </entry>
  
  <entry>
    <title>python data analysis learning note ch08</title>
    <link href="http://yoursite.com/2017/03/05/python-data-analysis-learning-note-ch08/"/>
    <id>http://yoursite.com/2017/03/05/python-data-analysis-learning-note-ch08/</id>
    <published>2017-03-05T14:55:28.000Z</published>
    <updated>2017-03-05T15:08:37.192Z</updated>
    
    <content type="html"><![CDATA[<h1 id="绘图和可视化"><a href="#绘图和可视化" class="headerlink" title="绘图和可视化"></a>绘图和可视化</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">np.random.seed(<span class="number">12345</span>)</div><div class="line">plt.rc(<span class="string">'figure'</span>, figsize=(<span class="number">10</span>, <span class="number">6</span>))</div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">np.set_printoptions(precision=<span class="number">4</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</div><div class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">%matplotlib inline</div></pre></td></tr></table></figure><h2 id="matplotlib-API-入门"><a href="#matplotlib-API-入门" class="headerlink" title="matplotlib API 入门"></a>matplotlib API 入门</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div></pre></td></tr></table></figure><h3 id="Figure-和-Subplot"><a href="#Figure-和-Subplot" class="headerlink" title="Figure 和 Subplot"></a>Figure 和 Subplot</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fig = plt.figure()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ax1 = fig.add_subplot(<span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ax2 = fig.add_subplot(<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>)</div><div class="line">ax3 = fig.add_subplot(<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line">plt.plot(randn(<span class="number">50</span>).cumsum(), <span class="string">'k--'</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_10_1.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_ = ax1.hist(randn(<span class="number">100</span>), bins=<span class="number">20</span>, color=<span class="string">'k'</span>, alpha=<span class="number">0.3</span>)</div><div class="line">ax2.scatter(np.arange(<span class="number">30</span>), np.arange(<span class="number">30</span>) + <span class="number">3</span> * randn(<span class="number">30</span>))</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plt.close(<span class="string">'all'</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">3</span>)</div><div class="line">axes</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_13_1.png" alt="png"></p><h4 id="调整subplot周围的间距"><a href="#调整subplot周围的间距" class="headerlink" title="调整subplot周围的间距"></a>调整subplot周围的间距</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">plt.subplots_adjust(left=<span class="keyword">None</span>, bottom=<span class="keyword">None</span>, right=<span class="keyword">None</span>, top=<span class="keyword">None</span>,</div><div class="line">                wspace=<span class="keyword">None</span>, hspace=<span class="keyword">None</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">2</span>, sharex=<span class="keyword">True</span>, sharey=<span class="keyword">True</span>)</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</div><div class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>):</div><div class="line">        axes[i, j].hist(randn(<span class="number">500</span>), bins=<span class="number">50</span>, color=<span class="string">'k'</span>, alpha=<span class="number">0.5</span>)</div><div class="line">plt.subplots_adjust(wspace=<span class="number">0</span>, hspace=<span class="number">0</span>)</div></pre></td></tr></table></figure><pre><code>(array([  2.,   0.,   3.,   2.,   1.,   1.,   0.,   3.,   5.,   8.,   9.,
          9.,  10.,  18.,  34.,  13.,  24.,  30.,  24.,  24.,  25.,  20.,
         34.,  20.,  30.,  30.,  19.,  14.,  14.,   8.,  19.,  14.,   7.,
          3.,   7.,   2.,   7.,   2.,   2.,   0.,   1.,   0.,   0.,   0.,
          1.,   0.,   0.,   0.,   0.,   1.]),
 array([-2.9493, -2.8118, -2.6743, -2.5367, -2.3992, -2.2617, -2.1241,
        -1.9866, -1.849 , -1.7115, -1.574 , -1.4364, -1.2989, -1.1614,
        -1.0238, -0.8863, -0.7487, -0.6112, -0.4737, -0.3361, -0.1986,
        -0.0611,  0.0765,  0.214 ,  0.3516,  0.4891,  0.6266,  0.7642,
         0.9017,  1.0392,  1.1768,  1.3143,  1.4519,  1.5894,  1.7269,
         1.8645,  2.002 ,  2.1395,  2.2771,  2.4146,  2.5522,  2.6897,
         2.8272,  2.9648,  3.1023,  3.2398,  3.3774,  3.5149,  3.6525,
         3.79  ,  3.9275]),
 &lt;a list of 50 Patch objects&gt;)






(array([  1.,   1.,   0.,   2.,   0.,   1.,   1.,   5.,   7.,   4.,   5.,
          8.,  12.,  12.,  13.,  15.,  17.,  13.,  22.,  30.,  21.,  24.,
         17.,  20.,  20.,  20.,  18.,  26.,  16.,  24.,  19.,   8.,  14.,
         15.,   7.,  11.,   5.,   4.,   9.,   7.,   6.,   1.,   6.,   2.,
          4.,   2.,   0.,   2.,   1.,   2.]),
 array([-2.595 , -2.4898, -2.3845, -2.2793, -2.1741, -2.0688, -1.9636,
        -1.8584, -1.7531, -1.6479, -1.5427, -1.4374, -1.3322, -1.227 ,
        -1.1217, -1.0165, -0.9112, -0.806 , -0.7008, -0.5955, -0.4903,
        -0.3851, -0.2798, -0.1746, -0.0694,  0.0359,  0.1411,  0.2463,
         0.3516,  0.4568,  0.562 ,  0.6673,  0.7725,  0.8777,  0.983 ,
         1.0882,  1.1935,  1.2987,  1.4039,  1.5092,  1.6144,  1.7196,
         1.8249,  1.9301,  2.0353,  2.1406,  2.2458,  2.351 ,  2.4563,
         2.5615,  2.6667]),
 &lt;a list of 50 Patch objects&gt;)






(array([  1.,   0.,   1.,   0.,   0.,   1.,   0.,   1.,   1.,   0.,   4.,
          1.,   4.,   5.,  11.,   8.,   6.,  11.,  13.,  13.,  17.,  18.,
         20.,  27.,  32.,  29.,  31.,  22.,  21.,  31.,  29.,  19.,  22.,
         18.,  10.,  18.,  11.,  12.,   9.,   6.,   2.,   3.,   3.,   3.,
          2.,   1.,   1.,   1.,   0.,   1.]),
 array([-3.7454, -3.6052, -3.4651, -3.325 , -3.1849, -3.0448, -2.9047,
        -2.7646, -2.6244, -2.4843, -2.3442, -2.2041, -2.064 , -1.9239,
        -1.7837, -1.6436, -1.5035, -1.3634, -1.2233, -1.0832, -0.9431,
        -0.8029, -0.6628, -0.5227, -0.3826, -0.2425, -0.1024,  0.0377,
         0.1779,  0.318 ,  0.4581,  0.5982,  0.7383,  0.8784,  1.0185,
         1.1587,  1.2988,  1.4389,  1.579 ,  1.7191,  1.8592,  1.9994,
         2.1395,  2.2796,  2.4197,  2.5598,  2.6999,  2.84  ,  2.9802,
         3.1203,  3.2604]),
 &lt;a list of 50 Patch objects&gt;)






(array([  1.,   0.,   0.,   1.,   1.,   0.,   0.,   0.,   0.,   1.,   2.,
          5.,   9.,   8.,   6.,   2.,  11.,  17.,  10.,  13.,  10.,  14.,
         12.,  27.,  17.,  28.,  27.,  25.,  14.,  24.,  25.,  38.,  13.,
         24.,  15.,  10.,  17.,  14.,  13.,   8.,   7.,  10.,   3.,   7.,
          2.,   5.,   2.,   0.,   1.,   1.]),
 array([-3.4283, -3.3066, -3.185 , -3.0633, -2.9417, -2.8201, -2.6984,
        -2.5768, -2.4551, -2.3335, -2.2119, -2.0902, -1.9686, -1.847 ,
        -1.7253, -1.6037, -1.482 , -1.3604, -1.2388, -1.1171, -0.9955,
        -0.8739, -0.7522, -0.6306, -0.5089, -0.3873, -0.2657, -0.144 ,
        -0.0224,  0.0993,  0.2209,  0.3425,  0.4642,  0.5858,  0.7074,
         0.8291,  0.9507,  1.0724,  1.194 ,  1.3156,  1.4373,  1.5589,
         1.6806,  1.8022,  1.9238,  2.0455,  2.1671,  2.2887,  2.4104,
         2.532 ,  2.6537]),
 &lt;a list of 50 Patch objects&gt;)
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_16_4.png" alt="png"></p><h3 id="颜色、标记和线型"><a href="#颜色、标记和线型" class="headerlink" title="颜色、标记和线型"></a>颜色、标记和线型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plt.figure()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plt.plot(randn(<span class="number">30</span>).cumsum(), <span class="string">'ko--'</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_19_1.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plt.close(<span class="string">'all'</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = randn(<span class="number">30</span>).cumsum()</div><div class="line">plt.plot(data, <span class="string">'k--'</span>, label=<span class="string">'Default'</span>)</div><div class="line">plt.plot(data, <span class="string">'k-'</span>, drawstyle=<span class="string">'steps-post'</span>, label=<span class="string">'steps-post'</span>)</div><div class="line">plt.legend(loc=<span class="string">'best'</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_21_3.png" alt="png"></p><h3 id="刻度、标签和图例"><a href="#刻度、标签和图例" class="headerlink" title="刻度、标签和图例"></a>刻度、标签和图例</h3><h4 id="设置标题、轴标签、刻度以及刻度标签"><a href="#设置标题、轴标签、刻度以及刻度标签" class="headerlink" title="设置标题、轴标签、刻度以及刻度标签"></a>设置标题、轴标签、刻度以及刻度标签</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">fig = plt.figure(); ax = fig.add_subplot(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</div><div class="line">ax.plot(randn(<span class="number">1000</span>).cumsum())</div><div class="line"></div><div class="line">ticks = ax.set_xticks([<span class="number">0</span>, <span class="number">250</span>, <span class="number">500</span>, <span class="number">750</span>, <span class="number">1000</span>])</div><div class="line">labels = ax.set_xticklabels([<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>, <span class="string">'five'</span>],</div><div class="line">                            rotation=<span class="number">30</span>, fontsize=<span class="string">'small'</span>)</div><div class="line">ax.set_title(<span class="string">'My first matplotlib plot'</span>)</div><div class="line">ax.set_xlabel(<span class="string">'Stages'</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_24_3.png" alt="png"></p><h4 id="添加图例"><a href="#添加图例" class="headerlink" title="添加图例"></a>添加图例</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">fig = plt.figure(); ax = fig.add_subplot(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</div><div class="line">ax.plot(randn(<span class="number">1000</span>).cumsum(), <span class="string">'k'</span>, label=<span class="string">'one'</span>)</div><div class="line">ax.plot(randn(<span class="number">1000</span>).cumsum(), <span class="string">'k--'</span>, label=<span class="string">'two'</span>)</div><div class="line">ax.plot(randn(<span class="number">1000</span>).cumsum(), <span class="string">'k.'</span>, label=<span class="string">'three'</span>)</div><div class="line"></div><div class="line">ax.legend(loc=<span class="string">'best'</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_26_4.png" alt="png"></p><h3 id="注解以及在subplot上绘图"><a href="#注解以及在subplot上绘图" class="headerlink" title="注解以及在subplot上绘图"></a>注解以及在subplot上绘图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"></div><div class="line">fig = plt.figure()</div><div class="line">ax = fig.add_subplot(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</div><div class="line"></div><div class="line">data = pd.read_csv(<span class="string">'ch08/spx.csv'</span>, index_col=<span class="number">0</span>, parse_dates=<span class="keyword">True</span>)</div><div class="line">spx = data[<span class="string">'SPX'</span>]</div><div class="line"></div><div class="line">spx.plot(ax=ax, style=<span class="string">'k-'</span>)</div><div class="line"></div><div class="line">crisis_data = [</div><div class="line">    (datetime(<span class="number">2007</span>, <span class="number">10</span>, <span class="number">11</span>), <span class="string">'Peak of bull market'</span>),</div><div class="line">    (datetime(<span class="number">2008</span>, <span class="number">3</span>, <span class="number">12</span>), <span class="string">'Bear Stearns Fails'</span>),</div><div class="line">    (datetime(<span class="number">2008</span>, <span class="number">9</span>, <span class="number">15</span>), <span class="string">'Lehman Bankruptcy'</span>)</div><div class="line">]</div><div class="line"></div><div class="line"><span class="keyword">for</span> date, label <span class="keyword">in</span> crisis_data:</div><div class="line">    ax.annotate(label, xy=(date, spx.asof(date) + <span class="number">50</span>),</div><div class="line">                xytext=(date, spx.asof(date) + <span class="number">200</span>),</div><div class="line">                arrowprops=dict(facecolor=<span class="string">'black'</span>),</div><div class="line">                horizontalalignment=<span class="string">'left'</span>, verticalalignment=<span class="string">'top'</span>)</div><div class="line"></div><div class="line"><span class="comment"># Zoom in on 2007-2010</span></div><div class="line">ax.set_xlim([<span class="string">'1/1/2007'</span>, <span class="string">'1/1/2011'</span>])</div><div class="line">ax.set_ylim([<span class="number">600</span>, <span class="number">1800</span>])</div><div class="line"></div><div class="line">ax.set_title(<span class="string">'Important dates in 2008-2009 financial crisis'</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_28_7.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">fig = plt.figure()</div><div class="line">ax = fig.add_subplot(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</div><div class="line"></div><div class="line">rect = plt.Rectangle((<span class="number">0.2</span>, <span class="number">0.75</span>), <span class="number">0.4</span>, <span class="number">0.15</span>, color=<span class="string">'k'</span>, alpha=<span class="number">0.3</span>)</div><div class="line">circ = plt.Circle((<span class="number">0.7</span>, <span class="number">0.2</span>), <span class="number">0.15</span>, color=<span class="string">'b'</span>, alpha=<span class="number">0.3</span>)</div><div class="line">pgon = plt.Polygon([[<span class="number">0.15</span>, <span class="number">0.15</span>], [<span class="number">0.35</span>, <span class="number">0.4</span>], [<span class="number">0.2</span>, <span class="number">0.6</span>]],</div><div class="line">                   color=<span class="string">'g'</span>, alpha=<span class="number">0.5</span>)</div><div class="line"></div><div class="line">ax.add_patch(rect)</div><div class="line">ax.add_patch(circ)</div><div class="line">ax.add_patch(pgon)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_29_3.png" alt="png"></p><h3 id="将图表保存到文件"><a href="#将图表保存到文件" class="headerlink" title="将图表保存到文件"></a>将图表保存到文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fig</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_31_0.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fig.savefig(<span class="string">'figpath.svg'</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fig.savefig(<span class="string">'figpath.png'</span>, dpi=<span class="number">400</span>, bbox_inches=<span class="string">'tight'</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</div><div class="line">buffer = BytesIO()</div><div class="line">plt.savefig(buffer)</div><div class="line">plot_data = buffer.getvalue()</div></pre></td></tr></table></figure><pre><code>&lt;matplotlib.figure.Figure at 0xaebe550&gt;
</code></pre><h3 id="matplotlib-配置"><a href="#matplotlib-配置" class="headerlink" title="matplotlib 配置"></a>matplotlib 配置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plt.rc(<span class="string">'figure'</span>, figsize=(<span class="number">10</span>, <span class="number">10</span>))</div></pre></td></tr></table></figure><h2 id="pandas中的绘图函数"><a href="#pandas中的绘图函数" class="headerlink" title="pandas中的绘图函数"></a>pandas中的绘图函数</h2><h3 id="线型图"><a href="#线型图" class="headerlink" title="线型图"></a>线型图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plt.close(<span class="string">'all'</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">s = Series(np.random.randn(<span class="number">10</span>).cumsum(), index=np.arange(<span class="number">0</span>, <span class="number">100</span>, <span class="number">10</span>))</div><div class="line">s.plot()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_40_1.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(np.random.randn(<span class="number">10</span>, <span class="number">4</span>).cumsum(<span class="number">0</span>),</div><div class="line">               columns=[<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>],</div><div class="line">               index=np.arange(<span class="number">0</span>, <span class="number">100</span>, <span class="number">10</span>))</div><div class="line">df.plot()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_41_1.png" alt="png"></p><h3 id="柱状图"><a href="#柱状图" class="headerlink" title="柱状图"></a>柱状图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">1</span>)</div><div class="line">data = Series(np.random.rand(<span class="number">16</span>), index=list(<span class="string">'abcdefghijklmnop'</span>))</div><div class="line">data.plot(kind=<span class="string">'bar'</span>, ax=axes[<span class="number">0</span>], color=<span class="string">'k'</span>, alpha=<span class="number">0.7</span>)</div><div class="line">data.plot(kind=<span class="string">'barh'</span>, ax=axes[<span class="number">1</span>], color=<span class="string">'k'</span>, alpha=<span class="number">0.7</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_43_2.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(np.random.rand(<span class="number">6</span>, <span class="number">4</span>),</div><div class="line">               index=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>, <span class="string">'five'</span>, <span class="string">'six'</span>],</div><div class="line">               columns=pd.Index([<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>], name=<span class="string">'Genus'</span>))</div><div class="line">df</div><div class="line">df.plot(kind=<span class="string">'bar'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>Genus</th><th>A</th><th>B</th><th>C</th><th>D</th></tr></thead><tbody><tr><th>one</th><td>0.301686</td><td>0.156333</td><td>0.371943</td><td>0.270731</td></tr><tr><th>two</th><td>0.750589</td><td>0.525587</td><td>0.689429</td><td>0.358974</td></tr><tr><th>three</th><td>0.381504</td><td>0.667707</td><td>0.473772</td><td>0.632528</td></tr><tr><th>four</th><td>0.942408</td><td>0.180186</td><td>0.708284</td><td>0.641783</td></tr><tr><th>five</th><td>0.840278</td><td>0.909589</td><td>0.010041</td><td>0.653207</td></tr><tr><th>six</th><td>0.062854</td><td>0.589813</td><td>0.811318</td><td>0.060217</td></tr></tbody></table></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_44_2.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plt.figure()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.plot(kind=<span class="string">'barh'</span>, stacked=<span class="keyword">True</span>, alpha=<span class="number">0.5</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_46_1.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">tips = pd.read_csv(<span class="string">'ch08/tips.csv'</span>)</div><div class="line">party_counts = pd.crosstab(tips.day, tips.size_)</div><div class="line">party_counts</div><div class="line"><span class="comment"># Not many 1- and 6-person parties</span></div><div class="line">party_counts = party_counts.ix[:, <span class="number">2</span>:<span class="number">5</span>]</div><div class="line">party_counts</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>size_</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th></tr><tr><th>day</th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>Fri</th><td>1</td><td>16</td><td>1</td><td>1</td><td>0</td><td>0</td></tr><tr><th>Sat</th><td>2</td><td>53</td><td>18</td><td>13</td><td>1</td><td>0</td></tr><tr><th>Sun</th><td>0</td><td>39</td><td>15</td><td>18</td><td>3</td><td>1</td></tr><tr><th>Thur</th><td>1</td><td>48</td><td>4</td><td>5</td><td>1</td><td>3</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>size_</th><th>2</th><th>3</th><th>4</th><th>5</th></tr><tr><th>day</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>Fri</th><td>16</td><td>1</td><td>1</td><td>0</td></tr><tr><th>Sat</th><td>53</td><td>18</td><td>13</td><td>1</td></tr><tr><th>Sun</th><td>39</td><td>15</td><td>18</td><td>3</td></tr><tr><th>Thur</th><td>48</td><td>4</td><td>5</td><td>1</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Normalize to sum to 1</span></div><div class="line">party_pcts = party_counts.div(party_counts.sum(<span class="number">1</span>).astype(float), axis=<span class="number">0</span>)</div><div class="line">party_pcts</div><div class="line"></div><div class="line">party_pcts.plot(kind=<span class="string">'bar'</span>, stacked=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>size_</th><th>2</th><th>3</th><th>4</th><th>5</th></tr><tr><th>day</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>Fri</th><td>0.888889</td><td>0.055556</td><td>0.055556</td><td>0.000000</td></tr><tr><th>Sat</th><td>0.623529</td><td>0.211765</td><td>0.152941</td><td>0.011765</td></tr><tr><th>Sun</th><td>0.520000</td><td>0.200000</td><td>0.240000</td><td>0.040000</td></tr><tr><th>Thur</th><td>0.827586</td><td>0.068966</td><td>0.086207</td><td>0.017241</td></tr></tbody></table></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_48_2.png" alt="png"></p><h3 id="直方图和密度图"><a href="#直方图和密度图" class="headerlink" title="直方图和密度图"></a>直方图和密度图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plt.figure()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tips[<span class="string">'tip_pct'</span>] = tips[<span class="string">'tip'</span>] / tips[<span class="string">'total_bill'</span>]</div><div class="line">tips[<span class="string">'tip_pct'</span>].hist(bins=<span class="number">50</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_51_1.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plt.figure()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tips[<span class="string">'tip_pct'</span>].plot(kind=<span class="string">'kde'</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_53_1.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plt.figure()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">comp1 = np.random.normal(<span class="number">0</span>, <span class="number">1</span>, size=<span class="number">200</span>)  <span class="comment"># N(0, 1)</span></div><div class="line">comp2 = np.random.normal(<span class="number">10</span>, <span class="number">2</span>, size=<span class="number">200</span>)  <span class="comment"># N(10, 4)</span></div><div class="line">values = Series(np.concatenate([comp1, comp2]))</div><div class="line">values.hist(bins=<span class="number">100</span>, alpha=<span class="number">0.3</span>, color=<span class="string">'k'</span>, normed=<span class="keyword">True</span>)</div><div class="line">values.plot(kind=<span class="string">'kde'</span>, style=<span class="string">'k--'</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_55_2.png" alt="png"></p><h3 id="散点图"><a href="#散点图" class="headerlink" title="散点图"></a>散点图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">macro = pd.read_csv(<span class="string">'ch08/macrodata.csv'</span>)</div><div class="line">data = macro[[<span class="string">'cpi'</span>, <span class="string">'m1'</span>, <span class="string">'tbilrate'</span>, <span class="string">'unemp'</span>]]</div><div class="line">trans_data = np.log(data).diff().dropna()</div><div class="line">trans_data[<span class="number">-5</span>:]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>cpi</th><th>m1</th><th>tbilrate</th><th>unemp</th></tr></thead><tbody><tr><th>198</th><td>-0.007904</td><td>0.045361</td><td>-0.396881</td><td>0.105361</td></tr><tr><th>199</th><td>-0.021979</td><td>0.066753</td><td>-2.277267</td><td>0.139762</td></tr><tr><th>200</th><td>0.002340</td><td>0.010286</td><td>0.606136</td><td>0.160343</td></tr><tr><th>201</th><td>0.008419</td><td>0.037461</td><td>-0.200671</td><td>0.127339</td></tr><tr><th>202</th><td>0.008894</td><td>0.012202</td><td>-0.405465</td><td>0.042560</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plt.figure()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">plt.scatter(trans_data[<span class="string">'m1'</span>], trans_data[<span class="string">'unemp'</span>])</div><div class="line">plt.title(<span class="string">'Changes in log %s vs. log %s'</span> % (<span class="string">'m1'</span>, <span class="string">'unemp'</span>))</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_59_2.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.scatter_matrix(trans_data, diagonal=<span class="string">'kde'</span>, c=<span class="string">'k'</span>, alpha=<span class="number">0.3</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_60_1.png" alt="png"></p><h2 id="绘制地图：图形化显示海底地震危机数据"><a href="#绘制地图：图形化显示海底地震危机数据" class="headerlink" title="绘制地图：图形化显示海底地震危机数据"></a>绘制地图：图形化显示海底地震危机数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data = pd.read_csv(<span class="string">'ch08/Haiti.csv'</span>)</div><div class="line">data.info()</div></pre></td></tr></table></figure><pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 3593 entries, 0 to 3592
Data columns (total 10 columns):
Serial            3593 non-null int64
INCIDENT TITLE    3593 non-null object
INCIDENT DATE     3593 non-null object
LOCATION          3592 non-null object
DESCRIPTION       3593 non-null object
CATEGORY          3587 non-null object
LATITUDE          3593 non-null float64
LONGITUDE         3593 non-null float64
APPROVED          3593 non-null object
VERIFIED          3593 non-null object
dtypes: float64(2), int64(1), object(7)
memory usage: 280.8+ KB
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[[<span class="string">'INCIDENT DATE'</span>, <span class="string">'LATITUDE'</span>, <span class="string">'LONGITUDE'</span>]][:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>INCIDENT DATE</th><th>LATITUDE</th><th>LONGITUDE</th></tr></thead><tbody><tr><th>0</th><td>05/07/2010 17:26</td><td>18.233333</td><td>-72.533333</td></tr><tr><th>1</th><td>28/06/2010 23:06</td><td>50.226029</td><td>5.729886</td></tr><tr><th>2</th><td>24/06/2010 16:21</td><td>22.278381</td><td>114.174287</td></tr><tr><th>3</th><td>20/06/2010 21:59</td><td>44.407062</td><td>8.933989</td></tr><tr><th>4</th><td>18/05/2010 16:26</td><td>18.571084</td><td>-72.334671</td></tr><tr><th>5</th><td>26/04/2010 13:14</td><td>18.593707</td><td>-72.310079</td></tr><tr><th>6</th><td>26/04/2010 14:19</td><td>18.482800</td><td>-73.638800</td></tr><tr><th>7</th><td>26/04/2010 14:27</td><td>18.415000</td><td>-73.195000</td></tr><tr><th>8</th><td>15/03/2010 10:58</td><td>18.517443</td><td>-72.236841</td></tr><tr><th>9</th><td>15/03/2010 11:00</td><td>18.547790</td><td>-72.410010</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'CATEGORY'</span>][:<span class="number">6</span>]</div></pre></td></tr></table></figure><pre><code>0          1. Urgences | Emergency, 3. Public Health, 
1    1. Urgences | Emergency, 2. Urgences logistiqu...
2    2. Urgences logistiques | Vital Lines, 8. Autr...
3                            1. Urgences | Emergency, 
4                            1. Urgences | Emergency, 
5                       5e. Communication lines down, 
Name: CATEGORY, dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.describe()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Serial</th><th>LATITUDE</th><th>LONGITUDE</th></tr></thead><tbody><tr><th>count</th><td>3593.000000</td><td>3593.000000</td><td>3593.000000</td></tr><tr><th>mean</th><td>2080.277484</td><td>18.611495</td><td>-72.322680</td></tr><tr><th>std</th><td>1171.100360</td><td>0.738572</td><td>3.650776</td></tr><tr><th>min</th><td>4.000000</td><td>18.041313</td><td>-74.452757</td></tr><tr><th>25%</th><td>1074.000000</td><td>18.524070</td><td>-72.417500</td></tr><tr><th>50%</th><td>2163.000000</td><td>18.539269</td><td>-72.335000</td></tr><tr><th>75%</th><td>3088.000000</td><td>18.561820</td><td>-72.293570</td></tr><tr><th>max</th><td>4052.000000</td><td>50.226029</td><td>114.174287</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data = data[(data.LATITUDE &gt; <span class="number">18</span>) &amp; (data.LATITUDE &lt; <span class="number">20</span>) &amp;</div><div class="line">            (data.LONGITUDE &gt; <span class="number">-75</span>) &amp; (data.LONGITUDE &lt; <span class="number">-70</span>)</div><div class="line">            &amp; data.CATEGORY.notnull()]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_cat_list</span><span class="params">(catstr)</span>:</span></div><div class="line">    stripped = (x.strip() <span class="keyword">for</span> x <span class="keyword">in</span> catstr.split(<span class="string">','</span>))</div><div class="line">    <span class="keyword">return</span> [x <span class="keyword">for</span> x <span class="keyword">in</span> stripped <span class="keyword">if</span> x]</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_all_categories</span><span class="params">(cat_series)</span>:</span></div><div class="line">    cat_sets = (set(to_cat_list(x)) <span class="keyword">for</span> x <span class="keyword">in</span> cat_series)</div><div class="line">    <span class="keyword">return</span> sorted(set.union(*cat_sets))</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_english</span><span class="params">(cat)</span>:</span></div><div class="line">    code, names = cat.split(<span class="string">'.'</span>)</div><div class="line">    <span class="keyword">if</span> <span class="string">'|'</span> <span class="keyword">in</span> names:</div><div class="line">        names = names.split(<span class="string">' | '</span>)[<span class="number">1</span>]</div><div class="line">    <span class="keyword">return</span> code, names.strip()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">get_english(<span class="string">'2. Urgences logistiques | Vital Lines'</span>)</div></pre></td></tr></table></figure><pre><code>(&#39;2&#39;, &#39;Vital Lines&#39;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">all_cats = get_all_categories(data.CATEGORY)</div><div class="line"><span class="comment"># Generator expression</span></div><div class="line">english_mapping = dict(get_english(x) <span class="keyword">for</span> x <span class="keyword">in</span> all_cats)</div><div class="line">english_mapping[<span class="string">'2a'</span>]</div><div class="line">english_mapping[<span class="string">'6c'</span>]</div></pre></td></tr></table></figure><pre><code>&#39;Food Shortage&#39;






&#39;Earthquake and aftershocks&#39;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_code</span><span class="params">(seq)</span>:</span></div><div class="line">    <span class="keyword">return</span> [x.split(<span class="string">'.'</span>)[<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> seq <span class="keyword">if</span> x]</div><div class="line"></div><div class="line">all_codes = get_code(all_cats)</div><div class="line">code_index = pd.Index(np.unique(all_codes))</div><div class="line">dummy_frame = DataFrame(np.zeros((len(data), len(code_index))),</div><div class="line">                        index=data.index, columns=code_index)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dummy_frame.ix[:, :<span class="number">6</span>].info()</div></pre></td></tr></table></figure><pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 3569 entries, 0 to 3592
Data columns (total 6 columns):
1     3569 non-null float64
1a    3569 non-null float64
1b    3569 non-null float64
1c    3569 non-null float64
1d    3569 non-null float64
2     3569 non-null float64
dtypes: float64(6)
memory usage: 195.2 KB
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> row, cat <span class="keyword">in</span> zip(data.index, data.CATEGORY):</div><div class="line">    codes = get_code(to_cat_list(cat))</div><div class="line">    dummy_frame.ix[row, codes] = <span class="number">1</span></div><div class="line"></div><div class="line">data = data.join(dummy_frame.add_prefix(<span class="string">'category_'</span>))</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[:, <span class="number">10</span>:<span class="number">15</span>].info()</div></pre></td></tr></table></figure><pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 3569 entries, 0 to 3592
Data columns (total 5 columns):
category_1     3569 non-null float64
category_1a    3569 non-null float64
category_1b    3569 non-null float64
category_1c    3569 non-null float64
category_1d    3569 non-null float64
dtypes: float64(5)
memory usage: 167.3 KB
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> mpl_toolkits.basemap <span class="keyword">import</span> Basemap</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">basic_haiti_map</span><span class="params">(ax=None, lllat=<span class="number">17.25</span>, urlat=<span class="number">20.25</span>,</span></span></div><div class="line">                    lllon=<span class="number">-75</span>, urlon=<span class="number">-71</span>):</div><div class="line">    <span class="comment"># create polar stereographic Basemap instance.</span></div><div class="line">    m = Basemap(ax=ax, projection=<span class="string">'stere'</span>,</div><div class="line">                lon_0=(urlon + lllon) / <span class="number">2</span>,</div><div class="line">                lat_0=(urlat + lllat) / <span class="number">2</span>,</div><div class="line">                llcrnrlat=lllat, urcrnrlat=urlat,</div><div class="line">                llcrnrlon=lllon, urcrnrlon=urlon,</div><div class="line">                resolution=<span class="string">'f'</span>)</div><div class="line">    <span class="comment"># draw coastlines, state and country boundaries, edge of map.</span></div><div class="line">    m.drawcoastlines()</div><div class="line">    m.drawstates()</div><div class="line">    m.drawcountries()</div><div class="line">    <span class="keyword">return</span> m</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">fig, axes = plt.subplots(nrows=<span class="number">2</span>, ncols=<span class="number">2</span>, figsize=(<span class="number">12</span>, <span class="number">10</span>))</div><div class="line">fig.subplots_adjust(hspace=<span class="number">0.05</span>, wspace=<span class="number">0.05</span>)</div><div class="line"></div><div class="line">to_plot = [<span class="string">'2a'</span>, <span class="string">'1'</span>, <span class="string">'3c'</span>, <span class="string">'7a'</span>]</div><div class="line"></div><div class="line">lllat=<span class="number">17.25</span>; urlat=<span class="number">20.25</span>; lllon=<span class="number">-75</span>; urlon=<span class="number">-71</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> code, ax <span class="keyword">in</span> zip(to_plot, axes.flat):</div><div class="line">    m = basic_haiti_map(ax, lllat=lllat, urlat=urlat,</div><div class="line">                        lllon=lllon, urlon=urlon)</div><div class="line"></div><div class="line">    cat_data = data[data[<span class="string">'category_%s'</span> % code] == <span class="number">1</span>]</div><div class="line"></div><div class="line">    <span class="comment"># compute map proj coordinates.</span></div><div class="line">    x, y = m(cat_data.LONGITUDE.values, cat_data.LATITUDE.values)</div><div class="line"></div><div class="line">    m.plot(x, y, <span class="string">'k.'</span>, alpha=<span class="number">0.5</span>)</div><div class="line">    ax.set_title(<span class="string">'%s: %s'</span> % (code, english_mapping[code]))</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\envs\ipykernel_py2\lib\site-packages\mpl_toolkits\basemap\__init__.py:3260: MatplotlibDeprecationWarning: The ishold function was deprecated in version 2.0.
  b = ax.ishold()
C:\Users\Ewan\Anaconda3\envs\ipykernel_py2\lib\site-packages\mpl_toolkits\basemap\__init__.py:3269: MatplotlibDeprecationWarning: axes.hold is deprecated.
    See the API Changes document (http://matplotlib.org/api/api_changes.html)
    for more details.
  ax.hold(b)
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_75_9.png" alt="png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#街道数据的路径</span></div><div class="line">shapefilepath = <span class="string">'ch08/PortAuPrince_Roads/PortAuPrince_Roads'</span></div><div class="line"></div><div class="line">fig = plt.figure()</div><div class="line">ax = fig.add_subplot(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</div><div class="line"></div><div class="line">lat0 = <span class="number">18.533333</span>;lon0 = <span class="number">-72.333333</span>;change = <span class="number">0.13</span>;</div><div class="line">lllat=lat0-change; urlat=lat0+change; lllon=lon0-change; urlon=lon0+change;</div><div class="line"></div><div class="line">m = basic_haiti_map(ax, lllat=lllat, urlat=urlat,lllon=lllon, urlon=urlon)</div><div class="line"></div><div class="line">m.readshapefile(shapefilepath,<span class="string">'roads'</span>) <span class="comment">#添加街道数据</span></div><div class="line"></div><div class="line">code = <span class="string">'2a'</span></div><div class="line">cat_data = data[data[<span class="string">'category_%s'</span> % code] == <span class="number">1</span>]</div><div class="line"></div><div class="line"><span class="comment"># compute map proj coordinates.</span></div><div class="line">x, y = m(cat_data.LONGITUDE.values, cat_data.LATITUDE.values)</div><div class="line"></div><div class="line">m.plot(x, y, <span class="string">'k.'</span>, alpha=<span class="number">0.5</span>)</div><div class="line">ax.set_title(<span class="string">'Food shortages reported in Port-au-Prince'</span>)</div><div class="line"><span class="comment"># plt.savefig('myfig.png',dpi=400,bbox_inches='tight')</span></div></pre></td></tr></table></figure><pre><code>(1583,
 3,
 [-72.749246, 18.409952, 0.0, 0.0],
 [-71.973789, 18.7147105, 0.0, 0.0],
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch08/output_76_3.png" alt="png"></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;绘图和可视化&quot;&gt;&lt;a href=&quot;#绘图和可视化&quot; class=&quot;headerlink&quot; title=&quot;绘图和可视化&quot;&gt;&lt;/a&gt;绘图和可视化&lt;/h1&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gu
    
    </summary>
    
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
      <category term="matplotlib" scheme="http://yoursite.com/tags/matplotlib/"/>
    
  </entry>
  
  <entry>
    <title>cs231n Assignment#1 softmax</title>
    <link href="http://yoursite.com/2017/03/05/cs231n-Assignment-1-softmax/"/>
    <id>http://yoursite.com/2017/03/05/cs231n-Assignment-1-softmax/</id>
    <published>2017-03-05T03:07:45.000Z</published>
    <updated>2017-03-05T03:14:56.331Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Softmax-exercise"><a href="#Softmax-exercise" class="headerlink" title="Softmax exercise"></a>Softmax exercise</h1><p><em>Complete and hand in this completed worksheet (including its outputs and any supporting code outside of the worksheet) with your assignment submission. For more details see the <a href="http://vision.stanford.edu/teaching/cs231n/assignments.html" target="_blank" rel="external">assignments page</a> on the course website.</em></p><p>This exercise is analogous to the SVM exercise. You will:</p><ul><li>implement a fully-vectorized <strong>loss function</strong> for the Softmax classifier</li><li>implement the fully-vectorized expression for its <strong>analytic gradient</strong></li><li><strong>check your implementation</strong> with numerical gradient</li><li>use a validation set to <strong>tune the learning rate and regularization</strong> strength</li><li><strong>optimize</strong> the loss function with <strong>SGD</strong></li><li><strong>visualize</strong> the final learned weights</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> random</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> cs231n.data_utils <span class="keyword">import</span> load_CIFAR10</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">%matplotlib inline</div><div class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">10.0</span>, <span class="number">8.0</span>) <span class="comment"># set default size of plots</span></div><div class="line">plt.rcParams[<span class="string">'image.interpolation'</span>] = <span class="string">'nearest'</span></div><div class="line">plt.rcParams[<span class="string">'image.cmap'</span>] = <span class="string">'gray'</span></div><div class="line"></div><div class="line"><span class="comment"># for auto-reloading extenrnal modules</span></div><div class="line"><span class="comment"># see http://stackoverflow.com/questions/1907993/autoreload-of-modules-in-ipython</span></div><div class="line">%load_ext autoreload</div><div class="line">%autoreload <span class="number">2</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_CIFAR10_data</span><span class="params">(num_training=<span class="number">49000</span>, num_validation=<span class="number">1000</span>, num_test=<span class="number">1000</span>, num_dev=<span class="number">500</span>)</span>:</span></div><div class="line">  <span class="string">"""</span></div><div class="line">  Load the CIFAR-10 dataset from disk and perform preprocessing to prepare</div><div class="line">  it for the linear classifier. These are the same steps as we used for the</div><div class="line">  SVM, but condensed to a single function.  </div><div class="line">  """</div><div class="line">  <span class="comment"># Load the raw CIFAR-10 data</span></div><div class="line">  cifar10_dir = <span class="string">'cs231n/datasets/cifar-10-batches-py'</span></div><div class="line">  X_train, y_train, X_test, y_test = load_CIFAR10(cifar10_dir)</div><div class="line">  </div><div class="line">  <span class="comment"># subsample the data</span></div><div class="line">  mask = range(num_training, num_training + num_validation)</div><div class="line">  X_val = X_train[mask]</div><div class="line">  y_val = y_train[mask]</div><div class="line">  mask = range(num_training)</div><div class="line">  X_train = X_train[mask]</div><div class="line">  y_train = y_train[mask]</div><div class="line">  mask = range(num_test)</div><div class="line">  X_test = X_test[mask]</div><div class="line">  y_test = y_test[mask]</div><div class="line">  mask = np.random.choice(num_training, num_dev, replace=<span class="keyword">False</span>)</div><div class="line">  X_dev = X_train[mask]</div><div class="line">  y_dev = y_train[mask]</div><div class="line">  </div><div class="line">  <span class="comment"># Preprocessing: reshape the image data into rows</span></div><div class="line">  X_train = np.reshape(X_train, (X_train.shape[<span class="number">0</span>], <span class="number">-1</span>))</div><div class="line">  X_val = np.reshape(X_val, (X_val.shape[<span class="number">0</span>], <span class="number">-1</span>))</div><div class="line">  X_test = np.reshape(X_test, (X_test.shape[<span class="number">0</span>], <span class="number">-1</span>))</div><div class="line">  X_dev = np.reshape(X_dev, (X_dev.shape[<span class="number">0</span>], <span class="number">-1</span>))</div><div class="line">  </div><div class="line">  <span class="comment"># Normalize the data: subtract the mean image</span></div><div class="line">  mean_image = np.mean(X_train, axis = <span class="number">0</span>)</div><div class="line">  X_train -= mean_image</div><div class="line">  X_val -= mean_image</div><div class="line">  X_test -= mean_image</div><div class="line">  X_dev -= mean_image</div><div class="line">  </div><div class="line">  <span class="comment"># add bias dimension and transform into columns</span></div><div class="line">  X_train = np.hstack([X_train, np.ones((X_train.shape[<span class="number">0</span>], <span class="number">1</span>))])</div><div class="line">  X_val = np.hstack([X_val, np.ones((X_val.shape[<span class="number">0</span>], <span class="number">1</span>))])</div><div class="line">  X_test = np.hstack([X_test, np.ones((X_test.shape[<span class="number">0</span>], <span class="number">1</span>))])</div><div class="line">  X_dev = np.hstack([X_dev, np.ones((X_dev.shape[<span class="number">0</span>], <span class="number">1</span>))])</div><div class="line">  </div><div class="line">  <span class="keyword">return</span> X_train, y_train, X_val, y_val, X_test, y_test, X_dev, y_dev</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Invoke the above function to get our data.</span></div><div class="line">X_train, y_train, X_val, y_val, X_test, y_test, X_dev, y_dev = get_CIFAR10_data()</div><div class="line"><span class="keyword">print</span> <span class="string">'Train data shape: '</span>, X_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Train labels shape: '</span>, y_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Validation data shape: '</span>, X_val.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Validation labels shape: '</span>, y_val.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test data shape: '</span>, X_test.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test labels shape: '</span>, y_test.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'dev data shape: '</span>, X_dev.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'dev labels shape: '</span>, y_dev.shape</div></pre></td></tr></table></figure><pre><code>Train data shape:  (49000L, 3073L)
Train labels shape:  (49000L,)
Validation data shape:  (1000L, 3073L)
Validation labels shape:  (1000L,)
Test data shape:  (1000L, 3073L)
Test labels shape:  (1000L,)
dev data shape:  (500L, 3073L)
dev labels shape:  (500L,)
</code></pre><h2 id="Softmax-Classifier"><a href="#Softmax-Classifier" class="headerlink" title="Softmax Classifier"></a>Softmax Classifier</h2><p>Your code for this section will all be written inside <strong>cs231n/classifiers/softmax.py</strong>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># First implement the naive softmax loss function with nested loops.</span></div><div class="line"><span class="comment"># Open the file cs231n/classifiers/softmax.py and implement the</span></div><div class="line"><span class="comment"># softmax_loss_naive function.</span></div><div class="line"></div><div class="line"><span class="keyword">from</span> cs231n.classifiers.softmax <span class="keyword">import</span> softmax_loss_naive</div><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line"><span class="comment"># Generate a random softmax weight matrix and use it to compute the loss.</span></div><div class="line">W = np.random.randn(<span class="number">3073</span>, <span class="number">10</span>) * <span class="number">0.0001</span></div><div class="line">loss, grad = softmax_loss_naive(W, X_dev, y_dev, <span class="number">0.0</span>)</div><div class="line"></div><div class="line"><span class="comment"># As a rough sanity check, our loss should be something close to -log(0.1).</span></div><div class="line"><span class="keyword">print</span> <span class="string">'loss: %f'</span> % loss</div><div class="line"><span class="keyword">print</span> <span class="string">'sanity check: %f'</span> % (-np.log(<span class="number">0.1</span>))</div></pre></td></tr></table></figure><pre><code>loss: 2.395985
sanity check: 2.302585
</code></pre><h2 id="Inline-Question-1"><a href="#Inline-Question-1" class="headerlink" title="Inline Question 1:"></a>Inline Question 1:</h2><p>Why do we expect our loss to be close to -log(0.1)? Explain briefly.</p><p><strong>Your answer:</strong> <em>Because the W is selected by random, so the probability of select the true class is 1/10. That is, 0.1.</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Complete the implementation of softmax_loss_naive and implement a (naive)</span></div><div class="line"><span class="comment"># version of the gradient that uses nested loops.</span></div><div class="line">loss, grad = softmax_loss_naive(W, X_dev, y_dev, <span class="number">0.0</span>)</div><div class="line"></div><div class="line"><span class="comment"># As we did for the SVM, use numeric gradient checking as a debugging tool.</span></div><div class="line"><span class="comment"># The numeric gradient should be close to the analytic gradient.</span></div><div class="line"><span class="keyword">from</span> cs231n.gradient_check <span class="keyword">import</span> grad_check_sparse</div><div class="line">f = <span class="keyword">lambda</span> w: softmax_loss_naive(w, X_dev, y_dev, <span class="number">0.0</span>)[<span class="number">0</span>]</div><div class="line">grad_numerical = grad_check_sparse(f, W, grad, <span class="number">10</span>)</div><div class="line"></div><div class="line"><span class="comment"># similar to SVM case, do another gradient check with regularization</span></div><div class="line">loss, grad = softmax_loss_naive(W, X_dev, y_dev, <span class="number">1e2</span>)</div><div class="line">f = <span class="keyword">lambda</span> w: softmax_loss_naive(w, X_dev, y_dev, <span class="number">1e2</span>)[<span class="number">0</span>]</div><div class="line">grad_numerical = grad_check_sparse(f, W, grad, <span class="number">10</span>)</div></pre></td></tr></table></figure><pre><code>numerical: 2.368141 analytic: 2.368141, relative error: 2.349797e-08
numerical: 1.324690 analytic: 1.324690, relative error: 7.140560e-08
numerical: 3.170412 analytic: 3.170411, relative error: 1.324741e-08
numerical: 0.249509 analytic: 0.249509, relative error: 2.647240e-08
numerical: 1.536095 analytic: 1.536095, relative error: 4.345856e-08
numerical: 1.075819 analytic: 1.075819, relative error: 3.902323e-08
numerical: -0.198098 analytic: -0.198098, relative error: 5.737134e-08
numerical: -0.089902 analytic: -0.089902, relative error: 8.604010e-07
numerical: -0.339487 analytic: -0.339487, relative error: 3.992996e-08
numerical: -4.819781 analytic: -4.819781, relative error: 3.465667e-09
numerical: 1.869922 analytic: 1.869921, relative error: 7.536693e-08
numerical: 0.783465 analytic: 0.783465, relative error: 6.960291e-08
numerical: -3.206007 analytic: -3.206007, relative error: 2.337350e-09
numerical: 0.532183 analytic: 0.532183, relative error: 1.498128e-07
numerical: 0.900500 analytic: 0.900500, relative error: 6.954913e-09
numerical: -0.353224 analytic: -0.353224, relative error: 1.836960e-07
numerical: -1.331470 analytic: -1.331470, relative error: 2.726426e-08
numerical: -0.082452 analytic: -0.082452, relative error: 7.712355e-07
numerical: -1.322133 analytic: -1.322133, relative error: 5.516628e-09
numerical: 0.345814 analytic: 0.345814, relative error: 1.251858e-07
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Now that we have a naive implementation of the softmax loss function and its gradient,</span></div><div class="line"><span class="comment"># implement a vectorized version in softmax_loss_vectorized.</span></div><div class="line"><span class="comment"># The two versions should compute the same results, but the vectorized version should be</span></div><div class="line"><span class="comment"># much faster.</span></div><div class="line">tic = time.time()</div><div class="line">loss_naive, grad_naive = softmax_loss_naive(W, X_dev, y_dev, <span class="number">0.00001</span>)</div><div class="line">toc = time.time()</div><div class="line"><span class="keyword">print</span> <span class="string">'naive loss: %e computed in %fs'</span> % (loss_naive, toc - tic)</div><div class="line"></div><div class="line"><span class="keyword">from</span> cs231n.classifiers.softmax <span class="keyword">import</span> softmax_loss_vectorized</div><div class="line">tic = time.time()</div><div class="line">loss_vectorized, grad_vectorized = softmax_loss_vectorized(W, X_dev, y_dev, <span class="number">0.00001</span>)</div><div class="line">toc = time.time()</div><div class="line"><span class="keyword">print</span> <span class="string">'vectorized loss: %e computed in %fs'</span> % (loss_vectorized, toc - tic)</div><div class="line"></div><div class="line"><span class="comment"># As we did for the SVM, we use the Frobenius norm to compare the two versions</span></div><div class="line"><span class="comment"># of the gradient.</span></div><div class="line">grad_difference = np.linalg.norm(grad_naive - grad_vectorized, ord=<span class="string">'fro'</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">'Loss difference: %f'</span> % np.abs(loss_naive - loss_vectorized)</div><div class="line"><span class="keyword">print</span> <span class="string">'Gradient difference: %f'</span> % grad_difference</div></pre></td></tr></table></figure><pre><code>naive loss: 2.395985e+00 computed in 0.080000s
vectorized loss: 2.395985e+00 computed in 0.003000s
Loss difference: 0.000000
Gradient difference: 0.000000
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Use the validation set to tune hyperparameters (regularization strength and</span></div><div class="line"><span class="comment"># learning rate). You should experiment with different ranges for the learning</span></div><div class="line"><span class="comment"># rates and regularization strengths; if you are careful you should be able to</span></div><div class="line"><span class="comment"># get a classification accuracy of over 0.35 on the validation set.</span></div><div class="line"><span class="keyword">from</span> cs231n.classifiers <span class="keyword">import</span> Softmax</div><div class="line">results = &#123;&#125;</div><div class="line">best_val = <span class="number">-1</span></div><div class="line">best_softmax = <span class="keyword">None</span></div><div class="line">learning_rates = [<span class="number">1e-8</span>, <span class="number">1e-7</span>, <span class="number">2e-7</span>]</div><div class="line">regularization_strengths = [<span class="number">1e4</span>, <span class="number">2e4</span>, <span class="number">3e4</span>, <span class="number">4e4</span>, <span class="number">5e4</span>, <span class="number">6e4</span>, <span class="number">7e4</span>, <span class="number">8e4</span>, <span class="number">1e5</span>]</div><div class="line"></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment"># <span class="doctag">TODO:</span>                                                                        #</span></div><div class="line"><span class="comment"># Use the validation set to set the learning rate and regularization strength. #</span></div><div class="line"><span class="comment"># This should be identical to the validation that you did for the SVM; save    #</span></div><div class="line"><span class="comment"># the best trained softmax classifer in best_softmax.                          #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line">iters = <span class="number">2000</span></div><div class="line"><span class="keyword">for</span> lr <span class="keyword">in</span> learning_rates:</div><div class="line">    <span class="keyword">for</span> rs <span class="keyword">in</span> regularization_strengths:</div><div class="line">        softmax = Softmax()</div><div class="line">        softmax.train(X_train, y_train, learning_rate=lr, reg=rs, num_iters=iters)</div><div class="line">        </div><div class="line">        y_train_pred = softmax.predict(X_train)</div><div class="line">        acc_train = np.mean(y_train == y_train_pred)</div><div class="line">        y_val_pred = softmax.predict(X_val)</div><div class="line">        acc_val = np.mean(y_val == y_val_pred)</div><div class="line">        </div><div class="line">        results[(lr, rs)] = (acc_train, acc_val)</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> best_val &lt; acc_val:</div><div class="line">            best_val = acc_val</div><div class="line">            best_softmax = softmax</div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment">#                              END OF YOUR CODE                                #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line">    </div><div class="line"><span class="comment"># Print out results.</span></div><div class="line"><span class="keyword">for</span> lr, reg <span class="keyword">in</span> sorted(results):</div><div class="line">    train_accuracy, val_accuracy = results[(lr, reg)]</div><div class="line">    <span class="keyword">print</span> <span class="string">'lr %e reg %e train accuracy: %f val accuracy: %f'</span> % (</div><div class="line">                lr, reg, train_accuracy, val_accuracy)</div><div class="line">    </div><div class="line"><span class="keyword">print</span> <span class="string">'best validation accuracy achieved during cross-validation: %f'</span> % best_val</div></pre></td></tr></table></figure><pre><code>lr 1.000000e-08 reg 1.000000e+04 train accuracy: 0.175633 val accuracy: 0.179000
lr 1.000000e-08 reg 2.000000e+04 train accuracy: 0.174102 val accuracy: 0.161000
lr 1.000000e-08 reg 3.000000e+04 train accuracy: 0.203490 val accuracy: 0.210000
lr 1.000000e-08 reg 4.000000e+04 train accuracy: 0.191367 val accuracy: 0.202000
lr 1.000000e-08 reg 5.000000e+04 train accuracy: 0.208000 val accuracy: 0.197000
lr 1.000000e-08 reg 6.000000e+04 train accuracy: 0.203571 val accuracy: 0.215000
lr 1.000000e-08 reg 7.000000e+04 train accuracy: 0.213551 val accuracy: 0.215000
lr 1.000000e-08 reg 8.000000e+04 train accuracy: 0.238347 val accuracy: 0.229000
lr 1.000000e-08 reg 1.000000e+05 train accuracy: 0.245102 val accuracy: 0.242000
lr 1.000000e-07 reg 1.000000e+04 train accuracy: 0.358265 val accuracy: 0.362000
lr 1.000000e-07 reg 2.000000e+04 train accuracy: 0.356306 val accuracy: 0.374000
lr 1.000000e-07 reg 3.000000e+04 train accuracy: 0.347327 val accuracy: 0.362000
lr 1.000000e-07 reg 4.000000e+04 train accuracy: 0.336347 val accuracy: 0.354000
lr 1.000000e-07 reg 5.000000e+04 train accuracy: 0.331490 val accuracy: 0.348000
lr 1.000000e-07 reg 6.000000e+04 train accuracy: 0.320163 val accuracy: 0.336000
lr 1.000000e-07 reg 7.000000e+04 train accuracy: 0.314551 val accuracy: 0.325000
lr 1.000000e-07 reg 8.000000e+04 train accuracy: 0.313082 val accuracy: 0.324000
lr 1.000000e-07 reg 1.000000e+05 train accuracy: 0.303000 val accuracy: 0.315000
lr 2.000000e-07 reg 1.000000e+04 train accuracy: 0.374163 val accuracy: 0.389000
lr 2.000000e-07 reg 2.000000e+04 train accuracy: 0.353184 val accuracy: 0.365000
lr 2.000000e-07 reg 3.000000e+04 train accuracy: 0.340265 val accuracy: 0.359000
lr 2.000000e-07 reg 4.000000e+04 train accuracy: 0.334673 val accuracy: 0.351000
lr 2.000000e-07 reg 5.000000e+04 train accuracy: 0.326531 val accuracy: 0.337000
lr 2.000000e-07 reg 6.000000e+04 train accuracy: 0.319857 val accuracy: 0.336000
lr 2.000000e-07 reg 7.000000e+04 train accuracy: 0.317878 val accuracy: 0.329000
lr 2.000000e-07 reg 8.000000e+04 train accuracy: 0.310449 val accuracy: 0.329000
lr 2.000000e-07 reg 1.000000e+05 train accuracy: 0.316286 val accuracy: 0.315000
best validation accuracy achieved during cross-validation: 0.389000
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># evaluate on test set</span></div><div class="line"><span class="comment"># Evaluate the best softmax on test set</span></div><div class="line">y_test_pred = best_softmax.predict(X_test)</div><div class="line">test_accuracy = np.mean(y_test == y_test_pred)</div><div class="line"><span class="keyword">print</span> <span class="string">'softmax on raw pixels final test set accuracy: %f'</span> % (test_accuracy, )</div></pre></td></tr></table></figure><pre><code>softmax on raw pixels final test set accuracy: 0.375000
</code></pre><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Visualize the learned weights for each class</span></div><div class="line">w = best_softmax.W[:<span class="number">-1</span>,:] <span class="comment"># strip out the bias</span></div><div class="line">w = w.reshape(<span class="number">32</span>, <span class="number">32</span>, <span class="number">3</span>, <span class="number">10</span>)</div><div class="line"></div><div class="line">w_min, w_max = np.min(w), np.max(w)</div><div class="line"></div><div class="line">classes = [<span class="string">'plane'</span>, <span class="string">'car'</span>, <span class="string">'bird'</span>, <span class="string">'cat'</span>, <span class="string">'deer'</span>, <span class="string">'dog'</span>, <span class="string">'frog'</span>, <span class="string">'horse'</span>, <span class="string">'ship'</span>, <span class="string">'truck'</span>]</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">10</span>):</div><div class="line">  plt.subplot(<span class="number">2</span>, <span class="number">5</span>, i + <span class="number">1</span>)</div><div class="line">  </div><div class="line">  <span class="comment"># Rescale the weights to be between 0 and 255</span></div><div class="line">  wimg = <span class="number">255.0</span> * (w[:, :, :, i].squeeze() - w_min) / (w_max - w_min)</div><div class="line">  plt.imshow(wimg.astype(<span class="string">'uint8'</span>))</div><div class="line">  plt.axis(<span class="string">'off'</span>)</div><div class="line">  plt.title(classes[i])</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/softmax/template.png" alt="template"></p><h1 id="Codes"><a href="#Codes" class="headerlink" title="Codes"></a>Codes</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> random <span class="keyword">import</span> shuffle</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">softmax_loss_naive</span><span class="params">(W, X, y, reg)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    Softmax loss function, naive implementation (with loops)</div><div class="line"></div><div class="line">    Inputs have dimension D, there are C classes, and we operate on minibatches</div><div class="line">    of N examples.</div><div class="line"></div><div class="line">    Inputs:</div><div class="line">    - W: A numpy array of shape (D, C) containing weights.</div><div class="line">    - X: A numpy array of shape (N, D) containing a minibatch of data.</div><div class="line">    - y: A numpy array of shape (N,) containing training labels; y[i] = c means</div><div class="line">      that X[i] has label c, where 0 &lt;= c &lt; C.</div><div class="line">    - reg: (float) regularization strength</div><div class="line"></div><div class="line">    Returns a tuple of:</div><div class="line">    - loss as single float</div><div class="line">    - gradient with respect to weights W; an array of same shape as W</div><div class="line">    """</div><div class="line">    <span class="comment"># Initialize the loss and gradient to zero.</span></div><div class="line">    loss = <span class="number">0.0</span></div><div class="line">    dW = np.zeros_like(W)</div><div class="line"></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    <span class="comment"># <span class="doctag">TODO:</span> Compute the softmax loss and its gradient using explicit loops.     #</span></div><div class="line">    <span class="comment"># Store the loss in loss and the gradient in dW. If you are not careful     #</span></div><div class="line">    <span class="comment"># here, it is easy to run into numeric instability. Don't forget the        #</span></div><div class="line">    <span class="comment"># regularization!                                                           #</span></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    num_train = X.shape[<span class="number">0</span>]</div><div class="line">    num_classes = W.shape[<span class="number">1</span>]</div><div class="line"></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(num_train):</div><div class="line">        f = X[i, :].dot(W)</div><div class="line">        f -= np.max(f)</div><div class="line">        correct_f = f[y[i]]</div><div class="line">        denom = np.sum(np.exp(f))</div><div class="line"></div><div class="line">        p = np.exp(correct_f) / denom</div><div class="line">        loss += -np.log(p)</div><div class="line"></div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> xrange(num_classes):</div><div class="line">            <span class="keyword">if</span> j == y[i]:</div><div class="line">                dW[:, y[i]] += (np.exp(f[j]) / denom - <span class="number">1</span>) * X[i, :]</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                dW[:, j] += (np.exp(f[j]) / denom) * X[i, :]</div><div class="line"></div><div class="line">    loss /= num_train</div><div class="line">    loss += <span class="number">0.5</span> * reg * np.sum(W * W)</div><div class="line"></div><div class="line">    dW /= num_train</div><div class="line">    dW += reg * W</div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    <span class="comment">#                          END OF YOUR CODE                                 #</span></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> loss, dW</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">softmax_loss_vectorized</span><span class="params">(W, X, y, reg)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    Softmax loss function, vectorized version.</div><div class="line"></div><div class="line">    Inputs and outputs are the same as softmax_loss_naive.</div><div class="line">    """</div><div class="line">    <span class="comment"># Initialize the loss and gradient to zero.</span></div><div class="line">    loss = <span class="number">0.0</span></div><div class="line">    dW = np.zeros_like(W)</div><div class="line"></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    <span class="comment"># <span class="doctag">TODO:</span> Compute the softmax loss and its gradient using no explicit loops.  #</span></div><div class="line">    <span class="comment"># Store the loss in loss and the gradient in dW. If you are not careful     #</span></div><div class="line">    <span class="comment"># here, it is easy to run into numeric instability. Don't forget the        #</span></div><div class="line">    <span class="comment"># regularization!                                                           #</span></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    num_train = X.shape[<span class="number">0</span>]</div><div class="line"></div><div class="line">    f = X.dot(W)</div><div class="line">    f = f - np.max(f, axis=<span class="number">1</span>)[:, np.newaxis]</div><div class="line">    loss = -np.sum(</div><div class="line">        np.log(np.exp(f[np.arange(num_train), y]) / np.sum(np.exp(f), axis=<span class="number">1</span>)))</div><div class="line"></div><div class="line">    loss /= num_train</div><div class="line">    loss += <span class="number">0.5</span> * reg * np.sum(W * W)</div><div class="line"></div><div class="line">    ind = np.zeros_like(f)</div><div class="line">    ind[np.arange(num_train), y] = <span class="number">1</span></div><div class="line">    dW = X.T.dot(np.exp(f) / np.sum(np.exp(f), axis=<span class="number">1</span>, keepdims=<span class="keyword">True</span>) - ind)</div><div class="line"></div><div class="line">    dW /= num_train</div><div class="line">    dW += reg * W</div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    <span class="comment">#                          END OF YOUR CODE                                 #</span></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> loss, dW</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Softmax-exercise&quot;&gt;&lt;a href=&quot;#Softmax-exercise&quot; class=&quot;headerlink&quot; title=&quot;Softmax exercise&quot;&gt;&lt;/a&gt;Softmax exercise&lt;/h1&gt;&lt;p&gt;&lt;em&gt;Complete a
    
    </summary>
    
    
      <category term="machine learning" scheme="http://yoursite.com/tags/machine-learning/"/>
    
      <category term="deep learning" scheme="http://yoursite.com/tags/deep-learning/"/>
    
      <category term="softmax" scheme="http://yoursite.com/tags/softmax/"/>
    
  </entry>
  
  <entry>
    <title>cs231n Assignment#1 svm</title>
    <link href="http://yoursite.com/2017/03/03/cs231n-Assignment-1-svm/"/>
    <id>http://yoursite.com/2017/03/03/cs231n-Assignment-1-svm/</id>
    <published>2017-03-03T10:55:44.000Z</published>
    <updated>2017-03-03T11:04:37.635Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Multiclass-Support-Vector-Machine-exercise"><a href="#Multiclass-Support-Vector-Machine-exercise" class="headerlink" title="Multiclass Support Vector Machine exercise"></a>Multiclass Support Vector Machine exercise</h1><p><em>Complete and hand in this completed worksheet (including its outputs and any supporting code outside of the worksheet) with your assignment submission. For more details see the <a href="http://vision.stanford.edu/teaching/cs231n/assignments.html" target="_blank" rel="external">assignments page</a> on the course website.</em></p><p>In this exercise you will:<br>​</p><ul><li>implement a fully-vectorized <strong>loss function</strong> for the SVM</li><li>implement the fully-vectorized expression for its <strong>analytic gradient</strong></li><li><strong>check your implementation</strong> using numerical gradient</li><li>use a validation set to <strong>tune the learning rate and regularization</strong> strength</li><li><strong>optimize</strong> the loss function with <strong>SGD</strong></li><li><strong>visualize</strong> the final learned weights</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Run some setup code for this notebook.</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> random</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> cs231n.data_utils <span class="keyword">import</span> load_CIFAR10</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"></div><div class="line"><span class="comment"># This is a bit of magic to make matplotlib figures appear inline in the</span></div><div class="line"><span class="comment"># notebook rather than in a new window.</span></div><div class="line">%matplotlib inline</div><div class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">10.0</span>, <span class="number">8.0</span>) <span class="comment"># set default size of plots</span></div><div class="line">plt.rcParams[<span class="string">'image.interpolation'</span>] = <span class="string">'nearest'</span></div><div class="line">plt.rcParams[<span class="string">'image.cmap'</span>] = <span class="string">'gray'</span></div><div class="line"></div><div class="line"><span class="comment"># Some more magic so that the notebook will reload external python modules;</span></div><div class="line"><span class="comment"># see http://stackoverflow.com/questions/1907993/autoreload-of-modules-in-ipython</span></div><div class="line">%load_ext autoreload</div><div class="line">%autoreload <span class="number">2</span></div></pre></td></tr></table></figure><h2 id="CIFAR-10-Data-Loading-and-Preprocessing"><a href="#CIFAR-10-Data-Loading-and-Preprocessing" class="headerlink" title="CIFAR-10 Data Loading and Preprocessing"></a>CIFAR-10 Data Loading and Preprocessing</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Load the raw CIFAR-10 data.</span></div><div class="line">cifar10_dir = <span class="string">'cs231n/datasets/cifar-10-batches-py'</span></div><div class="line">X_train, y_train, X_test, y_test = load_CIFAR10(cifar10_dir)</div><div class="line"></div><div class="line"><span class="comment"># As a sanity check, we print out the size of the training and test data.</span></div><div class="line"><span class="keyword">print</span> <span class="string">'Training data shape: '</span>, X_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Training labels shape: '</span>, y_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test data shape: '</span>, X_test.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test labels shape: '</span>, y_test.shape</div></pre></td></tr></table></figure><pre><code>Training data shape:  (50000L, 32L, 32L, 3L)
Training labels shape:  (50000L,)
Test data shape:  (10000L, 32L, 32L, 3L)
Test labels shape:  (10000L,)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Visualize some examples from the dataset.</span></div><div class="line"><span class="comment"># We show a few examples of training images from each class.</span></div><div class="line">classes = [<span class="string">'plane'</span>, <span class="string">'car'</span>, <span class="string">'bird'</span>, <span class="string">'cat'</span>, <span class="string">'deer'</span>, <span class="string">'dog'</span>, <span class="string">'frog'</span>, <span class="string">'horse'</span>, <span class="string">'ship'</span>, <span class="string">'truck'</span>]</div><div class="line">num_classes = len(classes)</div><div class="line">samples_per_class = <span class="number">7</span></div><div class="line"><span class="keyword">for</span> y, cls <span class="keyword">in</span> enumerate(classes):</div><div class="line">    idxs = np.flatnonzero(y_train == y)</div><div class="line">    idxs = np.random.choice(idxs, samples_per_class, replace=<span class="keyword">False</span>)</div><div class="line">    <span class="keyword">for</span> i, idx <span class="keyword">in</span> enumerate(idxs):</div><div class="line">        plt_idx = i * num_classes + y + <span class="number">1</span></div><div class="line">        plt.subplot(samples_per_class, num_classes, plt_idx)</div><div class="line">        plt.imshow(X_train[idx].astype(<span class="string">'uint8'</span>))</div><div class="line">        plt.axis(<span class="string">'off'</span>)</div><div class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:</div><div class="line">            plt.title(cls)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/svm/sample.png" alt="sample"></p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">?np.random.choice</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Split the data into train, val, and test sets. In addition we will</span></div><div class="line"><span class="comment"># create a small development set as a subset of the training data;</span></div><div class="line"><span class="comment"># we can use this for development so our code runs faster.</span></div><div class="line">num_training = <span class="number">49000</span></div><div class="line">num_validation = <span class="number">1000</span></div><div class="line">num_test = <span class="number">1000</span></div><div class="line">num_dev = <span class="number">500</span></div><div class="line"></div><div class="line"><span class="comment"># Our validation set will be num_validation points from the original</span></div><div class="line"><span class="comment"># training set.</span></div><div class="line">mask = range(num_training, num_training + num_validation)</div><div class="line">X_val = X_train[mask]</div><div class="line">y_val = y_train[mask]</div><div class="line"></div><div class="line"><span class="comment"># Our training set will be the first num_train points from the original</span></div><div class="line"><span class="comment"># training set.</span></div><div class="line">mask = range(num_training)</div><div class="line">X_train = X_train[mask]</div><div class="line">y_train = y_train[mask]</div><div class="line"></div><div class="line"><span class="comment"># We will also make a development set, which is a small subset of</span></div><div class="line"><span class="comment"># the training set.</span></div><div class="line">mask = np.random.choice(num_training, num_dev, replace=<span class="keyword">False</span>)</div><div class="line">X_dev = X_train[mask]</div><div class="line">y_dev = y_train[mask]</div><div class="line"></div><div class="line"><span class="comment"># We use the first num_test points of the original test set as our</span></div><div class="line"><span class="comment"># test set.</span></div><div class="line">mask = range(num_test)</div><div class="line">X_test = X_test[mask]</div><div class="line">y_test = y_test[mask]</div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">'Train data shape: '</span>, X_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Train labels shape: '</span>, y_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Validation data shape: '</span>, X_val.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Validation labels shape: '</span>, y_val.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test data shape: '</span>, X_test.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test labels shape: '</span>, y_test.shape</div></pre></td></tr></table></figure><pre><code>Train data shape:  (49000L, 32L, 32L, 3L)
Train labels shape:  (49000L,)
Validation data shape:  (1000L, 32L, 32L, 3L)
Validation labels shape:  (1000L,)
Test data shape:  (1000L, 32L, 32L, 3L)
Test labels shape:  (1000L,)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Preprocessing: reshape the image data into rows</span></div><div class="line">X_train = np.reshape(X_train, (X_train.shape[<span class="number">0</span>], <span class="number">-1</span>))</div><div class="line">X_val = np.reshape(X_val, (X_val.shape[<span class="number">0</span>], <span class="number">-1</span>))</div><div class="line">X_test = np.reshape(X_test, (X_test.shape[<span class="number">0</span>], <span class="number">-1</span>))</div><div class="line">X_dev = np.reshape(X_dev, (X_dev.shape[<span class="number">0</span>], <span class="number">-1</span>))</div><div class="line"></div><div class="line"><span class="comment"># As a sanity check, print out the shapes of the data</span></div><div class="line"><span class="keyword">print</span> <span class="string">'Training data shape: '</span>, X_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Validation data shape: '</span>, X_val.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test data shape: '</span>, X_test.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'dev data shape: '</span>, X_dev.shape</div></pre></td></tr></table></figure><pre><code>Training data shape:  (49000L, 3072L)
Validation data shape:  (1000L, 3072L)
Test data shape:  (1000L, 3072L)
dev data shape:  (500L, 3072L)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Preprocessing: subtract the mean image</span></div><div class="line"><span class="comment"># first: compute the image mean based on the training data</span></div><div class="line">mean_image = np.mean(X_train, axis=<span class="number">0</span>)</div><div class="line"><span class="keyword">print</span> mean_image[:<span class="number">10</span>] <span class="comment"># print a few of the elements</span></div><div class="line">plt.figure(figsize=(<span class="number">4</span>,<span class="number">4</span>))</div><div class="line">plt.imshow(mean_image.reshape((<span class="number">32</span>,<span class="number">32</span>,<span class="number">3</span>)).astype(<span class="string">'uint8'</span>)) <span class="comment"># visualize the mean image</span></div><div class="line">plt.show()</div></pre></td></tr></table></figure><pre><code>[ 130.64189796  135.98173469  132.47391837  130.05569388  135.34804082
  131.75402041  130.96055102  136.14328571  132.47636735  131.48467347]
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/svm/mean.png" alt="mean"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># second: subtract the mean image from train and test data</span></div><div class="line">X_train -= mean_image</div><div class="line">X_val -= mean_image</div><div class="line">X_test -= mean_image</div><div class="line">X_dev -= mean_image</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># third: append (at the last) the bias dimension of ones (i.e. bias trick) so that our SVM</span></div><div class="line"><span class="comment"># only has to worry about optimizing a single weight matrix W.</span></div><div class="line">X_train = np.hstack([X_train, np.ones((X_train.shape[<span class="number">0</span>], <span class="number">1</span>))])</div><div class="line">X_val = np.hstack([X_val, np.ones((X_val.shape[<span class="number">0</span>], <span class="number">1</span>))])</div><div class="line">X_test = np.hstack([X_test, np.ones((X_test.shape[<span class="number">0</span>], <span class="number">1</span>))])</div><div class="line">X_dev = np.hstack([X_dev, np.ones((X_dev.shape[<span class="number">0</span>], <span class="number">1</span>))])</div><div class="line"></div><div class="line"><span class="keyword">print</span> X_train.shape, X_val.shape, X_test.shape, X_dev.shape</div></pre></td></tr></table></figure><pre><code>(49000L, 3073L) (1000L, 3073L) (1000L, 3073L) (500L, 3073L)
</code></pre><p>​</p><h2 id="SVM-Classifier"><a href="#SVM-Classifier" class="headerlink" title="SVM Classifier"></a>SVM Classifier</h2><p>Your code for this section will all be written inside <strong>cs231n/classifiers/linear_svm.py</strong>.</p><p>As you can see, we have prefilled the function <code>compute_loss_naive</code> which uses for loops to evaluate the multiclass SVM loss function.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Evaluate the naive implementation of the loss we provided for you:</span></div><div class="line"><span class="keyword">from</span> cs231n.classifiers.linear_svm <span class="keyword">import</span> svm_loss_naive</div><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line"><span class="comment"># generate a random SVM weight matrix of small numbers</span></div><div class="line">W = np.random.randn(<span class="number">3073</span>, <span class="number">10</span>) * <span class="number">0.0001</span> </div><div class="line"></div><div class="line">loss, grad = svm_loss_naive(W, X_dev, y_dev, <span class="number">0.00001</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">'loss: %f'</span> % (loss, )</div></pre></td></tr></table></figure><pre><code>loss: 8.831645
</code></pre><p>​</p><p>The <code>grad</code> returned from the function above is right now all zero. Derive and implement the gradient for the SVM cost function and implement it inline inside the function <code>svm_loss_naive</code>. You will find it helpful to interleave your new code inside the existing function.</p><p>To check that you have correctly implemented the gradient correctly, you can numerically estimate the gradient of the loss function and compare the numeric estimate to the gradient that you computed. We have provided code that does this for you:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Once you've implemented the gradient, recompute it with the code below</span></div><div class="line"><span class="comment"># and gradient check it with the function we provided for you</span></div><div class="line"></div><div class="line"><span class="comment"># Compute the loss and its gradient at W.</span></div><div class="line">loss, grad = svm_loss_naive(W, X_dev, y_dev, <span class="number">0.0</span>)</div><div class="line"></div><div class="line"><span class="comment"># Numerically compute the gradient along several randomly chosen dimensions, and</span></div><div class="line"><span class="comment"># compare them with your analytically computed gradient. The numbers should match</span></div><div class="line"><span class="comment"># almost exactly along all dimensions.</span></div><div class="line"><span class="keyword">from</span> cs231n.gradient_check <span class="keyword">import</span> grad_check_sparse</div><div class="line">f = <span class="keyword">lambda</span> w: svm_loss_naive(w, X_dev, y_dev, <span class="number">0.0</span>)[<span class="number">0</span>]</div><div class="line">grad_numerical = grad_check_sparse(f, W, grad)</div><div class="line"></div><div class="line"><span class="comment"># do the gradient check once again with regularization turned on</span></div><div class="line"><span class="comment"># you didn't forget the regularization gradient did you?</span></div><div class="line">loss, grad = svm_loss_naive(W, X_dev, y_dev, <span class="number">1e2</span>)</div><div class="line">f = <span class="keyword">lambda</span> w: svm_loss_naive(w, X_dev, y_dev, <span class="number">1e2</span>)[<span class="number">0</span>]</div><div class="line">grad_numerical = grad_check_sparse(f, W, grad)</div></pre></td></tr></table></figure><pre><code>numerical: -13.865929 analytic: -13.865929, relative error: 1.283977e-12
numerical: 7.842142 analytic: 7.735021, relative error: 6.876784e-03
numerical: 3.464393 analytic: 3.464393, relative error: 9.040092e-11
numerical: -23.034911 analytic: -23.034911, relative error: 6.876266e-12
numerical: -0.185311 analytic: -0.185311, relative error: 2.538774e-10
numerical: 25.825504 analytic: 25.825504, relative error: 1.336035e-11
numerical: 4.457836 analytic: 4.457836, relative error: 1.015819e-10
numerical: 3.184691 analytic: 3.184691, relative error: 8.849109e-11
numerical: 10.428446 analytic: 10.374317, relative error: 2.601982e-03
numerical: 12.479957 analytic: 12.479957, relative error: 6.825191e-12
numerical: 12.237949 analytic: 12.326308, relative error: 3.597051e-03
numerical: 4.377103 analytic: 4.377103, relative error: 3.904758e-11
numerical: -1.951930 analytic: -1.951930, relative error: 1.432276e-10
numerical: 33.752503 analytic: 33.752503, relative error: 4.254520e-12
numerical: 11.367149 analytic: 11.367149, relative error: 1.682727e-11
numerical: 16.461879 analytic: 16.461879, relative error: 4.766805e-12
numerical: 3.814562 analytic: 3.814562, relative error: 1.087469e-10
numerical: 13.931226 analytic: 13.931226, relative error: 9.578349e-12
numerical: -27.291095 analytic: -27.395406, relative error: 1.907445e-03
numerical: -7.610407 analytic: -7.610407, relative error: 1.015282e-12
</code></pre><h3 id="Inline-Question-1"><a href="#Inline-Question-1" class="headerlink" title="Inline Question 1:"></a>Inline Question 1:</h3><p>It is possible that once in a while a dimension in the gradcheck will not match exactly. What could such a discrepancy be caused by? Is it a reason for concern? What is a simple example in one dimension where a gradient check could fail? <em>Hint: the SVM loss function is not strictly speaking differentiable</em></p><p><strong>Your Answer:</strong> <em>Maybe the SVM loss function is not differentiable on that dimension</em></p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">?np.max</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.sum(np.maximum(<span class="number">0</span>, X_dev.dot(W) - X_dev.dot(W)[np.arange(len(y_dev)), [y_dev]].T + <span class="number">1</span>))</div></pre></td></tr></table></figure><pre><code>4915.822409730994
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Next implement the function svm_loss_vectorized; for now only compute the loss;</span></div><div class="line"><span class="comment"># we will implement the gradient in a moment.</span></div><div class="line">tic = time.time()</div><div class="line">loss_naive, grad_naive = svm_loss_naive(W, X_dev, y_dev, <span class="number">0.00001</span>)</div><div class="line">toc = time.time()</div><div class="line"><span class="keyword">print</span> <span class="string">'Naive loss: %e computed in %fs'</span> % (loss_naive, toc - tic)</div><div class="line"></div><div class="line"><span class="keyword">from</span> cs231n.classifiers.linear_svm <span class="keyword">import</span> svm_loss_vectorized</div><div class="line">tic = time.time()</div><div class="line">loss_vectorized, _ = svm_loss_vectorized(W, X_dev, y_dev, <span class="number">0.00001</span>)</div><div class="line">toc = time.time()</div><div class="line"><span class="keyword">print</span> <span class="string">'Vectorized loss: %e computed in %fs'</span> % (loss_vectorized, toc - tic)</div><div class="line"></div><div class="line"><span class="comment"># The losses should match but your vectorized implementation should be much faster.</span></div><div class="line"><span class="keyword">print</span> <span class="string">'difference: %f'</span> % (loss_naive - loss_vectorized)</div></pre></td></tr></table></figure><pre><code>Naive loss: 8.831645e+00 computed in 0.071000s
Vectorized loss: 8.831645e+00 computed in 0.000000s
difference: 0.000000
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Complete the implementation of svm_loss_vectorized, and compute the gradient</span></div><div class="line"><span class="comment"># of the loss function in a vectorized way.</span></div><div class="line"></div><div class="line"><span class="comment"># The naive implementation and the vectorized implementation should match, but</span></div><div class="line"><span class="comment"># the vectorized version should still be much faster.</span></div><div class="line">tic = time.time()</div><div class="line">_, grad_naive = svm_loss_naive(W, X_dev, y_dev, <span class="number">0.00001</span>)</div><div class="line">toc = time.time()</div><div class="line"><span class="keyword">print</span> <span class="string">'Naive loss and gradient: computed in %fs'</span> % (toc - tic)</div><div class="line"></div><div class="line">tic = time.time()</div><div class="line">_, grad_vectorized = svm_loss_vectorized(W, X_dev, y_dev, <span class="number">0.00001</span>)</div><div class="line">toc = time.time()</div><div class="line"><span class="keyword">print</span> <span class="string">'Vectorized loss and gradient: computed in %fs'</span> % (toc - tic)</div><div class="line"></div><div class="line"><span class="comment"># The loss is a single number, so it is easy to compare the values computed</span></div><div class="line"><span class="comment"># by the two implementations. The gradient on the other hand is a matrix, so</span></div><div class="line"><span class="comment"># we use the Frobenius norm to compare them.</span></div><div class="line">difference = np.linalg.norm(grad_naive - grad_vectorized, ord=<span class="string">'fro'</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">'difference: %f'</span> % difference</div></pre></td></tr></table></figure><pre><code>Naive loss and gradient: computed in 0.084000s
Vectorized loss and gradient: computed in 0.005000s
difference: 0.000000
</code></pre><h3 id="Stochastic-Gradient-Descent"><a href="#Stochastic-Gradient-Descent" class="headerlink" title="Stochastic Gradient Descent"></a>Stochastic Gradient Descent</h3><p>We now have vectorized and efficient expressions for the loss, the gradient and our gradient matches the numerical gradient. We are therefore ready to do SGD to minimize the loss.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># In the file linear_classifier.py, implement SGD in the function</span></div><div class="line"><span class="comment"># LinearClassifier.train() and then run it with the code below.</span></div><div class="line"><span class="keyword">from</span> cs231n.classifiers <span class="keyword">import</span> LinearSVM</div><div class="line">svm = LinearSVM()</div><div class="line">tic = time.time()</div><div class="line">loss_hist = svm.train(X_train, y_train, learning_rate=<span class="number">1e-7</span>, reg=<span class="number">5e4</span>,</div><div class="line">                      num_iters=<span class="number">1500</span>, verbose=<span class="keyword">True</span>)</div><div class="line">toc = time.time()</div><div class="line"><span class="keyword">print</span> <span class="string">'That took %fs'</span> % (toc - tic)</div></pre></td></tr></table></figure><pre><code>iteration 0 / 1500: loss 791.772037
iteration 100 / 1500: loss 286.021346
iteration 200 / 1500: loss 107.673095
iteration 300 / 1500: loss 41.812791
iteration 400 / 1500: loss 18.665578
iteration 500 / 1500: loss 10.614984
iteration 600 / 1500: loss 6.664814
iteration 700 / 1500: loss 6.509693
iteration 800 / 1500: loss 5.792204
iteration 900 / 1500: loss 4.986855
iteration 1000 / 1500: loss 5.914691
iteration 1100 / 1500: loss 5.058078
iteration 1200 / 1500: loss 5.491475
iteration 1300 / 1500: loss 5.609450
iteration 1400 / 1500: loss 5.376595
That took 5.454000s
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># A useful debugging strategy is to plot the loss as a function of</span></div><div class="line"><span class="comment"># iteration number:</span></div><div class="line">plt.plot(loss_hist)</div><div class="line">plt.xlabel(<span class="string">'Iteration number'</span>)</div><div class="line">plt.ylabel(<span class="string">'Loss value'</span>)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/svm/learning_curve.png" alt="learning_curve"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Write the LinearSVM.predict function and evaluate the performance on both the</span></div><div class="line"><span class="comment"># training and validation set</span></div><div class="line">y_train_pred = svm.predict(X_train)</div><div class="line"><span class="keyword">print</span> <span class="string">'training accuracy: %f'</span> % (np.mean(y_train == y_train_pred), )</div><div class="line">y_val_pred = svm.predict(X_val)</div><div class="line"><span class="keyword">print</span> <span class="string">'validation accuracy: %f'</span> % (np.mean(y_val == y_val_pred), )</div></pre></td></tr></table></figure><pre><code>training accuracy: 0.364980
validation accuracy: 0.378000
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Use the validation set to tune hyperparameters (regularization strength and</span></div><div class="line"><span class="comment"># learning rate). You should experiment with different ranges for the learning</span></div><div class="line"><span class="comment"># rates and regularization strengths; if you are careful you should be able to</span></div><div class="line"><span class="comment"># get a classification accuracy of about 0.4 on the validation set.</span></div><div class="line">learning_rates = [<span class="number">1e-8</span>, <span class="number">1e-7</span>, <span class="number">2e-7</span>]</div><div class="line">regularization_strengths = [<span class="number">1e4</span>, <span class="number">2e4</span>, <span class="number">3e4</span>, <span class="number">4e4</span>, <span class="number">5e4</span>, <span class="number">6e4</span>, <span class="number">7e4</span>, <span class="number">8e4</span>, <span class="number">1e5</span>]</div><div class="line"></div><div class="line"><span class="comment"># results is dictionary mapping tuples of the form</span></div><div class="line"><span class="comment"># (learning_rate, regularization_strength) to tuples of the form</span></div><div class="line"><span class="comment"># (training_accuracy, validation_accuracy). The accuracy is simply the fraction</span></div><div class="line"><span class="comment"># of data points that are correctly classified.</span></div><div class="line">results = &#123;&#125;</div><div class="line">best_val = <span class="number">-1</span>   <span class="comment"># The highest validation accuracy that we have seen so far.</span></div><div class="line">best_svm = <span class="keyword">None</span> <span class="comment"># The LinearSVM object that achieved the highest validation rate.</span></div><div class="line"></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment"># <span class="doctag">TODO:</span>                                                                        #</span></div><div class="line"><span class="comment"># Write code that chooses the best hyperparameters by tuning on the validation #</span></div><div class="line"><span class="comment"># set. For each combination of hyperparameters, train a linear SVM on the      #</span></div><div class="line"><span class="comment"># training set, compute its accuracy on the training and validation sets, and  #</span></div><div class="line"><span class="comment"># store these numbers in the results dictionary. In addition, store the best   #</span></div><div class="line"><span class="comment"># validation accuracy in best_val and the LinearSVM object that achieves this  #</span></div><div class="line"><span class="comment"># accuracy in best_svm.                                                        #</span></div><div class="line"><span class="comment">#                                                                              #</span></div><div class="line"><span class="comment"># Hint: You should use a small value for num_iters as you develop your         #</span></div><div class="line"><span class="comment"># validation code so that the SVMs don't take much time to train; once you are #</span></div><div class="line"><span class="comment"># confident that your validation code works, you should rerun the validation   #</span></div><div class="line"><span class="comment"># code with a larger value for num_iters.                                      #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="keyword">for</span> learning_rate <span class="keyword">in</span> learning_rates:</div><div class="line">    <span class="keyword">for</span> regularization_strength <span class="keyword">in</span> regularization_strengths:</div><div class="line">        svm = LinearSVM()</div><div class="line">        loss_hist = svm.train(</div><div class="line">            X_train, y_train, learning_rate, \</div><div class="line">            regularization_strength, num_iters=<span class="number">1500</span>, batch_size=<span class="number">200</span>)</div><div class="line">        y_train_pred = svm.predict(X_train)</div><div class="line">        y_val_pred = svm.predict(X_val)</div><div class="line">        training_accuracy = np.mean(y_train == y_train_pred)</div><div class="line">        validation_accuracy = np.mean(y_val == y_val_pred)</div><div class="line">        results[(learning_rate, regularization_strength)] = \</div><div class="line">        (training_accuracy, validation_accuracy)</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> validation_accuracy &gt; best_val:</div><div class="line">            best_val = validation_accuracy</div><div class="line">            best_svm = svm</div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment">#                              END OF YOUR CODE                                #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line">    </div><div class="line"><span class="comment"># Print out results.</span></div><div class="line"><span class="keyword">for</span> lr, reg <span class="keyword">in</span> sorted(results):</div><div class="line">    train_accuracy, val_accuracy = results[(lr, reg)]</div><div class="line">    <span class="keyword">print</span> <span class="string">'lr %e reg %e train accuracy: %f val accuracy: %f'</span> % (</div><div class="line">                lr, reg, train_accuracy, val_accuracy)</div><div class="line">    </div><div class="line"><span class="keyword">print</span> <span class="string">'best validation accuracy achieved during cross-validation: %f'</span> % best_val</div></pre></td></tr></table></figure><pre><code>lr 1.000000e-08 reg 1.000000e+04 train accuracy: 0.221898 val accuracy: 0.247000
lr 1.000000e-08 reg 2.000000e+04 train accuracy: 0.233653 val accuracy: 0.258000
lr 1.000000e-08 reg 3.000000e+04 train accuracy: 0.234694 val accuracy: 0.225000
lr 1.000000e-08 reg 4.000000e+04 train accuracy: 0.255959 val accuracy: 0.249000
lr 1.000000e-08 reg 5.000000e+04 train accuracy: 0.259755 val accuracy: 0.273000
lr 1.000000e-08 reg 6.000000e+04 train accuracy: 0.267408 val accuracy: 0.269000
lr 1.000000e-08 reg 7.000000e+04 train accuracy: 0.269102 val accuracy: 0.287000
lr 1.000000e-08 reg 8.000000e+04 train accuracy: 0.277102 val accuracy: 0.285000
lr 1.000000e-08 reg 1.000000e+05 train accuracy: 0.295306 val accuracy: 0.301000
lr 1.000000e-07 reg 1.000000e+04 train accuracy: 0.369388 val accuracy: 0.374000
lr 1.000000e-07 reg 2.000000e+04 train accuracy: 0.380265 val accuracy: 0.390000
lr 1.000000e-07 reg 3.000000e+04 train accuracy: 0.375490 val accuracy: 0.378000
lr 1.000000e-07 reg 4.000000e+04 train accuracy: 0.375633 val accuracy: 0.385000
lr 1.000000e-07 reg 5.000000e+04 train accuracy: 0.369694 val accuracy: 0.375000
lr 1.000000e-07 reg 6.000000e+04 train accuracy: 0.372469 val accuracy: 0.383000
lr 1.000000e-07 reg 7.000000e+04 train accuracy: 0.356000 val accuracy: 0.370000
lr 1.000000e-07 reg 8.000000e+04 train accuracy: 0.352816 val accuracy: 0.355000
lr 1.000000e-07 reg 1.000000e+05 train accuracy: 0.356796 val accuracy: 0.377000
lr 2.000000e-07 reg 1.000000e+04 train accuracy: 0.393510 val accuracy: 0.395000
lr 2.000000e-07 reg 2.000000e+04 train accuracy: 0.377020 val accuracy: 0.382000
lr 2.000000e-07 reg 3.000000e+04 train accuracy: 0.363857 val accuracy: 0.373000
lr 2.000000e-07 reg 4.000000e+04 train accuracy: 0.368714 val accuracy: 0.372000
lr 2.000000e-07 reg 5.000000e+04 train accuracy: 0.361531 val accuracy: 0.364000
lr 2.000000e-07 reg 6.000000e+04 train accuracy: 0.354714 val accuracy: 0.368000
lr 2.000000e-07 reg 7.000000e+04 train accuracy: 0.348306 val accuracy: 0.365000
lr 2.000000e-07 reg 8.000000e+04 train accuracy: 0.358082 val accuracy: 0.378000
lr 2.000000e-07 reg 1.000000e+05 train accuracy: 0.347898 val accuracy: 0.358000
best validation accuracy achieved during cross-validation: 0.395000
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Visualize the cross-validation results</span></div><div class="line"><span class="keyword">import</span> math</div><div class="line">x_scatter = [math.log10(x[<span class="number">0</span>]) <span class="keyword">for</span> x <span class="keyword">in</span> results]</div><div class="line">y_scatter = [math.log10(x[<span class="number">1</span>]) <span class="keyword">for</span> x <span class="keyword">in</span> results]</div><div class="line"></div><div class="line"><span class="comment"># plot training accuracy</span></div><div class="line">marker_size = <span class="number">100</span></div><div class="line">colors = [results[x][<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> results]</div><div class="line">plt.subplot(<span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>)</div><div class="line">plt.scatter(x_scatter, y_scatter, marker_size, c=colors)</div><div class="line">plt.colorbar()</div><div class="line">plt.xlabel(<span class="string">'log learning rate'</span>)</div><div class="line">plt.ylabel(<span class="string">'log regularization strength'</span>)</div><div class="line">plt.title(<span class="string">'CIFAR-10 training accuracy'</span>)</div><div class="line"></div><div class="line"><span class="comment"># plot validation accuracy</span></div><div class="line">colors = [results[x][<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> results] <span class="comment"># default size of markers is 20</span></div><div class="line">plt.subplot(<span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>)</div><div class="line">plt.scatter(x_scatter, y_scatter, marker_size, c=colors)</div><div class="line">plt.colorbar()</div><div class="line">plt.xlabel(<span class="string">'log learning rate'</span>)</div><div class="line">plt.ylabel(<span class="string">'log regularization strength'</span>)</div><div class="line">plt.title(<span class="string">'CIFAR-10 validation accuracy'</span>)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/svm/accuracy.png" alt="accuracy"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Evaluate the best svm on test set</span></div><div class="line">y_test_pred = best_svm.predict(X_test)</div><div class="line">test_accuracy = np.mean(y_test == y_test_pred)</div><div class="line"><span class="keyword">print</span> <span class="string">'linear SVM on raw pixels final test set accuracy: %f'</span> % test_accuracy</div></pre></td></tr></table></figure><pre><code>linear SVM on raw pixels final test set accuracy: 0.383000
</code></pre><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">x = np.array([[[<span class="number">0</span>], [<span class="number">1</span>], [<span class="number">2</span>]]])</div><div class="line">np.squeeze(x)</div></pre></td></tr></table></figure><pre><code>array([0, 1, 2])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Visualize the learned weights for each class.</span></div><div class="line"><span class="comment"># Depending on your choice of learning rate and regularization strength, these may</span></div><div class="line"><span class="comment"># or may not be nice to look at.</span></div><div class="line">w = best_svm.W[:<span class="number">-1</span>,:] <span class="comment"># strip out the bias</span></div><div class="line">w = w.reshape(<span class="number">32</span>, <span class="number">32</span>, <span class="number">3</span>, <span class="number">10</span>)</div><div class="line">w_min, w_max = np.min(w), np.max(w)</div><div class="line">classes = [<span class="string">'plane'</span>, <span class="string">'car'</span>, <span class="string">'bird'</span>, <span class="string">'cat'</span>, <span class="string">'deer'</span>, <span class="string">'dog'</span>, <span class="string">'frog'</span>, <span class="string">'horse'</span>, <span class="string">'ship'</span>, <span class="string">'truck'</span>]</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">10</span>):</div><div class="line">  plt.subplot(<span class="number">2</span>, <span class="number">5</span>, i + <span class="number">1</span>)</div><div class="line">    </div><div class="line">  <span class="comment"># Rescale the weights to be between 0 and 255</span></div><div class="line">  wimg = <span class="number">255.0</span> * (w[:, :, :, i].squeeze() - w_min) / (w_max - w_min)</div><div class="line">  plt.imshow(wimg.astype(<span class="string">'uint8'</span>))</div><div class="line">  plt.axis(<span class="string">'off'</span>)</div><div class="line">  plt.title(classes[i])</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/svm/weight.png" alt="weight"></p><h3 id="Inline-question-2"><a href="#Inline-question-2" class="headerlink" title="Inline question 2:"></a>Inline question 2:</h3><p>Describe what your visualized SVM weights look like, and offer a brief explanation for why they look they way that they do.</p><p><strong>Your answer:</strong> <em>fill this in</em></p><h1 id="Codes"><a href="#Codes" class="headerlink" title="Codes"></a>Codes</h1><h2 id="linear-svm-py"><a href="#linear-svm-py" class="headerlink" title="linear_svm.py"></a>linear_svm.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> random <span class="keyword">import</span> shuffle</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">svm_loss_naive</span><span class="params">(W, X, y, reg)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    Structured SVM loss function, naive implementation (with loops).</div><div class="line"></div><div class="line">    Inputs have dimension D, there are C classes, and we operate on minibatches</div><div class="line">    of N examples.</div><div class="line"></div><div class="line">    Inputs:</div><div class="line">    - W: A numpy array of shape (D, C) containing weights.</div><div class="line">    - X: A numpy array of shape (N, D) containing a minibatch of data.</div><div class="line">    - y: A numpy array of shape (N,) containing training labels; y[i] = c means</div><div class="line">      that X[i] has label c, where 0 &lt;= c &lt; C.</div><div class="line">    - reg: (float) regularization strength</div><div class="line"></div><div class="line">    Returns a tuple of:</div><div class="line">    - loss as single float</div><div class="line">    - gradient with respect to weights W; an array of same shape as W</div><div class="line">    """</div><div class="line">    dW = np.zeros(W.shape)  <span class="comment"># initialize the gradient as zero</span></div><div class="line"></div><div class="line">    <span class="comment"># compute the loss and the gradient</span></div><div class="line">    num_classes = W.shape[<span class="number">1</span>]</div><div class="line">    num_train = X.shape[<span class="number">0</span>]</div><div class="line">    loss = <span class="number">0.0</span></div><div class="line"></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(num_train):</div><div class="line">        scores = X[i].dot(W)</div><div class="line">        correct_class_score = scores[y[i]]</div><div class="line"></div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> xrange(num_classes):</div><div class="line">            <span class="keyword">if</span> j == y[i]:</div><div class="line">                <span class="keyword">continue</span></div><div class="line">            margin = scores[j] - correct_class_score + <span class="number">1</span>  <span class="comment"># note delta = 1</span></div><div class="line">            <span class="keyword">if</span> margin &gt; <span class="number">0</span>:</div><div class="line">                dW[:, y[i]] -= X[i, :]</div><div class="line">                dW[:, j] += X[i, :]</div><div class="line">                loss += margin</div><div class="line"></div><div class="line">    <span class="comment"># Right now the loss is a sum over all training examples, but we want it</span></div><div class="line">    <span class="comment"># to be an average instead so we divide by num_train.</span></div><div class="line">    loss /= num_train</div><div class="line"></div><div class="line">    dW /= num_train</div><div class="line"></div><div class="line">    <span class="comment"># Add regularization to the loss.</span></div><div class="line">    loss += <span class="number">0.5</span> * reg * np.sum(W * W)</div><div class="line">    dW += reg * W</div><div class="line"></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    <span class="comment"># <span class="doctag">TODO:</span>                                                                     #</span></div><div class="line">    <span class="comment"># Compute the gradient of the loss function and store it dW.                #</span></div><div class="line">    <span class="comment"># Rather that first computing the loss and then computing the derivative,     #</span></div><div class="line">    <span class="comment"># it may be simpler to compute the derivative at the same time that the     #</span></div><div class="line">    <span class="comment"># loss is being computed. As a result you may need to modify some of the    #</span></div><div class="line">    <span class="comment"># code above to compute the gradient.                                       #</span></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> loss, dW</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">svm_loss_vectorized</span><span class="params">(W, X, y, reg)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    Structured SVM loss function, vectorized implementation.</div><div class="line"></div><div class="line">    Inputs and outputs are the same as svm_loss_naive.</div><div class="line">    """</div><div class="line">    loss = <span class="number">0.0</span></div><div class="line">    dW = np.zeros(W.shape)  <span class="comment"># initialize the gradient as zero</span></div><div class="line"></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    <span class="comment"># <span class="doctag">TODO:</span>                                                                     #</span></div><div class="line">    <span class="comment"># Implement a vectorized version of the structured SVM loss, storing the    #</span></div><div class="line">    <span class="comment"># result in loss.                                                           #</span></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    num_train = X.shape[<span class="number">0</span>]</div><div class="line">    delta = <span class="number">1.0</span></div><div class="line"></div><div class="line">    scores = X.dot(W)</div><div class="line">    correct_class_score = scores[np.arange(num_train), y]</div><div class="line"></div><div class="line">    margins = np.maximum(</div><div class="line">        <span class="number">0</span>, scores - correct_class_score[:, np.newaxis] + delta)</div><div class="line">    margins[np.arange(num_train), y] = <span class="number">0</span></div><div class="line"></div><div class="line">    loss = np.sum(margins)</div><div class="line"></div><div class="line">    loss /= num_train</div><div class="line"></div><div class="line">    loss += <span class="number">0.5</span> * reg * np.sum(W.T.dot(W))</div><div class="line"></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    <span class="comment">#                             END OF YOUR CODE                              #</span></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line"></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    <span class="comment"># <span class="doctag">TODO:</span>                                                                     #</span></div><div class="line">    <span class="comment"># Implement a vectorized version of the gradient for the structured SVM     #</span></div><div class="line">    <span class="comment"># loss, storing the result in dW.                                           #</span></div><div class="line">    <span class="comment">#                                                                           #</span></div><div class="line">    <span class="comment"># Hint: Instead of computing the gradient from scratch, it may be easier    #</span></div><div class="line">    <span class="comment"># to reuse some of the intermediate values that you used to compute the     #</span></div><div class="line">    <span class="comment"># loss.                                                                     #</span></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    X_mask = np.zeros(margins.shape)</div><div class="line">    X_mask[margins &gt; <span class="number">0</span>] = <span class="number">1</span></div><div class="line"></div><div class="line">    count = np.sum(X_mask, axis=<span class="number">1</span>)</div><div class="line">    X_mask[np.arange(num_train), y] = -count</div><div class="line"></div><div class="line">    dW = X.T.dot(X_mask)</div><div class="line"></div><div class="line">    dW /= num_train</div><div class="line"></div><div class="line">    dW += np.multiply(W, reg)</div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    <span class="comment">#                             END OF YOUR CODE                              #</span></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> loss, dW</div></pre></td></tr></table></figure><h2 id="linear-classifier"><a href="#linear-classifier" class="headerlink" title="linear_classifier"></a>linear_classifier</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> cs231n.classifiers.linear_svm <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> cs231n.classifiers.softmax <span class="keyword">import</span> *</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearClassifier</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.W = <span class="keyword">None</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self, X, y, learning_rate=<span class="number">1e-3</span>, reg=<span class="number">1e-5</span>, num_iters=<span class="number">100</span>,</span></span></div><div class="line">              batch_size=<span class="number">200</span>, verbose=False):</div><div class="line">        <span class="string">"""</span></div><div class="line">        Train this linear classifier using stochastic gradient descent.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - X: A numpy array of shape (N, D) containing training data; there are N</div><div class="line">          training samples each of dimension D.</div><div class="line">        - y: A numpy array of shape (N,) containing training labels; y[i] = c</div><div class="line">          means that X[i] has label 0 &lt;= c &lt; C for C classes.</div><div class="line">        - learning_rate: (float) learning rate for optimization.</div><div class="line">        - reg: (float) regularization strength.</div><div class="line">        - num_iters: (integer) number of steps to take when optimizing</div><div class="line">        - batch_size: (integer) number of training examples to use at each step.</div><div class="line">        - verbose: (boolean) If true, print progress during optimization.</div><div class="line"></div><div class="line">        Outputs:</div><div class="line">        A list containing the value of the loss function at each training iteration.</div><div class="line">        """</div><div class="line">        num_train, dim = X.shape</div><div class="line">        num_classes = np.max(y) + <span class="number">1</span>  <span class="comment"># assume y takes values 0...K-1 where K is number of classes</span></div><div class="line">        <span class="keyword">if</span> self.W <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            <span class="comment"># lazily initialize W</span></div><div class="line">            self.W = <span class="number">0.001</span> * np.random.randn(dim, num_classes)</div><div class="line"></div><div class="line">        <span class="comment"># Run stochastic gradient descent to optimize W</span></div><div class="line">        loss_history = []</div><div class="line">        <span class="keyword">for</span> it <span class="keyword">in</span> xrange(num_iters):</div><div class="line">            X_batch = <span class="keyword">None</span></div><div class="line">            y_batch = <span class="keyword">None</span></div><div class="line"></div><div class="line">            <span class="comment">#########################################################################</span></div><div class="line">            <span class="comment"># <span class="doctag">TODO:</span>                                                                 #</span></div><div class="line">            <span class="comment"># Sample batch_size elements from the training data and their           #</span></div><div class="line">            <span class="comment"># corresponding labels to use in this round of gradient descent.        #</span></div><div class="line">            <span class="comment"># Store the data in X_batch and their corresponding labels in           #</span></div><div class="line">            <span class="comment"># y_batch; after sampling X_batch should have shape (dim, batch_size)   #</span></div><div class="line">            <span class="comment"># and y_batch should have shape (batch_size,)                           #</span></div><div class="line">            <span class="comment">#                                                                       #</span></div><div class="line">            <span class="comment"># Hint: Use np.random.choice to generate indices. Sampling with         #</span></div><div class="line">            <span class="comment"># replacement is faster than sampling without replacement.              #</span></div><div class="line">            <span class="comment">#########################################################################</span></div><div class="line">            mask = np.random.choice(num_train, batch_size, replace=<span class="keyword">True</span>)</div><div class="line">            X_batch = X[mask]</div><div class="line">            y_batch = y[mask]</div><div class="line">            <span class="comment">#########################################################################</span></div><div class="line">            <span class="comment">#                       END OF YOUR CODE                                #</span></div><div class="line">            <span class="comment">#########################################################################</span></div><div class="line"></div><div class="line">            <span class="comment"># evaluate loss and gradient</span></div><div class="line">            loss, grad = self.loss(X_batch, y_batch, reg)</div><div class="line">            loss_history.append(loss)</div><div class="line"></div><div class="line">            <span class="comment"># perform parameter update</span></div><div class="line">            <span class="comment">#########################################################################</span></div><div class="line">            <span class="comment"># <span class="doctag">TODO:</span>                                                                 #</span></div><div class="line">            <span class="comment"># Update the weights using the gradient and the learning rate.          #</span></div><div class="line">            <span class="comment">#########################################################################</span></div><div class="line">            self.W = self.W - learning_rate * grad</div><div class="line">            <span class="comment">#########################################################################</span></div><div class="line">            <span class="comment">#                       END OF YOUR CODE                                #</span></div><div class="line">            <span class="comment">#########################################################################</span></div><div class="line"></div><div class="line">            <span class="keyword">if</span> verbose <span class="keyword">and</span> it % <span class="number">100</span> == <span class="number">0</span>:</div><div class="line">                <span class="keyword">print</span> <span class="string">'iteration %d / %d: loss %f'</span> % (it, num_iters, loss)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> loss_history</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(self, X)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Use the trained weights of this linear classifier to predict labels for</div><div class="line">        data points.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - X: D x N array of training data. Each column is a D-dimensional point.</div><div class="line"></div><div class="line">        Returns:</div><div class="line">        - y_pred: Predicted labels for the data in X. y_pred is a 1-dimensional</div><div class="line">          array of length N, and each element is an integer giving the predicted</div><div class="line">          class.</div><div class="line">        """</div><div class="line">        X = X.T</div><div class="line">        y_pred = np.zeros(X.shape[<span class="number">1</span>])</div><div class="line">        <span class="comment">###########################################################################</span></div><div class="line">        <span class="comment"># <span class="doctag">TODO:</span>                                                                   #</span></div><div class="line">        <span class="comment"># Implement this method. Store the predicted labels in y_pred.            #</span></div><div class="line">        <span class="comment">###########################################################################</span></div><div class="line">        scores = X.T.dot(self.W)</div><div class="line">        y_pred = np.argsort(scores, axis=<span class="number">1</span>)[:, <span class="number">-1</span>]</div><div class="line">        <span class="comment">###########################################################################</span></div><div class="line">        <span class="comment">#                           END OF YOUR CODE                              #</span></div><div class="line">        <span class="comment">###########################################################################</span></div><div class="line">        <span class="keyword">return</span> y_pred</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loss</span><span class="params">(self, X_batch, y_batch, reg)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Compute the loss function and its derivative.</div><div class="line">        Subclasses will override this.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - X_batch: A numpy array of shape (N, D) containing a minibatch of N</div><div class="line">          data points; each point has dimension D.</div><div class="line">        - y_batch: A numpy array of shape (N,) containing labels for the minibatch.</div><div class="line">        - reg: (float) regularization strength.</div><div class="line"></div><div class="line">        Returns: A tuple containing:</div><div class="line">        - loss as a single float</div><div class="line">        - gradient with respect to self.W; an array of the same shape as W</div><div class="line">        """</div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearSVM</span><span class="params">(LinearClassifier)</span>:</span></div><div class="line">    <span class="string">""" A subclass that uses the Multiclass SVM loss function """</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loss</span><span class="params">(self, X_batch, y_batch, reg)</span>:</span></div><div class="line">        <span class="keyword">return</span> svm_loss_vectorized(self.W, X_batch, y_batch, reg)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Softmax</span><span class="params">(LinearClassifier)</span>:</span></div><div class="line">    <span class="string">""" A subclass that uses the Softmax + Cross-entropy loss function """</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loss</span><span class="params">(self, X_batch, y_batch, reg)</span>:</span></div><div class="line">        <span class="keyword">return</span> softmax_loss_vectorized(self.W, X_batch, y_batch, reg)</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Multiclass-Support-Vector-Machine-exercise&quot;&gt;&lt;a href=&quot;#Multiclass-Support-Vector-Machine-exercise&quot; class=&quot;headerlink&quot; title=&quot;Multicla
    
    </summary>
    
    
      <category term="machine learning" scheme="http://yoursite.com/tags/machine-learning/"/>
    
      <category term="deep learning" scheme="http://yoursite.com/tags/deep-learning/"/>
    
      <category term="svm" scheme="http://yoursite.com/tags/svm/"/>
    
  </entry>
  
  <entry>
    <title>cs231n Assignment#1 kNN</title>
    <link href="http://yoursite.com/2017/03/02/cs231n-Assignment-1-kNN/"/>
    <id>http://yoursite.com/2017/03/02/cs231n-Assignment-1-kNN/</id>
    <published>2017-03-02T14:26:57.000Z</published>
    <updated>2017-03-02T14:43:27.690Z</updated>
    
    <content type="html"><![CDATA[<h1 id="k-Nearest-Neighbor-kNN-exercise"><a href="#k-Nearest-Neighbor-kNN-exercise" class="headerlink" title="k-Nearest Neighbor (kNN) exercise"></a>k-Nearest Neighbor (kNN) exercise</h1><p><em>Complete and hand in this completed worksheet (including its outputs and any supporting code outside of the worksheet) with your assignment submission. For more details see the <a href="http://vision.stanford.edu/teaching/cs231n/assignments.html" target="_blank" rel="external">assignments page</a> on the course website.</em></p><p>The kNN classifier consists of two stages:</p><ul><li>During training, the classifier takes the training data and simply remembers it</li><li>During testing, kNN classifies every test image by comparing to all training images and transfering the labels of the k most similar training examples</li><li>The value of k is cross-validated</li></ul><p>In this exercise you will implement these steps and understand the basic Image Classification pipeline, cross-validation, and gain proficiency in writing efficient, vectorized code.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Run some setup code for this notebook.</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> random</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> cs231n.data_utils <span class="keyword">import</span> load_CIFAR10</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"></div><div class="line"><span class="comment"># This is a bit of magic to make matplotlib figures appear inline in the notebook</span></div><div class="line"><span class="comment"># rather than in a new window.</span></div><div class="line">%matplotlib inline</div><div class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">10.0</span>, <span class="number">8.0</span>) <span class="comment"># set default size of plots</span></div><div class="line">plt.rcParams[<span class="string">'image.interpolation'</span>] = <span class="string">'nearest'</span></div><div class="line">plt.rcParams[<span class="string">'image.cmap'</span>] = <span class="string">'gray'</span></div><div class="line"></div><div class="line"><span class="comment"># Some more magic so that the notebook will reload external python modules;</span></div><div class="line"><span class="comment"># see http://stackoverflow.com/questions/1907993/autoreload-of-modules-in-ipython</span></div><div class="line">%load_ext autoreload</div><div class="line">%autoreload <span class="number">2</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Load the raw CIFAR-10 data.</span></div><div class="line">cifar10_dir = <span class="string">'cs231n/datasets/cifar-10-batches-py'</span></div><div class="line">X_train, y_train, X_test, y_test = load_CIFAR10(cifar10_dir)</div><div class="line"></div><div class="line"><span class="comment"># As a sanity check, we print out the size of the training and test data.</span></div><div class="line"><span class="keyword">print</span> <span class="string">'Training data shape: '</span>, X_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Training labels shape: '</span>, y_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test data shape: '</span>, X_test.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test labels shape: '</span>, y_test.shape</div></pre></td></tr></table></figure><pre><code>Training data shape:  (50000L, 32L, 32L, 3L)
Training labels shape:  (50000L,)
Test data shape:  (10000L, 32L, 32L, 3L)
Test labels shape:  (10000L,)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Visualize some examples from the dataset.</span></div><div class="line"><span class="comment"># We show a few examples of training images from each class.</span></div><div class="line">classes = [<span class="string">'plane'</span>, <span class="string">'car'</span>, <span class="string">'bird'</span>, <span class="string">'cat'</span>, <span class="string">'deer'</span>, <span class="string">'dog'</span>, <span class="string">'frog'</span>, <span class="string">'horse'</span>, <span class="string">'ship'</span>, <span class="string">'truck'</span>]</div><div class="line">num_classes = len(classes)</div><div class="line">samples_per_class = <span class="number">7</span></div><div class="line"><span class="keyword">for</span> y, cls <span class="keyword">in</span> enumerate(classes):</div><div class="line">    idxs = np.flatnonzero(y_train == y)</div><div class="line">    idxs = np.random.choice(idxs, samples_per_class, replace=<span class="keyword">False</span>)</div><div class="line">    <span class="keyword">for</span> i, idx <span class="keyword">in</span> enumerate(idxs):</div><div class="line">        plt_idx = i * num_classes + y + <span class="number">1</span></div><div class="line">        plt.subplot(samples_per_class, num_classes, plt_idx)</div><div class="line">        plt.imshow(X_train[idx].astype(<span class="string">'uint8'</span>))</div><div class="line">        plt.axis(<span class="string">'off'</span>)</div><div class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:</div><div class="line">            plt.title(cls)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/knn/sample.png" alt="sample"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Subsample the data for more efficient code execution in this exercise</span></div><div class="line">num_training = <span class="number">5000</span></div><div class="line">mask = range(num_training)</div><div class="line">X_train = X_train[mask]</div><div class="line">y_train = y_train[mask]</div><div class="line"></div><div class="line">num_test = <span class="number">500</span></div><div class="line">mask = range(num_test)</div><div class="line">X_test = X_test[mask]</div><div class="line">y_test = y_test[mask]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Reshape the image data into rows</span></div><div class="line">X_train = np.reshape(X_train, (X_train.shape[<span class="number">0</span>], <span class="number">-1</span>)) <span class="comment"># Wow~</span></div><div class="line">X_test = np.reshape(X_test, (X_test.shape[<span class="number">0</span>], <span class="number">-1</span>))</div><div class="line"><span class="keyword">print</span> X_train.shape, X_test.shape</div></pre></td></tr></table></figure><pre><code>(5000L, 3072L) (500L, 3072L)
</code></pre><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> cs231n.classifiers <span class="keyword">import</span> KNearestNeighbor</div><div class="line"></div><div class="line"><span class="comment"># Create a kNN classifier instance. </span></div><div class="line"><span class="comment"># Remember that training a kNN classifier is a noop: </span></div><div class="line"><span class="comment"># the Classifier simply remembers the data and does no further processing </span></div><div class="line">classifier = KNearestNeighbor()</div><div class="line">classifier.train(X_train, y_train)</div></pre></td></tr></table></figure><p>We would now like to classify the test data with the kNN classifier. Recall that we can break down this process into two steps:</p><ol><li>First we must compute the distances between all test examples and all train examples.</li><li>Given these distances, for each test example we find the k nearest examples and have them vote for the label</li></ol><p>Lets begin with computing the distance matrix between all training and test examples. For example, if there are <strong>Ntr</strong> training examples and <strong>Nte</strong> test examples, this stage should result in a <strong>Nte x Ntr</strong> matrix where each element (i,j) is the distance between the i-th test and j-th train example.</p><p>First, open <code>cs231n/classifiers/k_nearest_neighbor.py</code> and implement the function <code>compute_distances_two_loops</code> that uses a (very inefficient) double loop over all pairs of (test, train) examples and computes the distance matrix one element at a time.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Open cs231n/classifiers/k_nearest_neighbor.py and implement</span></div><div class="line"><span class="comment"># compute_distances_two_loops.</span></div><div class="line"></div><div class="line"><span class="comment"># Test your implementation:</span></div><div class="line">dists = classifier.compute_distances_two_loops(X_test)</div><div class="line"><span class="keyword">print</span> dists.shape</div></pre></td></tr></table></figure><pre><code>(500L, 5000L)
</code></pre><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># We can visualize the distance matrix: each row is a single test example and</span></div><div class="line"><span class="comment"># its distances to training examples</span></div><div class="line">plt.imshow(dists, interpolation=<span class="string">'none'</span>)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/knn/dists.png" alt="dists"></p><p><strong>Inline Question #1:</strong> Notice the structured patterns in the distance matrix, where some rows or columns are visible brighter. (Note that with the default color scheme black indicates low distances while white indicates high distances.)</p><ul><li>What in the data is the cause behind the distinctly bright rows?</li><li>What causes the columns?</li></ul><p><strong>Your Answer</strong>: <em>Maybe exists noises in test data set and train data set.</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Now implement the function predict_labels and run the code below:</span></div><div class="line"><span class="comment"># We use k = 1 (which is Nearest Neighbor).</span></div><div class="line">y_test_pred = classifier.predict_labels(dists, k=<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="comment"># Compute and print the fraction of correctly predicted examples</span></div><div class="line">num_correct = np.sum(y_test_pred == y_test)</div><div class="line">accuracy = float(num_correct) / num_test</div><div class="line"><span class="keyword">print</span> <span class="string">'Got %d / %d correct =&gt; accuracy: %f'</span> % (num_correct, num_test, accuracy)</div></pre></td></tr></table></figure><pre><code>Got 137 / 500 correct =&gt; accuracy: 0.274000
</code></pre><p>​</p><p>You should expect to see approximately <code>27%</code> accuracy. Now lets try out a larger <code>k</code>, say <code>k = 5</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">y_test_pred = classifier.predict_labels(dists, k=<span class="number">5</span>)</div><div class="line">num_correct = np.sum(y_test_pred == y_test)</div><div class="line">accuracy = float(num_correct) / num_test</div><div class="line"><span class="keyword">print</span> <span class="string">'Got %d / %d correct =&gt; accuracy: %f'</span> % (num_correct, num_test, accuracy)</div></pre></td></tr></table></figure><pre><code>Got 142 / 500 correct =&gt; accuracy: 0.284000
</code></pre><p>​</p><p>You should expect to see a slightly better performance than with <code>k = 1</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Now lets speed up distance matrix computation by using partial vectorization</span></div><div class="line"><span class="comment"># with one loop. Implement the function compute_distances_one_loop and run the</span></div><div class="line"><span class="comment"># code below:</span></div><div class="line">dists_one = classifier.compute_distances_one_loop(X_test)</div><div class="line"></div><div class="line"><span class="comment"># To ensure that our vectorized implementation is correct, we make sure that it</span></div><div class="line"><span class="comment"># agrees with the naive implementation. There are many ways to decide whether</span></div><div class="line"><span class="comment"># two matrices are similar; one of the simplest is the Frobenius norm. In case</span></div><div class="line"><span class="comment"># you haven't seen it before, the Frobenius norm of two matrices is the square</span></div><div class="line"><span class="comment"># root of the squared sum of differences of all elements; in other words, reshape</span></div><div class="line"><span class="comment"># the matrices into vectors and compute the Euclidean distance between them.</span></div><div class="line">difference = np.linalg.norm(dists - dists_one, ord=<span class="string">'fro'</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">'Difference was: %f'</span> % (difference, )</div><div class="line"><span class="keyword">if</span> difference &lt; <span class="number">0.001</span>:</div><div class="line">  <span class="keyword">print</span> <span class="string">'Good! The distance matrices are the same'</span></div><div class="line"><span class="keyword">else</span>:</div><div class="line">  <span class="keyword">print</span> <span class="string">'Uh-oh! The distance matrices are different'</span></div></pre></td></tr></table></figure><pre><code>Difference was: 0.000000
Good! The distance matrices are the same
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Now implement the fully vectorized version inside compute_distances_no_loops</span></div><div class="line"><span class="comment"># and run the code</span></div><div class="line">dists_two = classifier.compute_distances_no_loops(X_test)</div><div class="line"></div><div class="line"><span class="comment"># check that the distance matrix agrees with the one we computed before:</span></div><div class="line">difference = np.linalg.norm(dists - dists_two, ord=<span class="string">'fro'</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">'Difference was: %f'</span> % (difference, )</div><div class="line"><span class="keyword">if</span> difference &lt; <span class="number">0.001</span>:</div><div class="line">  <span class="keyword">print</span> <span class="string">'Good! The distance matrices are the same'</span></div><div class="line"><span class="keyword">else</span>:</div><div class="line">  <span class="keyword">print</span> <span class="string">'Uh-oh! The distance matrices are different'</span></div></pre></td></tr></table></figure><pre><code>Difference was: 0.000000
Good! The distance matrices are the same
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Let's compare how fast the implementations are</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">time_function</span><span class="params">(f, *args)</span>:</span></div><div class="line">  <span class="string">"""</span></div><div class="line">  Call a function f with args and return the time (in seconds) that it took to execute.</div><div class="line">  """</div><div class="line">  <span class="keyword">import</span> time</div><div class="line">  tic = time.time()</div><div class="line">  f(*args)</div><div class="line">  toc = time.time()</div><div class="line">  <span class="keyword">return</span> toc - tic</div><div class="line"></div><div class="line">two_loop_time = time_function(classifier.compute_distances_two_loops, X_test)</div><div class="line"><span class="keyword">print</span> <span class="string">'Two loop version took %f seconds'</span> % two_loop_time</div><div class="line"></div><div class="line">one_loop_time = time_function(classifier.compute_distances_one_loop, X_test)</div><div class="line"><span class="keyword">print</span> <span class="string">'One loop version took %f seconds'</span> % one_loop_time</div><div class="line"></div><div class="line">no_loop_time = time_function(classifier.compute_distances_no_loops, X_test)</div><div class="line"><span class="keyword">print</span> <span class="string">'No loop version took %f seconds'</span> % no_loop_time</div><div class="line"></div><div class="line"><span class="comment"># you should see significantly faster performance with the fully vectorized implementation</span></div></pre></td></tr></table></figure><pre><code>Two loop version took 27.001000 seconds
One loop version took 59.630000 seconds
No loop version took 0.205000 seconds
</code></pre><h3 id="Cross-validation"><a href="#Cross-validation" class="headerlink" title="Cross-validation"></a>Cross-validation</h3><p>We have implemented the k-Nearest Neighbor classifier but we set the value k = 5 arbitrarily. We will now determine the best value of this hyperparameter with cross-validation.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">num_folds = <span class="number">5</span></div><div class="line">k_choices = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">20</span>, <span class="number">50</span>, <span class="number">100</span>]</div><div class="line"></div><div class="line">X_train_folds = []</div><div class="line">y_train_folds = []</div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment"># <span class="doctag">TODO:</span>                                                                        #</span></div><div class="line"><span class="comment"># Split up the training data into folds. After splitting, X_train_folds and    #</span></div><div class="line"><span class="comment"># y_train_folds should each be lists of length num_folds, where                #</span></div><div class="line"><span class="comment"># y_train_folds[i] is the label vector for the points in X_train_folds[i].     #</span></div><div class="line"><span class="comment"># Hint: Look up the numpy array_split function.                                #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line">X_train_folds = np.array_split(X_train, num_folds)</div><div class="line">y_train_folds = np.array_split(y_train, num_folds)</div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment">#                                 END OF YOUR CODE                             #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"></div><div class="line"><span class="comment"># A dictionary holding the accuracies for different values of k that we find</span></div><div class="line"><span class="comment"># when running cross-validation. After running cross-validation,</span></div><div class="line"><span class="comment"># k_to_accuracies[k] should be a list of length num_folds giving the different</span></div><div class="line"><span class="comment"># accuracy values that we found when using that value of k.</span></div><div class="line">k_to_accuracies = &#123;&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment"># <span class="doctag">TODO:</span>                                                                        #</span></div><div class="line"><span class="comment"># Perform k-fold cross validation to find the best value of k. For each        #</span></div><div class="line"><span class="comment"># possible value of k, run the k-nearest-neighbor algorithm num_folds times,   #</span></div><div class="line"><span class="comment"># where in each case you use all but one of the folds as training data and the #</span></div><div class="line"><span class="comment"># last fold as a validation set. Store the accuracies for all fold and all     #</span></div><div class="line"><span class="comment"># values of k in the k_to_accuracies dictionary.                               #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="keyword">for</span> k <span class="keyword">in</span> k_choices:</div><div class="line">    k_to_accuracies[k] = []</div><div class="line">    <span class="keyword">for</span> fold <span class="keyword">in</span> xrange(num_folds):</div><div class="line">        train_X = np.append(</div><div class="line">            X_train_folds[:fold], X_train_folds[fold+<span class="number">1</span>:]).reshape(</div><div class="line">            (X_train.shape[<span class="number">0</span>] - X_train.shape[<span class="number">0</span>]/num_folds, <span class="number">-1</span>))</div><div class="line">        train_y = np.append(</div><div class="line">            y_train_folds[:fold], y_train_folds[fold+<span class="number">1</span>:]).reshape(</div><div class="line">            (y_train.shape[<span class="number">0</span>] - y_train.shape[<span class="number">0</span>]/num_folds, <span class="number">-1</span>)).flatten()</div><div class="line">        classifier.train(train_X, train_y)</div><div class="line">        dists = classifier.compute_distances_no_loops(X_train_folds[fold])</div><div class="line">        y_test_pred = classifier.predict_labels(dists, k)</div><div class="line">        </div><div class="line">        num_correct = np.sum(y_test_pred == y_train_folds[fold])</div><div class="line">        accuracy = float(num_correct) / len(y_train_folds[fold])</div><div class="line">        k_to_accuracies[k].append(accuracy)</div><div class="line">        </div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment">#                                 END OF YOUR CODE                             #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"></div><div class="line"><span class="comment"># Print out the computed accuracies</span></div><div class="line"><span class="keyword">for</span> k <span class="keyword">in</span> sorted(k_to_accuracies):</div><div class="line">    <span class="keyword">for</span> accuracy <span class="keyword">in</span> k_to_accuracies[k]:</div><div class="line">        <span class="keyword">print</span> <span class="string">'k = %d, accuracy = %f'</span> % (k, accuracy)</div></pre></td></tr></table></figure><pre><code>k = 1, accuracy = 0.263000
k = 1, accuracy = 0.257000
k = 1, accuracy = 0.264000
k = 1, accuracy = 0.278000
k = 1, accuracy = 0.266000
k = 3, accuracy = 0.241000
k = 3, accuracy = 0.249000
k = 3, accuracy = 0.243000
k = 3, accuracy = 0.273000
k = 3, accuracy = 0.264000
k = 5, accuracy = 0.258000
k = 5, accuracy = 0.273000
k = 5, accuracy = 0.281000
k = 5, accuracy = 0.290000
k = 5, accuracy = 0.272000
k = 8, accuracy = 0.263000
k = 8, accuracy = 0.288000
k = 8, accuracy = 0.278000
k = 8, accuracy = 0.285000
k = 8, accuracy = 0.277000
k = 10, accuracy = 0.265000
k = 10, accuracy = 0.296000
k = 10, accuracy = 0.278000
k = 10, accuracy = 0.284000
k = 10, accuracy = 0.286000
k = 12, accuracy = 0.260000
k = 12, accuracy = 0.294000
k = 12, accuracy = 0.281000
k = 12, accuracy = 0.282000
k = 12, accuracy = 0.281000
k = 15, accuracy = 0.255000
k = 15, accuracy = 0.290000
k = 15, accuracy = 0.281000
k = 15, accuracy = 0.281000
k = 15, accuracy = 0.276000
k = 20, accuracy = 0.270000
k = 20, accuracy = 0.281000
k = 20, accuracy = 0.280000
k = 20, accuracy = 0.282000
k = 20, accuracy = 0.284000
k = 50, accuracy = 0.271000
k = 50, accuracy = 0.288000
k = 50, accuracy = 0.278000
k = 50, accuracy = 0.269000
k = 50, accuracy = 0.266000
k = 100, accuracy = 0.256000
k = 100, accuracy = 0.270000
k = 100, accuracy = 0.263000
k = 100, accuracy = 0.256000
k = 100, accuracy = 0.263000
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># plot the raw observations</span></div><div class="line"><span class="keyword">for</span> k <span class="keyword">in</span> k_choices:</div><div class="line">  accuracies = k_to_accuracies[k]</div><div class="line">  plt.scatter([k] * len(accuracies), accuracies)</div><div class="line"></div><div class="line"><span class="comment"># plot the trend line with error bars that correspond to standard deviation</span></div><div class="line">accuracies_mean = np.array([np.mean(v) <span class="keyword">for</span> k,v <span class="keyword">in</span> sorted(k_to_accuracies.items())])</div><div class="line">accuracies_std = np.array([np.std(v) <span class="keyword">for</span> k,v <span class="keyword">in</span> sorted(k_to_accuracies.items())])</div><div class="line">plt.errorbar(k_choices, accuracies_mean, yerr=accuracies_std)</div><div class="line">plt.title(<span class="string">'Cross-validation on k'</span>)</div><div class="line">plt.xlabel(<span class="string">'k'</span>)</div><div class="line">plt.ylabel(<span class="string">'Cross-validation accuracy'</span>)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/knn/cv.png" alt="cv"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Based on the cross-validation results above, choose the best value for k,   </span></div><div class="line"><span class="comment"># retrain the classifier using all the training data, and test it on the test</span></div><div class="line"><span class="comment"># data. You should be able to get above 28% accuracy on the test data.</span></div><div class="line">best_k = <span class="number">10</span></div><div class="line"></div><div class="line">classifier = KNearestNeighbor()</div><div class="line">classifier.train(X_train, y_train)</div><div class="line">y_test_pred = classifier.predict(X_test, k=best_k)</div><div class="line"></div><div class="line"><span class="comment"># Compute and display the accuracy</span></div><div class="line">num_correct = np.sum(y_test_pred == y_test)</div><div class="line">accuracy = float(num_correct) / num_test</div><div class="line"><span class="keyword">print</span> <span class="string">'Got %d / %d correct =&gt; accuracy: %f'</span> % (num_correct, num_test, accuracy)</div></pre></td></tr></table></figure><pre><code>Got 139 / 500 correct =&gt; accuracy: 0.278000
</code></pre><p>​</p><h1 id="k-nearest-neighbor-py"><a href="#k-nearest-neighbor-py" class="headerlink" title="k_nearest_neighbor.py"></a>k_nearest_neighbor.py</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> operator</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">KNearestNeighbor</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="string">""" a kNN classifier with L2 distance """</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self, X, y)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Train the classifier. For k-nearest neighbors this is just</div><div class="line">        memorizing the training data.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - X: A numpy array of shape (num_train, D) containing the training data</div><div class="line">          consisting of num_train samples each of dimension D.</div><div class="line">        - y: A numpy array of shape (N,) containing the training labels, where</div><div class="line">             y[i] is the label for X[i].</div><div class="line">        """</div><div class="line">        self.X_train = X</div><div class="line">        self.y_train = y</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(self, X, k=<span class="number">1</span>, num_loops=<span class="number">0</span>)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Predict labels for test data using this classifier.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - X: A numpy array of shape (num_test, D) containing</div><div class="line">             test data consisting of num_test samples each of dimension D.</div><div class="line">        - k: The number of nearest neighbors that vote for</div><div class="line">             the predicted labels.</div><div class="line">        - num_loops: Determines which implementation to use</div><div class="line">                     to compute distances</div><div class="line">          between training points and testing points.</div><div class="line"></div><div class="line">        Returns:</div><div class="line">        - y: A numpy array of shape (num_test,)</div><div class="line">             containing predicted labels for the</div><div class="line">             test data, where y[i] is the predicted</div><div class="line">             label for the test point X[i].</div><div class="line">        """</div><div class="line">        <span class="keyword">if</span> num_loops == <span class="number">0</span>:</div><div class="line">            dists = self.compute_distances_no_loops(X)</div><div class="line">        <span class="keyword">elif</span> num_loops == <span class="number">1</span>:</div><div class="line">            dists = self.compute_distances_one_loop(X)</div><div class="line">        <span class="keyword">elif</span> num_loops == <span class="number">2</span>:</div><div class="line">            dists = self.compute_distances_two_loops(X)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'Invalid value %d for num_loops'</span> % num_loops)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> self.predict_labels(dists, k=k)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compute_distances_two_loops</span><span class="params">(self, X)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Compute the distance between each test point in X and each training</div><div class="line">        point in self.X_train using a nested loop over both the training data</div><div class="line">        and the test data.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - X: A numpy array of shape (num_test, D) containing test data.</div><div class="line"></div><div class="line">        Returns:</div><div class="line">        - dists: A numpy array of shape (num_test, num_train) where dists[i, j]</div><div class="line">          is the Euclidean distance between the ith test point and the jth</div><div class="line">          training point.</div><div class="line">        """</div><div class="line">        num_test = X.shape[<span class="number">0</span>]</div><div class="line">        num_train = self.X_train.shape[<span class="number">0</span>]</div><div class="line">        dists = np.zeros((num_test, num_train))</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(num_test):</div><div class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> xrange(num_train):</div><div class="line">                <span class="comment">###############################################################</span></div><div class="line">                <span class="comment"># <span class="doctag">TODO:</span>                                                             #</span></div><div class="line">                <span class="comment"># Compute the l2 distance between the ith test point and the jth    #</span></div><div class="line">                <span class="comment"># training point, and store the result in dists[i, j]. You should   #</span></div><div class="line">                <span class="comment"># not use a loop over dimension.                                    #</span></div><div class="line">                <span class="comment">###############################################################</span></div><div class="line">                dists[i, j] = np.sqrt(np.sum((X[i, :] - self.X_train[j, :]) ** <span class="number">2</span>))</div><div class="line">            <span class="comment">###############################################################</span></div><div class="line">            <span class="comment">#                       END OF YOUR CODE                            #</span></div><div class="line">            <span class="comment">###############################################################</span></div><div class="line">        <span class="keyword">return</span> dists</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compute_distances_one_loop</span><span class="params">(self, X)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Compute the distance between each test point in X and each training point</div><div class="line">        in self.X_train using a single loop over the test data.</div><div class="line"></div><div class="line">        Input / Output: Same as compute_distances_two_loops</div><div class="line">        """</div><div class="line">        num_test = X.shape[<span class="number">0</span>]</div><div class="line">        num_train = self.X_train.shape[<span class="number">0</span>]</div><div class="line">        dists = np.zeros((num_test, num_train))</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(num_test):</div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            <span class="comment"># <span class="doctag">TODO:</span>                                                               #</span></div><div class="line">            <span class="comment"># Compute the l2 distance between the ith test point and all training #</span></div><div class="line">            <span class="comment"># points, and store the result in dists[i, :].                        #</span></div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            dists[i, :] = np.sqrt(np.sum(np.square(X[i, :] - self.X_train), axis=<span class="number">1</span>))</div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            <span class="comment">#                         END OF YOUR CODE                            #</span></div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">        <span class="keyword">return</span> dists</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compute_distances_no_loops</span><span class="params">(self, X)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Compute the distance between each test point in X and each training point</div><div class="line">        in self.X_train using no explicit loops.</div><div class="line"></div><div class="line">        Input / Output: Same as compute_distances_two_loops</div><div class="line">        """</div><div class="line">        num_test = X.shape[<span class="number">0</span>]</div><div class="line">        num_train = self.X_train.shape[<span class="number">0</span>]</div><div class="line">        dists = np.zeros((num_test, num_train))</div><div class="line">        <span class="comment">#######################################################################</span></div><div class="line">        <span class="comment"># <span class="doctag">TODO:</span>                                                                 #</span></div><div class="line">        <span class="comment"># Compute the l2 distance between all test points and all training      #</span></div><div class="line">        <span class="comment"># points without using any explicit loops, and store the result in      #</span></div><div class="line">        <span class="comment"># dists.                                                                #</span></div><div class="line">        <span class="comment">#                                                                       #</span></div><div class="line">        <span class="comment"># You should implement this function using only basic array operations; #</span></div><div class="line">        <span class="comment"># in particular you should not use functions from scipy.                #</span></div><div class="line">        <span class="comment">#                                                                       #</span></div><div class="line">        <span class="comment"># HINT: Try to formulate the l2 distance using matrix multiplication    #</span></div><div class="line">        <span class="comment">#       and two broadcast sums.                                         #</span></div><div class="line">        <span class="comment">#######################################################################</span></div><div class="line">        dists = np.sqrt(np.multiply(np.dot(X, self.X_train.T), <span class="number">-2</span>) +</div><div class="line">                        np.sum(self.X_train ** <span class="number">2</span>, axis=<span class="number">1</span>) +</div><div class="line">                        np.sum(X ** <span class="number">2</span>, axis=<span class="number">1</span>)[:, np.newaxis])</div><div class="line">        <span class="comment">#######################################################################</span></div><div class="line">        <span class="comment">#                         END OF YOUR CODE                              #</span></div><div class="line">        <span class="comment">#######################################################################</span></div><div class="line">        <span class="keyword">return</span> dists</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict_labels</span><span class="params">(self, dists, k=<span class="number">1</span>)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Given a matrix of distances between test points and training points,</div><div class="line">        predict a label for each test point.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - dists: A numpy array of shape (num_test, num_train) where dists[i, j]</div><div class="line">          gives the distance betwen the ith test point and the jth training point.</div><div class="line"></div><div class="line">        Returns:</div><div class="line">        - y: A numpy array of shape (num_test,) containing predicted labels for the</div><div class="line">          test data, where y[i] is the predicted label for the test point X[i].</div><div class="line">        """</div><div class="line">        num_test = dists.shape[<span class="number">0</span>]</div><div class="line">        y_pred = np.zeros(num_test)</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(num_test):</div><div class="line">            <span class="comment"># A list of length k storing the labels of the k nearest neighbors to</span></div><div class="line">            <span class="comment"># the ith test point.</span></div><div class="line">            closest_y = []</div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            <span class="comment"># <span class="doctag">TODO:</span>                                                                 #</span></div><div class="line">            <span class="comment"># Use the distance matrix to find the k nearest neighbors of the ith    #</span></div><div class="line">            <span class="comment"># testing point, and use self.y_train to find the labels of these       #</span></div><div class="line">            <span class="comment"># neighbors. Store these labels in closest_y.                           #</span></div><div class="line">            <span class="comment"># Hint: Look up the function numpy.argsort.                             #</span></div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            k_nearest_index = np.argsort(dists[i, :])[:k]</div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            <span class="comment"># <span class="doctag">TODO:</span>                                                                 #</span></div><div class="line">            <span class="comment"># Now that you have found the labels of the k nearest neighbors, you    #</span></div><div class="line">            <span class="comment"># need to find the most common label in the list closest_y of labels.   #</span></div><div class="line">            <span class="comment"># Store this label in y_pred[i]. Break ties by choosing the smaller     #</span></div><div class="line">            <span class="comment"># label.                                                                #</span></div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            closest_y = self.y_train[k_nearest_index]</div><div class="line">            labels_counts = &#123;&#125;</div><div class="line">            <span class="keyword">for</span> label <span class="keyword">in</span> closest_y:</div><div class="line">                <span class="keyword">if</span> label <span class="keyword">in</span> labels_counts.keys():</div><div class="line">                    labels_counts[label] += <span class="number">1</span></div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    labels_counts[label] = <span class="number">0</span></div><div class="line">            sorted_labels_counts = sorted(</div><div class="line">                labels_counts.items(), key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="keyword">True</span>)</div><div class="line">            y_pred[i] = sorted_labels_counts[<span class="number">0</span>][<span class="number">0</span>]</div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            <span class="comment">#                           END OF YOUR CODE                            #</span></div><div class="line">            <span class="comment">###################################################################</span></div><div class="line"></div><div class="line">        <span class="keyword">return</span> y_pred</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;k-Nearest-Neighbor-kNN-exercise&quot;&gt;&lt;a href=&quot;#k-Nearest-Neighbor-kNN-exercise&quot; class=&quot;headerlink&quot; title=&quot;k-Nearest Neighbor (kNN) exerc
    
    </summary>
    
    
      <category term="machine learning" scheme="http://yoursite.com/tags/machine-learning/"/>
    
      <category term="kNN" scheme="http://yoursite.com/tags/kNN/"/>
    
  </entry>
  
  <entry>
    <title>CS231n Lecture3 note</title>
    <link href="http://yoursite.com/2017/03/02/CS231n-Lecture3-note/"/>
    <id>http://yoursite.com/2017/03/02/CS231n-Lecture3-note/</id>
    <published>2017-03-02T06:33:34.000Z</published>
    <updated>2017-03-03T11:06:37.472Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Loss-function"><a href="#Loss-function" class="headerlink" title="Loss function"></a>Loss function</h1><p>Source is <a href="http://cs231n.github.io/linear-classify/" target="_blank" rel="external">here</a>.</p><h2 id="Multiclass-Support-Vector-Machine-loss"><a href="#Multiclass-Support-Vector-Machine-loss" class="headerlink" title="Multiclass Support Vector Machine loss"></a>Multiclass Support Vector Machine loss</h2><p>The SVM loss is set up so that the SVM “wants” the correct class for each image to a have a score higher than the incorrect classes by some fixed margin $\Delta$</p><p>The Multiclass SVM loss for the i-th example is formalized as follows:</p><p><strong>Example</strong></p><p>$s = [13, -7, 11]$ and $\Delta = 10$, then,</p><script type="math/tex;mode=display">L_i = \max(0, -7 - 13 + 10) + \max(0, 11 - 13 + 10)</script><p>In summary, the SVM loss function wants the score of the correct class $y_i$ to be larger than the incorrect class scores by at least by $\Delta$ (delta). If this is not the case, we will accumulate loss.</p><p>Note that $f(x_i; W) = W x_i$, so we can also rewrite the loss function in this equivalent form:</p><script type="math/tex;mode=display">L_i = \sum_{j\neq y_i} \max(0, w_j^T x_i - w_{y_i}^T x_i + \Delta)</script><p>A last piece of terminology we’ll mention before we finish with this section is that the threshold at zero $\max(0,−)$ function is often called the <strong>hinge loss</strong>. You’ll sometimes hear about people instead using the squared hinge loss SVM (or L2-SVM), which uses the form $\max(0,−)^2$ that penalizes violated margins more strongly (quadratically instead of linearly). The unsquared version is more standard, but in some datasets the squared hinge loss can work better. This can be determined during cross-validation.</p><p>The follow image shows the motivation of the SVM loss function”</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/03/margin.jpg" alt="margin"></p><h3 id="Regularization"><a href="#Regularization" class="headerlink" title="Regularization"></a>Regularization</h3><p>There is one bug with the loss function we presented above. Suppose that we have a dataset and a set of parameters <strong>W</strong> that correctly classify every example (i.e. all scores are so that all the margins are met, and $L_i=0$ for all i). The issue is that this set of <strong>W</strong> is not necessarily unique: there might be many similar <strong>W</strong> that correctly classify the examples. One easy way to see this is that if some parameters <strong>W</strong> correctly classify all examples (so loss is zero for each example), then any multiple of these parameters $\lambda W$ where $\lambda &gt; 1$ will also give zero loss because this transformation uniformly stretches all score magnitudes and hence also their absolute differences. For example, if the difference in scores between a correct class and a nearest incorrect class was 15, then multiplying all elements of <strong>W</strong> by 2 would make the new difference 30.</p><p>We can avoid this by extending the loss function with a <strong>regularization penalty</strong> $R(W)$. The most common regularization penalty is the <strong>L2</strong> norm:</p><script type="math/tex;mode=display">R(W) = \sum_k\sum_l W_{k,l}^2</script><p>That is, the full Multiclass SVM loss becomes:</p><script type="math/tex;mode=display">L =  \underbrace{ \frac{1}{N} \sum_i L_i }_\text{data loss} + \underbrace{ \lambda R(W) }_\text{regularization loss} \\\\</script><p>Or expanding this out in its full form:</p><script type="math/tex;mode=display">L = \frac{1}{N} \sum_i \sum_{j\neq y_i} \left[ \max(0, f(x_i; W)_j - f(x_i; W)_{y_i} + \Delta) \right] + \lambda \sum_k\sum_l W_{k,l}^2</script><p>Including the L2 penalty leads to the appealing <strong>max margin</strong> property in SVMs (See <a href="http://cs229.stanford.edu/notes/cs229-notes3.pdf" target="_blank" rel="external">CS229</a> lecture notes for full details if you are interested).</p><p>The most appealing property is that penalizing large weights tends to improve generalization, because it means that no input dimension can have a very large influence on the scores all by itself. For example, suppose that we have some input vector $x=[1,1,1,1]$ and two weight vectors $w_1=[1,0,0,0]$, $w_2=[0.25,0.25,0.25,0.25]$. Then $w^T_1x=w^T_2x=1$ so both weight vectors lead to the same dot product, but the <strong>L2</strong> penalty of $w_1$ is 1.0 while the <strong>L2</strong> penalty of $w_2$ is only 0.25. Therefore, according to the <strong>L2</strong> penalty the weight vector $w_2$ would be preferred since it achieves a lower regularization loss. Intuitively, this is because the weights in $w_2$ are smaller and more diffuse. Since the <strong>L2</strong> penalty prefers smaller and more diffuse weight vectors, the final classifier is encouraged to take into account all input dimensions to small amounts rather than a few input dimensions and very strongly. As we will see later in the class, this effect can improve the generalization performance of the classifiers on test images and lead to less <em>overfitting</em>.</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">L_i</span><span class="params">(x, y, W)</span>:</span></div><div class="line">  <span class="string">"""</span></div><div class="line">  unvectorized version. Compute the multiclass svm loss for a single example (x,y)</div><div class="line">  - x is a column vector representing an image (e.g. 3073 x 1 in CIFAR-10)</div><div class="line">    with an appended bias dimension in the 3073-rd position (i.e. bias trick)</div><div class="line">  - y is an integer giving index of correct class (e.g. between 0 and 9 in CIFAR-10)</div><div class="line">  - W is the weight matrix (e.g. 10 x 3073 in CIFAR-10)</div><div class="line">  """</div><div class="line">  delta = <span class="number">1.0</span> <span class="comment"># see notes about delta later in this section</span></div><div class="line">  scores = W.dot(x) <span class="comment"># scores becomes of size 10 x 1, the scores for each class</span></div><div class="line">  correct_class_score = scores[y]</div><div class="line">  D = W.shape[<span class="number">0</span>] <span class="comment"># number of classes, e.g. 10</span></div><div class="line">  loss_i = <span class="number">0.0</span></div><div class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> xrange(D): <span class="comment"># iterate over all wrong classes</span></div><div class="line">    <span class="keyword">if</span> j == y:</div><div class="line">      <span class="comment"># skip for the true class to only loop over incorrect classes</span></div><div class="line">      <span class="keyword">continue</span></div><div class="line">    <span class="comment"># accumulate loss for the i-th example</span></div><div class="line">    loss_i += max(<span class="number">0</span>, scores[j] - correct_class_score + delta)</div><div class="line">  <span class="keyword">return</span> loss_i</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">L_i_vectorized</span><span class="params">(x, y, W)</span>:</span></div><div class="line">  <span class="string">"""</span></div><div class="line">  A faster half-vectorized implementation. half-vectorized</div><div class="line">  refers to the fact that for a single example the implementation contains</div><div class="line">  no for loops, but there is still one loop over the examples (outside this function)</div><div class="line">  """</div><div class="line">  delta = <span class="number">1.0</span></div><div class="line">  scores = W.dot(x)</div><div class="line">  <span class="comment"># compute the margins for all classes in one vector operation</span></div><div class="line">  margins = np.maximum(<span class="number">0</span>, scores - scores[y] + delta)</div><div class="line">  <span class="comment"># on y-th position scores[y] - scores[y] canceled and gave delta. We want</span></div><div class="line">  <span class="comment"># to ignore the y-th position and only consider margin on max wrong class</span></div><div class="line">  margins[y] = <span class="number">0</span></div><div class="line">  loss_i = np.sum(margins)</div><div class="line">  <span class="keyword">return</span> loss_i</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">L</span><span class="params">(X, y, W)</span>:</span></div><div class="line">  <span class="string">"""</span></div><div class="line">  fully-vectorized implementation :</div><div class="line">  - X holds all the training examples as columns (e.g. 3073 x 50,000 in CIFAR-10)</div><div class="line">  - y is array of integers specifying correct class (e.g. 50,000-D array)</div><div class="line">  - W are weights (e.g. 10 x 3073)</div><div class="line">  """</div><div class="line">  <span class="comment"># evaluate loss over all examples in X without using any for loops</span></div><div class="line">  <span class="comment"># left as exercise to reader in the assignment</span></div></pre></td></tr></table></figure><h3 id="Practice-Considerations"><a href="#Practice-Considerations" class="headerlink" title="Practice Considerations"></a>Practice Considerations</h3><h4 id="Setting-Delta"><a href="#Setting-Delta" class="headerlink" title="Setting Delta"></a>Setting Delta</h4><p>Note that we brushed over the hyperparameter $\Delta$ and its setting. What value should it be set to, and do we have to cross-validate it? It turns out that this hyperparameter can safely be set to $\Delta = 1.0$ in all cases. The hyperparameters $\Delta$ and $\lambda$ seem like two different hyperparameters, but in fact they both control the same tradeoff: The tradeoff between the data loss and the regularization loss in the objective. The key to understanding this is that the magnitude of the weights <strong>W</strong> has direct effect on the scores (and hence also their differences): As we shrink all values inside <strong>W</strong> the score differences will become lower, and as we scale up the weights the score differences will all become higher. Therefore, the exact value of the margin between the scores (e.g. $\Delta = 10$, or$\Delta = 100$) is in some sense meaningless because the weights can shrink or stretch the differences arbitrarily. Hence, the only real tradeoff is how large we allow the weights to grow (through the regularization strength $\lambda$).</p><h2 id="Softmax-classifier"><a href="#Softmax-classifier" class="headerlink" title="Softmax classifier"></a>Softmax classifier</h2><p>In the Softmax classifier, the function mapping $f(x_i; W) = W x_i$ stays unchanged, but we now interpret these scores as the unnormalized log probabilities for each class and replace the <em>hinge loss</em> with a <strong>cross-entropy loss</strong> that has the form:</p><script type="math/tex;mode=display">L_i = -\log\left(\frac{e^{f_{y_i}}}{ \sum_j e^{f_j} }\right) \hspace{0.5in} \text{or equivalently} \hspace{0.5in} L_i = -f_{y_i} + \log\sum_j e^{f_j}</script><p>The function $f_j(z) = \frac{e^{z_j}}{\sum_k e^{z_k}}$ is called the <strong>softmax function</strong>.</p><h3 id="Information-theory-view"><a href="#Information-theory-view" class="headerlink" title="Information theory view"></a>Information theory view</h3><p>The <em>cross-entropy</em> between a “true” distribution $p$ and an estimated distribution $q$ is defined as:</p><script type="math/tex;mode=display">H(p,q) = - \sum_x p(x) \log q(x)</script><p>The Softmax classifier is hence minimizing the cross-entropy between the estimated class probabilities ( $q = e^{f_{y_i}} / \sum_j e^{f_j}$ as seen above) and the “true” distribution, which in this interpretation is the distribution where all probability mass is on the correct class (i.e. $p = [0, \ldots 1, \ldots, 0]$ contains a single 1 at the $y_i$ -th position.).</p><p>Moreover, since the cross-entropy can be written in terms of entropy and the Kullback-Leibler divergence as $H(p,q) = H(p) + D_{KL}(p||q)$, and the entropy of the delta function $p$ is zero, this is also equivalent to minimizing the <strong>KL</strong> divergence between the two distributions (a measure of distance). In other words, the cross-entropy objective <em>wants</em> the predicted distribution to have all of its mass on the correct answer.</p><h3 id="Probabilistic-interpretation"><a href="#Probabilistic-interpretation" class="headerlink" title="Probabilistic interpretation"></a>Probabilistic interpretation</h3><script type="math/tex;mode=display">P(y_i \mid x_i; W) = \frac{e^{f_{y_i}}}{\sum_j e^{f_j} }</script><p>can be interpreted as the (normalized) probability assigned to the correct label $y_i$given the image $x_i$ and parameterized by <strong>W</strong>. To see this, remember that the Softmax classifier interprets the scores inside the output vector $f$ as the unnormalized log probabilities. Exponentiating these quantities therefore gives the (unnormalized) probabilities, and the division performs the normalization so that the probabilities sum to one. In the probabilistic interpretation, we are therefore minimizing the negative log likelihood of the correct class, which can be interpreted as performing <em>Maximum Likelihood Estimation</em> (MLE). A nice feature of this view is that we can now also interpret the regularization term $R(W)$ in the full loss function as coming from a Gaussian prior over the weight matrix <strong>W</strong>, where instead of MLE we are performing the <em>Maximum a posteriori</em> (MAP) estimation.</p><h3 id="Numeric-stability"><a href="#Numeric-stability" class="headerlink" title="Numeric stability"></a>Numeric stability</h3><p>When you’re writing code for computing the Softmax function in practice, the intermediate term $e^{f_{y_i}}$ and $\sum_j e^{f_j}$ may be very large due to the exponentials. Dividing large numbers can be numerically unstable, so it is important to use a normalization trick. Notice that if we multiply the top and bottom of the fraction by a constant <strong>C</strong> and push it into the sum, we get the following (mathematically equivalent) expression:</p><script type="math/tex;mode=display">\frac{e^{f_{y_i}}}{\sum_j e^{f_j}}= \frac{Ce^{f_{y_i}}}{C\sum_j e^{f_j}}= \frac{e^{f_{y_i} + \log C}}{\sum_j e^{f_j + \log C}}</script><p>We are free to choose the value of <strong>C</strong>. This will not change any of the results, but we can use this value to improve the numerical stability of the computation. A common choice for <strong>C</strong> is to set $\log C = -\max_j f_j$. This simply states that we should shift the values inside the vector ff so that the highest value is zero. In code:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">f = np.array([<span class="number">123</span>, <span class="number">456</span>, <span class="number">789</span>]) <span class="comment"># example with 3 classes and each having large scores</span></div><div class="line">p = np.exp(f) / np.sum(np.exp(f)) <span class="comment"># Bad: Numeric problem, potential blowup</span></div><div class="line"></div><div class="line"><span class="comment"># instead: first shift the values of f so that the highest number is 0:</span></div><div class="line">f -= np.max(f) <span class="comment"># f becomes [-666, -333, 0]</span></div><div class="line">p = np.exp(f) / np.sum(np.exp(f)) <span class="comment"># safe to do, gives the correct answer</span></div></pre></td></tr></table></figure><h3 id="Some-tricks"><a href="#Some-tricks" class="headerlink" title="Some tricks"></a>Some tricks</h3><p>How peaky or diffuse these probabilities are depends directly on the regularization strength $\lambda$ - which you are in charge of as input to the system. For example, suppose that the unnormalized log-probabilities for some three classes come out to be [1, -2, 0]. The softmax function would then compute:</p><script type="math/tex;mode=display">[1, -2, 0] \rightarrow [e^1, e^{-2}, e^0] = [2.71, 0.14, 1] \rightarrow [0.7, 0.04, 0.26]</script><p>Where the steps taken are to exponentiate and normalize to sum to one. Now, if the regularization strength $\lambda$ was higher, the weights <strong>W</strong> would be penalized more and this would lead to smaller weights. For example, suppose that the weights became one half smaller ([0.5, -1, 0]). The softmax would now compute:</p><script type="math/tex;mode=display">[0.5, -1, 0] \rightarrow [e^{0.5}, e^{-1}, e^0] = [1.65, 0.37, 1] \rightarrow [0.55, 0.12, 0.33]</script><p>where the probabilites are now more diffuse.</p><h3 id="Futher-Reading"><a href="#Futher-Reading" class="headerlink" title="Futher Reading"></a>Futher Reading</h3><ul><li><a href="http://arxiv.org/abs/1306.0239" target="_blank" rel="external">Deep Learning using Linear Support Vector Machines</a> from Charlie Tang 2013 presents some results claiming that the L2SVM outperforms Softmax.</li></ul><h1 id="Optimization"><a href="#Optimization" class="headerlink" title="Optimization"></a>Optimization</h1><h2 id="Strategy-1-A-first-very-bad-idea-solution-Random-search"><a href="#Strategy-1-A-first-very-bad-idea-solution-Random-search" class="headerlink" title="Strategy #1: A first very bad idea solution: Random search"></a>Strategy #1: A first very bad idea solution: Random search</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># assume X_train is the data where each column is an example (e.g. 3073 x 50,000)</span></div><div class="line"><span class="comment"># assume Y_train are the labels (e.g. 1D array of 50,000)</span></div><div class="line"><span class="comment"># assume the function L evaluates the loss function</span></div><div class="line"></div><div class="line">bestloss = float(<span class="string">"inf"</span>) <span class="comment"># Python assigns the highest possible float value</span></div><div class="line"><span class="keyword">for</span> num <span class="keyword">in</span> xrange(<span class="number">1000</span>):</div><div class="line">  W = np.random.randn(<span class="number">10</span>, <span class="number">3073</span>) * <span class="number">0.0001</span> <span class="comment"># generate random parameters</span></div><div class="line">  loss = L(X_train, Y_train, W) <span class="comment"># get the loss over the entire training set</span></div><div class="line">  <span class="keyword">if</span> loss &lt; bestloss: <span class="comment"># keep track of the best solution</span></div><div class="line">    bestloss = loss</div><div class="line">    bestW = W</div><div class="line">  <span class="keyword">print</span> <span class="string">'in attempt %d the loss was %f, best %f'</span> % (num, loss, bestloss)</div><div class="line"></div><div class="line"><span class="comment"># prints:</span></div><div class="line"><span class="comment"># in attempt 0 the loss was 9.401632, best 9.401632</span></div><div class="line"><span class="comment"># in attempt 1 the loss was 8.959668, best 8.959668</span></div><div class="line"><span class="comment"># in attempt 2 the loss was 9.044034, best 8.959668</span></div><div class="line"><span class="comment"># in attempt 3 the loss was 9.278948, best 8.959668</span></div><div class="line"><span class="comment"># in attempt 4 the loss was 8.857370, best 8.857370</span></div><div class="line"><span class="comment"># in attempt 5 the loss was 8.943151, best 8.857370</span></div><div class="line"><span class="comment"># in attempt 6 the loss was 8.605604, best 8.605604</span></div><div class="line"><span class="comment"># ... (trunctated: continues for 1000 lines)</span></div></pre></td></tr></table></figure><p>We can take the best weights <strong>W</strong> found by this search and try it out on the test set:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Assume X_test is [3073 x 10000], Y_test [10000 x 1]</span></div><div class="line">scores = Wbest.dot(Xte_cols) <span class="comment"># 10 x 10000, the class scores for all test examples</span></div><div class="line"><span class="comment"># find the index with max score in each column (the predicted class)</span></div><div class="line">Yte_predict = np.argmax(scores, axis = <span class="number">0</span>)</div><div class="line"><span class="comment"># and calculate accuracy (fraction of predictions that are correct)</span></div><div class="line">np.mean(Yte_predict == Yte)</div><div class="line"><span class="comment"># returns 0.1555</span></div></pre></td></tr></table></figure><p>With the best <strong>W</strong> this gives an accuracy of about <strong>15.5%</strong>.</p><p><strong>Core idea: iterative refinement</strong>. Of course, it turns out that we can do much better. The core idea is that finding the best set of weights <strong>W</strong> is a very difficult or even impossible problem (especially once <strong>W</strong> contains weights for entire complex neural networks), but the problem of refining a specific set of weights <strong>W</strong> to be slightly better is significantly less difficult. In other words, our approach will be to start with a random <strong>W</strong> and then iteratively refine it, making it slightly better each time.</p><blockquote><p>Our strategy will be to start with random weights and iteratively refine them over time to get lower loss</p></blockquote><h2 id="Strategy-2-Random-Local-Search"><a href="#Strategy-2-Random-Local-Search" class="headerlink" title="Strategy #2: Random Local Search"></a>Strategy #2: Random Local Search</h2><p>Concretely, we will start out with a random WW, generate random perturbations $\delta W$ to it and if the loss at the perturbed $W + \delta W$ is lower, we will perform an update. The code for this procedure is as follows:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">W = np.random.randn(<span class="number">10</span>, <span class="number">3073</span>) * <span class="number">0.001</span> <span class="comment"># generate random starting W</span></div><div class="line">bestloss = float(<span class="string">"inf"</span>)</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1000</span>):</div><div class="line">  step_size = <span class="number">0.0001</span></div><div class="line">  Wtry = W + np.random.randn(<span class="number">10</span>, <span class="number">3073</span>) * step_size</div><div class="line">  loss = L(Xtr_cols, Ytr, Wtry)</div><div class="line">  <span class="keyword">if</span> loss &lt; bestloss:</div><div class="line">    W = Wtry</div><div class="line">    bestloss = loss</div><div class="line">  <span class="keyword">print</span> <span class="string">'iter %d loss is %f'</span> % (i, bestloss)</div></pre></td></tr></table></figure><p>This approach achieves test set classification accuracy of <strong>21.4%</strong>.</p><h2 id="Strategy-3-Following-the-Gradient"><a href="#Strategy-3-Following-the-Gradient" class="headerlink" title="Strategy #3: Following the Gradient"></a>Strategy #3: Following the Gradient</h2><p>The mathematical expression for the derivative of a 1-D function with respect its input is:</p><script type="math/tex;mode=display">\frac{df(x)}{dx} = \lim_{h\ \to 0} \frac{f(x + h) - f(x)}{h}</script><p>When the functions of interest take a vector of numbers instead of a single number, we call the derivatives <strong>partial derivatives</strong>, and the gradient is simply the vector of partial derivatives in each dimension.</p><h3 id="Computing-the-gradient"><a href="#Computing-the-gradient" class="headerlink" title="Computing the gradient"></a>Computing the gradient</h3><p>There are two ways to compute the gradient: A slow, approximate but easy way (<strong>numerical gradient</strong>), and a fast, exact but more error-prone way that requires calculus (<strong>analytic gradient</strong>). We will now present both.</p><h4 id="Computing-the-gradient-numerically-with-finite-differences"><a href="#Computing-the-gradient-numerically-with-finite-differences" class="headerlink" title="Computing the gradient numerically with finite differences"></a>Computing the gradient numerically with finite differences</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">eval_numerical_gradient</span><span class="params">(f, x)</span>:</span></div><div class="line">  <span class="string">""" </span></div><div class="line">  a naive implementation of numerical gradient of f at x </div><div class="line">  - f should be a function that takes a single argument</div><div class="line">  - x is the point (numpy array) to evaluate the gradient at</div><div class="line">  """ </div><div class="line"></div><div class="line">  fx = f(x) <span class="comment"># evaluate function value at original point</span></div><div class="line">  grad = np.zeros(x.shape)</div><div class="line">  h = <span class="number">0.00001</span></div><div class="line"></div><div class="line">  <span class="comment"># iterate over all indexes in x</span></div><div class="line">  it = np.nditer(x, flags=[<span class="string">'multi_index'</span>], op_flags=[<span class="string">'readwrite'</span>])</div><div class="line">  <span class="keyword">while</span> <span class="keyword">not</span> it.finished:</div><div class="line"></div><div class="line">    <span class="comment"># evaluate function at x+h</span></div><div class="line">    ix = it.multi_index</div><div class="line">    old_value = x[ix]</div><div class="line">    x[ix] = old_value + h <span class="comment"># increment by h</span></div><div class="line">    fxh = f(x) <span class="comment"># evalute f(x + h)</span></div><div class="line">    x[ix] = old_value <span class="comment"># restore to previous value (very important!)</span></div><div class="line"></div><div class="line">    <span class="comment"># compute the partial derivative</span></div><div class="line">    grad[ix] = (fxh - fx) / h <span class="comment"># the slope</span></div><div class="line">    it.iternext() <span class="comment"># step to next dimension</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> grad</div></pre></td></tr></table></figure><p><strong>Practical considerations</strong>.</p><p>Note that in the mathematical formulation the gradient is defined in the limit as <strong>h</strong> goes towards zero, but in practice it is often sufficient to use a very small value (such as 1e-5 as seen in the example). Ideally, you want to use the smallest step size that does not lead to numerical issues. Additionally, in practice it often works better to compute the numeric gradient using the <strong>centered difference formula</strong>:</p><script type="math/tex;mode=display">[f(x+h) - f(x-h)] / 2 h</script><p>See <a href="http://en.wikipedia.org/wiki/Numerical_differentiation" target="_blank" rel="external">wiki</a> for details.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># to use the generic code above we want a function that takes a single argument</span></div><div class="line"><span class="comment"># (the weights in our case) so we close over X_train and Y_train</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">CIFAR10_loss_fun</span><span class="params">(W)</span>:</span></div><div class="line">  <span class="keyword">return</span> L(X_train, Y_train, W)</div><div class="line"></div><div class="line">W = np.random.rand(<span class="number">10</span>, <span class="number">3073</span>) * <span class="number">0.001</span> <span class="comment"># random weight vector</span></div><div class="line">df = eval_numerical_gradient(CIFAR10_loss_fun, W) <span class="comment"># get the gradient</span></div></pre></td></tr></table></figure><p>Then we can use to make an update:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">loss_original = CIFAR10_loss_fun(W) <span class="comment"># the original loss</span></div><div class="line"><span class="keyword">print</span> <span class="string">'original loss: %f'</span> % (loss_original, )</div><div class="line"></div><div class="line"><span class="comment"># lets see the effect of multiple step sizes</span></div><div class="line"><span class="keyword">for</span> step_size_log <span class="keyword">in</span> [<span class="number">-10</span>, <span class="number">-9</span>, <span class="number">-8</span>, <span class="number">-7</span>, <span class="number">-6</span>, <span class="number">-5</span>,<span class="number">-4</span>,<span class="number">-3</span>,<span class="number">-2</span>,<span class="number">-1</span>]:</div><div class="line">  step_size = <span class="number">10</span> ** step_size_log</div><div class="line">  W_new = W - step_size * df <span class="comment"># new position in the weight space</span></div><div class="line">  loss_new = CIFAR10_loss_fun(W_new)</div><div class="line">  <span class="keyword">print</span> <span class="string">'for step size %f new loss: %f'</span> % (step_size, loss_new)</div><div class="line"></div><div class="line"><span class="comment"># prints:</span></div><div class="line"><span class="comment"># original loss: 2.200718</span></div><div class="line"><span class="comment"># for step size 1.000000e-10 new loss: 2.200652</span></div><div class="line"><span class="comment"># for step size 1.000000e-09 new loss: 2.200057</span></div><div class="line"><span class="comment"># for step size 1.000000e-08 new loss: 2.194116</span></div><div class="line"><span class="comment"># for step size 1.000000e-07 new loss: 2.135493</span></div><div class="line"><span class="comment"># for step size 1.000000e-06 new loss: 1.647802</span></div><div class="line"><span class="comment"># for step size 1.000000e-05 new loss: 2.844355</span></div><div class="line"><span class="comment"># for step size 1.000000e-04 new loss: 25.558142</span></div><div class="line"><span class="comment"># for step size 1.000000e-03 new loss: 254.086573</span></div><div class="line"><span class="comment"># for step size 1.000000e-02 new loss: 2539.370888</span></div><div class="line"><span class="comment"># for step size 1.000000e-01 new loss: 25392.214036</span></div></pre></td></tr></table></figure><p><strong>Effect of step size</strong></p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/03/stepsize.jpg" alt="margin"></p><h4 id="Computing-the-gradient-analytically-with-Calculus"><a href="#Computing-the-gradient-analytically-with-Calculus" class="headerlink" title="Computing the gradient analytically with Calculus"></a>Computing the gradient analytically with Calculus</h4><p>However, unlike the numerical gradient it can be more error prone to implement, which is why in practice it is very common to compute the analytic gradient and compare it to the numerical gradient to check the correctness of your implementation. This is called a <strong>gradient check</strong>.</p><p>Lets use the example of the SVM loss function for a single datapoint:</p><script type="math/tex;mode=display">L_i = \sum_{j\neq y_i} \left[ \max(0, w_j^Tx_i - w_{y_i}^Tx_i + \Delta) \right]</script><script type="math/tex;mode=display">\nabla_{w_{y_i}} L_i = - \left( \sum_{j\neq y_i} \mathbb{1}(w_j^Tx_i - w_{y_i}^Tx_i + \Delta > 0) \right) x_i</script><p>when you’re implementing this in code you’d simply count the number of classes that didn’t meet the desired margin (and hence contributed to the loss function) and then the data vector $x_i$ scaled by this number is the gradient.</p><script type="math/tex;mode=display">\nabla_{w_j} L_i = \mathbb{1}(w_j^Tx_i - w_{y_i}^Tx_i + \Delta > 0) x_i</script>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Loss-function&quot;&gt;&lt;a href=&quot;#Loss-function&quot; class=&quot;headerlink&quot; title=&quot;Loss function&quot;&gt;&lt;/a&gt;Loss function&lt;/h1&gt;&lt;p&gt;Source is &lt;a href=&quot;http://
    
    </summary>
    
    
      <category term="machine learning" scheme="http://yoursite.com/tags/machine-learning/"/>
    
      <category term="deep learning" scheme="http://yoursite.com/tags/deep-learning/"/>
    
  </entry>
  
  <entry>
    <title>Python data analysis Learning note Ch07</title>
    <link href="http://yoursite.com/2017/02/28/Python-data-analysis-Learning-note-Ch07/"/>
    <id>http://yoursite.com/2017/02/28/Python-data-analysis-Learning-note-Ch07/</id>
    <published>2017-02-28T14:36:30.000Z</published>
    <updated>2017-03-05T08:52:54.460Z</updated>
    
    <content type="html"><![CDATA[<h2 id="数据规整化：清理、转换、合并、重塑"><a href="#数据规整化：清理、转换、合并、重塑" class="headerlink" title="数据规整化：清理、转换、合并、重塑"></a>数据规整化：清理、转换、合并、重塑</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">np.random.seed(<span class="number">12345</span>)</div><div class="line">plt.rc(<span class="string">'figure'</span>, figsize=(<span class="number">10</span>, <span class="number">6</span>))</div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="keyword">import</span> pandas</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">np.set_printoptions(precision=<span class="number">4</span>, threshold=<span class="number">500</span>)</div><div class="line">pd.options.display.max_rows = <span class="number">100</span></div><div class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</div><div class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">%matplotlib inline</div></pre></td></tr></table></figure><h2 id="合并数据集"><a href="#合并数据集" class="headerlink" title="合并数据集"></a>合并数据集</h2><h3 id="数据库风格的DataFrame合并"><a href="#数据库风格的DataFrame合并" class="headerlink" title="数据库风格的DataFrame合并"></a>数据库风格的DataFrame合并</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(&#123;<span class="string">'key'</span>: [<span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>],</div><div class="line">                 <span class="string">'data1'</span>: range(<span class="number">7</span>)&#125;)</div><div class="line">df2 = DataFrame(&#123;<span class="string">'key'</span>: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'d'</span>],</div><div class="line">                 <span class="string">'data2'</span>: range(<span class="number">3</span>)&#125;)</div><div class="line">df1</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td></tr><tr><th>1</th><td>1</td><td>b</td></tr><tr><th>2</th><td>2</td><td>a</td></tr><tr><th>3</th><td>3</td><td>c</td></tr><tr><th>4</th><td>4</td><td>a</td></tr><tr><th>5</th><td>5</td><td>a</td></tr><tr><th>6</th><td>6</td><td>b</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data2</th><th>key</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>a</td></tr><tr><th>1</th><td>1</td><td>b</td></tr><tr><th>2</th><td>2</td><td>d</td></tr></tbody></table></div><p>默认情况下根据重叠的列名进行合并</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df1, df2)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key</th><th>data2</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td><td>1</td></tr><tr><th>1</th><td>1</td><td>b</td><td>1</td></tr><tr><th>2</th><td>6</td><td>b</td><td>1</td></tr><tr><th>3</th><td>2</td><td>a</td><td>0</td></tr><tr><th>4</th><td>4</td><td>a</td><td>0</td></tr><tr><th>5</th><td>5</td><td>a</td><td>0</td></tr></tbody></table></div><p>最好进行显式地指定</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df1, df2, on=<span class="string">'key'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key</th><th>data2</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td><td>1</td></tr><tr><th>1</th><td>1</td><td>b</td><td>1</td></tr><tr><th>2</th><td>6</td><td>b</td><td>1</td></tr><tr><th>3</th><td>2</td><td>a</td><td>0</td></tr><tr><th>4</th><td>4</td><td>a</td><td>0</td></tr><tr><th>5</th><td>5</td><td>a</td><td>0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">df3 = DataFrame(&#123;<span class="string">'lkey'</span>: [<span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>],</div><div class="line">                 <span class="string">'data1'</span>: range(<span class="number">7</span>)&#125;)</div><div class="line">df4 = DataFrame(&#123;<span class="string">'rkey'</span>: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'d'</span>],</div><div class="line">                 <span class="string">'data2'</span>: range(<span class="number">3</span>)&#125;)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df3</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>lkey</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td></tr><tr><th>1</th><td>1</td><td>b</td></tr><tr><th>2</th><td>2</td><td>a</td></tr><tr><th>3</th><td>3</td><td>c</td></tr><tr><th>4</th><td>4</td><td>a</td></tr><tr><th>5</th><td>5</td><td>a</td></tr><tr><th>6</th><td>6</td><td>b</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df4</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data2</th><th>rkey</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>a</td></tr><tr><th>1</th><td>1</td><td>b</td></tr><tr><th>2</th><td>2</td><td>d</td></tr></tbody></table></div><p>如果两个对象的列名不同，那么就需要分别指定</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df3, df4, left_on=<span class="string">'lkey'</span>, right_on=<span class="string">'rkey'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>lkey</th><th>data2</th><th>rkey</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td><td>1</td><td>b</td></tr><tr><th>1</th><td>1</td><td>b</td><td>1</td><td>b</td></tr><tr><th>2</th><td>6</td><td>b</td><td>1</td><td>b</td></tr><tr><th>3</th><td>2</td><td>a</td><td>0</td><td>a</td></tr><tr><th>4</th><td>4</td><td>a</td><td>0</td><td>a</td></tr><tr><th>5</th><td>5</td><td>a</td><td>0</td><td>a</td></tr></tbody></table></div><p>默认是进行inner连接（交集）， outer是求取并集</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df1, df2, how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key</th><th>data2</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>b</td><td>1.0</td></tr><tr><th>1</th><td>1.0</td><td>b</td><td>1.0</td></tr><tr><th>2</th><td>6.0</td><td>b</td><td>1.0</td></tr><tr><th>3</th><td>2.0</td><td>a</td><td>0.0</td></tr><tr><th>4</th><td>4.0</td><td>a</td><td>0.0</td></tr><tr><th>5</th><td>5.0</td><td>a</td><td>0.0</td></tr><tr><th>6</th><td>3.0</td><td>c</td><td>NaN</td></tr><tr><th>7</th><td>NaN</td><td>d</td><td>2.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(&#123;<span class="string">'key'</span>: [<span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>],</div><div class="line">                 <span class="string">'data1'</span>: range(<span class="number">6</span>)&#125;)</div><div class="line">df2 = DataFrame(&#123;<span class="string">'key'</span>: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'d'</span>],</div><div class="line">                 <span class="string">'data2'</span>: range(<span class="number">5</span>)&#125;)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df1</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td></tr><tr><th>1</th><td>1</td><td>b</td></tr><tr><th>2</th><td>2</td><td>a</td></tr><tr><th>3</th><td>3</td><td>c</td></tr><tr><th>4</th><td>4</td><td>a</td></tr><tr><th>5</th><td>5</td><td>b</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data2</th><th>key</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>a</td></tr><tr><th>1</th><td>1</td><td>b</td></tr><tr><th>2</th><td>2</td><td>a</td></tr><tr><th>3</th><td>3</td><td>b</td></tr><tr><th>4</th><td>4</td><td>d</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df1, df2, on=<span class="string">'key'</span>, how=<span class="string">'left'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key</th><th>data2</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td><td>1.0</td></tr><tr><th>1</th><td>0</td><td>b</td><td>3.0</td></tr><tr><th>2</th><td>1</td><td>b</td><td>1.0</td></tr><tr><th>3</th><td>1</td><td>b</td><td>3.0</td></tr><tr><th>4</th><td>2</td><td>a</td><td>0.0</td></tr><tr><th>5</th><td>2</td><td>a</td><td>2.0</td></tr><tr><th>6</th><td>3</td><td>c</td><td>NaN</td></tr><tr><th>7</th><td>4</td><td>a</td><td>0.0</td></tr><tr><th>8</th><td>4</td><td>a</td><td>2.0</td></tr><tr><th>9</th><td>5</td><td>b</td><td>1.0</td></tr><tr><th>10</th><td>5</td><td>b</td><td>3.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df1, df2, how=<span class="string">'inner'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key</th><th>data2</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td><td>1</td></tr><tr><th>1</th><td>0</td><td>b</td><td>3</td></tr><tr><th>2</th><td>1</td><td>b</td><td>1</td></tr><tr><th>3</th><td>1</td><td>b</td><td>3</td></tr><tr><th>4</th><td>5</td><td>b</td><td>1</td></tr><tr><th>5</th><td>5</td><td>b</td><td>3</td></tr><tr><th>6</th><td>2</td><td>a</td><td>0</td></tr><tr><th>7</th><td>2</td><td>a</td><td>2</td></tr><tr><th>8</th><td>4</td><td>a</td><td>0</td></tr><tr><th>9</th><td>4</td><td>a</td><td>2</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">left = DataFrame(&#123;<span class="string">'key1'</span>: [<span class="string">'foo'</span>, <span class="string">'foo'</span>, <span class="string">'bar'</span>],</div><div class="line">                  <span class="string">'key2'</span>: [<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'one'</span>],</div><div class="line">                  <span class="string">'lval'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;)</div><div class="line">right = DataFrame(&#123;<span class="string">'key1'</span>: [<span class="string">'foo'</span>, <span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'bar'</span>],</div><div class="line">                   <span class="string">'key2'</span>: [<span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>],</div><div class="line">                   <span class="string">'rval'</span>: [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]&#125;)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">left</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key1</th><th>key2</th><th>lval</th></tr></thead><tbody><tr><th>0</th><td>foo</td><td>one</td><td>1</td></tr><tr><th>1</th><td>foo</td><td>two</td><td>2</td></tr><tr><th>2</th><td>bar</td><td>one</td><td>3</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">right</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key1</th><th>key2</th><th>rval</th></tr></thead><tbody><tr><th>0</th><td>foo</td><td>one</td><td>4</td></tr><tr><th>1</th><td>foo</td><td>one</td><td>5</td></tr><tr><th>2</th><td>bar</td><td>one</td><td>6</td></tr><tr><th>3</th><td>bar</td><td>two</td><td>7</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(left, right, on=[<span class="string">'key1'</span>, <span class="string">'key2'</span>], how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key1</th><th>key2</th><th>lval</th><th>rval</th></tr></thead><tbody><tr><th>0</th><td>foo</td><td>one</td><td>1.0</td><td>4.0</td></tr><tr><th>1</th><td>foo</td><td>one</td><td>1.0</td><td>5.0</td></tr><tr><th>2</th><td>foo</td><td>two</td><td>2.0</td><td>NaN</td></tr><tr><th>3</th><td>bar</td><td>one</td><td>3.0</td><td>6.0</td></tr><tr><th>4</th><td>bar</td><td>two</td><td>NaN</td><td>7.0</td></tr></tbody></table></div><p>列名重复问题</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(left, right, on=<span class="string">'key1'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key1</th><th>key2_x</th><th>lval</th><th>key2_y</th><th>rval</th></tr></thead><tbody><tr><th>0</th><td>foo</td><td>one</td><td>1</td><td>one</td><td>4</td></tr><tr><th>1</th><td>foo</td><td>one</td><td>1</td><td>one</td><td>5</td></tr><tr><th>2</th><td>foo</td><td>two</td><td>2</td><td>one</td><td>4</td></tr><tr><th>3</th><td>foo</td><td>two</td><td>2</td><td>one</td><td>5</td></tr><tr><th>4</th><td>bar</td><td>one</td><td>3</td><td>one</td><td>6</td></tr><tr><th>5</th><td>bar</td><td>one</td><td>3</td><td>two</td><td>7</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(left, right, on=<span class="string">'key1'</span>, suffixes=(<span class="string">'_left'</span>, <span class="string">'_right'</span>))</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key1</th><th>key2_left</th><th>lval</th><th>key2_right</th><th>rval</th></tr></thead><tbody><tr><th>0</th><td>foo</td><td>one</td><td>1</td><td>one</td><td>4</td></tr><tr><th>1</th><td>foo</td><td>one</td><td>1</td><td>one</td><td>5</td></tr><tr><th>2</th><td>foo</td><td>two</td><td>2</td><td>one</td><td>4</td></tr><tr><th>3</th><td>foo</td><td>two</td><td>2</td><td>one</td><td>5</td></tr><tr><th>4</th><td>bar</td><td>one</td><td>3</td><td>one</td><td>6</td></tr><tr><th>5</th><td>bar</td><td>one</td><td>3</td><td>two</td><td>7</td></tr></tbody></table></div><h3 id="索引上的合并"><a href="#索引上的合并" class="headerlink" title="索引上的合并"></a>索引上的合并</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">left1 = DataFrame(&#123;<span class="string">'key'</span>: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>],</div><div class="line">                  <span class="string">'value'</span>: range(<span class="number">6</span>)&#125;)</div><div class="line">right1 = DataFrame(&#123;<span class="string">'group_val'</span>: [<span class="number">3.5</span>, <span class="number">7</span>]&#125;, index=[<span class="string">'a'</span>, <span class="string">'b'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">left1</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key</th><th>value</th></tr></thead><tbody><tr><th>0</th><td>a</td><td>0</td></tr><tr><th>1</th><td>b</td><td>1</td></tr><tr><th>2</th><td>a</td><td>2</td></tr><tr><th>3</th><td>a</td><td>3</td></tr><tr><th>4</th><td>b</td><td>4</td></tr><tr><th>5</th><td>c</td><td>5</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">right1</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>group_val</th></tr></thead><tbody><tr><th>a</th><td>3.5</td></tr><tr><th>b</th><td>7.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(left1, right1, left_on=<span class="string">'key'</span>, right_index=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key</th><th>value</th><th>group_val</th></tr></thead><tbody><tr><th>0</th><td>a</td><td>0</td><td>3.5</td></tr><tr><th>2</th><td>a</td><td>2</td><td>3.5</td></tr><tr><th>3</th><td>a</td><td>3</td><td>3.5</td></tr><tr><th>1</th><td>b</td><td>1</td><td>7.0</td></tr><tr><th>4</th><td>b</td><td>4</td><td>7.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(left1, right1, left_on=<span class="string">'key'</span>, right_index=<span class="keyword">True</span>, how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key</th><th>value</th><th>group_val</th></tr></thead><tbody><tr><th>0</th><td>a</td><td>0</td><td>3.5</td></tr><tr><th>2</th><td>a</td><td>2</td><td>3.5</td></tr><tr><th>3</th><td>a</td><td>3</td><td>3.5</td></tr><tr><th>1</th><td>b</td><td>1</td><td>7.0</td></tr><tr><th>4</th><td>b</td><td>4</td><td>7.0</td></tr><tr><th>5</th><td>c</td><td>5</td><td>NaN</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">lefth = DataFrame(&#123;<span class="string">'key1'</span>: [<span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Nevada'</span>, <span class="string">'Nevada'</span>],</div><div class="line">                   <span class="string">'key2'</span>: [<span class="number">2000</span>, <span class="number">2001</span>, <span class="number">2002</span>, <span class="number">2001</span>, <span class="number">2002</span>],</div><div class="line">                   <span class="string">'data'</span>: np.arange(<span class="number">5.</span>)&#125;)</div><div class="line">righth = DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">6</span>, <span class="number">2</span>)),</div><div class="line">                   index=[[<span class="string">'Nevada'</span>, <span class="string">'Nevada'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>],</div><div class="line">                          [<span class="number">2001</span>, <span class="number">2000</span>, <span class="number">2000</span>, <span class="number">2000</span>, <span class="number">2001</span>, <span class="number">2002</span>]],</div><div class="line">                   columns=[<span class="string">'event1'</span>, <span class="string">'event2'</span>])</div><div class="line">lefth</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data</th><th>key1</th><th>key2</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>Ohio</td><td>2000</td></tr><tr><th>1</th><td>1.0</td><td>Ohio</td><td>2001</td></tr><tr><th>2</th><td>2.0</td><td>Ohio</td><td>2002</td></tr><tr><th>3</th><td>3.0</td><td>Nevada</td><td>2001</td></tr><tr><th>4</th><td>4.0</td><td>Nevada</td><td>2002</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">righth</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th></th><th>event1</th><th>event2</th></tr></thead><tbody><tr><th rowspan="2" valign="top">Nevada</th><th>2001</th><td>0</td><td>1</td></tr><tr><th>2000</th><td>2</td><td>3</td></tr><tr><th rowspan="4" valign="top">Ohio</th><th>2000</th><td>4</td><td>5</td></tr><tr><th>2000</th><td>6</td><td>7</td></tr><tr><th>2001</th><td>8</td><td>9</td></tr><tr><th>2002</th><td>10</td><td>11</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(lefth, righth, left_on=[<span class="string">'key1'</span>, <span class="string">'key2'</span>], right_index=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data</th><th>key1</th><th>key2</th><th>event1</th><th>event2</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>Ohio</td><td>2000</td><td>4</td><td>5</td></tr><tr><th>0</th><td>0.0</td><td>Ohio</td><td>2000</td><td>6</td><td>7</td></tr><tr><th>1</th><td>1.0</td><td>Ohio</td><td>2001</td><td>8</td><td>9</td></tr><tr><th>2</th><td>2.0</td><td>Ohio</td><td>2002</td><td>10</td><td>11</td></tr><tr><th>3</th><td>3.0</td><td>Nevada</td><td>2001</td><td>0</td><td>1</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pd.merge(lefth, righth, left_on=[<span class="string">'key1'</span>, <span class="string">'key2'</span>],</div><div class="line">         right_index=<span class="keyword">True</span>, how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data</th><th>key1</th><th>key2</th><th>event1</th><th>event2</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>Ohio</td><td>2000.0</td><td>4.0</td><td>5.0</td></tr><tr><th>0</th><td>0.0</td><td>Ohio</td><td>2000.0</td><td>6.0</td><td>7.0</td></tr><tr><th>1</th><td>1.0</td><td>Ohio</td><td>2001.0</td><td>8.0</td><td>9.0</td></tr><tr><th>2</th><td>2.0</td><td>Ohio</td><td>2002.0</td><td>10.0</td><td>11.0</td></tr><tr><th>3</th><td>3.0</td><td>Nevada</td><td>2001.0</td><td>0.0</td><td>1.0</td></tr><tr><th>4</th><td>4.0</td><td>Nevada</td><td>2002.0</td><td>NaN</td><td>NaN</td></tr><tr><th>4</th><td>NaN</td><td>Nevada</td><td>2000.0</td><td>2.0</td><td>3.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">left2 = DataFrame([[<span class="number">1.</span>, <span class="number">2.</span>], [<span class="number">3.</span>, <span class="number">4.</span>], [<span class="number">5.</span>, <span class="number">6.</span>]], index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>],</div><div class="line">                 columns=[<span class="string">'Ohio'</span>, <span class="string">'Nevada'</span>])</div><div class="line">right2 = DataFrame([[<span class="number">7.</span>, <span class="number">8.</span>], [<span class="number">9.</span>, <span class="number">10.</span>], [<span class="number">11.</span>, <span class="number">12.</span>], [<span class="number">13</span>, <span class="number">14</span>]],</div><div class="line">                   index=[<span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>], columns=[<span class="string">'Missouri'</span>, <span class="string">'Alabama'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">left2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Ohio</th><th>Nevada</th></tr></thead><tbody><tr><th>a</th><td>1.0</td><td>2.0</td></tr><tr><th>c</th><td>3.0</td><td>4.0</td></tr><tr><th>e</th><td>5.0</td><td>6.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">right2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Missouri</th><th>Alabama</th></tr></thead><tbody><tr><th>b</th><td>7.0</td><td>8.0</td></tr><tr><th>c</th><td>9.0</td><td>10.0</td></tr><tr><th>d</th><td>11.0</td><td>12.0</td></tr><tr><th>e</th><td>13.0</td><td>14.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(left2, right2, how=<span class="string">'outer'</span>, left_index=<span class="keyword">True</span>, right_index=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Ohio</th><th>Nevada</th><th>Missouri</th><th>Alabama</th></tr></thead><tbody><tr><th>a</th><td>1.0</td><td>2.0</td><td>NaN</td><td>NaN</td></tr><tr><th>b</th><td>NaN</td><td>NaN</td><td>7.0</td><td>8.0</td></tr><tr><th>c</th><td>3.0</td><td>4.0</td><td>9.0</td><td>10.0</td></tr><tr><th>d</th><td>NaN</td><td>NaN</td><td>11.0</td><td>12.0</td></tr><tr><th>e</th><td>5.0</td><td>6.0</td><td>13.0</td><td>14.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">left2.join(right2, how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Ohio</th><th>Nevada</th><th>Missouri</th><th>Alabama</th></tr></thead><tbody><tr><th>a</th><td>1.0</td><td>2.0</td><td>NaN</td><td>NaN</td></tr><tr><th>b</th><td>NaN</td><td>NaN</td><td>7.0</td><td>8.0</td></tr><tr><th>c</th><td>3.0</td><td>4.0</td><td>9.0</td><td>10.0</td></tr><tr><th>d</th><td>NaN</td><td>NaN</td><td>11.0</td><td>12.0</td></tr><tr><th>e</th><td>5.0</td><td>6.0</td><td>13.0</td><td>14.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">left1.join(right1, on=<span class="string">'key'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key</th><th>value</th><th>group_val</th></tr></thead><tbody><tr><th>0</th><td>a</td><td>0</td><td>3.5</td></tr><tr><th>1</th><td>b</td><td>1</td><td>7.0</td></tr><tr><th>2</th><td>a</td><td>2</td><td>3.5</td></tr><tr><th>3</th><td>a</td><td>3</td><td>3.5</td></tr><tr><th>4</th><td>b</td><td>4</td><td>7.0</td></tr><tr><th>5</th><td>c</td><td>5</td><td>NaN</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">another = DataFrame([[<span class="number">7.</span>, <span class="number">8.</span>], [<span class="number">9.</span>, <span class="number">10.</span>], [<span class="number">11.</span>, <span class="number">12.</span>], [<span class="number">16.</span>, <span class="number">17.</span>]],</div><div class="line">                    index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>], columns=[<span class="string">'New York'</span>, <span class="string">'Oregon'</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>New York</th><th>Oregon</th></tr></thead><tbody><tr><th>a</th><td>7.0</td><td>8.0</td></tr><tr><th>c</th><td>9.0</td><td>10.0</td></tr><tr><th>e</th><td>11.0</td><td>12.0</td></tr><tr><th>f</th><td>16.0</td><td>17.0</td></tr></tbody></table></div><p>相当于三个表进行合并</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">left2</div><div class="line">right2</div><div class="line">another</div><div class="line">left2.join([right2, another])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Ohio</th><th>Nevada</th></tr></thead><tbody><tr><th>a</th><td>1.0</td><td>2.0</td></tr><tr><th>c</th><td>3.0</td><td>4.0</td></tr><tr><th>e</th><td>5.0</td><td>6.0</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Missouri</th><th>Alabama</th></tr></thead><tbody><tr><th>b</th><td>7.0</td><td>8.0</td></tr><tr><th>c</th><td>9.0</td><td>10.0</td></tr><tr><th>d</th><td>11.0</td><td>12.0</td></tr><tr><th>e</th><td>13.0</td><td>14.0</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>New York</th><th>Oregon</th></tr></thead><tbody><tr><th>a</th><td>7.0</td><td>8.0</td></tr><tr><th>c</th><td>9.0</td><td>10.0</td></tr><tr><th>e</th><td>11.0</td><td>12.0</td></tr><tr><th>f</th><td>16.0</td><td>17.0</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Ohio</th><th>Nevada</th><th>Missouri</th><th>Alabama</th><th>New York</th><th>Oregon</th></tr></thead><tbody><tr><th>a</th><td>1.0</td><td>2.0</td><td>NaN</td><td>NaN</td><td>7.0</td><td>8.0</td></tr><tr><th>c</th><td>3.0</td><td>4.0</td><td>9.0</td><td>10.0</td><td>9.0</td><td>10.0</td></tr><tr><th>e</th><td>5.0</td><td>6.0</td><td>13.0</td><td>14.0</td><td>11.0</td><td>12.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">left2.join([right2, another], how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure><h3 id="轴向连接"><a href="#轴向连接" class="headerlink" title="轴向连接"></a>轴向连接</h3><p>之前指的都是行级别的连接操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>, <span class="number">4</span>))</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.concatenate([arr, arr], axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><pre><code>array([[ 0,  1,  2,  3,  0,  1,  2,  3],
       [ 4,  5,  6,  7,  4,  5,  6,  7],
       [ 8,  9, 10, 11,  8,  9, 10, 11]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">s1 = Series([<span class="number">0</span>, <span class="number">1</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>])</div><div class="line">s2 = Series([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], index=[<span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">s3 = Series([<span class="number">5</span>, <span class="number">6</span>], index=[<span class="string">'f'</span>, <span class="string">'g'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.concat([s1, s2, s3])</div></pre></td></tr></table></figure><pre><code>a    0
b    1
c    2
d    3
e    4
f    5
g    6
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.concat([s1, s2, s3], axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>a</th><td>0.0</td><td>NaN</td><td>NaN</td></tr><tr><th>b</th><td>1.0</td><td>NaN</td><td>NaN</td></tr><tr><th>c</th><td>NaN</td><td>2.0</td><td>NaN</td></tr><tr><th>d</th><td>NaN</td><td>3.0</td><td>NaN</td></tr><tr><th>e</th><td>NaN</td><td>4.0</td><td>NaN</td></tr><tr><th>f</th><td>NaN</td><td>NaN</td><td>5.0</td></tr><tr><th>g</th><td>NaN</td><td>NaN</td><td>6.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">s4 = pd.concat([s1 * <span class="number">5</span>, s3])</div><div class="line">s4</div></pre></td></tr></table></figure><pre><code>a    0
b    5
f    5
g    6
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.concat([s1, s4], axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th></tr></thead><tbody><tr><th>a</th><td>0.0</td><td>0</td></tr><tr><th>b</th><td>1.0</td><td>5</td></tr><tr><th>f</th><td>NaN</td><td>5</td></tr><tr><th>g</th><td>NaN</td><td>6</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.concat([s1, s4], axis=<span class="number">1</span>, join=<span class="string">'inner'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th></tr></thead><tbody><tr><th>a</th><td>0</td><td>0</td></tr><tr><th>b</th><td>1</td><td>5</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.concat([s1, s4], axis=<span class="number">1</span>, join_axes=[[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'e'</span>]])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th></tr></thead><tbody><tr><th>a</th><td>0.0</td><td>0.0</td></tr><tr><th>c</th><td>NaN</td><td>NaN</td></tr><tr><th>b</th><td>1.0</td><td>5.0</td></tr><tr><th>e</th><td>NaN</td><td>NaN</td></tr></tbody></table></div><p>在连接轴上建立一个层次化索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">s1</div><div class="line">s3</div><div class="line">result = pd.concat([s1, s1, s3], keys=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>])</div></pre></td></tr></table></figure><pre><code>a    0
b    1
dtype: int64






f    5
g    6
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">result</div></pre></td></tr></table></figure><pre><code>one    a    0
       b    1
two    a    0
       b    1
three  f    5
       g    6
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Much more on the unstack function later</span></div><div class="line">result.unstack()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>f</th><th>g</th></tr></thead><tbody><tr><th>one</th><td>0.0</td><td>1.0</td><td>NaN</td><td>NaN</td></tr><tr><th>two</th><td>0.0</td><td>1.0</td><td>NaN</td><td>NaN</td></tr><tr><th>three</th><td>NaN</td><td>NaN</td><td>5.0</td><td>6.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.concat([s1, s2, s3], axis=<span class="number">1</span>, keys=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th></tr></thead><tbody><tr><th>a</th><td>0.0</td><td>NaN</td><td>NaN</td></tr><tr><th>b</th><td>1.0</td><td>NaN</td><td>NaN</td></tr><tr><th>c</th><td>NaN</td><td>2.0</td><td>NaN</td></tr><tr><th>d</th><td>NaN</td><td>3.0</td><td>NaN</td></tr><tr><th>e</th><td>NaN</td><td>4.0</td><td>NaN</td></tr><tr><th>f</th><td>NaN</td><td>NaN</td><td>5.0</td></tr><tr><th>g</th><td>NaN</td><td>NaN</td><td>6.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(np.arange(<span class="number">6</span>).reshape(<span class="number">3</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>],</div><div class="line">                columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</div><div class="line">df2 = DataFrame(<span class="number">5</span> + np.arange(<span class="number">4</span>).reshape(<span class="number">2</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>, <span class="string">'c'</span>],</div><div class="line">                columns=[<span class="string">'three'</span>, <span class="string">'four'</span>])</div><div class="line">df1</div><div class="line">df2</div><div class="line">pd.concat([df1, df2], keys=[<span class="string">'level1'</span>, <span class="string">'level2'</span>])</div><div class="line">pd.concat([df1, df2], axis=<span class="number">1</span>, keys=[<span class="string">'level1'</span>, <span class="string">'level2'</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th></tr></thead><tbody><tr><th>a</th><td>0</td><td>1</td></tr><tr><th>b</th><td>2</td><td>3</td></tr><tr><th>c</th><td>4</td><td>5</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>three</th><th>four</th></tr></thead><tbody><tr><th>a</th><td>5</td><td>6</td></tr><tr><th>c</th><td>7</td><td>8</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th></th><th>four</th><th>one</th><th>three</th><th>two</th></tr></thead><tbody><tr><th rowspan="3" valign="top">level1</th><th>a</th><td>NaN</td><td>0.0</td><td>NaN</td><td>1.0</td></tr><tr><th>b</th><td>NaN</td><td>2.0</td><td>NaN</td><td>3.0</td></tr><tr><th>c</th><td>NaN</td><td>4.0</td><td>NaN</td><td>5.0</td></tr><tr><th rowspan="2" valign="top">level2</th><th>a</th><td>6.0</td><td>NaN</td><td>5.0</td><td>NaN</td></tr><tr><th>c</th><td>8.0</td><td>NaN</td><td>7.0</td><td>NaN</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr><th></th><th colspan="2" halign="left">level1</th><th colspan="2" halign="left">level2</th></tr><tr><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>a</th><td>0</td><td>1</td><td>5.0</td><td>6.0</td></tr><tr><th>b</th><td>2</td><td>3</td><td>NaN</td><td>NaN</td></tr><tr><th>c</th><td>4</td><td>5</td><td>7.0</td><td>8.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pd.concat(&#123;<span class="string">'level1'</span>: df1, <span class="string">'level2'</span>: df2&#125;, axis=<span class="number">0</span>)</div><div class="line">pd.concat(&#123;<span class="string">'level1'</span>: df1, <span class="string">'level2'</span>: df2&#125;, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th></th><th>four</th><th>one</th><th>three</th><th>two</th></tr></thead><tbody><tr><th rowspan="3" valign="top">level1</th><th>a</th><td>NaN</td><td>0.0</td><td>NaN</td><td>1.0</td></tr><tr><th>b</th><td>NaN</td><td>2.0</td><td>NaN</td><td>3.0</td></tr><tr><th>c</th><td>NaN</td><td>4.0</td><td>NaN</td><td>5.0</td></tr><tr><th rowspan="2" valign="top">level2</th><th>a</th><td>6.0</td><td>NaN</td><td>5.0</td><td>NaN</td></tr><tr><th>c</th><td>8.0</td><td>NaN</td><td>7.0</td><td>NaN</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr><th></th><th colspan="2" halign="left">level1</th><th colspan="2" halign="left">level2</th></tr><tr><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>a</th><td>0</td><td>1</td><td>5.0</td><td>6.0</td></tr><tr><th>b</th><td>2</td><td>3</td><td>NaN</td><td>NaN</td></tr><tr><th>c</th><td>4</td><td>5</td><td>7.0</td><td>8.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pd.concat([df1, df2], axis=<span class="number">1</span>, keys=[<span class="string">'level1'</span>, <span class="string">'level2'</span>],</div><div class="line">          names=[<span class="string">'upper'</span>, <span class="string">'lower'</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr><th>upper</th><th colspan="2" halign="left">level1</th><th colspan="2" halign="left">level2</th></tr><tr><th>lower</th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>a</th><td>0</td><td>1</td><td>5.0</td><td>6.0</td></tr><tr><th>b</th><td>2</td><td>3</td><td>NaN</td><td>NaN</td></tr><tr><th>c</th><td>4</td><td>5</td><td>7.0</td><td>8.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(np.random.randn(<span class="number">3</span>, <span class="number">4</span>), columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">df2 = DataFrame(np.random.randn(<span class="number">2</span>, <span class="number">3</span>), columns=[<span class="string">'b'</span>, <span class="string">'d'</span>, <span class="string">'a'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df1</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th></tr></thead><tbody><tr><th>0</th><td>-0.204708</td><td>0.478943</td><td>-0.519439</td><td>-0.555730</td></tr><tr><th>1</th><td>1.965781</td><td>1.393406</td><td>0.092908</td><td>0.281746</td></tr><tr><th>2</th><td>0.769023</td><td>1.246435</td><td>1.007189</td><td>-1.296221</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>b</th><th>d</th><th>a</th></tr></thead><tbody><tr><th>0</th><td>0.274992</td><td>0.228913</td><td>1.352917</td></tr><tr><th>1</th><td>0.886429</td><td>-2.001637</td><td>-0.371843</td></tr></tbody></table></div><p>去除无关的行索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pd.concat([df1, df2], ignore_index=<span class="keyword">False</span>)</div><div class="line">pd.concat([df1, df2], ignore_index=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th></tr></thead><tbody><tr><th>0</th><td>-0.204708</td><td>0.478943</td><td>-0.519439</td><td>-0.555730</td></tr><tr><th>1</th><td>1.965781</td><td>1.393406</td><td>0.092908</td><td>0.281746</td></tr><tr><th>2</th><td>0.769023</td><td>1.246435</td><td>1.007189</td><td>-1.296221</td></tr><tr><th>0</th><td>1.352917</td><td>0.274992</td><td>NaN</td><td>0.228913</td></tr><tr><th>1</th><td>-0.371843</td><td>0.886429</td><td>NaN</td><td>-2.001637</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th></tr></thead><tbody><tr><th>0</th><td>-0.204708</td><td>0.478943</td><td>-0.519439</td><td>-0.555730</td></tr><tr><th>1</th><td>1.965781</td><td>1.393406</td><td>0.092908</td><td>0.281746</td></tr><tr><th>2</th><td>0.769023</td><td>1.246435</td><td>1.007189</td><td>-1.296221</td></tr><tr><th>3</th><td>1.352917</td><td>0.274992</td><td>NaN</td><td>0.228913</td></tr><tr><th>4</th><td>-0.371843</td><td>0.886429</td><td>NaN</td><td>-2.001637</td></tr></tbody></table></div><h3 id="合并重叠数据"><a href="#合并重叠数据" class="headerlink" title="合并重叠数据"></a>合并重叠数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">a = Series([np.nan, <span class="number">2.5</span>, np.nan, <span class="number">3.5</span>, <span class="number">4.5</span>, np.nan],</div><div class="line">           index=[<span class="string">'f'</span>, <span class="string">'e'</span>, <span class="string">'d'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>])</div><div class="line">b = Series(np.arange(len(a), dtype=np.float64),</div><div class="line">           index=[<span class="string">'f'</span>, <span class="string">'e'</span>, <span class="string">'d'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>])</div><div class="line">b[<span class="number">-1</span>] = np.nan</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a</div></pre></td></tr></table></figure><pre><code>f    NaN
e    2.5
d    NaN
c    3.5
b    4.5
a    NaN
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">b</div></pre></td></tr></table></figure><pre><code>f    0.0
e    1.0
d    2.0
c    3.0
b    4.0
a    NaN
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.where(pd.isnull(a), b, a)</div></pre></td></tr></table></figure><pre><code>array([ 0. ,  2.5,  2. ,  3.5,  4.5,  nan])
</code></pre><p>combine_first, 重叠值合并，且进行数据对其</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">b[:<span class="number">-2</span>].combine_first(a[<span class="number">2</span>:])</div></pre></td></tr></table></figure><pre><code>a    NaN
b    4.5
c    3.0
d    2.0
e    1.0
f    0.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(&#123;<span class="string">'a'</span>: [<span class="number">1.</span>, np.nan, <span class="number">5.</span>, np.nan],</div><div class="line">                 <span class="string">'b'</span>: [np.nan, <span class="number">2.</span>, np.nan, <span class="number">6.</span>],</div><div class="line">                 <span class="string">'c'</span>: range(<span class="number">2</span>, <span class="number">18</span>, <span class="number">4</span>)&#125;)</div><div class="line">df2 = DataFrame(&#123;<span class="string">'a'</span>: [<span class="number">5.</span>, <span class="number">4.</span>, np.nan, <span class="number">3.</span>, <span class="number">7.</span>],</div><div class="line">                 <span class="string">'b'</span>: [np.nan, <span class="number">3.</span>, <span class="number">4.</span>, <span class="number">6.</span>, <span class="number">8.</span>]&#125;)</div><div class="line">df1</div><div class="line">df2</div><div class="line">df1.combine_first(df2)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th></tr></thead><tbody><tr><th>0</th><td>1.0</td><td>NaN</td><td>2</td></tr><tr><th>1</th><td>NaN</td><td>2.0</td><td>6</td></tr><tr><th>2</th><td>5.0</td><td>NaN</td><td>10</td></tr><tr><th>3</th><td>NaN</td><td>6.0</td><td>14</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th></tr></thead><tbody><tr><th>0</th><td>5.0</td><td>NaN</td></tr><tr><th>1</th><td>4.0</td><td>3.0</td></tr><tr><th>2</th><td>NaN</td><td>4.0</td></tr><tr><th>3</th><td>3.0</td><td>6.0</td></tr><tr><th>4</th><td>7.0</td><td>8.0</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th></tr></thead><tbody><tr><th>0</th><td>1.0</td><td>NaN</td><td>2.0</td></tr><tr><th>1</th><td>4.0</td><td>2.0</td><td>6.0</td></tr><tr><th>2</th><td>5.0</td><td>4.0</td><td>10.0</td></tr><tr><th>3</th><td>3.0</td><td>6.0</td><td>14.0</td></tr><tr><th>4</th><td>7.0</td><td>8.0</td><td>NaN</td></tr></tbody></table></div><h2 id="重塑和轴向旋转"><a href="#重塑和轴向旋转" class="headerlink" title="重塑和轴向旋转"></a>重塑和轴向旋转</h2><h3 id="重塑层次化索引"><a href="#重塑层次化索引" class="headerlink" title="重塑层次化索引"></a>重塑层次化索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(np.arange(<span class="number">6</span>).reshape((<span class="number">2</span>, <span class="number">3</span>)),</div><div class="line">                 index=pd.Index([<span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>], name=<span class="string">'state'</span>),</div><div class="line">                 columns=pd.Index([<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>], name=<span class="string">'number'</span>))</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>number</th><th>one</th><th>two</th><th>three</th></tr><tr><th>state</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>Ohio</th><td>0</td><td>1</td><td>2</td></tr><tr><th>Colorado</th><td>3</td><td>4</td><td>5</td></tr></tbody></table></div><p>stack将列旋转为行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = data.stack()</div><div class="line">result</div></pre></td></tr></table></figure><pre><code>state     number
Ohio      one       0
          two       1
          three     2
Colorado  one       3
          two       4
          three     5
dtype: int32
</code></pre><p>unstack将行旋转为列，默认操作最内层</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">result.unstack()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>number</th><th>one</th><th>two</th><th>three</th></tr><tr><th>state</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>Ohio</th><td>0</td><td>1</td><td>2</td></tr><tr><th>Colorado</th><td>3</td><td>4</td><td>5</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">result.unstack(<span class="number">0</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>state</th><th>Ohio</th><th>Colorado</th></tr><tr><th>number</th><th></th><th></th></tr></thead><tbody><tr><th>one</th><td>0</td><td>3</td></tr><tr><th>two</th><td>1</td><td>4</td></tr><tr><th>three</th><td>2</td><td>5</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">result.unstack(<span class="string">'state'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>state</th><th>Ohio</th><th>Colorado</th></tr><tr><th>number</th><th></th><th></th></tr></thead><tbody><tr><th>one</th><td>0</td><td>3</td></tr><tr><th>two</th><td>1</td><td>4</td></tr><tr><th>three</th><td>2</td><td>5</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">s1 = Series([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">s2 = Series([<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], index=[<span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">s1</div><div class="line">s2</div><div class="line">data2 = pd.concat([s1, s2], keys=[<span class="string">'one'</span>, <span class="string">'two'</span>])</div><div class="line">data2</div><div class="line">data2.unstack()</div></pre></td></tr></table></figure><pre><code>a    0
b    1
c    2
d    3
dtype: int64






c    4
d    5
e    6
dtype: int64






one  a    0
     b    1
     c    2
     d    3
two  c    4
     d    5
     e    6
dtype: int64
</code></pre><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>one</th><td>0.0</td><td>1.0</td><td>2.0</td><td>3.0</td><td>NaN</td></tr><tr><th>two</th><td>NaN</td><td>NaN</td><td>4.0</td><td>5.0</td><td>6.0</td></tr></tbody></table></div><p>stack默认会滤除缺失值，因此两者可逆</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data2.unstack().stack()</div></pre></td></tr></table></figure><pre><code>one  a    0.0
     b    1.0
     c    2.0
     d    3.0
two  c    4.0
     d    5.0
     e    6.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data2.unstack().stack(dropna=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><pre><code>one  a    0.0
     b    1.0
     c    2.0
     d    3.0
     e    NaN
two  a    NaN
     b    NaN
     c    4.0
     d    5.0
     e    6.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">result</div><div class="line">df = DataFrame(&#123;<span class="string">'left'</span>: result, <span class="string">'right'</span>: result + <span class="number">5</span>&#125;,</div><div class="line">               columns=pd.Index([<span class="string">'left'</span>, <span class="string">'right'</span>], name=<span class="string">'side'</span>))</div><div class="line">df</div></pre></td></tr></table></figure><pre><code>state     number
Ohio      one       0
          two       1
          three     2
Colorado  one       3
          two       4
          three     5
dtype: int32
</code></pre><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>side</th><th>left</th><th>right</th></tr><tr><th>state</th><th>number</th><th></th><th></th></tr></thead><tbody><tr><th rowspan="3" valign="top">Ohio</th><th>one</th><td>0</td><td>5</td></tr><tr><th>two</th><td>1</td><td>6</td></tr><tr><th>three</th><td>2</td><td>7</td></tr><tr><th rowspan="3" valign="top">Colorado</th><th>one</th><td>3</td><td>8</td></tr><tr><th>two</th><td>4</td><td>9</td></tr><tr><th>three</th><td>5</td><td>10</td></tr></tbody></table></div><p>DataFrame作为旋转轴的级别将成为结果中的最低级别（axis=MAX）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.unstack(<span class="string">'state'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr><th>side</th><th colspan="2" halign="left">left</th><th colspan="2" halign="left">right</th></tr><tr><th>state</th><th>Ohio</th><th>Colorado</th><th>Ohio</th><th>Colorado</th></tr><tr><th>number</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>one</th><td>0</td><td>3</td><td>5</td><td>8</td></tr><tr><th>two</th><td>1</td><td>4</td><td>6</td><td>9</td></tr><tr><th>three</th><td>2</td><td>5</td><td>7</td><td>10</td></tr></tbody></table></div><p>stack操作将axis-1?</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.unstack(<span class="string">'state'</span>).stack(<span class="string">'side'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>state</th><th>Ohio</th><th>Colorado</th></tr><tr><th>number</th><th>side</th><th></th><th></th></tr></thead><tbody><tr><th rowspan="2" valign="top">one</th><th>left</th><td>0</td><td>3</td></tr><tr><th>right</th><td>5</td><td>8</td></tr><tr><th rowspan="2" valign="top">two</th><th>left</th><td>1</td><td>4</td></tr><tr><th>right</th><td>6</td><td>9</td></tr><tr><th rowspan="2" valign="top">three</th><th>left</th><td>2</td><td>5</td></tr><tr><th>right</th><td>7</td><td>10</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">df.unstack(<span class="string">'state'</span>)</div><div class="line">df.unstack(<span class="string">'state'</span>).stack(<span class="string">'state'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr><th>side</th><th colspan="2" halign="left">left</th><th colspan="2" halign="left">right</th></tr><tr><th>state</th><th>Ohio</th><th>Colorado</th><th>Ohio</th><th>Colorado</th></tr><tr><th>number</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>one</th><td>0</td><td>3</td><td>5</td><td>8</td></tr><tr><th>two</th><td>1</td><td>4</td><td>6</td><td>9</td></tr><tr><th>three</th><td>2</td><td>5</td><td>7</td><td>10</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>side</th><th>left</th><th>right</th></tr><tr><th>number</th><th>state</th><th></th><th></th></tr></thead><tbody><tr><th rowspan="2" valign="top">one</th><th>Ohio</th><td>0</td><td>5</td></tr><tr><th>Colorado</th><td>3</td><td>8</td></tr><tr><th rowspan="2" valign="top">two</th><th>Ohio</th><td>1</td><td>6</td></tr><tr><th>Colorado</th><td>4</td><td>9</td></tr><tr><th rowspan="2" valign="top">three</th><th>Ohio</th><td>2</td><td>7</td></tr><tr><th>Colorado</th><td>5</td><td>10</td></tr></tbody></table></div><h3 id="将长格式旋转为宽格式"><a href="#将长格式旋转为宽格式" class="headerlink" title="将长格式旋转为宽格式"></a>将长格式旋转为宽格式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">data = pd.read_csv(<span class="string">'ch07/macrodata.csv'</span>)</div><div class="line">data[:<span class="number">10</span>]</div><div class="line">periods = pd.PeriodIndex(year=data.year, quarter=data.quarter, name=<span class="string">'date'</span>)</div><div class="line">periods[:<span class="number">10</span>]</div><div class="line">data = DataFrame(data.to_records(),</div><div class="line">                 columns=pd.Index([<span class="string">'realgdp'</span>, <span class="string">'infl'</span>, <span class="string">'unemp'</span>], name=<span class="string">'item'</span>),</div><div class="line">                 index=periods.to_timestamp(<span class="string">'D'</span>, <span class="string">'end'</span>))</div><div class="line"></div><div class="line">data[:<span class="number">10</span>]</div><div class="line">data.to_records()[:<span class="number">10</span>]</div><div class="line">data.stack()[:<span class="number">10</span>]</div><div class="line">ldata = data.stack().reset_index().rename(columns=&#123;<span class="number">0</span>: <span class="string">'value'</span>&#125;)</div><div class="line">wdata = ldata.pivot(<span class="string">'date'</span>, <span class="string">'item'</span>, <span class="string">'value'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>year</th><th>quarter</th><th>realgdp</th><th>realcons</th><th>realinv</th><th>realgovt</th><th>realdpi</th><th>cpi</th><th>m1</th><th>tbilrate</th><th>unemp</th><th>pop</th><th>infl</th><th>realint</th></tr></thead><tbody><tr><th>0</th><td>1959.0</td><td>1.0</td><td>2710.349</td><td>1707.4</td><td>286.898</td><td>470.045</td><td>1886.9</td><td>28.98</td><td>139.7</td><td>2.82</td><td>5.8</td><td>177.146</td><td>0.00</td><td>0.00</td></tr><tr><th>1</th><td>1959.0</td><td>2.0</td><td>2778.801</td><td>1733.7</td><td>310.859</td><td>481.301</td><td>1919.7</td><td>29.15</td><td>141.7</td><td>3.08</td><td>5.1</td><td>177.830</td><td>2.34</td><td>0.74</td></tr><tr><th>2</th><td>1959.0</td><td>3.0</td><td>2775.488</td><td>1751.8</td><td>289.226</td><td>491.260</td><td>1916.4</td><td>29.35</td><td>140.5</td><td>3.82</td><td>5.3</td><td>178.657</td><td>2.74</td><td>1.09</td></tr><tr><th>3</th><td>1959.0</td><td>4.0</td><td>2785.204</td><td>1753.7</td><td>299.356</td><td>484.052</td><td>1931.3</td><td>29.37</td><td>140.0</td><td>4.33</td><td>5.6</td><td>179.386</td><td>0.27</td><td>4.06</td></tr><tr><th>4</th><td>1960.0</td><td>1.0</td><td>2847.699</td><td>1770.5</td><td>331.722</td><td>462.199</td><td>1955.5</td><td>29.54</td><td>139.6</td><td>3.50</td><td>5.2</td><td>180.007</td><td>2.31</td><td>1.19</td></tr><tr><th>5</th><td>1960.0</td><td>2.0</td><td>2834.390</td><td>1792.9</td><td>298.152</td><td>460.400</td><td>1966.1</td><td>29.55</td><td>140.2</td><td>2.68</td><td>5.2</td><td>180.671</td><td>0.14</td><td>2.55</td></tr><tr><th>6</th><td>1960.0</td><td>3.0</td><td>2839.022</td><td>1785.8</td><td>296.375</td><td>474.676</td><td>1967.8</td><td>29.75</td><td>140.9</td><td>2.36</td><td>5.6</td><td>181.528</td><td>2.70</td><td>-0.34</td></tr><tr><th>7</th><td>1960.0</td><td>4.0</td><td>2802.616</td><td>1788.2</td><td>259.764</td><td>476.434</td><td>1966.6</td><td>29.84</td><td>141.1</td><td>2.29</td><td>6.3</td><td>182.287</td><td>1.21</td><td>1.08</td></tr><tr><th>8</th><td>1961.0</td><td>1.0</td><td>2819.264</td><td>1787.7</td><td>266.405</td><td>475.854</td><td>1984.5</td><td>29.81</td><td>142.1</td><td>2.37</td><td>6.8</td><td>182.992</td><td>-0.40</td><td>2.77</td></tr><tr><th>9</th><td>1961.0</td><td>2.0</td><td>2872.005</td><td>1814.3</td><td>286.246</td><td>480.328</td><td>2014.4</td><td>29.92</td><td>142.9</td><td>2.29</td><td>7.0</td><td>183.691</td><td>1.47</td><td>0.81</td></tr></tbody></table></div><pre><code>PeriodIndex([&#39;1959Q1&#39;, &#39;1959Q2&#39;, &#39;1959Q3&#39;, &#39;1959Q4&#39;, &#39;1960Q1&#39;, &#39;1960Q2&#39;,
             &#39;1960Q3&#39;, &#39;1960Q4&#39;, &#39;1961Q1&#39;, &#39;1961Q2&#39;],
            dtype=&#39;int64&#39;, name=&#39;date&#39;, freq=&#39;Q-DEC&#39;)
</code></pre><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>item</th><th>realgdp</th><th>infl</th><th>unemp</th></tr><tr><th>date</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>1959-03-31</th><td>2710.349</td><td>0.00</td><td>5.8</td></tr><tr><th>1959-06-30</th><td>2778.801</td><td>2.34</td><td>5.1</td></tr><tr><th>1959-09-30</th><td>2775.488</td><td>2.74</td><td>5.3</td></tr><tr><th>1959-12-31</th><td>2785.204</td><td>0.27</td><td>5.6</td></tr><tr><th>1960-03-31</th><td>2847.699</td><td>2.31</td><td>5.2</td></tr><tr><th>1960-06-30</th><td>2834.390</td><td>0.14</td><td>5.2</td></tr><tr><th>1960-09-30</th><td>2839.022</td><td>2.70</td><td>5.6</td></tr><tr><th>1960-12-31</th><td>2802.616</td><td>1.21</td><td>6.3</td></tr><tr><th>1961-03-31</th><td>2819.264</td><td>-0.40</td><td>6.8</td></tr><tr><th>1961-06-30</th><td>2872.005</td><td>1.47</td><td>7.0</td></tr></tbody></table></div><pre><code>rec.array([(datetime.datetime(1959, 3, 31, 0, 0), 2710.349, 0.0, 5.8),
 (datetime.datetime(1959, 6, 30, 0, 0), 2778.801, 2.34, 5.1),
 (datetime.datetime(1959, 9, 30, 0, 0), 2775.488, 2.74, 5.3),
 (datetime.datetime(1959, 12, 31, 0, 0), 2785.204, 0.27, 5.6),
 (datetime.datetime(1960, 3, 31, 0, 0), 2847.699, 2.31, 5.2),
 (datetime.datetime(1960, 6, 30, 0, 0), 2834.39, 0.14, 5.2),
 (datetime.datetime(1960, 9, 30, 0, 0), 2839.022, 2.7, 5.6),
 (datetime.datetime(1960, 12, 31, 0, 0), 2802.616, 1.21, 6.3),
 (datetime.datetime(1961, 3, 31, 0, 0), 2819.264, -0.4, 6.8),
 (datetime.datetime(1961, 6, 30, 0, 0), 2872.005, 1.47, 7.0)], 
          dtype=[(&#39;date&#39;, &#39;O&#39;), (&#39;realgdp&#39;, &#39;&lt;f8&#39;), (&#39;infl&#39;, &#39;&lt;f8&#39;), (&#39;unemp&#39;, &#39;&lt;f8&#39;)])






date        item   
1959-03-31  realgdp    2710.349
            infl          0.000
            unemp         5.800
1959-06-30  realgdp    2778.801
            infl          2.340
            unemp         5.100
1959-09-30  realgdp    2775.488
            infl          2.740
            unemp         5.300
1959-12-31  realgdp    2785.204
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ldata[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>date</th><th>item</th><th>value</th></tr></thead><tbody><tr><th>0</th><td>1959-03-31</td><td>realgdp</td><td>2710.349</td></tr><tr><th>1</th><td>1959-03-31</td><td>infl</td><td>0.000</td></tr><tr><th>2</th><td>1959-03-31</td><td>unemp</td><td>5.800</td></tr><tr><th>3</th><td>1959-06-30</td><td>realgdp</td><td>2778.801</td></tr><tr><th>4</th><td>1959-06-30</td><td>infl</td><td>2.340</td></tr><tr><th>5</th><td>1959-06-30</td><td>unemp</td><td>5.100</td></tr><tr><th>6</th><td>1959-09-30</td><td>realgdp</td><td>2775.488</td></tr><tr><th>7</th><td>1959-09-30</td><td>infl</td><td>2.740</td></tr><tr><th>8</th><td>1959-09-30</td><td>unemp</td><td>5.300</td></tr><tr><th>9</th><td>1959-12-31</td><td>realgdp</td><td>2785.204</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pivoted = ldata.pivot(<span class="string">'date'</span>, <span class="string">'item'</span>, <span class="string">'value'</span>)</div><div class="line">pivoted.head()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>item</th><th>infl</th><th>realgdp</th><th>unemp</th></tr><tr><th>date</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>1959-03-31</th><td>0.00</td><td>2710.349</td><td>5.8</td></tr><tr><th>1959-06-30</th><td>2.34</td><td>2778.801</td><td>5.1</td></tr><tr><th>1959-09-30</th><td>2.74</td><td>2775.488</td><td>5.3</td></tr><tr><th>1959-12-31</th><td>0.27</td><td>2785.204</td><td>5.6</td></tr><tr><th>1960-03-31</th><td>2.31</td><td>2847.699</td><td>5.2</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ldata[<span class="string">'value2'</span>] = np.random.randn(len(ldata))</div><div class="line">ldata[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>date</th><th>item</th><th>value</th><th>value2</th></tr></thead><tbody><tr><th>0</th><td>1959-03-31</td><td>realgdp</td><td>2710.349</td><td>-0.204708</td></tr><tr><th>1</th><td>1959-03-31</td><td>infl</td><td>0.000</td><td>0.478943</td></tr><tr><th>2</th><td>1959-03-31</td><td>unemp</td><td>5.800</td><td>-0.519439</td></tr><tr><th>3</th><td>1959-06-30</td><td>realgdp</td><td>2778.801</td><td>-0.555730</td></tr><tr><th>4</th><td>1959-06-30</td><td>infl</td><td>2.340</td><td>1.965781</td></tr><tr><th>5</th><td>1959-06-30</td><td>unemp</td><td>5.100</td><td>1.393406</td></tr><tr><th>6</th><td>1959-09-30</td><td>realgdp</td><td>2775.488</td><td>0.092908</td></tr><tr><th>7</th><td>1959-09-30</td><td>infl</td><td>2.740</td><td>0.281746</td></tr><tr><th>8</th><td>1959-09-30</td><td>unemp</td><td>5.300</td><td>0.769023</td></tr><tr><th>9</th><td>1959-12-31</td><td>realgdp</td><td>2785.204</td><td>1.246435</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pivoted = ldata.pivot(<span class="string">'date'</span>, <span class="string">'item'</span>)</div><div class="line">pivoted[:<span class="number">5</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr><th></th><th colspan="3" halign="left">value</th><th colspan="3" halign="left">value2</th></tr><tr><th>item</th><th>infl</th><th>realgdp</th><th>unemp</th><th>infl</th><th>realgdp</th><th>unemp</th></tr><tr><th>date</th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>1959-03-31</th><td>0.00</td><td>2710.349</td><td>5.8</td><td>0.478943</td><td>-0.204708</td><td>-0.519439</td></tr><tr><th>1959-06-30</th><td>2.34</td><td>2778.801</td><td>5.1</td><td>1.965781</td><td>-0.555730</td><td>1.393406</td></tr><tr><th>1959-09-30</th><td>2.74</td><td>2775.488</td><td>5.3</td><td>0.281746</td><td>0.092908</td><td>0.769023</td></tr><tr><th>1959-12-31</th><td>0.27</td><td>2785.204</td><td>5.6</td><td>1.007189</td><td>1.246435</td><td>-1.296221</td></tr><tr><th>1960-03-31</th><td>2.31</td><td>2847.699</td><td>5.2</td><td>0.228913</td><td>0.274992</td><td>1.352917</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pivoted[<span class="string">'value'</span>][:<span class="number">5</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>item</th><th>infl</th><th>realgdp</th><th>unemp</th></tr><tr><th>date</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>1959-03-31</th><td>0.00</td><td>2710.349</td><td>5.8</td></tr><tr><th>1959-06-30</th><td>2.34</td><td>2778.801</td><td>5.1</td></tr><tr><th>1959-09-30</th><td>2.74</td><td>2775.488</td><td>5.3</td></tr><tr><th>1959-12-31</th><td>0.27</td><td>2785.204</td><td>5.6</td></tr><tr><th>1960-03-31</th><td>2.31</td><td>2847.699</td><td>5.2</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ldata.set_index([<span class="string">'date'</span>, <span class="string">'item'</span>])[:<span class="number">9</span>]</div><div class="line">unstacked = ldata.set_index([<span class="string">'date'</span>, <span class="string">'item'</span>]).unstack(<span class="string">'item'</span>)</div><div class="line">unstacked[:<span class="number">7</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th></th><th>value</th><th>value2</th></tr><tr><th>date</th><th>item</th><th></th><th></th></tr></thead><tbody><tr><th rowspan="3" valign="top">1959-03-31</th><th>realgdp</th><td>2710.349</td><td>-0.204708</td></tr><tr><th>infl</th><td>0.000</td><td>0.478943</td></tr><tr><th>unemp</th><td>5.800</td><td>-0.519439</td></tr><tr><th rowspan="3" valign="top">1959-06-30</th><th>realgdp</th><td>2778.801</td><td>-0.555730</td></tr><tr><th>infl</th><td>2.340</td><td>1.965781</td></tr><tr><th>unemp</th><td>5.100</td><td>1.393406</td></tr><tr><th rowspan="3" valign="top">1959-09-30</th><th>realgdp</th><td>2775.488</td><td>0.092908</td></tr><tr><th>infl</th><td>2.740</td><td>0.281746</td></tr><tr><th>unemp</th><td>5.300</td><td>0.769023</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr><th></th><th colspan="3" halign="left">value</th><th colspan="3" halign="left">value2</th></tr><tr><th>item</th><th>infl</th><th>realgdp</th><th>unemp</th><th>infl</th><th>realgdp</th><th>unemp</th></tr><tr><th>date</th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>1959-03-31</th><td>0.00</td><td>2710.349</td><td>5.8</td><td>0.478943</td><td>-0.204708</td><td>-0.519439</td></tr><tr><th>1959-06-30</th><td>2.34</td><td>2778.801</td><td>5.1</td><td>1.965781</td><td>-0.555730</td><td>1.393406</td></tr><tr><th>1959-09-30</th><td>2.74</td><td>2775.488</td><td>5.3</td><td>0.281746</td><td>0.092908</td><td>0.769023</td></tr><tr><th>1959-12-31</th><td>0.27</td><td>2785.204</td><td>5.6</td><td>1.007189</td><td>1.246435</td><td>-1.296221</td></tr><tr><th>1960-03-31</th><td>2.31</td><td>2847.699</td><td>5.2</td><td>0.228913</td><td>0.274992</td><td>1.352917</td></tr><tr><th>1960-06-30</th><td>0.14</td><td>2834.390</td><td>5.2</td><td>-2.001637</td><td>0.886429</td><td>-0.371843</td></tr><tr><th>1960-09-30</th><td>2.70</td><td>2839.022</td><td>5.6</td><td>-0.438570</td><td>1.669025</td><td>-0.539741</td></tr></tbody></table></div><h2 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h2><h3 id="移除重复值"><a href="#移除重复值" class="headerlink" title="移除重复值"></a>移除重复值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(&#123;<span class="string">'k1'</span>: [<span class="string">'one'</span>] * <span class="number">3</span> + [<span class="string">'two'</span>] * <span class="number">4</span>,</div><div class="line">                  <span class="string">'k2'</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>]&#125;)</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>k1</th><th>k2</th></tr></thead><tbody><tr><th>0</th><td>one</td><td>1</td></tr><tr><th>1</th><td>one</td><td>1</td></tr><tr><th>2</th><td>one</td><td>2</td></tr><tr><th>3</th><td>two</td><td>3</td></tr><tr><th>4</th><td>two</td><td>3</td></tr><tr><th>5</th><td>two</td><td>4</td></tr><tr><th>6</th><td>two</td><td>4</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.duplicated()</div></pre></td></tr></table></figure><pre><code>0    False
1     True
2    False
3    False
4     True
5    False
6     True
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.drop_duplicates()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>k1</th><th>k2</th></tr></thead><tbody><tr><th>0</th><td>one</td><td>1</td></tr><tr><th>2</th><td>one</td><td>2</td></tr><tr><th>3</th><td>two</td><td>3</td></tr><tr><th>5</th><td>two</td><td>4</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'v1'</span>] = range(<span class="number">7</span>)</div><div class="line">data</div><div class="line">data.drop_duplicates([<span class="string">'k1'</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>k1</th><th>k2</th><th>v1</th></tr></thead><tbody><tr><th>0</th><td>one</td><td>1</td><td>0</td></tr><tr><th>1</th><td>one</td><td>1</td><td>1</td></tr><tr><th>2</th><td>one</td><td>2</td><td>2</td></tr><tr><th>3</th><td>two</td><td>3</td><td>3</td></tr><tr><th>4</th><td>two</td><td>3</td><td>4</td></tr><tr><th>5</th><td>two</td><td>4</td><td>5</td></tr><tr><th>6</th><td>two</td><td>4</td><td>6</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>k1</th><th>k2</th><th>v1</th></tr></thead><tbody><tr><th>0</th><td>one</td><td>1</td><td>0</td></tr><tr><th>3</th><td>two</td><td>3</td><td>3</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data.drop_duplicates([<span class="string">'k1'</span>, <span class="string">'k2'</span>], keep=<span class="string">'last'</span>)</div><div class="line">data.drop_duplicates([<span class="string">'k1'</span>, <span class="string">'k2'</span>], keep=<span class="string">'first'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>k1</th><th>k2</th><th>v1</th></tr></thead><tbody><tr><th>1</th><td>one</td><td>1</td><td>1</td></tr><tr><th>2</th><td>one</td><td>2</td><td>2</td></tr><tr><th>4</th><td>two</td><td>3</td><td>4</td></tr><tr><th>6</th><td>two</td><td>4</td><td>6</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>k1</th><th>k2</th><th>v1</th></tr></thead><tbody><tr><th>0</th><td>one</td><td>1</td><td>0</td></tr><tr><th>2</th><td>one</td><td>2</td><td>2</td></tr><tr><th>3</th><td>two</td><td>3</td><td>3</td></tr><tr><th>5</th><td>two</td><td>4</td><td>5</td></tr></tbody></table></div><h3 id="利用函数或映射进行数据转换"><a href="#利用函数或映射进行数据转换" class="headerlink" title="利用函数或映射进行数据转换"></a>利用函数或映射进行数据转换</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(&#123;<span class="string">'food'</span>: [<span class="string">'bacon'</span>, <span class="string">'pulled pork'</span>, <span class="string">'bacon'</span>, <span class="string">'Pastrami'</span>,</div><div class="line">                           <span class="string">'corned beef'</span>, <span class="string">'Bacon'</span>, <span class="string">'pastrami'</span>, <span class="string">'honey ham'</span>,</div><div class="line">                           <span class="string">'nova lox'</span>],</div><div class="line">                  <span class="string">'ounces'</span>: [<span class="number">4</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">7.5</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>]&#125;)</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>food</th><th>ounces</th></tr></thead><tbody><tr><th>0</th><td>bacon</td><td>4.0</td></tr><tr><th>1</th><td>pulled pork</td><td>3.0</td></tr><tr><th>2</th><td>bacon</td><td>12.0</td></tr><tr><th>3</th><td>Pastrami</td><td>6.0</td></tr><tr><th>4</th><td>corned beef</td><td>7.5</td></tr><tr><th>5</th><td>Bacon</td><td>8.0</td></tr><tr><th>6</th><td>pastrami</td><td>3.0</td></tr><tr><th>7</th><td>honey ham</td><td>5.0</td></tr><tr><th>8</th><td>nova lox</td><td>6.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">meat_to_animal = &#123;</div><div class="line">  <span class="string">'bacon'</span>: <span class="string">'pig'</span>,</div><div class="line">  <span class="string">'pulled pork'</span>: <span class="string">'pig'</span>,</div><div class="line">  <span class="string">'pastrami'</span>: <span class="string">'cow'</span>,</div><div class="line">  <span class="string">'corned beef'</span>: <span class="string">'cow'</span>,</div><div class="line">  <span class="string">'honey ham'</span>: <span class="string">'pig'</span>,</div><div class="line">  <span class="string">'nova lox'</span>: <span class="string">'salmon'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'animal'</span>] = data[<span class="string">'food'</span>].map(str.lower).map(meat_to_animal)</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>food</th><th>ounces</th><th>animal</th></tr></thead><tbody><tr><th>0</th><td>bacon</td><td>4.0</td><td>pig</td></tr><tr><th>1</th><td>pulled pork</td><td>3.0</td><td>pig</td></tr><tr><th>2</th><td>bacon</td><td>12.0</td><td>pig</td></tr><tr><th>3</th><td>Pastrami</td><td>6.0</td><td>cow</td></tr><tr><th>4</th><td>corned beef</td><td>7.5</td><td>cow</td></tr><tr><th>5</th><td>Bacon</td><td>8.0</td><td>pig</td></tr><tr><th>6</th><td>pastrami</td><td>3.0</td><td>cow</td></tr><tr><th>7</th><td>honey ham</td><td>5.0</td><td>pig</td></tr><tr><th>8</th><td>nova lox</td><td>6.0</td><td>salmon</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'food'</span>].map(<span class="keyword">lambda</span> x: meat_to_animal[x.lower()])</div></pre></td></tr></table></figure><pre><code>0       pig
1       pig
2       pig
3       cow
4       cow
5       pig
6       cow
7       pig
8    salmon
Name: food, dtype: object
</code></pre><h3 id="替换值"><a href="#替换值" class="headerlink" title="替换值"></a>替换值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data = Series([<span class="number">1.</span>, <span class="number">-999.</span>, <span class="number">2.</span>, <span class="number">-999.</span>, <span class="number">-1000.</span>, <span class="number">3.</span>])</div><div class="line">data</div></pre></td></tr></table></figure><pre><code>0       1.0
1    -999.0
2       2.0
3    -999.0
4   -1000.0
5       3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.replace(<span class="number">-999</span>, np.nan)</div></pre></td></tr></table></figure><pre><code>0       1.0
1       NaN
2       2.0
3       NaN
4   -1000.0
5       3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.replace([<span class="number">-999</span>, <span class="number">-1000</span>], np.nan)</div></pre></td></tr></table></figure><pre><code>0    1.0
1    NaN
2    2.0
3    NaN
4    NaN
5    3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.replace([<span class="number">-999</span>, <span class="number">-1000</span>], [np.nan, <span class="number">0</span>])</div></pre></td></tr></table></figure><pre><code>0    1.0
1    NaN
2    2.0
3    NaN
4    0.0
5    3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.replace(&#123;<span class="number">-999</span>: np.nan, <span class="number">-1000</span>: <span class="number">0</span>&#125;)</div></pre></td></tr></table></figure><pre><code>0    1.0
1    NaN
2    2.0
3    NaN
4    0.0
5    3.0
dtype: float64
</code></pre><h3 id="重命名轴索引"><a href="#重命名轴索引" class="headerlink" title="重命名轴索引"></a>重命名轴索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>, <span class="number">4</span>)),</div><div class="line">                 index=[<span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>, <span class="string">'New York'</span>],</div><div class="line">                 columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>])</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>Ohio</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>Colorado</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>New York</th><td>8</td><td>9</td><td>10</td><td>11</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.index.map(str.upper)</div></pre></td></tr></table></figure><pre><code>array([&#39;OHIO&#39;, &#39;COLORADO&#39;, &#39;NEW YORK&#39;], dtype=object)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data.index = data.index.map(str.upper)</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>OHIO</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>COLORADO</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>NEW YORK</th><td>8</td><td>9</td><td>10</td><td>11</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.rename(index=str.title, columns=str.upper)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>ONE</th><th>TWO</th><th>THREE</th><th>FOUR</th></tr></thead><tbody><tr><th>Ohio</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>Colorado</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>New York</th><td>8</td><td>9</td><td>10</td><td>11</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data.rename(index=&#123;<span class="string">'OHIO'</span>: <span class="string">'INDIANA'</span>&#125;,</div><div class="line">            columns=&#123;<span class="string">'three'</span>: <span class="string">'peekaboo'</span>&#125;)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>peekaboo</th><th>four</th></tr></thead><tbody><tr><th>INDIANA</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>COLORADO</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>NEW YORK</th><td>8</td><td>9</td><td>10</td><td>11</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Always returns a reference to a DataFrame</span></div><div class="line">_ = data.rename(index=&#123;<span class="string">'OHIO'</span>: <span class="string">'INDIANA'</span>&#125;, inplace=<span class="keyword">True</span>)</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>INDIANA</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>COLORADO</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>NEW YORK</th><td>8</td><td>9</td><td>10</td><td>11</td></tr></tbody></table></div><h3 id="离散化和面元划分"><a href="#离散化和面元划分" class="headerlink" title="离散化和面元划分"></a>离散化和面元划分</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ages = [<span class="number">20</span>, <span class="number">22</span>, <span class="number">25</span>, <span class="number">27</span>, <span class="number">21</span>, <span class="number">23</span>, <span class="number">37</span>, <span class="number">31</span>, <span class="number">61</span>, <span class="number">45</span>, <span class="number">41</span>, <span class="number">32</span>]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">bins = [<span class="number">18</span>, <span class="number">25</span>, <span class="number">35</span>, <span class="number">60</span>, <span class="number">100</span>]</div><div class="line">cats = pd.cut(ages, bins)</div><div class="line">cats</div></pre></td></tr></table></figure><pre><code>[(18, 25], (18, 25], (18, 25], (25, 35], (18, 25], ..., (25, 35], (60, 100], (35, 60], (35, 60], (25, 35]]
Length: 12
Categories (4, object): [(18, 25] &lt; (25, 35] &lt; (35, 60] &lt; (60, 100]]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cats.codes</div></pre></td></tr></table></figure><pre><code>array([0, 0, 0, 1, 0, 0, 2, 1, 3, 2, 2, 1], dtype=int8)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cats.categories</div></pre></td></tr></table></figure><pre><code>Index([&#39;(18, 25]&#39;, &#39;(25, 35]&#39;, &#39;(35, 60]&#39;, &#39;(60, 100]&#39;], dtype=&#39;object&#39;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.value_counts(cats)</div></pre></td></tr></table></figure><pre><code>(18, 25]     5
(35, 60]     3
(25, 35]     3
(60, 100]    1
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.cut(ages, [<span class="number">18</span>, <span class="number">26</span>, <span class="number">36</span>, <span class="number">61</span>, <span class="number">100</span>], right=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><pre><code>[[18, 26), [18, 26), [18, 26), [26, 36), [18, 26), ..., [26, 36), [61, 100), [36, 61), [36, 61), [26, 36)]
Length: 12
Categories (4, object): [[18, 26) &lt; [26, 36) &lt; [36, 61) &lt; [61, 100)]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">group_names = [<span class="string">'Youth'</span>, <span class="string">'YoungAdult'</span>, <span class="string">'MiddleAged'</span>, <span class="string">'Senior'</span>]</div><div class="line">pd.cut(ages, bins, labels=group_names)</div></pre></td></tr></table></figure><pre><code>[Youth, Youth, Youth, YoungAdult, Youth, ..., YoungAdult, Senior, MiddleAged, MiddleAged, YoungAdult]
Length: 12
Categories (4, object): [Youth &lt; YoungAdult &lt; MiddleAged &lt; Senior]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data = np.random.rand(<span class="number">20</span>)</div><div class="line">pd.cut(data, <span class="number">4</span>, precision=<span class="number">2</span>)</div></pre></td></tr></table></figure><pre><code>[(0.25, 0.49], (0.25, 0.49], (0.73, 0.98], (0.25, 0.49], (0.25, 0.49], ..., (0.25, 0.49], (0.73, 0.98], (0.49, 0.73], (0.49, 0.73], (0.49, 0.73]]
Length: 20
Categories (4, object): [(0.0032, 0.25] &lt; (0.25, 0.49] &lt; (0.49, 0.73] &lt; (0.73, 0.98]]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data = np.random.randn(<span class="number">1000</span>) <span class="comment"># Normally distributed</span></div><div class="line">cats = pd.qcut(data, <span class="number">4</span>) <span class="comment"># Cut into quartiles</span></div><div class="line">cats</div></pre></td></tr></table></figure><pre><code>[(0.636, 3.26], [-3.745, -0.648], (0.636, 3.26], (-0.022, 0.636], (-0.648, -0.022], ..., (0.636, 3.26], (-0.022, 0.636], [-3.745, -0.648], (-0.022, 0.636], (-0.022, 0.636]]
Length: 1000
Categories (4, object): [[-3.745, -0.648] &lt; (-0.648, -0.022] &lt; (-0.022, 0.636] &lt; (0.636, 3.26]]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.value_counts(cats)</div></pre></td></tr></table></figure><pre><code>(0.636, 3.26]       250
(-0.022, 0.636]     250
(-0.648, -0.022]    250
[-3.745, -0.648]    250
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.qcut(data, [<span class="number">0</span>, <span class="number">0.1</span>, <span class="number">0.5</span>, <span class="number">0.9</span>, <span class="number">1.</span>])</div></pre></td></tr></table></figure><pre><code>[(-0.022, 1.298], [-3.745, -1.274], (-0.022, 1.298], (-0.022, 1.298], (-1.274, -0.022], ..., (-0.022, 1.298], (-0.022, 1.298], [-3.745, -1.274], (-0.022, 1.298], (-0.022, 1.298]]
Length: 1000
Categories (4, object): [[-3.745, -1.274] &lt; (-1.274, -0.022] &lt; (-0.022, 1.298] &lt; (1.298, 3.26]]
</code></pre><h3 id="检测和过滤异常值"><a href="#检测和过滤异常值" class="headerlink" title="检测和过滤异常值"></a>检测和过滤异常值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">np.random.seed(<span class="number">12345</span>)</div><div class="line">data = DataFrame(np.random.randn(<span class="number">1000</span>, <span class="number">4</span>))</div><div class="line">data.describe()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><th>count</th><td>1000.000000</td><td>1000.000000</td><td>1000.000000</td><td>1000.000000</td></tr><tr><th>mean</th><td>-0.067684</td><td>0.067924</td><td>0.025598</td><td>-0.002298</td></tr><tr><th>std</th><td>0.998035</td><td>0.992106</td><td>1.006835</td><td>0.996794</td></tr><tr><th>min</th><td>-3.428254</td><td>-3.548824</td><td>-3.184377</td><td>-3.745356</td></tr><tr><th>25%</th><td>-0.774890</td><td>-0.591841</td><td>-0.641675</td><td>-0.644144</td></tr><tr><th>50%</th><td>-0.116401</td><td>0.101143</td><td>0.002073</td><td>-0.013611</td></tr><tr><th>75%</th><td>0.616366</td><td>0.780282</td><td>0.680391</td><td>0.654328</td></tr><tr><th>max</th><td>3.366626</td><td>2.653656</td><td>3.260383</td><td>3.927528</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">col = data[<span class="number">3</span>]</div><div class="line">col[np.abs(col) &gt; <span class="number">3</span>]</div></pre></td></tr></table></figure><pre><code>97     3.927528
305   -3.399312
400   -3.745356
Name: 3, dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[(np.abs(data) &gt; <span class="number">3</span>).any(<span class="number">1</span>)]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><th>5</th><td>-0.539741</td><td>0.476985</td><td>3.248944</td><td>-1.021228</td></tr><tr><th>97</th><td>-0.774363</td><td>0.552936</td><td>0.106061</td><td>3.927528</td></tr><tr><th>102</th><td>-0.655054</td><td>-0.565230</td><td>3.176873</td><td>0.959533</td></tr><tr><th>305</th><td>-2.315555</td><td>0.457246</td><td>-0.025907</td><td>-3.399312</td></tr><tr><th>324</th><td>0.050188</td><td>1.951312</td><td>3.260383</td><td>0.963301</td></tr><tr><th>400</th><td>0.146326</td><td>0.508391</td><td>-0.196713</td><td>-3.745356</td></tr><tr><th>499</th><td>-0.293333</td><td>-0.242459</td><td>-3.056990</td><td>1.918403</td></tr><tr><th>523</th><td>-3.428254</td><td>-0.296336</td><td>-0.439938</td><td>-0.867165</td></tr><tr><th>586</th><td>0.275144</td><td>1.179227</td><td>-3.184377</td><td>1.369891</td></tr><tr><th>808</th><td>-0.362528</td><td>-3.548824</td><td>1.553205</td><td>-2.186301</td></tr><tr><th>900</th><td>3.366626</td><td>-2.372214</td><td>0.851010</td><td>1.332846</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data[np.abs(data) &gt; <span class="number">3</span>] = np.sign(data) * <span class="number">3</span></div><div class="line">data.describe()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><th>count</th><td>1000.000000</td><td>1000.000000</td><td>1000.000000</td><td>1000.000000</td></tr><tr><th>mean</th><td>-0.067623</td><td>0.068473</td><td>0.025153</td><td>-0.002081</td></tr><tr><th>std</th><td>0.995485</td><td>0.990253</td><td>1.003977</td><td>0.989736</td></tr><tr><th>min</th><td>-3.000000</td><td>-3.000000</td><td>-3.000000</td><td>-3.000000</td></tr><tr><th>25%</th><td>-0.774890</td><td>-0.591841</td><td>-0.641675</td><td>-0.644144</td></tr><tr><th>50%</th><td>-0.116401</td><td>0.101143</td><td>0.002073</td><td>-0.013611</td></tr><tr><th>75%</th><td>0.616366</td><td>0.780282</td><td>0.680391</td><td>0.654328</td></tr><tr><th>max</th><td>3.000000</td><td>2.653656</td><td>3.000000</td><td>3.000000</td></tr></tbody></table></div><h3 id="排列和随机采样"><a href="#排列和随机采样" class="headerlink" title="排列和随机采样"></a>排列和随机采样</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(np.arange(<span class="number">5</span> * <span class="number">4</span>).reshape((<span class="number">5</span>, <span class="number">4</span>)))</div><div class="line">sampler = np.random.permutation(<span class="number">5</span>)</div><div class="line">sampler</div></pre></td></tr></table></figure><pre><code>array([1, 0, 2, 3, 4])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>1</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>2</th><td>8</td><td>9</td><td>10</td><td>11</td></tr><tr><th>3</th><td>12</td><td>13</td><td>14</td><td>15</td></tr><tr><th>4</th><td>16</td><td>17</td><td>18</td><td>19</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.take(sampler)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><th>1</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>0</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>2</th><td>8</td><td>9</td><td>10</td><td>11</td></tr><tr><th>3</th><td>12</td><td>13</td><td>14</td><td>15</td></tr><tr><th>4</th><td>16</td><td>17</td><td>18</td><td>19</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.take(np.random.permutation(len(df))[:<span class="number">3</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><th>1</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>0</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>4</th><td>16</td><td>17</td><td>18</td><td>19</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">bag = np.array([<span class="number">5</span>, <span class="number">7</span>, <span class="number">-1</span>, <span class="number">6</span>, <span class="number">4</span>])</div><div class="line">sampler = np.random.randint(<span class="number">0</span>, len(bag), size=<span class="number">10</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sampler</div></pre></td></tr></table></figure><pre><code>array([3, 0, 4, 1, 1, 2, 3, 0, 1, 2])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">draws = bag.take(sampler)</div><div class="line">draws</div></pre></td></tr></table></figure><pre><code>array([ 6,  5,  4,  7,  7, -1,  6,  5,  7, -1])
</code></pre><h3 id="计算指标-哑变量"><a href="#计算指标-哑变量" class="headerlink" title="计算指标 / 哑变量"></a>计算指标 / 哑变量</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(&#123;<span class="string">'key'</span>: [<span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>],</div><div class="line">                <span class="string">'data1'</span>: range(<span class="number">6</span>)&#125;)</div><div class="line">df</div><div class="line">pd.get_dummies(df[<span class="string">'key'</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td></tr><tr><th>1</th><td>1</td><td>b</td></tr><tr><th>2</th><td>2</td><td>a</td></tr><tr><th>3</th><td>3</td><td>c</td></tr><tr><th>4</th><td>4</td><td>a</td></tr><tr><th>5</th><td>5</td><td>b</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>1</th><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>2</th><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><th>3</th><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>4</th><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><th>5</th><td>0.0</td><td>1.0</td><td>0.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dummies = pd.get_dummies(df[<span class="string">'key'</span>], prefix=<span class="string">'key'</span>)</div><div class="line">dummies</div><div class="line">df_with_dummy = df[[<span class="string">'data1'</span>]].join(dummies)</div><div class="line">df_with_dummy</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key_a</th><th>key_b</th><th>key_c</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>1</th><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>2</th><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><th>3</th><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>4</th><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><th>5</th><td>0.0</td><td>1.0</td><td>0.0</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key_a</th><th>key_b</th><th>key_c</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>1</th><td>1</td><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>2</th><td>2</td><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><th>3</th><td>3</td><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>4</th><td>4</td><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><th>5</th><td>5</td><td>0.0</td><td>1.0</td><td>0.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mnames = [<span class="string">'movie_id'</span>, <span class="string">'title'</span>, <span class="string">'genres'</span>]</div><div class="line">movies = pd.read_table(<span class="string">'ch02/movielens/movies.dat'</span>, sep=<span class="string">'::'</span>, header=<span class="keyword">None</span>,</div><div class="line">                        names=mnames)</div><div class="line">movies[:<span class="number">10</span>]</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:3: ParserWarning: Falling back to the &#39;python&#39; engine because the &#39;c&#39; engine does not support regex separators (separators &gt; 1 char and different from &#39;\s+&#39; are interpreted as regex); you can avoid this warning by specifying engine=&#39;python&#39;.
  app.launch_new_instance()
</code></pre><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>movie_id</th><th>title</th><th>genres</th></tr></thead><tbody><tr><th>0</th><td>1</td><td>Toy Story (1995)</td><td>Animation|Children's|Comedy</td></tr><tr><th>1</th><td>2</td><td>Jumanji (1995)</td><td>Adventure|Children's|Fantasy</td></tr><tr><th>2</th><td>3</td><td>Grumpier Old Men (1995)</td><td>Comedy|Romance</td></tr><tr><th>3</th><td>4</td><td>Waiting to Exhale (1995)</td><td>Comedy|Drama</td></tr><tr><th>4</th><td>5</td><td>Father of the Bride Part II (1995)</td><td>Comedy</td></tr><tr><th>5</th><td>6</td><td>Heat (1995)</td><td>Action|Crime|Thriller</td></tr><tr><th>6</th><td>7</td><td>Sabrina (1995)</td><td>Comedy|Romance</td></tr><tr><th>7</th><td>8</td><td>Tom and Huck (1995)</td><td>Adventure|Children's</td></tr><tr><th>8</th><td>9</td><td>Sudden Death (1995)</td><td>Action</td></tr><tr><th>9</th><td>10</td><td>GoldenEye (1995)</td><td>Action|Adventure|Thriller</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">genre_iter = (set(x.split(<span class="string">'|'</span>)) <span class="keyword">for</span> x <span class="keyword">in</span> movies.genres)</div><div class="line">genres = sorted(set.union(*genre_iter))</div><div class="line">genres</div></pre></td></tr></table></figure><pre><code>[&#39;Action&#39;,
 &#39;Adventure&#39;,
 &#39;Animation&#39;,
 &quot;Children&#39;s&quot;,
 &#39;Comedy&#39;,
 &#39;Crime&#39;,
 &#39;Documentary&#39;,
 &#39;Drama&#39;,
 &#39;Fantasy&#39;,
 &#39;Film-Noir&#39;,
 &#39;Horror&#39;,
 &#39;Musical&#39;,
 &#39;Mystery&#39;,
 &#39;Romance&#39;,
 &#39;Sci-Fi&#39;,
 &#39;Thriller&#39;,
 &#39;War&#39;,
 &#39;Western&#39;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dummies = DataFrame(np.zeros((len(movies), len(genres))), columns=genres)</div><div class="line">dummies[:<span class="number">10</span>].ix[:, :<span class="number">5</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Action</th><th>Adventure</th><th>Animation</th><th>Children's</th><th>Comedy</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>1</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>2</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>3</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>4</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>5</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>6</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>7</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>8</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>9</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i, gen <span class="keyword">in</span> enumerate(movies.genres):</div><div class="line">    dummies.ix[i, gen.split(<span class="string">'|'</span>)] = <span class="number">1</span></div><div class="line">dummies[:<span class="number">10</span>].ix[:, :<span class="number">5</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Action</th><th>Adventure</th><th>Animation</th><th>Children's</th><th>Comedy</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>0.0</td><td>1.0</td><td>1.0</td><td>1.0</td></tr><tr><th>1</th><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>2</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>3</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>4</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>5</th><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>6</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>7</th><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>8</th><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>9</th><td>1.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">movies_windic = movies.join(dummies.add_prefix(<span class="string">'Genre_'</span>))</div><div class="line">movies_windic.ix[<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>movie_id                                       1
title                           Toy Story (1995)
genres               Animation|Children&#39;s|Comedy
Genre_Action                                   0
Genre_Adventure                                0
Genre_Animation                                1
Genre_Children&#39;s                               1
Genre_Comedy                                   1
Genre_Crime                                    0
Genre_Documentary                              0
Genre_Drama                                    0
Genre_Fantasy                                  0
Genre_Film-Noir                                0
Genre_Horror                                   0
Genre_Musical                                  0
Genre_Mystery                                  0
Genre_Romance                                  0
Genre_Sci-Fi                                   0
Genre_Thriller                                 0
Genre_War                                      0
Genre_Western                                  0
Name: 0, dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.random.seed(<span class="number">12345</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">values = np.random.rand(<span class="number">10</span>)</div><div class="line">values</div></pre></td></tr></table></figure><pre><code>array([ 0.9296,  0.3164,  0.1839,  0.2046,  0.5677,  0.5955,  0.9645,
        0.6532,  0.7489,  0.6536])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">bins = [<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">0.4</span>, <span class="number">0.6</span>, <span class="number">0.8</span>, <span class="number">1</span>]</div><div class="line">pd.get_dummies(pd.cut(values, bins))</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>(0, 0.2]</th><th>(0.2, 0.4]</th><th>(0.4, 0.6]</th><th>(0.6, 0.8]</th><th>(0.8, 1]</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>1</th><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>2</th><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>3</th><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>4</th><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><th>5</th><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><th>6</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>7</th><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>8</th><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>9</th><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td></tr></tbody></table></div><h2 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h2><h3 id="字符串对象方法"><a href="#字符串对象方法" class="headerlink" title="字符串对象方法"></a>字符串对象方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">val = <span class="string">'a,b,  guido'</span></div><div class="line">val.split(<span class="string">','</span>)</div></pre></td></tr></table></figure><pre><code>[&#39;a&#39;, &#39;b&#39;, &#39;  guido&#39;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pieces = [x.strip() <span class="keyword">for</span> x <span class="keyword">in</span> val.split(<span class="string">','</span>)]</div><div class="line">pieces</div></pre></td></tr></table></figure><pre><code>[&#39;a&#39;, &#39;b&#39;, &#39;guido&#39;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">first, second, third = pieces</div><div class="line">first + <span class="string">'::'</span> + second + <span class="string">'::'</span> + third</div></pre></td></tr></table></figure><pre><code>&#39;a::b::guido&#39;
</code></pre><p>Surprise :P</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">'::'</span>.join(pieces)</div></pre></td></tr></table></figure><pre><code>&#39;a::b::guido&#39;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">'guido'</span> <span class="keyword">in</span> val</div></pre></td></tr></table></figure><pre><code>True
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">val.index(<span class="string">','</span>)</div></pre></td></tr></table></figure><pre><code>1
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">val.find(<span class="string">':'</span>)</div></pre></td></tr></table></figure><pre><code>-1
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">val.index(<span class="string">':'</span>)</div></pre></td></tr></table></figure><pre><code>---------------------------------------------------------------------------

ValueError                                Traceback (most recent call last)

&lt;ipython-input-110-280f8b2856ce&gt; in &lt;module&gt;()
----&gt; 1 val.index(&#39;:&#39;)


ValueError: substring not found
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">val.count(<span class="string">','</span>)</div></pre></td></tr></table></figure><pre><code>2
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">val.replace(<span class="string">','</span>, <span class="string">'::'</span>)</div></pre></td></tr></table></figure><pre><code>&#39;a::b::  guido&#39;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">val.replace(<span class="string">','</span>, <span class="string">''</span>)</div></pre></td></tr></table></figure><pre><code>&#39;ab  guido&#39;
</code></pre><h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> re</div><div class="line">text = <span class="string">"foo    bar\t baz  \tqux"</span></div><div class="line">re.split(<span class="string">'\s+'</span>, text)</div></pre></td></tr></table></figure><pre><code>[&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;, &#39;qux&#39;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">regex = re.compile(<span class="string">'\s+'</span>)</div><div class="line">regex.split(text)</div></pre></td></tr></table></figure><pre><code>[&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;, &#39;qux&#39;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">regex.findall(text)</div></pre></td></tr></table></figure><pre><code>[&#39;    &#39;, &#39;\t &#39;, &#39;  \t&#39;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">text = <span class="string">"""Dave dave@google.com</span></div><div class="line">Steve steve@gmail.com</div><div class="line">Rob rob@gmail.com</div><div class="line">Ryan ryan@yahoo.com</div><div class="line">"""</div><div class="line">pattern = <span class="string">r'[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]&#123;2,4&#125;'</span></div><div class="line"></div><div class="line"><span class="comment"># re.IGNORECASE makes the regex case-insensitive</span></div><div class="line">regex = re.compile(pattern, flags=re.IGNORECASE)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">regex.findall(text)</div></pre></td></tr></table></figure><pre><code>[&#39;dave@google.com&#39;, &#39;steve@gmail.com&#39;, &#39;rob@gmail.com&#39;, &#39;ryan@yahoo.com&#39;]
</code></pre><p>Search只返回第一项</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">m = regex.search(text)</div><div class="line">m</div></pre></td></tr></table></figure><pre><code>&lt;_sre.SRE_Match object; span=(5, 20), match=&#39;dave@google.com&#39;&gt;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">text[m.start():m.end()]</div></pre></td></tr></table></figure><pre><code>&#39;dave@google.com&#39;
</code></pre><p>只匹配出现在字符串开头的模式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">print(regex.match(text))</div></pre></td></tr></table></figure><pre><code>None
</code></pre><p>​</p><p>替换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">print(regex.sub(<span class="string">'REDACTED'</span>, text))</div></pre></td></tr></table></figure><pre><code>Dave REDACTED
Steve REDACTED
Rob REDACTED
Ryan REDACTED
</code></pre><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pattern = <span class="string">r'([A-Z0-9._%+-]+)@([A-Z0-9.-]+)\.([A-Z]&#123;2,4&#125;)'</span></div><div class="line">regex = re.compile(pattern, flags=re.IGNORECASE)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">m = regex.match(<span class="string">'wesm@bright.net'</span>)</div><div class="line">m.groups()</div></pre></td></tr></table></figure><pre><code>(&#39;wesm&#39;, &#39;bright&#39;, &#39;net&#39;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">regex.findall(text)</div></pre></td></tr></table></figure><pre><code>[(&#39;dave&#39;, &#39;google&#39;, &#39;com&#39;),
 (&#39;steve&#39;, &#39;gmail&#39;, &#39;com&#39;),
 (&#39;rob&#39;, &#39;gmail&#39;, &#39;com&#39;),
 (&#39;ryan&#39;, &#39;yahoo&#39;, &#39;com&#39;)]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">print(regex.sub(<span class="string">r'Username: \1, Domain: \2, Suffix: \3'</span>, text))</div></pre></td></tr></table></figure><pre><code>Dave Username: dave, Domain: google, Suffix: com
Steve Username: steve, Domain: gmail, Suffix: com
Rob Username: rob, Domain: gmail, Suffix: com
Ryan Username: ryan, Domain: yahoo, Suffix: com
</code></pre><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">regex = re.compile(<span class="string">r"""</span></div><div class="line">    (?P&lt;username&gt;[A-Z0-9._%+-]+)</div><div class="line">    @</div><div class="line">    (?P&lt;domain&gt;[A-Z0-9.-]+)</div><div class="line">    \.</div><div class="line">    (?P&lt;suffix&gt;[A-Z]&#123;2,4&#125;)""", flags=re.IGNORECASE|re.VERBOSE)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">m = regex.match(<span class="string">'wesm@bright.net'</span>)</div><div class="line">m.groupdict()</div></pre></td></tr></table></figure><pre><code>{&#39;domain&#39;: &#39;bright&#39;, &#39;suffix&#39;: &#39;net&#39;, &#39;username&#39;: &#39;wesm&#39;}
</code></pre><h3 id="pandas中矢量化的字符串函数"><a href="#pandas中矢量化的字符串函数" class="headerlink" title="pandas中矢量化的字符串函数"></a>pandas中矢量化的字符串函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data = &#123;<span class="string">'Dave'</span>: <span class="string">'dave@google.com'</span>, <span class="string">'Steve'</span>: <span class="string">'steve@gmail.com'</span>,</div><div class="line">        <span class="string">'Rob'</span>: <span class="string">'rob@gmail.com'</span>, <span class="string">'Wes'</span>: np.nan&#125;</div><div class="line">data = Series(data)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data</div></pre></td></tr></table></figure><pre><code>Dave     dave@google.com
Rob        rob@gmail.com
Steve    steve@gmail.com
Wes                  NaN
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.isnull()</div></pre></td></tr></table></figure><pre><code>Dave     False
Rob      False
Steve    False
Wes       True
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.str.contains(<span class="string">'gmail'</span>)</div></pre></td></tr></table></figure><pre><code>Dave     False
Rob       True
Steve     True
Wes        NaN
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pattern</div></pre></td></tr></table></figure><pre><code>&#39;([A-Z0-9._%+-]+)@([A-Z0-9.-]+)\\.([A-Z]{2,4})&#39;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.str.findall(pattern, flags=re.IGNORECASE)</div></pre></td></tr></table></figure><pre><code>Dave     [(dave, google, com)]
Rob        [(rob, gmail, com)]
Steve    [(steve, gmail, com)]
Wes                        NaN
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">matches = data.str.match(pattern, flags=re.IGNORECASE)</div><div class="line">matches</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:1: FutureWarning: In future versions of pandas, match will change to always return a bool indexer.
  if __name__ == &#39;__main__&#39;:





Dave     (dave, google, com)
Rob        (rob, gmail, com)
Steve    (steve, gmail, com)
Wes                      NaN
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">matches.str.get(<span class="number">1</span>)</div></pre></td></tr></table></figure><pre><code>Dave     google
Rob       gmail
Steve     gmail
Wes         NaN
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">matches.str[<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>Dave      dave
Rob        rob
Steve    steve
Wes        NaN
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.str[:<span class="number">5</span>]</div></pre></td></tr></table></figure><pre><code>Dave     dave@
Rob      rob@g
Steve    steve
Wes        NaN
dtype: object
</code></pre><h2 id="Example-USDA-Food-Database"><a href="#Example-USDA-Food-Database" class="headerlink" title="Example: USDA Food Database"></a>Example: USDA Food Database</h2><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  "id": 21441,</div><div class="line">  "description": "KENTUCKY FRIED CHICKEN, Fried Chicken, EXTRA CRISPY,</div><div class="line">Wing, meat and skin with breading",</div><div class="line">  "tags": ["KFC"],</div><div class="line">  "manufacturer": "Kentucky Fried Chicken",</div><div class="line">  "group": "Fast Foods",</div><div class="line">  "portions": [</div><div class="line">    &#123;</div><div class="line">      "amount": 1,</div><div class="line">      "unit": "wing, with skin",</div><div class="line">      "grams": 68.0</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    ...</div><div class="line">  ],</div><div class="line">  "nutrients": [</div><div class="line">    &#123;</div><div class="line">      "value": 20.8,</div><div class="line">      "units": "g",</div><div class="line">      "description": "Protein",</div><div class="line">      "group": "Composition"</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    ...</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> json</div><div class="line">db = json.load(open(<span class="string">'ch07/foods-2011-10-03.json'</span>))</div><div class="line">len(db)</div></pre></td></tr></table></figure><pre><code>6636
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db[<span class="number">0</span>].keys()</div></pre></td></tr></table></figure><pre><code>dict_keys([&#39;id&#39;, &#39;tags&#39;, &#39;portions&#39;, &#39;nutrients&#39;, &#39;description&#39;, &#39;group&#39;, &#39;manufacturer&#39;])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db[<span class="number">0</span>][<span class="string">'nutrients'</span>][<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>{&#39;description&#39;: &#39;Protein&#39;,
 &#39;group&#39;: &#39;Composition&#39;,
 &#39;units&#39;: &#39;g&#39;,
 &#39;value&#39;: 25.18}
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">nutrients = DataFrame(db[<span class="number">0</span>][<span class="string">'nutrients'</span>])</div><div class="line">nutrients[:<span class="number">7</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>description</th><th>group</th><th>units</th><th>value</th></tr></thead><tbody><tr><th>0</th><td>Protein</td><td>Composition</td><td>g</td><td>25.18</td></tr><tr><th>1</th><td>Total lipid (fat)</td><td>Composition</td><td>g</td><td>29.20</td></tr><tr><th>2</th><td>Carbohydrate, by difference</td><td>Composition</td><td>g</td><td>3.06</td></tr><tr><th>3</th><td>Ash</td><td>Other</td><td>g</td><td>3.28</td></tr><tr><th>4</th><td>Energy</td><td>Energy</td><td>kcal</td><td>376.00</td></tr><tr><th>5</th><td>Water</td><td>Composition</td><td>g</td><td>39.28</td></tr><tr><th>6</th><td>Energy</td><td>Energy</td><td>kJ</td><td>1573.00</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">info_keys = [<span class="string">'description'</span>, <span class="string">'group'</span>, <span class="string">'id'</span>, <span class="string">'manufacturer'</span>]</div><div class="line">info = DataFrame(db, columns=info_keys)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">info[:<span class="number">5</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>description</th><th>group</th><th>id</th><th>manufacturer</th></tr></thead><tbody><tr><th>0</th><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td>1008</td><td></td></tr><tr><th>1</th><td>Cheese, cheddar</td><td>Dairy and Egg Products</td><td>1009</td><td></td></tr><tr><th>2</th><td>Cheese, edam</td><td>Dairy and Egg Products</td><td>1018</td><td></td></tr><tr><th>3</th><td>Cheese, feta</td><td>Dairy and Egg Products</td><td>1019</td><td></td></tr><tr><th>4</th><td>Cheese, mozzarella, part skim milk</td><td>Dairy and Egg Products</td><td>1028</td><td></td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.value_counts(info.group)[:<span class="number">10</span>]</div></pre></td></tr></table></figure><pre><code>Vegetables and Vegetable Products    812
Beef Products                        618
Baked Products                       496
Breakfast Cereals                    403
Legumes and Legume Products          365
Fast Foods                           365
Lamb, Veal, and Game Products        345
Sweets                               341
Pork Products                        328
Fruits and Fruit Juices              328
Name: group, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">nutrients = []</div><div class="line"></div><div class="line"><span class="keyword">for</span> rec <span class="keyword">in</span> db:</div><div class="line">    fnuts = DataFrame(rec[<span class="string">'nutrients'</span>])</div><div class="line">    fnuts[<span class="string">'id'</span>] = rec[<span class="string">'id'</span>]</div><div class="line">    nutrients.append(fnuts)</div><div class="line"></div><div class="line">nutrients = pd.concat(nutrients, ignore_index=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nutrients[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>description</th><th>group</th><th>units</th><th>value</th><th>id</th></tr></thead><tbody><tr><th>0</th><td>Protein</td><td>Composition</td><td>g</td><td>25.18</td><td>1008</td></tr><tr><th>1</th><td>Total lipid (fat)</td><td>Composition</td><td>g</td><td>29.20</td><td>1008</td></tr><tr><th>2</th><td>Carbohydrate, by difference</td><td>Composition</td><td>g</td><td>3.06</td><td>1008</td></tr><tr><th>3</th><td>Ash</td><td>Other</td><td>g</td><td>3.28</td><td>1008</td></tr><tr><th>4</th><td>Energy</td><td>Energy</td><td>kcal</td><td>376.00</td><td>1008</td></tr><tr><th>5</th><td>Water</td><td>Composition</td><td>g</td><td>39.28</td><td>1008</td></tr><tr><th>6</th><td>Energy</td><td>Energy</td><td>kJ</td><td>1573.00</td><td>1008</td></tr><tr><th>7</th><td>Fiber, total dietary</td><td>Composition</td><td>g</td><td>0.00</td><td>1008</td></tr><tr><th>8</th><td>Calcium, Ca</td><td>Elements</td><td>mg</td><td>673.00</td><td>1008</td></tr><tr><th>9</th><td>Iron, Fe</td><td>Elements</td><td>mg</td><td>0.64</td><td>1008</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nutrients.duplicated().sum()</div></pre></td></tr></table></figure><pre><code>14179
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nutrients = nutrients.drop_duplicates()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">col_mapping = &#123;<span class="string">'description'</span> : <span class="string">'food'</span>,</div><div class="line">               <span class="string">'group'</span>       : <span class="string">'fgroup'</span>&#125;</div><div class="line">info = info.rename(columns=col_mapping, copy=<span class="keyword">False</span>)</div><div class="line">info[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>food</th><th>fgroup</th><th>id</th><th>manufacturer</th></tr></thead><tbody><tr><th>0</th><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td>1008</td><td></td></tr><tr><th>1</th><td>Cheese, cheddar</td><td>Dairy and Egg Products</td><td>1009</td><td></td></tr><tr><th>2</th><td>Cheese, edam</td><td>Dairy and Egg Products</td><td>1018</td><td></td></tr><tr><th>3</th><td>Cheese, feta</td><td>Dairy and Egg Products</td><td>1019</td><td></td></tr><tr><th>4</th><td>Cheese, mozzarella, part skim milk</td><td>Dairy and Egg Products</td><td>1028</td><td></td></tr><tr><th>5</th><td>Cheese, mozzarella, part skim milk, low moisture</td><td>Dairy and Egg Products</td><td>1029</td><td></td></tr><tr><th>6</th><td>Cheese, romano</td><td>Dairy and Egg Products</td><td>1038</td><td></td></tr><tr><th>7</th><td>Cheese, roquefort</td><td>Dairy and Egg Products</td><td>1039</td><td></td></tr><tr><th>8</th><td>Cheese spread, pasteurized process, american, ...</td><td>Dairy and Egg Products</td><td>1048</td><td></td></tr><tr><th>9</th><td>Cream, fluid, half and half</td><td>Dairy and Egg Products</td><td>1049</td><td></td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">col_mapping = &#123;<span class="string">'description'</span> : <span class="string">'nutrient'</span>,</div><div class="line">               <span class="string">'group'</span> : <span class="string">'nutgroup'</span>&#125;</div><div class="line">nutrients = nutrients.rename(columns=col_mapping, copy=<span class="keyword">False</span>)</div><div class="line">nutrients[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>nutrient</th><th>nutgroup</th><th>units</th><th>value</th><th>id</th></tr></thead><tbody><tr><th>0</th><td>Protein</td><td>Composition</td><td>g</td><td>25.18</td><td>1008</td></tr><tr><th>1</th><td>Total lipid (fat)</td><td>Composition</td><td>g</td><td>29.20</td><td>1008</td></tr><tr><th>2</th><td>Carbohydrate, by difference</td><td>Composition</td><td>g</td><td>3.06</td><td>1008</td></tr><tr><th>3</th><td>Ash</td><td>Other</td><td>g</td><td>3.28</td><td>1008</td></tr><tr><th>4</th><td>Energy</td><td>Energy</td><td>kcal</td><td>376.00</td><td>1008</td></tr><tr><th>5</th><td>Water</td><td>Composition</td><td>g</td><td>39.28</td><td>1008</td></tr><tr><th>6</th><td>Energy</td><td>Energy</td><td>kJ</td><td>1573.00</td><td>1008</td></tr><tr><th>7</th><td>Fiber, total dietary</td><td>Composition</td><td>g</td><td>0.00</td><td>1008</td></tr><tr><th>8</th><td>Calcium, Ca</td><td>Elements</td><td>mg</td><td>673.00</td><td>1008</td></tr><tr><th>9</th><td>Iron, Fe</td><td>Elements</td><td>mg</td><td>0.64</td><td>1008</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ndata = pd.merge(nutrients, info, on=<span class="string">'id'</span>, how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ndata[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>nutrient</th><th>nutgroup</th><th>units</th><th>value</th><th>id</th><th>food</th><th>fgroup</th><th>manufacturer</th></tr></thead><tbody><tr><th>0</th><td>Protein</td><td>Composition</td><td>g</td><td>25.18</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>1</th><td>Total lipid (fat)</td><td>Composition</td><td>g</td><td>29.20</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>2</th><td>Carbohydrate, by difference</td><td>Composition</td><td>g</td><td>3.06</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>3</th><td>Ash</td><td>Other</td><td>g</td><td>3.28</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>4</th><td>Energy</td><td>Energy</td><td>kcal</td><td>376.00</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>5</th><td>Water</td><td>Composition</td><td>g</td><td>39.28</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>6</th><td>Energy</td><td>Energy</td><td>kJ</td><td>1573.00</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>7</th><td>Fiber, total dietary</td><td>Composition</td><td>g</td><td>0.00</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>8</th><td>Calcium, Ca</td><td>Elements</td><td>mg</td><td>673.00</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>9</th><td>Iron, Fe</td><td>Elements</td><td>mg</td><td>0.64</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ndata.ix[<span class="number">30000</span>]</div></pre></td></tr></table></figure><pre><code>nutrient                                       Glycine
nutgroup                                   Amino Acids
units                                                g
value                                             0.04
id                                                6158
food            Soup, tomato bisque, canned, condensed
fgroup                      Soups, Sauces, and Gravies
manufacturer                                          
Name: 30000, dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">result = ndata.groupby([<span class="string">'nutrient'</span>, <span class="string">'fgroup'</span>])[<span class="string">'value'</span>].quantile(<span class="number">0.5</span>)</div><div class="line">result[:<span class="number">10</span>]</div><div class="line">result[<span class="string">'Zinc, Zn'</span>].sort_values().plot(kind=<span class="string">'barh'</span>)</div></pre></td></tr></table></figure><pre><code>nutrient          fgroup                           
Adjusted Protein  Sweets                               12.900
                  Vegetables and Vegetable Products     2.180
Alanine           Baby Foods                            0.085
                  Baked Products                        0.248
                  Beef Products                         1.550
                  Beverages                             0.003
                  Breakfast Cereals                     0.311
                  Cereal Grains and Pasta               0.373
                  Dairy and Egg Products                0.271
                  Ethnic Foods                          1.290
Name: value, dtype: float64






&lt;matplotlib.axes._subplots.AxesSubplot at 0x1ba08c9e780&gt;
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata-analysis/ch07/result.png" alt="result"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">by_nutrient = ndata.groupby([<span class="string">'nutgroup'</span>, <span class="string">'nutrient'</span>])</div><div class="line"></div><div class="line">get_maximum = <span class="keyword">lambda</span> x: x.xs(x.value.idxmax())</div><div class="line">get_minimum = <span class="keyword">lambda</span> x: x.xs(x.value.idxmin())</div><div class="line"></div><div class="line">max_foods = by_nutrient.apply(get_maximum)[[<span class="string">'value'</span>, <span class="string">'food'</span>]]</div><div class="line"></div><div class="line"><span class="comment"># make the food a little smaller</span></div><div class="line">max_foods.food = max_foods.food.str[:<span class="number">50</span>]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">max_foods.ix[<span class="string">'Amino Acids'</span>][<span class="string">'food'</span>]</div></pre></td></tr></table></figure><pre><code>nutrient
Alanine                           Gelatins, dry powder, unsweetened
Arginine                               Seeds, sesame flour, low-fat
Aspartic acid                                   Soy protein isolate
Cystine                Seeds, cottonseed flour, low fat (glandless)
Glutamic acid                                   Soy protein isolate
Glycine                           Gelatins, dry powder, unsweetened
Histidine                Whale, beluga, meat, dried (Alaska Native)
Hydroxyproline    KENTUCKY FRIED CHICKEN, Fried Chicken, ORIGINA...
Isoleucine        Soy protein isolate, PROTEIN TECHNOLOGIES INTE...
Leucine           Soy protein isolate, PROTEIN TECHNOLOGIES INTE...
Lysine            Seal, bearded (Oogruk), meat, dried (Alaska Na...
Methionine                    Fish, cod, Atlantic, dried and salted
Phenylalanine     Soy protein isolate, PROTEIN TECHNOLOGIES INTE...
Proline                           Gelatins, dry powder, unsweetened
Serine            Soy protein isolate, PROTEIN TECHNOLOGIES INTE...
Threonine         Soy protein isolate, PROTEIN TECHNOLOGIES INTE...
Tryptophan         Sea lion, Steller, meat with fat (Alaska Native)
Tyrosine          Soy protein isolate, PROTEIN TECHNOLOGIES INTE...
Valine            Soy protein isolate, PROTEIN TECHNOLOGIES INTE...
Name: food, dtype: object
</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;数据规整化：清理、转换、合并、重塑&quot;&gt;&lt;a href=&quot;#数据规整化：清理、转换、合并、重塑&quot; class=&quot;headerlink&quot; title=&quot;数据规整化：清理、转换、合并、重塑&quot;&gt;&lt;/a&gt;数据规整化：清理、转换、合并、重塑&lt;/h2&gt;&lt;figure class
    
    </summary>
    
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
      <category term="pandas" scheme="http://yoursite.com/tags/pandas/"/>
    
  </entry>
  
  <entry>
    <title>Python data analysis Learning note Ch06</title>
    <link href="http://yoursite.com/2017/02/28/Python-data-analysis-Learning-note-Ch06/"/>
    <id>http://yoursite.com/2017/02/28/Python-data-analysis-Learning-note-Ch06/</id>
    <published>2017-02-28T13:15:17.000Z</published>
    <updated>2017-02-28T13:17:38.187Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Data-loading-storage-and-file-formats"><a href="#Data-loading-storage-and-file-formats" class="headerlink" title="Data loading, storage, and file formats"></a>Data loading, storage, and file formats</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">np.random.seed(<span class="number">12345</span>)</div><div class="line">plt.rc(<span class="string">'figure'</span>, figsize=(<span class="number">10</span>, <span class="number">6</span>))</div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">np.set_printoptions(precision=<span class="number">4</span>)</div><div class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</div><div class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">%pwd</div></pre></td></tr></table></figure><pre><code>&#39;C:\\Users\\Ewan\\Downloads\\pydata-book-master&#39;
</code></pre><h2 id="Reading-and-Writing-Data-in-Text-Format"><a href="#Reading-and-Writing-Data-in-Text-Format" class="headerlink" title="Reading and Writing Data in Text Format"></a>Reading and Writing Data in Text Format</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!more ch06\ex1.csv</div></pre></td></tr></table></figure><pre><code>a,b,c,d,message
1,2,3,4,hello
5,6,7,8,world
9,10,11,12,foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">df = pd.read_csv(<span class="string">'ch06/ex1.csv'</span>)</div><div class="line">df</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th><th>message</th></tr></thead><tbody><tr><th>0</th><td>1</td><td>2</td><td>3</td><td>4</td><td>hello</td></tr><tr><th>1</th><td>5</td><td>6</td><td>7</td><td>8</td><td>world</td></tr><tr><th>2</th><td>9</td><td>10</td><td>11</td><td>12</td><td>foo</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.read_table(<span class="string">'ch06/ex1.csv'</span>, sep=<span class="string">','</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th><th>message</th></tr></thead><tbody><tr><th>0</th><td>1</td><td>2</td><td>3</td><td>4</td><td>hello</td></tr><tr><th>1</th><td>5</td><td>6</td><td>7</td><td>8</td><td>world</td></tr><tr><th>2</th><td>9</td><td>10</td><td>11</td><td>12</td><td>foo</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!more ch06\ex2.csv</div></pre></td></tr></table></figure><pre><code>1,2,3,4,hello
5,6,7,8,world
9,10,11,12,foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pd.read_csv(<span class="string">'ch06/ex2.csv'</span>, header=<span class="keyword">None</span>)</div><div class="line">pd.read_csv(<span class="string">'ch06/ex2.csv'</span>, names=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'message'</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th></tr></thead><tbody><tr><th>0</th><td>1</td><td>2</td><td>3</td><td>4</td><td>hello</td></tr><tr><th>1</th><td>5</td><td>6</td><td>7</td><td>8</td><td>world</td></tr><tr><th>2</th><td>9</td><td>10</td><td>11</td><td>12</td><td>foo</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th><th>message</th></tr></thead><tbody><tr><th>0</th><td>1</td><td>2</td><td>3</td><td>4</td><td>hello</td></tr><tr><th>1</th><td>5</td><td>6</td><td>7</td><td>8</td><td>world</td></tr><tr><th>2</th><td>9</td><td>10</td><td>11</td><td>12</td><td>foo</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">names = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'message'</span>]</div><div class="line">pd.read_csv(<span class="string">'ch06/ex2.csv'</span>, names=names, index_col=<span class="string">'message'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th></tr><tr><th>message</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>hello</th><td>1</td><td>2</td><td>3</td><td>4</td></tr><tr><th>world</th><td>5</td><td>6</td><td>7</td><td>8</td></tr><tr><th>foo</th><td>9</td><td>10</td><td>11</td><td>12</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">!more ch06\csv_mindex.csv</div><div class="line">parsed = pd.read_csv(<span class="string">'ch06/csv_mindex.csv'</span>, index_col=[<span class="string">'key1'</span>, <span class="string">'key2'</span>])</div><div class="line">parsed</div></pre></td></tr></table></figure><pre><code>key1,key2,value1,value2
one,a,1,2
one,b,3,4
one,c,5,6
one,d,7,8
two,a,9,10
two,b,11,12
two,c,13,14
two,d,15,16
</code></pre><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th></th><th>value1</th><th>value2</th></tr><tr><th>key1</th><th>key2</th><th></th><th></th></tr></thead><tbody><tr><th rowspan="4" valign="top">one</th><th>a</th><td>1</td><td>2</td></tr><tr><th>b</th><td>3</td><td>4</td></tr><tr><th>c</th><td>5</td><td>6</td></tr><tr><th>d</th><td>7</td><td>8</td></tr><tr><th rowspan="4" valign="top">two</th><th>a</th><td>9</td><td>10</td></tr><tr><th>b</th><td>11</td><td>12</td></tr><tr><th>c</th><td>13</td><td>14</td></tr><tr><th>d</th><td>15</td><td>16</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">list(open(<span class="string">'ch06/ex3.txt'</span>))</div></pre></td></tr></table></figure><pre><code>[&#39;            A         B         C\n&#39;,
 &#39;aaa -0.264438 -1.026059 -0.619500\n&#39;,
 &#39;bbb  0.927272  0.302904 -0.032399\n&#39;,
 &#39;ccc -0.264273 -0.386314 -0.217601\n&#39;,
 &#39;ddd -0.871858 -0.348382  1.100491\n&#39;]
</code></pre><p>采用正则表达式作为分隔符</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = pd.read_table(<span class="string">'ch06/ex3.txt'</span>, sep=<span class="string">'\s+'</span>)</div><div class="line">result</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><th>aaa</th><td>-0.264438</td><td>-1.026059</td><td>-0.619500</td></tr><tr><th>bbb</th><td>0.927272</td><td>0.302904</td><td>-0.032399</td></tr><tr><th>ccc</th><td>-0.264273</td><td>-0.386314</td><td>-0.217601</td></tr><tr><th>ddd</th><td>-0.871858</td><td>-0.348382</td><td>1.100491</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">!more ch06\ex4.csv</div><div class="line">pd.read_csv(<span class="string">'ch06/ex4.csv'</span>, skiprows=[<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>])</div></pre></td></tr></table></figure><pre><code># hey!
a,b,c,d,message
# just wanted to make things more difficult for you
# who reads CSV files with computers, anyway?
1,2,3,4,hello
5,6,7,8,world
9,10,11,12,foo
</code></pre><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th><th>message</th></tr></thead><tbody><tr><th>0</th><td>1</td><td>2</td><td>3</td><td>4</td><td>hello</td></tr><tr><th>1</th><td>5</td><td>6</td><td>7</td><td>8</td><td>world</td></tr><tr><th>2</th><td>9</td><td>10</td><td>11</td><td>12</td><td>foo</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">!more ch06\ex5.csv</div><div class="line">result = pd.read_csv(<span class="string">'ch06/ex5.csv'</span>)</div><div class="line">result</div><div class="line">pd.isnull(result)</div></pre></td></tr></table></figure><pre><code>something,a,b,c,d,message
one,1,2,3,4,NA
two,5,6,,8,world
three,9,10,11,12,foo
</code></pre><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>something</th><th>a</th><th>b</th><th>c</th><th>d</th><th>message</th></tr></thead><tbody><tr><th>0</th><td>one</td><td>1</td><td>2</td><td>3.0</td><td>4</td><td>NaN</td></tr><tr><th>1</th><td>two</td><td>5</td><td>6</td><td>NaN</td><td>8</td><td>world</td></tr><tr><th>2</th><td>three</td><td>9</td><td>10</td><td>11.0</td><td>12</td><td>foo</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>something</th><th>a</th><th>b</th><th>c</th><th>d</th><th>message</th></tr></thead><tbody><tr><th>0</th><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>True</td></tr><tr><th>1</th><td>False</td><td>False</td><td>False</td><td>True</td><td>False</td><td>False</td></tr><tr><th>2</th><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td><td>False</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = pd.read_csv(<span class="string">'ch06/ex5.csv'</span>, na_values=[<span class="string">'NULL'</span>])</div><div class="line">result</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>something</th><th>a</th><th>b</th><th>c</th><th>d</th><th>message</th></tr></thead><tbody><tr><th>0</th><td>one</td><td>1</td><td>2</td><td>3.0</td><td>4</td><td>NaN</td></tr><tr><th>1</th><td>two</td><td>5</td><td>6</td><td>NaN</td><td>8</td><td>world</td></tr><tr><th>2</th><td>three</td><td>9</td><td>10</td><td>11.0</td><td>12</td><td>foo</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sentinels = &#123;<span class="string">'message'</span>: [<span class="string">'foo'</span>, <span class="string">'NA'</span>], <span class="string">'something'</span>: [<span class="string">'two'</span>]&#125;</div><div class="line">pd.read_csv(<span class="string">'ch06/ex5.csv'</span>, na_values=sentinels)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>something</th><th>a</th><th>b</th><th>c</th><th>d</th><th>message</th></tr></thead><tbody><tr><th>0</th><td>one</td><td>1</td><td>2</td><td>3.0</td><td>4</td><td>NaN</td></tr><tr><th>1</th><td>NaN</td><td>5</td><td>6</td><td>NaN</td><td>8</td><td>world</td></tr><tr><th>2</th><td>three</td><td>9</td><td>10</td><td>11.0</td><td>12</td><td>NaN</td></tr></tbody></table></div><h3 id="逐块读取文本文件"><a href="#逐块读取文本文件" class="headerlink" title="逐块读取文本文件"></a>逐块读取文本文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = pd.read_csv(<span class="string">'ch06/ex6.csv'</span>)</div><div class="line">result</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th><th>four</th><th>key</th></tr></thead><tbody><tr><th>0</th><td>0.467976</td><td>-0.038649</td><td>-0.295344</td><td>-1.824726</td><td>L</td></tr><tr><th>1</th><td>-0.358893</td><td>1.404453</td><td>0.704965</td><td>-0.200638</td><td>B</td></tr><tr><th>2</th><td>-0.501840</td><td>0.659254</td><td>-0.421691</td><td>-0.057688</td><td>G</td></tr><tr><th>3</th><td>0.204886</td><td>1.074134</td><td>1.388361</td><td>-0.982404</td><td>R</td></tr><tr><th>4</th><td>0.354628</td><td>-0.133116</td><td>0.283763</td><td>-0.837063</td><td>Q</td></tr><tr><th>5</th><td>1.817480</td><td>0.742273</td><td>0.419395</td><td>-2.251035</td><td>Q</td></tr><tr><th>6</th><td>-0.776764</td><td>0.935518</td><td>-0.332872</td><td>-1.875641</td><td>U</td></tr><tr><th>7</th><td>-0.913135</td><td>1.530624</td><td>-0.572657</td><td>0.477252</td><td>K</td></tr><tr><th>8</th><td>0.358480</td><td>-0.497572</td><td>-0.367016</td><td>0.507702</td><td>S</td></tr><tr><th>9</th><td>-1.740877</td><td>-1.160417</td><td>-1.637830</td><td>2.172201</td><td>G</td></tr><tr><th>10</th><td>0.240564</td><td>-0.328249</td><td>1.252155</td><td>1.072796</td><td>8</td></tr><tr><th>11</th><td>0.764018</td><td>1.165476</td><td>-0.639544</td><td>1.495258</td><td>R</td></tr><tr><th>12</th><td>0.571035</td><td>-0.310537</td><td>0.582437</td><td>-0.298765</td><td>1</td></tr><tr><th>13</th><td>2.317658</td><td>0.430710</td><td>-1.334216</td><td>0.199679</td><td>P</td></tr><tr><th>14</th><td>1.547771</td><td>-1.119753</td><td>-2.277634</td><td>0.329586</td><td>J</td></tr><tr><th>15</th><td>-1.310608</td><td>0.401719</td><td>-1.000987</td><td>1.156708</td><td>E</td></tr><tr><th>16</th><td>-0.088496</td><td>0.634712</td><td>0.153324</td><td>0.415335</td><td>B</td></tr><tr><th>17</th><td>-0.018663</td><td>-0.247487</td><td>-1.446522</td><td>0.750938</td><td>A</td></tr><tr><th>18</th><td>-0.070127</td><td>-1.579097</td><td>0.120892</td><td>0.671432</td><td>F</td></tr><tr><th>19</th><td>-0.194678</td><td>-0.492039</td><td>2.359605</td><td>0.319810</td><td>H</td></tr><tr><th>20</th><td>-0.248618</td><td>0.868707</td><td>-0.492226</td><td>-0.717959</td><td>W</td></tr><tr><th>21</th><td>-1.091549</td><td>-0.867110</td><td>-0.647760</td><td>-0.832562</td><td>C</td></tr><tr><th>22</th><td>0.641404</td><td>-0.138822</td><td>-0.621963</td><td>-0.284839</td><td>C</td></tr><tr><th>23</th><td>1.216408</td><td>0.992687</td><td>0.165162</td><td>-0.069619</td><td>V</td></tr><tr><th>24</th><td>-0.564474</td><td>0.792832</td><td>0.747053</td><td>0.571675</td><td>I</td></tr><tr><th>25</th><td>1.759879</td><td>-0.515666</td><td>-0.230481</td><td>1.362317</td><td>S</td></tr><tr><th>26</th><td>0.126266</td><td>0.309281</td><td>0.382820</td><td>-0.239199</td><td>L</td></tr><tr><th>27</th><td>1.334360</td><td>-0.100152</td><td>-0.840731</td><td>-0.643967</td><td>6</td></tr><tr><th>28</th><td>-0.737620</td><td>0.278087</td><td>-0.053235</td><td>-0.950972</td><td>J</td></tr><tr><th>29</th><td>-1.148486</td><td>-0.986292</td><td>-0.144963</td><td>0.124362</td><td>Y</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>9970</th><td>0.633495</td><td>-0.186524</td><td>0.927627</td><td>0.143164</td><td>4</td></tr><tr><th>9971</th><td>0.308636</td><td>-0.112857</td><td>0.762842</td><td>-1.072977</td><td>1</td></tr><tr><th>9972</th><td>-1.627051</td><td>-0.978151</td><td>0.154745</td><td>-1.229037</td><td>Z</td></tr><tr><th>9973</th><td>0.314847</td><td>0.097989</td><td>0.199608</td><td>0.955193</td><td>P</td></tr><tr><th>9974</th><td>1.666907</td><td>0.992005</td><td>0.496128</td><td>-0.686391</td><td>S</td></tr><tr><th>9975</th><td>0.010603</td><td>0.708540</td><td>-1.258711</td><td>0.226541</td><td>K</td></tr><tr><th>9976</th><td>0.118693</td><td>-0.714455</td><td>-0.501342</td><td>-0.254764</td><td>K</td></tr><tr><th>9977</th><td>0.302616</td><td>-2.011527</td><td>-0.628085</td><td>0.768827</td><td>H</td></tr><tr><th>9978</th><td>-0.098572</td><td>1.769086</td><td>-0.215027</td><td>-0.053076</td><td>A</td></tr><tr><th>9979</th><td>-0.019058</td><td>1.964994</td><td>0.738538</td><td>-0.883776</td><td>F</td></tr><tr><th>9980</th><td>-0.595349</td><td>0.001781</td><td>-1.423355</td><td>-1.458477</td><td>M</td></tr><tr><th>9981</th><td>1.392170</td><td>-1.396560</td><td>-1.425306</td><td>-0.847535</td><td>H</td></tr><tr><th>9982</th><td>-0.896029</td><td>-0.152287</td><td>1.924483</td><td>0.365184</td><td>6</td></tr><tr><th>9983</th><td>-2.274642</td><td>-0.901874</td><td>1.500352</td><td>0.996541</td><td>N</td></tr><tr><th>9984</th><td>-0.301898</td><td>1.019906</td><td>1.102160</td><td>2.624526</td><td>I</td></tr><tr><th>9985</th><td>-2.548389</td><td>-0.585374</td><td>1.496201</td><td>-0.718815</td><td>D</td></tr><tr><th>9986</th><td>-0.064588</td><td>0.759292</td><td>-1.568415</td><td>-0.420933</td><td>E</td></tr><tr><th>9987</th><td>-0.143365</td><td>-1.111760</td><td>-1.815581</td><td>0.435274</td><td>2</td></tr><tr><th>9988</th><td>-0.070412</td><td>-1.055921</td><td>0.338017</td><td>-0.440763</td><td>X</td></tr><tr><th>9989</th><td>0.649148</td><td>0.994273</td><td>-1.384227</td><td>0.485120</td><td>Q</td></tr><tr><th>9990</th><td>-0.370769</td><td>0.404356</td><td>-1.051628</td><td>-1.050899</td><td>8</td></tr><tr><th>9991</th><td>-0.409980</td><td>0.155627</td><td>-0.818990</td><td>1.277350</td><td>W</td></tr><tr><th>9992</th><td>0.301214</td><td>-1.111203</td><td>0.668258</td><td>0.671922</td><td>A</td></tr><tr><th>9993</th><td>1.821117</td><td>0.416445</td><td>0.173874</td><td>0.505118</td><td>X</td></tr><tr><th>9994</th><td>0.068804</td><td>1.322759</td><td>0.802346</td><td>0.223618</td><td>H</td></tr><tr><th>9995</th><td>2.311896</td><td>-0.417070</td><td>-1.409599</td><td>-0.515821</td><td>L</td></tr><tr><th>9996</th><td>-0.479893</td><td>-0.650419</td><td>0.745152</td><td>-0.646038</td><td>E</td></tr><tr><th>9997</th><td>0.523331</td><td>0.787112</td><td>0.486066</td><td>1.093156</td><td>K</td></tr><tr><th>9998</th><td>-0.362559</td><td>0.598894</td><td>-1.843201</td><td>0.887292</td><td>G</td></tr><tr><th>9999</th><td>-0.096376</td><td>-1.012999</td><td>-0.657431</td><td>-0.573315</td><td>0</td></tr></tbody></table><p>10000 rows × 5 columns</p></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.read_csv(<span class="string">'ch06/ex6.csv'</span>, nrows=<span class="number">5</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th><th>four</th><th>key</th></tr></thead><tbody><tr><th>0</th><td>0.467976</td><td>-0.038649</td><td>-0.295344</td><td>-1.824726</td><td>L</td></tr><tr><th>1</th><td>-0.358893</td><td>1.404453</td><td>0.704965</td><td>-0.200638</td><td>B</td></tr><tr><th>2</th><td>-0.501840</td><td>0.659254</td><td>-0.421691</td><td>-0.057688</td><td>G</td></tr><tr><th>3</th><td>0.204886</td><td>1.074134</td><td>1.388361</td><td>-0.982404</td><td>R</td></tr><tr><th>4</th><td>0.354628</td><td>-0.133116</td><td>0.283763</td><td>-0.837063</td><td>Q</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chunker = pd.read_csv(<span class="string">'ch06/ex6.csv'</span>, chunksize=<span class="number">1000</span>)</div><div class="line">chunker</div></pre></td></tr></table></figure><pre><code>&lt;pandas.io.parsers.TextFileReader at 0x2035229de80&gt;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">chunker = pd.read_csv(<span class="string">'ch06/ex6.csv'</span>, chunksize=<span class="number">1000</span>)</div><div class="line"></div><div class="line">tot = Series([])</div><div class="line"><span class="keyword">for</span> piece <span class="keyword">in</span> chunker:</div><div class="line">    tot = tot.add(piece[<span class="string">'key'</span>].value_counts(), fill_value=<span class="number">0</span>)</div><div class="line"></div><div class="line">tot = tot.sort_values(ascending=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tot[:<span class="number">10</span>]</div></pre></td></tr></table></figure><pre><code>E    368.0
X    364.0
L    346.0
O    343.0
Q    340.0
M    338.0
J    337.0
F    335.0
K    334.0
H    330.0
dtype: float64
</code></pre><h3 id="将数据写出到文本格式"><a href="#将数据写出到文本格式" class="headerlink" title="将数据写出到文本格式"></a>将数据写出到文本格式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data = pd.read_csv(<span class="string">'ch06/ex5.csv'</span>)</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>something</th><th>a</th><th>b</th><th>c</th><th>d</th><th>message</th></tr></thead><tbody><tr><th>0</th><td>one</td><td>1</td><td>2</td><td>3.0</td><td>4</td><td>NaN</td></tr><tr><th>1</th><td>two</td><td>5</td><td>6</td><td>NaN</td><td>8</td><td>world</td></tr><tr><th>2</th><td>three</td><td>9</td><td>10</td><td>11.0</td><td>12</td><td>foo</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data.to_csv(<span class="string">'ch06/out.csv'</span>)</div><div class="line">!more ch06\out.csv</div></pre></td></tr></table></figure><pre><code>,something,a,b,c,d,message
0,one,1,2,3.0,4,
1,two,5,6,,8,world
2,three,9,10,11.0,12,foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.to_csv(sys.stdout, sep=<span class="string">'|'</span>)</div></pre></td></tr></table></figure><pre><code>|something|a|b|c|d|message
0|one|1|2|3.0|4|
1|two|5|6||8|world
2|three|9|10|11.0|12|foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.to_csv(sys.stdout, na_rep=<span class="string">'NULL'</span>)</div></pre></td></tr></table></figure><pre><code>,something,a,b,c,d,message
0,one,1,2,3.0,4,NULL
1,two,5,6,NULL,8,world
2,three,9,10,11.0,12,foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.to_csv(sys.stdout, index=<span class="keyword">False</span>, header=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><pre><code>one,1,2,3.0,4,
two,5,6,,8,world
three,9,10,11.0,12,foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.to_csv(sys.stdout, index=<span class="keyword">False</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div></pre></td></tr></table></figure><pre><code>a,b,c
1,2,3.0
5,6,
9,10,11.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">dates = pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">7</span>)</div><div class="line">dates</div><div class="line">ts = Series(np.arange(<span class="number">7</span>), index=dates)</div><div class="line">ts</div><div class="line">ts.to_csv(<span class="string">'ch06/tseries.csv'</span>)</div><div class="line">!more ch06\tseries.csv</div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&#39;2000-01-01&#39;, &#39;2000-01-02&#39;, &#39;2000-01-03&#39;, &#39;2000-01-04&#39;,
               &#39;2000-01-05&#39;, &#39;2000-01-06&#39;, &#39;2000-01-07&#39;],
              dtype=&#39;datetime64[ns]&#39;, freq=&#39;D&#39;)






2000-01-01    0
2000-01-02    1
2000-01-03    2
2000-01-04    3
2000-01-05    4
2000-01-06    5
2000-01-07    6
Freq: D, dtype: int32



2000-01-01,0
2000-01-02,1
2000-01-03,2
2000-01-04,3
2000-01-05,4
2000-01-06,5
2000-01-07,6
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Series.from_csv(<span class="string">'ch06/tseries.csv'</span>, parse_dates=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><pre><code>2000-01-01    0
2000-01-02    1
2000-01-03    2
2000-01-04    3
2000-01-05    4
2000-01-06    5
2000-01-07    6
dtype: int64
</code></pre><h3 id="手动处理分隔符格式"><a href="#手动处理分隔符格式" class="headerlink" title="手动处理分隔符格式"></a>手动处理分隔符格式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!more ch06\ex7.csv</div></pre></td></tr></table></figure><pre><code>&quot;a&quot;,&quot;b&quot;,&quot;c&quot;
&quot;1&quot;,&quot;2&quot;,&quot;3&quot;
&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> csv</div><div class="line">f = open(<span class="string">'ch06/ex7.csv'</span>)</div><div class="line"></div><div class="line">reader = csv.reader(f)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> line <span class="keyword">in</span> reader:</div><div class="line">    print(line)</div></pre></td></tr></table></figure><pre><code>[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]
[&#39;1&#39;, &#39;2&#39;, &#39;3&#39;]
[&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">lines = list(csv.reader(open(<span class="string">'ch06/ex7.csv'</span>)))</div><div class="line">header, values = lines[<span class="number">0</span>], lines[<span class="number">1</span>:]</div><div class="line"><span class="keyword">for</span> item <span class="keyword">in</span> zip(*values):</div><div class="line">    print(item)</div><div class="line">    </div><div class="line"><span class="keyword">for</span> h, v <span class="keyword">in</span> zip(header, zip(*values)):</div><div class="line">    print(h, v)</div><div class="line"></div><div class="line">data_dict = &#123;h: v <span class="keyword">for</span> h, v <span class="keyword">in</span> zip(header, zip(*values))&#125;</div><div class="line">data_dict</div></pre></td></tr></table></figure><pre><code>(&#39;1&#39;, &#39;1&#39;)
(&#39;2&#39;, &#39;2&#39;)
(&#39;3&#39;, &#39;3&#39;)
a (&#39;1&#39;, &#39;1&#39;)
b (&#39;2&#39;, &#39;2&#39;)
c (&#39;3&#39;, &#39;3&#39;)





{&#39;a&#39;: (&#39;1&#39;, &#39;1&#39;), &#39;b&#39;: (&#39;2&#39;, &#39;2&#39;), &#39;c&#39;: (&#39;3&#39;, &#39;3&#39;)}
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">my_dialect</span><span class="params">(csv.Dialect)</span>:</span></div><div class="line">    lineterminator = <span class="string">'\n'</span></div><div class="line">    delimiter = <span class="string">';'</span></div><div class="line">    quotechar = <span class="string">'"'</span></div><div class="line">    quoting = csv.QUOTE_MINIMAL</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> open(<span class="string">'mydata.csv'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</div><div class="line">    writer = csv.writer(f, dialect=my_dialect)</div><div class="line">    writer.writerow((<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>))</div><div class="line">    writer.writerow((<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>))</div><div class="line">    writer.writerow((<span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>))</div><div class="line">    writer.writerow((<span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>))</div></pre></td></tr></table></figure><pre><code>14






6






6






6
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!more mydata.csv</div></pre></td></tr></table></figure><pre><code>one;two;three
1;2;3
4;5;6
7;8;9
</code></pre><h3 id="JSON数据"><a href="#JSON数据" class="headerlink" title="JSON数据"></a>JSON数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">obj = <span class="string">"""</span></div><div class="line">&#123;"name": "Wes",</div><div class="line"> "places_lived": ["United States", "Spain", "Germany"],</div><div class="line"> "pet": null,</div><div class="line"> "siblings": [&#123;"name": "Scott", "age": 25, "pet": "Zuko"&#125;,</div><div class="line">              &#123;"name": "Katie", "age": 33, "pet": "Cisco"&#125;]</div><div class="line">&#125;</div><div class="line">"""</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> json</div><div class="line">result = json.loads(obj)</div><div class="line">result</div></pre></td></tr></table></figure><pre><code>{&#39;name&#39;: &#39;Wes&#39;,
 &#39;pet&#39;: None,
 &#39;places_lived&#39;: [&#39;United States&#39;, &#39;Spain&#39;, &#39;Germany&#39;],
 &#39;siblings&#39;: [{&#39;age&#39;: 25, &#39;name&#39;: &#39;Scott&#39;, &#39;pet&#39;: &#39;Zuko&#39;},
  {&#39;age&#39;: 33, &#39;name&#39;: &#39;Katie&#39;, &#39;pet&#39;: &#39;Cisco&#39;}]}
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">asjson = json.dumps(result) <span class="comment"># convert to json</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">siblings = DataFrame(result[<span class="string">'siblings'</span>], columns=[<span class="string">'name'</span>, <span class="string">'age'</span>])</div><div class="line">siblings</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>name</th><th>age</th></tr></thead><tbody><tr><th>0</th><td>Scott</td><td>25</td></tr><tr><th>1</th><td>Katie</td><td>33</td></tr></tbody></table></div><h3 id="XML和HTML：-Web信息收集"><a href="#XML和HTML：-Web信息收集" class="headerlink" title="XML和HTML： Web信息收集"></a>XML和HTML： Web信息收集</h3><p><strong>NB. The Yahoo! Finance API has changed and this example no longer works</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> lxml.html <span class="keyword">import</span> parse</div><div class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</div><div class="line"></div><div class="line">parsed = parse(urlopen(<span class="string">'http://finance.yahoo.com/q/op?s=AAPL+Options'</span>))</div><div class="line"></div><div class="line">doc = parsed.getroot()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">links = doc.findall(<span class="string">'.//a'</span>)</div><div class="line">links[<span class="number">15</span>:<span class="number">20</span>]</div></pre></td></tr></table></figure><pre><code>[&lt;Element a at 0x20352cad598&gt;,
 &lt;Element a at 0x20352cad5e8&gt;,
 &lt;Element a at 0x20352cad638&gt;,
 &lt;Element a at 0x20352cad688&gt;,
 &lt;Element a at 0x20352cad6d8&gt;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">lnk = links[<span class="number">28</span>]</div><div class="line">lnk</div><div class="line">lnk.get(<span class="string">'href'</span>)</div><div class="line">lnk.text_content()</div></pre></td></tr></table></figure><pre><code>&lt;Element a at 0x20352cad9a8&gt;






&#39;/quote/NFLX?p=NFLX&#39;






&#39;NFLX&#39;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">urls = [lnk.get(<span class="string">'href'</span>) <span class="keyword">for</span> lnk <span class="keyword">in</span> doc.findall(<span class="string">'.//a'</span>)]</div><div class="line">urls[<span class="number">-10</span>:]</div></pre></td></tr></table></figure><pre><code>[&#39;//finance.yahoo.com/broker-comparison?bypass=true&#39;,
 &#39;https://help.yahoo.com/kb/index?page=content&amp;y=PROD_MAIL_ML&amp;locale=en_US&amp;id=SLN2310&amp;actp=productlink&#39;,
 &#39;http://help.yahoo.com/l/us/yahoo/finance/&#39;,
 &#39;https://yahoo.uservoice.com/forums/382977&#39;,
 &#39;http://info.yahoo.com/privacy/us/yahoo/&#39;,
 &#39;http://info.yahoo.com/relevantads/&#39;,
 &#39;http://info.yahoo.com/legal/us/yahoo/utos/utos-173.html&#39;,
 &#39;http://twitter.com/YahooFinance&#39;,
 &#39;http://facebook.com/yahoofinance&#39;,
 &#39;http://yahoofinance.tumblr.com&#39;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">tables = doc.findall(<span class="string">'.//table'</span>)</div><div class="line">len(tables)</div><div class="line">calls = tables[<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>1
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rows = calls.findall(<span class="string">'.//tr'</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_unpack</span><span class="params">(row, kind=<span class="string">'td'</span>)</span>:</span></div><div class="line">    elts = row.findall(<span class="string">'.//%s'</span> % kind)</div><div class="line">    <span class="keyword">return</span> [val.text_content() <span class="keyword">for</span> val <span class="keyword">in</span> elts]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_unpack(rows[<span class="number">0</span>], kind=<span class="string">'th'</span>)</div><div class="line">_unpack(rows[<span class="number">1</span>], kind=<span class="string">'td'</span>)</div></pre></td></tr></table></figure><pre><code>[]




---------------------------------------------------------------------------

IndexError                                Traceback (most recent call last)

&lt;ipython-input-87-7d371ed47023&gt; in &lt;module&gt;()
      1 _unpack(rows[0], kind=&#39;th&#39;)
----&gt; 2 _unpack(rows[1], kind=&#39;td&#39;)


IndexError: list index out of range
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pandas.io.parsers <span class="keyword">import</span> TextParser</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_options_data</span><span class="params">(table)</span>:</span></div><div class="line">    rows = table.findall(<span class="string">'.//tr'</span>)</div><div class="line">    header = _unpack(rows[<span class="number">0</span>], kind=<span class="string">'th'</span>)</div><div class="line">    data = [_unpack(r) <span class="keyword">for</span> r <span class="keyword">in</span> rows[<span class="number">1</span>:]]</div><div class="line">    <span class="keyword">return</span> TextParser(data, names=header).get_chunk()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">call_data = parse_options_data(calls)</div><div class="line">put_data = parse_options_data(puts)</div><div class="line">call_data[:<span class="number">10</span>]</div></pre></td></tr></table></figure><h4 id="Parsing-XML-with-lxml-objectify"><a href="#Parsing-XML-with-lxml-objectify" class="headerlink" title="Parsing XML with lxml.objectify"></a>Parsing XML with lxml.objectify</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> objectify</div><div class="line"></div><div class="line">path = <span class="string">'.\ch06\mta_perf\Performance_MNR.xml'</span></div><div class="line">parsed = objectify.parse(open(path))</div><div class="line">root = parsed.getroot()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">data = []</div><div class="line"></div><div class="line">skip_fields = [<span class="string">'PARENT_SEQ'</span>, <span class="string">'INDICATOR_SEQ'</span>,</div><div class="line">               <span class="string">'DESIRED_CHANGE'</span>, <span class="string">'DECIMAL_PLACES'</span>]</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">for</span> elt <span class="keyword">in</span> root.INDICATOR:</div><div class="line">    el_data = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> child <span class="keyword">in</span> elt.getchildren():</div><div class="line">        <span class="keyword">if</span> child.tag <span class="keyword">in</span> skip_fields:</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        el_data[child.tag] = child.pyval</div><div class="line">    data.append(el_data)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">perf = DataFrame(data)</div><div class="line">perf.ix[:<span class="number">10</span>, <span class="number">5</span>:]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>INDICATOR_UNIT</th><th>MONTHLY_ACTUAL</th><th>MONTHLY_TARGET</th><th>PERIOD_MONTH</th><th>PERIOD_YEAR</th><th>YTD_ACTUAL</th><th>YTD_TARGET</th></tr></thead><tbody><tr><th>0</th><td>%</td><td>96.9</td><td>95</td><td>1</td><td>2008</td><td>96.9</td><td>95</td></tr><tr><th>1</th><td>%</td><td>95</td><td>95</td><td>2</td><td>2008</td><td>96</td><td>95</td></tr><tr><th>2</th><td>%</td><td>96.9</td><td>95</td><td>3</td><td>2008</td><td>96.3</td><td>95</td></tr><tr><th>3</th><td>%</td><td>98.3</td><td>95</td><td>4</td><td>2008</td><td>96.8</td><td>95</td></tr><tr><th>4</th><td>%</td><td>95.8</td><td>95</td><td>5</td><td>2008</td><td>96.6</td><td>95</td></tr><tr><th>5</th><td>%</td><td>94.4</td><td>95</td><td>6</td><td>2008</td><td>96.2</td><td>95</td></tr><tr><th>6</th><td>%</td><td>96</td><td>95</td><td>7</td><td>2008</td><td>96.2</td><td>95</td></tr><tr><th>7</th><td>%</td><td>96.4</td><td>95</td><td>8</td><td>2008</td><td>96.2</td><td>95</td></tr><tr><th>8</th><td>%</td><td>93.7</td><td>95</td><td>9</td><td>2008</td><td>95.9</td><td>95</td></tr><tr><th>9</th><td>%</td><td>96.4</td><td>95</td><td>10</td><td>2008</td><td>96</td><td>95</td></tr><tr><th>10</th><td>%</td><td>96.9</td><td>95</td><td>11</td><td>2008</td><td>96.1</td><td>95</td></tr></tbody></table></div><h2 id="二进制数据格式"><a href="#二进制数据格式" class="headerlink" title="二进制数据格式"></a>二进制数据格式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame = pd.read_csv(<span class="string">'ch06/ex1.csv'</span>)</div><div class="line">frame</div><div class="line">frame.to_pickle(<span class="string">'ch06/frame_pickle'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th><th>message</th></tr></thead><tbody><tr><th>0</th><td>1</td><td>2</td><td>3</td><td>4</td><td>hello</td></tr><tr><th>1</th><td>5</td><td>6</td><td>7</td><td>8</td><td>world</td></tr><tr><th>2</th><td>9</td><td>10</td><td>11</td><td>12</td><td>foo</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.read_pickle(<span class="string">'ch06/frame_pickle'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th><th>message</th></tr></thead><tbody><tr><th>0</th><td>1</td><td>2</td><td>3</td><td>4</td><td>hello</td></tr><tr><th>1</th><td>5</td><td>6</td><td>7</td><td>8</td><td>world</td></tr><tr><th>2</th><td>9</td><td>10</td><td>11</td><td>12</td><td>foo</td></tr></tbody></table></div><h3 id="使用HDF5格式"><a href="#使用HDF5格式" class="headerlink" title="使用HDF5格式"></a>使用HDF5格式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">store = pd.HDFStore(<span class="string">'mydata.h5'</span>)</div><div class="line">store[<span class="string">'obj1'</span>] = frame</div><div class="line">store[<span class="string">'obj1_col'</span>] = frame[<span class="string">'a'</span>]</div><div class="line">store</div></pre></td></tr></table></figure><pre><code>&lt;class &#39;pandas.io.pytables.HDFStore&#39;&gt;
File path: mydata.h5
/obj1                frame        (shape-&gt;[3,5])
/obj1_col            series       (shape-&gt;[3])  
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">store[<span class="string">'obj1'</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th><th>message</th></tr></thead><tbody><tr><th>0</th><td>1</td><td>2</td><td>3</td><td>4</td><td>hello</td></tr><tr><th>1</th><td>5</td><td>6</td><td>7</td><td>8</td><td>world</td></tr><tr><th>2</th><td>9</td><td>10</td><td>11</td><td>12</td><td>foo</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">store.close()</div><div class="line">os.remove(<span class="string">'mydata.h5'</span>)</div></pre></td></tr></table></figure><h2 id="使用数据库"><a href="#使用数据库" class="headerlink" title="使用数据库"></a>使用数据库</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sqlite3</div><div class="line"></div><div class="line">query = <span class="string">"""</span></div><div class="line">CREATE TABLE test</div><div class="line">(a VARCHAR(20), b VARCHAR(20),</div><div class="line"> c REAL,        d INTEGER</div><div class="line">);"""</div><div class="line"></div><div class="line">con = sqlite3.connect(<span class="string">':memory:'</span>)</div><div class="line">con.execute(query)</div><div class="line">con.commit()</div></pre></td></tr></table></figure><pre><code>&lt;sqlite3.Cursor at 0x2035487c880&gt;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">data = [(<span class="string">'Atlanta'</span>, <span class="string">'Georgia'</span>, <span class="number">1.25</span>, <span class="number">6</span>),</div><div class="line">        (<span class="string">'Tallahassee'</span>, <span class="string">'Florida'</span>, <span class="number">2.6</span>, <span class="number">3</span>),</div><div class="line">        (<span class="string">'Sacramento'</span>, <span class="string">'California'</span>, <span class="number">1.7</span>, <span class="number">5</span>)]</div><div class="line">stmt = <span class="string">"INSERT INTO test VALUES(?, ?, ?, ?)"</span></div><div class="line"></div><div class="line">con.executemany(stmt, data)</div><div class="line">con.commit()</div></pre></td></tr></table></figure><pre><code>&lt;sqlite3.Cursor at 0x2035487c810&gt;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cursor = con.execute(<span class="string">'select * from test'</span>)</div><div class="line">rows = cursor.fetchall()</div><div class="line">rows</div></pre></td></tr></table></figure><pre><code>[(&#39;Atlanta&#39;, &#39;Georgia&#39;, 1.25, 6),
 (&#39;Tallahassee&#39;, &#39;Florida&#39;, 2.6, 3),
 (&#39;Sacramento&#39;, &#39;California&#39;, 1.7, 5)]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas.io.sql <span class="keyword">as</span> sql</div><div class="line">sql.read_sql(<span class="string">'select * from test'</span>, con)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th></tr></thead><tbody><tr><th>0</th><td>Atlanta</td><td>Georgia</td><td>1.25</td><td>6</td></tr><tr><th>1</th><td>Tallahassee</td><td>Florida</td><td>2.60</td><td>3</td></tr><tr><th>2</th><td>Sacramento</td><td>California</td><td>1.70</td><td>5</td></tr></tbody></table></div>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Data-loading-storage-and-file-formats&quot;&gt;&lt;a href=&quot;#Data-loading-storage-and-file-formats&quot; class=&quot;headerlink&quot; title=&quot;Data loading, stor
    
    </summary>
    
    
      <category term="Python" scheme="http://yoursite.com/tags/Python/"/>
    
      <category term="pandas" scheme="http://yoursite.com/tags/pandas/"/>
    
  </entry>
  
  <entry>
    <title>Python data analysis Learning note ch05</title>
    <link href="http://yoursite.com/2017/02/28/Python-data-analysis-Learning-note-ch05/"/>
    <id>http://yoursite.com/2017/02/28/Python-data-analysis-Learning-note-ch05/</id>
    <published>2017-02-28T10:05:03.000Z</published>
    <updated>2017-02-28T10:13:59.572Z</updated>
    
    <content type="html"><![CDATA[<h1 id="pandas入门"><a href="#pandas入门" class="headerlink" title="pandas入门"></a>pandas入门</h1><p>按照以下约定引用相关package</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">np.random.seed(<span class="number">12345</span>)</div><div class="line">plt.rc(<span class="string">'figure'</span>, figsize=(<span class="number">10</span>, <span class="number">6</span>))</div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">np.set_printoptions(precision=<span class="number">4</span>)</div><div class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</div><div class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></div></pre></td></tr></table></figure><h2 id="pandas数据结构介绍"><a href="#pandas数据结构介绍" class="headerlink" title="pandas数据结构介绍"></a>pandas数据结构介绍</h2><h3 id="Series"><a href="#Series" class="headerlink" title="Series"></a>Series</h3><p>Series是一种类似于一维数组的对象，由一组数据以及一组与之相关的数据标签（类似于字典的键）组成，所以可以看成是一个<strong>有序</strong>的字典</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">4</span>, <span class="number">7</span>, <span class="number">-5</span>, <span class="number">3</span>])</div><div class="line">obj</div></pre></td></tr></table></figure><pre><code>0    4
1    7
2   -5
3    3
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj.values</div><div class="line">obj.index</div></pre></td></tr></table></figure><pre><code>array([ 4,  7, -5,  3], dtype=int64)






RangeIndex(start=0, stop=4, step=1)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj2 = Series([<span class="number">4</span>, <span class="number">7</span>, <span class="number">-5</span>, <span class="number">3</span>], index=[<span class="string">'d'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>])</div><div class="line">obj2</div></pre></td></tr></table></figure><pre><code>d    4
b    7
a   -5
c    3
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj2.index</div></pre></td></tr></table></figure><pre><code>Index([&#39;d&#39;, &#39;b&#39;, &#39;a&#39;, &#39;c&#39;], dtype=&#39;object&#39;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj2[<span class="string">'a'</span>]</div></pre></td></tr></table></figure><pre><code>-5
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj2[<span class="string">'d'</span>] = <span class="number">6</span></div><div class="line">obj2[[<span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]]</div></pre></td></tr></table></figure><pre><code>c    3
a   -5
d    6
dtype: int64
</code></pre><p>各种Numpy运算都是作用在数据上，同时索引与数据的链接会一直保持</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj2[obj2 &gt; <span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>d    6
b    7
c    3
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj2 * <span class="number">2</span></div></pre></td></tr></table></figure><pre><code>d    12
b    14
a   -10
c     6
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.exp(obj2)</div></pre></td></tr></table></figure><pre><code>d     403.428793
b    1096.633158
a       0.006738
c      20.085537
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">'b'</span> <span class="keyword">in</span> obj2</div></pre></td></tr></table></figure><pre><code>True
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">'e'</span> <span class="keyword">in</span> obj2</div></pre></td></tr></table></figure><pre><code>False
</code></pre><p>因此可以直接根据Numpy的Dict来创建Series</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sdata = &#123;<span class="string">'Ohio'</span>: <span class="number">35000</span>, <span class="string">'Texas'</span>: <span class="number">71000</span>, <span class="string">'Oregon'</span>: <span class="number">16000</span>, <span class="string">'Utah'</span>: <span class="number">5000</span>&#125;</div><div class="line">obj3 = Series(sdata)</div><div class="line">obj3</div></pre></td></tr></table></figure><pre><code>Ohio      35000
Oregon    16000
Texas     71000
Utah       5000
dtype: int64
</code></pre><p>如果传入了index参数的话，那么就会与传入的Dict做键匹配，没有匹配上的就设为NaN</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">states = [<span class="string">'California'</span>, <span class="string">'Ohio'</span>, <span class="string">'Oregon'</span>, <span class="string">'Texas'</span>]</div><div class="line">obj4 = Series(sdata, index=states)</div><div class="line">obj4</div></pre></td></tr></table></figure><pre><code>California        NaN
Ohio          35000.0
Oregon        16000.0
Texas         71000.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.isnull(obj4)</div></pre></td></tr></table></figure><pre><code>California     True
Ohio          False
Oregon        False
Texas         False
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.notnull(obj4)</div></pre></td></tr></table></figure><pre><code>California    False
Ohio           True
Oregon         True
Texas          True
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj4.isnull()</div></pre></td></tr></table></figure><pre><code>California     True
Ohio          False
Oregon        False
Texas         False
dtype: bool
</code></pre><p>Series有一个非常重要的数据对齐的功能</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj3</div></pre></td></tr></table></figure><pre><code>Ohio      35000
Oregon    16000
Texas     71000
Utah       5000
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj4</div></pre></td></tr></table></figure><pre><code>California        NaN
Ohio          35000.0
Oregon        16000.0
Texas         71000.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj3 + obj4</div></pre></td></tr></table></figure><pre><code>California         NaN
Ohio           70000.0
Oregon         32000.0
Texas         142000.0
Utah               NaN
dtype: float64
</code></pre><p>Series本身以及其索引都有一个叫做name的属性，这个属性十分重要，以后很多高级功能都会用到</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">obj4.name = <span class="string">'population'</span></div><div class="line">obj4.index.name = <span class="string">'state'</span></div><div class="line">obj4</div></pre></td></tr></table></figure><pre><code>state
California        NaN
Ohio          35000.0
Oregon        16000.0
Texas         71000.0
Name: population, dtype: float64
</code></pre><p>可以通过直接赋值的方式修改index属性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj.index = [<span class="string">'Bob'</span>, <span class="string">'Steve'</span>, <span class="string">'Jeff'</span>, <span class="string">'Ryan'</span>]</div><div class="line">obj</div></pre></td></tr></table></figure><pre><code>Bob      4
Steve    7
Jeff    -5
Ryan     3
dtype: int64
</code></pre><h3 id="DataFrame"><a href="#DataFrame" class="headerlink" title="DataFrame"></a>DataFrame</h3><p>DataFrame是一个表格型的数据结构，可以看成由Series组成的字典，只不过这些Series共用一套索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = &#123;<span class="string">'state'</span>: [<span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Nevada'</span>, <span class="string">'Nevada'</span>],</div><div class="line">        <span class="string">'year'</span>: [<span class="number">2000</span>, <span class="number">2001</span>, <span class="number">2002</span>, <span class="number">2001</span>, <span class="number">2002</span>],</div><div class="line">        <span class="string">'pop'</span>: [<span class="number">1.5</span>, <span class="number">1.7</span>, <span class="number">3.6</span>, <span class="number">2.4</span>, <span class="number">2.9</span>]&#125;</div><div class="line">frame = DataFrame(data)</div></pre></td></tr></table></figure><p>数据会被排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>pop</th><th>state</th><th>year</th></tr></thead><tbody><tr><th>0</th><td>1.5</td><td>Ohio</td><td>2000</td></tr><tr><th>1</th><td>1.7</td><td>Ohio</td><td>2001</td></tr><tr><th>2</th><td>3.6</td><td>Ohio</td><td>2002</td></tr><tr><th>3</th><td>2.4</td><td>Nevada</td><td>2001</td></tr><tr><th>4</th><td>2.9</td><td>Nevada</td><td>2002</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">DataFrame(data, columns=[<span class="string">'year'</span>, <span class="string">'state'</span>, <span class="string">'pop'</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>year</th><th>state</th><th>pop</th></tr></thead><tbody><tr><th>0</th><td>2000</td><td>Ohio</td><td>1.5</td></tr><tr><th>1</th><td>2001</td><td>Ohio</td><td>1.7</td></tr><tr><th>2</th><td>2002</td><td>Ohio</td><td>3.6</td></tr><tr><th>3</th><td>2001</td><td>Nevada</td><td>2.4</td></tr><tr><th>4</th><td>2002</td><td>Nevada</td><td>2.9</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame2 = DataFrame(data, columns=[<span class="string">'year'</span>, <span class="string">'state'</span>, <span class="string">'pop'</span>, <span class="string">'debt'</span>],</div><div class="line">                   index=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>, <span class="string">'five'</span>])</div><div class="line">frame2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>year</th><th>state</th><th>pop</th><th>debt</th></tr></thead><tbody><tr><th>one</th><td>2000</td><td>Ohio</td><td>1.5</td><td>NaN</td></tr><tr><th>two</th><td>2001</td><td>Ohio</td><td>1.7</td><td>NaN</td></tr><tr><th>three</th><td>2002</td><td>Ohio</td><td>3.6</td><td>NaN</td></tr><tr><th>four</th><td>2001</td><td>Nevada</td><td>2.4</td><td>NaN</td></tr><tr><th>five</th><td>2002</td><td>Nevada</td><td>2.9</td><td>NaN</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2.columns</div></pre></td></tr></table></figure><pre><code>Index([&#39;year&#39;, &#39;state&#39;, &#39;pop&#39;, &#39;debt&#39;], dtype=&#39;object&#39;)
</code></pre><p>DataFrame每一个Key对应的Value都是一个Series</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2[<span class="string">'state'</span>]</div></pre></td></tr></table></figure><pre><code>one        Ohio
two        Ohio
three      Ohio
four     Nevada
five     Nevada
Name: state, dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2.year</div></pre></td></tr></table></figure><pre><code>one      2000
two      2001
three    2002
four     2001
five     2002
Name: year, dtype: int64
</code></pre><p>注意到name属性也已经被设置好了</p><p>ix相当于一个行索引？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2.ix[<span class="string">'three'</span>]</div></pre></td></tr></table></figure><pre><code>year     2002
state    Ohio
pop       3.6
debt      NaN
Name: three, dtype: object
</code></pre><p>可以利用Numpy的广播功能</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame2[<span class="string">'debt'</span>] = <span class="number">16.5</span></div><div class="line">frame2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>year</th><th>state</th><th>pop</th><th>debt</th></tr></thead><tbody><tr><th>one</th><td>2000</td><td>Ohio</td><td>1.5</td><td>16.5</td></tr><tr><th>two</th><td>2001</td><td>Ohio</td><td>1.7</td><td>16.5</td></tr><tr><th>three</th><td>2002</td><td>Ohio</td><td>3.6</td><td>16.5</td></tr><tr><th>four</th><td>2001</td><td>Nevada</td><td>2.4</td><td>16.5</td></tr><tr><th>five</th><td>2002</td><td>Nevada</td><td>2.9</td><td>16.5</td></tr></tbody></table></div><p>也可以赋值一个列表，但是长度必须匹配</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame2[<span class="string">'debt'</span>] = np.arange(<span class="number">5.</span>)</div><div class="line">frame2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>year</th><th>state</th><th>pop</th><th>debt</th></tr></thead><tbody><tr><th>one</th><td>2000</td><td>Ohio</td><td>1.5</td><td>0.0</td></tr><tr><th>two</th><td>2001</td><td>Ohio</td><td>1.7</td><td>1.0</td></tr><tr><th>three</th><td>2002</td><td>Ohio</td><td>3.6</td><td>2.0</td></tr><tr><th>four</th><td>2001</td><td>Nevada</td><td>2.4</td><td>3.0</td></tr><tr><th>five</th><td>2002</td><td>Nevada</td><td>2.9</td><td>4.0</td></tr></tbody></table></div><p>如果是赋值一个Series，则会匹配上索引，没有匹配上的就是置为NaN</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">val = Series([<span class="number">-1.2</span>, <span class="number">-1.5</span>, <span class="number">-1.7</span>], index=[<span class="string">'two'</span>, <span class="string">'four'</span>, <span class="string">'five'</span>])</div><div class="line">frame2[<span class="string">'debt'</span>] = val</div><div class="line">frame2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>year</th><th>state</th><th>pop</th><th>debt</th></tr></thead><tbody><tr><th>one</th><td>2000</td><td>Ohio</td><td>1.5</td><td>NaN</td></tr><tr><th>two</th><td>2001</td><td>Ohio</td><td>1.7</td><td>-1.2</td></tr><tr><th>three</th><td>2002</td><td>Ohio</td><td>3.6</td><td>NaN</td></tr><tr><th>four</th><td>2001</td><td>Nevada</td><td>2.4</td><td>-1.5</td></tr><tr><th>five</th><td>2002</td><td>Nevada</td><td>2.9</td><td>-1.7</td></tr></tbody></table></div><p>也可以进行逻辑操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame2[<span class="string">'eastern'</span>] = frame2.state == <span class="string">'Ohio'</span></div><div class="line">frame2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>year</th><th>state</th><th>pop</th><th>debt</th><th>eastern</th></tr></thead><tbody><tr><th>one</th><td>2000</td><td>Ohio</td><td>1.5</td><td>NaN</td><td>True</td></tr><tr><th>two</th><td>2001</td><td>Ohio</td><td>1.7</td><td>-1.2</td><td>True</td></tr><tr><th>three</th><td>2002</td><td>Ohio</td><td>3.6</td><td>NaN</td><td>True</td></tr><tr><th>four</th><td>2001</td><td>Nevada</td><td>2.4</td><td>-1.5</td><td>False</td></tr><tr><th>five</th><td>2002</td><td>Nevada</td><td>2.9</td><td>-1.7</td><td>False</td></tr></tbody></table></div><p>del用于删除一列</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">del</span> frame2[<span class="string">'eastern'</span>]</div><div class="line">frame2.columns</div></pre></td></tr></table></figure><pre><code>Index([&#39;year&#39;, &#39;state&#39;, &#39;pop&#39;, &#39;debt&#39;], dtype=&#39;object&#39;)
</code></pre><p><strong>只要是通过索引方式进行的操作，都是直接在原数据上进行的操作，不是一个副本</strong></p><p>嵌套的字典也可直接生成DataFrame，只不过内层的键被当作index，外层的键被当作colums</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pop = &#123;<span class="string">'Nevada'</span>: &#123;<span class="number">2001</span>: <span class="number">2.4</span>, <span class="number">2002</span>: <span class="number">2.9</span>&#125;,</div><div class="line">       <span class="string">'Ohio'</span>: &#123;<span class="number">2000</span>: <span class="number">1.5</span>, <span class="number">2001</span>: <span class="number">1.7</span>, <span class="number">2002</span>: <span class="number">3.6</span>&#125;&#125;</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame3 = DataFrame(pop)</div><div class="line">frame3</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Nevada</th><th>Ohio</th></tr></thead><tbody><tr><th>2000</th><td>NaN</td><td>1.5</td></tr><tr><th>2001</th><td>2.4</td><td>1.7</td></tr><tr><th>2002</th><td>2.9</td><td>3.6</td></tr></tbody></table></div><p>同样可以进行转置，这样的话index和column就会互换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame3.T</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>2000</th><th>2001</th><th>2002</th></tr></thead><tbody><tr><th>Nevada</th><td>NaN</td><td>2.4</td><td>2.9</td></tr><tr><th>Ohio</th><td>1.5</td><td>1.7</td><td>3.6</td></tr></tbody></table></div><p>显式地指定索引，不匹配的会置为NaN</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">DataFrame(pop, index=[<span class="number">2001</span>, <span class="number">2002</span>, <span class="number">2003</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Nevada</th><th>Ohio</th></tr></thead><tbody><tr><th>2001</th><td>2.4</td><td>1.7</td></tr><tr><th>2002</th><td>2.9</td><td>3.6</td></tr><tr><th>2003</th><td>NaN</td><td>NaN</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame3</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Nevada</th><th>Ohio</th></tr></thead><tbody><tr><th>2000</th><td>NaN</td><td>1.5</td></tr><tr><th>2001</th><td>2.4</td><td>1.7</td></tr><tr><th>2002</th><td>2.9</td><td>3.6</td></tr></tbody></table></div><p>还可以这样构建</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pdata = &#123;<span class="string">'Ohio'</span>: frame3[<span class="string">'Ohio'</span>][:<span class="number">-1</span>],</div><div class="line">         <span class="string">'Nevada'</span>: frame3[<span class="string">'Nevada'</span>][:<span class="number">2</span>]&#125;</div><div class="line">DataFrame(pdata)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Nevada</th><th>Ohio</th></tr></thead><tbody><tr><th>2000</th><td>NaN</td><td>1.5</td></tr><tr><th>2001</th><td>2.4</td><td>1.7</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame3</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Nevada</th><th>Ohio</th></tr></thead><tbody><tr><th>2000</th><td>NaN</td><td>1.5</td></tr><tr><th>2001</th><td>2.4</td><td>1.7</td></tr><tr><th>2002</th><td>2.9</td><td>3.6</td></tr></tbody></table></div><p>name属性也会在表格中显示出来</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame3.index.name = <span class="string">'year'</span>; frame3.columns.name = <span class="string">'state'</span></div><div class="line">frame3</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>state</th><th>Nevada</th><th>Ohio</th></tr><tr><th>year</th><th></th><th></th></tr></thead><tbody><tr><th>2000</th><td>NaN</td><td>1.5</td></tr><tr><th>2001</th><td>2.4</td><td>1.7</td></tr><tr><th>2002</th><td>2.9</td><td>3.6</td></tr></tbody></table></div><p>values方法只返回数据，不返回index以及key</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame3.values</div></pre></td></tr></table></figure><pre><code>array([[ nan,  1.5],
       [ 2.4,  1.7],
       [ 2.9,  3.6]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>year</th><th>state</th><th>pop</th><th>debt</th></tr></thead><tbody><tr><th>one</th><td>2000</td><td>Ohio</td><td>1.5</td><td>NaN</td></tr><tr><th>two</th><td>2001</td><td>Ohio</td><td>1.7</td><td>-1.2</td></tr><tr><th>three</th><td>2002</td><td>Ohio</td><td>3.6</td><td>NaN</td></tr><tr><th>four</th><td>2001</td><td>Nevada</td><td>2.4</td><td>-1.5</td></tr><tr><th>five</th><td>2002</td><td>Nevada</td><td>2.9</td><td>-1.7</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2.values</div></pre></td></tr></table></figure><pre><code>array([[2000, &#39;Ohio&#39;, 1.5, nan],
       [2001, &#39;Ohio&#39;, 1.7, -1.2],
       [2002, &#39;Ohio&#39;, 3.6, nan],
       [2001, &#39;Nevada&#39;, 2.4, -1.5],
       [2002, &#39;Nevada&#39;, 2.9, -1.7]], dtype=object)
</code></pre><h3 id="索引对象"><a href="#索引对象" class="headerlink" title="索引对象"></a>索引对象</h3><p>Index是一个可以单独提取出来的对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">obj = Series(range(<span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">index = obj.index</div><div class="line">index</div></pre></td></tr></table></figure><pre><code>Index([&#39;a&#39;, &#39;b&#39;, &#39;c&#39;], dtype=&#39;object&#39;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">index[<span class="number">1</span>:]</div></pre></td></tr></table></figure><pre><code>Index([&#39;b&#39;, &#39;c&#39;], dtype=&#39;object&#39;)
</code></pre><p>不可修改~！</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">index[<span class="number">1</span>] = <span class="string">'d'</span></div></pre></td></tr></table></figure><pre><code>---------------------------------------------------------------------------

TypeError                                 Traceback (most recent call last)

&lt;ipython-input-52-676fdeb26a68&gt; in &lt;module&gt;()
----&gt; 1 index[1] = &#39;d&#39;


C:\Users\Ewan\Anaconda3\lib\site-packages\pandas\indexes\base.py in __setitem__(self, key, value)
   1243 
   1244     def __setitem__(self, key, value):
-&gt; 1245         raise TypeError(&quot;Index does not support mutable operations&quot;)
   1246 
   1247     def __getitem__(self, key):


TypeError: Index does not support mutable operations
</code></pre><p>直接创建Index对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">index = pd.Index(np.arange(<span class="number">3</span>))</div><div class="line">obj2 = Series([<span class="number">1.5</span>, <span class="number">-2.5</span>, <span class="number">0</span>], index=index)</div><div class="line">obj2.index <span class="keyword">is</span> index</div></pre></td></tr></table></figure><pre><code>True
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame3</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>state</th><th>Nevada</th><th>Ohio</th></tr><tr><th>year</th><th></th><th></th></tr></thead><tbody><tr><th>2000</th><td>NaN</td><td>1.5</td></tr><tr><th>2001</th><td>2.4</td><td>1.7</td></tr><tr><th>2002</th><td>2.9</td><td>3.6</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">'Ohio'</span> <span class="keyword">in</span> frame3.columns</div></pre></td></tr></table></figure><pre><code>True
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="number">2003</span> <span class="keyword">in</span> frame3.index</div></pre></td></tr></table></figure><pre><code>False
</code></pre><h2 id="基本功能"><a href="#基本功能" class="headerlink" title="基本功能"></a>基本功能</h2><h3 id="重新索引"><a href="#重新索引" class="headerlink" title="重新索引"></a>重新索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">4.5</span>, <span class="number">7.2</span>, <span class="number">-5.3</span>, <span class="number">3.6</span>], index=[<span class="string">'d'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>])</div><div class="line">obj</div></pre></td></tr></table></figure><pre><code>d    4.5
b    7.2
a   -5.3
c    3.6
dtype: float64
</code></pre><p>重排索引形成新对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj2 = obj.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">obj2</div></pre></td></tr></table></figure><pre><code>a   -5.3
b    7.2
c    3.6
d    4.5
e    NaN
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>], fill_value=<span class="number">0</span>)</div></pre></td></tr></table></figure><pre><code>a   -5.3
b    7.2
c    3.6
d    4.5
e    0.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj3 = Series([<span class="string">'blue'</span>, <span class="string">'purple'</span>, <span class="string">'yellow'</span>], index=[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>])</div><div class="line">obj3.reindex(range(<span class="number">6</span>), method=<span class="string">'ffill'</span>) <span class="comment"># 前向填充</span></div></pre></td></tr></table></figure><pre><code>0      blue
1      blue
2    purple
3    purple
4    yellow
5    yellow
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">9</span>).reshape((<span class="number">3</span>, <span class="number">3</span>)), index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>],</div><div class="line">                  columns=[<span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'California'</span>])</div><div class="line">frame</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Ohio</th><th>Texas</th><th>California</th></tr></thead><tbody><tr><th>a</th><td>0</td><td>1</td><td>2</td></tr><tr><th>c</th><td>3</td><td>4</td><td>5</td></tr><tr><th>d</th><td>6</td><td>7</td><td>8</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame2 = frame.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">frame2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Ohio</th><th>Texas</th><th>California</th></tr></thead><tbody><tr><th>a</th><td>0.0</td><td>1.0</td><td>2.0</td></tr><tr><th>b</th><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>c</th><td>3.0</td><td>4.0</td><td>5.0</td></tr><tr><th>d</th><td>6.0</td><td>7.0</td><td>8.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">states = [<span class="string">'Texas'</span>, <span class="string">'Utah'</span>, <span class="string">'California'</span>]</div><div class="line">frame.reindex(columns=states)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Texas</th><th>Utah</th><th>California</th></tr></thead><tbody><tr><th>a</th><td>1</td><td>NaN</td><td>2</td></tr><tr><th>c</th><td>4</td><td>NaN</td><td>5</td></tr><tr><th>d</th><td>7</td><td>NaN</td><td>8</td></tr></tbody></table></div><p>插值只能按行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame.reindex(index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], method=<span class="string">'ffill'</span>,</div><div class="line">              columns=states)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Texas</th><th>Utah</th><th>California</th></tr></thead><tbody><tr><th>a</th><td>1</td><td>NaN</td><td>2</td></tr><tr><th>b</th><td>1</td><td>NaN</td><td>2</td></tr><tr><th>c</th><td>4</td><td>NaN</td><td>5</td></tr><tr><th>d</th><td>7</td><td>NaN</td><td>8</td></tr></tbody></table></div><p>用ix方法进行重新索引操作会使得代码很简洁</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.ix[[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], states]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Texas</th><th>Utah</th><th>California</th></tr></thead><tbody><tr><th>a</th><td>1.0</td><td>NaN</td><td>2.0</td></tr><tr><th>b</th><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>c</th><td>4.0</td><td>NaN</td><td>5.0</td></tr><tr><th>d</th><td>7.0</td><td>NaN</td><td>8.0</td></tr></tbody></table></div><h3 id="丢弃指定轴上的项"><a href="#丢弃指定轴上的项" class="headerlink" title="丢弃指定轴上的项"></a>丢弃指定轴上的项</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.ix[[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], states]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Texas</th><th>Utah</th><th>California</th></tr></thead><tbody><tr><th>a</th><td>1.0</td><td>NaN</td><td>2.0</td></tr><tr><th>b</th><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>c</th><td>4.0</td><td>NaN</td><td>5.0</td></tr><tr><th>d</th><td>7.0</td><td>NaN</td><td>8.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">obj = Series(np.arange(<span class="number">5.</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">new_obj = obj.drop(<span class="string">'c'</span>)</div><div class="line">new_obj</div></pre></td></tr></table></figure><pre><code>a    0.0
b    1.0
d    3.0
e    4.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.drop([<span class="string">'d'</span>, <span class="string">'c'</span>])</div></pre></td></tr></table></figure><pre><code>a    0.0
b    1.0
e    4.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(np.arange(<span class="number">16</span>).reshape((<span class="number">4</span>, <span class="number">4</span>)),</div><div class="line">                 index=[<span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>, <span class="string">'Utah'</span>, <span class="string">'New York'</span>],</div><div class="line">                 columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>])</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>Ohio</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>Colorado</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>Utah</th><td>8</td><td>9</td><td>10</td><td>11</td></tr><tr><th>New York</th><td>12</td><td>13</td><td>14</td><td>15</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.drop([<span class="string">'Colorado'</span>, <span class="string">'Ohio'</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>Utah</th><td>8</td><td>9</td><td>10</td><td>11</td></tr><tr><th>New York</th><td>12</td><td>13</td><td>14</td><td>15</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.drop(<span class="string">'two'</span>, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>Ohio</th><td>0</td><td>2</td><td>3</td></tr><tr><th>Colorado</th><td>4</td><td>6</td><td>7</td></tr><tr><th>Utah</th><td>8</td><td>10</td><td>11</td></tr><tr><th>New York</th><td>12</td><td>14</td><td>15</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.drop([<span class="string">'two'</span>, <span class="string">'four'</span>], axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>three</th></tr></thead><tbody><tr><th>Ohio</th><td>0</td><td>2</td></tr><tr><th>Colorado</th><td>4</td><td>6</td></tr><tr><th>Utah</th><td>8</td><td>10</td></tr><tr><th>New York</th><td>12</td><td>14</td></tr></tbody></table></div><h3 id="索引，选取和过滤"><a href="#索引，选取和过滤" class="headerlink" title="索引，选取和过滤"></a>索引，选取和过滤</h3><p>多种索引方式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">obj = Series(np.arange(<span class="number">4.</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">obj</div><div class="line">obj[<span class="string">'b'</span>]</div></pre></td></tr></table></figure><pre><code>a    0.0
b    1.0
c    2.0
d    3.0
dtype: float64






1.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[<span class="number">1</span>]</div></pre></td></tr></table></figure><pre><code>1.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[<span class="number">2</span>:<span class="number">4</span>]</div></pre></td></tr></table></figure><pre><code>c    2.0
d    3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[[<span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]]</div></pre></td></tr></table></figure><pre><code>b    1.0
a    0.0
d    3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[[<span class="number">1</span>, <span class="number">3</span>]]</div></pre></td></tr></table></figure><pre><code>b    1.0
d    3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[obj &lt; <span class="number">2</span>] <span class="comment"># 直接对data进行操作</span></div></pre></td></tr></table></figure><pre><code>a    0.0
b    1.0
dtype: float64
</code></pre><p>这种切片方式…<br>末端包含</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[<span class="string">'b'</span>:<span class="string">'c'</span>]</div></pre></td></tr></table></figure><pre><code>b    1.0
c    2.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj[<span class="string">'b'</span>:<span class="string">'c'</span>] = <span class="number">5</span></div><div class="line">obj</div></pre></td></tr></table></figure><pre><code>a    0.0
b    5.0
c    5.0
d    3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(np.arange(<span class="number">16</span>).reshape((<span class="number">4</span>, <span class="number">4</span>)),</div><div class="line">                 index=[<span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>, <span class="string">'Utah'</span>, <span class="string">'New York'</span>],</div><div class="line">                 columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>])</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>Ohio</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>Colorado</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>Utah</th><td>8</td><td>9</td><td>10</td><td>11</td></tr><tr><th>New York</th><td>12</td><td>13</td><td>14</td><td>15</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'two'</span>]</div></pre></td></tr></table></figure><pre><code>Ohio         1
Colorado     5
Utah         9
New York    13
Name: two, dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[[<span class="string">'three'</span>, <span class="string">'one'</span>]]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>three</th><th>one</th></tr></thead><tbody><tr><th>Ohio</th><td>2</td><td>0</td></tr><tr><th>Colorado</th><td>6</td><td>4</td></tr><tr><th>Utah</th><td>10</td><td>8</td></tr><tr><th>New York</th><td>14</td><td>12</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[:<span class="number">2</span>] <span class="comment"># axis=0</span></div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>Ohio</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>Colorado</th><td>4</td><td>5</td><td>6</td><td>7</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[data[<span class="string">'three'</span>] &gt; <span class="number">5</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>Colorado</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>Utah</th><td>8</td><td>9</td><td>10</td><td>11</td></tr><tr><th>New York</th><td>12</td><td>13</td><td>14</td><td>15</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data &lt; <span class="number">5</span></div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>Ohio</th><td>True</td><td>True</td><td>True</td><td>True</td></tr><tr><th>Colorado</th><td>True</td><td>False</td><td>False</td><td>False</td></tr><tr><th>Utah</th><td>False</td><td>False</td><td>False</td><td>False</td></tr><tr><th>New York</th><td>False</td><td>False</td><td>False</td><td>False</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[data &lt; <span class="number">5</span>] = <span class="number">0</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>Ohio</th><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><th>Colorado</th><td>0</td><td>5</td><td>6</td><td>7</td></tr><tr><th>Utah</th><td>8</td><td>9</td><td>10</td><td>11</td></tr><tr><th>New York</th><td>12</td><td>13</td><td>14</td><td>15</td></tr></tbody></table></div><p>索引的另外一种选择</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[<span class="string">'Colorado'</span>, [<span class="string">'two'</span>, <span class="string">'three'</span>]]</div></pre></td></tr></table></figure><pre><code>two      5
three    6
Name: Colorado, dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[[<span class="string">'Colorado'</span>, <span class="string">'Utah'</span>], [<span class="number">3</span>, <span class="number">0</span>, <span class="number">1</span>]]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>four</th><th>one</th><th>two</th></tr></thead><tbody><tr><th>Colorado</th><td>7</td><td>0</td><td>5</td></tr><tr><th>Utah</th><td>11</td><td>8</td><td>9</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[<span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>one       8
two       9
three    10
four     11
Name: Utah, dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[:<span class="string">'Utah'</span>, <span class="string">'two'</span>]</div></pre></td></tr></table></figure><pre><code>Ohio        0
Colorado    5
Utah        9
Name: two, dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[data.three &gt; <span class="number">5</span>, :<span class="number">3</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th></tr></thead><tbody><tr><th>Colorado</th><td>0</td><td>5</td><td>6</td></tr><tr><th>Utah</th><td>8</td><td>9</td><td>10</td></tr><tr><th>New York</th><td>12</td><td>13</td><td>14</td></tr></tbody></table></div><p>总结一下就是说，DataFrame是一个二维的数组，只不过每一维的索引方式除了序号之外，还可以用name属性来进行索引，且一切行为与序号无异</p><h3 id="算术运算和数据对齐"><a href="#算术运算和数据对齐" class="headerlink" title="算术运算和数据对齐"></a>算术运算和数据对齐</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">s1 = Series([<span class="number">7.3</span>, <span class="number">-2.5</span>, <span class="number">3.4</span>, <span class="number">1.5</span>], index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">s2 = Series([<span class="number">-2.1</span>, <span class="number">3.6</span>, <span class="number">-1.5</span>, <span class="number">4</span>, <span class="number">3.1</span>], index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">s1</div></pre></td></tr></table></figure><pre><code>a    7.3
c   -2.5
d    3.4
e    1.5
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">s2</div></pre></td></tr></table></figure><pre><code>a   -2.1
c    3.6
e   -1.5
f    4.0
g    3.1
dtype: float64
</code></pre><p>数据对齐操作就是一种特殊的并集操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">s1 + s2</div></pre></td></tr></table></figure><pre><code>a    5.2
c    1.1
d    NaN
e    0.0
f    NaN
g    NaN
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(np.arange(<span class="number">9.</span>).reshape((<span class="number">3</span>, <span class="number">3</span>)), columns=list(<span class="string">'bcd'</span>),</div><div class="line">                index=[<span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Colorado'</span>])</div><div class="line">df2 = DataFrame(np.arange(<span class="number">12.</span>).reshape((<span class="number">4</span>, <span class="number">3</span>)), columns=list(<span class="string">'bde'</span>),</div><div class="line">                index=[<span class="string">'Utah'</span>, <span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Oregon'</span>])</div><div class="line">df1</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>b</th><th>c</th><th>d</th></tr></thead><tbody><tr><th>Ohio</th><td>0.0</td><td>1.0</td><td>2.0</td></tr><tr><th>Texas</th><td>3.0</td><td>4.0</td><td>5.0</td></tr><tr><th>Colorado</th><td>6.0</td><td>7.0</td><td>8.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>b</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>Utah</th><td>0.0</td><td>1.0</td><td>2.0</td></tr><tr><th>Ohio</th><td>3.0</td><td>4.0</td><td>5.0</td></tr><tr><th>Texas</th><td>6.0</td><td>7.0</td><td>8.0</td></tr><tr><th>Oregon</th><td>9.0</td><td>10.0</td><td>11.0</td></tr></tbody></table></div><p>并且数据对齐操作是在所有维度上同时进行的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df1 + df2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>b</th><th>c</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>Colorado</th><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>Ohio</th><td>3.0</td><td>NaN</td><td>6.0</td><td>NaN</td></tr><tr><th>Oregon</th><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>Texas</th><td>9.0</td><td>NaN</td><td>12.0</td><td>NaN</td></tr><tr><th>Utah</th><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr></tbody></table></div><h4 id="在算术方法中填充词"><a href="#在算术方法中填充词" class="headerlink" title="在算术方法中填充词"></a>在算术方法中填充词</h4><p>下面这种定义column的方式值得注意</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(np.arange(<span class="number">12.</span>).reshape((<span class="number">3</span>, <span class="number">4</span>)), columns=list(<span class="string">'abcd'</span>))</div><div class="line">df2 = DataFrame(np.arange(<span class="number">20.</span>).reshape((<span class="number">4</span>, <span class="number">5</span>)), columns=list(<span class="string">'abcde'</span>))</div><div class="line">df1</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>1.0</td><td>2.0</td><td>3.0</td></tr><tr><th>1</th><td>4.0</td><td>5.0</td><td>6.0</td><td>7.0</td></tr><tr><th>2</th><td>8.0</td><td>9.0</td><td>10.0</td><td>11.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>1.0</td><td>2.0</td><td>3.0</td><td>4.0</td></tr><tr><th>1</th><td>5.0</td><td>6.0</td><td>7.0</td><td>8.0</td><td>9.0</td></tr><tr><th>2</th><td>10.0</td><td>11.0</td><td>12.0</td><td>13.0</td><td>14.0</td></tr><tr><th>3</th><td>15.0</td><td>16.0</td><td>17.0</td><td>18.0</td><td>19.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df1 + df2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>2.0</td><td>4.0</td><td>6.0</td><td>NaN</td></tr><tr><th>1</th><td>9.0</td><td>11.0</td><td>13.0</td><td>15.0</td><td>NaN</td></tr><tr><th>2</th><td>18.0</td><td>20.0</td><td>22.0</td><td>24.0</td><td>NaN</td></tr><tr><th>3</th><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr></tbody></table></div><p>要想填充值必须使用add方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df1.add(df2, fill_value=<span class="number">0</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>2.0</td><td>4.0</td><td>6.0</td><td>4.0</td></tr><tr><th>1</th><td>9.0</td><td>11.0</td><td>13.0</td><td>15.0</td><td>9.0</td></tr><tr><th>2</th><td>18.0</td><td>20.0</td><td>22.0</td><td>24.0</td><td>14.0</td></tr><tr><th>3</th><td>15.0</td><td>16.0</td><td>17.0</td><td>18.0</td><td>19.0</td></tr></tbody></table></div><p>reindex方法与add方法还是存在差异的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df1.reindex(columns=df2.columns, fill_value=<span class="number">0</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>1.0</td><td>2.0</td><td>3.0</td><td>0</td></tr><tr><th>1</th><td>4.0</td><td>5.0</td><td>6.0</td><td>7.0</td><td>0</td></tr><tr><th>2</th><td>8.0</td><td>9.0</td><td>10.0</td><td>11.0</td><td>0</td></tr></tbody></table></div><h4 id="DataFrame和Series之间的运算"><a href="#DataFrame和Series之间的运算" class="headerlink" title="DataFrame和Series之间的运算"></a>DataFrame和Series之间的运算</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">12.</span>).reshape((<span class="number">3</span>, <span class="number">4</span>))</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[  0.,   1.,   2.,   3.],
       [  4.,   5.,   6.,   7.],
       [  8.,   9.,  10.,  11.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr[<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>array([ 0.,  1.,  2.,  3.])
</code></pre><p>广播操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr - arr[<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>array([[ 0.,  0.,  0.,  0.],
       [ 4.,  4.,  4.,  4.],
       [ 8.,  8.,  8.,  8.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">12.</span>).reshape((<span class="number">4</span>, <span class="number">3</span>)), columns=list(<span class="string">'bde'</span>),</div><div class="line">                  index=[<span class="string">'Utah'</span>, <span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Oregon'</span>])</div><div class="line">series = frame.ix[<span class="number">0</span>]</div><div class="line">frame</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>b</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>Utah</th><td>0.0</td><td>1.0</td><td>2.0</td></tr><tr><th>Ohio</th><td>3.0</td><td>4.0</td><td>5.0</td></tr><tr><th>Texas</th><td>6.0</td><td>7.0</td><td>8.0</td></tr><tr><th>Oregon</th><td>9.0</td><td>10.0</td><td>11.0</td></tr></tbody></table></div><p>Series的name等于DataFrame的切片属性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">series</div></pre></td></tr></table></figure><pre><code>b    0.0
d    1.0
e    2.0
Name: Utah, dtype: float64
</code></pre><p>默认情况下，DataFrame和Series之间的算术运算会将Series的index匹配到DataFrame的column, 然后沿着行向下广播</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame - series</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>b</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>Utah</th><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>Ohio</th><td>3.0</td><td>3.0</td><td>3.0</td></tr><tr><th>Texas</th><td>6.0</td><td>6.0</td><td>6.0</td></tr><tr><th>Oregon</th><td>9.0</td><td>9.0</td><td>9.0</td></tr></tbody></table></div><p>如果Series的index与DataFrame的column不匹配，则进行数据对齐</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">series2 = Series(range(<span class="number">3</span>), index=[<span class="string">'b'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>])</div><div class="line">frame + series2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>b</th><th>d</th><th>e</th><th>f</th></tr></thead><tbody><tr><th>Utah</th><td>0.0</td><td>NaN</td><td>3.0</td><td>NaN</td></tr><tr><th>Ohio</th><td>3.0</td><td>NaN</td><td>6.0</td><td>NaN</td></tr><tr><th>Texas</th><td>6.0</td><td>NaN</td><td>9.0</td><td>NaN</td></tr><tr><th>Oregon</th><td>9.0</td><td>NaN</td><td>12.0</td><td>NaN</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">series3 = frame[<span class="string">'d'</span>]</div><div class="line">frame</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>b</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>Utah</th><td>0.0</td><td>1.0</td><td>2.0</td></tr><tr><th>Ohio</th><td>3.0</td><td>4.0</td><td>5.0</td></tr><tr><th>Texas</th><td>6.0</td><td>7.0</td><td>8.0</td></tr><tr><th>Oregon</th><td>9.0</td><td>10.0</td><td>11.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">series3</div></pre></td></tr></table></figure><pre><code>Utah       1.0
Ohio       4.0
Texas      7.0
Oregon    10.0
Name: d, dtype: float64
</code></pre><p>匹配行并且在列上进行广播， 就必须要指定axis</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame.sub(series3, axis=<span class="number">0</span>)</div><div class="line">frame.sub(series3, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>b</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>Utah</th><td>-1.0</td><td>0.0</td><td>1.0</td></tr><tr><th>Ohio</th><td>-1.0</td><td>0.0</td><td>1.0</td></tr><tr><th>Texas</th><td>-1.0</td><td>0.0</td><td>1.0</td></tr><tr><th>Oregon</th><td>-1.0</td><td>0.0</td><td>1.0</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Ohio</th><th>Oregon</th><th>Texas</th><th>Utah</th><th>b</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>Utah</th><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>Ohio</th><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>Texas</th><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>Oregon</th><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr></tbody></table></div><h3 id="函数应用和映射"><a href="#函数应用和映射" class="headerlink" title="函数应用和映射"></a>函数应用和映射</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.random.randn(<span class="number">4</span>, <span class="number">3</span>), columns=list(<span class="string">'bde'</span>),</div><div class="line">                  index=[<span class="string">'Utah'</span>, <span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Oregon'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>b</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>Utah</th><td>-0.204708</td><td>0.478943</td><td>-0.519439</td></tr><tr><th>Ohio</th><td>-0.555730</td><td>1.965781</td><td>1.393406</td></tr><tr><th>Texas</th><td>0.092908</td><td>0.281746</td><td>0.769023</td></tr><tr><th>Oregon</th><td>1.246435</td><td>1.007189</td><td>-1.296221</td></tr></tbody></table></div><p>Numpy的元素级方法也可以应用到DataFrame上，直接把DataFrame当作二维的Numpy.array即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.abs(frame)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>b</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>Utah</th><td>0.204708</td><td>0.478943</td><td>0.519439</td></tr><tr><th>Ohio</th><td>0.555730</td><td>1.965781</td><td>1.393406</td></tr><tr><th>Texas</th><td>0.092908</td><td>0.281746</td><td>0.769023</td></tr><tr><th>Oregon</th><td>1.246435</td><td>1.007189</td><td>1.296221</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">f = <span class="keyword">lambda</span> x: x.max() - x.min()</div></pre></td></tr></table></figure><p>apply方法将函数映射到由各行或者各列形成的一维数组上</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.apply(f) <span class="comment"># axis=0</span></div></pre></td></tr></table></figure><pre><code>b    1.802165
d    1.684034
e    2.689627
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.apply(f, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><pre><code>Utah      0.998382
Ohio      2.521511
Texas     0.676115
Oregon    2.542656
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span></div><div class="line">    <span class="keyword">return</span> Series([x.min(), x.max()], index=[<span class="string">'min'</span>, <span class="string">'max'</span>])</div><div class="line">frame.apply(f)</div><div class="line">frame.apply(f, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>b</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>min</th><td>-0.555730</td><td>0.281746</td><td>-1.296221</td></tr><tr><th>max</th><td>1.246435</td><td>1.965781</td><td>1.393406</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>min</th><th>max</th></tr></thead><tbody><tr><th>Utah</th><td>-0.519439</td><td>0.478943</td></tr><tr><th>Ohio</th><td>-0.555730</td><td>1.965781</td></tr><tr><th>Texas</th><td>0.092908</td><td>0.769023</td></tr><tr><th>Oregon</th><td>-1.296221</td><td>1.246435</td></tr></tbody></table></div><p>元素级的函数映射applymap， 之所以叫这个名字是因为Series有一个元素级的映射函数map</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">format = <span class="keyword">lambda</span> x: <span class="string">'%.2f'</span> % x</div><div class="line">frame.applymap(format)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>b</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>Utah</th><td>-0.20</td><td>0.48</td><td>-0.52</td></tr><tr><th>Ohio</th><td>-0.56</td><td>1.97</td><td>1.39</td></tr><tr><th>Texas</th><td>0.09</td><td>0.28</td><td>0.77</td></tr><tr><th>Oregon</th><td>1.25</td><td>1.01</td><td>-1.30</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame[<span class="string">'e'</span>].map(format)</div></pre></td></tr></table></figure><pre><code>Utah      -0.52
Ohio       1.39
Texas      0.77
Oregon    -1.30
Name: e, dtype: object
</code></pre><h3 id="排序和排名"><a href="#排序和排名" class="headerlink" title="排序和排名"></a>排序和排名</h3><p>对索引或者column进行（字典）排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series(range(<span class="number">4</span>), index=[<span class="string">'d'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">obj.sort_index()</div></pre></td></tr></table></figure><pre><code>a    1
b    2
c    3
d    0
dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">8</span>).reshape((<span class="number">2</span>, <span class="number">4</span>)), index=[<span class="string">'three'</span>, <span class="string">'one'</span>],</div><div class="line">                  columns=[<span class="string">'d'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">frame.sort_index()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>d</th><th>a</th><th>b</th><th>c</th></tr></thead><tbody><tr><th>one</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>three</th><td>0</td><td>1</td><td>2</td><td>3</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sort_index(axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th></tr></thead><tbody><tr><th>three</th><td>1</td><td>2</td><td>3</td><td>0</td></tr><tr><th>one</th><td>5</td><td>6</td><td>7</td><td>4</td></tr></tbody></table></div><p>降序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sort_index(axis=<span class="number">1</span>, ascending=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>d</th><th>c</th><th>b</th><th>a</th></tr></thead><tbody><tr><th>three</th><td>0</td><td>3</td><td>2</td><td>1</td></tr><tr><th>one</th><td>4</td><td>7</td><td>6</td><td>5</td></tr></tbody></table></div><p>按照data进行排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">4</span>, <span class="number">7</span>, <span class="number">-3</span>, <span class="number">2</span>])</div><div class="line">obj.sort_values()</div></pre></td></tr></table></figure><pre><code>2   -3
3    2
0    4
1    7
dtype: int64
</code></pre><p>在排序时，任何缺失值默认都会被放到Series的末尾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">4</span>, np.nan, <span class="number">7</span>, np.nan, <span class="number">-3</span>, <span class="number">2</span>])</div><div class="line">obj.sort_values()</div></pre></td></tr></table></figure><pre><code>4   -3.0
5    2.0
0    4.0
2    7.0
1    NaN
3    NaN
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(&#123;<span class="string">'b'</span>: [<span class="number">4</span>, <span class="number">7</span>, <span class="number">-3</span>, <span class="number">2</span>], <span class="string">'a'</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]&#125;)</div><div class="line">frame</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>4</td></tr><tr><th>1</th><td>1</td><td>7</td></tr><tr><th>2</th><td>0</td><td>-3</td></tr><tr><th>3</th><td>1</td><td>2</td></tr></tbody></table></div><p>对指定index或者column进行排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sort_values(by=<span class="string">'b'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th></tr></thead><tbody><tr><th>2</th><td>0</td><td>-3</td></tr><tr><th>3</th><td>1</td><td>2</td></tr><tr><th>0</th><td>0</td><td>4</td></tr><tr><th>1</th><td>1</td><td>7</td></tr></tbody></table></div><p>或者根据multi-index亦或multi-column进行排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sort_values(by=[<span class="string">'a'</span>, <span class="string">'b'</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th></tr></thead><tbody><tr><th>2</th><td>0</td><td>-3</td></tr><tr><th>0</th><td>0</td><td>4</td></tr><tr><th>3</th><td>1</td><td>2</td></tr><tr><th>1</th><td>1</td><td>7</td></tr></tbody></table></div><p>默认情况下，rank方法通过“为各组分配一个平均排名”的方式破坏平级关系。也就是说，如果有多个相同的值，则这些值的rank就是这些相同值rand的算术平均。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">7</span>, <span class="number">-5</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">4</span>])</div><div class="line">obj.rank()</div></pre></td></tr></table></figure><pre><code>0    7.5
1    1.0
2    7.5
3    5.0
4    3.0
5    2.0
6    5.0
7    5.0
dtype: float64
</code></pre><p>如果想按照一般方式排名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.rank(method=<span class="string">'first'</span>)</div></pre></td></tr></table></figure><pre><code>0    7.0
1    1.0
2    8.0
3    4.0
4    3.0
5    2.0
6    5.0
7    6.0
dtype: float64
</code></pre><p>使用每个分组的最大排名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.rank(ascending=<span class="keyword">False</span>, method=<span class="string">'max'</span>)</div></pre></td></tr></table></figure><pre><code>0    2.0
1    8.0
2    2.0
3    5.0
4    6.0
5    7.0
6    5.0
7    5.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(&#123;<span class="string">'b'</span>: [<span class="number">4.3</span>, <span class="number">7</span>, <span class="number">-3</span>, <span class="number">2</span>], <span class="string">'a'</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</div><div class="line">                   <span class="string">'c'</span>: [<span class="number">-2</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">-2.5</span>]&#125;)</div><div class="line">frame</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>4.3</td><td>-2.0</td></tr><tr><th>1</th><td>1</td><td>7.0</td><td>5.0</td></tr><tr><th>2</th><td>0</td><td>-3.0</td><td>8.0</td></tr><tr><th>3</th><td>1</td><td>2.0</td><td>-2.5</td></tr></tbody></table></div><p>指定维度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.rank(axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th></tr></thead><tbody><tr><th>0</th><td>2.0</td><td>3.0</td><td>1.0</td></tr><tr><th>1</th><td>1.0</td><td>3.0</td><td>2.0</td></tr><tr><th>2</th><td>2.0</td><td>1.0</td><td>3.0</td></tr><tr><th>3</th><td>2.0</td><td>3.0</td><td>1.0</td></tr></tbody></table></div><h3 id="带有重复值的轴索引"><a href="#带有重复值的轴索引" class="headerlink" title="带有重复值的轴索引"></a>带有重复值的轴索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series(range(<span class="number">5</span>), index=[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">obj</div></pre></td></tr></table></figure><pre><code>a    0
a    1
b    2
b    3
c    4
dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.index.is_unique</div></pre></td></tr></table></figure><pre><code>False
</code></pre><p>返回一个Series</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[<span class="string">'a'</span>]</div></pre></td></tr></table></figure><pre><code>a    0
a    1
dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[<span class="string">'c'</span>]</div></pre></td></tr></table></figure><pre><code>4
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(np.random.randn(<span class="number">4</span>, <span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>])</div><div class="line">df</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>a</th><td>0.274992</td><td>0.228913</td><td>1.352917</td></tr><tr><th>a</th><td>0.886429</td><td>-2.001637</td><td>-0.371843</td></tr><tr><th>b</th><td>1.669025</td><td>-0.438570</td><td>-0.539741</td></tr><tr><th>b</th><td>0.476985</td><td>3.248944</td><td>-1.021228</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.ix[<span class="string">'b'</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>b</th><td>1.669025</td><td>-0.438570</td><td>-0.539741</td></tr><tr><th>b</th><td>0.476985</td><td>3.248944</td><td>-1.021228</td></tr></tbody></table></div><h2 id="汇总和计算描述统计"><a href="#汇总和计算描述统计" class="headerlink" title="汇总和计算描述统计"></a>汇总和计算描述统计</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">df = DataFrame([[<span class="number">1.4</span>, np.nan], [<span class="number">7.1</span>, <span class="number">-4.5</span>],</div><div class="line">                [np.nan, np.nan], [<span class="number">0.75</span>, <span class="number">-1.3</span>]],</div><div class="line">               index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>],</div><div class="line">               columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</div><div class="line">df</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th></tr></thead><tbody><tr><th>a</th><td>1.40</td><td>NaN</td></tr><tr><th>b</th><td>7.10</td><td>-4.5</td></tr><tr><th>c</th><td>NaN</td><td>NaN</td></tr><tr><th>d</th><td>0.75</td><td>-1.3</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.sum() <span class="comment"># axis=0 skipna=True</span></div></pre></td></tr></table></figure><pre><code>one    9.25
two   -5.80
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.sum(axis=<span class="number">1</span>) <span class="comment"># skipna=True</span></div></pre></td></tr></table></figure><pre><code>a    1.40
b    2.60
c    0.00
d   -0.55
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.mean(axis=<span class="number">1</span>, skipna=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><pre><code>a      NaN
b    1.300
c      NaN
d   -0.275
dtype: float64
</code></pre><p>返回的是索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.idxmax()</div></pre></td></tr></table></figure><pre><code>one    b
two    d
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.cumsum()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th></tr></thead><tbody><tr><th>a</th><td>1.40</td><td>NaN</td></tr><tr><th>b</th><td>8.50</td><td>-4.5</td></tr><tr><th>c</th><td>NaN</td><td>NaN</td></tr><tr><th>d</th><td>9.25</td><td>-5.8</td></tr></tbody></table></div><p>describe对于数值型和非数值型数据的行为不一样</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.describe()</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\numpy\lib\function_base.py:3834: RuntimeWarning: Invalid value encountered in percentile
  RuntimeWarning)
</code></pre><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th></tr></thead><tbody><tr><th>count</th><td>3.000000</td><td>2.000000</td></tr><tr><th>mean</th><td>3.083333</td><td>-2.900000</td></tr><tr><th>std</th><td>3.493685</td><td>2.262742</td></tr><tr><th>min</th><td>0.750000</td><td>-4.500000</td></tr><tr><th>25%</th><td>NaN</td><td>NaN</td></tr><tr><th>50%</th><td>NaN</td><td>NaN</td></tr><tr><th>75%</th><td>NaN</td><td>NaN</td></tr><tr><th>max</th><td>7.100000</td><td>-1.300000</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>] * <span class="number">4</span>)</div><div class="line">obj</div><div class="line">obj.describe()</div></pre></td></tr></table></figure><pre><code>0     a
1     a
2     b
3     c
4     a
5     a
6     b
7     c
8     a
9     a
10    b
11    c
12    a
13    a
14    b
15    c
dtype: object






count     16
unique     3
top        a
freq       8
dtype: object
</code></pre><h3 id="相关系数和xi"><a href="#相关系数和xi" class="headerlink" title="相关系数和xi"></a>相关系数和xi</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas_datareader.data <span class="keyword">as</span> web</div><div class="line"></div><div class="line">all_data = &#123;&#125;</div><div class="line"><span class="keyword">for</span> ticker <span class="keyword">in</span> [<span class="string">'AAPL'</span>, <span class="string">'IBM'</span>, <span class="string">'MSFT'</span>, <span class="string">'GOOG'</span>]:</div><div class="line">    all_data[ticker] = web.get_data_yahoo(ticker)</div><div class="line"></div><div class="line">price = DataFrame(&#123;tic: data[<span class="string">'Adj Close'</span>]</div><div class="line">                   <span class="keyword">for</span> tic, data <span class="keyword">in</span> all_data.items()&#125;)</div><div class="line">volume = DataFrame(&#123;tic: data[<span class="string">'Volume'</span>]</div><div class="line">                    <span class="keyword">for</span> tic, data <span class="keyword">in</span> all_data.items()&#125;)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">price[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>AAPL</th><th>GOOG</th><th>IBM</th><th>MSFT</th></tr><tr><th>Date</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>2010-01-04</th><td>27.727039</td><td>313.062468</td><td>111.405000</td><td>25.555485</td></tr><tr><th>2010-01-05</th><td>27.774976</td><td>311.683844</td><td>110.059232</td><td>25.563741</td></tr><tr><th>2010-01-06</th><td>27.333178</td><td>303.826685</td><td>109.344283</td><td>25.406859</td></tr><tr><th>2010-01-07</th><td>27.282650</td><td>296.753749</td><td>108.965786</td><td>25.142634</td></tr><tr><th>2010-01-08</th><td>27.464034</td><td>300.709808</td><td>110.059232</td><td>25.316031</td></tr><tr><th>2010-01-11</th><td>27.221758</td><td>300.255255</td><td>108.906903</td><td>24.994007</td></tr><tr><th>2010-01-12</th><td>26.912110</td><td>294.945572</td><td>109.773245</td><td>24.828866</td></tr><tr><th>2010-01-13</th><td>27.291720</td><td>293.252243</td><td>109.537735</td><td>25.060064</td></tr><tr><th>2010-01-14</th><td>27.133657</td><td>294.630868</td><td>111.287245</td><td>25.563741</td></tr><tr><th>2010-01-15</th><td>26.680198</td><td>289.710772</td><td>110.841458</td><td>25.481172</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">volume[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>AAPL</th><th>GOOG</th><th>IBM</th><th>MSFT</th></tr><tr><th>Date</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>2010-01-04</th><td>123432400</td><td>3927000</td><td>6155300</td><td>38409100</td></tr><tr><th>2010-01-05</th><td>150476200</td><td>6031900</td><td>6841400</td><td>49749600</td></tr><tr><th>2010-01-06</th><td>138040000</td><td>7987100</td><td>5605300</td><td>58182400</td></tr><tr><th>2010-01-07</th><td>119282800</td><td>12876600</td><td>5840600</td><td>50559700</td></tr><tr><th>2010-01-08</th><td>111902700</td><td>9483900</td><td>4197200</td><td>51197400</td></tr><tr><th>2010-01-11</th><td>115557400</td><td>14479800</td><td>5730400</td><td>68754700</td></tr><tr><th>2010-01-12</th><td>148614900</td><td>9742900</td><td>8081500</td><td>65912100</td></tr><tr><th>2010-01-13</th><td>151473000</td><td>13041800</td><td>6455400</td><td>51863500</td></tr><tr><th>2010-01-14</th><td>108223500</td><td>8511900</td><td>7111800</td><td>63228100</td></tr><tr><th>2010-01-15</th><td>148516900</td><td>10909600</td><td>8494400</td><td>79913200</td></tr></tbody></table></div><p><strong>price.pct_change</strong></p><p><strong>Signature</strong>: price.pct_change(periods=1, fill_method=’pad’, limit=None, freq=None, **kwargs)<br><strong>Docstring</strong>:<br>Percent change over given number of periods.</p><p><strong>Parameters</strong></p><p>periods : int, default 1<br>Periods to shift for forming percent change</p><p>fill_method : str, default ‘pad’<br>How to handle NAs before computing percent changes</p><p>limit : int, default None<br>The number of consecutive NAs to fill before stopping</p><p>freq : DateOffset, timedelta, or offset alias string, optional<br>Increment to use from time series API (e.g. ‘M’ or BDay())</p><p><strong>Returns</strong></p><p>chg : NDFrame</p><p><strong>Notes</strong></p><p>By default, the percentage change is calculated along the stat<br>axis: 0, or <code>Index</code>, for <code>DataFrame</code> and 1, or <code>minor</code> for<br><code>Panel</code>. You can change this with the <code>axis</code> keyword argument.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">returns = price.pct_change()</div><div class="line">returns.tail()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>AAPL</th><th>GOOG</th><th>IBM</th><th>MSFT</th></tr><tr><th>Date</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>2017-02-21</th><td>0.007221</td><td>0.004335</td><td>-0.002269</td><td>-0.002012</td></tr><tr><th>2017-02-22</th><td>0.002999</td><td>-0.001082</td><td>0.004937</td><td>-0.002016</td></tr><tr><th>2017-02-23</th><td>-0.004230</td><td>0.000686</td><td>0.002760</td><td>0.004040</td></tr><tr><th>2017-02-24</th><td>0.000952</td><td>-0.003236</td><td>-0.001651</td><td>0.000000</td></tr><tr><th>2017-02-27</th><td>0.001976</td><td>0.000772</td><td>-0.010753</td><td>-0.006035</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.MSFT.corr(returns.IBM)</div></pre></td></tr></table></figure><pre><code>0.49525655865062668
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.MSFT.cov(returns.IBM)</div></pre></td></tr></table></figure><pre><code>8.5880535146740545e-05
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.corr()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>AAPL</th><th>GOOG</th><th>IBM</th><th>MSFT</th></tr></thead><tbody><tr><th>AAPL</th><td>1.000000</td><td>0.409523</td><td>0.381374</td><td>0.388875</td></tr><tr><th>GOOG</th><td>0.409523</td><td>1.000000</td><td>0.402781</td><td>0.470781</td></tr><tr><th>IBM</th><td>0.381374</td><td>0.402781</td><td>1.000000</td><td>0.495257</td></tr><tr><th>MSFT</th><td>0.388875</td><td>0.470781</td><td>0.495257</td><td>1.000000</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.cov()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>AAPL</th><th>GOOG</th><th>IBM</th><th>MSFT</th></tr></thead><tbody><tr><th>AAPL</th><td>0.000269</td><td>0.000105</td><td>0.000075</td><td>0.000092</td></tr><tr><th>GOOG</th><td>0.000105</td><td>0.000244</td><td>0.000075</td><td>0.000106</td></tr><tr><th>IBM</th><td>0.000075</td><td>0.000075</td><td>0.000144</td><td>0.000086</td></tr><tr><th>MSFT</th><td>0.000092</td><td>0.000106</td><td>0.000086</td><td>0.000209</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.corrwith(returns.IBM)</div></pre></td></tr></table></figure><pre><code>AAPL    0.381374
GOOG    0.402781
IBM     1.000000
MSFT    0.495257
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.corrwith(volume)</div></pre></td></tr></table></figure><pre><code>AAPL   -0.074055
GOOG   -0.009543
IBM    -0.194107
MSFT   -0.090724
dtype: float64
</code></pre><h3 id="唯一值，-值计数以及成员资格"><a href="#唯一值，-值计数以及成员资格" class="headerlink" title="唯一值， 值计数以及成员资格"></a>唯一值， 值计数以及成员资格</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'c'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">uniques = obj.unique()</div><div class="line">uniques</div></pre></td></tr></table></figure><pre><code>array([&#39;c&#39;, &#39;a&#39;, &#39;d&#39;, &#39;b&#39;], dtype=object)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.value_counts()</div></pre></td></tr></table></figure><pre><code>c    3
a    3
b    2
d    1
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.value_counts(obj.values, sort=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><pre><code>a    3
d    1
b    2
c    3
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mask = obj.isin([<span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">mask</div></pre></td></tr></table></figure><pre><code>0     True
1    False
2    False
3    False
4    False
5     True
6     True
7     True
8     True
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[mask]</div></pre></td></tr></table></figure><pre><code>0    c
5    b
6    b
7    c
8    c
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(&#123;<span class="string">'Qu1'</span>: [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>],</div><div class="line">                  <span class="string">'Qu2'</span>: [<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</div><div class="line">                  <span class="string">'Qu3'</span>: [<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>]&#125;)</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Qu1</th><th>Qu2</th><th>Qu3</th></tr></thead><tbody><tr><th>0</th><td>1</td><td>2</td><td>1</td></tr><tr><th>1</th><td>3</td><td>3</td><td>5</td></tr><tr><th>2</th><td>4</td><td>1</td><td>2</td></tr><tr><th>3</th><td>3</td><td>2</td><td>4</td></tr><tr><th>4</th><td>4</td><td>3</td><td>4</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = data.apply(pd.value_counts).fillna(<span class="number">0</span>)</div><div class="line">result</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Qu1</th><th>Qu2</th><th>Qu3</th></tr></thead><tbody><tr><th>1</th><td>1.0</td><td>1.0</td><td>1.0</td></tr><tr><th>2</th><td>0.0</td><td>2.0</td><td>1.0</td></tr><tr><th>3</th><td>2.0</td><td>2.0</td><td>0.0</td></tr><tr><th>4</th><td>2.0</td><td>0.0</td><td>2.0</td></tr><tr><th>5</th><td>0.0</td><td>0.0</td><td>1.0</td></tr></tbody></table></div><h2 id="处理缺失数据"><a href="#处理缺失数据" class="headerlink" title="处理缺失数据"></a>处理缺失数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">string_data = Series([<span class="string">'aardvark'</span>, <span class="string">'artichoke'</span>, np.nan, <span class="string">'avocado'</span>])</div><div class="line">string_data</div></pre></td></tr></table></figure><pre><code>0     aardvark
1    artichoke
2          NaN
3      avocado
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">string_data.isnull()</div></pre></td></tr></table></figure><pre><code>0    False
1    False
2     True
3    False
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">string_data[<span class="number">0</span>] = <span class="keyword">None</span></div><div class="line">string_data.isnull()</div></pre></td></tr></table></figure><pre><code>0     True
1    False
2     True
3    False
dtype: bool
</code></pre><h3 id="滤除缺失数据"><a href="#滤除缺失数据" class="headerlink" title="滤除缺失数据"></a>滤除缺失数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> nan <span class="keyword">as</span> NA</div><div class="line">data = Series([<span class="number">1</span>, NA, <span class="number">3.5</span>, NA, <span class="number">7</span>])</div><div class="line">data.dropna()</div></pre></td></tr></table></figure><pre><code>0    1.0
2    3.5
4    7.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[data.notnull()]</div></pre></td></tr></table></figure><pre><code>0    1.0
2    3.5
4    7.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame([[<span class="number">1.</span>, <span class="number">6.5</span>, <span class="number">3.</span>], [<span class="number">1.</span>, NA, NA],</div><div class="line">                  [NA, NA, NA], [NA, <span class="number">6.5</span>, <span class="number">3.</span>]])</div><div class="line">cleaned = data.dropna()</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>0</th><td>1.0</td><td>6.5</td><td>3.0</td></tr><tr><th>1</th><td>1.0</td><td>NaN</td><td>NaN</td></tr><tr><th>2</th><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>3</th><td>NaN</td><td>6.5</td><td>3.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cleaned</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>0</th><td>1.0</td><td>6.5</td><td>3.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.dropna(how=<span class="string">'all'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>0</th><td>1.0</td><td>6.5</td><td>3.0</td></tr><tr><th>1</th><td>1.0</td><td>NaN</td><td>NaN</td></tr><tr><th>3</th><td>NaN</td><td>6.5</td><td>3.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data[<span class="number">4</span>] = NA</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th><th>4</th></tr></thead><tbody><tr><th>0</th><td>1.0</td><td>6.5</td><td>3.0</td><td>NaN</td></tr><tr><th>1</th><td>1.0</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>2</th><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>3</th><td>NaN</td><td>6.5</td><td>3.0</td><td>NaN</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.dropna(axis=<span class="number">1</span>, how=<span class="string">'all'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>0</th><td>1.0</td><td>6.5</td><td>3.0</td></tr><tr><th>1</th><td>1.0</td><td>NaN</td><td>NaN</td></tr><tr><th>2</th><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>3</th><td>NaN</td><td>6.5</td><td>3.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(np.random.randn(<span class="number">7</span>, <span class="number">3</span>))</div><div class="line">df.ix[:<span class="number">4</span>, <span class="number">1</span>] = NA; df.ix[:<span class="number">2</span>, <span class="number">2</span>] = NA</div><div class="line">df</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>0</th><td>-0.204708</td><td>NaN</td><td>NaN</td></tr><tr><th>1</th><td>-0.555730</td><td>NaN</td><td>NaN</td></tr><tr><th>2</th><td>0.092908</td><td>NaN</td><td>NaN</td></tr><tr><th>3</th><td>1.246435</td><td>NaN</td><td>-1.296221</td></tr><tr><th>4</th><td>0.274992</td><td>NaN</td><td>1.352917</td></tr><tr><th>5</th><td>0.886429</td><td>-2.001637</td><td>-0.371843</td></tr><tr><th>6</th><td>1.669025</td><td>-0.438570</td><td>-0.539741</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.dropna(thresh=<span class="number">2</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>3</th><td>1.246435</td><td>NaN</td><td>-1.296221</td></tr><tr><th>4</th><td>0.274992</td><td>NaN</td><td>1.352917</td></tr><tr><th>5</th><td>0.886429</td><td>-2.001637</td><td>-0.371843</td></tr><tr><th>6</th><td>1.669025</td><td>-0.438570</td><td>-0.539741</td></tr></tbody></table></div><h3 id="填充缺失数据"><a href="#填充缺失数据" class="headerlink" title="填充缺失数据"></a>填充缺失数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.fillna(<span class="number">0</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>0</th><td>-0.204708</td><td>0.000000</td><td>0.000000</td></tr><tr><th>1</th><td>-0.555730</td><td>0.000000</td><td>0.000000</td></tr><tr><th>2</th><td>0.092908</td><td>0.000000</td><td>0.000000</td></tr><tr><th>3</th><td>1.246435</td><td>0.000000</td><td>-1.296221</td></tr><tr><th>4</th><td>0.274992</td><td>0.000000</td><td>1.352917</td></tr><tr><th>5</th><td>0.886429</td><td>-2.001637</td><td>-0.371843</td></tr><tr><th>6</th><td>1.669025</td><td>-0.438570</td><td>-0.539741</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.fillna(&#123;<span class="number">1</span>: <span class="number">0.5</span>, <span class="number">3</span>: <span class="number">-1</span>&#125;)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>0</th><td>-0.204708</td><td>0.500000</td><td>NaN</td></tr><tr><th>1</th><td>-0.555730</td><td>0.500000</td><td>NaN</td></tr><tr><th>2</th><td>0.092908</td><td>0.500000</td><td>NaN</td></tr><tr><th>3</th><td>1.246435</td><td>0.500000</td><td>-1.296221</td></tr><tr><th>4</th><td>0.274992</td><td>0.500000</td><td>1.352917</td></tr><tr><th>5</th><td>0.886429</td><td>-2.001637</td><td>-0.371843</td></tr><tr><th>6</th><td>1.669025</td><td>-0.438570</td><td>-0.539741</td></tr></tbody></table></div><p>fillna默认返回新对象，但也可以对现有对象就地修改</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># always returns a reference to the filled object</span></div><div class="line">_ = df.fillna(<span class="number">0</span>, inplace=<span class="keyword">True</span>)</div><div class="line">df</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>0</th><td>-0.204708</td><td>0.000000</td><td>0.000000</td></tr><tr><th>1</th><td>-0.555730</td><td>0.000000</td><td>0.000000</td></tr><tr><th>2</th><td>0.092908</td><td>0.000000</td><td>0.000000</td></tr><tr><th>3</th><td>1.246435</td><td>0.000000</td><td>-1.296221</td></tr><tr><th>4</th><td>0.274992</td><td>0.000000</td><td>1.352917</td></tr><tr><th>5</th><td>0.886429</td><td>-2.001637</td><td>-0.371843</td></tr><tr><th>6</th><td>1.669025</td><td>-0.438570</td><td>-0.539741</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(np.random.randn(<span class="number">6</span>, <span class="number">3</span>))</div><div class="line">df.ix[<span class="number">2</span>:, <span class="number">1</span>] = NA; df.ix[<span class="number">4</span>:, <span class="number">2</span>] = NA</div><div class="line">df</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>0</th><td>0.476985</td><td>3.248944</td><td>-1.021228</td></tr><tr><th>1</th><td>-0.577087</td><td>0.124121</td><td>0.302614</td></tr><tr><th>2</th><td>0.523772</td><td>NaN</td><td>1.343810</td></tr><tr><th>3</th><td>-0.713544</td><td>NaN</td><td>-2.370232</td></tr><tr><th>4</th><td>-1.860761</td><td>NaN</td><td>NaN</td></tr><tr><th>5</th><td>-1.265934</td><td>NaN</td><td>NaN</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.fillna(method=<span class="string">'ffill'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>0</th><td>0.476985</td><td>3.248944</td><td>-1.021228</td></tr><tr><th>1</th><td>-0.577087</td><td>0.124121</td><td>0.302614</td></tr><tr><th>2</th><td>0.523772</td><td>0.124121</td><td>1.343810</td></tr><tr><th>3</th><td>-0.713544</td><td>0.124121</td><td>-2.370232</td></tr><tr><th>4</th><td>-1.860761</td><td>0.124121</td><td>-2.370232</td></tr><tr><th>5</th><td>-1.265934</td><td>0.124121</td><td>-2.370232</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.fillna(method=<span class="string">'ffill'</span>, limit=<span class="number">2</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>0</th><td>0.476985</td><td>3.248944</td><td>-1.021228</td></tr><tr><th>1</th><td>-0.577087</td><td>0.124121</td><td>0.302614</td></tr><tr><th>2</th><td>0.523772</td><td>0.124121</td><td>1.343810</td></tr><tr><th>3</th><td>-0.713544</td><td>0.124121</td><td>-2.370232</td></tr><tr><th>4</th><td>-1.860761</td><td>NaN</td><td>-2.370232</td></tr><tr><th>5</th><td>-1.265934</td><td>NaN</td><td>-2.370232</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data = Series([<span class="number">1.</span>, NA, <span class="number">3.5</span>, NA, <span class="number">7</span>])</div><div class="line">data.fillna(data.mean())</div></pre></td></tr></table></figure><pre><code>0    1.000000
1    3.833333
2    3.500000
3    3.833333
4    7.000000
dtype: float64
</code></pre><h2 id="层次索引"><a href="#层次索引" class="headerlink" title="层次索引"></a>层次索引</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = Series(np.random.randn(<span class="number">10</span>),</div><div class="line">              index=[[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'d'</span>],</div><div class="line">                     [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]])</div><div class="line">data</div></pre></td></tr></table></figure><pre><code>a  1    0.332883
   2   -2.359419
   3   -0.199543
b  1   -1.541996
   2   -0.970736
   3   -1.307030
c  1    0.286350
   2    0.377984
d  2   -0.753887
   3    0.331286
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.index</div></pre></td></tr></table></figure><pre><code>MultiIndex(levels=[[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;], [1, 2, 3]],
           labels=[[0, 0, 0, 1, 1, 1, 2, 2, 3, 3], [0, 1, 2, 0, 1, 2, 0, 1, 1, 2]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'b'</span>]</div></pre></td></tr></table></figure><pre><code>1   -1.541996
2   -0.970736
3   -1.307030
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'b'</span>:<span class="string">'c'</span>]</div></pre></td></tr></table></figure><pre><code>b  1   -1.541996
   2   -0.970736
   3   -1.307030
c  1    0.286350
   2    0.377984
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[[<span class="string">'b'</span>, <span class="string">'d'</span>]]</div></pre></td></tr></table></figure><pre><code>b  1   -1.541996
   2   -0.970736
   3   -1.307030
d  2   -0.753887
   3    0.331286
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[:, <span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>a   -2.359419
b   -0.970736
c    0.377984
d   -0.753887
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.unstack()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><th>a</th><td>0.332883</td><td>-2.359419</td><td>-0.199543</td></tr><tr><th>b</th><td>-1.541996</td><td>-0.970736</td><td>-1.307030</td></tr><tr><th>c</th><td>0.286350</td><td>0.377984</td><td>NaN</td></tr><tr><th>d</th><td>NaN</td><td>-0.753887</td><td>0.331286</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.unstack().stack()</div></pre></td></tr></table></figure><pre><code>a  1    0.332883
   2   -2.359419
   3   -0.199543
b  1   -1.541996
   2   -0.970736
   3   -1.307030
c  1    0.286350
   2    0.377984
d  2   -0.753887
   3    0.331286
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">4</span>, <span class="number">3</span>)),</div><div class="line">                  index=[[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>]],</div><div class="line">                  columns=[[<span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>],</div><div class="line">                           [<span class="string">'Green'</span>, <span class="string">'Red'</span>, <span class="string">'Green'</span>]])</div><div class="line">frame</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr><th></th><th></th><th colspan="2" halign="left">Ohio</th><th>Colorado</th></tr><tr><th></th><th></th><th>Green</th><th>Red</th><th>Green</th></tr></thead><tbody><tr><th rowspan="2" valign="top">a</th><th>1</th><td>0</td><td>1</td><td>2</td></tr><tr><th>2</th><td>3</td><td>4</td><td>5</td></tr><tr><th rowspan="2" valign="top">b</th><th>1</th><td>6</td><td>7</td><td>8</td></tr><tr><th>2</th><td>9</td><td>10</td><td>11</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame.index.names = [<span class="string">'key1'</span>, <span class="string">'key2'</span>]</div><div class="line">frame.columns.names = [<span class="string">'state'</span>, <span class="string">'color'</span>]</div><div class="line">frame</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr><th></th><th>state</th><th colspan="2" halign="left">Ohio</th><th>Colorado</th></tr><tr><th></th><th>color</th><th>Green</th><th>Red</th><th>Green</th></tr><tr><th>key1</th><th>key2</th><th></th><th></th><th></th></tr></thead><tbody><tr><th rowspan="2" valign="top">a</th><th>1</th><td>0</td><td>1</td><td>2</td></tr><tr><th>2</th><td>3</td><td>4</td><td>5</td></tr><tr><th rowspan="2" valign="top">b</th><th>1</th><td>6</td><td>7</td><td>8</td></tr><tr><th>2</th><td>9</td><td>10</td><td>11</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame[<span class="string">'Ohio'</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>color</th><th>Green</th><th>Red</th></tr><tr><th>key1</th><th>key2</th><th></th><th></th></tr></thead><tbody><tr><th rowspan="2" valign="top">a</th><th>1</th><td>0</td><td>1</td></tr><tr><th>2</th><td>3</td><td>4</td></tr><tr><th rowspan="2" valign="top">b</th><th>1</th><td>6</td><td>7</td></tr><tr><th>2</th><td>9</td><td>10</td></tr></tbody></table></div><p><strong>创建MultiIndex对象复用</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MultiIndex.from_arrays([[&apos;Ohio&apos;, &apos;Ohio&apos;, &apos;Colorado&apos;], [&apos;Green&apos;, &apos;Red&apos;, &apos;Green&apos;]],</div><div class="line">                       names=[&apos;state&apos;, &apos;color&apos;])</div></pre></td></tr></table></figure><p></p><h3 id="重排分级顺序"><a href="#重排分级顺序" class="headerlink" title="重排分级顺序"></a>重排分级顺序</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.swaplevel(<span class="string">'key1'</span>, <span class="string">'key2'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr><th></th><th>state</th><th colspan="2" halign="left">Ohio</th><th>Colorado</th></tr><tr><th></th><th>color</th><th>Green</th><th>Red</th><th>Green</th></tr><tr><th>key2</th><th>key1</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>1</th><th>a</th><td>0</td><td>1</td><td>2</td></tr><tr><th>2</th><th>a</th><td>3</td><td>4</td><td>5</td></tr><tr><th>1</th><th>b</th><td>6</td><td>7</td><td>8</td></tr><tr><th>2</th><th>b</th><td>9</td><td>10</td><td>11</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sortlevel(<span class="number">1</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr><th></th><th>state</th><th colspan="2" halign="left">Ohio</th><th>Colorado</th></tr><tr><th></th><th>color</th><th>Green</th><th>Red</th><th>Green</th></tr><tr><th>key1</th><th>key2</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>a</th><th>1</th><td>0</td><td>1</td><td>2</td></tr><tr><th>b</th><th>1</th><td>6</td><td>7</td><td>8</td></tr><tr><th>a</th><th>2</th><td>3</td><td>4</td><td>5</td></tr><tr><th>b</th><th>2</th><td>9</td><td>10</td><td>11</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.swaplevel(<span class="number">0</span>, <span class="number">1</span>).sortlevel(<span class="number">0</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr><th></th><th>state</th><th colspan="2" halign="left">Ohio</th><th>Colorado</th></tr><tr><th></th><th>color</th><th>Green</th><th>Red</th><th>Green</th></tr><tr><th>key2</th><th>key1</th><th></th><th></th><th></th></tr></thead><tbody><tr><th rowspan="2" valign="top">1</th><th>a</th><td>0</td><td>1</td><td>2</td></tr><tr><th>b</th><td>6</td><td>7</td><td>8</td></tr><tr><th rowspan="2" valign="top">2</th><th>a</th><td>3</td><td>4</td><td>5</td></tr><tr><th>b</th><td>9</td><td>10</td><td>11</td></tr></tbody></table></div><h3 id="根据级别汇总统计"><a href="#根据级别汇总统计" class="headerlink" title="根据级别汇总统计"></a>根据级别汇总统计</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sum(level=<span class="string">'key2'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr><th>state</th><th colspan="2" halign="left">Ohio</th><th>Colorado</th></tr><tr><th>color</th><th>Green</th><th>Red</th><th>Green</th></tr><tr><th>key2</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>1</th><td>6</td><td>8</td><td>10</td></tr><tr><th>2</th><td>12</td><td>14</td><td>16</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sum(level=<span class="string">'color'</span>, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>color</th><th>Green</th><th>Red</th></tr><tr><th>key1</th><th>key2</th><th></th><th></th></tr></thead><tbody><tr><th rowspan="2" valign="top">a</th><th>1</th><td>2</td><td>1</td></tr><tr><th>2</th><td>8</td><td>4</td></tr><tr><th rowspan="2" valign="top">b</th><th>1</th><td>14</td><td>7</td></tr><tr><th>2</th><td>20</td><td>10</td></tr></tbody></table></div><h3 id="使用DataFrame的列"><a href="#使用DataFrame的列" class="headerlink" title="使用DataFrame的列"></a>使用DataFrame的列</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(&#123;<span class="string">'a'</span>: range(<span class="number">7</span>), <span class="string">'b'</span>: range(<span class="number">7</span>, <span class="number">0</span>, <span class="number">-1</span>),</div><div class="line">                   <span class="string">'c'</span>: [<span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'two'</span>, <span class="string">'two'</span>, <span class="string">'two'</span>],</div><div class="line">                   <span class="string">'d'</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;)</div><div class="line">frame</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>7</td><td>one</td><td>0</td></tr><tr><th>1</th><td>1</td><td>6</td><td>one</td><td>1</td></tr><tr><th>2</th><td>2</td><td>5</td><td>one</td><td>2</td></tr><tr><th>3</th><td>3</td><td>4</td><td>two</td><td>0</td></tr><tr><th>4</th><td>4</td><td>3</td><td>two</td><td>1</td></tr><tr><th>5</th><td>5</td><td>2</td><td>two</td><td>2</td></tr><tr><th>6</th><td>6</td><td>1</td><td>two</td><td>3</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame2 = frame.set_index([<span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">frame2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th></th><th>a</th><th>b</th></tr><tr><th>c</th><th>d</th><th></th><th></th></tr></thead><tbody><tr><th rowspan="3" valign="top">one</th><th>0</th><td>0</td><td>7</td></tr><tr><th>1</th><td>1</td><td>6</td></tr><tr><th>2</th><td>2</td><td>5</td></tr><tr><th rowspan="4" valign="top">two</th><th>0</th><td>3</td><td>4</td></tr><tr><th>1</th><td>4</td><td>3</td></tr><tr><th>2</th><td>5</td><td>2</td></tr><tr><th>3</th><td>6</td><td>1</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.set_index([<span class="string">'c'</span>, <span class="string">'d'</span>], drop=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th></th><th>a</th><th>b</th><th>c</th><th>d</th></tr><tr><th>c</th><th>d</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th rowspan="3" valign="top">one</th><th>0</th><td>0</td><td>7</td><td>one</td><td>0</td></tr><tr><th>1</th><td>1</td><td>6</td><td>one</td><td>1</td></tr><tr><th>2</th><td>2</td><td>5</td><td>one</td><td>2</td></tr><tr><th rowspan="4" valign="top">two</th><th>0</th><td>3</td><td>4</td><td>two</td><td>0</td></tr><tr><th>1</th><td>4</td><td>3</td><td>two</td><td>1</td></tr><tr><th>2</th><td>5</td><td>2</td><td>two</td><td>2</td></tr><tr><th>3</th><td>6</td><td>1</td><td>two</td><td>3</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2.reset_index()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>c</th><th>d</th><th>a</th><th>b</th></tr></thead><tbody><tr><th>0</th><td>one</td><td>0</td><td>0</td><td>7</td></tr><tr><th>1</th><td>one</td><td>1</td><td>1</td><td>6</td></tr><tr><th>2</th><td>one</td><td>2</td><td>2</td><td>5</td></tr><tr><th>3</th><td>two</td><td>0</td><td>3</td><td>4</td></tr><tr><th>4</th><td>two</td><td>1</td><td>4</td><td>3</td></tr><tr><th>5</th><td>two</td><td>2</td><td>5</td><td>2</td></tr><tr><th>6</th><td>two</td><td>3</td><td>6</td><td>1</td></tr></tbody></table></div><h2 id="拓展话题"><a href="#拓展话题" class="headerlink" title="拓展话题"></a>拓展话题</h2><h3 id="整数索引"><a href="#整数索引" class="headerlink" title="整数索引"></a>整数索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ser = Series(np.arange(<span class="number">3.</span>))</div><div class="line">ser.iloc[<span class="number">-1</span>]</div></pre></td></tr></table></figure><pre><code>2.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ser</div></pre></td></tr></table></figure><pre><code>0    0.0
1    1.0
2    2.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ser2 = Series(np.arange(<span class="number">3.</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">ser2[<span class="number">-1</span>]</div></pre></td></tr></table></figure><pre><code>2.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ser.ix[:<span class="number">1</span>]</div></pre></td></tr></table></figure><pre><code>0    0.0
1    1.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ser3 = Series(range(<span class="number">3</span>), index=[<span class="number">-5</span>, <span class="number">1</span>, <span class="number">3</span>])</div><div class="line">ser3.iloc[<span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>2
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">6</span>).reshape((<span class="number">3</span>, <span class="number">2</span>)), index=[<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>])</div><div class="line">frame</div><div class="line">frame.iloc[<span class="number">0</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th></tr></thead><tbody><tr><th>2</th><td>0</td><td>1</td></tr><tr><th>0</th><td>2</td><td>3</td></tr><tr><th>1</th><td>4</td><td>5</td></tr></tbody></table></div><pre><code>0    0
1    1
Name: 2, dtype: int32
</code></pre><h3 id="面板数据"><a href="#面板数据" class="headerlink" title="面板数据"></a>面板数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas_datareader.data <span class="keyword">as</span> web</div><div class="line"></div><div class="line">pdata = pd.Panel(dict((stk, web.get_data_yahoo(stk))</div><div class="line">                       <span class="keyword">for</span> stk <span class="keyword">in</span> [<span class="string">'AAPL'</span>, <span class="string">'GOOG'</span>, <span class="string">'MSFT'</span>, <span class="string">'DELL'</span>]))</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pdata</div></pre></td></tr></table></figure><pre><code>&lt;class &#39;pandas.core.panel.Panel&#39;&gt;
Dimensions: 4 (items) x 1820 (major_axis) x 6 (minor_axis)
Items axis: AAPL to MSFT
Major_axis axis: 2010-01-04 00:00:00 to 2017-02-27 00:00:00
Minor_axis axis: Open to Adj Close
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pdata = pdata.swapaxes(<span class="string">'items'</span>, <span class="string">'minor'</span>)</div><div class="line">pdata[<span class="string">'Adj Close'</span>].iloc[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>AAPL</th><th>DELL</th><th>GOOG</th><th>MSFT</th></tr><tr><th>Date</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>2010-01-04</th><td>27.727039</td><td>14.06528</td><td>313.062468</td><td>25.555485</td></tr><tr><th>2010-01-05</th><td>27.774976</td><td>14.38450</td><td>311.683844</td><td>25.563741</td></tr><tr><th>2010-01-06</th><td>27.333178</td><td>14.10397</td><td>303.826685</td><td>25.406859</td></tr><tr><th>2010-01-07</th><td>27.282650</td><td>14.23940</td><td>296.753749</td><td>25.142634</td></tr><tr><th>2010-01-08</th><td>27.464034</td><td>14.36516</td><td>300.709808</td><td>25.316031</td></tr><tr><th>2010-01-11</th><td>27.221758</td><td>14.37483</td><td>300.255255</td><td>24.994007</td></tr><tr><th>2010-01-12</th><td>26.912110</td><td>14.56830</td><td>294.945572</td><td>24.828866</td></tr><tr><th>2010-01-13</th><td>27.291720</td><td>14.57797</td><td>293.252243</td><td>25.060064</td></tr><tr><th>2010-01-14</th><td>27.133657</td><td>14.22005</td><td>294.630868</td><td>25.563741</td></tr><tr><th>2010-01-15</th><td>26.680198</td><td>13.92985</td><td>289.710772</td><td>25.481172</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pdata.ix[:, <span class="string">'6/1/2012'</span>, :]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Open</th><th>High</th><th>Low</th><th>Close</th><th>Volume</th><th>Adj Close</th></tr></thead><tbody><tr><th>AAPL</th><td>569.159996</td><td>572.650009</td><td>560.520012</td><td>560.989983</td><td>130246900.0</td><td>72.681610</td></tr><tr><th>DELL</th><td>12.150000</td><td>12.300000</td><td>12.045000</td><td>12.070000</td><td>19397600.0</td><td>11.675920</td></tr><tr><th>GOOG</th><td>571.790972</td><td>572.650996</td><td>568.350996</td><td>570.981000</td><td>6138700.0</td><td>285.205295</td></tr><tr><th>MSFT</th><td>28.760000</td><td>28.959999</td><td>28.440001</td><td>28.450001</td><td>56634300.0</td><td>24.942239</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pdata.ix[<span class="string">'Adj Close'</span>, <span class="string">'5/22/2012'</span>:, :].iloc[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>AAPL</th><th>DELL</th><th>GOOG</th><th>MSFT</th></tr><tr><th>Date</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>2012-05-22</th><td>72.160786</td><td>14.58765</td><td>300.100412</td><td>26.090721</td></tr><tr><th>2012-05-23</th><td>73.921494</td><td>12.08221</td><td>304.426106</td><td>25.520864</td></tr><tr><th>2012-05-24</th><td>73.242607</td><td>12.04351</td><td>301.528978</td><td>25.485795</td></tr><tr><th>2012-05-25</th><td>72.850038</td><td>12.05319</td><td>295.470050</td><td>25.477028</td></tr><tr><th>2012-05-28</th><td>NaN</td><td>12.05319</td><td>NaN</td><td>NaN</td></tr><tr><th>2012-05-29</th><td>74.143041</td><td>12.24666</td><td>296.873645</td><td>25.915380</td></tr><tr><th>2012-05-30</th><td>75.037005</td><td>12.14992</td><td>293.821674</td><td>25.722505</td></tr><tr><th>2012-05-31</th><td>74.850442</td><td>11.92743</td><td>290.140354</td><td>25.591000</td></tr><tr><th>2012-06-01</th><td>72.681610</td><td>11.67592</td><td>285.205295</td><td>24.942239</td></tr><tr><th>2012-06-04</th><td>73.109156</td><td>11.60821</td><td>289.006480</td><td>25.029908</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">stacked = pdata.ix[:, <span class="string">'5/30/2012'</span>:, :].to_frame()</div><div class="line">stacked</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th></th><th>Open</th><th>High</th><th>Low</th><th>Close</th><th>Volume</th><th>Adj Close</th></tr><tr><th>Date</th><th>minor</th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th rowspan="4" valign="top">2012-05-30</th><th>AAPL</th><td>569.199997</td><td>579.989990</td><td>566.559990</td><td>579.169998</td><td>132357400.0</td><td>75.037005</td></tr><tr><th>DELL</th><td>12.590000</td><td>12.700000</td><td>12.460000</td><td>12.560000</td><td>19787800.0</td><td>12.149920</td></tr><tr><th>GOOG</th><td>588.161028</td><td>591.901014</td><td>583.530999</td><td>588.230992</td><td>3827600.0</td><td>293.821674</td></tr><tr><th>MSFT</th><td>29.350000</td><td>29.480000</td><td>29.120001</td><td>29.340000</td><td>41585500.0</td><td>25.722505</td></tr><tr><th rowspan="4" valign="top">2012-05-31</th><th>AAPL</th><td>580.740021</td><td>581.499985</td><td>571.460022</td><td>577.730019</td><td>122918600.0</td><td>74.850442</td></tr><tr><th>DELL</th><td>12.530000</td><td>12.540000</td><td>12.330000</td><td>12.330000</td><td>19955600.0</td><td>11.927430</td></tr><tr><th>GOOG</th><td>588.720982</td><td>590.001032</td><td>579.001013</td><td>580.860990</td><td>5958800.0</td><td>290.140354</td></tr><tr><th>MSFT</th><td>29.299999</td><td>29.420000</td><td>28.940001</td><td>29.190001</td><td>39134000.0</td><td>25.591000</td></tr><tr><th rowspan="4" valign="top">2012-06-01</th><th>AAPL</th><td>569.159996</td><td>572.650009</td><td>560.520012</td><td>560.989983</td><td>130246900.0</td><td>72.681610</td></tr><tr><th>DELL</th><td>12.150000</td><td>12.300000</td><td>12.045000</td><td>12.070000</td><td>19397600.0</td><td>11.675920</td></tr><tr><th>GOOG</th><td>571.790972</td><td>572.650996</td><td>568.350996</td><td>570.981000</td><td>6138700.0</td><td>285.205295</td></tr><tr><th>MSFT</th><td>28.760000</td><td>28.959999</td><td>28.440001</td><td>28.450001</td><td>56634300.0</td><td>24.942239</td></tr><tr><th rowspan="4" valign="top">2012-06-04</th><th>AAPL</th><td>561.500008</td><td>567.499985</td><td>548.499977</td><td>564.289978</td><td>139248900.0</td><td>73.109156</td></tr><tr><th>DELL</th><td>12.110000</td><td>12.112500</td><td>11.800000</td><td>12.000000</td><td>17015700.0</td><td>11.608210</td></tr><tr><th>GOOG</th><td>570.220958</td><td>580.491016</td><td>570.011006</td><td>578.590973</td><td>4883500.0</td><td>289.006480</td></tr><tr><th>MSFT</th><td>28.620001</td><td>28.780001</td><td>28.320000</td><td>28.549999</td><td>47926300.0</td><td>25.029908</td></tr><tr><th rowspan="4" valign="top">2012-06-05</th><th>AAPL</th><td>561.269989</td><td>566.470001</td><td>558.330002</td><td>562.830025</td><td>97053600.0</td><td>72.920005</td></tr><tr><th>DELL</th><td>11.950000</td><td>12.240000</td><td>11.950000</td><td>12.160000</td><td>15620900.0</td><td>11.762980</td></tr><tr><th>GOOG</th><td>575.451008</td><td>578.131003</td><td>566.470986</td><td>570.410999</td><td>4697200.0</td><td>284.920579</td></tr><tr><th>MSFT</th><td>28.510000</td><td>28.750000</td><td>28.389999</td><td>28.510000</td><td>45715400.0</td><td>24.994841</td></tr><tr><th rowspan="4" valign="top">2012-06-06</th><th>AAPL</th><td>567.770004</td><td>573.849983</td><td>565.499992</td><td>571.460022</td><td>100363900.0</td><td>74.038104</td></tr><tr><th>DELL</th><td>12.210000</td><td>12.280000</td><td>12.090000</td><td>12.215000</td><td>20779900.0</td><td>11.816190</td></tr><tr><th>GOOG</th><td>576.480979</td><td>581.970971</td><td>573.611004</td><td>580.570966</td><td>4207200.0</td><td>289.995487</td></tr><tr><th>MSFT</th><td>28.879999</td><td>29.370001</td><td>28.809999</td><td>29.350000</td><td>46860500.0</td><td>25.731273</td></tr><tr><th rowspan="4" valign="top">2012-06-07</th><th>AAPL</th><td>577.290009</td><td>577.320023</td><td>570.500000</td><td>571.720001</td><td>94941700.0</td><td>74.071787</td></tr><tr><th>DELL</th><td>12.320000</td><td>12.410000</td><td>12.120000</td><td>12.130000</td><td>20074000.0</td><td>11.733960</td></tr><tr><th>GOOG</th><td>587.601014</td><td>587.891038</td><td>577.251006</td><td>578.230986</td><td>3530100.0</td><td>288.826666</td></tr><tr><th>MSFT</th><td>29.639999</td><td>29.700001</td><td>29.170000</td><td>29.230000</td><td>37792800.0</td><td>25.626067</td></tr><tr><th rowspan="2" valign="top">2012-06-08</th><th>AAPL</th><td>571.599998</td><td>580.580017</td><td>568.999992</td><td>580.319984</td><td>86879100.0</td><td>75.185997</td></tr><tr><th>DELL</th><td>12.130000</td><td>12.225000</td><td>12.020000</td><td>12.120000</td><td>18155600.0</td><td>11.724290</td></tr><tr><th>...</th><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th rowspan="3" valign="top">2017-02-13</th><th>AAPL</th><td>133.080002</td><td>133.820007</td><td>132.750000</td><td>133.289993</td><td>23035400.0</td><td>133.289993</td></tr><tr><th>GOOG</th><td>816.000000</td><td>820.958984</td><td>815.489990</td><td>819.239990</td><td>1198100.0</td><td>819.239990</td></tr><tr><th>MSFT</th><td>64.239998</td><td>64.860001</td><td>64.129997</td><td>64.720001</td><td>22920100.0</td><td>64.330000</td></tr><tr><th rowspan="3" valign="top">2017-02-14</th><th>AAPL</th><td>133.470001</td><td>135.089996</td><td>133.250000</td><td>135.020004</td><td>32815500.0</td><td>135.020004</td></tr><tr><th>GOOG</th><td>819.000000</td><td>823.000000</td><td>816.000000</td><td>820.450012</td><td>1053600.0</td><td>820.450012</td></tr><tr><th>MSFT</th><td>64.410004</td><td>64.720001</td><td>64.019997</td><td>64.570000</td><td>23065900.0</td><td>64.570000</td></tr><tr><th rowspan="3" valign="top">2017-02-15</th><th>AAPL</th><td>135.520004</td><td>136.270004</td><td>134.619995</td><td>135.509995</td><td>35501600.0</td><td>135.509995</td></tr><tr><th>GOOG</th><td>819.359985</td><td>823.000000</td><td>818.469971</td><td>818.979980</td><td>1304000.0</td><td>818.979980</td></tr><tr><th>MSFT</th><td>64.500000</td><td>64.570000</td><td>64.160004</td><td>64.529999</td><td>16917000.0</td><td>64.529999</td></tr><tr><th rowspan="3" valign="top">2017-02-16</th><th>AAPL</th><td>135.669998</td><td>135.899994</td><td>134.839996</td><td>135.350006</td><td>22118000.0</td><td>135.350006</td></tr><tr><th>GOOG</th><td>819.929993</td><td>824.400024</td><td>818.979980</td><td>824.159973</td><td>1281700.0</td><td>824.159973</td></tr><tr><th>MSFT</th><td>64.739998</td><td>65.239998</td><td>64.440002</td><td>64.519997</td><td>20524700.0</td><td>64.519997</td></tr><tr><th rowspan="3" valign="top">2017-02-17</th><th>AAPL</th><td>135.100006</td><td>135.830002</td><td>135.100006</td><td>135.720001</td><td>22084500.0</td><td>135.720001</td></tr><tr><th>GOOG</th><td>823.020020</td><td>828.070007</td><td>821.655029</td><td>828.070007</td><td>1597800.0</td><td>828.070007</td></tr><tr><th>MSFT</th><td>64.470001</td><td>64.690002</td><td>64.300003</td><td>64.620003</td><td>21234600.0</td><td>64.620003</td></tr><tr><th rowspan="3" valign="top">2017-02-21</th><th>AAPL</th><td>136.229996</td><td>136.750000</td><td>135.979996</td><td>136.699997</td><td>24265100.0</td><td>136.699997</td></tr><tr><th>GOOG</th><td>828.659973</td><td>833.450012</td><td>828.349976</td><td>831.659973</td><td>1247700.0</td><td>831.659973</td></tr><tr><th>MSFT</th><td>64.610001</td><td>64.949997</td><td>64.449997</td><td>64.489998</td><td>19384900.0</td><td>64.489998</td></tr><tr><th rowspan="3" valign="top">2017-02-22</th><th>AAPL</th><td>136.429993</td><td>137.119995</td><td>136.110001</td><td>137.110001</td><td>20745300.0</td><td>137.110001</td></tr><tr><th>GOOG</th><td>828.659973</td><td>833.250000</td><td>828.640015</td><td>830.760010</td><td>982900.0</td><td>830.760010</td></tr><tr><th>MSFT</th><td>64.330002</td><td>64.389999</td><td>64.050003</td><td>64.360001</td><td>19259700.0</td><td>64.360001</td></tr><tr><th rowspan="3" valign="top">2017-02-23</th><th>AAPL</th><td>137.380005</td><td>137.479996</td><td>136.300003</td><td>136.529999</td><td>20704100.0</td><td>136.529999</td></tr><tr><th>GOOG</th><td>830.119995</td><td>832.460022</td><td>822.880005</td><td>831.330017</td><td>1470100.0</td><td>831.330017</td></tr><tr><th>MSFT</th><td>64.419998</td><td>64.730003</td><td>64.190002</td><td>64.620003</td><td>20235200.0</td><td>64.620003</td></tr><tr><th rowspan="3" valign="top">2017-02-24</th><th>AAPL</th><td>135.910004</td><td>136.660004</td><td>135.279999</td><td>136.660004</td><td>21690900.0</td><td>136.660004</td></tr><tr><th>GOOG</th><td>827.729980</td><td>829.000000</td><td>824.200012</td><td>828.640015</td><td>1386600.0</td><td>828.640015</td></tr><tr><th>MSFT</th><td>64.529999</td><td>64.800003</td><td>64.139999</td><td>64.620003</td><td>21705200.0</td><td>64.620003</td></tr><tr><th rowspan="3" valign="top">2017-02-27</th><th>AAPL</th><td>137.139999</td><td>137.440002</td><td>136.279999</td><td>136.929993</td><td>20196400.0</td><td>136.929993</td></tr><tr><th>GOOG</th><td>824.549988</td><td>830.500000</td><td>824.000000</td><td>829.280029</td><td>1099500.0</td><td>829.280029</td></tr><tr><th>MSFT</th><td>64.540001</td><td>64.540001</td><td>64.050003</td><td>64.230003</td><td>15850400.0</td><td>64.230003</td></tr></tbody></table><p>3952 rows × 6 columns</p></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">stacked.to_panel()</div></pre></td></tr></table></figure><pre><code>&lt;class &#39;pandas.core.panel.Panel&#39;&gt;
Dimensions: 6 (items) x 1207 (major_axis) x 4 (minor_axis)
Items axis: Open to Adj Close
Major_axis axis: 2012-05-30 00:00:00 to 2017-02-27 00:00:00
Minor_axis axis: AAPL to MSFT
</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;pandas入门&quot;&gt;&lt;a href=&quot;#pandas入门&quot; class=&quot;headerlink&quot; title=&quot;pandas入门&quot;&gt;&lt;/a&gt;pandas入门&lt;/h1&gt;&lt;p&gt;按照以下约定引用相关package&lt;/p&gt;&lt;figure class=&quot;highlight 
    
    </summary>
    
    
      <category term="Python" scheme="http://yoursite.com/tags/Python/"/>
    
      <category term="pandas" scheme="http://yoursite.com/tags/pandas/"/>
    
  </entry>
  
  <entry>
    <title>Python data analysis-Learning note-Ch04</title>
    <link href="http://yoursite.com/2017/02/26/Python-data-analysis-Learning-note-Ch04/"/>
    <id>http://yoursite.com/2017/02/26/Python-data-analysis-Learning-note-Ch04/</id>
    <published>2017-02-26T03:25:50.000Z</published>
    <updated>2017-02-26T08:03:00.180Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Numpy基础：数组和矢量计算"><a href="#Numpy基础：数组和矢量计算" class="headerlink" title="Numpy基础：数组和矢量计算"></a>Numpy基础：数组和矢量计算</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">%matplotlib inline</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line">np.set_printoptions(precision=<span class="number">4</span>, suppress=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</div><div class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></div></pre></td></tr></table></figure><h2 id="NumPy-ndarray-一种多维数组对象"><a href="#NumPy-ndarray-一种多维数组对象" class="headerlink" title="NumPy ndarray: 一种多维数组对象"></a>NumPy ndarray: 一种多维数组对象</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data = randn(<span class="number">2</span>, <span class="number">3</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data</div><div class="line">data * <span class="number">10</span></div><div class="line">data + data</div></pre></td></tr></table></figure><pre><code>array([[ 0.1584,  0.299 , -0.2555],
       [ 0.3277, -0.6934,  1.3191]])






array([[  1.5842,   2.9896,  -2.5545],
       [  3.2767,  -6.9342,  13.1913]])






array([[ 0.3168,  0.5979, -0.5109],
       [ 0.6553, -1.3868,  2.6383]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data.shape</div><div class="line">data.dtype</div></pre></td></tr></table></figure><pre><code>(2, 3)






dtype(&#39;float64&#39;)
</code></pre><h3 id="创建ndarray"><a href="#创建ndarray" class="headerlink" title="创建ndarray"></a>创建ndarray</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data1 = [<span class="number">6</span>, <span class="number">7.5</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">1</span>]</div><div class="line">arr1 = np.array(data1)</div><div class="line">arr1</div></pre></td></tr></table></figure><pre><code>array([ 6. ,  7.5,  8. ,  0. ,  1. ])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">data2 = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]]</div><div class="line">arr2 = np.array(data2)</div><div class="line">arr2</div><div class="line">arr2.ndim</div><div class="line">arr2.shape</div></pre></td></tr></table></figure><pre><code>array([[1, 2, 3, 4],
       [5, 6, 7, 8]])






2






(2, 4)
</code></pre><p>除非显示说明，np.array会尝试为新建的数组选择一个合适的类型</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr1.dtype</div><div class="line">arr2.dtype</div></pre></td></tr></table></figure><pre><code>dtype(&#39;float64&#39;)






dtype(&#39;int32&#39;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">np.zeros(<span class="number">10</span>)</div><div class="line">np.zeros((<span class="number">3</span>, <span class="number">6</span>))</div><div class="line">np.empty((<span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>))</div></pre></td></tr></table></figure><pre><code>array([ 0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.])






array([[ 0.,  0.,  0.,  0.,  0.,  0.],
       [ 0.,  0.,  0.,  0.,  0.,  0.],
       [ 0.,  0.,  0.,  0.,  0.,  0.]])






array([[[ 0.,  0.],
        [ 0.,  0.],
        [ 0.,  0.]],

       [[ 0.,  0.],
        [ 0.,  0.],
        [ 0.,  0.]]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.arange(<span class="number">15</span>)</div></pre></td></tr></table></figure><pre><code>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14])
</code></pre><p>ones_like, zeros_like, empty_like这三个方法接受一个数组为对象，创建和这个数组形状和dtype一样的全1， 全0和分配的初始空间</p><h3 id="ndarray的数据类型"><a href="#ndarray的数据类型" class="headerlink" title="ndarray的数据类型"></a>ndarray的数据类型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr1 = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=np.float64)</div><div class="line">arr2 = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=np.int32)</div><div class="line">arr1.dtype</div><div class="line">arr2.dtype</div></pre></td></tr></table></figure><pre><code>dtype(&#39;float64&#39;)






dtype(&#39;int32&#39;)
</code></pre><p>当需要控制数据在内存和磁盘中的存储方式时（尤其是对大数据集），那就得了解如何控制存储类型</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line">arr.dtype</div><div class="line">float_arr = arr.astype(np.float64) </div><div class="line">float_arr.dtype</div></pre></td></tr></table></figure><pre><code>dtype(&#39;int32&#39;)






dtype(&#39;float64&#39;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.array([<span class="number">3.7</span>, <span class="number">-1.2</span>, <span class="number">-2.6</span>, <span class="number">0.5</span>, <span class="number">12.9</span>, <span class="number">10.1</span>])</div><div class="line">arr</div><div class="line">arr.astype(np.int32)</div></pre></td></tr></table></figure><pre><code>array([  3.7,  -1.2,  -2.6,   0.5,  12.9,  10.1])






array([ 3, -1, -2,  0, 12, 10])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">numeric_strings = np.array([<span class="string">'1.25'</span>, <span class="string">'-9.6'</span>, <span class="string">'42'</span>], dtype=np.string_)</div><div class="line">numeric_strings.astype(float)</div></pre></td></tr></table></figure><pre><code>array([  1.25,  -9.6 ,  42.  ])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">int_array = np.arange(<span class="number">10</span>)</div><div class="line">calibers = np.array([<span class="number">.22</span>, <span class="number">.270</span>, <span class="number">.357</span>, <span class="number">.380</span>, <span class="number">.44</span>, <span class="number">.50</span>], dtype=np.float64)</div><div class="line">int_array.astype(calibers.dtype)</div></pre></td></tr></table></figure><pre><code>array([ 0.,  1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9.])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">empty_uint32 = np.empty(<span class="number">8</span>, dtype=<span class="string">'u4'</span>)</div><div class="line">empty_uint32</div></pre></td></tr></table></figure><pre><code>array([1, 2, 3, 4, 5, 6, 7, 8], dtype=uint32)
</code></pre><p>调用astype会创建原数组的一份拷贝</p><h3 id="数组和标量之间的运算"><a href="#数组和标量之间的运算" class="headerlink" title="数组和标量之间的运算"></a>数组和标量之间的运算</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = np.array([[<span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>], [<span class="number">4.</span>, <span class="number">5.</span>, <span class="number">6.</span>]])</div><div class="line">arr</div><div class="line">arr * arr</div><div class="line">arr - arr</div></pre></td></tr></table></figure><pre><code>array([[ 1.,  2.,  3.],
       [ 4.,  5.,  6.]])






array([[  1.,   4.,   9.],
       [ 16.,  25.,  36.]])






array([[ 0.,  0.,  0.],
       [ 0.,  0.,  0.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span> / arr</div><div class="line">arr ** <span class="number">0.5</span></div></pre></td></tr></table></figure><pre><code>array([[ 1.    ,  0.5   ,  0.3333],
       [ 0.25  ,  0.2   ,  0.1667]])






array([[ 1.    ,  1.4142,  1.7321],
       [ 2.    ,  2.2361,  2.4495]])
</code></pre><h3 id="基本的索引和切片"><a href="#基本的索引和切片" class="headerlink" title="基本的索引和切片"></a>基本的索引和切片</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">10</span>)</div><div class="line">arr</div><div class="line">arr[<span class="number">5</span>]</div><div class="line">arr[<span class="number">5</span>:<span class="number">8</span>]</div><div class="line">arr[<span class="number">5</span>:<span class="number">8</span>] = <span class="number">12</span></div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])






5






array([5, 6, 7])






array([ 0,  1,  2,  3,  4, 12, 12, 12,  8,  9])
</code></pre><p>切片直接在原数组上操作<br>如果想要得到一个复制的版本，需要显示地调用copy()方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">arr_slice = arr[<span class="number">5</span>:<span class="number">8</span>]</div><div class="line">arr_slice[<span class="number">1</span>] = <span class="number">12345</span></div><div class="line">arr</div><div class="line">arr_slice[:] = <span class="number">64</span></div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([    0,     1,     2,     3,     4,    12, 12345,    12,     8,     9])






array([ 0,  1,  2,  3,  4, 64, 64, 64,  8,  9])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr2d = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]])</div><div class="line">arr2d[<span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>array([7, 8, 9])
</code></pre><p>注意下面这种索引方式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr2d[<span class="number">0</span>][<span class="number">2</span>]</div><div class="line">arr2d[<span class="number">0</span>, <span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>3






3
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr3d = np.array([[[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]], [[<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>], [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]]])</div><div class="line">arr3d</div></pre></td></tr></table></figure><pre><code>array([[[ 1,  2,  3],
        [ 4,  5,  6]],

       [[ 7,  8,  9],
        [10, 11, 12]]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr3d[<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>array([[1, 2, 3],
       [4, 5, 6]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">old_values = arr3d[<span class="number">0</span>].copy()</div><div class="line">arr3d[<span class="number">0</span>] = <span class="number">42</span></div><div class="line">arr3d</div><div class="line">arr3d[<span class="number">0</span>] = old_values</div><div class="line">arr3d</div></pre></td></tr></table></figure><pre><code>array([[[42, 42, 42],
        [42, 42, 42]],

       [[ 7,  8,  9],
        [10, 11, 12]]])






array([[[ 1,  2,  3],
        [ 4,  5,  6]],

       [[ 7,  8,  9],
        [10, 11, 12]]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr3d[<span class="number">1</span>, <span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>array([7, 8, 9])
</code></pre><h4 id="切片索引"><a href="#切片索引" class="headerlink" title="切片索引"></a>切片索引</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr[<span class="number">1</span>:<span class="number">6</span>]</div></pre></td></tr></table></figure><pre><code>array([ 1,  2,  3,  4, 64])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr2d</div><div class="line">arr2d[:<span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>array([[1, 2, 3],
       [4, 5, 6],
       [7, 8, 9]])






array([[1, 2, 3],
       [4, 5, 6]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr2d[:<span class="number">2</span>, <span class="number">1</span>:]</div></pre></td></tr></table></figure><pre><code>array([[2, 3],
       [5, 6]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr2d[<span class="number">1</span>, :<span class="number">2</span>]</div><div class="line">arr2d[<span class="number">2</span>, :<span class="number">1</span>]</div></pre></td></tr></table></figure><pre><code>array([4, 5])






array([7])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr2d[:, :<span class="number">1</span>]</div></pre></td></tr></table></figure><pre><code>array([[1],
       [4],
       [7]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr2d[:<span class="number">2</span>, <span class="number">1</span>:] = <span class="number">0</span></div></pre></td></tr></table></figure><h3 id="布尔型索引"><a href="#布尔型索引" class="headerlink" title="布尔型索引"></a>布尔型索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">names = np.array([<span class="string">'Bob'</span>, <span class="string">'Joe'</span>, <span class="string">'Will'</span>, <span class="string">'Bob'</span>, <span class="string">'Will'</span>, <span class="string">'Joe'</span>, <span class="string">'Joe'</span>])</div><div class="line">data = randn(<span class="number">7</span>, <span class="number">4</span>)</div><div class="line">names</div><div class="line">data</div></pre></td></tr></table></figure><pre><code>array([&#39;Bob&#39;, &#39;Joe&#39;, &#39;Will&#39;, &#39;Bob&#39;, &#39;Will&#39;, &#39;Joe&#39;, &#39;Joe&#39;], 
      dtype=&#39;&lt;U4&#39;)






array([[-2.9033,  1.4721,  0.9512,  1.7727],
       [ 2.2303, -1.0259,  1.0664,  0.534 ],
       [-0.9725,  0.2226, -0.1538, -0.4994],
       [-1.4289,  0.1665, -1.2874, -1.0817],
       [ 1.3581, -1.0734, -0.1387,  0.1673],
       [ 1.2816,  1.8883,  0.5699, -0.5843],
       [-0.0464, -0.9633,  0.2855, -0.6473]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">names == <span class="string">'Bob'</span></div></pre></td></tr></table></figure><pre><code>array([ True, False, False,  True, False, False, False], dtype=bool)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[names == <span class="string">'Bob'</span>]</div></pre></td></tr></table></figure><pre><code>array([[-2.9033,  1.4721,  0.9512,  1.7727],
       [-1.4289,  0.1665, -1.2874, -1.0817]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data[names == <span class="string">'Bob'</span>, <span class="number">2</span>:]</div><div class="line">data[names == <span class="string">'Bob'</span>, <span class="number">3</span>]</div></pre></td></tr></table></figure><pre><code>array([[ 0.9512,  1.7727],
       [-1.2874, -1.0817]])






array([ 1.7727, -1.0817])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">names != <span class="string">'Bob'</span></div><div class="line">data[~(names == <span class="string">'Bob'</span>)]</div></pre></td></tr></table></figure><pre><code>array([False,  True,  True, False,  True,  True,  True], dtype=bool)






array([[ 2.2303, -1.0259,  1.0664,  0.534 ],
       [-0.9725,  0.2226, -0.1538, -0.4994],
       [ 1.3581, -1.0734, -0.1387,  0.1673],
       [ 1.2816,  1.8883,  0.5699, -0.5843],
       [-0.0464, -0.9633,  0.2855, -0.6473]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mask = (names == <span class="string">'Bob'</span>) | (names == <span class="string">'Will'</span>)</div><div class="line">mask</div><div class="line">data[mask]</div></pre></td></tr></table></figure><pre><code>array([ True, False,  True,  True,  True, False, False], dtype=bool)






array([[-2.9033,  1.4721,  0.9512,  1.7727],
       [-0.9725,  0.2226, -0.1538, -0.4994],
       [-1.4289,  0.1665, -1.2874, -1.0817],
       [ 1.3581, -1.0734, -0.1387,  0.1673]])
</code></pre><p><strong>Python关键字and和or在布尔型数组中无效</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data[data &lt; <span class="number">0</span>] = <span class="number">0</span></div><div class="line">data</div></pre></td></tr></table></figure><pre><code>array([[ 0.    ,  1.4721,  0.9512,  1.7727],
       [ 2.2303,  0.    ,  1.0664,  0.534 ],
       [ 0.    ,  0.2226,  0.    ,  0.    ],
       [ 0.    ,  0.1665,  0.    ,  0.    ],
       [ 1.3581,  0.    ,  0.    ,  0.1673],
       [ 1.2816,  1.8883,  0.5699,  0.    ],
       [ 0.    ,  0.    ,  0.2855,  0.    ]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data[names != <span class="string">'Joe'</span>] = <span class="number">7</span></div><div class="line">data</div></pre></td></tr></table></figure><pre><code>array([[ 7.    ,  7.    ,  7.    ,  7.    ],
       [ 2.2303,  0.    ,  1.0664,  0.534 ],
       [ 7.    ,  7.    ,  7.    ,  7.    ],
       [ 7.    ,  7.    ,  7.    ,  7.    ],
       [ 7.    ,  7.    ,  7.    ,  7.    ],
       [ 1.2816,  1.8883,  0.5699,  0.    ],
       [ 0.    ,  0.    ,  0.2855,  0.    ]])
</code></pre><h3 id="花式索引"><a href="#花式索引" class="headerlink" title="花式索引"></a>花式索引</h3><p>花式索引创建新的数组</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = np.empty((<span class="number">8</span>, <span class="number">4</span>))</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</div><div class="line">    arr[i] = i</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[ 0.,  0.,  0.,  0.],
       [ 1.,  1.,  1.,  1.],
       [ 2.,  2.,  2.,  2.],
       [ 3.,  3.,  3.,  3.],
       [ 4.,  4.,  4.,  4.],
       [ 5.,  5.,  5.,  5.],
       [ 6.,  6.,  6.,  6.],
       [ 7.,  7.,  7.,  7.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr[[<span class="number">4</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">6</span>]]</div></pre></td></tr></table></figure><pre><code>array([[ 4.,  4.,  4.,  4.],
       [ 3.,  3.,  3.,  3.],
       [ 0.,  0.,  0.,  0.],
       [ 6.,  6.,  6.,  6.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr[[<span class="number">-3</span>, <span class="number">-5</span>, <span class="number">-7</span>]]</div></pre></td></tr></table></figure><pre><code>array([[ 5.,  5.,  5.,  5.],
       [ 3.,  3.,  3.,  3.],
       [ 1.,  1.,  1.,  1.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># more on reshape in Chapter 12</span></div><div class="line">arr = np.arange(<span class="number">32</span>).reshape((<span class="number">8</span>, <span class="number">4</span>))</div><div class="line">arr</div><div class="line">arr[[<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">2</span>], [<span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>]]</div></pre></td></tr></table></figure><pre><code>array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11],
       [12, 13, 14, 15],
       [16, 17, 18, 19],
       [20, 21, 22, 23],
       [24, 25, 26, 27],
       [28, 29, 30, 31]])






array([ 4, 23, 29, 10])
</code></pre><p>根据以上可知，传入两个索引数组相当于进行了同位置组合</p><p>注意以下这种方式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr[[<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">2</span>]][:, [<span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>]]</div></pre></td></tr></table></figure><pre><code>array([[ 4,  7,  5,  6],
       [20, 23, 21, 22],
       [28, 31, 29, 30],
       [ 8, 11,  9, 10]])
</code></pre><p>np.ix_方法将两个一维数组转换为一个矩形区域的索引选择器</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr[np.ix_([<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">2</span>], [<span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>])]</div></pre></td></tr></table></figure><pre><code>array([[ 4,  7,  5,  6],
       [20, 23, 21, 22],
       [28, 31, 29, 30],
       [ 8, 11,  9, 10]])
</code></pre><h3 id="数组转置和轴对换"><a href="#数组转置和轴对换" class="headerlink" title="数组转置和轴对换"></a>数组转置和轴对换</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">15</span>).reshape((<span class="number">3</span>, <span class="number">5</span>))</div><div class="line">arr</div><div class="line">arr.T</div></pre></td></tr></table></figure><pre><code>array([[ 0,  1,  2,  3,  4],
       [ 5,  6,  7,  8,  9],
       [10, 11, 12, 13, 14]])






array([[ 0,  5, 10],
       [ 1,  6, 11],
       [ 2,  7, 12],
       [ 3,  8, 13],
       [ 4,  9, 14]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = np.random.randn(<span class="number">6</span>, <span class="number">3</span>)</div><div class="line">np.dot(arr.T, arr)</div></pre></td></tr></table></figure><pre><code>array([[ 3.6804,  0.0133,  1.0388],
       [ 0.0133,  1.6074,  0.1836],
       [ 1.0388,  0.1836,  3.5281]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">16</span>).reshape((<span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>))</div><div class="line">arr</div><div class="line">arr.transpose((<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>))</div></pre></td></tr></table></figure><pre><code>array([[[ 0,  1,  2,  3],
        [ 4,  5,  6,  7]],

       [[ 8,  9, 10, 11],
        [12, 13, 14, 15]]])






array([[[ 0,  1,  2,  3],
        [ 8,  9, 10, 11]],

       [[ 4,  5,  6,  7],
        [12, 13, 14, 15]]])
</code></pre><p>Refered from <a href="http://stackoverflow.com/questions/32034237/how-does-numpy-ndarray-transpose-permute-the-axis-of-n-d-array" target="_blank" rel="external">here</a>.</p><p>In short: transposing an array means that NumPy just needs to permute the stride and shape information for each axis:</p><pre><code>&gt;&gt;&gt; arr.strides
(64, 32, 8)

&gt;&gt;&gt; arr.transpose(1, 0, 2).strides
(32, 64, 8)
</code></pre><p>Notice that the strides for the first and second axes were swapped here. This means that no data needs to be copied; NumPy can simply change how it looks at the memory to construct the array.</p><hr><p>What are strides?</p><p>The values in a 3D array <code>arr</code> are stored in a contiguous block of memory like this:</p><pre><code>[ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15]
</code></pre><p>In the case of <code>arr</code>, each integer takes up 8 bytes of memory (i.e. we’re using the int64 dtype).</p><p>A stride tells NumPy how many bytes to skip in order to move to the next value along an axis. For example, to get the next value in a row in <code>arr</code> (axis 2), we just need to move 8 bytes (1 number).</p><p>The strides for <code>arr.transpose(1, 0, 2)</code> are (32, 64, 8). To move along the first axis, instead of 64 bytes (8 numbers) NumPy will now only skip 32 bytes (4 numbers) each time:</p><pre><code>[[[0    ...]
  [...  ...]]

 [[4    ...]
  [...  ...]]]
</code></pre><p>Similarly, NumPy will now skip 64 bytes (8 numbers) in order to move along axis 1:</p><pre><code>[[[0    ...]
  [8    ...]]

 [[4    ...]
  [12   ...]]]
</code></pre><p>The actual code that does the transposing is written in C and can be found <a href="https://github.com/numpy/numpy/blob/467d4e16d77a2e7c131aac53c639e82b754578c7/numpy/core/src/multiarray/shape.c#l692" target="_blank" rel="external">here</a>.</p><p>也可以使用swapaxes方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr</div><div class="line">arr.swapaxes(<span class="number">1</span>, <span class="number">2</span>)</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[[ 0,  1,  2,  3],
        [ 4,  5,  6,  7]],

       [[ 8,  9, 10, 11],
        [12, 13, 14, 15]]])






array([[[ 0,  4],
        [ 1,  5],
        [ 2,  6],
        [ 3,  7]],

       [[ 8, 12],
        [ 9, 13],
        [10, 14],
        [11, 15]]])






array([[[ 0,  1,  2,  3],
        [ 4,  5,  6,  7]],

       [[ 8,  9, 10, 11],
        [12, 13, 14, 15]]])
</code></pre><h2 id="通用函数：快速的元素级数组函数"><a href="#通用函数：快速的元素级数组函数" class="headerlink" title="通用函数：快速的元素级数组函数"></a>通用函数：快速的元素级数组函数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">10</span>)</div><div class="line">np.sqrt(arr)</div><div class="line">np.exp(arr)</div></pre></td></tr></table></figure><pre><code>array([ 0.    ,  1.    ,  1.4142,  1.7321,  2.    ,  2.2361,  2.4495,
        2.6458,  2.8284,  3.    ])






array([    1.    ,     2.7183,     7.3891,    20.0855,    54.5982,
         148.4132,   403.4288,  1096.6332,  2980.958 ,  8103.0839])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x = randn(<span class="number">8</span>)</div><div class="line">y = randn(<span class="number">8</span>)</div><div class="line">x</div><div class="line">y</div><div class="line">np.maximum(x, y) <span class="comment"># 对应元素进行比较</span></div></pre></td></tr></table></figure><pre><code>array([ 0.811 , -0.0214, -0.3702, -0.4856,  1.1449, -0.4246,  0.9396,
        0.0382])






array([-1.223 ,  0.3271, -1.7197, -2.2636, -0.1154, -1.4122, -0.0989,
        0.4477])






array([ 0.811 ,  0.3271, -0.3702, -0.4856,  1.1449, -0.4246,  0.9396,
        0.4477])
</code></pre><p>modf函数挺有意思</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">7</span>) * <span class="number">5</span></div><div class="line">arr</div><div class="line">np.modf(arr)</div></pre></td></tr></table></figure><pre><code>array([ 10.3171,  -4.733 ,  -6.3358,   3.2457,  -7.3823,   2.7036,  -2.6173])






(array([ 0.3171, -0.733 , -0.3358,  0.2457, -0.3823,  0.7036, -0.6173]),
 array([ 10.,  -4.,  -6.,   3.,  -7.,   2.,  -2.]))
</code></pre><h2 id="利用数组进行数据处理"><a href="#利用数组进行数据处理" class="headerlink" title="利用数组进行数据处理"></a>利用数组进行数据处理</h2><p>meshgrid产生两个二维数组，对应points中所有的二元组</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">points = np.arange(<span class="number">-5</span>, <span class="number">5</span>, <span class="number">0.01</span>) <span class="comment"># 1000 equally spaced points</span></div><div class="line">xs, ys = np.meshgrid(points, points)</div><div class="line">xs</div><div class="line">ys</div></pre></td></tr></table></figure><pre><code>array([[-5.  , -4.99, -4.98, ...,  4.97,  4.98,  4.99],
       [-5.  , -4.99, -4.98, ...,  4.97,  4.98,  4.99],
       [-5.  , -4.99, -4.98, ...,  4.97,  4.98,  4.99],
       ..., 
       [-5.  , -4.99, -4.98, ...,  4.97,  4.98,  4.99],
       [-5.  , -4.99, -4.98, ...,  4.97,  4.98,  4.99],
       [-5.  , -4.99, -4.98, ...,  4.97,  4.98,  4.99]])






array([[-5.  , -5.  , -5.  , ..., -5.  , -5.  , -5.  ],
       [-4.99, -4.99, -4.99, ..., -4.99, -4.99, -4.99],
       [-4.98, -4.98, -4.98, ..., -4.98, -4.98, -4.98],
       ..., 
       [ 4.97,  4.97,  4.97, ...,  4.97,  4.97,  4.97],
       [ 4.98,  4.98,  4.98, ...,  4.98,  4.98,  4.98],
       [ 4.99,  4.99,  4.99, ...,  4.99,  4.99,  4.99]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> matplotlib.pyplot <span class="keyword">import</span> imshow, title</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">z = np.sqrt(xs ** <span class="number">2</span> + ys ** <span class="number">2</span>)</div><div class="line">z</div><div class="line">plt.imshow(z, cmap=plt.cm.gray); plt.colorbar()</div><div class="line">plt.title(<span class="string">"Image plot of $\sqrt&#123;x^2 + y^2&#125;$ for a grid of values"</span>)</div></pre></td></tr></table></figure><pre><code>array([[ 7.0711,  7.064 ,  7.0569, ...,  7.0499,  7.0569,  7.064 ],
       [ 7.064 ,  7.0569,  7.0499, ...,  7.0428,  7.0499,  7.0569],
       [ 7.0569,  7.0499,  7.0428, ...,  7.0357,  7.0428,  7.0499],
       ..., 
       [ 7.0499,  7.0428,  7.0357, ...,  7.0286,  7.0357,  7.0428],
       [ 7.0569,  7.0499,  7.0428, ...,  7.0357,  7.0428,  7.0499],
       [ 7.064 ,  7.0569,  7.0499, ...,  7.0428,  7.0499,  7.0569]])






&lt;matplotlib.image.AxesImage at 0x23400a22b38&gt;






&lt;matplotlib.colorbar.Colorbar at 0x23400a7c7b8&gt;






&lt;matplotlib.text.Text at 0x23400a03da0&gt;
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch04/meshgrid.png" alt="meshgrid"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plt.draw()</div></pre></td></tr></table></figure><pre><code>&lt;matplotlib.figure.Figure at 0x23401396eb8&gt;
</code></pre><h3 id="将条件逻辑表述为数组运算"><a href="#将条件逻辑表述为数组运算" class="headerlink" title="将条件逻辑表述为数组运算"></a>将条件逻辑表述为数组运算</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">xarr = np.array([<span class="number">1.1</span>, <span class="number">1.2</span>, <span class="number">1.3</span>, <span class="number">1.4</span>, <span class="number">1.5</span>])</div><div class="line">yarr = np.array([<span class="number">2.1</span>, <span class="number">2.2</span>, <span class="number">2.3</span>, <span class="number">2.4</span>, <span class="number">2.5</span>])</div><div class="line">cond = np.array([<span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">True</span>, <span class="keyword">True</span>, <span class="keyword">False</span>])</div></pre></td></tr></table></figure><p>注意下面列表生成式的写法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">result = [(x <span class="keyword">if</span> c <span class="keyword">else</span> y)</div><div class="line">          <span class="keyword">for</span> x, y, c <span class="keyword">in</span> zip(xarr, yarr, cond)]</div><div class="line">result</div></pre></td></tr></table></figure><pre><code>[1.1000000000000001, 2.2000000000000002, 1.3, 1.3999999999999999, 2.5]
</code></pre><p>上述方法具有一些缺点：</p><ol><li>大数组处理速度慢（纯Python实现）</li><li>无法处理多维数组</li></ol><p>所以可以使用下面这种方法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = np.where(cond, xarr, yarr)</div><div class="line">result</div></pre></td></tr></table></figure><pre><code>array([ 1.1,  2.2,  1.3,  1.4,  2.5])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">4</span>, <span class="number">4</span>)</div><div class="line">arr</div><div class="line">np.where(arr &gt; <span class="number">0</span>, <span class="number">2</span>, <span class="number">-2</span>)</div><div class="line">np.where(arr &gt; <span class="number">0</span>, <span class="number">2</span>, arr) <span class="comment"># set only positive values to 2</span></div></pre></td></tr></table></figure><pre><code>array([[-0.7355, -0.3188, -0.2358,  0.3137],
       [-0.6196, -0.5803, -0.5504, -1.1508],
       [ 0.1719, -1.1599, -0.7115,  1.7869],
       [-0.2306,  0.2068,  1.5366,  1.6154]])






array([[-2, -2, -2,  2],
       [-2, -2, -2, -2],
       [ 2, -2, -2,  2],
       [-2,  2,  2,  2]])






array([[-0.7355, -0.3188, -0.2358,  2.    ],
       [-0.6196, -0.5803, -0.5504, -1.1508],
       [ 2.    , -1.1599, -0.7115,  2.    ],
       [-0.2306,  2.    ,  2.    ,  2.    ]])
</code></pre><p>显然<code>where</code>还可以应用于更复杂的操作。<br>考虑下面这种逻辑：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">result = []</div><div class="line">for i in range(n):</div><div class="line">    if cond1[i] and cond2[i]:</div><div class="line">        result.append(0)</div><div class="line">    elif cond1[i]:</div><div class="line">        result.append(1)</div><div class="line">    elif cond2[i]:</div><div class="line">        result.append(2)</div><div class="line">    else:</div><div class="line">        result.append(3)</div></pre></td></tr></table></figure><p>用<code>where</code>可以这样实现：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">np.where(cond1 &amp; cond2, 0,</div><div class="line">         np.where(cond1, 1,</div><div class="line">                  np.where(cond2, 2, 3)))</div></pre></td></tr></table></figure><p>更加magic一点：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">result = 1 * cond1 + 2 * cond2 + 3 * -(cond1 | cond2)</div></pre></td></tr></table></figure><h3 id="数学和统计方法"><a href="#数学和统计方法" class="headerlink" title="数学和统计方法"></a>数学和统计方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">arr = np.random.randn(<span class="number">5</span>, <span class="number">4</span>) <span class="comment"># 正态分布</span></div><div class="line">arr</div><div class="line"><span class="comment"># 下面两种方式都可以使用</span></div><div class="line">arr.mean()</div><div class="line">np.mean(arr)</div><div class="line">arr.sum()</div></pre></td></tr></table></figure><pre><code>array([[ 1.4513, -0.8225,  0.7011, -0.617 ],
       [ 1.5872,  1.2937,  1.0151,  0.7123],
       [-0.2012, -0.0168, -0.3847,  0.5274],
       [-0.6312, -0.2762,  0.4869,  0.0462],
       [-0.5268, -1.1071,  1.8642,  0.2282]])






0.26650934393195791






0.26650934393195791






5.3301868786391582
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr.mean(axis=<span class="number">1</span>)</div><div class="line">arr.sum(<span class="number">0</span>) <span class="comment"># axis=0</span></div></pre></td></tr></table></figure><pre><code>array([ 0.1782,  1.1521, -0.0188, -0.0936,  0.1146])






array([ 1.6793, -0.9289,  3.6826,  0.8971])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = np.array([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]])</div><div class="line">arr</div><div class="line">arr.cumsum(<span class="number">0</span>) <span class="comment"># axis=0</span></div><div class="line">arr.cumprod(<span class="number">1</span>) <span class="comment"># axis=1</span></div></pre></td></tr></table></figure><pre><code>array([[0, 1, 2],
       [3, 4, 5],
       [6, 7, 8]])






array([[ 0,  1,  2],
       [ 3,  5,  7],
       [ 9, 12, 15]], dtype=int32)






array([[  0,   0,   0],
       [  3,  12,  60],
       [  6,  42, 336]], dtype=int32)
</code></pre><h3 id="用于布尔数组的方法"><a href="#用于布尔数组的方法" class="headerlink" title="用于布尔数组的方法"></a>用于布尔数组的方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">100</span>)</div><div class="line">arr</div><div class="line">(arr &gt; <span class="number">0</span>).sum() <span class="comment"># Number of positive values</span></div></pre></td></tr></table></figure><pre><code>array([ 0.7828,  0.1372, -0.6264,  1.8927, -0.2104,  0.2822, -0.3672,
       -0.3601,  0.5918,  0.9285,  0.1808, -0.4021,  0.4086, -0.2949,
        0.5633, -0.7462, -0.1635,  0.1482, -0.3226, -1.2127, -0.9821,
        0.0536, -0.1772, -0.4714, -0.9002, -0.0037,  0.7352,  0.5675,
       -1.1612,  0.5288,  0.3319,  0.7315,  0.6841, -0.6881,  1.5654,
       -0.4605, -0.5423,  0.0184, -0.8153, -0.1313,  0.4594,  0.0228,
        0.255 , -2.2361,  0.8703, -1.5153, -0.9458,  0.2769,  0.9986,
        0.7699, -0.7948, -1.2508,  1.7059,  0.1805, -1.0265, -0.0181,
       -0.9415,  0.1265, -0.2576,  0.6791,  0.3969,  0.8027, -0.6792,
       -0.7487, -1.9949, -0.9595,  0.5706, -0.5727, -1.0204,  0.1521,
       -0.9755, -0.4094,  0.67  ,  0.212 ,  0.4081, -0.1435,  0.3964,
       -0.1865, -0.6018, -2.6185, -0.5073, -0.6328, -0.2631,  0.6637,
       -0.5586,  1.3346, -0.5317,  0.8572,  1.1159,  0.9563, -0.0434,
       -1.0534,  0.5869,  0.0502, -0.0479, -0.8673,  0.1531,  1.0646,
       -0.2624, -0.3726])






47
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">bools = np.array([<span class="keyword">False</span>, <span class="keyword">False</span>, <span class="keyword">True</span>, <span class="keyword">False</span>])</div><div class="line">bools</div><div class="line">bools.any()</div><div class="line">bools.all()</div></pre></td></tr></table></figure><pre><code>array([False, False,  True, False], dtype=bool)






True






False
</code></pre><h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">8</span>)</div><div class="line">arr</div><div class="line">arr.sort()</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([ 1.0584,  1.9062, -0.2923,  0.7169,  0.5186, -0.6089, -2.0444,
       -0.5661])






array([-2.0444, -0.6089, -0.5661, -0.2923,  0.5186,  0.7169,  1.0584,
        1.9062])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">5</span>, <span class="number">3</span>)</div><div class="line">arr</div><div class="line">arr.sort(<span class="number">1</span>) <span class="comment"># axis=1</span></div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[ 0.0118, -2.8916, -0.4477],
       [-1.9768,  1.859 , -1.128 ],
       [-2.6262,  0.5791,  0.7594],
       [-0.5254, -0.9059,  0.0203],
       [-1.4029, -1.8566,  0.1892]])






array([[-2.8916, -0.4477,  0.0118],
       [-1.9768, -1.128 ,  1.859 ],
       [-2.6262,  0.5791,  0.7594],
       [-0.9059, -0.5254,  0.0203],
       [-1.8566, -1.4029,  0.1892]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">large_arr = randn(<span class="number">1000</span>)</div><div class="line">large_arr</div><div class="line">large_arr.sort()</div><div class="line">large_arr</div><div class="line">large_arr[int(<span class="number">0.05</span> * len(large_arr))] <span class="comment"># 5% quantile</span></div></pre></td></tr></table></figure><pre><code>array([ 1.2296,  0.3794, -0.1526,  2.1223, -0.0675,  0.6867, -0.5742,
       -1.4291,  0.6856,  0.1364, -0.3966, -0.7793,  0.4965,  0.2447,
       -0.7487,  0.7695,  0.5358, -0.4813,  0.9949, -0.6489, -0.3656,
        1.9551,  0.8327,  1.497 , -0.4431, -0.8357, -0.821 , -0.7348,
        1.9294, -0.3144,  0.1396, -0.9111,  0.0943,  0.8043,  1.067 ,
        0.9362, -2.2574,  0.7475, -1.0152, -1.1234, -0.3774,  1.076 ,
        0.8743,  1.1864,  0.0801,  0.3995,  0.2536, -0.9371, -1.669 ,
       -2.2444,  1.2544,  1.0539, -0.7579,  0.2963,  0.7496, -1.3655,
        0.1552, -0.6259,  0.2621, -1.5415, -0.1036, -0.5794,  1.2098,
        1.3388,  0.3159,  1.0998,  0.5109, -0.3927,  1.4797, -1.4891,
        0.3624,  0.966 ,  0.0756, -0.4703,  0.1859,  1.6091,  0.662 ,
       -0.4808,  0.8744,  0.4738,  1.1351,  0.0251, -1.017 , -0.849 ,
       -0.1602, -1.5392,  0.0601,  1.7323,  1.1837,  0.4657,  0.8858,
       -0.211 ,  0.1865,  0.673 ,  0.3086, -1.2527, -0.7802,  0.407 ,
       -1.118 , -0.2058,  0.7921,  0.5284, -2.3038, -0.4038, -1.1087,
       -0.827 , -2.6518,  0.3711, -0.0244,  1.1103,  0.2748, -0.7962,
        1.9456,  0.5347,  0.1862, -0.3734, -0.3036,  0.6831, -0.9419,
        1.4848, -0.1247, -0.4138, -0.601 ,  0.6138,  1.1334,  0.4386,
        0.0466, -0.0588,  0.6883, -1.2912, -0.2381,  0.3934,  0.2132,
       -0.4143,  1.0844, -0.5258, -0.9944,  1.0977,  0.3528,  1.9928,
        1.421 ,  0.8634,  0.1973, -1.1799, -2.9433,  2.697 ,  0.4778,
        0.6464,  0.049 , -0.2339,  1.6945, -0.6568, -0.5972, -0.8324,
       -0.6443,  0.0882, -0.3686,  0.0419,  0.5119, -0.641 ,  1.1545,
        1.0735, -0.5329, -0.1126,  0.0375, -1.0699, -1.3153, -1.6097,
        2.5671, -0.9516, -0.388 , -0.0129, -0.0171, -1.0763, -0.7125,
        0.767 ,  0.2254, -0.7638, -0.2065,  1.2797,  0.0784, -0.7762,
        1.7106, -0.0136, -0.4435,  1.2946, -2.5489,  0.4241,  0.5675,
       -0.7596,  0.6128,  1.1161, -1.2456, -0.131 , -0.2684,  1.6461,
       -0.2497, -0.4294,  1.122 ,  0.5969,  0.3335, -0.0453,  1.1567,
        0.0216, -0.7277, -2.5465, -2.4542, -1.5895,  0.4607, -0.8303,
        0.0263,  0.0301, -1.2365, -0.146 , -0.8632,  0.6449,  0.1958,
       -0.6914, -0.3223,  0.4037,  0.9918, -0.3542,  0.8442,  0.7751,
       -1.6248,  2.6081,  0.3524,  1.5298,  0.4421,  1.5228, -1.5263,
       -1.3994,  0.0285, -0.5389,  1.4047, -2.1117, -1.0397,  0.6495,
        0.9073,  1.8738,  0.2913, -1.069 , -0.7835, -0.6437,  0.6739,
        0.3272, -0.8483, -0.2971,  0.2882,  0.1778, -0.6705, -1.4129,
       -0.1935,  0.6615, -0.4423, -1.2472, -0.9816,  0.927 , -2.2774,
        0.5736,  1.3996,  1.1653, -0.3253, -0.2074, -0.2447,  0.4925,
        1.8415, -1.1551, -0.5131, -0.6407,  0.5033, -0.817 ,  0.0479,
       -0.9106,  1.4391, -1.5824, -0.4652,  1.253 , -0.6051,  0.6699,
        0.3803,  1.0767,  1.5449,  0.106 , -0.7215, -0.354 ,  0.1016,
       -1.3191, -0.6596, -0.9632, -0.3655,  0.8411, -0.2314,  1.9493,
       -0.6966, -1.2598,  0.4023,  0.1704, -0.452 ,  1.5924,  0.381 ,
       -0.4731, -1.2467, -0.4264, -0.2298, -0.1792, -0.5009, -1.0032,
        1.0126,  0.5436,  1.1366, -1.0318,  1.3289,  0.3218, -0.2828,
        0.5597, -0.0213, -0.078 ,  0.7667, -0.3984, -1.0263, -0.5557,
       -2.0724, -0.9343, -0.6877,  1.0567, -0.605 ,  1.7923,  0.6351,
       -1.769 ,  0.4175,  0.8266,  0.3767, -0.1508, -0.4301, -0.3397,
        0.7248,  0.188 ,  1.1632, -1.0831, -0.5726, -0.475 ,  0.092 ,
       -0.1566,  1.9074, -1.4261,  1.8589, -0.7534, -1.0767, -0.2704,
        0.7567,  0.5903, -1.5612, -1.1097,  0.3504, -0.9086, -0.1691,
        0.6714, -0.6033,  1.8315, -0.8141,  0.5968, -0.408 , -1.1843,
        0.5146,  0.6201,  0.4293,  0.9797,  1.066 , -1.3325, -1.733 ,
        0.8545,  0.3993, -0.2041, -0.4624,  0.0272, -0.005 ,  0.9237,
       -0.5523,  0.9975, -0.4374,  0.1351, -0.6148,  0.3185,  0.0572,
       -0.3002,  0.0889, -0.0894, -0.5617, -2.0553, -0.2923,  0.7227,
        0.604 , -0.6623, -0.6126, -0.4991,  0.0923, -0.6982,  0.2099,
       -0.6853, -0.4752, -1.625 ,  0.0443,  2.5507, -1.1597,  0.3504,
       -0.7654, -1.4366, -1.3755,  0.3702, -1.7853, -0.7326, -1.2803,
       -0.6089, -0.4472,  0.462 ,  0.7799,  0.3141,  0.8064, -1.0487,
        0.7317, -0.2446,  0.3061,  0.1384, -0.572 , -0.0311,  0.3572,
       -0.6371, -0.2236,  0.0806,  0.6648, -0.148 , -0.2547,  1.3649,
       -0.1595,  1.3632, -0.8858,  1.1801,  0.5533,  2.3306,  0.2724,
        0.7073, -0.5605, -0.8849,  0.9533,  0.3683, -0.2901, -0.0453,
        0.1064,  1.3342, -0.7036,  0.7127,  1.2156,  0.9017,  1.2378,
       -1.1017,  1.0558,  1.4273,  0.7003,  1.1649,  0.0334,  0.3433,
       -0.3997, -0.1195,  1.3725, -0.3746,  0.8444,  0.961 , -0.2644,
        0.3245, -1.3583,  0.387 ,  1.2944,  0.0274, -0.5057,  0.15  ,
        0.6   , -0.5752,  0.3746,  1.7114, -0.0026, -0.1221, -0.8084,
       -0.9521, -0.6332,  0.7254,  1.7032, -0.0879,  0.3329, -1.9525,
       -0.7083, -0.4113,  1.163 ,  0.9018, -0.3667,  0.8419,  0.4417,
        0.2904,  0.1666,  1.3722, -0.4455, -1.4876,  0.4103,  2.3672,
        0.3569, -0.8546,  0.5152,  0.9623,  1.1777,  1.6789, -1.7793,
       -0.7797, -1.0923,  0.07  , -0.8974, -0.3151, -0.3675, -1.9851,
       -2.3352,  0.3566,  1.1929,  1.5275,  1.4349, -1.4742, -0.1913,
        1.5874, -0.7264, -0.5594,  0.3166, -0.9377, -0.6452,  0.394 ,
       -0.2238, -1.1239, -0.0324,  1.3866, -0.6174, -0.1301, -0.0328,
       -0.92  ,  1.8067,  0.2576, -0.5248,  0.4114,  0.1655, -0.1674,
        0.2743,  0.0835, -0.145 ,  1.1658,  1.2624,  0.0404,  2.0929,
        0.6047,  1.0317, -0.4956, -1.5666,  1.1729,  0.484 ,  0.955 ,
        1.0546,  0.0106,  0.5062,  0.3211,  0.8503,  0.4706,  1.9953,
       -0.9362,  0.6326, -0.3154,  1.4987, -0.1695,  1.0906, -0.686 ,
        0.2501, -0.316 ,  0.3032,  0.4873,  0.6402, -0.1209, -0.1857,
       -0.3707, -0.3082, -0.4769, -0.858 , -0.1521, -0.3403, -0.9853,
       -0.5049,  0.3338, -0.3197, -0.5789, -0.7124, -0.8867, -0.0228,
       -1.5519,  1.8517,  0.5229,  0.7613, -0.5586,  0.4827, -1.3011,
       -0.5284, -0.3806, -0.7719,  1.6304,  0.0375, -0.9122, -0.1006,
        0.382 ,  0.0969,  1.7784,  0.1831, -1.8866,  0.2996,  0.4778,
       -0.2491, -1.6537,  0.022 , -0.101 ,  0.5912, -0.2249, -1.1422,
       -0.6436, -1.4096, -0.7446,  0.8055,  1.0727,  0.2426, -0.8079,
       -1.4692,  0.062 , -0.4466,  0.3786, -2.0461,  0.7238, -1.6195,
        1.4005,  0.4881, -0.8161, -0.582 ,  0.3456,  1.2922,  0.2469,
        1.9035,  0.9072, -0.0729, -0.9424, -1.1129,  0.8922, -0.5628,
        1.6215, -0.7022,  0.8395, -0.3423,  0.6048, -0.248 ,  0.7411,
        0.3546,  0.6176, -0.8221, -0.338 , -2.1051, -1.0049, -0.0659,
        0.0917, -0.6661, -0.5234,  0.9574, -0.6316, -0.0047, -0.4773,
        0.1562, -0.116 , -1.6255, -0.9108, -1.4767, -0.7765, -1.7101,
        0.0557,  0.8112,  0.7382,  1.8806,  0.9239,  1.8638,  0.8426,
        0.0359,  0.2743,  1.9204,  1.2223,  0.4575, -0.3408,  0.3727,
        0.5036,  0.5392, -1.3331, -0.4008, -0.1341, -1.5197,  0.1923,
        0.2128,  1.1533, -1.4284, -0.7483, -0.4092,  1.2843, -0.4489,
       -0.6624,  0.9255, -0.0895,  0.3199, -0.2564, -0.1166, -1.4701,
        1.1799, -1.6238,  0.0508,  0.2312,  0.7322, -1.3623, -0.232 ,
       -0.2206,  0.566 ,  1.2411, -1.1563,  1.1777, -1.1481, -0.6716,
        0.4596, -0.2422, -0.8654,  0.4441,  0.1869,  1.4626,  0.7621,
        0.4249,  0.252 ,  0.632 ,  0.5626, -0.7925,  1.1995,  1.5665,
        0.6096,  0.4821, -0.7324, -0.7624,  1.858 , -0.8434, -0.4408,
        0.2011,  0.7552, -0.8955, -1.3255,  0.7022,  0.1507,  0.662 ,
       -1.2229,  0.5199,  0.9837, -0.3947, -0.5262, -1.0424, -1.4582,
        0.5126, -0.3606,  0.4427, -2.3922,  1.2784, -0.8382, -0.0198,
        1.2136, -0.4212, -0.7798, -1.3387, -0.7141,  0.9581, -0.8575,
       -0.2255,  0.8436, -2.2162,  0.0742,  0.9683, -0.3633, -0.0227,
       -1.2176,  1.1482, -0.6697,  0.9643, -1.2802, -0.3651, -1.29  ,
        0.851 ,  1.0167,  1.0011, -1.3014, -0.7205,  1.3621, -0.692 ,
        1.0637,  0.5637,  0.0851,  2.1514, -0.272 ,  0.3136,  0.2179,
        0.7035, -1.3028, -0.1032,  0.0611,  1.2002, -0.7346,  0.9991,
       -0.3747,  0.7908, -0.9573, -0.5114, -0.8607, -0.6711,  1.3335,
       -0.6671, -0.1687,  0.4601,  0.5747, -0.0767, -0.8428,  0.3372,
       -1.7756, -2.5264, -1.503 , -0.5669,  0.0167, -1.961 ,  0.8861,
        1.1902,  2.239 ,  0.2481,  0.7361, -1.1103,  0.8368, -1.0434,
        0.6809, -0.0839, -0.6972, -1.5492, -1.4129,  0.5889,  0.2138,
        1.7689, -0.4861, -0.1124,  0.2032,  1.0664, -0.369 ,  2.3793,
        0.4406, -1.1741,  1.0812,  1.3965, -0.149 ,  0.8793,  1.3494,
        1.2159, -0.0001,  1.1929, -0.1966, -0.1666,  1.7097, -0.4273,
        0.4831, -0.2411, -1.4517, -0.7317,  0.099 ,  1.7922,  0.2313,
       -0.5031, -0.0849,  0.7331, -0.1483, -0.8003,  1.1897,  0.031 ,
       -0.3624, -1.1133,  1.4647,  2.5653, -1.9536, -0.4528, -1.693 ,
        0.4847,  0.1368,  0.6859, -0.9872,  0.8425, -0.1492, -0.1335,
       -0.0229, -0.0903, -0.4381,  1.2552,  1.5763,  0.2375, -0.7597,
        0.0845,  0.0894, -1.6022, -0.1988,  0.3095, -1.0785, -1.6044,
       -0.4922,  0.4583,  0.3168, -2.0485, -1.2147, -0.2803, -0.2071,
        0.0767,  1.9544, -1.7648,  0.2873, -0.4029, -0.8128, -0.1081,
        0.0332,  2.5288,  0.9933,  0.4378, -0.8208, -0.2451,  0.3472,
       -0.2917,  2.0775,  1.7381, -0.467 , -0.8943, -1.4171, -0.3905,
        0.2591,  0.8118, -0.643 ,  1.0387,  0.0049,  1.7299, -0.6882,
       -1.4132, -1.0893,  0.4606, -1.546 , -2.87  ,  0.3492, -1.5968,
        0.9858,  0.1384, -0.6016, -0.9632, -0.9088,  0.3711,  1.3509,
        0.4601, -1.4963, -0.043 ,  0.5588,  0.2638, -1.1118, -0.9376,
       -0.9139,  0.6551,  0.4876, -1.7039, -0.2915,  0.3867, -0.1795,
        1.2298,  0.0893, -0.6019,  1.4109, -1.1918,  0.5009,  0.0157,
       -1.1307,  1.0407,  1.9742, -1.0377, -0.6151, -0.8398,  1.4096,
       -0.012 , -1.5323,  0.3323,  0.0539,  0.2383, -0.4059,  2.285 ,
        0.1536,  0.3838,  0.3623, -0.4326, -0.0975, -1.8119])






array([-2.9433, -2.87  , -2.6518, -2.5489, -2.5465, -2.5264, -2.4542,
       -2.3922, -2.3352, -2.3038, -2.2774, -2.2574, -2.2444, -2.2162,
       -2.1117, -2.1051, -2.0724, -2.0553, -2.0485, -2.0461, -1.9851,
       -1.961 , -1.9536, -1.9525, -1.8866, -1.8119, -1.7853, -1.7793,
       -1.7756, -1.769 , -1.7648, -1.733 , -1.7101, -1.7039, -1.693 ,
       -1.669 , -1.6537, -1.6255, -1.625 , -1.6248, -1.6238, -1.6195,
       -1.6097, -1.6044, -1.6022, -1.5968, -1.5895, -1.5824, -1.5666,
       -1.5612, -1.5519, -1.5492, -1.546 , -1.5415, -1.5392, -1.5323,
       -1.5263, -1.5197, -1.503 , -1.4963, -1.4891, -1.4876, -1.4767,
       -1.4742, -1.4701, -1.4692, -1.4582, -1.4517, -1.4366, -1.4291,
       -1.4284, -1.4261, -1.4171, -1.4132, -1.4129, -1.4129, -1.4096,
       -1.3994, -1.3755, -1.3655, -1.3623, -1.3583, -1.3387, -1.3331,
       -1.3325, -1.3255, -1.3191, -1.3153, -1.3028, -1.3014, -1.3011,
       -1.2912, -1.29  , -1.2803, -1.2802, -1.2598, -1.2527, -1.2472,
       -1.2467, -1.2456, -1.2365, -1.2229, -1.2176, -1.2147, -1.1918,
       -1.1843, -1.1799, -1.1741, -1.1597, -1.1563, -1.1551, -1.1481,
       -1.1422, -1.1307, -1.1239, -1.1234, -1.118 , -1.1133, -1.1129,
       -1.1118, -1.1103, -1.1097, -1.1087, -1.1017, -1.0923, -1.0893,
       -1.0831, -1.0785, -1.0767, -1.0763, -1.0699, -1.069 , -1.0487,
       -1.0434, -1.0424, -1.0397, -1.0377, -1.0318, -1.0263, -1.017 ,
       -1.0152, -1.0049, -1.0032, -0.9944, -0.9872, -0.9853, -0.9816,
       -0.9632, -0.9632, -0.9573, -0.9521, -0.9516, -0.9424, -0.9419,
       -0.9377, -0.9376, -0.9371, -0.9362, -0.9343, -0.92  , -0.9139,
       -0.9122, -0.9111, -0.9108, -0.9106, -0.9088, -0.9086, -0.8974,
       -0.8955, -0.8943, -0.8867, -0.8858, -0.8849, -0.8654, -0.8632,
       -0.8607, -0.858 , -0.8575, -0.8546, -0.849 , -0.8483, -0.8434,
       -0.8428, -0.8398, -0.8382, -0.8357, -0.8324, -0.8303, -0.827 ,
       -0.8221, -0.821 , -0.8208, -0.817 , -0.8161, -0.8141, -0.8128,
       -0.8084, -0.8079, -0.8003, -0.7962, -0.7925, -0.7835, -0.7802,
       -0.7798, -0.7797, -0.7793, -0.7765, -0.7762, -0.7719, -0.7654,
       -0.7638, -0.7624, -0.7597, -0.7596, -0.7579, -0.7534, -0.7487,
       -0.7483, -0.7446, -0.7348, -0.7346, -0.7326, -0.7324, -0.7317,
       -0.7277, -0.7264, -0.7215, -0.7205, -0.7141, -0.7125, -0.7124,
       -0.7083, -0.7036, -0.7022, -0.6982, -0.6972, -0.6966, -0.692 ,
       -0.6914, -0.6882, -0.6877, -0.686 , -0.6853, -0.6716, -0.6711,
       -0.6705, -0.6697, -0.6671, -0.6661, -0.6624, -0.6623, -0.6596,
       -0.6568, -0.6489, -0.6452, -0.6443, -0.6437, -0.6436, -0.643 ,
       -0.641 , -0.6407, -0.6371, -0.6332, -0.6316, -0.6259, -0.6174,
       -0.6151, -0.6148, -0.6126, -0.6089, -0.6051, -0.605 , -0.6033,
       -0.6019, -0.6016, -0.601 , -0.5972, -0.582 , -0.5794, -0.5789,
       -0.5752, -0.5742, -0.5726, -0.572 , -0.5669, -0.5628, -0.5617,
       -0.5605, -0.5594, -0.5586, -0.5557, -0.5523, -0.5389, -0.5329,
       -0.5284, -0.5262, -0.5258, -0.5248, -0.5234, -0.5131, -0.5114,
       -0.5057, -0.5049, -0.5031, -0.5009, -0.4991, -0.4956, -0.4922,
       -0.4861, -0.4813, -0.4808, -0.4773, -0.4769, -0.4752, -0.475 ,
       -0.4731, -0.4703, -0.467 , -0.4652, -0.4624, -0.4528, -0.452 ,
       -0.4489, -0.4472, -0.4466, -0.4455, -0.4435, -0.4431, -0.4423,
       -0.4408, -0.4381, -0.4374, -0.4326, -0.4301, -0.4294, -0.4273,
       -0.4264, -0.4212, -0.4143, -0.4138, -0.4113, -0.4092, -0.408 ,
       -0.4059, -0.4038, -0.4029, -0.4008, -0.3997, -0.3984, -0.3966,
       -0.3947, -0.3927, -0.3905, -0.388 , -0.3806, -0.3774, -0.3747,
       -0.3746, -0.3734, -0.3707, -0.369 , -0.3686, -0.3675, -0.3667,
       -0.3656, -0.3655, -0.3651, -0.3633, -0.3624, -0.3606, -0.3542,
       -0.354 , -0.3423, -0.3408, -0.3403, -0.3397, -0.338 , -0.3253,
       -0.3223, -0.3197, -0.316 , -0.3154, -0.3151, -0.3144, -0.3082,
       -0.3036, -0.3002, -0.2971, -0.2923, -0.2917, -0.2915, -0.2901,
       -0.2828, -0.2803, -0.272 , -0.2704, -0.2684, -0.2644, -0.2564,
       -0.2547, -0.2497, -0.2491, -0.248 , -0.2451, -0.2447, -0.2446,
       -0.2422, -0.2411, -0.2381, -0.2339, -0.232 , -0.2314, -0.2298,
       -0.2255, -0.2249, -0.2238, -0.2236, -0.2206, -0.211 , -0.2074,
       -0.2071, -0.2065, -0.2058, -0.2041, -0.1988, -0.1966, -0.1935,
       -0.1913, -0.1857, -0.1795, -0.1792, -0.1695, -0.1691, -0.1687,
       -0.1674, -0.1666, -0.1602, -0.1595, -0.1566, -0.1526, -0.1521,
       -0.1508, -0.1492, -0.149 , -0.1483, -0.148 , -0.146 , -0.145 ,
       -0.1341, -0.1335, -0.131 , -0.1301, -0.1247, -0.1221, -0.1209,
       -0.1195, -0.1166, -0.116 , -0.1126, -0.1124, -0.1081, -0.1036,
       -0.1032, -0.101 , -0.1006, -0.0975, -0.0903, -0.0895, -0.0894,
       -0.0879, -0.0849, -0.0839, -0.078 , -0.0767, -0.0729, -0.0675,
       -0.0659, -0.0588, -0.0453, -0.0453, -0.043 , -0.0328, -0.0324,
       -0.0311, -0.0244, -0.0229, -0.0228, -0.0227, -0.0213, -0.0198,
       -0.0171, -0.0136, -0.0129, -0.012 , -0.005 , -0.0047, -0.0026,
       -0.0001,  0.0049,  0.0106,  0.0157,  0.0167,  0.0216,  0.022 ,
        0.0251,  0.0263,  0.0272,  0.0274,  0.0285,  0.0301,  0.031 ,
        0.0332,  0.0334,  0.0359,  0.0375,  0.0375,  0.0404,  0.0419,
        0.0443,  0.0466,  0.0479,  0.049 ,  0.0508,  0.0539,  0.0557,
        0.0572,  0.0601,  0.0611,  0.062 ,  0.07  ,  0.0742,  0.0756,
        0.0767,  0.0784,  0.0801,  0.0806,  0.0835,  0.0845,  0.0851,
        0.0882,  0.0889,  0.0893,  0.0894,  0.0917,  0.092 ,  0.0923,
        0.0943,  0.0969,  0.099 ,  0.1016,  0.106 ,  0.1064,  0.1351,
        0.1364,  0.1368,  0.1384,  0.1384,  0.1396,  0.15  ,  0.1507,
        0.1536,  0.1552,  0.1562,  0.1655,  0.1666,  0.1704,  0.1778,
        0.1831,  0.1859,  0.1862,  0.1865,  0.1869,  0.188 ,  0.1923,
        0.1958,  0.1973,  0.2011,  0.2032,  0.2099,  0.2128,  0.2132,
        0.2138,  0.2179,  0.2254,  0.2312,  0.2313,  0.2375,  0.2383,
        0.2426,  0.2447,  0.2469,  0.2481,  0.2501,  0.252 ,  0.2536,
        0.2576,  0.2591,  0.2621,  0.2638,  0.2724,  0.2743,  0.2743,
        0.2748,  0.2873,  0.2882,  0.2904,  0.2913,  0.2963,  0.2996,
        0.3032,  0.3061,  0.3086,  0.3095,  0.3136,  0.3141,  0.3159,
        0.3166,  0.3168,  0.3185,  0.3199,  0.3211,  0.3218,  0.3245,
        0.3272,  0.3323,  0.3329,  0.3335,  0.3338,  0.3372,  0.3433,
        0.3456,  0.3472,  0.3492,  0.3504,  0.3504,  0.3524,  0.3528,
        0.3546,  0.3566,  0.3569,  0.3572,  0.3623,  0.3624,  0.3683,
        0.3702,  0.3711,  0.3711,  0.3727,  0.3746,  0.3767,  0.3786,
        0.3794,  0.3803,  0.381 ,  0.382 ,  0.3838,  0.3867,  0.387 ,
        0.3934,  0.394 ,  0.3993,  0.3995,  0.4023,  0.4037,  0.407 ,
        0.4103,  0.4114,  0.4175,  0.4241,  0.4249,  0.4293,  0.4378,
        0.4386,  0.4406,  0.4417,  0.4421,  0.4427,  0.4441,  0.4575,
        0.4583,  0.4596,  0.4601,  0.4601,  0.4606,  0.4607,  0.462 ,
        0.4657,  0.4706,  0.4738,  0.4778,  0.4778,  0.4821,  0.4827,
        0.4831,  0.484 ,  0.4847,  0.4873,  0.4876,  0.4881,  0.4925,
        0.4965,  0.5009,  0.5033,  0.5036,  0.5062,  0.5109,  0.5119,
        0.5126,  0.5146,  0.5152,  0.5199,  0.5229,  0.5284,  0.5347,
        0.5358,  0.5392,  0.5436,  0.5533,  0.5588,  0.5597,  0.5626,
        0.5637,  0.566 ,  0.5675,  0.5736,  0.5747,  0.5889,  0.5903,
        0.5912,  0.5968,  0.5969,  0.6   ,  0.604 ,  0.6047,  0.6048,
        0.6096,  0.6128,  0.6138,  0.6176,  0.6201,  0.632 ,  0.6326,
        0.6351,  0.6402,  0.6449,  0.6464,  0.6495,  0.6551,  0.6615,
        0.662 ,  0.662 ,  0.6648,  0.6699,  0.6714,  0.673 ,  0.6739,
        0.6809,  0.6831,  0.6856,  0.6859,  0.6867,  0.6883,  0.7003,
        0.7022,  0.7035,  0.7073,  0.7127,  0.7227,  0.7238,  0.7248,
        0.7254,  0.7317,  0.7322,  0.7331,  0.7361,  0.7382,  0.7411,
        0.7475,  0.7496,  0.7552,  0.7567,  0.7613,  0.7621,  0.7667,
        0.767 ,  0.7695,  0.7751,  0.7799,  0.7908,  0.7921,  0.8043,
        0.8055,  0.8064,  0.8112,  0.8118,  0.8266,  0.8327,  0.8368,
        0.8395,  0.8411,  0.8419,  0.8425,  0.8426,  0.8436,  0.8442,
        0.8444,  0.8503,  0.851 ,  0.8545,  0.8634,  0.8743,  0.8744,
        0.8793,  0.8858,  0.8861,  0.8922,  0.9017,  0.9018,  0.9072,
        0.9073,  0.9237,  0.9239,  0.9255,  0.927 ,  0.9362,  0.9533,
        0.955 ,  0.9574,  0.9581,  0.961 ,  0.9623,  0.9643,  0.966 ,
        0.9683,  0.9797,  0.9837,  0.9858,  0.9918,  0.9933,  0.9949,
        0.9975,  0.9991,  1.0011,  1.0126,  1.0167,  1.0317,  1.0387,
        1.0407,  1.0539,  1.0546,  1.0558,  1.0567,  1.0637,  1.066 ,
        1.0664,  1.067 ,  1.0727,  1.0735,  1.076 ,  1.0767,  1.0812,
        1.0844,  1.0906,  1.0977,  1.0998,  1.1103,  1.1161,  1.122 ,
        1.1334,  1.1351,  1.1366,  1.1482,  1.1533,  1.1545,  1.1567,
        1.163 ,  1.1632,  1.1649,  1.1653,  1.1658,  1.1729,  1.1777,
        1.1777,  1.1799,  1.1801,  1.1837,  1.1864,  1.1897,  1.1902,
        1.1929,  1.1929,  1.1995,  1.2002,  1.2098,  1.2136,  1.2156,
        1.2159,  1.2223,  1.2296,  1.2298,  1.2378,  1.2411,  1.253 ,
        1.2544,  1.2552,  1.2624,  1.2784,  1.2797,  1.2843,  1.2922,
        1.2944,  1.2946,  1.3289,  1.3335,  1.3342,  1.3388,  1.3494,
        1.3509,  1.3621,  1.3632,  1.3649,  1.3722,  1.3725,  1.3866,
        1.3965,  1.3996,  1.4005,  1.4047,  1.4096,  1.4109,  1.421 ,
        1.4273,  1.4349,  1.4391,  1.4626,  1.4647,  1.4797,  1.4848,
        1.497 ,  1.4987,  1.5228,  1.5275,  1.5298,  1.5449,  1.5665,
        1.5763,  1.5874,  1.5924,  1.6091,  1.6215,  1.6304,  1.6461,
        1.6789,  1.6945,  1.7032,  1.7097,  1.7106,  1.7114,  1.7299,
        1.7323,  1.7381,  1.7689,  1.7784,  1.7922,  1.7923,  1.8067,
        1.8315,  1.8415,  1.8517,  1.858 ,  1.8589,  1.8638,  1.8738,
        1.8806,  1.9035,  1.9074,  1.9204,  1.9294,  1.9456,  1.9493,
        1.9544,  1.9551,  1.9742,  1.9928,  1.9953,  2.0775,  2.0929,
        2.1223,  2.1514,  2.239 ,  2.285 ,  2.3306,  2.3672,  2.3793,
        2.5288,  2.5507,  2.5653,  2.5671,  2.6081,  2.697 ])






-1.5519406239259821
</code></pre><h3 id="唯一化以及其他的集合逻辑"><a href="#唯一化以及其他的集合逻辑" class="headerlink" title="唯一化以及其他的集合逻辑"></a>唯一化以及其他的集合逻辑</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">names = np.array([<span class="string">'Bob'</span>, <span class="string">'Joe'</span>, <span class="string">'Will'</span>, <span class="string">'Bob'</span>, <span class="string">'Will'</span>, <span class="string">'Joe'</span>, <span class="string">'Joe'</span>])</div><div class="line">np.unique(names)</div><div class="line">ints = np.array([<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">4</span>])</div><div class="line">np.unique(ints)</div></pre></td></tr></table></figure><pre><code>array([&#39;Bob&#39;, &#39;Joe&#39;, &#39;Will&#39;], 
      dtype=&#39;&lt;U4&#39;)






array([1, 2, 3, 4])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sorted(set(names))</div></pre></td></tr></table></figure><pre><code>[&#39;Bob&#39;, &#39;Joe&#39;, &#39;Will&#39;]
</code></pre><p>in1d感觉挺有用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">values = np.array([<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>])</div><div class="line">np.in1d(values, [<span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>])</div></pre></td></tr></table></figure><pre><code>array([ True, False, False,  True,  True, False,  True], dtype=bool)
</code></pre><h2 id="用于数组的文件输入输出"><a href="#用于数组的文件输入输出" class="headerlink" title="用于数组的文件输入输出"></a>用于数组的文件输入输出</h2><h3 id="将数组以二进制的形式保存到磁盘"><a href="#将数组以二进制的形式保存到磁盘" class="headerlink" title="将数组以二进制的形式保存到磁盘"></a>将数组以二进制的形式保存到磁盘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">10</span>)</div><div class="line">np.save(<span class="string">'some_array'</span>, arr)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.load(<span class="string">'some_array.npy'</span>)</div></pre></td></tr></table></figure><pre><code>array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
</code></pre><p>压缩存储，并且可以存储多个</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.savez(<span class="string">'array_archive.npz'</span>, a=arr[:<span class="number">4</span>], b=arr)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arch = np.load(<span class="string">'array_archive.npz'</span>)</div><div class="line">arch[<span class="string">'a'</span>]</div><div class="line">arch[<span class="string">'b'</span>]</div></pre></td></tr></table></figure><pre><code>array([0, 1, 2, 3])






array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
</code></pre><h3 id="存取文本文件"><a href="#存取文本文件" class="headerlink" title="存取文本文件"></a>存取文本文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!more ch04\array_ex.txt</div></pre></td></tr></table></figure><pre><code>0.580052,0.186730,1.040717,1.134411
0.194163,-0.636917,-0.938659,0.124094
-0.126410,0.268607,-0.695724,0.047428
-1.484413,0.004176,-0.744203,0.005487
2.302869,0.200131,1.670238,-1.881090
-0.193230,1.047233,0.482803,0.960334
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = np.loadtxt(<span class="string">'.\\ch04\\array_ex.txt'</span>, delimiter=<span class="string">','</span>)</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[ 0.5801,  0.1867,  1.0407,  1.1344],
       [ 0.1942, -0.6369, -0.9387,  0.1241],
       [-0.1264,  0.2686, -0.6957,  0.0474],
       [-1.4844,  0.0042, -0.7442,  0.0055],
       [ 2.3029,  0.2001,  1.6702, -1.8811],
       [-0.1932,  1.0472,  0.4828,  0.9603]])
</code></pre><h2 id="线性代数"><a href="#线性代数" class="headerlink" title="线性代数"></a>线性代数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x = np.array([[<span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>], [<span class="number">4.</span>, <span class="number">5.</span>, <span class="number">6.</span>]])</div><div class="line">y = np.array([[<span class="number">6.</span>, <span class="number">23.</span>], [<span class="number">-1</span>, <span class="number">7</span>], [<span class="number">8</span>, <span class="number">9</span>]])</div><div class="line">x</div><div class="line">y</div><div class="line">x.dot(y)  <span class="comment"># equivalently np.dot(x, y)</span></div></pre></td></tr></table></figure><pre><code>array([[ 1.,  2.,  3.],
       [ 4.,  5.,  6.]])






array([[  6.,  23.],
       [ -1.,   7.],
       [  8.,   9.]])






array([[  28.,   64.],
       [  67.,  181.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.dot(x, np.ones(<span class="number">3</span>))</div></pre></td></tr></table></figure><pre><code>array([  6.,  15.])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.random.seed(<span class="number">12345</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> numpy.linalg <span class="keyword">import</span> inv, qr</div><div class="line">X = randn(<span class="number">5</span>, <span class="number">5</span>)</div><div class="line">X</div><div class="line">mat = X.T.dot(X)</div><div class="line">mat</div><div class="line">inv(mat)</div><div class="line">mat.dot(inv(mat))</div><div class="line">q, r = qr(mat) <span class="comment"># QR分解</span></div><div class="line">r</div></pre></td></tr></table></figure><pre><code>array([[-0.5031, -0.6223, -0.9212, -0.7262,  0.2229],
       [ 0.0513, -1.1577,  0.8167,  0.4336,  1.0107],
       [ 1.8249, -0.9975,  0.8506, -0.1316,  0.9124],
       [ 0.1882,  2.1695, -0.1149,  2.0037,  0.0296],
       [ 0.7953,  0.1181, -0.7485,  0.585 ,  0.1527]])






array([[ 4.2538, -1.0645,  1.4407,  0.9898,  1.7318],
       [-1.0645,  7.4431, -1.5585,  4.4972, -2.1367],
       [ 1.4407, -1.5585,  2.8126,  0.243 ,  1.2786],
       [ 0.9898,  4.4972,  0.243 ,  5.0897,  0.305 ],
       [ 1.7318, -2.1367,  1.2786,  0.305 ,  1.928 ]])






array([[ 0.4057, -0.1875, -0.0764,  0.1229, -0.541 ],
       [-0.1875,  2.462 ,  0.2537, -2.3367,  3.0984],
       [-0.0764,  0.2537,  0.5435, -0.2369,  0.0268],
       [ 0.1229, -2.3367, -0.2369,  2.4239, -2.9264],
       [-0.541 ,  3.0984,  0.0268, -2.9264,  4.8837]])






array([[ 1.,  0., -0., -0., -0.],
       [ 0.,  1., -0., -0., -0.],
       [ 0.,  0.,  1.,  0., -0.],
       [ 0., -0.,  0.,  1.,  0.],
       [ 0.,  0., -0.,  0.,  1.]])






array([[-5.0281,  2.7734, -2.8428, -1.0619, -3.0078],
       [ 0.    , -8.7212,  1.2925, -6.5614,  1.622 ],
       [ 0.    ,  0.    , -2.0873, -1.0487, -0.6291],
       [ 0.    ,  0.    ,  0.    , -1.408 , -0.955 ],
       [ 0.    ,  0.    ,  0.    ,  0.    ,  0.1537]])
</code></pre><h2 id="随机数生成"><a href="#随机数生成" class="headerlink" title="随机数生成"></a>随机数生成</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">samples = np.random.normal(size=(<span class="number">4</span>, <span class="number">4</span>))</div><div class="line">samples</div></pre></td></tr></table></figure><pre><code>array([[-0.5196,  1.297 ,  0.9062,  0.5809],
       [ 1.2233, -1.3301,  1.0483,  0.357 ],
       [-0.7935, -0.406 , -0.0096, -0.596 ],
       [ 1.3833, -0.2029, -1.0547, -0.9795]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> random <span class="keyword">import</span> normalvariate</div><div class="line">N = <span class="number">1000000</span></div><div class="line">%timeit samples = [normalvariate(<span class="number">0</span>, <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(N)]</div><div class="line">%timeit np.random.normal(size=N)</div></pre></td></tr></table></figure><pre><code>1 loop, best of 3: 814 ms per loop
10 loops, best of 3: 28.4 ms per loop
</code></pre><p>可以看出numpy确实要快很多</p><h2 id="Example-随机游走"><a href="#Example-随机游走" class="headerlink" title="Example: 随机游走"></a>Example: 随机游走</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> random</div><div class="line"></div><div class="line">position = <span class="number">0</span></div><div class="line">walk = [position]</div><div class="line">steps = <span class="number">1000</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(steps):</div><div class="line">    step = <span class="number">1</span> <span class="keyword">if</span> random.randint(<span class="number">0</span>, <span class="number">1</span>) <span class="keyword">else</span> <span class="number">-1</span></div><div class="line">    position += step</div><div class="line">    walk.append(position)</div></pre></td></tr></table></figure><p>通过numpy来实现上述过程</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.random.seed(<span class="number">12345</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">nsteps = <span class="number">1000</span></div><div class="line">draws = np.random.randint(<span class="number">0</span>, <span class="number">2</span>, size=nsteps)</div><div class="line">steps = np.where(draws &gt; <span class="number">0</span>, <span class="number">1</span>, <span class="number">-1</span>)</div><div class="line">walk = steps.cumsum()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"></div><div class="line">index = [x + <span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(len(walk))]</div><div class="line">plt.plot(index, walk)</div></pre></td></tr></table></figure><pre><code>[&lt;matplotlib.lines.Line2D at 0x234014e9f98&gt;]
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch04/random_walk.png" alt="random_walk"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">walk.min()</div><div class="line">walk.max()</div></pre></td></tr></table></figure><pre><code>-3






31
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(np.abs(walk) &gt;= <span class="number">10</span>).argmax() <span class="comment"># the first index</span></div></pre></td></tr></table></figure><pre><code>37
</code></pre><h3 id="一次模拟多次随机漫步"><a href="#一次模拟多次随机漫步" class="headerlink" title="一次模拟多次随机漫步"></a>一次模拟多次随机漫步</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">nwalks = <span class="number">5000</span> <span class="comment"># 5000 random walk</span></div><div class="line">nsteps = <span class="number">1000</span></div><div class="line">draws = np.random.randint(<span class="number">0</span>, <span class="number">2</span>, size=(nwalks, nsteps)) <span class="comment"># 0 or 1</span></div><div class="line">steps = np.where(draws &gt; <span class="number">0</span>, <span class="number">1</span>, <span class="number">-1</span>)</div><div class="line">walks = steps.cumsum(<span class="number">1</span>)</div><div class="line">walks</div></pre></td></tr></table></figure><pre><code>array([[ -1,   0,  -1, ...,  24,  23,  22],
       [ -1,   0,  -1, ..., -36, -37, -36],
       [  1,   2,   3, ..., -42, -41, -40],
       ..., 
       [  1,   0,  -1, ...,  48,  49,  50],
       [ -1,  -2,  -3, ..., -38, -39, -40],
       [ -1,   0,   1, ..., -48, -47, -48]], dtype=int32)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">walks.max()</div><div class="line">walks.min()</div></pre></td></tr></table></figure><pre><code>130






-117
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">hits30 = (np.abs(walks) &gt;= <span class="number">30</span>).any(<span class="number">1</span>)</div><div class="line">hits30</div><div class="line">hits30.sum() <span class="comment"># Number that hit 30 or -30</span></div></pre></td></tr></table></figure><pre><code>array([ True,  True,  True, ...,  True,  True,  True], dtype=bool)






3412
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">crossing_times = (np.abs(walks[hits30]) &gt;= <span class="number">30</span>).argmax(<span class="number">1</span>)</div><div class="line">crossing_times.mean()</div></pre></td></tr></table></figure><pre><code>497.04103165298943
</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Numpy基础：数组和矢量计算&quot;&gt;&lt;a href=&quot;#Numpy基础：数组和矢量计算&quot; class=&quot;headerlink&quot; title=&quot;Numpy基础：数组和矢量计算&quot;&gt;&lt;/a&gt;Numpy基础：数组和矢量计算&lt;/h1&gt;&lt;figure class=&quot;highli
    
    </summary>
    
    
      <category term="Python" scheme="http://yoursite.com/tags/Python/"/>
    
      <category term="numpy" scheme="http://yoursite.com/tags/numpy/"/>
    
  </entry>
  
  <entry>
    <title>Naive Bayes</title>
    <link href="http://yoursite.com/2017/02/25/Naive-Bayes/"/>
    <id>http://yoursite.com/2017/02/25/Naive-Bayes/</id>
    <published>2017-02-25T05:40:23.000Z</published>
    <updated>2017-02-25T09:58:29.981Z</updated>
    
    <content type="html"><![CDATA[<h1 id="利用朴素贝叶斯进行文本分类"><a href="#利用朴素贝叶斯进行文本分类" class="headerlink" title="利用朴素贝叶斯进行文本分类"></a>利用朴素贝叶斯进行文本分类</h1><h2 id="准备数据"><a href="#准备数据" class="headerlink" title="准备数据"></a>准备数据</h2><p>从文本中构建词向量</p><p>下面写一个词表到向量的转换函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">LoadDataSet</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">""" Load a vector-like data set tranfered by</span></div><div class="line">    a data set list that generated by artifical.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        return_vec: the vector-like data set.</div><div class="line">        class_vec: the class label corresponds to the data items.</div><div class="line">    """</div><div class="line">    posting_list = [[<span class="string">'my'</span>, <span class="string">'dog'</span>, <span class="string">'has'</span>, <span class="string">'flea'</span>,</div><div class="line">                     <span class="string">'problems'</span>, <span class="string">'help'</span>, <span class="string">'please'</span>],</div><div class="line">                    [<span class="string">'maybe'</span>, <span class="string">'not'</span>, <span class="string">'take'</span>, <span class="string">'him'</span>,</div><div class="line">                     <span class="string">'to'</span>, <span class="string">'dog'</span>, <span class="string">'park'</span>, <span class="string">'stupid'</span>],</div><div class="line">                    [<span class="string">'my'</span>, <span class="string">'dalmation'</span>, <span class="string">'is'</span>, <span class="string">'so'</span>, <span class="string">'cute'</span>,</div><div class="line">                     <span class="string">'I'</span>, <span class="string">'love'</span>, <span class="string">'him'</span>],</div><div class="line">                    [<span class="string">'stop'</span>, <span class="string">'posting'</span>, <span class="string">'stupid'</span>, <span class="string">'worthless'</span>, <span class="string">'garbage'</span>],</div><div class="line">                    [<span class="string">'mr'</span>, <span class="string">'licks'</span>, <span class="string">'ate'</span>, <span class="string">'my'</span>, <span class="string">'steak'</span>, <span class="string">'how'</span>,</div><div class="line">                     <span class="string">'to'</span>, <span class="string">'stop'</span>, <span class="string">'him'</span>],</div><div class="line">                    [<span class="string">'quit'</span>, <span class="string">'buying'</span>, <span class="string">'worthless'</span>, <span class="string">'dog'</span>, <span class="string">'food'</span>, <span class="string">'stupid'</span>]]</div><div class="line">    class_vec = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]  <span class="comment"># 1 is abusive, 0 not</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> posting_list, class_vec</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">CreateVocabList</span><span class="params">(data_set)</span>:</span></div><div class="line">    <span class="string">""" Create vocabulary list from vector-like data set.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        data_set: the data source.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        vocab_list: the vocabulary list.</div><div class="line">    """</div><div class="line"></div><div class="line">    vocab_set = set([])</div><div class="line">    <span class="keyword">for</span> document <span class="keyword">in</span> data_set:</div><div class="line">        vocab_set = vocab_set | set(document)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> list(vocab_set)</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">SetOfWords2Vec</span><span class="params">(vocab_list, input_set)</span>:</span></div><div class="line">    <span class="string">""" Transfer the words list to vector for each posting.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        vocab_list: The vocabulary list.</div><div class="line">        input_set: The posting that ready to transfer to vector.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        return_vec: the result vector.</div><div class="line">    """</div><div class="line"></div><div class="line">    <span class="comment"># Initialize</span></div><div class="line">    return_vec = [<span class="number">0</span>] * len(vocab_list)</div><div class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> input_set:</div><div class="line">        <span class="keyword">if</span> word <span class="keyword">in</span> vocab_list:</div><div class="line">            return_vec[vocab_list.index(word)] = <span class="number">1</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            print(<span class="string">"the word: %s is not in my Vocabulary"</span> % word)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> return_vec</div></pre></td></tr></table></figure><p>下面对函数的功能进行测试</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">13</span>]: <span class="keyword">import</span> bayes</div><div class="line"></div><div class="line">In [<span class="number">14</span>]: list_of_posts, list_classes = bayes.LoadDataSet()</div><div class="line"></div><div class="line">In [<span class="number">15</span>]: my_vocab_list = bayes.CreateVocabList(list_of_posts)</div><div class="line"></div><div class="line">In [<span class="number">16</span>]: my_vocab_list</div><div class="line">Out[<span class="number">16</span>]:</div><div class="line">[<span class="string">'help'</span>,</div><div class="line"> <span class="string">'worthless'</span>,</div><div class="line"> <span class="string">'I'</span>,</div><div class="line"> <span class="string">'take'</span>,</div><div class="line"> <span class="string">'love'</span>,</div><div class="line"> <span class="string">'maybe'</span>,</div><div class="line"> <span class="string">'stupid'</span>,</div><div class="line"> <span class="string">'to'</span>,</div><div class="line"> <span class="string">'not'</span>,</div><div class="line"> <span class="string">'please'</span>,</div><div class="line"> <span class="string">'quit'</span>,</div><div class="line"> <span class="string">'park'</span>,</div><div class="line"> <span class="string">'posting'</span>,</div><div class="line"> <span class="string">'dog'</span>,</div><div class="line"> <span class="string">'dalmation'</span>,</div><div class="line"> <span class="string">'steak'</span>,</div><div class="line"> <span class="string">'my'</span>,</div><div class="line"> <span class="string">'how'</span>,</div><div class="line"> <span class="string">'food'</span>,</div><div class="line"> <span class="string">'so'</span>,</div><div class="line"> <span class="string">'stop'</span>,</div><div class="line"> <span class="string">'is'</span>,</div><div class="line"> <span class="string">'garbage'</span>,</div><div class="line"> <span class="string">'flea'</span>,</div><div class="line"> <span class="string">'problems'</span>,</div><div class="line"> <span class="string">'has'</span>,</div><div class="line"> <span class="string">'buying'</span>,</div><div class="line"> <span class="string">'ate'</span>,</div><div class="line"> <span class="string">'him'</span>,</div><div class="line"> <span class="string">'licks'</span>,</div><div class="line"> <span class="string">'mr'</span>,</div><div class="line"> <span class="string">'cute'</span>]</div><div class="line"></div><div class="line">In [<span class="number">17</span>]: bayes.SetOfWords2Vec(my_vocab_list, list_of_posts[<span class="number">0</span>])</div><div class="line">Out[<span class="number">17</span>]:</div><div class="line">[<span class="number">1</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">1</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">1</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">1</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">1</span>,</div><div class="line"> <span class="number">1</span>,</div><div class="line"> <span class="number">1</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>]</div><div class="line"></div><div class="line">In [<span class="number">18</span>]: bayes.SetOfWords2Vec(my_vocab_list, list_of_posts[<span class="number">3</span>])</div><div class="line">Out[<span class="number">18</span>]:</div><div class="line">[<span class="number">0</span>,</div><div class="line"> <span class="number">1</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">1</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">1</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">1</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">1</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>,</div><div class="line"> <span class="number">0</span>]</div></pre></td></tr></table></figure><p>看上去一切都work，可以进入下一步了。</p><h2 id="训练"><a href="#训练" class="headerlink" title="训练"></a>训练</h2><p>从词向量计算概率</p><p>我们来看看贝叶斯公式：</p><script type="math/tex;mode=display">p(c_i | w) = \frac{p(w | c_i) p(c_i)}{p(w)}</script><p>这里$w$代表词向量， 可以看出$c_i$的计算十分简单，值得注意的是，根据朴素贝叶斯的假设，有：</p><script type="math/tex;mode=display">p(w | c_i) = p(w_0, w_1, w_2, \cdots, w_N | c_i) = p(w_0 | c_i)p(w_1 | c_i)p(w_2 | c_i) \cdots p(w_N | c_i)</script><p>当需要预测新样本的类别时：</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/nb/nb.png" alt="nb"></p><p>这样一切就很清楚了，下面给出伪代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">计算每个类别的文档数目</div><div class="line"><span class="keyword">for</span> 每一篇文档：</div><div class="line">	<span class="keyword">for</span> 每一个类别：</div><div class="line">		<span class="keyword">if</span> 词条出现在文档中：</div><div class="line">			增加该词条的计数值</div><div class="line">		增加总词条数的计数值</div><div class="line">	<span class="keyword">for</span> 每一个类别：</div><div class="line">		<span class="keyword">for</span> 每一个词条：</div><div class="line">			将该词条的数目除以总词条数目得到条件概率</div><div class="line">	返回每个类别的条件概率</div></pre></td></tr></table></figure><p>注意，这里的$p(w_j | c_i)$是要根据整个训练集来算，代码实现如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">TrainNaiveBayes0</span><span class="params">(train_matrix, train_category)</span>:</span></div><div class="line">    <span class="string">""" the training method.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        train_matrix: The train data.</div><div class="line">        train_category: The train label.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        p0_vect: The conditional probability of w by c0</div><div class="line">        p1_vect: The conditional probability of w by c1</div><div class="line">        p_abusive: The conditional probability of c1</div><div class="line">    """</div><div class="line"></div><div class="line">    num_train_docs = len(train_matrix)</div><div class="line">    num_words = len(train_matrix[<span class="number">0</span>])</div><div class="line">    p_abusive = sum(train_category) / num_train_docs</div><div class="line">    p0_num = zeros(num_words)</div><div class="line">    p1_num = zeros(num_words)</div><div class="line">    p0_denom = <span class="number">0.0</span></div><div class="line">    p1_denom = <span class="number">0.0</span></div><div class="line"></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num_train_docs):</div><div class="line">        <span class="keyword">if</span> train_category[i] == <span class="number">1</span>:</div><div class="line">            p1_num += train_matrix[i]</div><div class="line">            p1_denom += sum(train_matrix[i])</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            p0_num += train_matrix[i]</div><div class="line">            p0_denom += sum(train_matrix[i])</div><div class="line"></div><div class="line">    p1_vect = p1_num / p1_denom</div><div class="line">    p0_vect = p0_num / p0_denom</div><div class="line"></div><div class="line">    <span class="keyword">return</span> p0_vect, p1_vect, p_abusive</div></pre></td></tr></table></figure><p>同样进行一下测试：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">25</span>]: train_mat = []</div><div class="line"></div><div class="line">In [<span class="number">26</span>]: <span class="keyword">for</span> post_in_doc <span class="keyword">in</span> list_of_posts:</div><div class="line">    ...:     train_mat.append(bayes.SetOfWords2Vec(my_vocab_list, post_in_doc))</div><div class="line">    ...:</div><div class="line"></div><div class="line">In [<span class="number">27</span>]: p0_v, p1_v, p_ab = bayes.TrainNaiveBayes0(train_mat, list_classes)</div><div class="line"></div><div class="line">In [<span class="number">28</span>]: p_ab</div><div class="line">Out[<span class="number">28</span>]: <span class="number">0.5</span></div><div class="line"></div><div class="line">In [<span class="number">29</span>]: p0_v</div><div class="line">Out[<span class="number">29</span>]:</div><div class="line">array([ <span class="number">0.04166667</span>,  <span class="number">0.</span>        ,  <span class="number">0.04166667</span>,  <span class="number">0.</span>        ,  <span class="number">0.04166667</span>,</div><div class="line">        <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.04166667</span>,  <span class="number">0.</span>        ,  <span class="number">0.04166667</span>,</div><div class="line">        <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.04166667</span>,  <span class="number">0.04166667</span>,</div><div class="line">        <span class="number">0.04166667</span>,  <span class="number">0.125</span>     ,  <span class="number">0.04166667</span>,  <span class="number">0.</span>        ,  <span class="number">0.04166667</span>,</div><div class="line">        <span class="number">0.04166667</span>,  <span class="number">0.04166667</span>,  <span class="number">0.</span>        ,  <span class="number">0.04166667</span>,  <span class="number">0.04166667</span>,</div><div class="line">        <span class="number">0.04166667</span>,  <span class="number">0.</span>        ,  <span class="number">0.04166667</span>,  <span class="number">0.08333333</span>,  <span class="number">0.04166667</span>,</div><div class="line">        <span class="number">0.04166667</span>,  <span class="number">0.04166667</span>])</div><div class="line"></div><div class="line">In [<span class="number">30</span>]: p1_v</div><div class="line">Out[<span class="number">30</span>]:</div><div class="line">array([ <span class="number">0.</span>        ,  <span class="number">0.10526316</span>,  <span class="number">0.</span>        ,  <span class="number">0.05263158</span>,  <span class="number">0.</span>        ,</div><div class="line">        <span class="number">0.05263158</span>,  <span class="number">0.15789474</span>,  <span class="number">0.05263158</span>,  <span class="number">0.05263158</span>,  <span class="number">0.</span>        ,</div><div class="line">        <span class="number">0.05263158</span>,  <span class="number">0.05263158</span>,  <span class="number">0.05263158</span>,  <span class="number">0.10526316</span>,  <span class="number">0.</span>        ,</div><div class="line">        <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.</span>        ,  <span class="number">0.05263158</span>,  <span class="number">0.</span>        ,</div><div class="line">        <span class="number">0.05263158</span>,  <span class="number">0.</span>        ,  <span class="number">0.05263158</span>,  <span class="number">0.</span>        ,  <span class="number">0.</span>        ,</div><div class="line">        <span class="number">0.</span>        ,  <span class="number">0.05263158</span>,  <span class="number">0.</span>        ,  <span class="number">0.05263158</span>,  <span class="number">0.</span>        ,</div><div class="line">        <span class="number">0.</span>        ,  <span class="number">0.</span>        ])</div></pre></td></tr></table></figure><p>但是上述代码存在一些缺陷，首先，计算$p(w_j | c_i)$可能会出现结果为0的情况，那么最后的结果就会为0，那么需要进行一些修改 (为什么是2？)：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">p0_num = ones(num_words)</div><div class="line">p1_num = ones(num_words)</div><div class="line">p0_denom = 2.0</div><div class="line">p1_denom = 2.0</div></pre></td></tr></table></figure><p>另外一个就是下溢的问题，所以要改用log函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">p1_vect = log(p1_num / p1_denom)</div><div class="line">p0_vect = log(p0_num / p0_denom)</div></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>最后写一个分类和测试函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ClassifyNaiveBayes</span><span class="params">(vec_to_classify, p0_vect, p1_vect, p_abusive)</span>:</span></div><div class="line">    <span class="string">""" Classify.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        vec_to_classify: The vector to classify.</div><div class="line">        p0_vect: The conditional probability of w by c0.</div><div class="line">        p1_vect: The conditional probability of w by c1.</div><div class="line">        p_abusive: The conditional probability of c1.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        0: The predict class is 0</div><div class="line">        1: The predict class is 1</div><div class="line"></div><div class="line">    """</div><div class="line"></div><div class="line">    p1 = sum(vec_to_classify * p1_vect) + log(p_abusive)</div><div class="line">    p0 = sum(vec_to_classify * p0_vect) + log(<span class="number">1</span> - p_abusive)</div><div class="line">    <span class="keyword">if</span> p1 &gt; p0:</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">TestNaiveBayes</span><span class="params">()</span>:</span></div><div class="line">    <span class="string">""" A test method.</span></div><div class="line">    """</div><div class="line"></div><div class="line">    list_of_posts, list_of_classes = LoadDataSet()</div><div class="line">    my_vocab_list = CreateVocabList(list_of_posts)</div><div class="line">    train_mat = []</div><div class="line">    <span class="keyword">for</span> post_in_doc <span class="keyword">in</span> list_of_posts:</div><div class="line">        train_mat.append(SetOfWords2Vec(my_vocab_list, post_in_doc))</div><div class="line">    p0_v, p1_v, p_ab = TrainNaiveBayes0(</div><div class="line">        array(train_mat), array(list_of_classes))</div><div class="line">    test_entry = [<span class="string">'love'</span>, <span class="string">'my'</span>, <span class="string">'dalmation'</span>]</div><div class="line">    this_doc = array(SetOfWords2Vec(my_vocab_list, test_entry))</div><div class="line">    print(test_entry, <span class="string">'classified as: '</span>,</div><div class="line">          ClassifyNaiveBayes(this_doc, p0_v, p1_v, p_ab))</div><div class="line">    test_entry = [<span class="string">'stupid'</span>, <span class="string">'garbage'</span>]</div><div class="line">    this_doc = array(SetOfWords2Vec(my_vocab_list, test_entry))</div><div class="line">    print(test_entry, <span class="string">'classified as: '</span>,</div><div class="line">          ClassifyNaiveBayes(this_doc, p0_v, p1_v, p_ab))</div></pre></td></tr></table></figure><p>Test</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">32</span>]: bayes.TestNaiveBayes()</div><div class="line">[<span class="string">'love'</span>, <span class="string">'my'</span>, <span class="string">'dalmation'</span>] classified <span class="keyword">as</span>:  <span class="number">0</span></div><div class="line">[<span class="string">'stupid'</span>, <span class="string">'garbage'</span>] classified <span class="keyword">as</span>:  <span class="number">1</span></div></pre></td></tr></table></figure><p>Ok, bravo!</p><h2 id="词袋模型"><a href="#词袋模型" class="headerlink" title="词袋模型"></a>词袋模型</h2><p>现在有一个问题， 到目前为止，我们将每个词是否出现作为特征，这被称为词集模型。但是如果有一个词在文档中不止出现一次，那么就需要词袋模型进行建模。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">BagOfWords2Vec</span><span class="params">(vocab_list, input_set)</span>:</span></div><div class="line">    <span class="string">""" Transfer the words list to vector for each posting.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        vocab_list: The vocabulary list.</div><div class="line">        input_set: The posting that ready to transfer to vector.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        return_vec: the result vector.</div><div class="line">    """</div><div class="line"></div><div class="line">    <span class="comment"># Initialize</span></div><div class="line">    return_vec = [<span class="number">0</span>] * len(vocab_list)</div><div class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> input_set:</div><div class="line">        <span class="keyword">if</span> word <span class="keyword">in</span> vocab_list:</div><div class="line">            return_vec[vocab_list.index(word)] += <span class="number">1</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            print(<span class="string">"the word: %s is not in my Vocabulary"</span> % word)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> return_vec</div></pre></td></tr></table></figure><h1 id="高斯朴素贝叶斯"><a href="#高斯朴素贝叶斯" class="headerlink" title="高斯朴素贝叶斯"></a>高斯朴素贝叶斯</h1><p>一般的朴素贝叶斯算法的输入特征为离散值，那么当输入变量为连续值时就不能处理了，一般这时候假设输入变量服从一个正态分布，这样$p(w_j | c_i)$就可以计算了，所以整个的流程如下：</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/nb/gnb_algo.png" alt="gnb_algo"></p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/nb/gnb_mle.png" alt="gnb_mle"></p><p>采用sk-learn进行下实验</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">In [<span class="number">33</span>]: <span class="keyword">from</span> sklearn <span class="keyword">import</span> datasets</div><div class="line">    ...: iris = datasets.load_iris()</div><div class="line">    ...: <span class="keyword">from</span> sklearn.naive_bayes <span class="keyword">import</span> GaussianNB</div><div class="line">    ...: gnb = GaussianNB()</div><div class="line">    ...: y_pred = gnb.fit(iris.data, iris.target).predict(iris.data)</div><div class="line">    ...: print(<span class="string">"Number of mislabeled points out of a total %d points : %d"</span></div><div class="line">    ...:       % (iris.data.shape[<span class="number">0</span>],(iris.target != y_pred).sum()))</div><div class="line">    ...:</div><div class="line">Number of mislabeled points out of a total <span class="number">150</span> points : <span class="number">6</span></div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;利用朴素贝叶斯进行文本分类&quot;&gt;&lt;a href=&quot;#利用朴素贝叶斯进行文本分类&quot; class=&quot;headerlink&quot; title=&quot;利用朴素贝叶斯进行文本分类&quot;&gt;&lt;/a&gt;利用朴素贝叶斯进行文本分类&lt;/h1&gt;&lt;h2 id=&quot;准备数据&quot;&gt;&lt;a href=&quot;#准备数据&quot;
    
    </summary>
    
    
      <category term="machine learning" scheme="http://yoursite.com/tags/machine-learning/"/>
    
      <category term="Python" scheme="http://yoursite.com/tags/Python/"/>
    
      <category term="statistics" scheme="http://yoursite.com/tags/statistics/"/>
    
  </entry>
  
  <entry>
    <title>CS231n Lecture2 note</title>
    <link href="http://yoursite.com/2017/02/24/CS231n-Lecture2-note/"/>
    <id>http://yoursite.com/2017/02/24/CS231n-Lecture2-note/</id>
    <published>2017-02-24T09:14:17.000Z</published>
    <updated>2017-02-24T13:53:28.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="图像分类"><a href="#图像分类" class="headerlink" title="图像分类"></a>图像分类</h1><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>给一张输入图片赋予一个标签， 这个标签属于事先定义好的类别集合中</p><h2 id="地位"><a href="#地位" class="headerlink" title="地位"></a>地位</h2><p>计算机视觉的核心问题</p><h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n-lec2/classify_example.png" alt="classify_example"></p><h2 id="难点"><a href="#难点" class="headerlink" title="难点"></a>难点</h2><ol><li>拍摄点的视角多样</li><li>拍摄点的远近距离多样</li><li>物体的变形</li><li>物体部分遮挡</li><li>光线</li><li>背景相似</li><li>品种多样</li></ol><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n-lec2/challenges.jpeg" alt="challenges"></p><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>数据驱动（即包含训练数据）</p><h2 id="pipeline"><a href="#pipeline" class="headerlink" title="pipeline"></a>pipeline</h2><p>输入 -&gt; 学习 -&gt; 评估</p><h1 id="最近邻分类器"><a href="#最近邻分类器" class="headerlink" title="最近邻分类器"></a>最近邻分类器</h1><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n-lec2/nearest_neighbor.jpg" alt="nearest_neighbor"></p><h2 id="距离度量"><a href="#距离度量" class="headerlink" title="距离度量"></a>距离度量</h2><h4 id="L1-distance"><a href="#L1-distance" class="headerlink" title="L1 distance"></a>L1 distance</h4><script type="math/tex;mode=display">d_1 (I_1, I_2) = \sum_{p} \left| I^p_1 - I^p_2 \right|</script><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n-lec2/l1_distance.jpeg" alt="l1-distance"></p><h4 id="L2-distance"><a href="#L2-distance" class="headerlink" title="L2 distance"></a>L2 distance</h4><script type="math/tex;mode=display">d_2 (I_1, I_2) = \sqrt{\sum_{p} \left( I^p_1 - I^p_2 \right)^2}</script><h2 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h2><h3 id="数据读取"><a href="#数据读取" class="headerlink" title="数据读取"></a>数据读取</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Xtr, Ytr, Xte, Yte = load_CIFAR10(<span class="string">'data/cifar10/'</span>) <span class="comment"># a magic function we provide</span></div><div class="line"><span class="comment"># flatten out all images to be one-dimensional</span></div><div class="line">Xtr_rows = Xtr.reshape(Xtr.shape[<span class="number">0</span>], <span class="number">32</span> * <span class="number">32</span> * <span class="number">3</span>) <span class="comment"># Xtr_rows becomes 50000 x 3072</span></div><div class="line">Xte_rows = Xte.reshape(Xte.shape[<span class="number">0</span>], <span class="number">32</span> * <span class="number">32</span> * <span class="number">3</span>) <span class="comment"># Xte_rows becomes 10000 x 3072</span></div></pre></td></tr></table></figure><h3 id="预测及评估"><a href="#预测及评估" class="headerlink" title="预测及评估"></a>预测及评估</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">nn = NearestNeighbor() <span class="comment"># create a Nearest Neighbor classifier class</span></div><div class="line">nn.train(Xtr_rows, Ytr) <span class="comment"># train the classifier on the training images and labels</span></div><div class="line">Yte_predict = nn.predict(Xte_rows) <span class="comment"># predict labels on the test images</span></div><div class="line"><span class="comment"># and now print the classification accuracy, which is the average number</span></div><div class="line"><span class="comment"># of examples that are correctly predicted (i.e. label matches)</span></div><div class="line"><span class="keyword">print</span> <span class="string">'accuracy: %f'</span> % ( np.mean(Yte_predict == Yte) )</div></pre></td></tr></table></figure><h3 id="基本方法"><a href="#基本方法" class="headerlink" title="基本方法"></a>基本方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NearestNeighbor</span><span class="params">(object)</span>:</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">    <span class="keyword">pass</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self, X, y)</span>:</span></div><div class="line">    <span class="string">""" X is N x D where each row is an example. Y is 1-dimension of size N """</span></div><div class="line">    <span class="comment"># the nearest neighbor classifier simply remembers all the training data</span></div><div class="line">    self.Xtr = X</div><div class="line">    self.ytr = y</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(self, X)</span>:</span></div><div class="line">    <span class="string">""" X is N x D where each row is an example we wish to predict label for """</span></div><div class="line">    num_test = X.shape[<span class="number">0</span>]</div><div class="line">    <span class="comment"># lets make sure that the output type matches the input type</span></div><div class="line">    Ypred = np.zeros(num_test, dtype = self.ytr.dtype)</div><div class="line"></div><div class="line">    <span class="comment"># loop over all test rows</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(num_test):</div><div class="line">      <span class="comment"># find the nearest training image to the i'th test image</span></div><div class="line">      <span class="comment"># using the L1 distance (sum of absolute value differences)</span></div><div class="line">      distances = np.sum(np.abs(self.Xtr - X[i,:]), axis = <span class="number">1</span>)</div><div class="line">      min_index = np.argmin(distances) <span class="comment"># get the index with smallest distance</span></div><div class="line">      Ypred[i] = self.ytr[min_index] <span class="comment"># predict the label of the nearest example</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> Ypred</div></pre></td></tr></table></figure><h3 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h3><p><strong>L1-distance</strong> 38.6% on CIFAR-10</p><p><strong>L2-distance</strong> 35.4% on CIFAR-10</p><p><strong>L1 vs. L2</strong> L2比L1的差异容忍度更小</p><h1 id="K近邻分类器"><a href="#K近邻分类器" class="headerlink" title="K近邻分类器"></a>K近邻分类器</h1><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n-lec2/kNN.jpeg" alt="kNN"></p><h2 id="采用验证集进行超参调参"><a href="#采用验证集进行超参调参" class="headerlink" title="采用验证集进行超参调参"></a>采用验证集进行超参调参</h2><h3 id="实例代码"><a href="#实例代码" class="headerlink" title="实例代码"></a>实例代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># assume we have Xtr_rows, Ytr, Xte_rows, Yte as before</span></div><div class="line"><span class="comment"># recall Xtr_rows is 50,000 x 3072 matrix</span></div><div class="line">Xval_rows = Xtr_rows[:<span class="number">1000</span>, :] <span class="comment"># take first 1000 for validation</span></div><div class="line">Yval = Ytr[:<span class="number">1000</span>]</div><div class="line">Xtr_rows = Xtr_rows[<span class="number">1000</span>:, :] <span class="comment"># keep last 49,000 for train</span></div><div class="line">Ytr = Ytr[<span class="number">1000</span>:]</div><div class="line"></div><div class="line"><span class="comment"># find hyperparameters that work best on the validation set</span></div><div class="line">validation_accuracies = []</div><div class="line"><span class="keyword">for</span> k <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">50</span>, <span class="number">100</span>]:</div><div class="line">  </div><div class="line">  <span class="comment"># use a particular value of k and evaluation on validation data</span></div><div class="line">  nn = NearestNeighbor()</div><div class="line">  nn.train(Xtr_rows, Ytr)</div><div class="line">  <span class="comment"># here we assume a modified NearestNeighbor class that can take a k as input</span></div><div class="line">  Yval_predict = nn.predict(Xval_rows, k = k)</div><div class="line">  acc = np.mean(Yval_predict == Yval)</div><div class="line">  <span class="keyword">print</span> <span class="string">'accuracy: %f'</span> % (acc,)</div><div class="line"></div><div class="line">  <span class="comment"># keep track of what works on the validation set</span></div><div class="line">  validation_accuracies.append((k, acc))</div></pre></td></tr></table></figure><h3 id="交叉验证"><a href="#交叉验证" class="headerlink" title="交叉验证"></a>交叉验证</h3><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n-lec2/cv.jpeg" alt="cv"></p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n-lec2/cv_result.png" alt="cv_result"></p><h1 id="最近邻分类器的优缺点"><a href="#最近邻分类器的优缺点" class="headerlink" title="最近邻分类器的优缺点"></a>最近邻分类器的优缺点</h1><h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><p>训练速度快</p><h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><ol><li><p>测试速度很慢</p><p>​ 解决方法：1. ANN 2. FANN</p></li><li><p>距离度量不合适</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n-lec2/knn_shortage_1.png" alt="kNN_shortage_1"></p><p>​</p></li></ol><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n-lec2/knn_shortage_2.png" alt="kNN_shortage_2"></p><p>(<a href="http://cs231n.github.io/assets/pixels_embed_cifar10_big.jpg" target="_blank" rel="external">http://cs231n.github.io/assets/pixels_embed_cifar10_big.jpg</a>)</p><h1 id="接下来…"><a href="#接下来…" class="headerlink" title="接下来…"></a>接下来…</h1><p>t-SNE <a href="http://lvdmaaten.github.io/tsne/" target="_blank" rel="external">http://lvdmaaten.github.io/tsne/</a></p><p>random projection <a href="http://scikit-learn.org/stable/modules/random_projection.html" target="_blank" rel="external">http://scikit-learn.org/stable/modules/random_projection.html</a></p><p>INTUITION FAILS IN HIGH DIMENSIONS <a href="http://homes.cs.washington.edu/~pedrod/papers/cacm12.pdf" target="_blank" rel="external">http://homes.cs.washington.edu/~pedrod/papers/cacm12.pdf</a></p><p>Recognizing and Learning Object Categories <a href="http://people.csail.mit.edu/torralba/shortCourseRLOC/index.html" target="_blank" rel="external">http://people.csail.mit.edu/torralba/shortCourseRLOC/index.html</a></p><h1 id="线性分类"><a href="#线性分类" class="headerlink" title="线性分类"></a>线性分类</h1><h2 id="一个从图像到标签的映射函数"><a href="#一个从图像到标签的映射函数" class="headerlink" title="一个从图像到标签的映射函数"></a>一个从图像到标签的映射函数</h2><script type="math/tex;mode=display">f(x_i, W, b) =  W x_i + b</script><p>x shape is [D x 1], W shape is [K x D], b shape is [K x 1]</p><p>注意点：</p><ol><li>W代表K个分类器的参数放在一起，因此整个模型是K个分类器的一个整合</li><li>向量化能够大大提升计算速度</li></ol><h2 id="线性分类器的解释"><a href="#线性分类器的解释" class="headerlink" title="线性分类器的解释"></a>线性分类器的解释</h2><ol><li>权重W表示不同的标签对于图像不同位置不同颜色的重视程度。比如太阳可能对于圆形的区域以及黄颜色比较看重</li></ol><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n-lec2/linear_clasification_interpret_1.jpg" alt="linear_classification_interpret_1"></p><ol><li>将图像看成高维空间中的点</li></ol><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n-lec2/linear_clasification_interpret_2.jpg" alt="linear_clasification_interpret_2"></p><ol><li>将线性分类器看成模板匹配</li></ol><p>将W的每一行看成一个模板，通过内积计算，每一张图片张成的列向量都与每一个模板作比较，最后选出最匹配的，这也是一种最近邻算法。</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n-lec2/templates.jpg" alt="templates"></p><p>从上图可以看出，这里的模板是各个图像的一种折中。</p><h2 id="将bias项放入W中"><a href="#将bias项放入W中" class="headerlink" title="将bias项放入W中"></a>将bias项放入W中</h2><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n-lec2/wb.jpeg" alt="wb"></p><h2 id="数据预处理"><a href="#数据预处理" class="headerlink" title="数据预处理"></a>数据预处理</h2><p>​ 数据中心化</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;图像分类&quot;&gt;&lt;a href=&quot;#图像分类&quot; class=&quot;headerlink&quot; title=&quot;图像分类&quot;&gt;&lt;/a&gt;图像分类&lt;/h1&gt;&lt;h2 id=&quot;目标&quot;&gt;&lt;a href=&quot;#目标&quot; class=&quot;headerlink&quot; title=&quot;目标&quot;&gt;&lt;/a&gt;目标&lt;/h
    
    </summary>
    
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
      <category term="machine learning" scheme="http://yoursite.com/tags/machine-learning/"/>
    
      <category term="deep learning" scheme="http://yoursite.com/tags/deep-learning/"/>
    
  </entry>
  
  <entry>
    <title>Qiniu cloud images batch upload and directory synchronization</title>
    <link href="http://yoursite.com/2017/02/24/Qiniu-cloud-images-batch-upload-and-directory-synchronization/"/>
    <id>http://yoursite.com/2017/02/24/Qiniu-cloud-images-batch-upload-and-directory-synchronization/</id>
    <published>2017-02-24T07:28:57.000Z</published>
    <updated>2017-02-24T07:49:06.600Z</updated>
    
    <content type="html"><![CDATA[<p>最近写博客的时候会用到图片，因此用了七牛云的图片外链功能，但是其内容管理不能创建目录，所以图片的命名以及上传都很麻烦，然后去网上查了一下，也看了一下官方文档，发现官方有一个批量上传的工具挺好用，所以记录一下，下面把官方文档中的一些东西贴出来，方便日后查阅。</p><p>​ <img src="http://o7ie0tcjk.bkt.clouddn.com/Qiniu_Upload/qiniu_docu.jpg" alt="docu"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近写博客的时候会用到图片，因此用了七牛云的图片外链功能，但是其内容管理不能创建目录，所以图片的命名以及上传都很麻烦，然后去网上查了一下，也看了一下官方文档，发现官方有一个批量上传的工具挺好用，所以记录一下，下面把官方文档中的一些东西贴出来，方便日后查阅。&lt;/p&gt;&lt;p&gt;​ 
    
    </summary>
    
    
      <category term="Tools" scheme="http://yoursite.com/tags/Tools/"/>
    
  </entry>
  
  <entry>
    <title>Correlation Analysis</title>
    <link href="http://yoursite.com/2017/02/24/Correlation-Analysis/"/>
    <id>http://yoursite.com/2017/02/24/Correlation-Analysis/</id>
    <published>2017-02-24T02:22:42.000Z</published>
    <updated>2017-02-28T05:18:06.954Z</updated>
    
    <content type="html"><![CDATA[<h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>最近有一个关于关联分析的小作业，问题描述如下：</p><p>孩子的情感状况、品行症状、亲社会行为等等与很多因素相关，这个作业主要着眼点在于孩子每天看视频的时间是否对于以上这些指标有着重要的影响，因此需要对输入特征与输出标签之间的相关关系做一个分析。</p><p>属性描述如下：</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/features.png" alt="features"></p><p>由以上属性描述表可以看出，属性类型同时包括类别以及数值，因此进行相关分析时针对这两种情况需要采用不同的方法，这里采用的策略如下：</p><ol><li>对于离散-离散的情况，采用卡方检验</li><li>对于连续-离散的情况，采用ANOVA方差检验</li></ol><p>下面对于这两种检验方法进行介绍。</p><h1 id="卡方检验"><a href="#卡方检验" class="headerlink" title="卡方检验"></a>卡方检验</h1><h2 id="一维情况"><a href="#一维情况" class="headerlink" title="一维情况"></a>一维情况</h2><p>假设一条河里有三种鱼，gumpies, sticklebarbs, 以及spotheads。如果这条河的生态环境没有遭到干扰，那么这三种鱼的数量是相等的（下表第三行）。现在从河里进行300次抽样，最后抽样得到的结果如下表第二行所示：</p><div class="table-container"><table><thead><tr><th></th><th>gumpies</th><th>sticklebarbs</th><th>spothheads</th><th>Totals</th></tr></thead><tbody><tr><td>观察到的频数</td><td>89</td><td>120</td><td>91</td><td>300</td></tr><tr><td>期望的频数</td><td>100</td><td>100</td><td>100</td><td>300</td></tr></tbody></table></div><p>现在需要解决的问题是，是否这条河的生态环境收到了干扰？我们假设生态环境正常，这是我们的原假设。</p><p>（注意，期望的频数是根据实际情况自行定义的）</p><p>很容易想到的是，我们可以建立一种度量来衡量现实情况与原假设的偏离程度，例如：</p><script type="math/tex;mode=display">\frac{观察值 - 期望值}{期望值}</script><p>把实际的数据带入，可以得到以下的结果：</p><p>gumpies: $\frac{89 - 100}{100} = -0.11$</p><p>sticklebarbs: $\frac{120 - 100}{100} = +0.20$</p><p>spothheads: $\frac{91 - 100}{100} = -0.09$</p><p>发现结果还不错，但是这只能用来衡量单个类别的偏差程度，而不能用来衡量整体的偏差程度，因为这三者的加和为零。既然这样，很容易想到可以对之前的度量进行简单的修改，变成这样：</p><script type="math/tex;mode=display">\frac{(观察值 - 期望值)^2}{期望值}</script><p>再把数据带入看看：</p><p>gumpies: $\frac{(89 - 100)^2}{100} = 1.21$</p><p>sticklebarbs: $\frac{(120 - 100)^2}{100} = 4.0$</p><p>spothheads: $\frac{(91 - 100)}{100} = 0.81$</p><p>sum: $1.21 + 4.0 + 0.81 = 6.02$</p><p>这样一来问题便得到了解决，而这也正是卡方检验所采取的方式。而这个sum值就是卡方（chi-square），记作$\chi^2$， 为了更加形式化地表示，我们把观察值记为$O$， 期望值记为$E$， 那么有如下等式成立：</p><script type="math/tex;mode=display">\chi^2 = \sum \frac{(O - E) ^ 2}{E}</script><p>下面的问题是，我们达到了卡方值，但是这个值到底好还是不好呢？是更加支持原假设还是拒绝原假设呢？</p><p>可以设想这样一种情况，我们假设河里的鱼服从原假设的分布，也就是三种鱼出现的概率相等。然后我们把三百次采样看作一次实验，每一次实验完毕之后记录下采样出的300条鱼中每一种鱼的频数，然后计算卡方值。在进行很多次这样的实验之后，我们可以画一个柱状图，这个图记录下了卡方值的分布情况。然后再把实际的观察值（也就是上面表格的第二行）计算的卡方值（6.02）带入进去，看看大于或者等于这个值在柱状图中所有卡方值中占有多少比例。如果占有的比例很大，说明这个值是由跟原假设很近似的假设得出的，这就证明了原假设是对的；反之。如果这个比例很小，说明如果分布服从原假设，那么所计算出的卡方值基本不可能包含这个观测出的卡方值，表明原假设是不对的，我们就可以拒绝原假设。</p><p>其实统计检验的基本思想就是这样。但是存在一个问题，我们不可能进行真实的采样（从河里抓鱼），所以一般采用计算机模拟的方式，具体步骤如下所示：</p><ol><li>等概率的产生a（代表gumpies）, b（代表sticklebarbs）, c（代表spothheads）的序列</li><li>计算一个大小为300的序列中a, b, c三者的频数，作为观察值，然后将a = b = c = 100作为期望值，计算并记录下算出的卡方值</li><li>重复1~2步10000次， 画出柱状图如下：</li></ol><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/chi-square-distribution.gif" alt="chi-square-distribution"></p><p>可以看出只有5%左右的值大于6.02，说明我们可以以95%的置信度拒绝原假设。</p><h2 id="二维情况"><a href="#二维情况" class="headerlink" title="二维情况"></a>二维情况</h2><p>对于二维的情况，卡方检验又被称为卡方关联度检验，也就是检验两个变量之间的相关程度（独立程度），考虑下面这个数据表$O$：</p><div class="table-container"><table><thead><tr><th></th><th></th><th>Alzhemer’s onset -</th><th>during 5-year period</th><th></th></tr></thead><tbody><tr><td></td><td></td><td>no</td><td>yes</td><td></td></tr><tr><td>recieved-</td><td>yes</td><td>147</td><td>9</td><td>156</td></tr><tr><td>estrogen</td><td>no</td><td>810</td><td>158</td><td>968</td></tr><tr><td></td><td></td><td>957</td><td>167</td><td>1124</td></tr></tbody></table></div><p>这是观察值，为了计算卡方值，很明显我们需要计算期望值。</p><p>为了方便表示，把上表变成如下形式：</p><div class="table-container"><table><thead><tr><th></th><th></th><th>（A）Alzhemer’s onset -</th><th>during 5-year period</th><th></th></tr></thead><tbody><tr><td></td><td></td><td>no</td><td>yes</td><td></td></tr><tr><td>(R) recieved-</td><td>yes</td><td>[cell a]</td><td>[cell b]</td><td>156</td></tr><tr><td>estrogen</td><td>no</td><td>[cell c]</td><td>[cell d]</td><td>968</td></tr><tr><td></td><td></td><td>957</td><td>167</td><td>1124</td></tr></tbody></table></div><p>拿a做例子：</p><script type="math/tex;mode=display">E_a = \frac{156}{1124} \times \frac{957}{1124} \times 1124</script><p>这个式子如何解释呢？如果这两个变量是独立的，那么$A$变量取$no$值与$R$变量取$yes$值这两个事件之间就是独立的，那么$[cell_a]$事件发生的概率就是两者相乘，也就是上述等式右边前两个数相乘，最后的期望值自然就是概率乘以实验总数。</p><p>上面的解释比较不正式，换一种较为正式的表达方式。假设我们要求$cell$的期望值，设$R$为$cell$所在列的边缘事件总数，$C$为$cell$所在行的边缘事件总数，$N$为实验总数目，这样就有：</p><script type="math/tex;mode=display">E_{cell} =\frac{R}{N} \times \frac{C}{N} \times N</script><p>所以就有期望值$E$数据表如下：</p><div class="table-container"><table><thead><tr><th></th><th></th><th>（A）Alzhemer’s onset -</th><th>during 5-year period</th><th></th></tr></thead><tbody><tr><td></td><td></td><td>no</td><td>yes</td><td></td></tr><tr><td>(R) recieved-</td><td>yes</td><td>$E_a = \frac{156 \times 957}{1124} = 132.82$</td><td>$E_b = \frac{156 \times 167}{1124} = 23.18$</td><td>156</td></tr><tr><td>estrogen</td><td>no</td><td>$E_c = \frac{968 \times 957}{1124} = 824.18$</td><td>$E_d = \frac{968 \times 167}{1124} = 143.82$</td><td>968</td></tr><tr><td></td><td></td><td>957</td><td>167</td><td>1124</td></tr></tbody></table></div><p>这样就可以调用公式：</p><script type="math/tex;mode=display">\chi^2 = \sum \frac{(O - E) ^ 2}{E}</script><p>特别地，当行数以及列数都为2时，上述公式需要进行一下修改：</p><script type="math/tex;mode=display">\chi^2 = \sum \frac{(|O - E| - 0.5) ^ 2}{E}</script><p>这样算出来的卡方值为$11.01$</p><p>最后涉及到自由度的问题，因为比较简单，所以只写出结论：</p><script type="math/tex;mode=display">df = (r - 1)(c - 1)</script><p><strong>r = number of rows</strong></p><p><strong>c = number of columns</strong></p><h1 id="ANOVA方差检验"><a href="#ANOVA方差检验" class="headerlink" title="ANOVA方差检验"></a>ANOVA方差检验</h1><p>为了方便比较，同样采用上述阿尔兹海默病的例子。研究表明，老年痴呆症患者患病之后会经常经历情绪非常不稳定地阶段，原因是因为患者患病之前的生活中经常有恐惧或者焦虑的体验，正是这些一直存在于脑海中的记忆出发了患病后的不稳定情绪的产生。</p><p>现在我们假设有一个实验团队发明了一种药物，可以缓解这种情绪问题，他们对小白鼠进行了实验。实验设计如下：</p><ol><li>将小白鼠随机分为四组A， B， C， D</li><li>A组作为参照组，不给药；B， C， D三组分别注射一个单位，两个单位，三个单位的药剂</li><li>记录实验结果，数值越低表明实验效果越好</li></ol><p>实验结果如下：</p><div class="table-container"><table><thead><tr><th>A</th><th>B</th><th>C</th><th>D</th><th>Total</th></tr></thead><tbody><tr><td>27.0</td><td>22.8</td><td>21.9</td><td>23.5</td><td></td></tr><tr><td>26.2</td><td>23.1</td><td>23.4</td><td>19.6</td><td></td></tr><tr><td>28.8</td><td>27.7</td><td>20.1</td><td>23.7</td><td></td></tr><tr><td>33.5</td><td>27.6</td><td>27.8</td><td>20.8</td><td></td></tr><tr><td>28.8</td><td>24.0</td><td>19.3</td><td>23.9</td><td></td></tr><tr><td>$M_a = 28.86$</td><td>$M_b = 25.04$</td><td>$M_c = 22.50$</td><td>$M_d = 22.30$</td><td>$M_T = 24.68$</td></tr></tbody></table></div><p>下面需要进行一下相关性分析，判断药物是否对症状的缓解产生作用。</p><p>和卡方检验一样，ANOVA检验最后也有一个衡量指标，记为$F$，定义如下：</p><script type="math/tex;mode=display">F = \frac{MS_{bg}}{MS_{wg}} = \frac{组间相似度}{组内相似度}</script><p>具体的计算步骤如下所示（推导过程省略）</p><p>（1） 首先计算出如下值：</p><div class="table-container"><table><thead><tr><th>A</th><th>B</th><th>C</th><th>D</th><th>Total</th></tr></thead><tbody><tr><td>$N_A = 5$</td><td>$N_B = 5$</td><td>$N_C = 5$</td><td>$N_D = 5$</td><td>$N_T = 20$</td></tr><tr><td>$\sum X_{Ai} = 144.30$</td><td>$\sum X_{Bi} = 125.20$</td><td>$\sum X_{Ci} = 112.50$</td><td>$\sum X_{Di} = 111.50$</td><td>$\sum X_{Ti} = 493.50$</td></tr><tr><td>$\sum X^2_{Ai} = 4196.57$</td><td>$\sum X^2_{Bi} = 3158.50$</td><td>$\sum X^2_{Ci} = 2576.51$</td><td>$\sum X^2_{Di} = 2501.95$</td><td>$\sum X^2_{Ti} = 12433.53$</td></tr><tr><td>$SS_A = 32.07$</td><td>$SS_B = 23.49$</td><td>$SS_C = 45.26$</td><td>$SS_D = 15.50$</td><td>$SS_T = 256.42$</td></tr></tbody></table></div><p>其中：</p><script type="math/tex;mode=display">SS = \sum X^2_i - \frac{(\sum X_i)^2}{N}</script><p>（2）计算$SS<em>{wg}$以及$SS</em>{bg}$</p><script type="math/tex;mode=display">SS_{wg} = SS_A + SS_B + SS_C + SS_D</script><script type="math/tex;mode=display">SS_{bg} = SS_T - SS_{wg}</script><p>（4）计算相关自由度</p><script type="math/tex;mode=display">df_{bg} = k - 1 = 4 - 1 = 3</script><script type="math/tex;mode=display">df_{wg} = (N_A - 1) + (N_B - 1) + (N_C - 1) + (N_D - 1)</script><p>（5）计算 $MS<em>{bg}$以及$MS</em>{wg}$</p><script type="math/tex;mode=display">MS_{bg} = \frac{SS_{bg}}{df_{bg}}</script><script type="math/tex;mode=display">MS_{wg} = \frac{SS_{wg}}{df_{wg}}</script><p>（6）计算$F$</p><p>最后得出F = 6.42 （df = 3, 16）</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/f_distribution.png" alt="f_distribution"></p><h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> xlrd</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> scipy.stats <span class="keyword">as</span> stats</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetChildDetailLab</span><span class="params">(combine=True)</span>:</span></div><div class="line">    <span class="string">""" Get the detail labs of each child data.</span></div><div class="line"></div><div class="line">    Returns:</div><div class="line">        child_detail_lab: the detail labs.</div><div class="line">    """</div><div class="line"></div><div class="line">    CHILDS_FEATURE_LAB = [<span class="string">'tid'</span>, <span class="string">'age_m'</span>, <span class="string">'female'</span>, <span class="string">'onlychild'</span>, <span class="string">'divorce'</span>,</div><div class="line">                          <span class="string">'medu_newcat'</span>, <span class="string">'income_newcat'</span>, <span class="string">'scr_ave'</span>, <span class="string">'edu_ave'</span>,</div><div class="line">                          <span class="string">'edu_of_scr'</span>, <span class="string">'scr_h_cat'</span>, <span class="string">'mediacoview'</span>,</div><div class="line">                          <span class="string">'mediacontact'</span>]</div><div class="line">    CHILDS_CAT_LAB = [<span class="string">'emo_cat'</span>, <span class="string">'con_cat'</span>, <span class="string">'hyp_cat'</span>, <span class="string">'pee_cat'</span>,</div><div class="line">                      <span class="string">'difficulties_cat'</span>, <span class="string">'pro_cat'</span>]</div><div class="line"></div><div class="line">    <span class="keyword">if</span> combine:</div><div class="line">        CHILDS_DETAIL_LAB = CHILDS_FEATURE_LAB</div><div class="line">        CHILDS_DETAIL_LAB.extend(CHILDS_CAT_LAB)</div><div class="line">        <span class="keyword">return</span> CHILDS_DETAIL_LAB</div><div class="line"></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> CHILDS_FEATURE_LAB, CHILDS_CAT_LAB</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ReadChildInfoFromExcel</span><span class="params">(</span></span></div><div class="line">        file_name=<span class="string">'屏幕暴露与SDQ.xlsx'</span>, sheet_name=<span class="string">'data'</span>):</div><div class="line">    <span class="string">""" Read the screen-exposed vs.SDQ detail information</span></div><div class="line">        of each child from the excel-type file.</div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        file_name: the name of the excel-type file.</div><div class="line">        sheet_name: the name of the sheet of the excel file.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        child_scr_exp_sdq: A list that contains the detail</div><div class="line">                           information of each child.</div><div class="line">        labs: The lab corresponds to each colume of the data.</div><div class="line">    """</div><div class="line"></div><div class="line">    CHILDS_FILE_NAME = <span class="string">'child_scr_exp_sdq.npy'</span></div><div class="line">    CHILDS_DETAIL_LAB = GetChildDetailLab()</div><div class="line">    <span class="comment"># print(CHILDS_DETAIL_LAB)</span></div><div class="line">    NOT_INT_LAB_INDEIES = [CHILDS_DETAIL_LAB.index(<span class="string">'age_m'</span>),</div><div class="line">                           CHILDS_DETAIL_LAB.index(<span class="string">'scr_ave'</span>),</div><div class="line">                           CHILDS_DETAIL_LAB.index(<span class="string">'edu_ave'</span>),</div><div class="line">                           CHILDS_DETAIL_LAB.index(<span class="string">'edu_of_scr'</span>)]</div><div class="line"></div><div class="line">    child_scr_exp_sdq = []</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (os.path.isfile(CHILDS_FILE_NAME)):</div><div class="line">        <span class="keyword">with</span> open(CHILDS_FILE_NAME, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</div><div class="line">            child_scr_exp_sdq = np.load(f)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        workBook = xlrd.open_workbook(file_name)</div><div class="line">        bookSheet = workBook.sheet_by_name(sheet_name)</div><div class="line">        <span class="comment"># read from second row because of the first row has tabs</span></div><div class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> range(<span class="number">1</span>, bookSheet.nrows):</div><div class="line">            child_row = []</div><div class="line">            <span class="keyword">for</span> col <span class="keyword">in</span> range(bookSheet.ncols):</div><div class="line">                cel = bookSheet.cell(row, col)</div><div class="line">                <span class="keyword">try</span>:</div><div class="line">                    val = str(cel.value)</div><div class="line">                    <span class="comment"># tolerant the value error</span></div><div class="line">                    <span class="keyword">if</span> val == <span class="string">''</span>:</div><div class="line">                        val = <span class="string">'-1.0'</span></div><div class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">                    print(e)</div><div class="line"></div><div class="line">                <span class="comment"># because of the type is different</span></div><div class="line">                <span class="keyword">try</span>:</div><div class="line">                    <span class="keyword">if</span> col <span class="keyword">in</span> NOT_INT_LAB_INDEIES:</div><div class="line">                        val = float(val)</div><div class="line">                    <span class="keyword">else</span>:</div><div class="line">                        <span class="comment"># in Excel, if cel.value is 1, then str(cel.value) is</span></div><div class="line">                        <span class="comment"># '1.0'</span></div><div class="line">                        val = val.split(<span class="string">'.'</span>)[<span class="number">0</span>]</div><div class="line">                        val = int(val)</div><div class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">                    print(e)</div><div class="line">                    val = <span class="number">-1</span></div><div class="line">                child_row.append(val)</div><div class="line">            child_scr_exp_sdq.append(child_row)</div><div class="line">        child_scr_exp_sdq = np.array(child_scr_exp_sdq)</div><div class="line">        <span class="keyword">with</span> open(CHILDS_FILE_NAME, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</div><div class="line">            np.save(f, child_scr_exp_sdq)</div><div class="line">    <span class="keyword">return</span> child_scr_exp_sdq, CHILDS_DETAIL_LAB</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">SplitDataSet</span><span class="params">(data_set, feature, cat)</span>:</span></div><div class="line">    <span class="string">""" Split the data set to two column, that is feature and cat</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        data_set: the source data set.</div><div class="line">        feature: the input vector</div><div class="line">        cat: the correspond category.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        splited_data_set: self-explation.</div><div class="line">    """</div><div class="line"></div><div class="line">    CHILDS_DETAIL_LAB = GetChildDetailLab()</div><div class="line">    feature_index = CHILDS_DETAIL_LAB.index(feature)</div><div class="line">    cat_index = CHILDS_DETAIL_LAB.index(cat)</div><div class="line">    <span class="comment"># print(feature_index, cat_index)</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> data_set[:, (feature_index, cat_index)]</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">CalChi2</span><span class="params">(data_set)</span>:</span></div><div class="line">    <span class="string">""" Calculate the chi-square value and p-value corresponds to the data set.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        data_set: the object data set.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        chi2: the chi-square value.</div><div class="line">        p: the p-value.</div><div class="line">    """</div><div class="line"></div><div class="line">    rows_number = len(set(data_set[:, <span class="number">-1</span>]))</div><div class="line">    columns_number = len(set(data_set[:, <span class="number">0</span>]))</div><div class="line">    <span class="comment"># print(rows_number, columns_number)</span></div><div class="line">    counts = np.zeros((rows_number, columns_number))</div><div class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> data_set:</div><div class="line">        <span class="keyword">if</span> row[<span class="number">-1</span>] != <span class="number">-1</span>:</div><div class="line">            <span class="keyword">if</span> row[<span class="number">0</span>] != <span class="number">-1</span>:</div><div class="line">                <span class="keyword">try</span>:</div><div class="line">                    counts[int(row[<span class="number">-1</span>])][int(row[<span class="number">0</span>])] += <span class="number">1</span></div><div class="line">                <span class="keyword">except</span>:</div><div class="line">                    <span class="keyword">pass</span></div><div class="line">    <span class="comment"># drop the row that all item is 0</span></div><div class="line">    del_row_index = []</div><div class="line">    <span class="keyword">for</span> index, count <span class="keyword">in</span> enumerate(counts):</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> count.any():</div><div class="line">            del_row_index.append(index)</div><div class="line">    counts = np.delete(counts, tuple(del_row_index), axis=<span class="number">0</span>)</div><div class="line"></div><div class="line">    <span class="comment"># drop the column that all item is 0</span></div><div class="line">    del_col_index = []</div><div class="line">    <span class="keyword">for</span> index, count <span class="keyword">in</span> enumerate(counts.T):</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> count.any():</div><div class="line">            del_col_index.append(index)</div><div class="line">    counts = np.delete(counts, tuple(del_col_index), axis=<span class="number">1</span>)</div><div class="line">    <span class="comment"># print(counts)</span></div><div class="line"></div><div class="line">    <span class="comment"># calculate the chi-square value and correspond p-value</span></div><div class="line">    chi2, p, dof, excepted = stats.chi2_contingency(counts)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> chi2, p</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ANOVATest</span><span class="params">(data_set)</span>:</span></div><div class="line">    <span class="string">""" Implement a ANOVA test on the data set.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        data_set: the object data set.</div><div class="line"></div><div class="line">    Return:</div><div class="line">        f: The computed F-value of the test.</div><div class="line">        p: The associated p-value from the F-distribution.</div><div class="line">    """</div><div class="line"></div><div class="line">    <span class="comment"># Initial the three categories</span></div><div class="line">    normal = []</div><div class="line">    critical = []</div><div class="line">    abnormal = []</div><div class="line"></div><div class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> data_set:</div><div class="line">        <span class="keyword">if</span> data[<span class="number">0</span>] != <span class="number">-1</span>:</div><div class="line">            <span class="keyword">if</span> data[<span class="number">-1</span>] == <span class="number">0</span>:</div><div class="line">                normal.append(data[<span class="number">0</span>])</div><div class="line">            <span class="keyword">elif</span> data[<span class="number">-1</span>] == <span class="number">1</span>:</div><div class="line">                critical.append(data[<span class="number">0</span>])</div><div class="line">            <span class="keyword">elif</span> data[<span class="number">-1</span>] == <span class="number">2</span>:</div><div class="line">                abnormal.append(data[<span class="number">0</span>])</div><div class="line"></div><div class="line">    f, p = stats.f_oneway(normal, critical, abnormal)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> f, p</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">GenerateCoffMatrix</span><span class="params">(data_set)</span>:</span></div><div class="line">    <span class="string">""" Calculate the chi-square and p-value of each feature-category pair.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        data_set: the source data set.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        coff_matrix: the final cofficient matrix.</div><div class="line">    """</div><div class="line"></div><div class="line">    coff_matrix = &#123;&#125;</div><div class="line">    CHILDS_FEATURE_LAB, CHILDS_CAT_LAB = GetChildDetailLab(combine=<span class="keyword">False</span>)</div><div class="line">    NOT_KEEP_FEATURE_LAB = [<span class="string">'tid'</span>, <span class="string">'age_m'</span>, <span class="string">'scr_ave'</span>, <span class="string">'edu_ave'</span>, <span class="string">'edu_of_scr'</span>]</div><div class="line">    <span class="keyword">for</span> feature <span class="keyword">in</span> CHILDS_FEATURE_LAB:</div><div class="line">        <span class="keyword">if</span> feature <span class="keyword">in</span> NOT_KEEP_FEATURE_LAB:</div><div class="line">            <span class="keyword">if</span> feature != NOT_KEEP_FEATURE_LAB[<span class="number">0</span>]:</div><div class="line">                <span class="keyword">for</span> cat <span class="keyword">in</span> CHILDS_CAT_LAB:</div><div class="line">                    splited_data_set = SplitDataSet(data_set, feature, cat)</div><div class="line">                    <span class="comment"># print(feature, cat)</span></div><div class="line">                    f, p = ANOVATest(splited_data_set)</div><div class="line">                    key = feature + <span class="string">'-'</span> + cat</div><div class="line">                    coff_matrix[key] = (f, p)</div><div class="line"></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">for</span> cat <span class="keyword">in</span> CHILDS_CAT_LAB:</div><div class="line">                splited_data_set = SplitDataSet(data_set, feature, cat)</div><div class="line">                <span class="comment"># print(feature, cat)</span></div><div class="line">                chi2, p = CalChi2(splited_data_set)</div><div class="line">                key = feature + <span class="string">'-'</span> + cat</div><div class="line">                coff_matrix[key] = (chi2, p)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> coff_matrix</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">SiftRelativeFeature</span><span class="params">(coff_matrix, conf=<span class="number">1e-5</span>)</span>:</span></div><div class="line">    <span class="string">""" Sift the feature that satisfy the caonfident condition.</span></div><div class="line"></div><div class="line">    Arguemnts:</div><div class="line">        coff_matrix: the calculated cofficient matrix for</div><div class="line">                     all features and categories.</div><div class="line">        conf: the confident.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        relative_feature_matrix: the satisfied feature and correspond</div><div class="line">                                 category and chi2 and p-value.</div><div class="line">    """</div><div class="line"></div><div class="line">    relative_feature_matrix = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> coff_matrix.keys():</div><div class="line">        <span class="keyword">if</span> coff_matrix[key][<span class="number">-1</span>] &lt;= conf:</div><div class="line">            relative_feature_matrix[key] = coff_matrix[key]</div><div class="line"></div><div class="line">    <span class="keyword">return</span> relative_feature_matrix</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">WriteResult</span><span class="params">(coff_matrix, file_name=<span class="string">'result.txt'</span>)</span>:</span></div><div class="line">    <span class="string">""" Write the result to file.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        relative_feature_matrix: the satisfied feature and correspond</div><div class="line">                                 category and chi2 and p-value.</div><div class="line">        file_name: the result file name.</div><div class="line">    """</div><div class="line"></div><div class="line">    <span class="comment"># Sort</span></div><div class="line">    sorted_coff_matrix = sorted(coff_matrix.items(),</div><div class="line">                                key=<span class="keyword">lambda</span> item: item[<span class="number">1</span>][<span class="number">-1</span>], reverse=<span class="keyword">False</span>)</div><div class="line"></div><div class="line">    <span class="comment"># print(sorted_coff_matrix)</span></div><div class="line"></div><div class="line">    <span class="keyword">with</span> open(file_name, <span class="string">'w'</span>) <span class="keyword">as</span> f:</div><div class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> sorted_coff_matrix:</div><div class="line">            f.write(str(item))</div><div class="line">            f.write(<span class="string">'\n'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    data_set, labels = ReadChildInfoFromExcel()</div><div class="line">    <span class="comment"># splited_data_set = SplitDataSet(data_set, 'female', 'difficulties_cat')</span></div><div class="line">    <span class="comment"># chi2, p = CalChi2(splited_data_set)</span></div><div class="line">    coff_matrix = GenerateCoffMatrix(data_set)</div><div class="line">    <span class="comment"># relative_feature = SiftRelativeFeature(coff_matrix, 1)</span></div><div class="line">    WriteResult(coff_matrix)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/anova_chi_result.png" alt="result"></p><h1 id="因子分析"><a href="#因子分析" class="headerlink" title="因子分析"></a>因子分析</h1><p>先说说因子分析与主成分分析的区别，下面的话<strong>引自知乎</strong>(<a href="https://www.zhihu.com/question/24524693" target="_blank" rel="external">https://www.zhihu.com/question/24524693</a>)</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/pca_fa_compare_1.png" alt="pca_fa_1"></p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/pca_fa_compare_2.png" alt="pca_fa_2"></p><p>具体实现使用SPSS软件进行实现：</p><p>操作步骤如下(<strong>引自 SPSS数据分析从入门到精通-陈胜可</strong>)：</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/spss_1.png" alt="spss_1"></p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/spss_2.png" alt="spss_2"></p><p>实验结果如下：</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/fa_result.png" alt="fa_result"></p><hr><p>2017.2.27 Updates</p><h1 id="决策树"><a href="#决策树" class="headerlink" title="决策树"></a>决策树</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> tree</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> cross_val_score</div><div class="line"></div><div class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</div><div class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></div></pre></td></tr></table></figure><h2 id="Read-data"><a href="#Read-data" class="headerlink" title="Read data"></a>Read data</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data = pd.read_excel(<span class="string">'./scr_SDQ.xlsx'</span>, sheetname=<span class="string">'data'</span>, index_col=<span class="number">0</span>).dropna().sort_index()</div></pre></td></tr></table></figure><h2 id="Convert-the-data-format"><a href="#Convert-the-data-format" class="headerlink" title="Convert the data format"></a>Convert the data format</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">float_columns = [<span class="string">'scr_ave'</span>, <span class="string">'edu_ave'</span>,<span class="string">'scr_of_edu'</span>]</div><div class="line"><span class="keyword">for</span> column <span class="keyword">in</span> data.columns:</div><div class="line">    <span class="keyword">if</span> column <span class="keyword">not</span> <span class="keyword">in</span> float_columns:</div><div class="line">        data[column] = data[column].astype(int)</div></pre></td></tr></table></figure><h2 id="Split-the-data"><a href="#Split-the-data" class="headerlink" title="Split the data"></a>Split the data</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data_feature_with_edu_ave = data.ix[:, :<span class="string">'mediacontact'</span>].drop(<span class="string">'scr_of_edu'</span>, axis=<span class="number">1</span>)</div><div class="line">data_feature_with_scr_of_edu = data.ix[:, :<span class="string">'mediacontact'</span>].drop(<span class="string">'edu_ave'</span>, axis=<span class="number">1</span>)</div><div class="line">data_classes = data.ix[:, <span class="string">'emo_cat'</span>:]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># dtree = tree.DecisionTreeClassifier(min_samples_leaf=500)</span></div><div class="line"><span class="comment"># cross_val_score(dtree,data_feature_with_edu_ave, data_classes['difficulties_cat'], cv=10)</span></div></pre></td></tr></table></figure><pre><code>array([ 0.64356436,  0.64356436,  0.64391855,  0.64391855,  0.64407713,
        0.64407713,  0.64407713,  0.64407713,  0.64407713,  0.64407713])
</code></pre><h2 id="difficulties-cat"><a href="#difficulties-cat" class="headerlink" title="difficulties_cat"></a>difficulties_cat</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">dtree_with_edu_ave = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_edu_ave = dtree_with_edu_ave.fit(data_feature_with_edu_ave, data_classes[<span class="string">'difficulties_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_edu_ave.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_edu_ave.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line">dtree_with_scr_of_edu = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_scr_of_edu = dtree_with_scr_of_edu.fit(data_feature_with_scr_of_edu, data_classes[<span class="string">'difficulties_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_scr_of_edu.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_scr_of_edu.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line"><span class="comment"># dtree_with_edu_ave_diff.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_edu_ave_diff.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_edu_ave, out_file=dot_file, feature_names=data_feature_with_edu_ave.columns)</div><div class="line"><span class="comment"># dtree_with_scr_of_edu_diff.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_scr_of_edu_diff.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_scr_of_edu, out_file=dot_file, feature_names=data_feature_with_scr_of_edu.columns)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Imp</th></tr></thead><tbody><tr><th>scr_ave</th><td>0.553782</td></tr><tr><th>medu_newcat</th><td>0.217218</td></tr><tr><th>age_m</th><td>0.085820</td></tr><tr><th>income_newcat</th><td>0.048912</td></tr><tr><th>edu_ave</th><td>0.029740</td></tr><tr><th>female</th><td>0.026161</td></tr><tr><th>onlychild</th><td>0.021336</td></tr><tr><th>mediacontact</th><td>0.017030</td></tr><tr><th>divorce</th><td>0.000000</td></tr><tr><th>scr_h_cat</th><td>0.000000</td></tr><tr><th>mediacoview</th><td>0.000000</td></tr></tbody></table></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_edu_ave_diff.png" alt="edu_ave_diff"></p><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Imp</th></tr></thead><tbody><tr><th>scr_ave</th><td>0.525587</td></tr><tr><th>medu_newcat</th><td>0.213067</td></tr><tr><th>age_m</th><td>0.084708</td></tr><tr><th>scr_of_edu</th><td>0.080575</td></tr><tr><th>mediacontact</th><td>0.029232</td></tr><tr><th>female</th><td>0.025661</td></tr><tr><th>onlychild</th><td>0.020929</td></tr><tr><th>income_newcat</th><td>0.020240</td></tr><tr><th>divorce</th><td>0.000000</td></tr><tr><th>scr_h_cat</th><td>0.000000</td></tr><tr><th>mediacoview</th><td>0.000000</td></tr></tbody></table></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_scr_of_edu_diff.png" alt="scr_of_edu_diff"></p><h2 id="emo-cat"><a href="#emo-cat" class="headerlink" title="emo_cat"></a>emo_cat</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">dtree_with_edu_ave = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_edu_ave = dtree_with_edu_ave.fit(data_feature_with_edu_ave, data_classes[<span class="string">'emo_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_edu_ave.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_edu_ave.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line">dtree_with_scr_of_edu = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_scr_of_edu = dtree_with_scr_of_edu.fit(data_feature_with_scr_of_edu, data_classes[<span class="string">'emo_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_scr_of_edu.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_scr_of_edu.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line"><span class="comment"># dtree_with_edu_ave_emo.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_edu_ave_emo.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_edu_ave, out_file=dot_file, feature_names=data_feature_with_edu_ave.columns)</div><div class="line"><span class="comment"># dtree_with_scr_of_edu_emo.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_scr_of_edu_emo.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_scr_of_edu, out_file=dot_file, feature_names=data_feature_with_scr_of_edu.columns)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Imp</th></tr></thead><tbody><tr><th>scr_ave</th><td>0.521694</td></tr><tr><th>medu_newcat</th><td>0.159798</td></tr><tr><th>income_newcat</th><td>0.147978</td></tr><tr><th>edu_ave</th><td>0.083233</td></tr><tr><th>age_m</th><td>0.040750</td></tr><tr><th>female</th><td>0.023781</td></tr><tr><th>mediacontact</th><td>0.019127</td></tr><tr><th>mediacoview</th><td>0.003639</td></tr><tr><th>onlychild</th><td>0.000000</td></tr><tr><th>divorce</th><td>0.000000</td></tr><tr><th>scr_h_cat</th><td>0.000000</td></tr></tbody></table></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_edu_ave_emo.png" alt="edu_ave_emo"></p><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Imp</th></tr></thead><tbody><tr><th>scr_ave</th><td>0.520711</td></tr><tr><th>income_newcat</th><td>0.155111</td></tr><tr><th>medu_newcat</th><td>0.146762</td></tr><tr><th>scr_of_edu</th><td>0.115745</td></tr><tr><th>age_m</th><td>0.023767</td></tr><tr><th>female</th><td>0.021924</td></tr><tr><th>mediacontact</th><td>0.011410</td></tr><tr><th>mediacoview</th><td>0.004571</td></tr><tr><th>onlychild</th><td>0.000000</td></tr><tr><th>divorce</th><td>0.000000</td></tr><tr><th>scr_h_cat</th><td>0.000000</td></tr></tbody></table></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_scr_of_edu_emo.png" alt="scr_of_edu_emo"></p><h2 id="con-cat"><a href="#con-cat" class="headerlink" title="con_cat"></a>con_cat</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">dtree_with_edu_ave = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_edu_ave = dtree_with_edu_ave.fit(data_feature_with_edu_ave, data_classes[<span class="string">'con_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_edu_ave.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_edu_ave.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line">dtree_with_scr_of_edu = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_scr_of_edu = dtree_with_scr_of_edu.fit(data_feature_with_scr_of_edu, data_classes[<span class="string">'con_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_scr_of_edu.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_scr_of_edu.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line"><span class="comment"># dtree_with_edu_ave_con.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_edu_ave_con.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_edu_ave, out_file=dot_file, feature_names=data_feature_with_edu_ave.columns)</div><div class="line"><span class="comment"># dtree_with_scr_of_edu_con.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_scr_of_edu_con.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_scr_of_edu, out_file=dot_file, feature_names=data_feature_with_scr_of_edu.columns)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Imp</th></tr></thead><tbody><tr><th>scr_ave</th><td>0.562325</td></tr><tr><th>medu_newcat</th><td>0.098819</td></tr><tr><th>mediacontact</th><td>0.095089</td></tr><tr><th>edu_ave</th><td>0.077572</td></tr><tr><th>female</th><td>0.064213</td></tr><tr><th>income_newcat</th><td>0.056334</td></tr><tr><th>age_m</th><td>0.023696</td></tr><tr><th>onlychild</th><td>0.013513</td></tr><tr><th>mediacoview</th><td>0.008440</td></tr><tr><th>divorce</th><td>0.000000</td></tr><tr><th>scr_h_cat</th><td>0.000000</td></tr></tbody></table></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_edu_ave_con.png" alt="edu_ave_con"></p><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Imp</th></tr></thead><tbody><tr><th>scr_ave</th><td>0.511282</td></tr><tr><th>scr_of_edu</th><td>0.110155</td></tr><tr><th>medu_newcat</th><td>0.097473</td></tr><tr><th>mediacontact</th><td>0.093793</td></tr><tr><th>female</th><td>0.082843</td></tr><tr><th>income_newcat</th><td>0.055566</td></tr><tr><th>age_m</th><td>0.035552</td></tr><tr><th>onlychild</th><td>0.013335</td></tr><tr><th>divorce</th><td>0.000000</td></tr><tr><th>scr_h_cat</th><td>0.000000</td></tr><tr><th>mediacoview</th><td>0.000000</td></tr></tbody></table></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_scr_of_edu_con.png" alt="scr_of_edu_con"></p><h2 id="hyp-cat"><a href="#hyp-cat" class="headerlink" title="hyp_cat"></a>hyp_cat</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">dtree_with_edu_ave = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_edu_ave = dtree_with_edu_ave.fit(data_feature_with_edu_ave, data_classes[<span class="string">'hyp_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_edu_ave.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_edu_ave.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line">dtree_with_scr_of_edu = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_scr_of_edu = dtree_with_scr_of_edu.fit(data_feature_with_scr_of_edu, data_classes[<span class="string">'hyp_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_scr_of_edu.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_scr_of_edu.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line"><span class="comment"># dtree_with_edu_ave_hyp.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_edu_ave_hyp.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_edu_ave, out_file=dot_file, feature_names=data_feature_with_edu_ave.columns)</div><div class="line"><span class="comment"># dtree_with_scr_of_edu_hyp.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_scr_of_edu_hyp.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_scr_of_edu, out_file=dot_file, feature_names=data_feature_with_scr_of_edu.columns)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Imp</th></tr></thead><tbody><tr><th>medu_newcat</th><td>0.343448</td></tr><tr><th>scr_ave</th><td>0.265652</td></tr><tr><th>onlychild</th><td>0.165487</td></tr><tr><th>edu_ave</th><td>0.076194</td></tr><tr><th>income_newcat</th><td>0.054466</td></tr><tr><th>age_m</th><td>0.046774</td></tr><tr><th>mediacontact</th><td>0.020992</td></tr><tr><th>mediacoview</th><td>0.015532</td></tr><tr><th>female</th><td>0.011454</td></tr><tr><th>divorce</th><td>0.000000</td></tr><tr><th>scr_h_cat</th><td>0.000000</td></tr></tbody></table></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_edu_ave_hyp.png" alt="edu_ave_hyp"></p><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Imp</th></tr></thead><tbody><tr><th>medu_newcat</th><td>0.335192</td></tr><tr><th>scr_ave</th><td>0.257218</td></tr><tr><th>onlychild</th><td>0.161509</td></tr><tr><th>scr_of_edu</th><td>0.105471</td></tr><tr><th>age_m</th><td>0.065618</td></tr><tr><th>income_newcat</th><td>0.033129</td></tr><tr><th>mediacontact</th><td>0.022542</td></tr><tr><th>mediacoview</th><td>0.012901</td></tr><tr><th>female</th><td>0.006421</td></tr><tr><th>divorce</th><td>0.000000</td></tr><tr><th>scr_h_cat</th><td>0.000000</td></tr></tbody></table></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_scr_of_edu_hyp.png" alt="scr_of_edu_hyp"></p><h2 id="pee-cat"><a href="#pee-cat" class="headerlink" title="pee_cat"></a>pee_cat</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">dtree_with_edu_ave = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_edu_ave = dtree_with_edu_ave.fit(data_feature_with_edu_ave, data_classes[<span class="string">'pee_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_edu_ave.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_edu_ave.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line">dtree_with_scr_of_edu = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_scr_of_edu = dtree_with_scr_of_edu.fit(data_feature_with_scr_of_edu, data_classes[<span class="string">'pee_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_scr_of_edu.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_scr_of_edu.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line"><span class="comment"># dtree_with_edu_ave_pee.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_edu_ave_pee.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_edu_ave, out_file=dot_file, feature_names=data_feature_with_edu_ave.columns)</div><div class="line"></div><div class="line"><span class="comment"># dtree_with_scr_of_edu_pee.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_scr_of_edu_pee.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_scr_of_edu, out_file=dot_file, feature_names=data_feature_with_scr_of_edu.columns)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Imp</th></tr></thead><tbody><tr><th>scr_ave</th><td>0.441246</td></tr><tr><th>income_newcat</th><td>0.210646</td></tr><tr><th>female</th><td>0.152568</td></tr><tr><th>age_m</th><td>0.151888</td></tr><tr><th>medu_newcat</th><td>0.033530</td></tr><tr><th>mediacoview</th><td>0.009625</td></tr><tr><th>edu_ave</th><td>0.000498</td></tr><tr><th>onlychild</th><td>0.000000</td></tr><tr><th>divorce</th><td>0.000000</td></tr><tr><th>scr_h_cat</th><td>0.000000</td></tr><tr><th>mediacontact</th><td>0.000000</td></tr></tbody></table></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_edu_ave_pee.png" alt="edu_ave_pee"></p><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Imp</th></tr></thead><tbody><tr><th>scr_ave</th><td>0.430946</td></tr><tr><th>income_newcat</th><td>0.200188</td></tr><tr><th>age_m</th><td>0.151286</td></tr><tr><th>female</th><td>0.139104</td></tr><tr><th>medu_newcat</th><td>0.033289</td></tr><tr><th>scr_of_edu</th><td>0.033259</td></tr><tr><th>mediacoview</th><td>0.011927</td></tr><tr><th>onlychild</th><td>0.000000</td></tr><tr><th>divorce</th><td>0.000000</td></tr><tr><th>scr_h_cat</th><td>0.000000</td></tr><tr><th>mediacontact</th><td>0.000000</td></tr></tbody></table></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_scr_of_edu_pee.png" alt="scr_of_edu_pee"></p><h2 id="pro-cat"><a href="#pro-cat" class="headerlink" title="pro_cat"></a>pro_cat</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">dtree_with_edu_ave = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_edu_ave = dtree_with_edu_ave.fit(data_feature_with_edu_ave, data_classes[<span class="string">'pro_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_edu_ave.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_edu_ave.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line">dtree_with_scr_of_edu = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_scr_of_edu = dtree_with_scr_of_edu.fit(data_feature_with_scr_of_edu, data_classes[<span class="string">'pro_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_scr_of_edu.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_scr_of_edu.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line"><span class="comment"># dtree_with_edu_ave_pro.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_edu_ave_pro.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_edu_ave, out_file=dot_file, feature_names=data_feature_with_edu_ave.columns)</div><div class="line"><span class="comment"># dtree_with_scr_of_edu_pro.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_scr_of_edu_pro.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_scr_of_edu, out_file=dot_file, feature_names=data_feature_with_scr_of_edu.columns)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Imp</th></tr></thead><tbody><tr><th>female</th><td>0.295389</td></tr><tr><th>scr_ave</th><td>0.252091</td></tr><tr><th>mediacontact</th><td>0.145010</td></tr><tr><th>age_m</th><td>0.137453</td></tr><tr><th>income_newcat</th><td>0.085421</td></tr><tr><th>edu_ave</th><td>0.062697</td></tr><tr><th>medu_newcat</th><td>0.021938</td></tr><tr><th>onlychild</th><td>0.000000</td></tr><tr><th>divorce</th><td>0.000000</td></tr><tr><th>scr_h_cat</th><td>0.000000</td></tr><tr><th>mediacoview</th><td>0.000000</td></tr></tbody></table></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_edu_ave_pro.png" alt="edu_ave_pro"></p><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Imp</th></tr></thead><tbody><tr><th>female</th><td>0.299316</td></tr><tr><th>scr_ave</th><td>0.204496</td></tr><tr><th>mediacontact</th><td>0.131972</td></tr><tr><th>age_m</th><td>0.125169</td></tr><tr><th>scr_of_edu</th><td>0.111909</td></tr><tr><th>income_newcat</th><td>0.080072</td></tr><tr><th>medu_newcat</th><td>0.047066</td></tr><tr><th>onlychild</th><td>0.000000</td></tr><tr><th>divorce</th><td>0.000000</td></tr><tr><th>scr_h_cat</th><td>0.000000</td></tr><tr><th>mediacoview</th><td>0.000000</td></tr></tbody></table></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_scr_of_edu_pro.png" alt="scr_of_edu_pro"></p><h2 id="Convert-continuous-variables-to-categorical-variables"><a href="#Convert-continuous-variables-to-categorical-variables" class="headerlink" title="Convert continuous variables to categorical variables"></a>Convert continuous variables to categorical variables</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data_category = data.copy()</div><div class="line"><span class="keyword">for</span> column <span class="keyword">in</span> data_category.columns:</div><div class="line">    <span class="keyword">if</span> column <span class="keyword">in</span> float_columns:</div><div class="line">        data_category[column] = pd.cut(data_category[column], <span class="number">10</span>, labels=np.arange(<span class="number">10</span>))</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data_cate_feature_with_edu_ave = data_category.ix[:, :<span class="string">'mediacontact'</span>].drop(<span class="string">'scr_of_edu'</span>, axis=<span class="number">1</span>)</div><div class="line">data_cate_feature_with_scr_of_edu = data_category.ix[:, :<span class="string">'mediacontact'</span>].drop(<span class="string">'edu_ave'</span>, axis=<span class="number">1</span>)</div><div class="line">data_cate_classes = data.ix[:, <span class="string">'emo_cat'</span>:]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dtree_cate = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">50</span>)</div><div class="line">cross_val_score(dtree_cate,data_cate_feature_with_edu_ave, data_cate_classes[<span class="string">'difficulties_cat'</span>], cv=<span class="number">10</span>).sum() / <span class="number">10</span></div></pre></td></tr></table></figure><pre><code>0.63948514409153423
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">dtree_cate_with_edu_ave = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_cate_with_edu_ave = dtree_with_edu_ave.fit(data_cate_feature_with_edu_ave, data_cate_classes[<span class="string">'difficulties_cat'</span>])</div><div class="line">pd.DataFrame(dtree_cate_with_edu_ave.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_cate_feature_with_edu_ave.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line">dtree_cate_with_scr_of_edu = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_cate_with_scr_of_edu = dtree_cate_with_scr_of_edu.fit(data_cate_feature_with_scr_of_edu, data_cate_classes[<span class="string">'difficulties_cat'</span>])</div><div class="line">pd.DataFrame(dtree_cate_with_scr_of_edu.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_cate_feature_with_scr_of_edu.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line"><span class="comment"># dtree_cate_with_edu_ave_diff.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_cate_with_edu_ave_diff.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_cate_with_edu_ave, out_file=dot_file, feature_names=data_cate_feature_with_edu_ave.columns)</div><div class="line"><span class="comment"># dtree_cate_with_scr_of_edu_diff.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_cate_with_scr_of_edu_diff.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_cate_with_scr_of_edu, out_file=dot_file, feature_names=data_cate_feature_with_scr_of_edu.columns)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Imp</th></tr></thead><tbody><tr><th>scr_h_cat</th><td>0.528976</td></tr><tr><th>medu_newcat</th><td>0.221779</td></tr><tr><th>age_m</th><td>0.092168</td></tr><tr><th>income_newcat</th><td>0.057032</td></tr><tr><th>onlychild</th><td>0.034724</td></tr><tr><th>mediacontact</th><td>0.027193</td></tr><tr><th>female</th><td>0.021036</td></tr><tr><th>scr_ave</th><td>0.011653</td></tr><tr><th>mediacoview</th><td>0.005439</td></tr><tr><th>divorce</th><td>0.000000</td></tr><tr><th>edu_ave</th><td>0.000000</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Imp</th></tr></thead><tbody><tr><th>scr_h_cat</th><td>0.507678</td></tr><tr><th>medu_newcat</th><td>0.215210</td></tr><tr><th>age_m</th><td>0.089438</td></tr><tr><th>scr_of_edu</th><td>0.042832</td></tr><tr><th>mediacontact</th><td>0.041463</td></tr><tr><th>income_newcat</th><td>0.035742</td></tr><tr><th>onlychild</th><td>0.033695</td></tr><tr><th>female</th><td>0.020413</td></tr><tr><th>scr_ave</th><td>0.013527</td></tr><tr><th>divorce</th><td>0.000000</td></tr><tr><th>mediacoview</th><td>0.000000</td></tr></tbody></table></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_cate_with_scr_of_edu_diff.png" alt="cate_scr_of_edu_diff"></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#问题描述&quot; class=&quot;headerlink&quot; title=&quot;问题描述&quot;&gt;&lt;/a&gt;问题描述&lt;/h1&gt;&lt;p&gt;最近有一个关于关联分析的小作业，问题描述如下：&lt;/p&gt;&lt;p&gt;孩子的情感状况、品行症状、亲社会行为等等与很多因素相关，这个作业
    
    </summary>
    
    
      <category term="Python" scheme="http://yoursite.com/tags/Python/"/>
    
      <category term="Statistics" scheme="http://yoursite.com/tags/Statistics/"/>
    
  </entry>
  
  <entry>
    <title>Get Pois uses God-map apis</title>
    <link href="http://yoursite.com/2017/02/21/Get-Pois-uses-God-map-apis/"/>
    <id>http://yoursite.com/2017/02/21/Get-Pois-uses-God-map-apis/</id>
    <published>2017-02-21T04:13:20.000Z</published>
    <updated>2017-02-21T08:32:38.341Z</updated>
    
    <content type="html"><![CDATA[<p>伪代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">从Excel文件中读出数据</div><div class="line">对于每一个house:</div><div class="line">	提取出其location字段（经纬度）</div><div class="line">	将location字段作为输入参数传给map api</div><div class="line">	将返回值进行适当筛选最后存入原数据集中</div></pre></td></tr></table></figure><p>代码实现如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> xlrd</div><div class="line"><span class="keyword">import</span> pickle</div><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ReadHousesInfoFromExcel</span><span class="params">(</span></span></div><div class="line">        file_name=<span class="string">'houses_nadrop.xls'</span>, sheet_name=<span class="string">'小区信息'</span>):</div><div class="line">    <span class="string">""" Read the houses detail information from the excel-type file.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        file_name: the name of the excel-type file.</div><div class="line">        sheet_name: the name of the sheet of the excel file.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        houses: A dict that contains the detail information of each house.</div><div class="line">    """</div><div class="line"></div><div class="line">    HOUSES_FILE_NAME = <span class="string">'houses.pkl'</span></div><div class="line">    HOUSES_DETAIL_TAB = [<span class="string">'name'</span>, <span class="string">'address'</span>, <span class="string">'property_category'</span>, <span class="string">'area'</span>,</div><div class="line">                         <span class="string">'avg_price'</span>, <span class="string">'location'</span>, <span class="string">'property_costs'</span>,</div><div class="line">                         <span class="string">'volume_rate'</span>, <span class="string">'green_rate'</span>]</div><div class="line"></div><div class="line">    houses = []</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (os.path.isfile(HOUSES_FILE_NAME)):</div><div class="line">        <span class="keyword">with</span> open(HOUSES_FILE_NAME, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</div><div class="line">            houses = pickle.load(f)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        workBook = xlrd.open_workbook(file_name)</div><div class="line">        bookSheet = workBook.sheet_by_name(sheet_name)</div><div class="line">        <span class="comment"># read from second row because of the first row has tabs</span></div><div class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> range(<span class="number">1</span>, bookSheet.nrows):</div><div class="line">            house = &#123;&#125;</div><div class="line">            <span class="keyword">for</span> col <span class="keyword">in</span> range(bookSheet.ncols):</div><div class="line">                cel = bookSheet.cell(row, col)</div><div class="line">                <span class="keyword">try</span>:</div><div class="line">                    val = cel.value</div><div class="line">                <span class="keyword">except</span>:</div><div class="line">                    <span class="keyword">pass</span></div><div class="line">                val = str(val)</div><div class="line">                house[HOUSES_DETAIL_TAB[col]] = val</div><div class="line">            houses.append(house)</div><div class="line">        <span class="keyword">with</span> open(HOUSES_FILE_NAME, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</div><div class="line">            pickle.dump(houses, f)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> houses</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">Geocode</span><span class="params">(location, poi_type)</span>:</span></div><div class="line">    <span class="string">""" A tool that call the God-Map api.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        location: The location of house.</div><div class="line">        poi_type: The poi type.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        answer: The JSON-type data that contains pois infomation.</div><div class="line">    """</div><div class="line"></div><div class="line">    location = str(location).strip()</div><div class="line"></div><div class="line">    parameters = &#123;<span class="string">'location'</span>: location,</div><div class="line">                  <span class="string">'key'</span>: <span class="string">'e798a5bfb344a09977b79552ae415974'</span>,</div><div class="line">                  <span class="string">'types'</span>: poi_type,</div><div class="line">                  <span class="string">'offset'</span>: <span class="number">10</span>,</div><div class="line">                  <span class="string">'page'</span>: <span class="number">1</span>,</div><div class="line">                  <span class="string">'extensions'</span>: <span class="string">'base'</span>&#125;</div><div class="line">    base = <span class="string">'http://restapi.amap.com/v3/place/around'</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        response = requests.get(base, parameters)</div><div class="line">        answer = response.json()</div><div class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">        print(<span class="string">'error!'</span>, e)</div><div class="line">        answer = <span class="string">'null'</span></div><div class="line">    <span class="keyword">finally</span>:</div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> answer</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetPOI</span><span class="params">(houses)</span>:</span></div><div class="line">    <span class="string">""" Get the pois information of the houses according to the location.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        houses: The house detail information.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        houses_with_pois: The house detail information</div><div class="line">                          that contains the pois information.</div><div class="line">    """</div><div class="line"></div><div class="line">    POI_TYPE_LAB = [<span class="string">'subway_station'</span>, <span class="string">'bus_station'</span>, <span class="string">'parking_lot'</span>,</div><div class="line">                    <span class="string">'primary_school'</span>, <span class="string">'secondary_school'</span>, <span class="string">'university'</span>,</div><div class="line">                    <span class="string">'mall'</span>, <span class="string">'park'</span>]</div><div class="line">    POI_TYPE_CODE = [<span class="string">'150500'</span>, <span class="string">'150700'</span>, <span class="string">'150904'</span>, <span class="string">'141203'</span>, <span class="string">'141202'</span>,</div><div class="line">                     <span class="string">'141201'</span>, <span class="string">'060100'</span>, <span class="string">'110101'</span>]</div><div class="line">    KEEP_INFO_LAB = [<span class="string">'name'</span>, <span class="string">'location'</span>, <span class="string">'distance'</span>]</div><div class="line">    NO_INFO_NOW = <span class="string">'-'</span></div><div class="line">    SIZE = len(houses)</div><div class="line"></div><div class="line">    houses_with_pois = houses.copy()</div><div class="line">    count = <span class="number">0</span></div><div class="line"></div><div class="line">    <span class="keyword">for</span> house <span class="keyword">in</span> houses_with_pois:</div><div class="line">        count = count + <span class="number">1</span></div><div class="line">        <span class="keyword">if</span> count % <span class="number">100</span> == <span class="number">0</span>:</div><div class="line">            print(count, <span class="string">''</span>, SIZE)</div><div class="line"></div><div class="line">        house[<span class="string">'pois'</span>] = &#123;&#125;</div><div class="line">        <span class="keyword">for</span> poi_type_index <span class="keyword">in</span> range(len(POI_TYPE_LAB)):</div><div class="line">            poi_info_json = Geocode(house[<span class="string">'location'</span>],</div><div class="line">                                    POI_TYPE_CODE[poi_type_index])</div><div class="line">            <span class="keyword">if</span> poi_info_json == <span class="string">'null'</span> <span class="keyword">or</span> poi_info_json[<span class="string">'pois'</span>] <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">                house[<span class="string">'pois'</span>][POI_TYPE_LAB[poi_type_index]] = NO_INFO_NOW</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                house[<span class="string">'pois'</span>][POI_TYPE_LAB[poi_type_index]] = []</div><div class="line">                <span class="keyword">for</span> poi <span class="keyword">in</span> poi_info_json[<span class="string">'pois'</span>]:</div><div class="line">                    pois_without_useless = &#123;&#125;</div><div class="line">                    <span class="keyword">for</span> key <span class="keyword">in</span> poi.keys():</div><div class="line">                        <span class="keyword">if</span> key <span class="keyword">in</span> KEEP_INFO_LAB:</div><div class="line">                            pois_without_useless[key] = poi[key]</div><div class="line">                    house[<span class="string">'pois'</span>][POI_TYPE_LAB[poi_type_index]].append(</div><div class="line">                        pois_without_useless)</div><div class="line">        <span class="comment"># return houses_with_pois</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> houses_with_pois</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    houses = ReadHousesInfoFromExcel()</div><div class="line">    <span class="comment"># answer = Geocode(houses[0]['location'], '150905')</span></div><div class="line">    houses_with_pois = GetPOI(houses)</div></pre></td></tr></table></figure><p>总结一下有几个注意点：</p><ol><li>传给parameters的location参数的格式一定要规范，前后都不能有空格</li><li>for循环中不能改变字典的大小，这里的大小不仅指其元素的数目，也包括其总占用空间的大小</li><li>注意pickle的用法</li><li>从Excel中读出的内容要转成str格式</li></ol><p><strong>整个过程十分清晰明了，值得注意的是细节问题</strong></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;伪代码如下：&lt;/p&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class
    
    </summary>
    
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Python data analysis-Learning note-Ch02</title>
    <link href="http://yoursite.com/2017/02/19/Python%20data%20analysis-Learning%20notes-ch02/"/>
    <id>http://yoursite.com/2017/02/19/Python data analysis-Learning notes-ch02/</id>
    <published>2017-02-19T13:09:19.000Z</published>
    <updated>2017-02-20T08:54:05.495Z</updated>
    
    <content type="html"><![CDATA[<h2 id="利用Python内置的JSON模块对数据进行解析并转化为字典"><a href="#利用Python内置的JSON模块对数据进行解析并转化为字典" class="headerlink" title="利用Python内置的JSON模块对数据进行解析并转化为字典"></a>利用Python内置的JSON模块对数据进行解析并转化为字典</h2><p>数据如下：</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">'&#123; "a": "Mozilla\\/5.0 (Windows NT 6.1; WOW64) AppleWebKit\\/535.11 (KHTML, like Gecko)</div><div class="line">Chrome\\/17.0.963.78 Safari\\/535.11", "c": "US", "nk": 1, "tz": "America\\/New_York", "gr":</div><div class="line">"MA", "g": "A6qOVH", "h": "wfLQtf", "l": "orofrog", "al": "en-US,en;q=0.8", "hh": "1.usa.gov",</div><div class="line">"r": "http:\\/\\/www.facebook.com\\/l\\/7AQEFzjSi\\/1.usa.gov\\/wfLQtf", "u":</div><div class="line">"http:\\/\\/www.ncbi.nlm.nih.gov\\/pubmed\\/22415991", "t": 1331923247, "hc": 1331822918,</div><div class="line">"cy": "Danvers", "ll": [ 42.576698, -70.954903 ] &#125;\n'</div></pre></td></tr></table></figure><p>核心代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> json</div><div class="line">path = <span class="string">'ch02/usagov_bitly_data2012-03-16-1331923249.txt'</span></div><div class="line">records = [json.loads(line) <span class="keyword">for</span> line <span class="keyword">in</span> open(path)]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">records[<span class="number">0</span>]</div><div class="line">-----------------------------------</div><div class="line">&#123;<span class="string">'a'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.78 Safari/535.11'</span>,</div><div class="line"> <span class="string">'al'</span>: <span class="string">'en-US,en;q=0.8'</span>,</div><div class="line"> <span class="string">'c'</span>: <span class="string">'US'</span>,</div><div class="line"> <span class="string">'cy'</span>: <span class="string">'Danvers'</span>,</div><div class="line"> <span class="string">'g'</span>: <span class="string">'A6qOVH'</span>,</div><div class="line"> <span class="string">'gr'</span>: <span class="string">'MA'</span>,</div><div class="line"> <span class="string">'h'</span>: <span class="string">'wfLQtf'</span>,</div><div class="line"> <span class="string">'hc'</span>: <span class="number">1331822918</span>,</div><div class="line"> <span class="string">'hh'</span>: <span class="string">'1.usa.gov'</span>,</div><div class="line"> <span class="string">'l'</span>: <span class="string">'orofrog'</span>,</div><div class="line"> <span class="string">'ll'</span>: [<span class="number">42.576698</span>, <span class="number">-70.954903</span>],</div><div class="line"> <span class="string">'nk'</span>: <span class="number">1</span>,</div><div class="line"> <span class="string">'r'</span>: <span class="string">'http://www.facebook.com/l/7AQEFzjSi/1.usa.gov/wfLQtf'</span>,</div><div class="line"> <span class="string">'t'</span>: <span class="number">1331923247</span>,</div><div class="line"> <span class="string">'tz'</span>: <span class="string">'America/New_York'</span>,</div><div class="line"> <span class="string">'u'</span>: <span class="string">'http://www.ncbi.nlm.nih.gov/pubmed/22415991'</span>&#125;</div></pre></td></tr></table></figure><h2 id="对时区字段进行计数（pure-python-vs-pandas）"><a href="#对时区字段进行计数（pure-python-vs-pandas）" class="headerlink" title="对时区字段进行计数（pure python vs. pandas）"></a>对时区字段进行计数（pure python vs. pandas）</h2><p>首先从记录中提取时区字段并且放入一个列表中</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">time_zones = [rec[<span class="string">'tz'</span>] <span class="keyword">for</span> rec <span class="keyword">in</span> records <span class="keyword">if</span> <span class="string">'tz'</span> <span class="keyword">in</span> rec]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">time_zones[:<span class="number">10</span>]</div><div class="line">-----------------------------------</div><div class="line">[<span class="string">'America/New_York'</span>,</div><div class="line"> <span class="string">'America/Denver'</span>,</div><div class="line"> <span class="string">'America/New_York'</span>,</div><div class="line"> <span class="string">'America/Sao_Paulo'</span>,</div><div class="line"> <span class="string">'America/New_York'</span>,</div><div class="line"> <span class="string">'America/New_York'</span>,</div><div class="line"> <span class="string">'Europe/Warsaw'</span>,</div><div class="line"> <span class="string">''</span>,</div><div class="line"> <span class="string">''</span>,</div><div class="line"> <span class="string">''</span>]</div></pre></td></tr></table></figure><p>使用纯粹的python进行计数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_counts</span><span class="params">(sequence)</span>:</span></div><div class="line">    counts = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> sequence:</div><div class="line">        <span class="keyword">if</span> x <span class="keyword">in</span> counts:</div><div class="line">            counts[x] += <span class="number">1</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            counts[x] = <span class="number">1</span></div><div class="line">    <span class="keyword">return</span> counts</div></pre></td></tr></table></figure><p><strong>使用下列方法更加简洁</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_counts2</span><span class="params">(sequence)</span>:</span></div><div class="line">    counts = defaultdict(int) <span class="comment"># values will initialize to 0</span></div><div class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> sequence:</div><div class="line">        counts[x] += <span class="number">1</span></div><div class="line">    <span class="keyword">return</span> counts</div></pre></td></tr></table></figure><p>如果需要返回前十位的时区及其计数值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">top_counts</span><span class="params">(count_dict, n=<span class="number">10</span>)</span>:</span></div><div class="line">    value_key_pairs = [(count, tz) <span class="keyword">for</span> tz, count <span class="keyword">in</span> count_dict.items()]</div><div class="line">    value_key_pairs.sort()</div><div class="line">    <span class="keyword">return</span> value_key_pairs[-n:]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">top_counts(counts)</div><div class="line">--------------------------------------</div><div class="line">[(<span class="number">33</span>, <span class="string">'America/Sao_Paulo'</span>),</div><div class="line"> (<span class="number">35</span>, <span class="string">'Europe/Madrid'</span>),</div><div class="line"> (<span class="number">36</span>, <span class="string">'Pacific/Honolulu'</span>),</div><div class="line"> (<span class="number">37</span>, <span class="string">'Asia/Tokyo'</span>),</div><div class="line"> (<span class="number">74</span>, <span class="string">'Europe/London'</span>),</div><div class="line"> (<span class="number">191</span>, <span class="string">'America/Denver'</span>),</div><div class="line"> (<span class="number">382</span>, <span class="string">'America/Los_Angeles'</span>),</div><div class="line"> (<span class="number">400</span>, <span class="string">'America/Chicago'</span>),</div><div class="line"> (<span class="number">521</span>, <span class="string">''</span>),</div><div class="line"> (<span class="number">1251</span>, <span class="string">'America/New_York'</span>)]</div></pre></td></tr></table></figure><p><strong>可以使用python自带的库</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">counts = Counter(time_zones)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">counts.most_common(<span class="number">10</span>)</div><div class="line">--------------------------------</div><div class="line">[(<span class="string">'America/New_York'</span>, <span class="number">1251</span>),</div><div class="line"> (<span class="string">''</span>, <span class="number">521</span>),</div><div class="line"> (<span class="string">'America/Chicago'</span>, <span class="number">400</span>),</div><div class="line"> (<span class="string">'America/Los_Angeles'</span>, <span class="number">382</span>),</div><div class="line"> (<span class="string">'America/Denver'</span>, <span class="number">191</span>),</div><div class="line"> (<span class="string">'Europe/London'</span>, <span class="number">74</span>),</div><div class="line"> (<span class="string">'Asia/Tokyo'</span>, <span class="number">37</span>),</div><div class="line"> (<span class="string">'Pacific/Honolulu'</span>, <span class="number">36</span>),</div><div class="line"> (<span class="string">'Europe/Madrid'</span>, <span class="number">35</span>),</div><div class="line"> (<span class="string">'America/Sao_Paulo'</span>, <span class="number">33</span>)]</div></pre></td></tr></table></figure><p><strong>使用pandas进行相同的任务</strong></p><p>pandas中主要的数据结构是DataFrame， 作用是将数据表示成表格</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> DataFrame, Series</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"></div><div class="line">frame = DataFrame(records)</div><div class="line">frame</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/dataframe_data_repr.png" alt="dataframe_data_repr"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">frame[<span class="string">'tz'</span>][:<span class="number">10</span>]</div><div class="line">-------------------------------</div><div class="line"><span class="number">0</span>     America/New_York</div><div class="line"><span class="number">1</span>       America/Denver</div><div class="line"><span class="number">2</span>     America/New_York</div><div class="line"><span class="number">3</span>    America/Sao_Paulo</div><div class="line"><span class="number">4</span>     America/New_York</div><div class="line"><span class="number">5</span>     America/New_York</div><div class="line"><span class="number">6</span>        Europe/Warsaw</div><div class="line"><span class="number">7</span>                     </div><div class="line"><span class="number">8</span>                     </div><div class="line"><span class="number">9</span>                     </div><div class="line">Name: tz, dtype: object</div></pre></td></tr></table></figure><p>计数·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">tz_counts = frame[<span class="string">'tz'</span>].value_counts()</div><div class="line">tz_counts[:<span class="number">10</span>]</div><div class="line">--------------------------------------------------</div><div class="line">America/New_York       <span class="number">1251</span></div><div class="line">                        <span class="number">521</span></div><div class="line">America/Chicago         <span class="number">400</span></div><div class="line">America/Los_Angeles     <span class="number">382</span></div><div class="line">America/Denver          <span class="number">191</span></div><div class="line">Europe/London            <span class="number">74</span></div><div class="line">Asia/Tokyo               <span class="number">37</span></div><div class="line">Pacific/Honolulu         <span class="number">36</span></div><div class="line">Europe/Madrid            <span class="number">35</span></div><div class="line">America/Sao_Paulo        <span class="number">33</span></div><div class="line">Name: tz, dtype: int64</div></pre></td></tr></table></figure><p>填补缺失值以及未知值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">clean_tz = frame[<span class="string">'tz'</span>].fillna(<span class="string">'Missing'</span>)</div><div class="line">clean_tz[clean_tz == <span class="string">''</span>] = <span class="string">'Unknown'</span></div><div class="line">tz_counts = clean_tz.value_counts()</div><div class="line">tz_counts[:<span class="number">10</span>]</div><div class="line">----------------------------------------------</div><div class="line">America/New_York       <span class="number">1251</span></div><div class="line">Unknown                 <span class="number">521</span></div><div class="line">America/Chicago         <span class="number">400</span></div><div class="line">America/Los_Angeles     <span class="number">382</span></div><div class="line">America/Denver          <span class="number">191</span></div><div class="line">Missing                 <span class="number">120</span></div><div class="line">Europe/London            <span class="number">74</span></div><div class="line">Asia/Tokyo               <span class="number">37</span></div><div class="line">Pacific/Honolulu         <span class="number">36</span></div><div class="line">Europe/Madrid            <span class="number">35</span></div><div class="line">Name: tz, dtype: int64</div></pre></td></tr></table></figure><p>画个图展示一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">4</span>))</div><div class="line">tz_counts[:<span class="number">10</span>].plot(kind=<span class="string">'barh'</span>, rot=<span class="number">0</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/majority_tz.png" alt="majority_tz"></p><p>下面我们对用户使用的浏览器的信息做一些操作</p><p><strong>Series应该代表的是DataFrame中的一列</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">results = Series([x.split()[<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> frame.a.dropna()])</div><div class="line">results[:<span class="number">5</span>]</div><div class="line">---------------------------------------------------</div><div class="line"><span class="number">0</span>               Mozilla/<span class="number">5.0</span></div><div class="line"><span class="number">1</span>    GoogleMaps/RochesterNY</div><div class="line"><span class="number">2</span>               Mozilla/<span class="number">4.0</span></div><div class="line"><span class="number">3</span>               Mozilla/<span class="number">5.0</span></div><div class="line"><span class="number">4</span>               Mozilla/<span class="number">5.0</span></div><div class="line">dtype: object</div></pre></td></tr></table></figure><p><strong>同样可以进行计数</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">results.value_counts()[:<span class="number">8</span>]</div><div class="line">-----------------------------------------</div><div class="line">Mozilla/<span class="number">5.0</span>                 <span class="number">2594</span></div><div class="line">Mozilla/<span class="number">4.0</span>                  <span class="number">601</span></div><div class="line">GoogleMaps/RochesterNY       <span class="number">121</span></div><div class="line">Opera/<span class="number">9.80</span>                    <span class="number">34</span></div><div class="line">TEST_INTERNET_AGENT           <span class="number">24</span></div><div class="line">GoogleProducer                <span class="number">21</span></div><div class="line">Mozilla/<span class="number">6.0</span>                    <span class="number">5</span></div><div class="line">BlackBerry8520/<span class="number">5.0</span><span class="number">.0</span><span class="number">.681</span>       <span class="number">4</span></div><div class="line">dtype: int64</div></pre></td></tr></table></figure><h2 id="根据Windows和Non-Windows用户进行时区的分组操作"><a href="#根据Windows和Non-Windows用户进行时区的分组操作" class="headerlink" title="根据Windows和Non-Windows用户进行时区的分组操作"></a><strong>根据Windows和Non-Windows用户进行时区的分组操作</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cframe = frame[frame.a.notnull()]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">operating_system = np.where(cframe[<span class="string">'a'</span>].str.contains(<span class="string">'Windows'</span>),</div><div class="line">                            <span class="string">'Windows'</span>, <span class="string">'Not Windows'</span>)</div><div class="line">operating_system[:<span class="number">5</span>]</div><div class="line">-----------------------------------------------------------------</div><div class="line">array([<span class="string">'Windows'</span>, <span class="string">'Not Windows'</span>, <span class="string">'Windows'</span>, <span class="string">'Not Windows'</span>, <span class="string">'Windows'</span>], </div><div class="line">      dtype=<span class="string">'&lt;U11'</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">by_tz_os = cframe.groupby([<span class="string">'tz'</span>, operating_system])</div></pre></td></tr></table></figure><p>来看看这个by_tz_os长什么样</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">by_tz_os.size()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_group_by_data_pic.png" alt="pandas_group_by_data_pic"></p><p>再来看看<strong>unstack()</strong>的炫酷效果</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_group_by_data_unstack.png" alt="pandas_group_by_data_unstack"></p><p><strong>排下序</strong>， 看看排名多少</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Use to sort in ascending order</span></div><div class="line">indexer = agg_counts.sum(<span class="number">1</span>).argsort()</div><div class="line">indexer[:<span class="number">10</span>]</div><div class="line">------------------------------------------------</div><div class="line">tz</div><div class="line">                                  <span class="number">24</span></div><div class="line">Africa/Cairo                      <span class="number">20</span></div><div class="line">Africa/Casablanca                 <span class="number">21</span></div><div class="line">Africa/Ceuta                      <span class="number">92</span></div><div class="line">Africa/Johannesburg               <span class="number">87</span></div><div class="line">Africa/Lusaka                     <span class="number">53</span></div><div class="line">America/Anchorage                 <span class="number">54</span></div><div class="line">America/Argentina/Buenos_Aires    <span class="number">57</span></div><div class="line">America/Argentina/Cordoba         <span class="number">26</span></div><div class="line">America/Argentina/Mendoza         <span class="number">55</span></div><div class="line">dtype: int64</div></pre></td></tr></table></figure><p>取出<strong>前十</strong>的来看看</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">count_subset = agg_counts.take(indexer)[<span class="number">-10</span>:]</div><div class="line">count_subset</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_group_by_data_sort_top10.png" alt="pandas_group_by_data_sort_top10"></p><p>同样画个图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">count_subset.plot(kind=<span class="string">'barh'</span>, stacked=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_group_by_data_sort_top10_pic.png" alt="pandas_group_by_data_sort_top10_pic"></p><p>看看<strong>两个类别所占的比例</strong>是多少</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">normed_subset = count_subset.div(count_subset.sum(<span class="number">1</span>), axis=<span class="number">0</span>)</div><div class="line">normed_subset.plot(kind=<span class="string">'barh'</span>, stacked=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_group_by_data_sort_top10_percent.png" alt="pandas_group_by_data_sort_top10_percent"></p><h2 id="电影评分数据表连接操作"><a href="#电影评分数据表连接操作" class="headerlink" title="电影评分数据表连接操作"></a>电影评分数据表连接操作</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><span class="keyword">import</span> os</div><div class="line">encoding = <span class="string">'latin1'</span></div><div class="line"></div><div class="line">upath = os.path.expanduser(<span class="string">'ch02/movielens/users.dat'</span>)</div><div class="line">rpath = os.path.expanduser(<span class="string">'ch02/movielens/ratings.dat'</span>)</div><div class="line">mpath = os.path.expanduser(<span class="string">'ch02/movielens/movies.dat'</span>)</div><div class="line"></div><div class="line">unames = [<span class="string">'user_id'</span>, <span class="string">'gender'</span>, <span class="string">'age'</span>, <span class="string">'occupation'</span>, <span class="string">'zip'</span>]</div><div class="line">rnames = [<span class="string">'user_id'</span>, <span class="string">'movie_id'</span>, <span class="string">'rating'</span>, <span class="string">'timestamp'</span>]</div><div class="line">mnames = [<span class="string">'movie_id'</span>, <span class="string">'title'</span>, <span class="string">'genres'</span>]</div><div class="line"></div><div class="line">users = pd.read_csv(upath, sep=<span class="string">'::'</span>, header=<span class="keyword">None</span>, names=unames, encoding=encoding)</div><div class="line">ratings = pd.read_csv(rpath, sep=<span class="string">'::'</span>, header=<span class="keyword">None</span>, names=rnames, encoding=encoding)</div><div class="line">movies = pd.read_csv(mpath, sep=<span class="string">'::'</span>, header=<span class="keyword">None</span>, names=mnames, encoding=encoding)</div></pre></td></tr></table></figure><p>看看数据长什么样</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">users[:<span class="number">5</span>]</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_users.png" alt="pandas_ch02_users"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ratings[:<span class="number">5</span>]</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_ratings.png" alt="pandas_ch02_ratings"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">movies[:<span class="number">5</span>]</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_movies.png" alt="pandas_ch02_movies"></p><p><strong>多表连接</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data = pd.merge(pd.merge(ratings, users), movies)</div><div class="line">data</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_multi_table_joint.png" alt="pandas_ch02_multi_table_joint"></p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">data.ix[0]</div><div class="line">--------------------------------------------</div><div class="line">user_id                                            1</div><div class="line">movie_id                                        1193</div><div class="line">rating                                             5</div><div class="line">timestamp                                  978300760</div><div class="line">gender                                             F</div><div class="line">age                                                1</div><div class="line">occupation                                        10</div><div class="line">zip                                            48067</div><div class="line">title         One Flew Over the Cuckoo's Nest (1975)</div><div class="line">genres                                         Drama</div><div class="line">Name: 0, dtype: object</div></pre></td></tr></table></figure><h2 id="根据性别计算每部电影的平均评分"><a href="#根据性别计算每部电影的平均评分" class="headerlink" title="根据性别计算每部电影的平均评分"></a>根据性别计算每部电影的平均评分</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mean_ratings = data.pivot_table(<span class="string">'rating'</span>, index=<span class="string">'title'</span>,</div><div class="line">                                columns=<span class="string">'gender'</span>, aggfunc=<span class="string">'mean'</span>)</div><div class="line">mean_ratings[:<span class="number">5</span>]</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_movie_avg_score_by_gender.png" alt="pandas_ch02_movie_avg_score_by_gender"></p><p>过滤掉评分数小于250的电影</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ratings_by_title = data.groupby(<span class="string">'title'</span>).size()</div></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ratings_by_title[:5]</div><div class="line">-----------------------------------------</div><div class="line">title</div><div class="line">$1,000,000 Duck (1971)            37</div><div class="line">'Night Mother (1986)              70</div><div class="line">'Til There Was You (1997)         52</div><div class="line">'burbs, The (1989)               303</div><div class="line">...And Justice for All (1979)    199</div><div class="line">dtype: int64</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">active_titles = ratings_by_title.index[ratings_by_title &gt;= <span class="number">250</span>]</div></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">active_titles[:10]</div><div class="line">-----------------------------------------</div><div class="line">Index([''burbs, The (1989)', '10 Things I Hate About You (1999)',</div><div class="line">       '101 Dalmatians (1961)', '101 Dalmatians (1996)', '12 Angry Men (1957)',</div><div class="line">       '13th Warrior, The (1999)', '2 Days in the Valley (1996)',</div><div class="line">       '20,000 Leagues Under the Sea (1954)', '2001: A Space Odyssey (1968)',</div><div class="line">       '2010 (1984)'],</div><div class="line">      dtype='object', name='title')</div></pre></td></tr></table></figure><p>ix应该是一个交集操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mean_ratings = mean_ratings.ix[active_titles]</div><div class="line">mean_ratings</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_movie_avg_score_by_gender_ratings_more_than_250.png" alt="pandas_ch02_movie_avg_score_by_gender_ratings_more_than_250"></p><p>按照女性最喜欢的电影进行降序排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">top_female_ratings = mean_ratings.sort_values(by=<span class="string">'F'</span>, ascending=<span class="keyword">False</span>)</div><div class="line">top_female_ratings[:<span class="number">10</span>]</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_movie_female_favor_top_10.png" alt="pandas_ch02_movie_female_favor_top_10"></p><p>​</p><h2 id="US-Baby-Names-1880-2010"><a href="#US-Baby-Names-1880-2010" class="headerlink" title="US Baby Names 1880-2010"></a>US Baby Names 1880-2010</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">names1880 = pd.read_csv(<span class="string">'ch02/names/yob1880.txt'</span>, names=[<span class="string">'name'</span>, <span class="string">'sex'</span>, <span class="string">'births'</span>])</div><div class="line">names1880</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_us_baby_name.png" alt="pandas_ch02_us_baby_name"></p><p>把所有年份的数据<strong>合并</strong>一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 2010 is the last available year right now</span></div><div class="line">years = range(<span class="number">1880</span>, <span class="number">2011</span>)</div><div class="line"></div><div class="line">pieces = []</div><div class="line">columns = [<span class="string">'name'</span>, <span class="string">'sex'</span>, <span class="string">'births'</span>]</div><div class="line"></div><div class="line"><span class="keyword">for</span> year <span class="keyword">in</span> years:</div><div class="line">    path = <span class="string">'ch02/names/yob%d.txt'</span> % year</div><div class="line">    frame = pd.read_csv(path, names=columns)</div><div class="line"></div><div class="line">    frame[<span class="string">'year'</span>] = year</div><div class="line">    pieces.append(frame)</div><div class="line"></div><div class="line"><span class="comment"># Concatenate everything into a single DataFrame</span></div><div class="line">names = pd.concat(pieces, ignore_index=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><p>进行<strong>聚合</strong>操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">total_births = names.pivot_table(<span class="string">'births'</span>, index=<span class="string">'year'</span>,</div><div class="line">                                 columns=<span class="string">'sex'</span>, aggfunc=sum)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">total_births.tail()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_us_baby_name_addition.png" alt="pandas_ch02_us_baby_name_addition"></p><p>计算一下<strong>每个名字的出生比例</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_prop</span><span class="params">(group)</span>:</span></div><div class="line">    <span class="comment"># Integer division floors</span></div><div class="line">    births = group.births.astype(float)</div><div class="line"></div><div class="line">    group[<span class="string">'prop'</span>] = births / births.sum()</div><div class="line">    <span class="keyword">return</span> group</div><div class="line">names = names.groupby([<span class="string">'year'</span>, <span class="string">'sex'</span>]).apply(add_prop)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">names</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_us_baby_name_prop.png" alt="pandas_ch02_us_baby_name_prop"></p><p>进行一下<strong>有效性检查</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">np.allclose(names.groupby([<span class="string">'year'</span>, <span class="string">'sex'</span>]).prop.sum(), <span class="number">1</span>)</div><div class="line">--------------------------------------------</div><div class="line"><span class="keyword">True</span></div></pre></td></tr></table></figure><p>筛选出每一对year/sex下总数前1000的名字</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_top1000</span><span class="params">(group)</span>:</span></div><div class="line">    <span class="keyword">return</span> group.sort_values(by=<span class="string">'births'</span>, ascending=<span class="keyword">False</span>)[:<span class="number">1000</span>]</div><div class="line">grouped = names.groupby([<span class="string">'year'</span>, <span class="string">'sex'</span>])</div><div class="line">top1000 = grouped.apply(get_top1000)</div></pre></td></tr></table></figure><p>加个索引，结合了numpy</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">top1000.index = np.arange(len(top1000))</div></pre></td></tr></table></figure><h2 id="Analyzing-naming-trends"><a href="#Analyzing-naming-trends" class="headerlink" title="Analyzing naming trends"></a>Analyzing naming trends</h2><p>将数据分为男女</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">boys = top1000[top1000.sex == <span class="string">'M'</span>]</div><div class="line">girls = top1000[top1000.sex == <span class="string">'F'</span>]</div></pre></td></tr></table></figure><p>计算<strong>每一年每个名字的出生总数</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">total_births = top1000.pivot_table(<span class="string">'births'</span>, index=<span class="string">'year'</span>, columns=<span class="string">'name'</span>,</div><div class="line">                                   aggfunc=sum)</div><div class="line">total_births</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_us_baby_name_counts_per_year.png" alt="pandas_ch02_us_baby_name_counts_per_year"></p><p>选出几个名字看看<strong>总数随年份的变化情况</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">subset = total_births[[<span class="string">'John'</span>, <span class="string">'Harry'</span>, <span class="string">'Mary'</span>, <span class="string">'Marilyn'</span>]]</div><div class="line">subset.plot(subplots=<span class="keyword">True</span>, figsize=(<span class="number">12</span>, <span class="number">10</span>), grid=<span class="keyword">False</span>,</div><div class="line">            title=<span class="string">"Number of births per year"</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_us_baby_name_trend.png" alt="pandas_ch02_us_baby_name_trend"></p><h2 id="Measuring-the-increase-in-naming-diversity"><a href="#Measuring-the-increase-in-naming-diversity" class="headerlink" title="Measuring the increase in naming diversity"></a>Measuring the increase in naming diversity</h2><p>通过统计<strong>前1000项名字所占的比例</strong>来判断多样性的变化</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">table = top1000.pivot_table(<span class="string">'prop'</span>, index=<span class="string">'year'</span>,</div><div class="line">                            columns=<span class="string">'sex'</span>, aggfunc=sum)</div><div class="line">table.plot(title=<span class="string">'Sum of table1000.prop by year and sex'</span>,</div><div class="line">           yticks=np.linspace(<span class="number">0</span>, <span class="number">1.2</span>, <span class="number">13</span>), xticks=range(<span class="number">1880</span>, <span class="number">2020</span>, <span class="number">10</span>))</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_us_baby_name_diversity.png" alt="pandas_ch02_us_baby_name_diversity"></p><p>另一种方法，计算占出生人数50%的名字的数量</p><p>也即从开始累加，看加到第几个名字时所占比例为50%</p><p>先来看看2010年的男孩</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df = boys[boys.year == <span class="number">2010</span>]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">prop_cumsum = df.sort_index(by=<span class="string">'prop'</span>, ascending=<span class="keyword">False</span>).prop.cumsum()</div><div class="line">prop_cumsum[:<span class="number">10</span>]</div><div class="line">--------------------------------------------------</div><div class="line"><span class="number">260877</span>    <span class="number">0.011523</span></div><div class="line"><span class="number">260878</span>    <span class="number">0.020934</span></div><div class="line"><span class="number">260879</span>    <span class="number">0.029959</span></div><div class="line"><span class="number">260880</span>    <span class="number">0.038930</span></div><div class="line"><span class="number">260881</span>    <span class="number">0.047817</span></div><div class="line"><span class="number">260882</span>    <span class="number">0.056579</span></div><div class="line"><span class="number">260883</span>    <span class="number">0.065155</span></div><div class="line"><span class="number">260884</span>    <span class="number">0.073414</span></div><div class="line"><span class="number">260885</span>    <span class="number">0.081528</span></div><div class="line"><span class="number">260886</span>    <span class="number">0.089621</span></div><div class="line">Name: prop, dtype: float64</div></pre></td></tr></table></figure><p>看来是第116个，不过序号从0开始，应该是117</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">prop_cumsum.values.searchsorted(<span class="number">0.5</span>)</div><div class="line">---------------------------------------------------</div><div class="line"><span class="number">116</span></div></pre></td></tr></table></figure><p>再来看看1900年的男孩儿</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">df = boys[boys.year == <span class="number">1900</span>]</div><div class="line">in1900 = df.sort_index(by=<span class="string">'prop'</span>, ascending=<span class="keyword">False</span>).prop.cumsum()</div><div class="line">in1900.values.searchsorted(<span class="number">0.5</span>) + <span class="number">1</span></div><div class="line">---------------------------------------------------</div><div class="line"><span class="number">25</span></div></pre></td></tr></table></figure><p>所以这样做是可行的</p><p>把相同的操作赋予整个数据集</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_quantile_count</span><span class="params">(group, q=<span class="number">0.5</span>)</span>:</span></div><div class="line">    group = group.sort_values(by=<span class="string">'prop'</span>, ascending=<span class="keyword">False</span>)</div><div class="line">    <span class="keyword">return</span> group.prop.cumsum().values.searchsorted(q) + <span class="number">1</span></div><div class="line">diversity = top1000.groupby([<span class="string">'year'</span>, <span class="string">'sex'</span>]).apply(get_quantile_count)</div><div class="line">diversity = diversity.unstack(<span class="string">'sex'</span>)</div><div class="line">diversity.head()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_us_baby_name_number_in_half_percent.png" alt="pandas_ch02_us_baby_name_number_in_half_percent"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">diversity.plot(title=<span class="string">"Number of popular names in top 50%"</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_us_baby_name_diversity_2.png" alt="pandas_ch02_us_baby_name_diversity_2"></p><h2 id="The-“Last-letter”-Revolution"><a href="#The-“Last-letter”-Revolution" class="headerlink" title="The “Last letter” Revolution"></a>The “Last letter” Revolution</h2><p>取出每个名字对应的最后一个字母，同时<strong>序号对应</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># extract last letter from name column</span></div><div class="line">get_last_letter = <span class="keyword">lambda</span> x: x[<span class="number">-1</span>]</div><div class="line">last_letters = names.name.map(get_last_letter)</div><div class="line">last_letters.name = <span class="string">'last_letter'</span></div><div class="line"></div><div class="line">table = names.pivot_table(<span class="string">'births'</span>, index=last_letters,</div><div class="line">                          columns=[<span class="string">'sex'</span>, <span class="string">'year'</span>], aggfunc=sum)</div></pre></td></tr></table></figure><p>单独取出三年的来看看</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">subtable = table.reindex(columns=[<span class="number">1910</span>, <span class="number">1960</span>, <span class="number">2010</span>], level=<span class="string">'year'</span>)</div><div class="line">subtable.head()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_us_baby_name_last_letter.png" alt="pandas_ch02_us_baby_name_last_letter"></p><p><strong>计算一下字母比例</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">subtable.sum()</div><div class="line">-------------------------------------</div><div class="line">sex  year</div><div class="line">F    <span class="number">1910</span>     <span class="number">396416.0</span></div><div class="line">     <span class="number">1960</span>    <span class="number">2022062.0</span></div><div class="line">     <span class="number">2010</span>    <span class="number">1759010.0</span></div><div class="line">M    <span class="number">1910</span>     <span class="number">194198.0</span></div><div class="line">     <span class="number">1960</span>    <span class="number">2132588.0</span></div><div class="line">     <span class="number">2010</span>    <span class="number">1898382.0</span></div><div class="line">dtype: float64</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">letter_prop = subtable / subtable.sum().astype(float)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"></div><div class="line">fig, axes = plt.subplots(<span class="number">2</span>, <span class="number">1</span>, figsize=(<span class="number">10</span>, <span class="number">8</span>))</div><div class="line">letter_prop[<span class="string">'M'</span>].plot(kind=<span class="string">'bar'</span>, rot=<span class="number">0</span>, ax=axes[<span class="number">0</span>], title=<span class="string">'Male'</span>)</div><div class="line">letter_prop[<span class="string">'F'</span>].plot(kind=<span class="string">'bar'</span>, rot=<span class="number">0</span>, ax=axes[<span class="number">1</span>], title=<span class="string">'Female'</span>,</div><div class="line">                      legend=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_us_baby_name_last_letter_prop.png" alt="pandas_ch02_us_baby_name_last_letter_prop"></p><p>最后看一下所有的年份并生成一个趋势图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">letter_prop = table / table.sum().astype(float)</div><div class="line">dny_ts = letter_prop.ix[[<span class="string">'d'</span>, <span class="string">'n'</span>, <span class="string">'y'</span>], <span class="string">'M'</span>].T</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dny_ts.plot()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_us_baby_name_last_letter_prop_trend.png" alt="pandas_ch02_us_baby_name_last_letter_prop_trend"></p><h2 id="Boy-names-that-became-girl-names-and-vice-versa"><a href="#Boy-names-that-became-girl-names-and-vice-versa" class="headerlink" title="Boy names that became girl names (and vice versa)"></a>Boy names that became girl names (and vice versa)</h2><p>以lesl开头的名字为例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">all_names = top1000.name.unique()</div><div class="line">mask = np.array([<span class="string">'lesl'</span> <span class="keyword">in</span> x.lower() <span class="keyword">for</span> x <span class="keyword">in</span> all_names])</div><div class="line">lesley_like = all_names[mask]</div><div class="line">lesley_like</div><div class="line">----------------------------------------------</div><div class="line">array([<span class="string">'Leslie'</span>, <span class="string">'Lesley'</span>, <span class="string">'Leslee'</span>, <span class="string">'Lesli'</span>, <span class="string">'Lesly'</span>], dtype=object)</div></pre></td></tr></table></figure><p>从原数据集中筛选出来</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">filtered = top1000[top1000.name.isin(lesley_like)]</div><div class="line">filtered.groupby(<span class="string">'name'</span>).births.sum()</div><div class="line">----------------------------------------------</div><div class="line">name</div><div class="line">Leslee      <span class="number">1082</span></div><div class="line">Lesley     <span class="number">35022</span></div><div class="line">Lesli        <span class="number">929</span></div><div class="line">Leslie    <span class="number">370429</span></div><div class="line">Lesly      <span class="number">10067</span></div><div class="line">Name: births, dtype: int64</div></pre></td></tr></table></figure><p>做一下聚合操作并计算比例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">table = filtered.pivot_table(<span class="string">'births'</span>, index=<span class="string">'year'</span>,</div><div class="line">                             columns=<span class="string">'sex'</span>, aggfunc=<span class="string">'sum'</span>)</div><div class="line">table = table.div(table.sum(<span class="number">1</span>), axis=<span class="number">0</span>)</div><div class="line">table.tail()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_us_baby_name_b2g_prop.png" alt="pandas_ch02_us_baby_name_b2g_prop"></p><p>看一下趋势</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">table.plot(style=&#123;<span class="string">'M'</span>: <span class="string">'k-'</span>, <span class="string">'F'</span>: <span class="string">'k--'</span>&#125;)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pandas_ch02_us_baby_name_b2g_prop_trend.png" alt="pandas_ch02_us_baby_name_b2g_prop_trend"></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;利用Python内置的JSON模块对数据进行解析并转化为字典&quot;&gt;&lt;a href=&quot;#利用Python内置的JSON模块对数据进行解析并转化为字典&quot; class=&quot;headerlink&quot; title=&quot;利用Python内置的JSON模块对数据进行解析并转化为字典&quot;&gt;
    
    </summary>
    
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Spider the house infomation and save to excel file</title>
    <link href="http://yoursite.com/2017/02/18/Spider-the-house-infomation-and-save-to-excel-file/"/>
    <id>http://yoursite.com/2017/02/18/Spider-the-house-infomation-and-save-to-excel-file/</id>
    <published>2017-02-18T14:11:28.000Z</published>
    <updated>2017-02-19T13:12:35.033Z</updated>
    
    <content type="html"><![CDATA[<h2 id="数据来源"><a href="#数据来源" class="headerlink" title="数据来源"></a>数据来源</h2><p><a href="http://sh.fang.com/" target="_blank" rel="external">http://sh.fang.com/</a></p><h2 id="项目目标"><a href="#项目目标" class="headerlink" title="项目目标"></a>项目目标</h2><p>爬取二手房信息中的小区信息</p><h2 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h2><p>【1】爬取小区信息（核心代码，下同）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div></pre></td><td class="code"><pre><div class="line"><span class="string">"""	&lt;A spider to crawl the house information.&gt;</span></div><div class="line">    Copyright (C) &lt;2017&gt;  Li W.H., Duan X</div><div class="line"></div><div class="line">    This program is free software: you can redistribute it and/or modify</div><div class="line">    it under the terms of the GNU General Public License as published by</div><div class="line">    the Free Software Foundation, either version 3 of the License, or</div><div class="line">    (at your option) any later version.</div><div class="line"></div><div class="line">    This program is distributed in the hope that it will be useful,</div><div class="line">    but WITHOUT ANY WARRANTY; without even the implied warranty of</div><div class="line">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</div><div class="line">    GNU General Public License for more details.</div><div class="line"></div><div class="line">    You should have received a copy of the GNU General Public License</div><div class="line">    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;. </div><div class="line">"""</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HouseSpider</span><span class="params">(scrapy.Spider)</span>:</span></div><div class="line">    name = <span class="string">"house"</span></div><div class="line">    head = <span class="string">"http://esf.sh.fang.com"</span></div><div class="line">    allowed_domains = [<span class="string">"sh.fang.com"</span>]</div><div class="line">    start_urls = [</div><div class="line">        <span class="string">"http://esf.sh.fang.com/housing/"</span></div><div class="line">    ]</div><div class="line">    <span class="comment"># 各区对应的编号（由于丧心病狂的url）</span></div><div class="line">    area_map = &#123;<span class="number">25</span>: <span class="string">'pudong'</span>, <span class="number">18</span>: <span class="string">'minhang'</span>, <span class="number">19</span>: <span class="string">'xuhui'</span>, <span class="number">30</span>: <span class="string">'baoshan'</span>,</div><div class="line">                <span class="number">28</span>: <span class="string">'putuo'</span>, <span class="number">20</span>: <span class="string">'changning'</span>, <span class="number">26</span>: <span class="string">'yangpu'</span>, <span class="number">586</span>: <span class="string">'songjiang'</span>,</div><div class="line">                <span class="number">29</span>: <span class="string">'jiading'</span>, <span class="number">23</span>: <span class="string">'hongkou'</span>, <span class="number">27</span>: <span class="string">'zhabei'</span>, <span class="number">21</span>: <span class="string">'jingan'</span>,</div><div class="line">                <span class="number">24</span>: <span class="string">'huangpu'</span>, <span class="number">22</span>: <span class="string">'luwan'</span>, <span class="number">31</span>: <span class="string">'qingpu'</span>, <span class="number">32</span>: <span class="string">'fengxian'</span>,</div><div class="line">                <span class="number">35</span>: <span class="string">'jinshan'</span>, <span class="number">996</span>: <span class="string">'chongming'</span>&#125;</div><div class="line">    estate_to_area_map = &#123;&#125;</div><div class="line">    seperator = <span class="string">'=\n'</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> self.area_map.items():</div><div class="line">            self.estate_to_area_map[key] = []</div><div class="line">        <span class="comment"># print(self.estate_to_area_map)</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, response)</span>:</span></div><div class="line">        <span class="comment"># 解析出上海市各区的地址</span></div><div class="line">        area_lis = response.xpath(<span class="string">'//*[@id="houselist_B03_02"]/div[1]'</span>)</div><div class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> area_lis.xpath(<span class="string">'./a'</span>):</div><div class="line">            <span class="comment"># areas = items.AreaItem()</span></div><div class="line">            <span class="comment"># areas['name'] = a.xpath('text()').extract()[0]</span></div><div class="line">            <span class="keyword">yield</span> Request(self.head + a.xpath(<span class="string">'@href'</span>).extract()[<span class="number">0</span>],</div><div class="line">                          callback=self.parse_area)</div><div class="line">            <span class="comment"># print(a.xpath('text()').extract()[0])</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_area</span><span class="params">(self, response)</span>:</span></div><div class="line">        <span class="comment"># 确定response来源于哪一个区</span></div><div class="line">        area_index = str(response).split(<span class="string">'/'</span>)[<span class="number">-2</span>].split(<span class="string">'_'</span>)[<span class="number">0</span>]</div><div class="line">        <span class="keyword">if</span> area_index == <span class="string">''</span>:</div><div class="line">            <span class="keyword">return</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="comment"># 解析出各区中小区的详情页面地址</span></div><div class="line">            detail_str = <span class="string">'xiangqing'</span></div><div class="line">            estate_list = response.xpath(<span class="string">'/html/body/div[4]/div[5]/div[4]'</span>)</div><div class="line">            <span class="keyword">for</span> a <span class="keyword">in</span> estate_list.xpath(<span class="string">'.//a[@class="plotTit"]'</span>):</div><div class="line">                estate_url = a.xpath(<span class="string">'@href'</span>).extract()[<span class="number">0</span>]</div><div class="line">                <span class="keyword">if</span> estate_url.find(<span class="string">'esf'</span>) != <span class="number">-1</span>:</div><div class="line">                    estate_url = estate_url.replace(<span class="string">'esf'</span>, detail_str)</div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    estate_url = estate_url + detail_str</div><div class="line">                <span class="keyword">if</span> estate_url.find(<span class="string">'http'</span>) != <span class="number">-1</span>:</div><div class="line">                    <span class="comment"># print(estate_url)</span></div><div class="line">                    self.estate_to_area_map[int(area_index)].append(estate_url)</div><div class="line">            <span class="comment"># print(len(self.estate_to_area_map[int(area_index)]))</span></div><div class="line">            next_page = response.xpath(<span class="string">'//*[@id="PageControl1_hlk_next"]'</span>)</div><div class="line">            <span class="keyword">if</span> len(next_page) != <span class="number">0</span>:</div><div class="line">                <span class="keyword">yield</span> Request(self.head +</div><div class="line">                              next_page.xpath(<span class="string">'@href'</span>).extract()[<span class="number">0</span>],</div><div class="line">                              callback=self.parse_area)</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="comment"># print(len(self.estate_to_area_map[int(area_index)]))</span></div><div class="line">                <span class="keyword">for</span> url <span class="keyword">in</span> self.estate_to_area_map[int(area_index)]:</div><div class="line">                    request = Request(url, callback=self.parse_house,</div><div class="line">                                      dont_filter=<span class="keyword">True</span>)</div><div class="line">                    request.meta[<span class="string">'index'</span>] = int(area_index)</div><div class="line">                    <span class="keyword">yield</span> request</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_house</span><span class="params">(self, response)</span>:</span></div><div class="line">        flag = <span class="number">0</span></div><div class="line">        area_index = response.meta[<span class="string">'index'</span>]</div><div class="line">        area_name = self.area_map[area_index]</div><div class="line">        filename = area_name + <span class="string">'.txt'</span></div><div class="line">        <span class="comment"># print(response.xpath('/html'))</span></div><div class="line">        <span class="comment"># 详情页面存在两种，因此分情况讨论</span></div><div class="line">        house_name = response.xpath(</div><div class="line">            <span class="string">'/html/body/div[4]/div[2]/div[2]/h1/a/text()'</span>)</div><div class="line">        <span class="keyword">if</span> len(house_name) == <span class="number">0</span>:</div><div class="line">            <span class="comment"># house_name = response.xpath(</span></div><div class="line">            <span class="comment">#     '/html/body/div[1]/div[3]/div[2]/h1/a/text()')</span></div><div class="line">            <span class="comment"># flag = 1</span></div><div class="line">            <span class="keyword">return</span></div><div class="line">        house_name = house_name.extract()[<span class="number">0</span>]</div><div class="line">        <span class="comment"># 清洁小区名</span></div><div class="line">        house_name = re.sub(<span class="string">r'小区网'</span>, <span class="string">''</span>, house_name)</div><div class="line">        result_str = <span class="string">'【小区名称】'</span> + house_name + <span class="string">'\n'</span></div><div class="line">        <span class="keyword">if</span> flag == <span class="number">0</span>:</div><div class="line">            avg_price_xpath = response.xpath(</div><div class="line">                <span class="string">'/html/body/div[4]/div[4]/div[1]/div[1]/dl[1]/dd/span/text()'</span>)</div><div class="line">            avg_price = avg_price_xpath.extract()[<span class="number">0</span>]</div><div class="line">            result_str = result_str + <span class="string">'【平均价格】'</span> + avg_price + <span class="string">'\n'</span></div><div class="line">            detail_block_list = response.xpath(</div><div class="line">                <span class="string">'/html/body/div[4]/div[4]/div[1]'</span>)</div><div class="line">            <span class="keyword">for</span> headline <span class="keyword">in</span> detail_block_list.xpath(<span class="string">'.//h3'</span>):</div><div class="line">                head_str = headline.xpath(<span class="string">'./text()'</span>).extract()[<span class="number">0</span>]</div><div class="line">                <span class="keyword">if</span> head_str == <span class="string">'基本信息'</span>:</div><div class="line">                    result_str = result_str + \</div><div class="line">                        <span class="string">'【'</span> + \</div><div class="line">                        head_str + <span class="string">'】\n'</span></div><div class="line">                    <span class="keyword">for</span> item <span class="keyword">in</span> headline.xpath(</div><div class="line">                            <span class="string">'../../div[@class="inforwrap clearfix"]/dl/dd'</span>):</div><div class="line">                        <span class="keyword">if</span> len(item.xpath(<span class="string">'./strong/text()'</span>)) != <span class="number">0</span>:</div><div class="line">                            <span class="keyword">if</span> len(item.xpath(<span class="string">'./text()'</span>)) != <span class="number">0</span>:</div><div class="line">                                result_str = result_str + \</div><div class="line">                                    item.xpath(</div><div class="line">                                        <span class="string">'./strong/text()'</span>).extract()[<span class="number">0</span>]</div><div class="line">                                result_str = result_str + \</div><div class="line">                                    item.xpath(<span class="string">'./text()'</span>).extract()[<span class="number">0</span>] + <span class="string">'\n'</span></div><div class="line">                    <span class="comment"># print(result_str)</span></div><div class="line">                <span class="comment"># elif head_str == '交通状况':</span></div><div class="line">                <span class="comment">#     result_str = result_str + \</span></div><div class="line">                <span class="comment">#         '【' + \</span></div><div class="line">                <span class="comment">#         head_str + '】\n'</span></div><div class="line">                <span class="comment">#     tempstr = headline.xpath(</span></div><div class="line">                <span class="comment">#         '../../div[@class="inforwrap clearfix"]/dl/dt/text()').extract()[0]</span></div><div class="line">                <span class="comment">#     result_str = result_str + tempstr + '\n'</span></div><div class="line">                <span class="comment">#     # print(result_str)</span></div><div class="line">                <span class="comment"># elif head_str == '周边信息':</span></div><div class="line">                <span class="comment">#     result_str = result_str + \</span></div><div class="line">                <span class="comment">#         '【' + \</span></div><div class="line">                <span class="comment">#         head_str + '】\n'</span></div><div class="line">                <span class="comment">#     for item in headline.xpath(</span></div><div class="line">                <span class="comment">#             '../../div[@class="inforwrap clearfix"]/dl/dt'):</span></div><div class="line">                <span class="comment">#         result_str = result_str + \</span></div><div class="line">                <span class="comment">#             item.xpath('./text()').extract()[0] + '\n'</span></div><div class="line">                <span class="comment">#     # print(result_str)</span></div><div class="line">                <span class="keyword">elif</span> head_str == <span class="string">'就近楼群'</span>:</div><div class="line">                    result_str = result_str + \</div><div class="line">                        <span class="string">'【'</span> + \</div><div class="line">                        head_str + <span class="string">'】\n'</span></div><div class="line">                    <span class="keyword">for</span> item <span class="keyword">in</span> headline.xpath(</div><div class="line">                            <span class="string">'../../div[@class="inforwrap clearfix"]/dl/dd'</span>):</div><div class="line">                        result_str = result_str + \</div><div class="line">                            item.xpath(<span class="string">'./a/text()'</span>).extract()[<span class="number">0</span>] + <span class="string">'\n'</span></div><div class="line">            result_str = result_str + self.seperator</div><div class="line">            <span class="comment"># print(result_str)</span></div><div class="line">            <span class="keyword">with</span> open(filename, <span class="string">'a'</span>, errors=<span class="string">'ignore'</span>) <span class="keyword">as</span> f:</div><div class="line">                f.write(result_str)</div></pre></td></tr></table></figure><p>【2】格式化</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div></pre></td><td class="code"><pre><div class="line"><span class="string">""" &lt;A formatter&gt;</span></div><div class="line">    Copyright (C) &lt;2017&gt;  Li W.H., Duan X</div><div class="line"></div><div class="line">    This program is free software: you can redistribute it and/or modify</div><div class="line">    it under the terms of the GNU General Public License as published by</div><div class="line">    the Free Software Foundation, either version 3 of the License, or</div><div class="line">    (at your option) any later version.</div><div class="line"></div><div class="line">    This program is distributed in the hope that it will be useful,</div><div class="line">    but WITHOUT ANY WARRANTY; without even the implied warranty of</div><div class="line">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</div><div class="line">    GNU General Public License for more details.</div><div class="line"></div><div class="line">    You should have received a copy of the GNU General Public License</div><div class="line">    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</div><div class="line">"""</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetDataFileList</span><span class="params">(path=<span class="string">'.'</span>)</span>:</span></div><div class="line">    <span class="string">""" Get the houses file list.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        path: Dir path.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        file_list: the list of data file that find houses data.</div><div class="line"></div><div class="line">    """</div><div class="line"></div><div class="line">    file_list = [x <span class="keyword">for</span> x <span class="keyword">in</span> os.listdir(path) <span class="keyword">if</span> os.path.isfile(</div><div class="line">        x) <span class="keyword">and</span> os.path.splitext(x)[<span class="number">1</span>] == <span class="string">'.txt'</span>]</div><div class="line"></div><div class="line">    <span class="keyword">return</span> file_list</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">Parse</span><span class="params">(file_list)</span>:</span></div><div class="line">    <span class="string">""" Parse the txt file that find houses data.</span></div><div class="line"></div><div class="line">    Extract some import infomation such as house name,</div><div class="line">    avarage price, address and so on.</div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        file_list: the list of data file that find houses data.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        houses_dict_list: the list that each item find the detail</div><div class="line">                          dict of each house.</div><div class="line">    """</div><div class="line"></div><div class="line">    HOUSE_NAME = <span class="string">'小区名称'</span></div><div class="line">    HOUSE_NAME_SPLITOR = <span class="string">'】'</span></div><div class="line">    HOUSE_ADDRESS = <span class="string">'小区地址'</span></div><div class="line">    HOUSE_ADDRESS_SPLITOR = <span class="string">'：'</span></div><div class="line">    HOUSE_AVG_PRICE = <span class="string">'平均价格'</span></div><div class="line">    HOUSE_AVG_PRICE_SPLITOR = <span class="string">'】'</span></div><div class="line">    AREA_OF_HOUSE_BELONGS_TO = <span class="string">'所属区域'</span></div><div class="line">    AREA_OF_HOUSE_BELONGS_TO_SPLITOR_1 = <span class="string">'：'</span></div><div class="line">    AREA_OF_HOUSE_BELONGS_TO_SPLITOR_2 = <span class="string">' '</span></div><div class="line">    PROPERTY_CATEGORY = <span class="string">'物业类别'</span></div><div class="line">    PROPERTY_CATEGORY_SPLITOR = <span class="string">'：'</span></div><div class="line">    GREEN_RATE = <span class="string">'绿 化 率'</span></div><div class="line">    GREEN_RATE_SPLITOR = <span class="string">'：'</span></div><div class="line">    VOLUME_RATE = <span class="string">'容 积 率'</span></div><div class="line">    VOLUME_RATE_SPLITOR = <span class="string">'：'</span></div><div class="line">    PROPERTY_COSTS = <span class="string">'物 业 费'</span></div><div class="line">    PROPERTY_COSTS_SPLITOR = <span class="string">'：'</span></div><div class="line">    NO_INFO_NOW = <span class="string">'暂无信息'</span></div><div class="line">    DETAIL_LIST = [HOUSE_NAME, HOUSE_AVG_PRICE, HOUSE_ADDRESS, AREA_OF_HOUSE_BELONGS_TO,</div><div class="line">                   PROPERTY_CATEGORY, GREEN_RATE, VOLUME_RATE, PROPERTY_COSTS]</div><div class="line"></div><div class="line">    houses_dict_list = []</div><div class="line">    <span class="keyword">for</span> file_name <span class="keyword">in</span> file_list:</div><div class="line">        raw_houses_string = <span class="string">''</span></div><div class="line">        <span class="comment"># read all lines as a string</span></div><div class="line">        <span class="keyword">with</span> open(file_name, <span class="string">'r'</span>, errors=<span class="string">'ignore'</span>) <span class="keyword">as</span> f:</div><div class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</div><div class="line">                raw_houses_string += line</div><div class="line">        <span class="comment"># split the string to the houses raw info list</span></div><div class="line">        raw_houses_list = raw_houses_string.split(<span class="string">'=\n'</span>)</div><div class="line"></div><div class="line">        raw_houses_details_list = []</div><div class="line">        <span class="keyword">for</span> raw_house <span class="keyword">in</span> raw_houses_list:</div><div class="line">            <span class="comment"># format house raw info to lines</span></div><div class="line">            raw_houses_details = raw_house.split(<span class="string">'\n'</span>)[:<span class="number">-1</span>]</div><div class="line">            <span class="keyword">if</span> len(raw_houses_details) == <span class="number">0</span>:</div><div class="line">                <span class="keyword">continue</span></div><div class="line">            <span class="comment"># combine the all formated house raw info to a list</span></div><div class="line">            raw_houses_details_list.append(raw_houses_details)</div><div class="line"></div><div class="line">        <span class="keyword">for</span> raw_house_details <span class="keyword">in</span> raw_houses_details_list:</div><div class="line">            house_details_dict = &#123;&#125;</div><div class="line">            <span class="keyword">for</span> raw_detail <span class="keyword">in</span> raw_house_details:</div><div class="line">                <span class="comment"># search house name</span></div><div class="line">                <span class="keyword">if</span> re.search(HOUSE_NAME, raw_detail):</div><div class="line">                    house_details_dict[HOUSE_NAME] = raw_detail.split(</div><div class="line">                        HOUSE_NAME_SPLITOR)[<span class="number">-1</span>]</div><div class="line">                <span class="comment"># search house avarage price</span></div><div class="line">                <span class="keyword">elif</span> re.search(HOUSE_AVG_PRICE, raw_detail):</div><div class="line">                    <span class="comment"># print(raw_detail)</span></div><div class="line">                    house_details_dict[HOUSE_AVG_PRICE] = raw_detail.split(</div><div class="line">                        HOUSE_AVG_PRICE_SPLITOR)[<span class="number">-1</span>]</div><div class="line">                <span class="comment"># search house address</span></div><div class="line">                <span class="keyword">elif</span> re.search(HOUSE_ADDRESS, raw_detail):</div><div class="line">                    house_details_dict[HOUSE_ADDRESS] = raw_detail.split(</div><div class="line">                        HOUSE_ADDRESS_SPLITOR)[<span class="number">-1</span>]</div><div class="line">                <span class="comment"># search the area of house belongs to</span></div><div class="line">                <span class="keyword">elif</span> re.search(AREA_OF_HOUSE_BELONGS_TO, raw_detail):</div><div class="line">                    temp_detail_value = raw_detail.split(</div><div class="line">                        AREA_OF_HOUSE_BELONGS_TO_SPLITOR_1)[<span class="number">-1</span>]</div><div class="line">                    detail_value = temp_detail_value.split(</div><div class="line">                        AREA_OF_HOUSE_BELONGS_TO_SPLITOR_2)[<span class="number">0</span>]</div><div class="line">                    house_details_dict[AREA_OF_HOUSE_BELONGS_TO] = detail_value</div><div class="line">                <span class="comment"># search the property category of house</span></div><div class="line">                <span class="keyword">elif</span> re.search(PROPERTY_CATEGORY, raw_detail):</div><div class="line">                    house_details_dict[PROPERTY_CATEGORY] = raw_detail.split(</div><div class="line">                        PROPERTY_CATEGORY_SPLITOR)[<span class="number">-1</span>]</div><div class="line">                <span class="comment"># search the green rate</span></div><div class="line">                <span class="keyword">elif</span> re.search(GREEN_RATE, raw_detail):</div><div class="line">                    house_details_dict[GREEN_RATE] = raw_detail.split(</div><div class="line">                        GREEN_RATE_SPLITOR)[<span class="number">-1</span>]</div><div class="line">                <span class="comment"># search the volume rate</span></div><div class="line">                <span class="keyword">elif</span> re.search(VOLUME_RATE, raw_detail):</div><div class="line">                    house_details_dict[VOLUME_RATE] = raw_detail.split(</div><div class="line">                        VOLUME_RATE_SPLITOR)[<span class="number">-1</span>]</div><div class="line">                <span class="comment"># search the property costs</span></div><div class="line">                <span class="keyword">elif</span> re.search(PROPERTY_COSTS, raw_detail):</div><div class="line">                    house_details_dict[PROPERTY_COSTS] = raw_detail.split(</div><div class="line">                        PROPERTY_COSTS_SPLITOR)[<span class="number">-1</span>]</div><div class="line">            <span class="comment"># Judge if all details are contained.</span></div><div class="line">            <span class="comment"># If not, set to null.</span></div><div class="line">            house_details_dict_keys = house_details_dict.keys()</div><div class="line">            <span class="keyword">for</span> detail_name <span class="keyword">in</span> DETAIL_LIST:</div><div class="line">                <span class="keyword">if</span> detail_name <span class="keyword">not</span> <span class="keyword">in</span> house_details_dict_keys:</div><div class="line">                    house_details_dict[detail_name] = NO_INFO_NOW</div><div class="line">            houses_dict_list.append(house_details_dict)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> houses_dict_list</div></pre></td></tr></table></figure><p>【3】通过高德地图api获取经纬度信息</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"><span class="string">""" &lt;A toolto transfer position.&gt;</span></div><div class="line">    Copyright (C) &lt;2017&gt;  Li W.H., Duan X</div><div class="line"></div><div class="line">    This program is free software: you can redistribute it and/or modify</div><div class="line">    it under the terms of the GNU General Public License as published by</div><div class="line">    the Free Software Foundation, either version 3 of the License, or</div><div class="line">    (at your option) any later version.</div><div class="line"></div><div class="line">    This program is distributed in the hope that it will be useful,</div><div class="line">    but WITHOUT ANY WARRANTY; without even the implied warranty of</div><div class="line">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</div><div class="line">    GNU General Public License for more details.</div><div class="line"></div><div class="line">    You should have received a copy of the GNU General Public License</div><div class="line">    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</div><div class="line">"""</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">Geocode</span><span class="params">(address)</span>:</span></div><div class="line">    <span class="string">""" A tool that call the God-Map api.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        address: the address to transfer.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        location: the transfered location.</div><div class="line">    """</div><div class="line"></div><div class="line">    CITY_NAME = <span class="string">'上海'</span></div><div class="line"></div><div class="line">    parameters = &#123;<span class="string">'address'</span>: address,</div><div class="line">                  <span class="string">'key'</span>: <span class="string">'your key'</span>,</div><div class="line">                  <span class="string">'city'</span>: CITY_NAME&#125;</div><div class="line">    base = <span class="string">'http://restapi.amap.com/v3/geocode/geo'</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        response = requests.get(base, parameters)</div><div class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">        print(<span class="string">'error!'</span>, e)</div><div class="line">    <span class="keyword">finally</span>:</div><div class="line">        <span class="keyword">pass</span></div><div class="line">    answer = response.json()</div><div class="line"></div><div class="line">    <span class="keyword">return</span> answer</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">GETGodMapLocation</span><span class="params">(houses)</span>:</span></div><div class="line">    <span class="string">""" Get the location that corresponds to the house name.</span></div><div class="line"></div><div class="line">    Use the God-Map api to get the corresponding location.</div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        houses_dict_list: the houses info.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        houses_dict_list_contains_loc: the houses info that</div><div class="line">                                           contains the location info.</div><div class="line">    """</div><div class="line"></div><div class="line">    HOUSE_NAME = <span class="string">'小区名称'</span></div><div class="line">    HOUSE_LOCATION = <span class="string">'经纬度'</span></div><div class="line">    NO_INFO_NOW = <span class="string">'暂无信息'</span></div><div class="line"></div><div class="line">    houses_dict_list = houses.copy()</div><div class="line">    error_count = <span class="number">0</span></div><div class="line">    count = <span class="number">0</span></div><div class="line">    size = len(houses)</div><div class="line"></div><div class="line">    <span class="keyword">for</span> house_dict <span class="keyword">in</span> houses_dict_list:</div><div class="line">        <span class="comment"># Count</span></div><div class="line">        count = count + <span class="number">1</span></div><div class="line">        <span class="comment"># Loading needs</span></div><div class="line">        <span class="keyword">if</span> count % <span class="number">1000</span> == <span class="number">0</span>:</div><div class="line">            print(count, <span class="string">'/'</span>, size)</div><div class="line">        address = house_dict[HOUSE_NAME]</div><div class="line">        answer = Geocode(address)</div><div class="line">        <span class="comment"># print(answer)</span></div><div class="line">        <span class="comment"># If find</span></div><div class="line">        <span class="keyword">if</span> len(answer[<span class="string">'geocodes'</span>]) != <span class="number">0</span>:</div><div class="line">            <span class="comment"># print(address + "的经纬度：", answer['geocodes'][0]['location'])</span></div><div class="line">            house_dict[HOUSE_LOCATION] = answer[<span class="string">'geocodes'</span>][<span class="number">0</span>][<span class="string">'location'</span>]</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="comment"># remaking the invalid address</span></div><div class="line">            <span class="comment"># print('address remaking...')</span></div><div class="line">            <span class="keyword">if</span> re.search(<span class="string">r'别墅'</span>, address):</div><div class="line">                re.sub(<span class="string">r'别墅'</span>, <span class="string">''</span>, address)</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                address = address + <span class="string">'小区'</span></div><div class="line">            <span class="comment"># print('retransfering...')</span></div><div class="line">            <span class="comment"># transfer again</span></div><div class="line">            answer = Geocode(address)</div><div class="line">            <span class="keyword">if</span> len(answer[<span class="string">'geocodes'</span>]) != <span class="number">0</span>:</div><div class="line">                <span class="comment"># print(address + "的经纬度：", answer['geocodes'][0]['location'])</span></div><div class="line">                house_dict[HOUSE_LOCATION] = answer[<span class="string">'geocodes'</span>][<span class="number">0</span>][<span class="string">'location'</span>]</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="comment"># print(address)</span></div><div class="line">                error_count += <span class="number">1</span></div><div class="line">                house_dict[HOUSE_LOCATION] = NO_INFO_NOW</div><div class="line"></div><div class="line">    print(<span class="string">'error counts: '</span>, error_count)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> houses_dict_list</div></pre></td></tr></table></figure><p>【4】存储成excel文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="string">""" &lt;A tool to save the excel file.&gt;</span></div><div class="line">    Copyright (C) &lt;2017&gt;  Li W.H., Duan X</div><div class="line"></div><div class="line">    This program is free software: you can redistribute it and/or modify</div><div class="line">    it under the terms of the GNU General Public License as published by</div><div class="line">    the Free Software Foundation, either version 3 of the License, or</div><div class="line">    (at your option) any later version.</div><div class="line"></div><div class="line">    This program is distributed in the hope that it will be useful,</div><div class="line">    but WITHOUT ANY WARRANTY; without even the implied warranty of</div><div class="line">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</div><div class="line">    GNU General Public License for more details.</div><div class="line"></div><div class="line">    You should have received a copy of the GNU General Public License</div><div class="line">    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</div><div class="line">"""</div><div class="line">        </div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">Save2ExcelFile</span><span class="params">(houses)</span>:</span></div><div class="line">    <span class="string">""" Save the python based list file to excel file.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        houses: the houses list.</div><div class="line"></div><div class="line">    """</div><div class="line"></div><div class="line">    houses_dict_list = houses.copy()</div><div class="line">    house_list = []</div><div class="line">    <span class="comment"># format the source data to fit the xlwt package</span></div><div class="line">    keys = houses[<span class="number">0</span>].keys()</div><div class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> keys:</div><div class="line">        house = []</div><div class="line">        house.append(key)</div><div class="line">        <span class="keyword">for</span> house_dict <span class="keyword">in</span> houses_dict_list:</div><div class="line">            house.append(house_dict[key])</div><div class="line">        house_list.append(house)</div><div class="line">    <span class="comment"># return house_list</span></div><div class="line">    xls = ExcelWrite.Workbook()</div><div class="line">    sheet = xls.add_sheet(<span class="string">'小区信息'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(house_list)):</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(len(house_list[<span class="number">0</span>])):</div><div class="line">            sheet.write(j, i, house_list[i][j])</div><div class="line"></div><div class="line">    xls.save(<span class="string">'houses.xls'</span>)</div></pre></td></tr></table></figure><h2 id="结果展示"><a href="#结果展示" class="headerlink" title="结果展示"></a>结果展示</h2><p><img src="http://o7ie0tcjk.bkt.clouddn.com/spider_house_txt_result.png" alt="spider_house_txt_result"></p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/spider_house_excel_result.png" alt="spider_house_excel_result"></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;数据来源&quot;&gt;&lt;a href=&quot;#数据来源&quot; class=&quot;headerlink&quot; title=&quot;数据来源&quot;&gt;&lt;/a&gt;数据来源&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://sh.fang.com/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;h
    
    </summary>
    
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
      <category term="spider" scheme="http://yoursite.com/tags/spider/"/>
    
  </entry>
  
  <entry>
    <title>python_god_web_api</title>
    <link href="http://yoursite.com/2017/02/17/python-god-web-api/"/>
    <id>http://yoursite.com/2017/02/17/python-god-web-api/</id>
    <published>2017-02-17T14:08:35.000Z</published>
    <updated>2017-02-19T13:12:25.497Z</updated>
    
    <content type="html"><![CDATA[<ol><li><a href="http://lbs.amap.com/api/webservice/guide/api/search" target="_blank" rel="external">http://lbs.amap.com/api/webservice/guide/api/search</a></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python3</span></div><div class="line"><span class="comment">#-*- coding:utf-8 -*-</span></div><div class="line"><span class="string">'''</span></div><div class="line">利用高德地图api实现地址和经纬度的转换</div><div class="line">'''</div><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">geocode</span><span class="params">(address)</span>:</span></div><div class="line">        parameters = &#123;<span class="string">'address'</span>: address, <span class="string">'key'</span>: <span class="string">'e798a5bfb344a09977b79552ae415974'</span>&#125;</div><div class="line">        base = <span class="string">'http://restapi.amap.com/v3/geocode/geo'</span></div><div class="line">        response = requests.get(base, parameters)</div><div class="line">        answer = response.json()</div><div class="line">        print(address + <span class="string">"的经纬度："</span>, answer[<span class="string">'geocodes'</span>][<span class="number">0</span>][<span class="string">'location'</span>])</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</div><div class="line">        <span class="comment">#address = input("请输入地址:")</span></div><div class="line">        address = <span class="string">'北京市海淀区'</span></div><div class="line">        geocode(address)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> xlrd</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">readXlsx</span><span class="params">(self, filename=<span class="string">'CenterBottom2013.xlsx'</span>, sheetname=<span class="string">'Sheet1'</span>)</span>:</span></div><div class="line">        rawData = []</div><div class="line">        <span class="keyword">if</span> (os.path.isfile(self.fn_rawDat)):</div><div class="line">            <span class="keyword">with</span> open(self.fn_rawDat, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</div><div class="line">                self.rawDat = np.load(f)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            workBook = xlrd.open_workbook(filename)</div><div class="line">            bookSheet = workBook.sheet_by_name(sheetname)</div><div class="line">            <span class="comment"># 从第二行开始读取，因为第一行有标签</span></div><div class="line">            <span class="keyword">for</span> row <span class="keyword">in</span> range(<span class="number">1</span>, bookSheet.nrows):</div><div class="line">                rowData = []</div><div class="line">                <span class="keyword">for</span> col <span class="keyword">in</span> range(bookSheet.ncols):</div><div class="line">                    cel = bookSheet.cell(row, col)</div><div class="line">                    <span class="keyword">try</span>:</div><div class="line">                        val = cel.value</div><div class="line">                    <span class="keyword">except</span>:</div><div class="line">                        <span class="keyword">pass</span></div><div class="line"></div><div class="line">                    <span class="keyword">if</span> type(val) == float:</div><div class="line">                        val = float(val)</div><div class="line">                    <span class="keyword">else</span>:</div><div class="line">                        val = str(val)</div><div class="line"></div><div class="line">                    rowData.append(val)</div><div class="line">                rawData.append(rowData)</div><div class="line">            self.rawDat = np.array(rawData)</div><div class="line">            <span class="keyword">with</span> open(self.fn_rawDat, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</div><div class="line">                np.save(f, self.rawDat)</div><div class="line">        <span class="keyword">return</span> self.rawDat</div></pre></td></tr></table></figure><ol><li>Read Excel files</li><li>Transfer the address to locaion info</li><li>Put back</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;ol&gt;&lt;li&gt;&lt;a href=&quot;http://lbs.amap.com/api/webservice/guide/api/search&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://lbs.amap.com/api/webservice/guid
    
    </summary>
    
    
      <category term="python" scheme="http://yoursite.com/tags/python/"/>
    
      <category term="map-api" scheme="http://yoursite.com/tags/map-api/"/>
    
  </entry>
  
</feed>
