<!doctype html><html class="theme-next mist use-motion" lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css"><meta name="keywords" content="Hexo, NexT"><link rel="alternate" href="/atom.xml" title="Abracadabra" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0"><meta name="description" content="Ewan&apos;s IT Blog"><meta property="og:type" content="website"><meta property="og:title" content="Abracadabra"><meta property="og:url" content="http://yoursite.com/page/14/index.html"><meta property="og:site_name" content="Abracadabra"><meta property="og:description" content="Ewan&apos;s IT Blog"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Abracadabra"><meta name="twitter:description" content="Ewan&apos;s IT Blog"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://yoursite.com/page/14/"><title>Abracadabra</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?dc405a79ad500922134d14cdf288f646";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-left page-home"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Abracadabra</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Do it yourself</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>Categories</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>About</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>Tags</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>Sitemap</a></li><li class="menu-item menu-item-commonweal"><a href="/404.html" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div><span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><section id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/04/What-Is-Local-Response-Normalization-In-Convolutional-Neural-Networks/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracadabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracadabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/2017/05/04/What-Is-Local-Response-Normalization-In-Convolutional-Neural-Networks/" itemprop="url">What Is Local Response Normalization In Convolutional Neural Networks</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-04T11:32:10+08:00">2017-05-04 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/05/04/What-Is-Local-Response-Normalization-In-Convolutional-Neural-Networks/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2017/05/04/What-Is-Local-Response-Normalization-In-Convolutional-Neural-Networks/" itemprop="commentsCount"></span> </a></span><span id="/2017/05/04/What-Is-Local-Response-Normalization-In-Convolutional-Neural-Networks/" class="leancloud_visitors" data-flag-title="What Is Local Response Normalization In Convolutional Neural Networks"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><p>Convolutional Neural Networks (CNNs) have been doing wonders in the field of image recognition in recent times. CNN is a type of deep neural network in which the layers are connected using spatially organized patterns. This is in line with how the human visual cortex processes image data. Researchers have been working on coming up with better architectures over the last few years. In this blog post, we will discuss a particular type of layer that has been used consistently across many famous architectures. This layer is called Local Response Normalization layer and it plays an important role. What does it do? What’s the advantage of having this in our network?</p><h2 id="Why-do-we-need-normalization-layers-in-the-first-place"><a href="#Why-do-we-need-normalization-layers-in-the-first-place" class="headerlink" title="Why do we need normalization layers in the first place?"></a><strong>Why do we need normalization layers in the first place?</strong></h2><p>A typical CNN consists of the following layers: convolution, pooling, rectified linear unit (ReLU), fully connected, and loss. If the previous sentence didn’t make sense, you may want to go through a quick CNN tutorial before proceeding further. Anyway, the reason we may want to have normalization layers in our CNN is that we want to have some kind of inhibition scheme.</p><p>In neurobiology, there is a concept called “lateral inhibition”. Now what does that mean? This refers to the capacity of an excited neuron to subdue its neighbors. We basically want a significant peak so that we have a form of local maxima. This tends to create a contrast in that area, hence increasing the sensory perception. Increasing the sensory perception is a good thing! We want to have the same thing in our CNNs.</p><h2 id="What-exactly-is-Local-Response-Normalization"><a href="#What-exactly-is-Local-Response-Normalization" class="headerlink" title="What exactly is Local Response Normalization?"></a><strong>What exactly is Local Response Normalization?</strong></h2><p>Local Response Normalization (LRN) layer implements the lateral inhibition we were talking about in the previous section. This layer is useful when we are dealing with ReLU neurons. Why is that? Because ReLU neurons have unbounded activations and we need LRN to normalize that. We want to detect high frequency features with a large response. If we normalize around the local neighborhood of the excited neuron, it becomes even more sensitive as compared to its neighbors.</p><p>At the same time, it will dampen the responses that are uniformly large in any given local neighborhood. If all the values are large, then normalizing those values will diminish all of them. So basically we want to encourage some kind of inhibition and boost the neurons with relatively larger activations. This has been discussed nicely in Section 3.3 of the <a href="http://www.cs.toronto.edu/~fritz/absps/imagenet.pdf" target="_blank" rel="external">original paper</a> by Krizhevsky et al.</p><h2 id="How-is-it-done-in-practice"><a href="#How-is-it-done-in-practice" class="headerlink" title="How is it done in practice?"></a><strong>How is it done in practice?</strong></h2><p>There are two types of normalizations available in Caffe. You can either normalize within the same channel or you can normalize across channels. Both these methods tend to amplify the excited neuron while dampening the surrounding neurons. When you are normalizing within the same channel, it’s just like considering a 2D neighborhood of dimension N x N, where N is the size of the normalization window. You normalize this window using the values in this neighborhood. If you are normalizing across channels, you will consider a neighborhood along the third dimension but at a single location. You need to consider an area of shape N x 1 x 1. Here 1 x 1 refers to a single value in a 2D matrix and N refers to the normalization size.</p><hr><p>Source page is <a href="https://prateekvjoshi.com/2016/04/05/what-is-local-response-normalization-in-convolutional-neural-networks/" target="_blank" rel="external">here</a>.</p></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/01/The-first-course-of-the-Docker/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracadabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracadabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/2017/05/01/The-first-course-of-the-Docker/" itemprop="url">The first course of the Docker</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-01T16:33:38+08:00">2017-05-01 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/05/01/The-first-course-of-the-Docker/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2017/05/01/The-first-course-of-the-Docker/" itemprop="commentsCount"></span> </a></span><span id="/2017/05/01/The-first-course-of-the-Docker/" class="leancloud_visitors" data-flag-title="The first course of the Docker"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><p>Docker command:</p><ul><li><p>docker images <strong>查看本机所有镜像</strong></p></li><li><p>docker pull NAME <strong>从仓库下载镜像</strong></p></li><li><p>docker run [-d -p 8080:80] or [-P] NAME <strong>启动镜像（-d 后台运行 -p 端口映射 -P 随机映射）</strong></p></li><li><p>docker exec [-i -t] NAME bash <strong>进入容器并执行bash</strong></p></li><li><p>docker ps <strong>查看后台容器</strong></p></li><li><p>docker stop ID <strong>停止docker容器</strong></p></li><li><p>docker restart ID <strong>重启容器</strong></p><p>​</p></li></ul><p>Docker netowrk type: bridge</p><p>Docker port map: host(eth0:80) &lt;–&gt; dicker0(bridge) &lt;–&gt; docker container(eth0:80)</p><p>Build Docker</p><ul><li>Dockerfile</li><li>docker build [-t] <strong>建立Docker，指定TAG</strong></li></ul><p>A Dcokerfile example (based tomcat):</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> tomcat </div><div class="line"></div><div class="line"><span class="keyword">MAINTAINER</span> ewan ewanlee@yeah.net</div><div class="line"></div><div class="line"><span class="keyword">COPY</span> jpress-web-newest.war /usr/local/tomcat/webapps</div></pre></td></tr></table></figure><h2 id="搭建第一个Web-app"><a href="#搭建第一个Web-app" class="headerlink" title="搭建第一个Web app"></a>搭建第一个Web app</h2><p>为了介绍方便，所以使用了开源的java实现的wordpress，也就是<a href="https://github.com/JpressProjects/jpress" target="_blank" rel="external">Jpress</a></p><p>[1]下载相应的<a href="https://github.com/JpressProjects/jpress/blob/master/wars/jpress-web-newest.war" target="_blank" rel="external">war包</a>，并存到工作目录下</p><p>[2]下载一个tomcat的Docker镜像<code>docker pull tomcat</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">Using default tag: latest</div><div class="line">latest: Pulling from library/tomcat</div><div class="line">cd0a524342ef: Pull complete </div><div class="line">e39c3ffe4133: Pull complete </div><div class="line">aac3320edf40: Pull complete </div><div class="line">4d9e109682f7: Pull complete </div><div class="line">0a59efcf9553: Pull complete </div><div class="line">43a404e523e0: Pull complete </div><div class="line">806f07b1dce8: Pull complete </div><div class="line">0cad96dccb4c: Pull complete </div><div class="line">04073e2a9145: Pull complete </div><div class="line">d9e4bf4be89c: Pull complete </div><div class="line">739005fdecc9: Pull complete </div><div class="line">8bd03d99f1b2: Pull complete </div><div class="line">d586afbd7622: Pull complete </div><div class="line">Digest: sha256:88483873b279aaea5ced002c98dde04555584b66de29797a4476d5e94874e6de</div><div class="line">Status: Downloaded newer image for tomcat:latest</div></pre></td></tr></table></figure><p>[3]写一个<code>Dockerfile</code>，也就是之前的example</p><p>[4]建立镜像<code>docker build -t jpress:latest .</code></p><p>结果如下：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Sending build context to Docker daemon  <span class="number">20.8</span> MB</div><div class="line">Step <span class="number">1</span> : FROM tomcat</div><div class="line"> ---&gt; d71978506e58</div><div class="line">Step <span class="number">2</span> : MAINTAINER ewan ewanlee<span class="meta">@yeah</span>.net</div><div class="line"> ---&gt; Running <span class="keyword">in</span> dfa1902d1ea4</div><div class="line"> ---&gt; <span class="number">956612</span>ba6987</div><div class="line">Removing intermediate container dfa1902d1ea4</div><div class="line">Step <span class="number">3</span> : COPY jpress-web-newest.war /usr/local/tomcat/webapps</div><div class="line"> ---&gt; dd6eecd741e7</div><div class="line">Removing intermediate container <span class="number">1</span>fe7f943071b</div><div class="line">Successfully built dd6eecd741e7</div></pre></td></tr></table></figure><p>[5]下载一个mysql的docker镜像<code>docker pull mysql</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Using default tag: latest</div><div class="line">latest: Pulling from library/mysql</div><div class="line">cd0a524342ef: Already exists </div><div class="line">d9c95f06c17e: Pull complete </div><div class="line">46b2d578f59a: Pull complete </div><div class="line">10fbc2bcc6e9: Pull complete </div><div class="line">91b1a29c3956: Pull complete </div><div class="line">5bf9316bd602: Pull complete </div><div class="line">69bd23f08b55: Pull complete </div><div class="line">4fb778132e94: Pull complete </div><div class="line">6913628d7744: Pull complete </div><div class="line">a477f36dc2e0: Pull complete </div><div class="line">c954124ae935: Pull complete </div><div class="line">Digest: sha256:e44b9a3ae88db013a3e8571a89998678ba44676ed4ae9f54714fd31e108f8b58</div><div class="line">Status: Downloaded newer image for mysql:latest</div></pre></td></tr></table></figure><p>[6]运行mysql并创建一个数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=000000 -e MYSQL_DATABASE=jpress mysql</div></pre></td></tr></table></figure><p>[7]运行自己建立的<code>jpress</code>镜像<code>docker run -d -p 8888:8080 jpress</code></p><p>下面进行浏览器页面的配置，在浏览器输入<code>localhost:8888</code>将出现以下界面：</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/docker-jpress/index_page.png" alt="index"></p><p>在地址栏后加入后缀<code>jpress-web-newest</code></p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/docker-jpress/jpress_install.png" alt="install"></p><p>填写配置信息，注意服务器地址是<code>docker0</code>网卡的ip</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/docker-jpress/config.png" alt="config"></p><p>结果</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/docker-jpress/home_page.png" alt="home"></p><p>安装过程中出现了一个bug，就是在进行配置后我退出了，再次进去重新配置出错，最后发现原因是表前缀需要改一下，因为之前配置成功了，数据库中已经有了一个相同的表前缀​:P</p><p>是不是很方便，完全不用手动安装任何东西~</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="http://www.imooc.com/learn/824" target="_blank" rel="external">http://www.imooc.com/learn/824</a></li></ol></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/01/HMM-implemented-by-hmmlearn/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracadabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracadabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/2017/05/01/HMM-implemented-by-hmmlearn/" itemprop="url">HMM implemented by hmmlearn</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-05-01T13:33:52+08:00">2017-05-01 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/05/01/HMM-implemented-by-hmmlearn/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2017/05/01/HMM-implemented-by-hmmlearn/" itemprop="commentsCount"></span> </a></span><span id="/2017/05/01/HMM-implemented-by-hmmlearn/" class="leancloud_visitors" data-flag-title="HMM implemented by hmmlearn"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="Sampling-from-HMM"><a href="#Sampling-from-HMM" class="headerlink" title="Sampling from HMM"></a>Sampling from HMM</h1><p>This script shows how to sample points from a Hidden Markov Model (HMM): we use a 4-components with specified mean and covariance.</p><p>The plot show the sequence of observations generated with the transitions between them. We can see that, as specified by our transition matrix, there are no transition between component 1 and 3.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">print(__doc__)</div><div class="line"></div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"></div><div class="line"><span class="keyword">from</span> hmmlearn <span class="keyword">import</span> hmm</div></pre></td></tr></table></figure><p>Prepare parameters for a 4-components HMM Initial population probability</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">startprob = np.array([<span class="number">0.6</span>, <span class="number">0.3</span>, <span class="number">0.1</span>, <span class="number">0.0</span>])</div><div class="line"><span class="comment"># The transition matrix, note that there are no transitions possible</span></div><div class="line"><span class="comment"># between component 1 and 3</span></div><div class="line">transmat = np.array([[<span class="number">0.7</span>, <span class="number">0.2</span>, <span class="number">0.0</span>, <span class="number">0.1</span>],</div><div class="line">                     [<span class="number">0.3</span>, <span class="number">0.5</span>, <span class="number">0.2</span>, <span class="number">0.0</span>],</div><div class="line">                     [<span class="number">0.0</span>, <span class="number">0.3</span>, <span class="number">0.5</span>, <span class="number">0.2</span>],</div><div class="line">                     [<span class="number">0.2</span>, <span class="number">0.0</span>, <span class="number">0.2</span>, <span class="number">0.6</span>]])</div><div class="line"><span class="comment"># The means of each component</span></div><div class="line">means = np.array([[<span class="number">0.0</span>,  <span class="number">0.0</span>],</div><div class="line">                  [<span class="number">0.0</span>, <span class="number">11.0</span>],</div><div class="line">                  [<span class="number">9.0</span>, <span class="number">10.0</span>],</div><div class="line">                  [<span class="number">11.0</span>, <span class="number">-1.0</span>]])</div><div class="line"><span class="comment"># The covariance of each component</span></div><div class="line">covars = <span class="number">.5</span> * np.tile(np.identity(<span class="number">2</span>), (<span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>))</div><div class="line"></div><div class="line"><span class="comment"># Build an HMM instance and set parameters</span></div><div class="line">model = hmm.GaussianHMM(n_components=<span class="number">4</span>, covariance_type=<span class="string">"full"</span>)</div><div class="line"></div><div class="line"><span class="comment"># Instead of fitting it from the data, we directly set the estimated</span></div><div class="line"><span class="comment"># parameters, the means and covariance of the components</span></div><div class="line">model.startprob_ = startprob</div><div class="line">model.transmat_ = transmat</div><div class="line">model.means_ = means</div><div class="line">model.covars_ = covars</div><div class="line"></div><div class="line"><span class="comment"># Generate samples</span></div><div class="line">X, Z = model.sample(<span class="number">500</span>)</div><div class="line"></div><div class="line"><span class="comment"># Plot the sampled data</span></div><div class="line">plt.plot(X[:, <span class="number">0</span>], X[:, <span class="number">1</span>], <span class="string">".-"</span>, label=<span class="string">"observations"</span>, ms=<span class="number">6</span>,</div><div class="line">         mfc=<span class="string">"orange"</span>, alpha=<span class="number">0.7</span>)</div><div class="line"></div><div class="line"><span class="comment"># Indicate the component numbers</span></div><div class="line"><span class="keyword">for</span> i, m <span class="keyword">in</span> enumerate(means):</div><div class="line">    plt.text(m[<span class="number">0</span>], m[<span class="number">1</span>], <span class="string">'Component %i'</span> % (i + <span class="number">1</span>),</div><div class="line">             size=<span class="number">17</span>, horizontalalignment=<span class="string">'center'</span>,</div><div class="line">             bbox=dict(alpha=<span class="number">.7</span>, facecolor=<span class="string">'w'</span>))</div><div class="line">plt.legend(loc=<span class="string">'best'</span>)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://hmmlearn.readthedocs.io/en/latest/_images/sphx_glr_plot_hmm_sampling_001.png" alt="sampling_result"></p><p><strong>Total running time of the script:</strong> ( 0 minutes 0.676 seconds)</p><h1 id="Gaussian-HMM-of-stock-data"><a href="#Gaussian-HMM-of-stock-data" class="headerlink" title="Gaussian HMM of stock data"></a>Gaussian HMM of stock data</h1><p>This script shows how to use Gaussian HMM on stock price data from Yahoo! finance. For more information on how to visualize stock prices with matplotlib, please refer to <code>date_demo1.py</code> of matplotlib.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</div><div class="line"></div><div class="line"><span class="keyword">import</span> datetime</div><div class="line"></div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> cm, pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="keyword">from</span> matplotlib.dates <span class="keyword">import</span> YearLocator, MonthLocator</div><div class="line"><span class="keyword">try</span>:</div><div class="line">    <span class="keyword">from</span> matplotlib.finance <span class="keyword">import</span> quotes_historical_yahoo_ochl</div><div class="line"><span class="keyword">except</span> ImportError:</div><div class="line">    <span class="comment"># For Matplotlib prior to 1.5.</span></div><div class="line">    <span class="keyword">from</span> matplotlib.finance <span class="keyword">import</span> (</div><div class="line">        quotes_historical_yahoo <span class="keyword">as</span> quotes_historical_yahoo_ochl</div><div class="line">    )</div><div class="line"></div><div class="line"><span class="keyword">from</span> hmmlearn.hmm <span class="keyword">import</span> GaussianHMM</div><div class="line"></div><div class="line"></div><div class="line">print(__doc__)</div></pre></td></tr></table></figure><p>Get quotes from Yahoo! finance</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">quotes = quotes_historical_yahoo_ochl(</div><div class="line">    <span class="string">"INTC"</span>, datetime.date(<span class="number">1995</span>, <span class="number">1</span>, <span class="number">1</span>), datetime.date(<span class="number">2012</span>, <span class="number">1</span>, <span class="number">6</span>))</div><div class="line"></div><div class="line"><span class="comment"># Unpack quotes</span></div><div class="line">dates = np.array([q[<span class="number">0</span>] <span class="keyword">for</span> q <span class="keyword">in</span> quotes], dtype=int)</div><div class="line">close_v = np.array([q[<span class="number">2</span>] <span class="keyword">for</span> q <span class="keyword">in</span> quotes])</div><div class="line">volume = np.array([q[<span class="number">5</span>] <span class="keyword">for</span> q <span class="keyword">in</span> quotes])[<span class="number">1</span>:]</div><div class="line"></div><div class="line"><span class="comment"># Take diff of close value. Note that this makes</span></div><div class="line"><span class="comment"># ``len(diff) = len(close_t) - 1``, therefore, other quantities also</span></div><div class="line"><span class="comment"># need to be shifted by 1.</span></div><div class="line">diff = np.diff(close_v)</div><div class="line">dates = dates[<span class="number">1</span>:]</div><div class="line">close_v = close_v[<span class="number">1</span>:]</div><div class="line"></div><div class="line"><span class="comment"># Pack diff and volume for training.</span></div><div class="line">X = np.column_stack([diff, volume])</div></pre></td></tr></table></figure><p>Run Gaussian HMM</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">print(<span class="string">"fitting to HMM and decoding ..."</span>, end=<span class="string">""</span>)</div><div class="line"></div><div class="line"><span class="comment"># Make an HMM instance and execute fit</span></div><div class="line">model = GaussianHMM(n_components=<span class="number">4</span>, covariance_type=<span class="string">"diag"</span>, n_iter=<span class="number">1000</span>).fit(X)</div><div class="line"></div><div class="line"><span class="comment"># Predict the optimal sequence of internal hidden state</span></div><div class="line">hidden_states = model.predict(X)</div><div class="line"></div><div class="line">print(<span class="string">"done"</span>)</div></pre></td></tr></table></figure><p>Out:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fitting to HMM and decoding ...done</div></pre></td></tr></table></figure><p>Print trained parameters and plot</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">print(<span class="string">"Transition matrix"</span>)</div><div class="line">print(model.transmat_)</div><div class="line">print()</div><div class="line"></div><div class="line">print(<span class="string">"Means and vars of each hidden state"</span>)</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(model.n_components):</div><div class="line">    print(<span class="string">"&#123;0&#125;th hidden state"</span>.format(i))</div><div class="line">    print(<span class="string">"mean = "</span>, model.means_[i])</div><div class="line">    print(<span class="string">"var = "</span>, np.diag(model.covars_[i]))</div><div class="line">    print()</div><div class="line"></div><div class="line">fig, axs = plt.subplots(model.n_components, sharex=<span class="keyword">True</span>, sharey=<span class="keyword">True</span>)</div><div class="line">colours = cm.rainbow(np.linspace(<span class="number">0</span>, <span class="number">1</span>, model.n_components))</div><div class="line"><span class="keyword">for</span> i, (ax, colour) <span class="keyword">in</span> enumerate(zip(axs, colours)):</div><div class="line">    <span class="comment"># Use fancy indexing to plot data in each state.</span></div><div class="line">    mask = hidden_states == i</div><div class="line">    ax.plot_date(dates[mask], close_v[mask], <span class="string">".-"</span>, c=colour)</div><div class="line">    ax.set_title(<span class="string">"&#123;0&#125;th hidden state"</span>.format(i))</div><div class="line"></div><div class="line">    <span class="comment"># Format the ticks.</span></div><div class="line">    ax.xaxis.set_major_locator(YearLocator())</div><div class="line">    ax.xaxis.set_minor_locator(MonthLocator())</div><div class="line"></div><div class="line">    ax.grid(<span class="keyword">True</span>)</div><div class="line"></div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://hmmlearn.readthedocs.io/en/latest/_images/sphx_glr_plot_hmm_stock_analysis_001.png" alt="hmm_yahoo_analysis"></p><p>Out:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">Transition matrix</div><div class="line">[[  <span class="number">9.79220773e-01</span>   <span class="number">2.57382344e-15</span>   <span class="number">2.72061945e-03</span>   <span class="number">1.80586073e-02</span>]</div><div class="line"> [  <span class="number">1.12216188e-12</span>   <span class="number">7.73561269e-01</span>   <span class="number">1.85019044e-01</span>   <span class="number">4.14196869e-02</span>]</div><div class="line"> [  <span class="number">3.25313504e-03</span>   <span class="number">1.12692615e-01</span>   <span class="number">8.83368021e-01</span>   <span class="number">6.86228435e-04</span>]</div><div class="line"> [  <span class="number">1.18741799e-01</span>   <span class="number">4.20310643e-01</span>   <span class="number">1.18670597e-18</span>   <span class="number">4.60947557e-01</span>]]</div><div class="line"></div><div class="line">Means <span class="keyword">and</span> vars of each hidden state</div><div class="line"><span class="number">0</span>th hidden state</div><div class="line">mean =  [  <span class="number">2.33331888e-02</span>   <span class="number">4.97389989e+07</span>]</div><div class="line">var =  [  <span class="number">6.97748259e-01</span>   <span class="number">2.49466578e+14</span>]</div><div class="line"></div><div class="line"><span class="number">1</span>th hidden state</div><div class="line">mean =  [  <span class="number">2.12401671e-02</span>   <span class="number">8.81882861e+07</span>]</div><div class="line">var =  [  <span class="number">1.18665023e-01</span>   <span class="number">5.64418451e+14</span>]</div><div class="line"></div><div class="line"><span class="number">2</span>th hidden state</div><div class="line">mean =  [  <span class="number">7.69658065e-03</span>   <span class="number">5.43135922e+07</span>]</div><div class="line">var =  [  <span class="number">5.02315562e-02</span>   <span class="number">1.54569357e+14</span>]</div><div class="line"></div><div class="line"><span class="number">3</span>th hidden state</div><div class="line">mean =  [ <span class="number">-3.53210673e-01</span>   <span class="number">1.53080943e+08</span>]</div><div class="line">var =  [  <span class="number">2.55544137e+00</span>   <span class="number">5.88210257e+15</span>]</div></pre></td></tr></table></figure><p><strong>Total running time of the script:</strong> ( 0 minutes 2.903 seconds)</p></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/30/The-basic-of-Hidden-Markov-Model/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracadabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracadabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/2017/04/30/The-basic-of-Hidden-Markov-Model/" itemprop="url">The Basic of Hidden Markov Model</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-30T23:04:54+08:00">2017-04-30 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/04/30/The-basic-of-Hidden-Markov-Model/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2017/04/30/The-basic-of-Hidden-Markov-Model/" itemprop="commentsCount"></span> </a></span><span id="/2017/04/30/The-basic-of-Hidden-Markov-Model/" class="leancloud_visitors" data-flag-title="The Basic of Hidden Markov Model"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><div class="row"><embed src="http://o7ie0tcjk.bkt.clouddn.com/hmm-paper/tutorial%20on%20hmm%20and%20applications.pdf" width="100%" height="550" type="application/pdf"></div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/29/The-awesome-Wasserstein-GAN/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracadabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracadabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/2017/04/29/The-awesome-Wasserstein-GAN/" itemprop="url">The awesome Wasserstein GAN</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-29T16:55:06+08:00">2017-04-29 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/04/29/The-awesome-Wasserstein-GAN/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2017/04/29/The-awesome-Wasserstein-GAN/" itemprop="commentsCount"></span> </a></span><span id="/2017/04/29/The-awesome-Wasserstein-GAN/" class="leancloud_visitors" data-flag-title="The awesome Wasserstein GAN"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><p>原帖地址：<a href="https://zhuanlan.zhihu.com/p/25071913">https://zhuanlan.zhihu.com/p/25071913</a></p><blockquote><p>本文后续：<a href="https://www.zhihu.com/question/52602529/answer/158727900">Wasserstein GAN最新进展：从weight clipping到gradient penalty，更加先进的Lipschitz限制手法</a></p></blockquote><p>在GAN的相关研究如火如荼甚至可以说是泛滥的今天，一篇新鲜出炉的arXiv论文《<a href="http://link.zhihu.com/?target=https%3A//arxiv.org/abs/1701.07875">Wasserstein GAN</a>》却在Reddit的Machine Learning频道火了，连Goodfellow都<a href="http://link.zhihu.com/?target=https%3A//www.reddit.com/r/MachineLearning/comments/5qxoaz/r_170107875_wasserstein_gan/">在帖子里和大家热烈讨论</a>，这篇论文究竟有什么了不得的地方呢？</p><p>要知道自从<a href="http://link.zhihu.com/?target=https%3A//arxiv.org/abs/1406.2661">2014年Ian Goodfellow提出</a>以来，GAN就存在着训练困难、生成器和判别器的loss无法指示训练进程、生成样本缺乏多样性等问题。从那时起，很多论文都在尝试解决，但是效果不尽人意，比如最有名的一个改进<a href="http://link.zhihu.com/?target=https%3A//arxiv.org/abs/1511.06434">DCGAN</a>依靠的是对判别器和生成器的架构进行实验枚举，最终找到一组比较好的网络架构设置，但是实际上是治标不治本，没有彻底解决问题。而今天的主角Wasserstein GAN（下面简称WGAN）成功地做到了以下爆炸性的几点：</p><ul><li>彻底解决GAN训练不稳定的问题，不再需要小心平衡生成器和判别器的训练程度</li><li>基本解决了collapse mode的问题，确保了生成样本的多样性</li><li>训练过程中终于有一个像交叉熵、准确率这样的数值来指示训练的进程，这个数值越小代表GAN训练得越好，代表生成器产生的图像质量越高（如题图所示）</li><li>以上一切好处不需要精心设计的网络架构，最简单的多层全连接网络就可以做到</li></ul><p>那以上好处来自哪里？这就是令人拍案叫绝的部分了——实际上作者整整花了两篇论文，在第一篇《<a href="http://link.zhihu.com/?target=https%3A//arxiv.org/abs/1701.04862">Towards Principled Methods for Training Generative Adversarial Networks</a>》里面推了一堆公式定理，从理论上分析了原始GAN的问题所在，从而针对性地给出了改进要点；在这第二篇《<a href="http://link.zhihu.com/?target=https%3A//arxiv.org/abs/1701.07875">Wasserstein GAN</a>》里面，又再从这个改进点出发推了一堆公式定理，最终给出了改进的算法实现流程，<strong>而改进后相比原始GAN的算法实现流程却只改了四点</strong>：</p><ul><li>判别器最后一层去掉sigmoid</li><li>生成器和判别器的loss不取log</li><li>每次更新判别器的参数之后把它们的绝对值截断到不超过一个固定常数c</li><li>不要用基于动量的优化算法（包括momentum和Adam），推荐RMSProp，SGD也行</li></ul><p>算法截图如下：</p><p><img src="https://pic1.zhimg.com/v2-6be6e2ef3d15c4b10c2a943e9bf4db70_b.jpg" alt="img"></p><p>改动是如此简单，效果却惊人地好，以至于Reddit上不少人在感叹：就这样？没有别的了？ 太简单了吧！这些反应让我想起了一个颇有年头的鸡汤段子，说是一个工程师在电机外壳上用粉笔划了一条线排除了故障，要价一万美元——画一条线，1美元；知道在哪画线，9999美元。上面这四点改进就是作者Martin Arjovsky划的简简单单四条线，对于工程实现便已足够，但是知道在哪划线，背后却是精巧的数学分析，而这也是本文想要整理的内容。</p><p>本文内容分为五个部分：</p><ul><li>原始GAN究竟出了什么问题？（此部分较长）</li><li>WGAN之前的一个过渡解决方案</li><li>Wasserstein距离的优越性质</li><li>从Wasserstein距离到WGAN</li><li>总结</li></ul><p><em>理解原文的很多公式定理需要对测度论、 拓扑学等数学知识有所掌握，本文会从直观的角度对每一个重要公式进行解读，有时通过一些低维的例子帮助读者理解数学背后的思想，所以不免会失于严谨，如有引喻不当之处，欢迎在评论中指出。</em></p><p><em>以下简称《Wassertein GAN》为“WGAN本作”，简称《Towards Principled Methods for Training Generative Adversarial Networks》为“WGAN前作”。</em></p><p><em>WGAN源码实现：martinarjovsky/WassersteinGAN</em></p><h2 id="第一部分：原始GAN究竟出了什么问题？"><a href="#第一部分：原始GAN究竟出了什么问题？" class="headerlink" title="第一部分：原始GAN究竟出了什么问题？"></a>第一部分：原始GAN究竟出了什么问题？</h2><p>回顾一下，原始GAN中判别器要最小化如下损失函数，尽可能把真实样本分为正例，生成样本分为负例：</p><p>$$-\mathbb{E}_{x \sim P_r}[log D(x)] - \mathbb{E}_{x \sim P_{g}}[log(1-D(x))]$$</p><p>其中$P_r$是真实样本分布，$P_g$是由生成器产生的样本分布。对于生成器，Goodfellow一开始提出来一个损失函数，后来又提出了一个改进的损失函数，分别是</p><p>$$ \mathbb{E}_{x \sim P_g}[log(1-D(x))]$$</p><p>$$ \mathbb{E}_{x \sim P_g}[-log D(x)]$$</p><p>后者在WGAN两篇论文中称为“the - log D alternative”或“the - log D trick”。WGAN前作分别分析了这两种形式的原始GAN各自的问题所在，下面分别说明。</p><h2 id="第一种原始GAN形式的问题"><a href="#第一种原始GAN形式的问题" class="headerlink" title="第一种原始GAN形式的问题"></a>第一种原始GAN形式的问题</h2><p><strong>一句话概括：判别器越好，生成器梯度消失越严重。</strong>WGAN前作从两个角度进行了论证，第一个角度是从生成器的等价损失函数切入的。</p><p>首先从公式1可以得到，在生成器G固定参数时最优的判别器D应该是什么。对于一个具体的样本$x$，它可能来自真实分布也可能来自生成分布，它对公式1损失函数的贡献是</p><p>$$- P_r(x)logD(x) - p_g(x)log[1 - D(x)]$$</p><p>令其关于$D(x)$的导数为0，得<br>$$<br>-\frac{P_r(x)}{D(x)} + \frac{P_g(x)}{1 - D(x)} = 0<br>$$<br>化简得最优判别器为：<br>$$<br>D^{\star}(x) = \frac{P_r(x)}{P_r(x) + P_g(x)}<br>$$<br>这个结果从直观上很容易理解，就是看一个样本$x$来自真实分布和生成分布的可能性的相对比例。如果$P_r(x) = 0$且$P_g(x) \neq 0$，最优判别器就应该非常自信地给出概率0；如果$P_r(x) = P_g(x)$，说明该样本是真是假的可能性刚好一半一半，此时最优判别器也应该给出概率0.5。</p><p>然而GAN训练有一个trick，就是别把判别器训练得太好，否则在实验中生成器会完全学不动（loss降不下去），为了探究背后的原因，我们就可以看看在极端情况——判别器最优时，生成器的损失函数变成什么。给公式2加上一个不依赖于生成器的项，使之变成<br>$$<br>\mathbb{E}_{x \sim P_r}[log D(x)] - \mathbb{E}_{x \sim P_{g}}[log(1-D(x))]<br>$$</p><p>注意，最小化这个损失函数等价于最小化公式2，而且它刚好是判别器损失函数的反。代入最优判别器即公式4，再进行简单的变换可以得到</p><p>$$\mathbb{E}_{x \sim P_r} \log \frac{P_r(x)}{\frac{1}{2}[P_r(x) + P_g(x)]} + \mathbb{E}_{x \sim P_g} \log \frac{P_g(x)}{\frac{1}{2}[P_r(x) + P_g(x)]} - 2\log 2$$</p><p>变换成这个样子是为了引入Kullback–Leibler divergence（简称KL散度）和Jensen-Shannon divergence（简称JS散度）这两个重要的相似度衡量指标，后面的主角之一Wasserstein距离，就是要来吊打它们两个的。所以接下来介绍这两个重要的配角——KL散度和JS散度：</p><p>$$KL(P_1||P_2) = \mathbb{E}_{x \sim P_1} \log \frac{P_1}{P_2}$$</p><p>$$JS(P_1 || P_2) = \frac{1}{2}KL(P_1||\frac{P_1 + P_2}{2}) + \frac{1}{2}KL(P_2||\frac{P_1 + P_2}{2})$$</p><p>于是公式5就可以继续写成</p><p>$$2JS(P_r || P_g) - 2\log 2$$</p><p>到这里读者可以先喘一口气，看看目前得到了什么结论：<strong>根据原始GAN定义的判别器loss，我们可以得到最优判别器的形式；而在最优判别器的下，我们可以把原始GAN定义的生成器loss等价变换为最小化真实分布$P_r$与生成分布$P_g$之间的JS散度。我们越训练判别器，它就越接近最优，最小化生成器的loss也就会越近似于最小化$P_r$和$P_g$之间的JS散度。</strong></p><p>问题就出在这个JS散度上。我们会希望如果两个分布之间越接近它们的JS散度越小，我们通过优化JS散度就能将$P_g$“拉向”$P_r$，最终以假乱真。这个希望在两个分布有所重叠的时候是成立的，但是如果两个分布完全没有重叠的部分，或者它们重叠的部分可忽略（下面解释什么叫可忽略），它们的JS散度是多少呢？</p><p>答案是$\log 2$，因为对于任意一个x只有四种可能：</p><p>$$P_1(x) = 0且P_2(x) = 0$$</p><p>$$P_1(x) \neq 0且P_2(x) \neq 0$$</p><p>$$P_1(x) = 0且P_2(x) \neq 0$$</p><p>$$P_1(x) \neq 且P_2(x) = 0$$</p><p>第一种对计算JS散度无贡献，第二种情况由于重叠部分可忽略所以贡献也为0，第三种情况对公式7右边第一个项的贡献是$\log \frac{P_2}{\frac{1}{2}(P_2 + 0)} = \log 2$，第四种情况与之类似，所以最终$JS(P_1||P_2) = \log 2$。</p><p>换句话说，无论$P_r$跟$P_g$是远在天边，还是近在眼前，只要它们俩没有一点重叠或者重叠部分可忽略，JS散度就固定是常数$\log 2$，<strong>而这对于梯度下降方法意味着——梯度为0</strong>！此时对于最优判别器来说，生成器肯定是得不到一丁点梯度信息的；即使对于接近最优的判别器来说，生成器也有很大机会面临梯度消失的问题。</p><p>但是$P_r$与$P_g$不重叠或重叠部分可忽略的可能性有多大？不严谨的答案是：非常大。比较严谨的答案是：<strong>当$P_r$与$P_g$的支撑集（support）是高维空间中的低维流形（manifold）时，$P_r$与$P_g$重叠部分测度（measure）为0的概率为1。</strong></p><p>不用被奇怪的术语吓得关掉页面，虽然论文给出的是严格的数学表述，但是直观上其实很容易理解。首先简单介绍一下这几个概念：</p><ul><li>支撑集（support）其实就是函数的非零部分子集，比如ReLU函数的支撑集就是$(0, +\infty)$，一个概率分布的支撑集就是所有概率密度非零部分的集合。</li><li>流形（manifold）是高维空间中曲线、曲面概念的拓广，我们可以在低维上直观理解这个概念，比如我们说三维空间中的一个曲面是一个二维流形，因为它的本质维度（intrinsic dimension）只有2，一个点在这个二维流形上移动只有两个方向的自由度。同理，三维空间或者二维空间中的一条曲线都是一个一维流形。</li><li>测度（measure）是高维空间中长度、面积、体积概念的拓广，可以理解为“超体积”。</li></ul><p>回过头来看第一句话，“当$P_r$与$P_g$的支撑集是高维空间中的低维流形时”，基本上是成立的。原因是GAN中的生成器一般是从某个低维（比如100维）的随机分布中采样出一个编码向量，再经过一个神经网络生成出一个高维样本（比如64x64的图片就有4096维）。当生成器的参数固定时，生成样本的概率分布虽然是定义在4096维的空间上，但它本身所有可能产生的变化已经被那个100维的随机分布限定了，其本质维度就是100，再考虑到神经网络带来的映射降维，最终可能比100还小，所以生成样本分布的支撑集就在4096维空间中构成一个最多100维的低维流形，“撑不满”整个高维空间。</p><p>“撑不满”就会导致真实分布与生成分布难以“碰到面”，这很容易在二维空间中理解：一方面，二维平面中随机取两条曲线，它们之间刚好存在重叠线段的概率为0；另一方面，虽然它们很大可能会存在交叉点，但是相比于两条曲线而言，交叉点比曲线低一个维度，长度（测度）为0，可忽略。三维空间中也是类似的，随机取两个曲面，它们之间最多就是比较有可能存在交叉线，但是交叉线比曲面低一个维度，面积（测度）是0，可忽略。从低维空间拓展到高维空间，就有了如下逻辑：因为一开始生成器随机初始化，所以$P_g$几乎不可能与$P_r$有什么关联，所以它们的支撑集之间的重叠部分要么不存在，要么就比$P_r$和$P_g$的最小维度还要低至少一个维度，故而测度为0。所谓“重叠部分测度为0”，就是上文所言“不重叠或者重叠部分可忽略”的意思。</p><p>我们就得到了WGAN前作中关于生成器梯度消失的第一个论证：<strong>在（近似）最优判别器下，最小化生成器的loss等价于最小化$P_r$与$P_g$之间的JS散度，而由于$P_r$与$P_g$几乎不可能有不可忽略的重叠，所以无论它们相距多远JS散度都是常数$\log 2$，最终导致生成器的梯度（近似）为0，梯度消失。</strong></p><p>接着作者写了很多公式定理从第二个角度进行论证，但是背后的思想也可以直观地解释：</p><ul><li>首先，$P_r$与$P_g$之间几乎不可能有不可忽略的重叠，所以无论它们之间的“缝隙”多狭小，都肯定存在一个最优分割曲面把它们隔开，最多就是在那些可忽略的重叠处隔不开而已。</li><li>由于判别器作为一个神经网络可以无限拟合这个分隔曲面，所以存在一个最优判别器，对几乎所有真实样本给出概率1，对几乎所有生成样本给出概率0，而那些隔不开的部分就是难以被最优判别器分类的样本，但是它们的测度为0，可忽略。</li><li>最优判别器在真实分布和生成分布的支撑集上给出的概率都是常数（1和0），导致生成器的loss梯度为0，梯度消失。</li></ul><p>有了这些理论分析，原始GAN不稳定的原因就彻底清楚了：判别器训练得太好，生成器梯度消失，生成器loss降不下去；判别器训练得不好，生成器梯度不准，四处乱跑。只有判别器训练得不好不坏才行，但是这个火候又很难把握，甚至在同一轮训练的前后不同阶段这个火候都可能不一样，所以GAN才那么难训练。</p><p>实验辅证如下：</p><blockquote><p>WGAN前作Figure 2。先分别将DCGAN训练1，20，25个epoch，然后固定生成器不动，判别器重新随机初始化从头开始训练，对于第一种形式的生成器loss产生的梯度可以打印出其尺度的变化曲线，可以看到随着判别器的训练，生成器的梯度均迅速衰减。注意y轴是对数坐标轴。</p></blockquote><div class="post-button text-center"><a class="btn" href="/2017/04/29/The-awesome-Wasserstein-GAN/#more" rel="contents">Read more &raquo;</a></div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></section><nav class="pagination"><a class="extend prev" rel="prev" href="/page/13/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/page/15/">15</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/15/"><i class="fa fa-angle-right"></i></a></nav></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview sidebar-panel sidebar-panel-active"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Ewan Li"><p class="site-author-name" itemprop="name">Ewan Li</p><p class="site-description motion-element" itemprop="description">Ewan's IT Blog</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">122</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-tags"><a href="/tags"><span class="site-state-item-count">58</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ewanlee" target="_blank" title="Github"><i class="fa fa-fw fa-globe"></i> Github </a></span><span class="links-of-author-item"><a href="http://weibo.com/3946248928/profile?topnav=1&wvr=6" target="_blank" title="Weibo"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Ewan Li</span></div><div class="powered-by">Powered by <a class="theme-link" href="https://hexo.io">Hexo</a></div><div class="theme-info">Theme - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user">本站访客数</i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span>人次</span> <span class="site-pv"><i class="fa fa-eye">本站总访问量</i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script><script type="text/javascript">_hcwp=window._hcwp||[],_hcwp.push({widget:"Bloggerstream",widget_id:89825,selector:".hc-comment-count",label:"{%COUNT%}"}),function(){if(!("HC_LOAD_INIT"in window)){HC_LOAD_INIT=!0;var t=(navigator.language||navigator.systemLanguage||navigator.userLanguage||"en").substr(0,2).toLowerCase(),e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https":"http")+"://w.hypercomments.com/widget/hc/89825/"+t+"/widget.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n.nextSibling)}}()</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path,searchFunc=function(e,t,a){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var r=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),c=document.getElementById(t),n=document.getElementById(a);c.addEventListener("input",function(){var e=0,t='<ul class="search-result-list">',a=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length>1&&r.forEach(function(r){var c=!1,n=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),o=decodeURIComponent(r.url),i=-1,l=-1,p=-1;if(""!=n&&a.forEach(function(e,t){i=n.indexOf(e),l=s.indexOf(e),(i>=0||l>=0)&&(c=!0,0==t&&(p=l))}),c){e+=1,t+="<li><a href='"+o+"' class='search-result-title'>"+n+"</a>";var h=r.content.trim().replace(/<[^>]+>/g,"");if(p>=0){var u=p-20,d=p+80;u<0&&(u=0),0==u&&(d=50),d>h.length&&(d=h.length);var f=h.substring(u,d);a.forEach(function(e){var t=new RegExp(e,"gi");f=f.replace(t,'<b class="search-keyword">'+e+"</b>")}),t+='<p class="search-result">'+f+"...</p>"}t+="</li>"}}),t+="</ul>",0==e&&(t='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==a&&(t='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),n.innerHTML=t}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("e27VKX5tTklQLCtF7iNMmhcA-gzGzoHsz","nnQn2znNgXXEdK7W2bVJ3bfK")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var r=e[i],s=r.get("url"),l=r.get("time"),c=document.getElementById(s);$(c).find(t).text(l)}for(var i=0;i<n.length;i++){var s=n[i],c=document.getElementById(s),u=$(c).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script></body></html>