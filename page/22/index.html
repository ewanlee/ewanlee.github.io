<!doctype html><html class="theme-next mist use-motion" lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css"><meta name="keywords" content="Hexo, NexT"><link rel="alternate" href="/atom.xml" title="Abracadabra" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0"><meta name="description" content="Ewan&apos;s IT Blog"><meta property="og:type" content="website"><meta property="og:title" content="Abracadabra"><meta property="og:url" content="http://yoursite.com/page/22/index.html"><meta property="og:site_name" content="Abracadabra"><meta property="og:description" content="Ewan&apos;s IT Blog"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Abracadabra"><meta name="twitter:description" content="Ewan&apos;s IT Blog"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://yoursite.com/page/22/"><title>Abracadabra</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?dc405a79ad500922134d14cdf288f646";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-left page-home"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Abracadabra</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Do it yourself</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>Categories</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>About</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>Tags</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>Sitemap</a></li><li class="menu-item menu-item-commonweal"><a href="/404.html" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div><span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><section id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/02/CS231n-Lecture3-note/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracadabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracadabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/2017/03/02/CS231n-Lecture3-note/" itemprop="url">CS231n Lecture3 note</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-02T14:33:34+08:00">2017-03-02 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/03/02/CS231n-Lecture3-note/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2017/03/02/CS231n-Lecture3-note/" itemprop="commentsCount"></span> </a></span><span id="/2017/03/02/CS231n-Lecture3-note/" class="leancloud_visitors" data-flag-title="CS231n Lecture3 note"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="Loss-function"><a href="#Loss-function" class="headerlink" title="Loss function"></a>Loss function</h1><p>Source is <a href="http://cs231n.github.io/linear-classify/" target="_blank" rel="external">here</a>.</p><h2 id="Multiclass-Support-Vector-Machine-loss"><a href="#Multiclass-Support-Vector-Machine-loss" class="headerlink" title="Multiclass Support Vector Machine loss"></a>Multiclass Support Vector Machine loss</h2><p>The SVM loss is set up so that the SVM “wants” the correct class for each image to a have a score higher than the incorrect classes by some fixed margin $\Delta$</p><p>The Multiclass SVM loss for the i-th example is formalized as follows:</p><p><strong>Example</strong></p><p>$s = [13, -7, 11]$ and $\Delta = 10$, then,</p><p>$$L_i = \max(0, -7 - 13 + 10) + \max(0, 11 - 13 + 10)$$</p><p>In summary, the SVM loss function wants the score of the correct class $y_i$ to be larger than the incorrect class scores by at least by $\Delta$ (delta). If this is not the case, we will accumulate loss.</p><p>Note that $f(x_i; W) = W x_i$, so we can also rewrite the loss function in this equivalent form:</p><p>$$L_i = \sum_{j\neq y_i} \max(0, w_j^T x_i - w_{y_i}^T x_i + \Delta)$$</p><p>A last piece of terminology we’ll mention before we finish with this section is that the threshold at zero $\max(0,−)$ function is often called the <strong>hinge loss</strong>. You’ll sometimes hear about people instead using the squared hinge loss SVM (or L2-SVM), which uses the form $\max(0,−)^2$ that penalizes violated margins more strongly (quadratically instead of linearly). The unsquared version is more standard, but in some datasets the squared hinge loss can work better. This can be determined during cross-validation.</p><p>The follow image shows the motivation of the SVM loss function”</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/03/margin.jpg" alt="margin"></p><h3 id="Regularization"><a href="#Regularization" class="headerlink" title="Regularization"></a>Regularization</h3><p>There is one bug with the loss function we presented above. Suppose that we have a dataset and a set of parameters <strong>W</strong> that correctly classify every example (i.e. all scores are so that all the margins are met, and $L_i=0$ for all i). The issue is that this set of <strong>W</strong> is not necessarily unique: there might be many similar <strong>W</strong> that correctly classify the examples. One easy way to see this is that if some parameters <strong>W</strong> correctly classify all examples (so loss is zero for each example), then any multiple of these parameters $\lambda W$ where $\lambda &gt; 1$ will also give zero loss because this transformation uniformly stretches all score magnitudes and hence also their absolute differences. For example, if the difference in scores between a correct class and a nearest incorrect class was 15, then multiplying all elements of <strong>W</strong> by 2 would make the new difference 30.</p><p>We can avoid this by extending the loss function with a <strong>regularization penalty</strong> $R(W)$. The most common regularization penalty is the <strong>L2</strong> norm:</p><p>$$R(W) = \sum_k\sum_l W_{k,l}^2$$</p><p>That is, the full Multiclass SVM loss becomes:</p><p>$$L = \underbrace{ \frac{1}{N} \sum_i L_i }_\text{data loss} + \underbrace{ \lambda R(W) }_\text{regularization loss} \\\\$$</p><p>Or expanding this out in its full form:</p><p>$$L = \frac{1}{N} \sum_i \sum_{j\neq y_i} \left[ \max(0, f(x_i; W)_j - f(x_i; W)_{y_i} + \Delta) \right] + \lambda \sum_k\sum_l W_{k,l}^2$$</p><p>Including the L2 penalty leads to the appealing <strong>max margin</strong> property in SVMs (See <a href="http://cs229.stanford.edu/notes/cs229-notes3.pdf" target="_blank" rel="external">CS229</a> lecture notes for full details if you are interested).</p><p>The most appealing property is that penalizing large weights tends to improve generalization, because it means that no input dimension can have a very large influence on the scores all by itself. For example, suppose that we have some input vector $x=[1,1,1,1]$ and two weight vectors $w_1=[1,0,0,0]$, $w_2=[0.25,0.25,0.25,0.25]$. Then $w^T_1x=w^T_2x=1$ so both weight vectors lead to the same dot product, but the <strong>L2</strong> penalty of $w_1$ is 1.0 while the <strong>L2</strong> penalty of $w_2$ is only 0.25. Therefore, according to the <strong>L2</strong> penalty the weight vector $w_2$ would be preferred since it achieves a lower regularization loss. Intuitively, this is because the weights in $w_2$ are smaller and more diffuse. Since the <strong>L2</strong> penalty prefers smaller and more diffuse weight vectors, the final classifier is encouraged to take into account all input dimensions to small amounts rather than a few input dimensions and very strongly. As we will see later in the class, this effect can improve the generalization performance of the classifiers on test images and lead to less <em>overfitting</em>.</p><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">L_i</span><span class="params">(x, y, W)</span>:</span></div><div class="line">  <span class="string">"""</span></div><div class="line">  unvectorized version. Compute the multiclass svm loss for a single example (x,y)</div><div class="line">  - x is a column vector representing an image (e.g. 3073 x 1 in CIFAR-10)</div><div class="line">    with an appended bias dimension in the 3073-rd position (i.e. bias trick)</div><div class="line">  - y is an integer giving index of correct class (e.g. between 0 and 9 in CIFAR-10)</div><div class="line">  - W is the weight matrix (e.g. 10 x 3073 in CIFAR-10)</div><div class="line">  """</div><div class="line">  delta = <span class="number">1.0</span> <span class="comment"># see notes about delta later in this section</span></div><div class="line">  scores = W.dot(x) <span class="comment"># scores becomes of size 10 x 1, the scores for each class</span></div><div class="line">  correct_class_score = scores[y]</div><div class="line">  D = W.shape[<span class="number">0</span>] <span class="comment"># number of classes, e.g. 10</span></div><div class="line">  loss_i = <span class="number">0.0</span></div><div class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> xrange(D): <span class="comment"># iterate over all wrong classes</span></div><div class="line">    <span class="keyword">if</span> j == y:</div><div class="line">      <span class="comment"># skip for the true class to only loop over incorrect classes</span></div><div class="line">      <span class="keyword">continue</span></div><div class="line">    <span class="comment"># accumulate loss for the i-th example</span></div><div class="line">    loss_i += max(<span class="number">0</span>, scores[j] - correct_class_score + delta)</div><div class="line">  <span class="keyword">return</span> loss_i</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">L_i_vectorized</span><span class="params">(x, y, W)</span>:</span></div><div class="line">  <span class="string">"""</span></div><div class="line">  A faster half-vectorized implementation. half-vectorized</div><div class="line">  refers to the fact that for a single example the implementation contains</div><div class="line">  no for loops, but there is still one loop over the examples (outside this function)</div><div class="line">  """</div><div class="line">  delta = <span class="number">1.0</span></div><div class="line">  scores = W.dot(x)</div><div class="line">  <span class="comment"># compute the margins for all classes in one vector operation</span></div><div class="line">  margins = np.maximum(<span class="number">0</span>, scores - scores[y] + delta)</div><div class="line">  <span class="comment"># on y-th position scores[y] - scores[y] canceled and gave delta. We want</span></div><div class="line">  <span class="comment"># to ignore the y-th position and only consider margin on max wrong class</span></div><div class="line">  margins[y] = <span class="number">0</span></div><div class="line">  loss_i = np.sum(margins)</div><div class="line">  <span class="keyword">return</span> loss_i</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">L</span><span class="params">(X, y, W)</span>:</span></div><div class="line">  <span class="string">"""</span></div><div class="line">  fully-vectorized implementation :</div><div class="line">  - X holds all the training examples as columns (e.g. 3073 x 50,000 in CIFAR-10)</div><div class="line">  - y is array of integers specifying correct class (e.g. 50,000-D array)</div><div class="line">  - W are weights (e.g. 10 x 3073)</div><div class="line">  """</div><div class="line">  <span class="comment"># evaluate loss over all examples in X without using any for loops</span></div><div class="line">  <span class="comment"># left as exercise to reader in the assignment</span></div></pre></td></tr></table></figure><h3 id="Practice-Considerations"><a href="#Practice-Considerations" class="headerlink" title="Practice Considerations"></a>Practice Considerations</h3><h4 id="Setting-Delta"><a href="#Setting-Delta" class="headerlink" title="Setting Delta"></a>Setting Delta</h4><p>Note that we brushed over the hyperparameter $\Delta$ and its setting. What value should it be set to, and do we have to cross-validate it? It turns out that this hyperparameter can safely be set to $\Delta = 1.0$ in all cases. The hyperparameters $\Delta$ and $\lambda$ seem like two different hyperparameters, but in fact they both control the same tradeoff: The tradeoff between the data loss and the regularization loss in the objective. The key to understanding this is that the magnitude of the weights <strong>W</strong> has direct effect on the scores (and hence also their differences): As we shrink all values inside <strong>W</strong> the score differences will become lower, and as we scale up the weights the score differences will all become higher. Therefore, the exact value of the margin between the scores (e.g. $\Delta = 10$, or$\Delta = 100$) is in some sense meaningless because the weights can shrink or stretch the differences arbitrarily. Hence, the only real tradeoff is how large we allow the weights to grow (through the regularization strength $\lambda$).</p><h2 id="Softmax-classifier"><a href="#Softmax-classifier" class="headerlink" title="Softmax classifier"></a>Softmax classifier</h2><p>In the Softmax classifier, the function mapping $f(x_i; W) = W x_i$ stays unchanged, but we now interpret these scores as the unnormalized log probabilities for each class and replace the <em>hinge loss</em> with a <strong>cross-entropy loss</strong> that has the form:</p><p>$$L_i = -\log\left(\frac{e^{f_{y_i}}}{ \sum_j e^{f_j} }\right) \hspace{0.5in} \text{or equivalently} \hspace{0.5in} L_i = -f_{y_i} + \log\sum_j e^{f_j}$$</p><p>The function $f_j(z) = \frac{e^{z_j}}{\sum_k e^{z_k}}$ is called the <strong>softmax function</strong>.</p><h3 id="Information-theory-view"><a href="#Information-theory-view" class="headerlink" title="Information theory view"></a>Information theory view</h3><p>The <em>cross-entropy</em> between a “true” distribution $p$ and an estimated distribution $q$ is defined as:<br>$$<br>H(p,q) = - \sum_x p(x) \log q(x)<br>$$<br>The Softmax classifier is hence minimizing the cross-entropy between the estimated class probabilities ( $q = e^{f_{y_i}} / \sum_j e^{f_j}$ as seen above) and the “true” distribution, which in this interpretation is the distribution where all probability mass is on the correct class (i.e. $p = [0, \ldots 1, \ldots, 0]$ contains a single 1 at the $y_i$ -th position.).</p><p>Moreover, since the cross-entropy can be written in terms of entropy and the Kullback-Leibler divergence as $H(p,q) = H(p) + D_{KL}(p||q)$, and the entropy of the delta function $p$ is zero, this is also equivalent to minimizing the <strong>KL</strong> divergence between the two distributions (a measure of distance). In other words, the cross-entropy objective <em>wants</em> the predicted distribution to have all of its mass on the correct answer.</p><h3 id="Probabilistic-interpretation"><a href="#Probabilistic-interpretation" class="headerlink" title="Probabilistic interpretation"></a>Probabilistic interpretation</h3><p>$$P(y_i \mid x_i; W) = \frac{e^{f_{y_i}}}{\sum_j e^{f_j} }$$</p><p>can be interpreted as the (normalized) probability assigned to the correct label $y_i$given the image $x_i$ and parameterized by <strong>W</strong>. To see this, remember that the Softmax classifier interprets the scores inside the output vector $f$ as the unnormalized log probabilities. Exponentiating these quantities therefore gives the (unnormalized) probabilities, and the division performs the normalization so that the probabilities sum to one. In the probabilistic interpretation, we are therefore minimizing the negative log likelihood of the correct class, which can be interpreted as performing <em>Maximum Likelihood Estimation</em> (MLE). A nice feature of this view is that we can now also interpret the regularization term $R(W)$ in the full loss function as coming from a Gaussian prior over the weight matrix <strong>W</strong>, where instead of MLE we are performing the <em>Maximum a posteriori</em> (MAP) estimation.</p><h3 id="Numeric-stability"><a href="#Numeric-stability" class="headerlink" title="Numeric stability"></a>Numeric stability</h3><p>When you’re writing code for computing the Softmax function in practice, the intermediate term $e^{f_{y_i}}$ and $\sum_j e^{f_j}$ may be very large due to the exponentials. Dividing large numbers can be numerically unstable, so it is important to use a normalization trick. Notice that if we multiply the top and bottom of the fraction by a constant <strong>C</strong> and push it into the sum, we get the following (mathematically equivalent) expression:</p><p>$$\frac{e^{f_{y_i}}}{\sum_j e^{f_j}}= \frac{Ce^{f_{y_i}}}{C\sum_j e^{f_j}}= \frac{e^{f_{y_i} + \log C}}{\sum_j e^{f_j + \log C}}$$</p><p>We are free to choose the value of <strong>C</strong>. This will not change any of the results, but we can use this value to improve the numerical stability of the computation. A common choice for <strong>C</strong> is to set $\log C = -\max_j f_j$. This simply states that we should shift the values inside the vector ff so that the highest value is zero. In code:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">f = np.array([<span class="number">123</span>, <span class="number">456</span>, <span class="number">789</span>]) <span class="comment"># example with 3 classes and each having large scores</span></div><div class="line">p = np.exp(f) / np.sum(np.exp(f)) <span class="comment"># Bad: Numeric problem, potential blowup</span></div><div class="line"></div><div class="line"><span class="comment"># instead: first shift the values of f so that the highest number is 0:</span></div><div class="line">f -= np.max(f) <span class="comment"># f becomes [-666, -333, 0]</span></div><div class="line">p = np.exp(f) / np.sum(np.exp(f)) <span class="comment"># safe to do, gives the correct answer</span></div></pre></td></tr></table></figure><h3 id="Some-tricks"><a href="#Some-tricks" class="headerlink" title="Some tricks"></a>Some tricks</h3><p>How peaky or diffuse these probabilities are depends directly on the regularization strength $\lambda$ - which you are in charge of as input to the system. For example, suppose that the unnormalized log-probabilities for some three classes come out to be [1, -2, 0]. The softmax function would then compute:</p><p>$$[1, -2, 0] \rightarrow [e^1, e^{-2}, e^0] = [2.71, 0.14, 1] \rightarrow [0.7, 0.04, 0.26]$$</p><p>Where the steps taken are to exponentiate and normalize to sum to one. Now, if the regularization strength $\lambda$ was higher, the weights <strong>W</strong> would be penalized more and this would lead to smaller weights. For example, suppose that the weights became one half smaller ([0.5, -1, 0]). The softmax would now compute:</p><p>$$[0.5, -1, 0] \rightarrow [e^{0.5}, e^{-1}, e^0] = [1.65, 0.37, 1] \rightarrow [0.55, 0.12, 0.33]$$</p><p>where the probabilites are now more diffuse.</p><h3 id="Futher-Reading"><a href="#Futher-Reading" class="headerlink" title="Futher Reading"></a>Futher Reading</h3><ul><li><a href="http://arxiv.org/abs/1306.0239" target="_blank" rel="external">Deep Learning using Linear Support Vector Machines</a> from Charlie Tang 2013 presents some results claiming that the L2SVM outperforms Softmax.</li></ul><h1 id="Optimization"><a href="#Optimization" class="headerlink" title="Optimization"></a>Optimization</h1><h2 id="Strategy-1-A-first-very-bad-idea-solution-Random-search"><a href="#Strategy-1-A-first-very-bad-idea-solution-Random-search" class="headerlink" title="Strategy #1: A first very bad idea solution: Random search"></a>Strategy #1: A first very bad idea solution: Random search</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># assume X_train is the data where each column is an example (e.g. 3073 x 50,000)</span></div><div class="line"><span class="comment"># assume Y_train are the labels (e.g. 1D array of 50,000)</span></div><div class="line"><span class="comment"># assume the function L evaluates the loss function</span></div><div class="line"></div><div class="line">bestloss = float(<span class="string">"inf"</span>) <span class="comment"># Python assigns the highest possible float value</span></div><div class="line"><span class="keyword">for</span> num <span class="keyword">in</span> xrange(<span class="number">1000</span>):</div><div class="line">  W = np.random.randn(<span class="number">10</span>, <span class="number">3073</span>) * <span class="number">0.0001</span> <span class="comment"># generate random parameters</span></div><div class="line">  loss = L(X_train, Y_train, W) <span class="comment"># get the loss over the entire training set</span></div><div class="line">  <span class="keyword">if</span> loss &lt; bestloss: <span class="comment"># keep track of the best solution</span></div><div class="line">    bestloss = loss</div><div class="line">    bestW = W</div><div class="line">  <span class="keyword">print</span> <span class="string">'in attempt %d the loss was %f, best %f'</span> % (num, loss, bestloss)</div><div class="line"></div><div class="line"><span class="comment"># prints:</span></div><div class="line"><span class="comment"># in attempt 0 the loss was 9.401632, best 9.401632</span></div><div class="line"><span class="comment"># in attempt 1 the loss was 8.959668, best 8.959668</span></div><div class="line"><span class="comment"># in attempt 2 the loss was 9.044034, best 8.959668</span></div><div class="line"><span class="comment"># in attempt 3 the loss was 9.278948, best 8.959668</span></div><div class="line"><span class="comment"># in attempt 4 the loss was 8.857370, best 8.857370</span></div><div class="line"><span class="comment"># in attempt 5 the loss was 8.943151, best 8.857370</span></div><div class="line"><span class="comment"># in attempt 6 the loss was 8.605604, best 8.605604</span></div><div class="line"><span class="comment"># ... (trunctated: continues for 1000 lines)</span></div></pre></td></tr></table></figure><p>We can take the best weights <strong>W</strong> found by this search and try it out on the test set:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Assume X_test is [3073 x 10000], Y_test [10000 x 1]</span></div><div class="line">scores = Wbest.dot(Xte_cols) <span class="comment"># 10 x 10000, the class scores for all test examples</span></div><div class="line"><span class="comment"># find the index with max score in each column (the predicted class)</span></div><div class="line">Yte_predict = np.argmax(scores, axis = <span class="number">0</span>)</div><div class="line"><span class="comment"># and calculate accuracy (fraction of predictions that are correct)</span></div><div class="line">np.mean(Yte_predict == Yte)</div><div class="line"><span class="comment"># returns 0.1555</span></div></pre></td></tr></table></figure><p>With the best <strong>W</strong> this gives an accuracy of about <strong>15.5%</strong>.</p><p><strong>Core idea: iterative refinement</strong>. Of course, it turns out that we can do much better. The core idea is that finding the best set of weights <strong>W</strong> is a very difficult or even impossible problem (especially once <strong>W</strong> contains weights for entire complex neural networks), but the problem of refining a specific set of weights <strong>W</strong> to be slightly better is significantly less difficult. In other words, our approach will be to start with a random <strong>W</strong> and then iteratively refine it, making it slightly better each time.</p><blockquote><p>Our strategy will be to start with random weights and iteratively refine them over time to get lower loss</p></blockquote><h2 id="Strategy-2-Random-Local-Search"><a href="#Strategy-2-Random-Local-Search" class="headerlink" title="Strategy #2: Random Local Search"></a>Strategy #2: Random Local Search</h2><p>Concretely, we will start out with a random WW, generate random perturbations $\delta W$ to it and if the loss at the perturbed $W + \delta W$ is lower, we will perform an update. The code for this procedure is as follows:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">W = np.random.randn(<span class="number">10</span>, <span class="number">3073</span>) * <span class="number">0.001</span> <span class="comment"># generate random starting W</span></div><div class="line">bestloss = float(<span class="string">"inf"</span>)</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1000</span>):</div><div class="line">  step_size = <span class="number">0.0001</span></div><div class="line">  Wtry = W + np.random.randn(<span class="number">10</span>, <span class="number">3073</span>) * step_size</div><div class="line">  loss = L(Xtr_cols, Ytr, Wtry)</div><div class="line">  <span class="keyword">if</span> loss &lt; bestloss:</div><div class="line">    W = Wtry</div><div class="line">    bestloss = loss</div><div class="line">  <span class="keyword">print</span> <span class="string">'iter %d loss is %f'</span> % (i, bestloss)</div></pre></td></tr></table></figure><p>This approach achieves test set classification accuracy of <strong>21.4%</strong>.</p><h2 id="Strategy-3-Following-the-Gradient"><a href="#Strategy-3-Following-the-Gradient" class="headerlink" title="Strategy #3: Following the Gradient"></a>Strategy #3: Following the Gradient</h2><p>The mathematical expression for the derivative of a 1-D function with respect its input is:<br>$$<br>\frac{df(x)}{dx} = \lim_{h\ \to 0} \frac{f(x + h) - f(x)}{h}<br>$$<br>When the functions of interest take a vector of numbers instead of a single number, we call the derivatives <strong>partial derivatives</strong>, and the gradient is simply the vector of partial derivatives in each dimension.</p><h3 id="Computing-the-gradient"><a href="#Computing-the-gradient" class="headerlink" title="Computing the gradient"></a>Computing the gradient</h3><p>There are two ways to compute the gradient: A slow, approximate but easy way (<strong>numerical gradient</strong>), and a fast, exact but more error-prone way that requires calculus (<strong>analytic gradient</strong>). We will now present both.</p><h4 id="Computing-the-gradient-numerically-with-finite-differences"><a href="#Computing-the-gradient-numerically-with-finite-differences" class="headerlink" title="Computing the gradient numerically with finite differences"></a>Computing the gradient numerically with finite differences</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">eval_numerical_gradient</span><span class="params">(f, x)</span>:</span></div><div class="line">  <span class="string">""" </span></div><div class="line">  a naive implementation of numerical gradient of f at x </div><div class="line">  - f should be a function that takes a single argument</div><div class="line">  - x is the point (numpy array) to evaluate the gradient at</div><div class="line">  """ </div><div class="line"></div><div class="line">  fx = f(x) <span class="comment"># evaluate function value at original point</span></div><div class="line">  grad = np.zeros(x.shape)</div><div class="line">  h = <span class="number">0.00001</span></div><div class="line"></div><div class="line">  <span class="comment"># iterate over all indexes in x</span></div><div class="line">  it = np.nditer(x, flags=[<span class="string">'multi_index'</span>], op_flags=[<span class="string">'readwrite'</span>])</div><div class="line">  <span class="keyword">while</span> <span class="keyword">not</span> it.finished:</div><div class="line"></div><div class="line">    <span class="comment"># evaluate function at x+h</span></div><div class="line">    ix = it.multi_index</div><div class="line">    old_value = x[ix]</div><div class="line">    x[ix] = old_value + h <span class="comment"># increment by h</span></div><div class="line">    fxh = f(x) <span class="comment"># evalute f(x + h)</span></div><div class="line">    x[ix] = old_value <span class="comment"># restore to previous value (very important!)</span></div><div class="line"></div><div class="line">    <span class="comment"># compute the partial derivative</span></div><div class="line">    grad[ix] = (fxh - fx) / h <span class="comment"># the slope</span></div><div class="line">    it.iternext() <span class="comment"># step to next dimension</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> grad</div></pre></td></tr></table></figure><p><strong>Practical considerations</strong>.</p><p>Note that in the mathematical formulation the gradient is defined in the limit as <strong>h</strong> goes towards zero, but in practice it is often sufficient to use a very small value (such as 1e-5 as seen in the example). Ideally, you want to use the smallest step size that does not lead to numerical issues. Additionally, in practice it often works better to compute the numeric gradient using the <strong>centered difference formula</strong>:<br>$$<br>[f(x+h) - f(x-h)] / 2 h<br>$$<br>See <a href="http://en.wikipedia.org/wiki/Numerical_differentiation" target="_blank" rel="external">wiki</a> for details.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># to use the generic code above we want a function that takes a single argument</span></div><div class="line"><span class="comment"># (the weights in our case) so we close over X_train and Y_train</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">CIFAR10_loss_fun</span><span class="params">(W)</span>:</span></div><div class="line">  <span class="keyword">return</span> L(X_train, Y_train, W)</div><div class="line"></div><div class="line">W = np.random.rand(<span class="number">10</span>, <span class="number">3073</span>) * <span class="number">0.001</span> <span class="comment"># random weight vector</span></div><div class="line">df = eval_numerical_gradient(CIFAR10_loss_fun, W) <span class="comment"># get the gradient</span></div></pre></td></tr></table></figure><p>Then we can use to make an update:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">loss_original = CIFAR10_loss_fun(W) <span class="comment"># the original loss</span></div><div class="line"><span class="keyword">print</span> <span class="string">'original loss: %f'</span> % (loss_original, )</div><div class="line"></div><div class="line"><span class="comment"># lets see the effect of multiple step sizes</span></div><div class="line"><span class="keyword">for</span> step_size_log <span class="keyword">in</span> [<span class="number">-10</span>, <span class="number">-9</span>, <span class="number">-8</span>, <span class="number">-7</span>, <span class="number">-6</span>, <span class="number">-5</span>,<span class="number">-4</span>,<span class="number">-3</span>,<span class="number">-2</span>,<span class="number">-1</span>]:</div><div class="line">  step_size = <span class="number">10</span> ** step_size_log</div><div class="line">  W_new = W - step_size * df <span class="comment"># new position in the weight space</span></div><div class="line">  loss_new = CIFAR10_loss_fun(W_new)</div><div class="line">  <span class="keyword">print</span> <span class="string">'for step size %f new loss: %f'</span> % (step_size, loss_new)</div><div class="line"></div><div class="line"><span class="comment"># prints:</span></div><div class="line"><span class="comment"># original loss: 2.200718</span></div><div class="line"><span class="comment"># for step size 1.000000e-10 new loss: 2.200652</span></div><div class="line"><span class="comment"># for step size 1.000000e-09 new loss: 2.200057</span></div><div class="line"><span class="comment"># for step size 1.000000e-08 new loss: 2.194116</span></div><div class="line"><span class="comment"># for step size 1.000000e-07 new loss: 2.135493</span></div><div class="line"><span class="comment"># for step size 1.000000e-06 new loss: 1.647802</span></div><div class="line"><span class="comment"># for step size 1.000000e-05 new loss: 2.844355</span></div><div class="line"><span class="comment"># for step size 1.000000e-04 new loss: 25.558142</span></div><div class="line"><span class="comment"># for step size 1.000000e-03 new loss: 254.086573</span></div><div class="line"><span class="comment"># for step size 1.000000e-02 new loss: 2539.370888</span></div><div class="line"><span class="comment"># for step size 1.000000e-01 new loss: 25392.214036</span></div></pre></td></tr></table></figure><p><strong>Effect of step size</strong></p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/03/stepsize.jpg" alt="margin"></p><h4 id="Computing-the-gradient-analytically-with-Calculus"><a href="#Computing-the-gradient-analytically-with-Calculus" class="headerlink" title="Computing the gradient analytically with Calculus"></a>Computing the gradient analytically with Calculus</h4><p>However, unlike the numerical gradient it can be more error prone to implement, which is why in practice it is very common to compute the analytic gradient and compare it to the numerical gradient to check the correctness of your implementation. This is called a <strong>gradient check</strong>.</p><p>Lets use the example of the SVM loss function for a single datapoint:<br>$$<br>L_i = \sum_{j\neq y_i} \left[ \max(0, w_j^Tx_i - w_{y_i}^Tx_i + \Delta) \right]<br>$$</p><p>$$<br>\nabla_{w_{y_i}} L_i = - \left( \sum_{j\neq y_i} \mathbb{1}(w_j^Tx_i - w_{y_i}^Tx_i + \Delta &gt; 0) \right) x_i<br>$$</p><p>when you’re implementing this in code you’d simply count the number of classes that didn’t meet the desired margin (and hence contributed to the loss function) and then the data vector $x_i$ scaled by this number is the gradient.<br>$$<br>\nabla_{w_j} L_i = \mathbb{1}(w_j^Tx_i - w_{y_i}^Tx_i + \Delta &gt; 0) x_i<br>$$</p></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/03/cs231n-Assignment-1-svm/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracadabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracadabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/2017/03/03/cs231n-Assignment-1-svm/" itemprop="url">cs231n Assignment#1 svm</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-03T18:55:44+08:00">2017-03-03 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/03/03/cs231n-Assignment-1-svm/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2017/03/03/cs231n-Assignment-1-svm/" itemprop="commentsCount"></span> </a></span><span id="/2017/03/03/cs231n-Assignment-1-svm/" class="leancloud_visitors" data-flag-title="cs231n Assignment#1 svm"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="Multiclass-Support-Vector-Machine-exercise"><a href="#Multiclass-Support-Vector-Machine-exercise" class="headerlink" title="Multiclass Support Vector Machine exercise"></a>Multiclass Support Vector Machine exercise</h1><p><em>Complete and hand in this completed worksheet (including its outputs and any supporting code outside of the worksheet) with your assignment submission. For more details see the <a href="http://vision.stanford.edu/teaching/cs231n/assignments.html" target="_blank" rel="external">assignments page</a> on the course website.</em></p><p>In this exercise you will:<br>​</p><ul><li>implement a fully-vectorized <strong>loss function</strong> for the SVM</li><li>implement the fully-vectorized expression for its <strong>analytic gradient</strong></li><li><strong>check your implementation</strong> using numerical gradient</li><li>use a validation set to <strong>tune the learning rate and regularization</strong> strength</li><li><strong>optimize</strong> the loss function with <strong>SGD</strong></li><li><strong>visualize</strong> the final learned weights</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Run some setup code for this notebook.</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> random</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> cs231n.data_utils <span class="keyword">import</span> load_CIFAR10</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"></div><div class="line"><span class="comment"># This is a bit of magic to make matplotlib figures appear inline in the</span></div><div class="line"><span class="comment"># notebook rather than in a new window.</span></div><div class="line">%matplotlib inline</div><div class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">10.0</span>, <span class="number">8.0</span>) <span class="comment"># set default size of plots</span></div><div class="line">plt.rcParams[<span class="string">'image.interpolation'</span>] = <span class="string">'nearest'</span></div><div class="line">plt.rcParams[<span class="string">'image.cmap'</span>] = <span class="string">'gray'</span></div><div class="line"></div><div class="line"><span class="comment"># Some more magic so that the notebook will reload external python modules;</span></div><div class="line"><span class="comment"># see http://stackoverflow.com/questions/1907993/autoreload-of-modules-in-ipython</span></div><div class="line">%load_ext autoreload</div><div class="line">%autoreload <span class="number">2</span></div></pre></td></tr></table></figure><h2 id="CIFAR-10-Data-Loading-and-Preprocessing"><a href="#CIFAR-10-Data-Loading-and-Preprocessing" class="headerlink" title="CIFAR-10 Data Loading and Preprocessing"></a>CIFAR-10 Data Loading and Preprocessing</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Load the raw CIFAR-10 data.</span></div><div class="line">cifar10_dir = <span class="string">'cs231n/datasets/cifar-10-batches-py'</span></div><div class="line">X_train, y_train, X_test, y_test = load_CIFAR10(cifar10_dir)</div><div class="line"></div><div class="line"><span class="comment"># As a sanity check, we print out the size of the training and test data.</span></div><div class="line"><span class="keyword">print</span> <span class="string">'Training data shape: '</span>, X_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Training labels shape: '</span>, y_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test data shape: '</span>, X_test.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test labels shape: '</span>, y_test.shape</div></pre></td></tr></table></figure><pre><code>Training data shape:  (50000L, 32L, 32L, 3L)
Training labels shape:  (50000L,)
Test data shape:  (10000L, 32L, 32L, 3L)
Test labels shape:  (10000L,)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Visualize some examples from the dataset.</span></div><div class="line"><span class="comment"># We show a few examples of training images from each class.</span></div><div class="line">classes = [<span class="string">'plane'</span>, <span class="string">'car'</span>, <span class="string">'bird'</span>, <span class="string">'cat'</span>, <span class="string">'deer'</span>, <span class="string">'dog'</span>, <span class="string">'frog'</span>, <span class="string">'horse'</span>, <span class="string">'ship'</span>, <span class="string">'truck'</span>]</div><div class="line">num_classes = len(classes)</div><div class="line">samples_per_class = <span class="number">7</span></div><div class="line"><span class="keyword">for</span> y, cls <span class="keyword">in</span> enumerate(classes):</div><div class="line">    idxs = np.flatnonzero(y_train == y)</div><div class="line">    idxs = np.random.choice(idxs, samples_per_class, replace=<span class="keyword">False</span>)</div><div class="line">    <span class="keyword">for</span> i, idx <span class="keyword">in</span> enumerate(idxs):</div><div class="line">        plt_idx = i * num_classes + y + <span class="number">1</span></div><div class="line">        plt.subplot(samples_per_class, num_classes, plt_idx)</div><div class="line">        plt.imshow(X_train[idx].astype(<span class="string">'uint8'</span>))</div><div class="line">        plt.axis(<span class="string">'off'</span>)</div><div class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:</div><div class="line">            plt.title(cls)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/svm/sample.png" alt="sample"></p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">?np.random.choice</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Split the data into train, val, and test sets. In addition we will</span></div><div class="line"><span class="comment"># create a small development set as a subset of the training data;</span></div><div class="line"><span class="comment"># we can use this for development so our code runs faster.</span></div><div class="line">num_training = <span class="number">49000</span></div><div class="line">num_validation = <span class="number">1000</span></div><div class="line">num_test = <span class="number">1000</span></div><div class="line">num_dev = <span class="number">500</span></div><div class="line"></div><div class="line"><span class="comment"># Our validation set will be num_validation points from the original</span></div><div class="line"><span class="comment"># training set.</span></div><div class="line">mask = range(num_training, num_training + num_validation)</div><div class="line">X_val = X_train[mask]</div><div class="line">y_val = y_train[mask]</div><div class="line"></div><div class="line"><span class="comment"># Our training set will be the first num_train points from the original</span></div><div class="line"><span class="comment"># training set.</span></div><div class="line">mask = range(num_training)</div><div class="line">X_train = X_train[mask]</div><div class="line">y_train = y_train[mask]</div><div class="line"></div><div class="line"><span class="comment"># We will also make a development set, which is a small subset of</span></div><div class="line"><span class="comment"># the training set.</span></div><div class="line">mask = np.random.choice(num_training, num_dev, replace=<span class="keyword">False</span>)</div><div class="line">X_dev = X_train[mask]</div><div class="line">y_dev = y_train[mask]</div><div class="line"></div><div class="line"><span class="comment"># We use the first num_test points of the original test set as our</span></div><div class="line"><span class="comment"># test set.</span></div><div class="line">mask = range(num_test)</div><div class="line">X_test = X_test[mask]</div><div class="line">y_test = y_test[mask]</div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">'Train data shape: '</span>, X_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Train labels shape: '</span>, y_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Validation data shape: '</span>, X_val.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Validation labels shape: '</span>, y_val.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test data shape: '</span>, X_test.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test labels shape: '</span>, y_test.shape</div></pre></td></tr></table></figure><pre><code>Train data shape:  (49000L, 32L, 32L, 3L)
Train labels shape:  (49000L,)
Validation data shape:  (1000L, 32L, 32L, 3L)
Validation labels shape:  (1000L,)
Test data shape:  (1000L, 32L, 32L, 3L)
Test labels shape:  (1000L,)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Preprocessing: reshape the image data into rows</span></div><div class="line">X_train = np.reshape(X_train, (X_train.shape[<span class="number">0</span>], <span class="number">-1</span>))</div><div class="line">X_val = np.reshape(X_val, (X_val.shape[<span class="number">0</span>], <span class="number">-1</span>))</div><div class="line">X_test = np.reshape(X_test, (X_test.shape[<span class="number">0</span>], <span class="number">-1</span>))</div><div class="line">X_dev = np.reshape(X_dev, (X_dev.shape[<span class="number">0</span>], <span class="number">-1</span>))</div><div class="line"></div><div class="line"><span class="comment"># As a sanity check, print out the shapes of the data</span></div><div class="line"><span class="keyword">print</span> <span class="string">'Training data shape: '</span>, X_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Validation data shape: '</span>, X_val.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test data shape: '</span>, X_test.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'dev data shape: '</span>, X_dev.shape</div></pre></td></tr></table></figure><pre><code>Training data shape:  (49000L, 3072L)
Validation data shape:  (1000L, 3072L)
Test data shape:  (1000L, 3072L)
dev data shape:  (500L, 3072L)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Preprocessing: subtract the mean image</span></div><div class="line"><span class="comment"># first: compute the image mean based on the training data</span></div><div class="line">mean_image = np.mean(X_train, axis=<span class="number">0</span>)</div><div class="line"><span class="keyword">print</span> mean_image[:<span class="number">10</span>] <span class="comment"># print a few of the elements</span></div><div class="line">plt.figure(figsize=(<span class="number">4</span>,<span class="number">4</span>))</div><div class="line">plt.imshow(mean_image.reshape((<span class="number">32</span>,<span class="number">32</span>,<span class="number">3</span>)).astype(<span class="string">'uint8'</span>)) <span class="comment"># visualize the mean image</span></div><div class="line">plt.show()</div></pre></td></tr></table></figure><pre><code>[ 130.64189796  135.98173469  132.47391837  130.05569388  135.34804082
  131.75402041  130.96055102  136.14328571  132.47636735  131.48467347]
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/svm/mean.png" alt="mean"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># second: subtract the mean image from train and test data</span></div><div class="line">X_train -= mean_image</div><div class="line">X_val -= mean_image</div><div class="line">X_test -= mean_image</div><div class="line">X_dev -= mean_image</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># third: append (at the last) the bias dimension of ones (i.e. bias trick) so that our SVM</span></div><div class="line"><span class="comment"># only has to worry about optimizing a single weight matrix W.</span></div><div class="line">X_train = np.hstack([X_train, np.ones((X_train.shape[<span class="number">0</span>], <span class="number">1</span>))])</div><div class="line">X_val = np.hstack([X_val, np.ones((X_val.shape[<span class="number">0</span>], <span class="number">1</span>))])</div><div class="line">X_test = np.hstack([X_test, np.ones((X_test.shape[<span class="number">0</span>], <span class="number">1</span>))])</div><div class="line">X_dev = np.hstack([X_dev, np.ones((X_dev.shape[<span class="number">0</span>], <span class="number">1</span>))])</div><div class="line"></div><div class="line"><span class="keyword">print</span> X_train.shape, X_val.shape, X_test.shape, X_dev.shape</div></pre></td></tr></table></figure><pre><code>(49000L, 3073L) (1000L, 3073L) (1000L, 3073L) (500L, 3073L)
</code></pre><p>​</p><h2 id="SVM-Classifier"><a href="#SVM-Classifier" class="headerlink" title="SVM Classifier"></a>SVM Classifier</h2><p>Your code for this section will all be written inside <strong>cs231n/classifiers/linear_svm.py</strong>.</p><p>As you can see, we have prefilled the function <code>compute_loss_naive</code> which uses for loops to evaluate the multiclass SVM loss function.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Evaluate the naive implementation of the loss we provided for you:</span></div><div class="line"><span class="keyword">from</span> cs231n.classifiers.linear_svm <span class="keyword">import</span> svm_loss_naive</div><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line"><span class="comment"># generate a random SVM weight matrix of small numbers</span></div><div class="line">W = np.random.randn(<span class="number">3073</span>, <span class="number">10</span>) * <span class="number">0.0001</span> </div><div class="line"></div><div class="line">loss, grad = svm_loss_naive(W, X_dev, y_dev, <span class="number">0.00001</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">'loss: %f'</span> % (loss, )</div></pre></td></tr></table></figure><pre><code>loss: 8.831645
</code></pre><p>​</p><p>The <code>grad</code> returned from the function above is right now all zero. Derive and implement the gradient for the SVM cost function and implement it inline inside the function <code>svm_loss_naive</code>. You will find it helpful to interleave your new code inside the existing function.</p><p>To check that you have correctly implemented the gradient correctly, you can numerically estimate the gradient of the loss function and compare the numeric estimate to the gradient that you computed. We have provided code that does this for you:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Once you've implemented the gradient, recompute it with the code below</span></div><div class="line"><span class="comment"># and gradient check it with the function we provided for you</span></div><div class="line"></div><div class="line"><span class="comment"># Compute the loss and its gradient at W.</span></div><div class="line">loss, grad = svm_loss_naive(W, X_dev, y_dev, <span class="number">0.0</span>)</div><div class="line"></div><div class="line"><span class="comment"># Numerically compute the gradient along several randomly chosen dimensions, and</span></div><div class="line"><span class="comment"># compare them with your analytically computed gradient. The numbers should match</span></div><div class="line"><span class="comment"># almost exactly along all dimensions.</span></div><div class="line"><span class="keyword">from</span> cs231n.gradient_check <span class="keyword">import</span> grad_check_sparse</div><div class="line">f = <span class="keyword">lambda</span> w: svm_loss_naive(w, X_dev, y_dev, <span class="number">0.0</span>)[<span class="number">0</span>]</div><div class="line">grad_numerical = grad_check_sparse(f, W, grad)</div><div class="line"></div><div class="line"><span class="comment"># do the gradient check once again with regularization turned on</span></div><div class="line"><span class="comment"># you didn't forget the regularization gradient did you?</span></div><div class="line">loss, grad = svm_loss_naive(W, X_dev, y_dev, <span class="number">1e2</span>)</div><div class="line">f = <span class="keyword">lambda</span> w: svm_loss_naive(w, X_dev, y_dev, <span class="number">1e2</span>)[<span class="number">0</span>]</div><div class="line">grad_numerical = grad_check_sparse(f, W, grad)</div></pre></td></tr></table></figure><pre><code>numerical: -13.865929 analytic: -13.865929, relative error: 1.283977e-12
numerical: 7.842142 analytic: 7.735021, relative error: 6.876784e-03
numerical: 3.464393 analytic: 3.464393, relative error: 9.040092e-11
numerical: -23.034911 analytic: -23.034911, relative error: 6.876266e-12
numerical: -0.185311 analytic: -0.185311, relative error: 2.538774e-10
numerical: 25.825504 analytic: 25.825504, relative error: 1.336035e-11
numerical: 4.457836 analytic: 4.457836, relative error: 1.015819e-10
numerical: 3.184691 analytic: 3.184691, relative error: 8.849109e-11
numerical: 10.428446 analytic: 10.374317, relative error: 2.601982e-03
numerical: 12.479957 analytic: 12.479957, relative error: 6.825191e-12
numerical: 12.237949 analytic: 12.326308, relative error: 3.597051e-03
numerical: 4.377103 analytic: 4.377103, relative error: 3.904758e-11
numerical: -1.951930 analytic: -1.951930, relative error: 1.432276e-10
numerical: 33.752503 analytic: 33.752503, relative error: 4.254520e-12
numerical: 11.367149 analytic: 11.367149, relative error: 1.682727e-11
numerical: 16.461879 analytic: 16.461879, relative error: 4.766805e-12
numerical: 3.814562 analytic: 3.814562, relative error: 1.087469e-10
numerical: 13.931226 analytic: 13.931226, relative error: 9.578349e-12
numerical: -27.291095 analytic: -27.395406, relative error: 1.907445e-03
numerical: -7.610407 analytic: -7.610407, relative error: 1.015282e-12
</code></pre><h3 id="Inline-Question-1"><a href="#Inline-Question-1" class="headerlink" title="Inline Question 1:"></a>Inline Question 1:</h3><p>It is possible that once in a while a dimension in the gradcheck will not match exactly. What could such a discrepancy be caused by? Is it a reason for concern? What is a simple example in one dimension where a gradient check could fail? <em>Hint: the SVM loss function is not strictly speaking differentiable</em></p><p><strong>Your Answer:</strong> <em>Maybe the SVM loss function is not differentiable on that dimension</em></p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">?np.max</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.sum(np.maximum(<span class="number">0</span>, X_dev.dot(W) - X_dev.dot(W)[np.arange(len(y_dev)), [y_dev]].T + <span class="number">1</span>))</div></pre></td></tr></table></figure><pre><code>4915.822409730994
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Next implement the function svm_loss_vectorized; for now only compute the loss;</span></div><div class="line"><span class="comment"># we will implement the gradient in a moment.</span></div><div class="line">tic = time.time()</div><div class="line">loss_naive, grad_naive = svm_loss_naive(W, X_dev, y_dev, <span class="number">0.00001</span>)</div><div class="line">toc = time.time()</div><div class="line"><span class="keyword">print</span> <span class="string">'Naive loss: %e computed in %fs'</span> % (loss_naive, toc - tic)</div><div class="line"></div><div class="line"><span class="keyword">from</span> cs231n.classifiers.linear_svm <span class="keyword">import</span> svm_loss_vectorized</div><div class="line">tic = time.time()</div><div class="line">loss_vectorized, _ = svm_loss_vectorized(W, X_dev, y_dev, <span class="number">0.00001</span>)</div><div class="line">toc = time.time()</div><div class="line"><span class="keyword">print</span> <span class="string">'Vectorized loss: %e computed in %fs'</span> % (loss_vectorized, toc - tic)</div><div class="line"></div><div class="line"><span class="comment"># The losses should match but your vectorized implementation should be much faster.</span></div><div class="line"><span class="keyword">print</span> <span class="string">'difference: %f'</span> % (loss_naive - loss_vectorized)</div></pre></td></tr></table></figure><pre><code>Naive loss: 8.831645e+00 computed in 0.071000s
Vectorized loss: 8.831645e+00 computed in 0.000000s
difference: 0.000000
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Complete the implementation of svm_loss_vectorized, and compute the gradient</span></div><div class="line"><span class="comment"># of the loss function in a vectorized way.</span></div><div class="line"></div><div class="line"><span class="comment"># The naive implementation and the vectorized implementation should match, but</span></div><div class="line"><span class="comment"># the vectorized version should still be much faster.</span></div><div class="line">tic = time.time()</div><div class="line">_, grad_naive = svm_loss_naive(W, X_dev, y_dev, <span class="number">0.00001</span>)</div><div class="line">toc = time.time()</div><div class="line"><span class="keyword">print</span> <span class="string">'Naive loss and gradient: computed in %fs'</span> % (toc - tic)</div><div class="line"></div><div class="line">tic = time.time()</div><div class="line">_, grad_vectorized = svm_loss_vectorized(W, X_dev, y_dev, <span class="number">0.00001</span>)</div><div class="line">toc = time.time()</div><div class="line"><span class="keyword">print</span> <span class="string">'Vectorized loss and gradient: computed in %fs'</span> % (toc - tic)</div><div class="line"></div><div class="line"><span class="comment"># The loss is a single number, so it is easy to compare the values computed</span></div><div class="line"><span class="comment"># by the two implementations. The gradient on the other hand is a matrix, so</span></div><div class="line"><span class="comment"># we use the Frobenius norm to compare them.</span></div><div class="line">difference = np.linalg.norm(grad_naive - grad_vectorized, ord=<span class="string">'fro'</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">'difference: %f'</span> % difference</div></pre></td></tr></table></figure><pre><code>Naive loss and gradient: computed in 0.084000s
Vectorized loss and gradient: computed in 0.005000s
difference: 0.000000
</code></pre><h3 id="Stochastic-Gradient-Descent"><a href="#Stochastic-Gradient-Descent" class="headerlink" title="Stochastic Gradient Descent"></a>Stochastic Gradient Descent</h3><p>We now have vectorized and efficient expressions for the loss, the gradient and our gradient matches the numerical gradient. We are therefore ready to do SGD to minimize the loss.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># In the file linear_classifier.py, implement SGD in the function</span></div><div class="line"><span class="comment"># LinearClassifier.train() and then run it with the code below.</span></div><div class="line"><span class="keyword">from</span> cs231n.classifiers <span class="keyword">import</span> LinearSVM</div><div class="line">svm = LinearSVM()</div><div class="line">tic = time.time()</div><div class="line">loss_hist = svm.train(X_train, y_train, learning_rate=<span class="number">1e-7</span>, reg=<span class="number">5e4</span>,</div><div class="line">                      num_iters=<span class="number">1500</span>, verbose=<span class="keyword">True</span>)</div><div class="line">toc = time.time()</div><div class="line"><span class="keyword">print</span> <span class="string">'That took %fs'</span> % (toc - tic)</div></pre></td></tr></table></figure><pre><code>iteration 0 / 1500: loss 791.772037
iteration 100 / 1500: loss 286.021346
iteration 200 / 1500: loss 107.673095
iteration 300 / 1500: loss 41.812791
iteration 400 / 1500: loss 18.665578
iteration 500 / 1500: loss 10.614984
iteration 600 / 1500: loss 6.664814
iteration 700 / 1500: loss 6.509693
iteration 800 / 1500: loss 5.792204
iteration 900 / 1500: loss 4.986855
iteration 1000 / 1500: loss 5.914691
iteration 1100 / 1500: loss 5.058078
iteration 1200 / 1500: loss 5.491475
iteration 1300 / 1500: loss 5.609450
iteration 1400 / 1500: loss 5.376595
That took 5.454000s
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># A useful debugging strategy is to plot the loss as a function of</span></div><div class="line"><span class="comment"># iteration number:</span></div><div class="line">plt.plot(loss_hist)</div><div class="line">plt.xlabel(<span class="string">'Iteration number'</span>)</div><div class="line">plt.ylabel(<span class="string">'Loss value'</span>)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/svm/learning_curve.png" alt="learning_curve"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Write the LinearSVM.predict function and evaluate the performance on both the</span></div><div class="line"><span class="comment"># training and validation set</span></div><div class="line">y_train_pred = svm.predict(X_train)</div><div class="line"><span class="keyword">print</span> <span class="string">'training accuracy: %f'</span> % (np.mean(y_train == y_train_pred), )</div><div class="line">y_val_pred = svm.predict(X_val)</div><div class="line"><span class="keyword">print</span> <span class="string">'validation accuracy: %f'</span> % (np.mean(y_val == y_val_pred), )</div></pre></td></tr></table></figure><pre><code>training accuracy: 0.364980
validation accuracy: 0.378000
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Use the validation set to tune hyperparameters (regularization strength and</span></div><div class="line"><span class="comment"># learning rate). You should experiment with different ranges for the learning</span></div><div class="line"><span class="comment"># rates and regularization strengths; if you are careful you should be able to</span></div><div class="line"><span class="comment"># get a classification accuracy of about 0.4 on the validation set.</span></div><div class="line">learning_rates = [<span class="number">1e-8</span>, <span class="number">1e-7</span>, <span class="number">2e-7</span>]</div><div class="line">regularization_strengths = [<span class="number">1e4</span>, <span class="number">2e4</span>, <span class="number">3e4</span>, <span class="number">4e4</span>, <span class="number">5e4</span>, <span class="number">6e4</span>, <span class="number">7e4</span>, <span class="number">8e4</span>, <span class="number">1e5</span>]</div><div class="line"></div><div class="line"><span class="comment"># results is dictionary mapping tuples of the form</span></div><div class="line"><span class="comment"># (learning_rate, regularization_strength) to tuples of the form</span></div><div class="line"><span class="comment"># (training_accuracy, validation_accuracy). The accuracy is simply the fraction</span></div><div class="line"><span class="comment"># of data points that are correctly classified.</span></div><div class="line">results = &#123;&#125;</div><div class="line">best_val = <span class="number">-1</span>   <span class="comment"># The highest validation accuracy that we have seen so far.</span></div><div class="line">best_svm = <span class="keyword">None</span> <span class="comment"># The LinearSVM object that achieved the highest validation rate.</span></div><div class="line"></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment"># <span class="doctag">TODO:</span>                                                                        #</span></div><div class="line"><span class="comment"># Write code that chooses the best hyperparameters by tuning on the validation #</span></div><div class="line"><span class="comment"># set. For each combination of hyperparameters, train a linear SVM on the      #</span></div><div class="line"><span class="comment"># training set, compute its accuracy on the training and validation sets, and  #</span></div><div class="line"><span class="comment"># store these numbers in the results dictionary. In addition, store the best   #</span></div><div class="line"><span class="comment"># validation accuracy in best_val and the LinearSVM object that achieves this  #</span></div><div class="line"><span class="comment"># accuracy in best_svm.                                                        #</span></div><div class="line"><span class="comment">#                                                                              #</span></div><div class="line"><span class="comment"># Hint: You should use a small value for num_iters as you develop your         #</span></div><div class="line"><span class="comment"># validation code so that the SVMs don't take much time to train; once you are #</span></div><div class="line"><span class="comment"># confident that your validation code works, you should rerun the validation   #</span></div><div class="line"><span class="comment"># code with a larger value for num_iters.                                      #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="keyword">for</span> learning_rate <span class="keyword">in</span> learning_rates:</div><div class="line">    <span class="keyword">for</span> regularization_strength <span class="keyword">in</span> regularization_strengths:</div><div class="line">        svm = LinearSVM()</div><div class="line">        loss_hist = svm.train(</div><div class="line">            X_train, y_train, learning_rate, \</div><div class="line">            regularization_strength, num_iters=<span class="number">1500</span>, batch_size=<span class="number">200</span>)</div><div class="line">        y_train_pred = svm.predict(X_train)</div><div class="line">        y_val_pred = svm.predict(X_val)</div><div class="line">        training_accuracy = np.mean(y_train == y_train_pred)</div><div class="line">        validation_accuracy = np.mean(y_val == y_val_pred)</div><div class="line">        results[(learning_rate, regularization_strength)] = \</div><div class="line">        (training_accuracy, validation_accuracy)</div><div class="line">        </div><div class="line">        <span class="keyword">if</span> validation_accuracy &gt; best_val:</div><div class="line">            best_val = validation_accuracy</div><div class="line">            best_svm = svm</div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment">#                              END OF YOUR CODE                                #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line">    </div><div class="line"><span class="comment"># Print out results.</span></div><div class="line"><span class="keyword">for</span> lr, reg <span class="keyword">in</span> sorted(results):</div><div class="line">    train_accuracy, val_accuracy = results[(lr, reg)]</div><div class="line">    <span class="keyword">print</span> <span class="string">'lr %e reg %e train accuracy: %f val accuracy: %f'</span> % (</div><div class="line">                lr, reg, train_accuracy, val_accuracy)</div><div class="line">    </div><div class="line"><span class="keyword">print</span> <span class="string">'best validation accuracy achieved during cross-validation: %f'</span> % best_val</div></pre></td></tr></table></figure><pre><code>lr 1.000000e-08 reg 1.000000e+04 train accuracy: 0.221898 val accuracy: 0.247000
lr 1.000000e-08 reg 2.000000e+04 train accuracy: 0.233653 val accuracy: 0.258000
lr 1.000000e-08 reg 3.000000e+04 train accuracy: 0.234694 val accuracy: 0.225000
lr 1.000000e-08 reg 4.000000e+04 train accuracy: 0.255959 val accuracy: 0.249000
lr 1.000000e-08 reg 5.000000e+04 train accuracy: 0.259755 val accuracy: 0.273000
lr 1.000000e-08 reg 6.000000e+04 train accuracy: 0.267408 val accuracy: 0.269000
lr 1.000000e-08 reg 7.000000e+04 train accuracy: 0.269102 val accuracy: 0.287000
lr 1.000000e-08 reg 8.000000e+04 train accuracy: 0.277102 val accuracy: 0.285000
lr 1.000000e-08 reg 1.000000e+05 train accuracy: 0.295306 val accuracy: 0.301000
lr 1.000000e-07 reg 1.000000e+04 train accuracy: 0.369388 val accuracy: 0.374000
lr 1.000000e-07 reg 2.000000e+04 train accuracy: 0.380265 val accuracy: 0.390000
lr 1.000000e-07 reg 3.000000e+04 train accuracy: 0.375490 val accuracy: 0.378000
lr 1.000000e-07 reg 4.000000e+04 train accuracy: 0.375633 val accuracy: 0.385000
lr 1.000000e-07 reg 5.000000e+04 train accuracy: 0.369694 val accuracy: 0.375000
lr 1.000000e-07 reg 6.000000e+04 train accuracy: 0.372469 val accuracy: 0.383000
lr 1.000000e-07 reg 7.000000e+04 train accuracy: 0.356000 val accuracy: 0.370000
lr 1.000000e-07 reg 8.000000e+04 train accuracy: 0.352816 val accuracy: 0.355000
lr 1.000000e-07 reg 1.000000e+05 train accuracy: 0.356796 val accuracy: 0.377000
lr 2.000000e-07 reg 1.000000e+04 train accuracy: 0.393510 val accuracy: 0.395000
lr 2.000000e-07 reg 2.000000e+04 train accuracy: 0.377020 val accuracy: 0.382000
lr 2.000000e-07 reg 3.000000e+04 train accuracy: 0.363857 val accuracy: 0.373000
lr 2.000000e-07 reg 4.000000e+04 train accuracy: 0.368714 val accuracy: 0.372000
lr 2.000000e-07 reg 5.000000e+04 train accuracy: 0.361531 val accuracy: 0.364000
lr 2.000000e-07 reg 6.000000e+04 train accuracy: 0.354714 val accuracy: 0.368000
lr 2.000000e-07 reg 7.000000e+04 train accuracy: 0.348306 val accuracy: 0.365000
lr 2.000000e-07 reg 8.000000e+04 train accuracy: 0.358082 val accuracy: 0.378000
lr 2.000000e-07 reg 1.000000e+05 train accuracy: 0.347898 val accuracy: 0.358000
best validation accuracy achieved during cross-validation: 0.395000
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Visualize the cross-validation results</span></div><div class="line"><span class="keyword">import</span> math</div><div class="line">x_scatter = [math.log10(x[<span class="number">0</span>]) <span class="keyword">for</span> x <span class="keyword">in</span> results]</div><div class="line">y_scatter = [math.log10(x[<span class="number">1</span>]) <span class="keyword">for</span> x <span class="keyword">in</span> results]</div><div class="line"></div><div class="line"><span class="comment"># plot training accuracy</span></div><div class="line">marker_size = <span class="number">100</span></div><div class="line">colors = [results[x][<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> results]</div><div class="line">plt.subplot(<span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>)</div><div class="line">plt.scatter(x_scatter, y_scatter, marker_size, c=colors)</div><div class="line">plt.colorbar()</div><div class="line">plt.xlabel(<span class="string">'log learning rate'</span>)</div><div class="line">plt.ylabel(<span class="string">'log regularization strength'</span>)</div><div class="line">plt.title(<span class="string">'CIFAR-10 training accuracy'</span>)</div><div class="line"></div><div class="line"><span class="comment"># plot validation accuracy</span></div><div class="line">colors = [results[x][<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> results] <span class="comment"># default size of markers is 20</span></div><div class="line">plt.subplot(<span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>)</div><div class="line">plt.scatter(x_scatter, y_scatter, marker_size, c=colors)</div><div class="line">plt.colorbar()</div><div class="line">plt.xlabel(<span class="string">'log learning rate'</span>)</div><div class="line">plt.ylabel(<span class="string">'log regularization strength'</span>)</div><div class="line">plt.title(<span class="string">'CIFAR-10 validation accuracy'</span>)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/svm/accuracy.png" alt="accuracy"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Evaluate the best svm on test set</span></div><div class="line">y_test_pred = best_svm.predict(X_test)</div><div class="line">test_accuracy = np.mean(y_test == y_test_pred)</div><div class="line"><span class="keyword">print</span> <span class="string">'linear SVM on raw pixels final test set accuracy: %f'</span> % test_accuracy</div></pre></td></tr></table></figure><pre><code>linear SVM on raw pixels final test set accuracy: 0.383000
</code></pre><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">x = np.array([[[<span class="number">0</span>], [<span class="number">1</span>], [<span class="number">2</span>]]])</div><div class="line">np.squeeze(x)</div></pre></td></tr></table></figure><pre><code>array([0, 1, 2])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Visualize the learned weights for each class.</span></div><div class="line"><span class="comment"># Depending on your choice of learning rate and regularization strength, these may</span></div><div class="line"><span class="comment"># or may not be nice to look at.</span></div><div class="line">w = best_svm.W[:<span class="number">-1</span>,:] <span class="comment"># strip out the bias</span></div><div class="line">w = w.reshape(<span class="number">32</span>, <span class="number">32</span>, <span class="number">3</span>, <span class="number">10</span>)</div><div class="line">w_min, w_max = np.min(w), np.max(w)</div><div class="line">classes = [<span class="string">'plane'</span>, <span class="string">'car'</span>, <span class="string">'bird'</span>, <span class="string">'cat'</span>, <span class="string">'deer'</span>, <span class="string">'dog'</span>, <span class="string">'frog'</span>, <span class="string">'horse'</span>, <span class="string">'ship'</span>, <span class="string">'truck'</span>]</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">10</span>):</div><div class="line">  plt.subplot(<span class="number">2</span>, <span class="number">5</span>, i + <span class="number">1</span>)</div><div class="line">    </div><div class="line">  <span class="comment"># Rescale the weights to be between 0 and 255</span></div><div class="line">  wimg = <span class="number">255.0</span> * (w[:, :, :, i].squeeze() - w_min) / (w_max - w_min)</div><div class="line">  plt.imshow(wimg.astype(<span class="string">'uint8'</span>))</div><div class="line">  plt.axis(<span class="string">'off'</span>)</div><div class="line">  plt.title(classes[i])</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/svm/weight.png" alt="weight"></p><h3 id="Inline-question-2"><a href="#Inline-question-2" class="headerlink" title="Inline question 2:"></a>Inline question 2:</h3><p>Describe what your visualized SVM weights look like, and offer a brief explanation for why they look they way that they do.</p><p><strong>Your answer:</strong> <em>fill this in</em></p><h1 id="Codes"><a href="#Codes" class="headerlink" title="Codes"></a>Codes</h1><h2 id="linear-svm-py"><a href="#linear-svm-py" class="headerlink" title="linear_svm.py"></a>linear_svm.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> random <span class="keyword">import</span> shuffle</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">svm_loss_naive</span><span class="params">(W, X, y, reg)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    Structured SVM loss function, naive implementation (with loops).</div><div class="line"></div><div class="line">    Inputs have dimension D, there are C classes, and we operate on minibatches</div><div class="line">    of N examples.</div><div class="line"></div><div class="line">    Inputs:</div><div class="line">    - W: A numpy array of shape (D, C) containing weights.</div><div class="line">    - X: A numpy array of shape (N, D) containing a minibatch of data.</div><div class="line">    - y: A numpy array of shape (N,) containing training labels; y[i] = c means</div><div class="line">      that X[i] has label c, where 0 &lt;= c &lt; C.</div><div class="line">    - reg: (float) regularization strength</div><div class="line"></div><div class="line">    Returns a tuple of:</div><div class="line">    - loss as single float</div><div class="line">    - gradient with respect to weights W; an array of same shape as W</div><div class="line">    """</div><div class="line">    dW = np.zeros(W.shape)  <span class="comment"># initialize the gradient as zero</span></div><div class="line"></div><div class="line">    <span class="comment"># compute the loss and the gradient</span></div><div class="line">    num_classes = W.shape[<span class="number">1</span>]</div><div class="line">    num_train = X.shape[<span class="number">0</span>]</div><div class="line">    loss = <span class="number">0.0</span></div><div class="line"></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(num_train):</div><div class="line">        scores = X[i].dot(W)</div><div class="line">        correct_class_score = scores[y[i]]</div><div class="line"></div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> xrange(num_classes):</div><div class="line">            <span class="keyword">if</span> j == y[i]:</div><div class="line">                <span class="keyword">continue</span></div><div class="line">            margin = scores[j] - correct_class_score + <span class="number">1</span>  <span class="comment"># note delta = 1</span></div><div class="line">            <span class="keyword">if</span> margin &gt; <span class="number">0</span>:</div><div class="line">                dW[:, y[i]] -= X[i, :]</div><div class="line">                dW[:, j] += X[i, :]</div><div class="line">                loss += margin</div><div class="line"></div><div class="line">    <span class="comment"># Right now the loss is a sum over all training examples, but we want it</span></div><div class="line">    <span class="comment"># to be an average instead so we divide by num_train.</span></div><div class="line">    loss /= num_train</div><div class="line"></div><div class="line">    dW /= num_train</div><div class="line"></div><div class="line">    <span class="comment"># Add regularization to the loss.</span></div><div class="line">    loss += <span class="number">0.5</span> * reg * np.sum(W * W)</div><div class="line">    dW += reg * W</div><div class="line"></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    <span class="comment"># <span class="doctag">TODO:</span>                                                                     #</span></div><div class="line">    <span class="comment"># Compute the gradient of the loss function and store it dW.                #</span></div><div class="line">    <span class="comment"># Rather that first computing the loss and then computing the derivative,     #</span></div><div class="line">    <span class="comment"># it may be simpler to compute the derivative at the same time that the     #</span></div><div class="line">    <span class="comment"># loss is being computed. As a result you may need to modify some of the    #</span></div><div class="line">    <span class="comment"># code above to compute the gradient.                                       #</span></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> loss, dW</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">svm_loss_vectorized</span><span class="params">(W, X, y, reg)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    Structured SVM loss function, vectorized implementation.</div><div class="line"></div><div class="line">    Inputs and outputs are the same as svm_loss_naive.</div><div class="line">    """</div><div class="line">    loss = <span class="number">0.0</span></div><div class="line">    dW = np.zeros(W.shape)  <span class="comment"># initialize the gradient as zero</span></div><div class="line"></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    <span class="comment"># <span class="doctag">TODO:</span>                                                                     #</span></div><div class="line">    <span class="comment"># Implement a vectorized version of the structured SVM loss, storing the    #</span></div><div class="line">    <span class="comment"># result in loss.                                                           #</span></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    num_train = X.shape[<span class="number">0</span>]</div><div class="line">    delta = <span class="number">1.0</span></div><div class="line"></div><div class="line">    scores = X.dot(W)</div><div class="line">    correct_class_score = scores[np.arange(num_train), y]</div><div class="line"></div><div class="line">    margins = np.maximum(</div><div class="line">        <span class="number">0</span>, scores - correct_class_score[:, np.newaxis] + delta)</div><div class="line">    margins[np.arange(num_train), y] = <span class="number">0</span></div><div class="line"></div><div class="line">    loss = np.sum(margins)</div><div class="line"></div><div class="line">    loss /= num_train</div><div class="line"></div><div class="line">    loss += <span class="number">0.5</span> * reg * np.sum(W.T.dot(W))</div><div class="line"></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    <span class="comment">#                             END OF YOUR CODE                              #</span></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line"></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    <span class="comment"># <span class="doctag">TODO:</span>                                                                     #</span></div><div class="line">    <span class="comment"># Implement a vectorized version of the gradient for the structured SVM     #</span></div><div class="line">    <span class="comment"># loss, storing the result in dW.                                           #</span></div><div class="line">    <span class="comment">#                                                                           #</span></div><div class="line">    <span class="comment"># Hint: Instead of computing the gradient from scratch, it may be easier    #</span></div><div class="line">    <span class="comment"># to reuse some of the intermediate values that you used to compute the     #</span></div><div class="line">    <span class="comment"># loss.                                                                     #</span></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    X_mask = np.zeros(margins.shape)</div><div class="line">    X_mask[margins &gt; <span class="number">0</span>] = <span class="number">1</span></div><div class="line"></div><div class="line">    count = np.sum(X_mask, axis=<span class="number">1</span>)</div><div class="line">    X_mask[np.arange(num_train), y] = -count</div><div class="line"></div><div class="line">    dW = X.T.dot(X_mask)</div><div class="line"></div><div class="line">    dW /= num_train</div><div class="line"></div><div class="line">    dW += np.multiply(W, reg)</div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line">    <span class="comment">#                             END OF YOUR CODE                              #</span></div><div class="line">    <span class="comment">#############################################################################</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> loss, dW</div></pre></td></tr></table></figure><h2 id="linear-classifier"><a href="#linear-classifier" class="headerlink" title="linear_classifier"></a>linear_classifier</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> cs231n.classifiers.linear_svm <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> cs231n.classifiers.softmax <span class="keyword">import</span> *</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearClassifier</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        self.W = <span class="keyword">None</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self, X, y, learning_rate=<span class="number">1e-3</span>, reg=<span class="number">1e-5</span>, num_iters=<span class="number">100</span>,</span></span></div><div class="line">              batch_size=<span class="number">200</span>, verbose=False):</div><div class="line">        <span class="string">"""</span></div><div class="line">        Train this linear classifier using stochastic gradient descent.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - X: A numpy array of shape (N, D) containing training data; there are N</div><div class="line">          training samples each of dimension D.</div><div class="line">        - y: A numpy array of shape (N,) containing training labels; y[i] = c</div><div class="line">          means that X[i] has label 0 &lt;= c &lt; C for C classes.</div><div class="line">        - learning_rate: (float) learning rate for optimization.</div><div class="line">        - reg: (float) regularization strength.</div><div class="line">        - num_iters: (integer) number of steps to take when optimizing</div><div class="line">        - batch_size: (integer) number of training examples to use at each step.</div><div class="line">        - verbose: (boolean) If true, print progress during optimization.</div><div class="line"></div><div class="line">        Outputs:</div><div class="line">        A list containing the value of the loss function at each training iteration.</div><div class="line">        """</div><div class="line">        num_train, dim = X.shape</div><div class="line">        num_classes = np.max(y) + <span class="number">1</span>  <span class="comment"># assume y takes values 0...K-1 where K is number of classes</span></div><div class="line">        <span class="keyword">if</span> self.W <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">            <span class="comment"># lazily initialize W</span></div><div class="line">            self.W = <span class="number">0.001</span> * np.random.randn(dim, num_classes)</div><div class="line"></div><div class="line">        <span class="comment"># Run stochastic gradient descent to optimize W</span></div><div class="line">        loss_history = []</div><div class="line">        <span class="keyword">for</span> it <span class="keyword">in</span> xrange(num_iters):</div><div class="line">            X_batch = <span class="keyword">None</span></div><div class="line">            y_batch = <span class="keyword">None</span></div><div class="line"></div><div class="line">            <span class="comment">#########################################################################</span></div><div class="line">            <span class="comment"># <span class="doctag">TODO:</span>                                                                 #</span></div><div class="line">            <span class="comment"># Sample batch_size elements from the training data and their           #</span></div><div class="line">            <span class="comment"># corresponding labels to use in this round of gradient descent.        #</span></div><div class="line">            <span class="comment"># Store the data in X_batch and their corresponding labels in           #</span></div><div class="line">            <span class="comment"># y_batch; after sampling X_batch should have shape (dim, batch_size)   #</span></div><div class="line">            <span class="comment"># and y_batch should have shape (batch_size,)                           #</span></div><div class="line">            <span class="comment">#                                                                       #</span></div><div class="line">            <span class="comment"># Hint: Use np.random.choice to generate indices. Sampling with         #</span></div><div class="line">            <span class="comment"># replacement is faster than sampling without replacement.              #</span></div><div class="line">            <span class="comment">#########################################################################</span></div><div class="line">            mask = np.random.choice(num_train, batch_size, replace=<span class="keyword">True</span>)</div><div class="line">            X_batch = X[mask]</div><div class="line">            y_batch = y[mask]</div><div class="line">            <span class="comment">#########################################################################</span></div><div class="line">            <span class="comment">#                       END OF YOUR CODE                                #</span></div><div class="line">            <span class="comment">#########################################################################</span></div><div class="line"></div><div class="line">            <span class="comment"># evaluate loss and gradient</span></div><div class="line">            loss, grad = self.loss(X_batch, y_batch, reg)</div><div class="line">            loss_history.append(loss)</div><div class="line"></div><div class="line">            <span class="comment"># perform parameter update</span></div><div class="line">            <span class="comment">#########################################################################</span></div><div class="line">            <span class="comment"># <span class="doctag">TODO:</span>                                                                 #</span></div><div class="line">            <span class="comment"># Update the weights using the gradient and the learning rate.          #</span></div><div class="line">            <span class="comment">#########################################################################</span></div><div class="line">            self.W = self.W - learning_rate * grad</div><div class="line">            <span class="comment">#########################################################################</span></div><div class="line">            <span class="comment">#                       END OF YOUR CODE                                #</span></div><div class="line">            <span class="comment">#########################################################################</span></div><div class="line"></div><div class="line">            <span class="keyword">if</span> verbose <span class="keyword">and</span> it % <span class="number">100</span> == <span class="number">0</span>:</div><div class="line">                <span class="keyword">print</span> <span class="string">'iteration %d / %d: loss %f'</span> % (it, num_iters, loss)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> loss_history</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(self, X)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Use the trained weights of this linear classifier to predict labels for</div><div class="line">        data points.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - X: D x N array of training data. Each column is a D-dimensional point.</div><div class="line"></div><div class="line">        Returns:</div><div class="line">        - y_pred: Predicted labels for the data in X. y_pred is a 1-dimensional</div><div class="line">          array of length N, and each element is an integer giving the predicted</div><div class="line">          class.</div><div class="line">        """</div><div class="line">        X = X.T</div><div class="line">        y_pred = np.zeros(X.shape[<span class="number">1</span>])</div><div class="line">        <span class="comment">###########################################################################</span></div><div class="line">        <span class="comment"># <span class="doctag">TODO:</span>                                                                   #</span></div><div class="line">        <span class="comment"># Implement this method. Store the predicted labels in y_pred.            #</span></div><div class="line">        <span class="comment">###########################################################################</span></div><div class="line">        scores = X.T.dot(self.W)</div><div class="line">        y_pred = np.argsort(scores, axis=<span class="number">1</span>)[:, <span class="number">-1</span>]</div><div class="line">        <span class="comment">###########################################################################</span></div><div class="line">        <span class="comment">#                           END OF YOUR CODE                              #</span></div><div class="line">        <span class="comment">###########################################################################</span></div><div class="line">        <span class="keyword">return</span> y_pred</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loss</span><span class="params">(self, X_batch, y_batch, reg)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Compute the loss function and its derivative.</div><div class="line">        Subclasses will override this.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - X_batch: A numpy array of shape (N, D) containing a minibatch of N</div><div class="line">          data points; each point has dimension D.</div><div class="line">        - y_batch: A numpy array of shape (N,) containing labels for the minibatch.</div><div class="line">        - reg: (float) regularization strength.</div><div class="line"></div><div class="line">        Returns: A tuple containing:</div><div class="line">        - loss as a single float</div><div class="line">        - gradient with respect to self.W; an array of the same shape as W</div><div class="line">        """</div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearSVM</span><span class="params">(LinearClassifier)</span>:</span></div><div class="line">    <span class="string">""" A subclass that uses the Multiclass SVM loss function """</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loss</span><span class="params">(self, X_batch, y_batch, reg)</span>:</span></div><div class="line">        <span class="keyword">return</span> svm_loss_vectorized(self.W, X_batch, y_batch, reg)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Softmax</span><span class="params">(LinearClassifier)</span>:</span></div><div class="line">    <span class="string">""" A subclass that uses the Softmax + Cross-entropy loss function """</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loss</span><span class="params">(self, X_batch, y_batch, reg)</span>:</span></div><div class="line">        <span class="keyword">return</span> softmax_loss_vectorized(self.W, X_batch, y_batch, reg)</div></pre></td></tr></table></figure></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/02/cs231n-Assignment-1-kNN/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracadabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracadabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/2017/03/02/cs231n-Assignment-1-kNN/" itemprop="url">cs231n Assignment#1 kNN</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-02T22:26:57+08:00">2017-03-02 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/03/02/cs231n-Assignment-1-kNN/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2017/03/02/cs231n-Assignment-1-kNN/" itemprop="commentsCount"></span> </a></span><span id="/2017/03/02/cs231n-Assignment-1-kNN/" class="leancloud_visitors" data-flag-title="cs231n Assignment#1 kNN"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="k-Nearest-Neighbor-kNN-exercise"><a href="#k-Nearest-Neighbor-kNN-exercise" class="headerlink" title="k-Nearest Neighbor (kNN) exercise"></a>k-Nearest Neighbor (kNN) exercise</h1><p><em>Complete and hand in this completed worksheet (including its outputs and any supporting code outside of the worksheet) with your assignment submission. For more details see the <a href="http://vision.stanford.edu/teaching/cs231n/assignments.html" target="_blank" rel="external">assignments page</a> on the course website.</em></p><p>The kNN classifier consists of two stages:</p><ul><li>During training, the classifier takes the training data and simply remembers it</li><li>During testing, kNN classifies every test image by comparing to all training images and transfering the labels of the k most similar training examples</li><li>The value of k is cross-validated</li></ul><p>In this exercise you will implement these steps and understand the basic Image Classification pipeline, cross-validation, and gain proficiency in writing efficient, vectorized code.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Run some setup code for this notebook.</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> random</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> cs231n.data_utils <span class="keyword">import</span> load_CIFAR10</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"></div><div class="line"><span class="comment"># This is a bit of magic to make matplotlib figures appear inline in the notebook</span></div><div class="line"><span class="comment"># rather than in a new window.</span></div><div class="line">%matplotlib inline</div><div class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">10.0</span>, <span class="number">8.0</span>) <span class="comment"># set default size of plots</span></div><div class="line">plt.rcParams[<span class="string">'image.interpolation'</span>] = <span class="string">'nearest'</span></div><div class="line">plt.rcParams[<span class="string">'image.cmap'</span>] = <span class="string">'gray'</span></div><div class="line"></div><div class="line"><span class="comment"># Some more magic so that the notebook will reload external python modules;</span></div><div class="line"><span class="comment"># see http://stackoverflow.com/questions/1907993/autoreload-of-modules-in-ipython</span></div><div class="line">%load_ext autoreload</div><div class="line">%autoreload <span class="number">2</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Load the raw CIFAR-10 data.</span></div><div class="line">cifar10_dir = <span class="string">'cs231n/datasets/cifar-10-batches-py'</span></div><div class="line">X_train, y_train, X_test, y_test = load_CIFAR10(cifar10_dir)</div><div class="line"></div><div class="line"><span class="comment"># As a sanity check, we print out the size of the training and test data.</span></div><div class="line"><span class="keyword">print</span> <span class="string">'Training data shape: '</span>, X_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Training labels shape: '</span>, y_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test data shape: '</span>, X_test.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test labels shape: '</span>, y_test.shape</div></pre></td></tr></table></figure><pre><code>Training data shape:  (50000L, 32L, 32L, 3L)
Training labels shape:  (50000L,)
Test data shape:  (10000L, 32L, 32L, 3L)
Test labels shape:  (10000L,)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Visualize some examples from the dataset.</span></div><div class="line"><span class="comment"># We show a few examples of training images from each class.</span></div><div class="line">classes = [<span class="string">'plane'</span>, <span class="string">'car'</span>, <span class="string">'bird'</span>, <span class="string">'cat'</span>, <span class="string">'deer'</span>, <span class="string">'dog'</span>, <span class="string">'frog'</span>, <span class="string">'horse'</span>, <span class="string">'ship'</span>, <span class="string">'truck'</span>]</div><div class="line">num_classes = len(classes)</div><div class="line">samples_per_class = <span class="number">7</span></div><div class="line"><span class="keyword">for</span> y, cls <span class="keyword">in</span> enumerate(classes):</div><div class="line">    idxs = np.flatnonzero(y_train == y)</div><div class="line">    idxs = np.random.choice(idxs, samples_per_class, replace=<span class="keyword">False</span>)</div><div class="line">    <span class="keyword">for</span> i, idx <span class="keyword">in</span> enumerate(idxs):</div><div class="line">        plt_idx = i * num_classes + y + <span class="number">1</span></div><div class="line">        plt.subplot(samples_per_class, num_classes, plt_idx)</div><div class="line">        plt.imshow(X_train[idx].astype(<span class="string">'uint8'</span>))</div><div class="line">        plt.axis(<span class="string">'off'</span>)</div><div class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:</div><div class="line">            plt.title(cls)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/knn/sample.png" alt="sample"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Subsample the data for more efficient code execution in this exercise</span></div><div class="line">num_training = <span class="number">5000</span></div><div class="line">mask = range(num_training)</div><div class="line">X_train = X_train[mask]</div><div class="line">y_train = y_train[mask]</div><div class="line"></div><div class="line">num_test = <span class="number">500</span></div><div class="line">mask = range(num_test)</div><div class="line">X_test = X_test[mask]</div><div class="line">y_test = y_test[mask]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Reshape the image data into rows</span></div><div class="line">X_train = np.reshape(X_train, (X_train.shape[<span class="number">0</span>], <span class="number">-1</span>)) <span class="comment"># Wow~</span></div><div class="line">X_test = np.reshape(X_test, (X_test.shape[<span class="number">0</span>], <span class="number">-1</span>))</div><div class="line"><span class="keyword">print</span> X_train.shape, X_test.shape</div></pre></td></tr></table></figure><pre><code>(5000L, 3072L) (500L, 3072L)
</code></pre><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> cs231n.classifiers <span class="keyword">import</span> KNearestNeighbor</div><div class="line"></div><div class="line"><span class="comment"># Create a kNN classifier instance. </span></div><div class="line"><span class="comment"># Remember that training a kNN classifier is a noop: </span></div><div class="line"><span class="comment"># the Classifier simply remembers the data and does no further processing </span></div><div class="line">classifier = KNearestNeighbor()</div><div class="line">classifier.train(X_train, y_train)</div></pre></td></tr></table></figure><p>We would now like to classify the test data with the kNN classifier. Recall that we can break down this process into two steps:</p><ol><li>First we must compute the distances between all test examples and all train examples.</li><li>Given these distances, for each test example we find the k nearest examples and have them vote for the label</li></ol><p>Lets begin with computing the distance matrix between all training and test examples. For example, if there are <strong>Ntr</strong> training examples and <strong>Nte</strong> test examples, this stage should result in a <strong>Nte x Ntr</strong> matrix where each element (i,j) is the distance between the i-th test and j-th train example.</p><p>First, open <code>cs231n/classifiers/k_nearest_neighbor.py</code> and implement the function <code>compute_distances_two_loops</code> that uses a (very inefficient) double loop over all pairs of (test, train) examples and computes the distance matrix one element at a time.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Open cs231n/classifiers/k_nearest_neighbor.py and implement</span></div><div class="line"><span class="comment"># compute_distances_two_loops.</span></div><div class="line"></div><div class="line"><span class="comment"># Test your implementation:</span></div><div class="line">dists = classifier.compute_distances_two_loops(X_test)</div><div class="line"><span class="keyword">print</span> dists.shape</div></pre></td></tr></table></figure><pre><code>(500L, 5000L)
</code></pre><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># We can visualize the distance matrix: each row is a single test example and</span></div><div class="line"><span class="comment"># its distances to training examples</span></div><div class="line">plt.imshow(dists, interpolation=<span class="string">'none'</span>)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/knn/dists.png" alt="dists"></p><p><strong>Inline Question #1:</strong> Notice the structured patterns in the distance matrix, where some rows or columns are visible brighter. (Note that with the default color scheme black indicates low distances while white indicates high distances.)</p><ul><li>What in the data is the cause behind the distinctly bright rows?</li><li>What causes the columns?</li></ul><p><strong>Your Answer</strong>: <em>Maybe exists noises in test data set and train data set.</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Now implement the function predict_labels and run the code below:</span></div><div class="line"><span class="comment"># We use k = 1 (which is Nearest Neighbor).</span></div><div class="line">y_test_pred = classifier.predict_labels(dists, k=<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="comment"># Compute and print the fraction of correctly predicted examples</span></div><div class="line">num_correct = np.sum(y_test_pred == y_test)</div><div class="line">accuracy = float(num_correct) / num_test</div><div class="line"><span class="keyword">print</span> <span class="string">'Got %d / %d correct =&gt; accuracy: %f'</span> % (num_correct, num_test, accuracy)</div></pre></td></tr></table></figure><pre><code>Got 137 / 500 correct =&gt; accuracy: 0.274000
</code></pre><p>​</p><p>You should expect to see approximately <code>27%</code> accuracy. Now lets try out a larger <code>k</code>, say <code>k = 5</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">y_test_pred = classifier.predict_labels(dists, k=<span class="number">5</span>)</div><div class="line">num_correct = np.sum(y_test_pred == y_test)</div><div class="line">accuracy = float(num_correct) / num_test</div><div class="line"><span class="keyword">print</span> <span class="string">'Got %d / %d correct =&gt; accuracy: %f'</span> % (num_correct, num_test, accuracy)</div></pre></td></tr></table></figure><pre><code>Got 142 / 500 correct =&gt; accuracy: 0.284000
</code></pre><p>​</p><p>You should expect to see a slightly better performance than with <code>k = 1</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Now lets speed up distance matrix computation by using partial vectorization</span></div><div class="line"><span class="comment"># with one loop. Implement the function compute_distances_one_loop and run the</span></div><div class="line"><span class="comment"># code below:</span></div><div class="line">dists_one = classifier.compute_distances_one_loop(X_test)</div><div class="line"></div><div class="line"><span class="comment"># To ensure that our vectorized implementation is correct, we make sure that it</span></div><div class="line"><span class="comment"># agrees with the naive implementation. There are many ways to decide whether</span></div><div class="line"><span class="comment"># two matrices are similar; one of the simplest is the Frobenius norm. In case</span></div><div class="line"><span class="comment"># you haven't seen it before, the Frobenius norm of two matrices is the square</span></div><div class="line"><span class="comment"># root of the squared sum of differences of all elements; in other words, reshape</span></div><div class="line"><span class="comment"># the matrices into vectors and compute the Euclidean distance between them.</span></div><div class="line">difference = np.linalg.norm(dists - dists_one, ord=<span class="string">'fro'</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">'Difference was: %f'</span> % (difference, )</div><div class="line"><span class="keyword">if</span> difference &lt; <span class="number">0.001</span>:</div><div class="line">  <span class="keyword">print</span> <span class="string">'Good! The distance matrices are the same'</span></div><div class="line"><span class="keyword">else</span>:</div><div class="line">  <span class="keyword">print</span> <span class="string">'Uh-oh! The distance matrices are different'</span></div></pre></td></tr></table></figure><pre><code>Difference was: 0.000000
Good! The distance matrices are the same
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Now implement the fully vectorized version inside compute_distances_no_loops</span></div><div class="line"><span class="comment"># and run the code</span></div><div class="line">dists_two = classifier.compute_distances_no_loops(X_test)</div><div class="line"></div><div class="line"><span class="comment"># check that the distance matrix agrees with the one we computed before:</span></div><div class="line">difference = np.linalg.norm(dists - dists_two, ord=<span class="string">'fro'</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">'Difference was: %f'</span> % (difference, )</div><div class="line"><span class="keyword">if</span> difference &lt; <span class="number">0.001</span>:</div><div class="line">  <span class="keyword">print</span> <span class="string">'Good! The distance matrices are the same'</span></div><div class="line"><span class="keyword">else</span>:</div><div class="line">  <span class="keyword">print</span> <span class="string">'Uh-oh! The distance matrices are different'</span></div></pre></td></tr></table></figure><pre><code>Difference was: 0.000000
Good! The distance matrices are the same
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Let's compare how fast the implementations are</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">time_function</span><span class="params">(f, *args)</span>:</span></div><div class="line">  <span class="string">"""</span></div><div class="line">  Call a function f with args and return the time (in seconds) that it took to execute.</div><div class="line">  """</div><div class="line">  <span class="keyword">import</span> time</div><div class="line">  tic = time.time()</div><div class="line">  f(*args)</div><div class="line">  toc = time.time()</div><div class="line">  <span class="keyword">return</span> toc - tic</div><div class="line"></div><div class="line">two_loop_time = time_function(classifier.compute_distances_two_loops, X_test)</div><div class="line"><span class="keyword">print</span> <span class="string">'Two loop version took %f seconds'</span> % two_loop_time</div><div class="line"></div><div class="line">one_loop_time = time_function(classifier.compute_distances_one_loop, X_test)</div><div class="line"><span class="keyword">print</span> <span class="string">'One loop version took %f seconds'</span> % one_loop_time</div><div class="line"></div><div class="line">no_loop_time = time_function(classifier.compute_distances_no_loops, X_test)</div><div class="line"><span class="keyword">print</span> <span class="string">'No loop version took %f seconds'</span> % no_loop_time</div><div class="line"></div><div class="line"><span class="comment"># you should see significantly faster performance with the fully vectorized implementation</span></div></pre></td></tr></table></figure><pre><code>Two loop version took 27.001000 seconds
One loop version took 59.630000 seconds
No loop version took 0.205000 seconds
</code></pre><h3 id="Cross-validation"><a href="#Cross-validation" class="headerlink" title="Cross-validation"></a>Cross-validation</h3><p>We have implemented the k-Nearest Neighbor classifier but we set the value k = 5 arbitrarily. We will now determine the best value of this hyperparameter with cross-validation.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">num_folds = <span class="number">5</span></div><div class="line">k_choices = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">20</span>, <span class="number">50</span>, <span class="number">100</span>]</div><div class="line"></div><div class="line">X_train_folds = []</div><div class="line">y_train_folds = []</div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment"># <span class="doctag">TODO:</span>                                                                        #</span></div><div class="line"><span class="comment"># Split up the training data into folds. After splitting, X_train_folds and    #</span></div><div class="line"><span class="comment"># y_train_folds should each be lists of length num_folds, where                #</span></div><div class="line"><span class="comment"># y_train_folds[i] is the label vector for the points in X_train_folds[i].     #</span></div><div class="line"><span class="comment"># Hint: Look up the numpy array_split function.                                #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line">X_train_folds = np.array_split(X_train, num_folds)</div><div class="line">y_train_folds = np.array_split(y_train, num_folds)</div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment">#                                 END OF YOUR CODE                             #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"></div><div class="line"><span class="comment"># A dictionary holding the accuracies for different values of k that we find</span></div><div class="line"><span class="comment"># when running cross-validation. After running cross-validation,</span></div><div class="line"><span class="comment"># k_to_accuracies[k] should be a list of length num_folds giving the different</span></div><div class="line"><span class="comment"># accuracy values that we found when using that value of k.</span></div><div class="line">k_to_accuracies = &#123;&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment"># <span class="doctag">TODO:</span>                                                                        #</span></div><div class="line"><span class="comment"># Perform k-fold cross validation to find the best value of k. For each        #</span></div><div class="line"><span class="comment"># possible value of k, run the k-nearest-neighbor algorithm num_folds times,   #</span></div><div class="line"><span class="comment"># where in each case you use all but one of the folds as training data and the #</span></div><div class="line"><span class="comment"># last fold as a validation set. Store the accuracies for all fold and all     #</span></div><div class="line"><span class="comment"># values of k in the k_to_accuracies dictionary.                               #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="keyword">for</span> k <span class="keyword">in</span> k_choices:</div><div class="line">    k_to_accuracies[k] = []</div><div class="line">    <span class="keyword">for</span> fold <span class="keyword">in</span> xrange(num_folds):</div><div class="line">        train_X = np.append(</div><div class="line">            X_train_folds[:fold], X_train_folds[fold+<span class="number">1</span>:]).reshape(</div><div class="line">            (X_train.shape[<span class="number">0</span>] - X_train.shape[<span class="number">0</span>]/num_folds, <span class="number">-1</span>))</div><div class="line">        train_y = np.append(</div><div class="line">            y_train_folds[:fold], y_train_folds[fold+<span class="number">1</span>:]).reshape(</div><div class="line">            (y_train.shape[<span class="number">0</span>] - y_train.shape[<span class="number">0</span>]/num_folds, <span class="number">-1</span>)).flatten()</div><div class="line">        classifier.train(train_X, train_y)</div><div class="line">        dists = classifier.compute_distances_no_loops(X_train_folds[fold])</div><div class="line">        y_test_pred = classifier.predict_labels(dists, k)</div><div class="line">        </div><div class="line">        num_correct = np.sum(y_test_pred == y_train_folds[fold])</div><div class="line">        accuracy = float(num_correct) / len(y_train_folds[fold])</div><div class="line">        k_to_accuracies[k].append(accuracy)</div><div class="line">        </div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment">#                                 END OF YOUR CODE                             #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"></div><div class="line"><span class="comment"># Print out the computed accuracies</span></div><div class="line"><span class="keyword">for</span> k <span class="keyword">in</span> sorted(k_to_accuracies):</div><div class="line">    <span class="keyword">for</span> accuracy <span class="keyword">in</span> k_to_accuracies[k]:</div><div class="line">        <span class="keyword">print</span> <span class="string">'k = %d, accuracy = %f'</span> % (k, accuracy)</div></pre></td></tr></table></figure><pre><code>k = 1, accuracy = 0.263000
k = 1, accuracy = 0.257000
k = 1, accuracy = 0.264000
k = 1, accuracy = 0.278000
k = 1, accuracy = 0.266000
k = 3, accuracy = 0.241000
k = 3, accuracy = 0.249000
k = 3, accuracy = 0.243000
k = 3, accuracy = 0.273000
k = 3, accuracy = 0.264000
k = 5, accuracy = 0.258000
k = 5, accuracy = 0.273000
k = 5, accuracy = 0.281000
k = 5, accuracy = 0.290000
k = 5, accuracy = 0.272000
k = 8, accuracy = 0.263000
k = 8, accuracy = 0.288000
k = 8, accuracy = 0.278000
k = 8, accuracy = 0.285000
k = 8, accuracy = 0.277000
k = 10, accuracy = 0.265000
k = 10, accuracy = 0.296000
k = 10, accuracy = 0.278000
k = 10, accuracy = 0.284000
k = 10, accuracy = 0.286000
k = 12, accuracy = 0.260000
k = 12, accuracy = 0.294000
k = 12, accuracy = 0.281000
k = 12, accuracy = 0.282000
k = 12, accuracy = 0.281000
k = 15, accuracy = 0.255000
k = 15, accuracy = 0.290000
k = 15, accuracy = 0.281000
k = 15, accuracy = 0.281000
k = 15, accuracy = 0.276000
k = 20, accuracy = 0.270000
k = 20, accuracy = 0.281000
k = 20, accuracy = 0.280000
k = 20, accuracy = 0.282000
k = 20, accuracy = 0.284000
k = 50, accuracy = 0.271000
k = 50, accuracy = 0.288000
k = 50, accuracy = 0.278000
k = 50, accuracy = 0.269000
k = 50, accuracy = 0.266000
k = 100, accuracy = 0.256000
k = 100, accuracy = 0.270000
k = 100, accuracy = 0.263000
k = 100, accuracy = 0.256000
k = 100, accuracy = 0.263000
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># plot the raw observations</span></div><div class="line"><span class="keyword">for</span> k <span class="keyword">in</span> k_choices:</div><div class="line">  accuracies = k_to_accuracies[k]</div><div class="line">  plt.scatter([k] * len(accuracies), accuracies)</div><div class="line"></div><div class="line"><span class="comment"># plot the trend line with error bars that correspond to standard deviation</span></div><div class="line">accuracies_mean = np.array([np.mean(v) <span class="keyword">for</span> k,v <span class="keyword">in</span> sorted(k_to_accuracies.items())])</div><div class="line">accuracies_std = np.array([np.std(v) <span class="keyword">for</span> k,v <span class="keyword">in</span> sorted(k_to_accuracies.items())])</div><div class="line">plt.errorbar(k_choices, accuracies_mean, yerr=accuracies_std)</div><div class="line">plt.title(<span class="string">'Cross-validation on k'</span>)</div><div class="line">plt.xlabel(<span class="string">'k'</span>)</div><div class="line">plt.ylabel(<span class="string">'Cross-validation accuracy'</span>)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/knn/cv.png" alt="cv"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Based on the cross-validation results above, choose the best value for k,   </span></div><div class="line"><span class="comment"># retrain the classifier using all the training data, and test it on the test</span></div><div class="line"><span class="comment"># data. You should be able to get above 28% accuracy on the test data.</span></div><div class="line">best_k = <span class="number">10</span></div><div class="line"></div><div class="line">classifier = KNearestNeighbor()</div><div class="line">classifier.train(X_train, y_train)</div><div class="line">y_test_pred = classifier.predict(X_test, k=best_k)</div><div class="line"></div><div class="line"><span class="comment"># Compute and display the accuracy</span></div><div class="line">num_correct = np.sum(y_test_pred == y_test)</div><div class="line">accuracy = float(num_correct) / num_test</div><div class="line"><span class="keyword">print</span> <span class="string">'Got %d / %d correct =&gt; accuracy: %f'</span> % (num_correct, num_test, accuracy)</div></pre></td></tr></table></figure><pre><code>Got 139 / 500 correct =&gt; accuracy: 0.278000
</code></pre><p>​</p><h1 id="k-nearest-neighbor-py"><a href="#k-nearest-neighbor-py" class="headerlink" title="k_nearest_neighbor.py"></a>k_nearest_neighbor.py</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> operator</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">KNearestNeighbor</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="string">""" a kNN classifier with L2 distance """</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self, X, y)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Train the classifier. For k-nearest neighbors this is just</div><div class="line">        memorizing the training data.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - X: A numpy array of shape (num_train, D) containing the training data</div><div class="line">          consisting of num_train samples each of dimension D.</div><div class="line">        - y: A numpy array of shape (N,) containing the training labels, where</div><div class="line">             y[i] is the label for X[i].</div><div class="line">        """</div><div class="line">        self.X_train = X</div><div class="line">        self.y_train = y</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(self, X, k=<span class="number">1</span>, num_loops=<span class="number">0</span>)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Predict labels for test data using this classifier.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - X: A numpy array of shape (num_test, D) containing</div><div class="line">             test data consisting of num_test samples each of dimension D.</div><div class="line">        - k: The number of nearest neighbors that vote for</div><div class="line">             the predicted labels.</div><div class="line">        - num_loops: Determines which implementation to use</div><div class="line">                     to compute distances</div><div class="line">          between training points and testing points.</div><div class="line"></div><div class="line">        Returns:</div><div class="line">        - y: A numpy array of shape (num_test,)</div><div class="line">             containing predicted labels for the</div><div class="line">             test data, where y[i] is the predicted</div><div class="line">             label for the test point X[i].</div><div class="line">        """</div><div class="line">        <span class="keyword">if</span> num_loops == <span class="number">0</span>:</div><div class="line">            dists = self.compute_distances_no_loops(X)</div><div class="line">        <span class="keyword">elif</span> num_loops == <span class="number">1</span>:</div><div class="line">            dists = self.compute_distances_one_loop(X)</div><div class="line">        <span class="keyword">elif</span> num_loops == <span class="number">2</span>:</div><div class="line">            dists = self.compute_distances_two_loops(X)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'Invalid value %d for num_loops'</span> % num_loops)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> self.predict_labels(dists, k=k)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compute_distances_two_loops</span><span class="params">(self, X)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Compute the distance between each test point in X and each training</div><div class="line">        point in self.X_train using a nested loop over both the training data</div><div class="line">        and the test data.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - X: A numpy array of shape (num_test, D) containing test data.</div><div class="line"></div><div class="line">        Returns:</div><div class="line">        - dists: A numpy array of shape (num_test, num_train) where dists[i, j]</div><div class="line">          is the Euclidean distance between the ith test point and the jth</div><div class="line">          training point.</div><div class="line">        """</div><div class="line">        num_test = X.shape[<span class="number">0</span>]</div><div class="line">        num_train = self.X_train.shape[<span class="number">0</span>]</div><div class="line">        dists = np.zeros((num_test, num_train))</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(num_test):</div><div class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> xrange(num_train):</div><div class="line">                <span class="comment">###############################################################</span></div><div class="line">                <span class="comment"># <span class="doctag">TODO:</span>                                                             #</span></div><div class="line">                <span class="comment"># Compute the l2 distance between the ith test point and the jth    #</span></div><div class="line">                <span class="comment"># training point, and store the result in dists[i, j]. You should   #</span></div><div class="line">                <span class="comment"># not use a loop over dimension.                                    #</span></div><div class="line">                <span class="comment">###############################################################</span></div><div class="line">                dists[i, j] = np.sqrt(np.sum((X[i, :] - self.X_train[j, :]) ** <span class="number">2</span>))</div><div class="line">            <span class="comment">###############################################################</span></div><div class="line">            <span class="comment">#                       END OF YOUR CODE                            #</span></div><div class="line">            <span class="comment">###############################################################</span></div><div class="line">        <span class="keyword">return</span> dists</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compute_distances_one_loop</span><span class="params">(self, X)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Compute the distance between each test point in X and each training point</div><div class="line">        in self.X_train using a single loop over the test data.</div><div class="line"></div><div class="line">        Input / Output: Same as compute_distances_two_loops</div><div class="line">        """</div><div class="line">        num_test = X.shape[<span class="number">0</span>]</div><div class="line">        num_train = self.X_train.shape[<span class="number">0</span>]</div><div class="line">        dists = np.zeros((num_test, num_train))</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(num_test):</div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            <span class="comment"># <span class="doctag">TODO:</span>                                                               #</span></div><div class="line">            <span class="comment"># Compute the l2 distance between the ith test point and all training #</span></div><div class="line">            <span class="comment"># points, and store the result in dists[i, :].                        #</span></div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            dists[i, :] = np.sqrt(np.sum(np.square(X[i, :] - self.X_train), axis=<span class="number">1</span>))</div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            <span class="comment">#                         END OF YOUR CODE                            #</span></div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">        <span class="keyword">return</span> dists</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compute_distances_no_loops</span><span class="params">(self, X)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Compute the distance between each test point in X and each training point</div><div class="line">        in self.X_train using no explicit loops.</div><div class="line"></div><div class="line">        Input / Output: Same as compute_distances_two_loops</div><div class="line">        """</div><div class="line">        num_test = X.shape[<span class="number">0</span>]</div><div class="line">        num_train = self.X_train.shape[<span class="number">0</span>]</div><div class="line">        dists = np.zeros((num_test, num_train))</div><div class="line">        <span class="comment">#######################################################################</span></div><div class="line">        <span class="comment"># <span class="doctag">TODO:</span>                                                                 #</span></div><div class="line">        <span class="comment"># Compute the l2 distance between all test points and all training      #</span></div><div class="line">        <span class="comment"># points without using any explicit loops, and store the result in      #</span></div><div class="line">        <span class="comment"># dists.                                                                #</span></div><div class="line">        <span class="comment">#                                                                       #</span></div><div class="line">        <span class="comment"># You should implement this function using only basic array operations; #</span></div><div class="line">        <span class="comment"># in particular you should not use functions from scipy.                #</span></div><div class="line">        <span class="comment">#                                                                       #</span></div><div class="line">        <span class="comment"># HINT: Try to formulate the l2 distance using matrix multiplication    #</span></div><div class="line">        <span class="comment">#       and two broadcast sums.                                         #</span></div><div class="line">        <span class="comment">#######################################################################</span></div><div class="line">        dists = np.sqrt(np.multiply(np.dot(X, self.X_train.T), <span class="number">-2</span>) +</div><div class="line">                        np.sum(self.X_train ** <span class="number">2</span>, axis=<span class="number">1</span>) +</div><div class="line">                        np.sum(X ** <span class="number">2</span>, axis=<span class="number">1</span>)[:, np.newaxis])</div><div class="line">        <span class="comment">#######################################################################</span></div><div class="line">        <span class="comment">#                         END OF YOUR CODE                              #</span></div><div class="line">        <span class="comment">#######################################################################</span></div><div class="line">        <span class="keyword">return</span> dists</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict_labels</span><span class="params">(self, dists, k=<span class="number">1</span>)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Given a matrix of distances between test points and training points,</div><div class="line">        predict a label for each test point.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - dists: A numpy array of shape (num_test, num_train) where dists[i, j]</div><div class="line">          gives the distance betwen the ith test point and the jth training point.</div><div class="line"></div><div class="line">        Returns:</div><div class="line">        - y: A numpy array of shape (num_test,) containing predicted labels for the</div><div class="line">          test data, where y[i] is the predicted label for the test point X[i].</div><div class="line">        """</div><div class="line">        num_test = dists.shape[<span class="number">0</span>]</div><div class="line">        y_pred = np.zeros(num_test)</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(num_test):</div><div class="line">            <span class="comment"># A list of length k storing the labels of the k nearest neighbors to</span></div><div class="line">            <span class="comment"># the ith test point.</span></div><div class="line">            closest_y = []</div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            <span class="comment"># <span class="doctag">TODO:</span>                                                                 #</span></div><div class="line">            <span class="comment"># Use the distance matrix to find the k nearest neighbors of the ith    #</span></div><div class="line">            <span class="comment"># testing point, and use self.y_train to find the labels of these       #</span></div><div class="line">            <span class="comment"># neighbors. Store these labels in closest_y.                           #</span></div><div class="line">            <span class="comment"># Hint: Look up the function numpy.argsort.                             #</span></div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            k_nearest_index = np.argsort(dists[i, :])[:k]</div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            <span class="comment"># <span class="doctag">TODO:</span>                                                                 #</span></div><div class="line">            <span class="comment"># Now that you have found the labels of the k nearest neighbors, you    #</span></div><div class="line">            <span class="comment"># need to find the most common label in the list closest_y of labels.   #</span></div><div class="line">            <span class="comment"># Store this label in y_pred[i]. Break ties by choosing the smaller     #</span></div><div class="line">            <span class="comment"># label.                                                                #</span></div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            closest_y = self.y_train[k_nearest_index]</div><div class="line">            labels_counts = &#123;&#125;</div><div class="line">            <span class="keyword">for</span> label <span class="keyword">in</span> closest_y:</div><div class="line">                <span class="keyword">if</span> label <span class="keyword">in</span> labels_counts.keys():</div><div class="line">                    labels_counts[label] += <span class="number">1</span></div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    labels_counts[label] = <span class="number">0</span></div><div class="line">            sorted_labels_counts = sorted(</div><div class="line">                labels_counts.items(), key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="keyword">True</span>)</div><div class="line">            y_pred[i] = sorted_labels_counts[<span class="number">0</span>][<span class="number">0</span>]</div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            <span class="comment">#                           END OF YOUR CODE                            #</span></div><div class="line">            <span class="comment">###################################################################</span></div><div class="line"></div><div class="line">        <span class="keyword">return</span> y_pred</div></pre></td></tr></table></figure></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/28/Python-data-analysis-Learning-note-Ch06/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracadabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracadabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/2017/02/28/Python-data-analysis-Learning-note-Ch06/" itemprop="url">Python data analysis Learning note Ch06</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-28T21:15:17+08:00">2017-02-28 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/02/28/Python-data-analysis-Learning-note-Ch06/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2017/02/28/Python-data-analysis-Learning-note-Ch06/" itemprop="commentsCount"></span> </a></span><span id="/2017/02/28/Python-data-analysis-Learning-note-Ch06/" class="leancloud_visitors" data-flag-title="Python data analysis Learning note Ch06"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="Data-loading-storage-and-file-formats"><a href="#Data-loading-storage-and-file-formats" class="headerlink" title="Data loading, storage, and file formats"></a>Data loading, storage, and file formats</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">np.random.seed(<span class="number">12345</span>)</div><div class="line">plt.rc(<span class="string">'figure'</span>, figsize=(<span class="number">10</span>, <span class="number">6</span>))</div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">np.set_printoptions(precision=<span class="number">4</span>)</div><div class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</div><div class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">%pwd</div></pre></td></tr></table></figure><pre><code>&apos;C:\\Users\\Ewan\\Downloads\\pydata-book-master&apos;
</code></pre><h2 id="Reading-and-Writing-Data-in-Text-Format"><a href="#Reading-and-Writing-Data-in-Text-Format" class="headerlink" title="Reading and Writing Data in Text Format"></a>Reading and Writing Data in Text Format</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!more ch06\ex1.csv</div></pre></td></tr></table></figure><pre><code>a,b,c,d,message
1,2,3,4,hello
5,6,7,8,world
9,10,11,12,foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">df = pd.read_csv(<span class="string">'ch06/ex1.csv'</span>)</div><div class="line">df</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br><td>hello</td><br></tr><br><tr><br><th>1</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.read_table(<span class="string">'ch06/ex1.csv'</span>, sep=<span class="string">','</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br><td>hello</td><br></tr><br><tr><br><th>1</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!more ch06\ex2.csv</div></pre></td></tr></table></figure><pre><code>1,2,3,4,hello
5,6,7,8,world
9,10,11,12,foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pd.read_csv(<span class="string">'ch06/ex2.csv'</span>, header=<span class="keyword">None</span>)</div><div class="line">pd.read_csv(<span class="string">'ch06/ex2.csv'</span>, names=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'message'</span>])</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br><th>3</th><br><th>4</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br><td>hello</td><br></tr><br><tr><br><th>1</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br><td>hello</td><br></tr><br><tr><br><th>1</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">names = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'message'</span>]</div><div class="line">pd.read_csv(<span class="string">'ch06/ex2.csv'</span>, names=names, index_col=<span class="string">'message'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br></tr><br><tr><br><th>message</th><br><th></th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>hello</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br></tr><br><tr><br><th>world</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br></tr><br><tr><br><th>foo</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">!more ch06\csv_mindex.csv</div><div class="line">parsed = pd.read_csv(<span class="string">'ch06/csv_mindex.csv'</span>, index_col=[<span class="string">'key1'</span>, <span class="string">'key2'</span>])</div><div class="line">parsed</div></pre></td></tr></table></figure><pre><code>key1,key2,value1,value2
one,a,1,2
one,b,3,4
one,c,5,6
one,d,7,8
two,a,9,10
two,b,11,12
two,c,13,14
two,d,15,16
</code></pre><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th></th><br><th>value1</th><br><th>value2</th><br></tr><br><tr><br><th>key1</th><br><th>key2</th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="4" valign="top">one</th><br><th>a</th><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>b</th><br><td>3</td><br><td>4</td><br></tr><br><tr><br><th>c</th><br><td>5</td><br><td>6</td><br></tr><br><tr><br><th>d</th><br><td>7</td><br><td>8</td><br></tr><br><tr><br><th rowspan="4" valign="top">two</th><br><th>a</th><br><td>9</td><br><td>10</td><br></tr><br><tr><br><th>b</th><br><td>11</td><br><td>12</td><br></tr><br><tr><br><th>c</th><br><td>13</td><br><td>14</td><br></tr><br><tr><br><th>d</th><br><td>15</td><br><td>16</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">list(open(<span class="string">'ch06/ex3.txt'</span>))</div></pre></td></tr></table></figure><pre><code>[&apos;            A         B         C\n&apos;,
 &apos;aaa -0.264438 -1.026059 -0.619500\n&apos;,
 &apos;bbb  0.927272  0.302904 -0.032399\n&apos;,
 &apos;ccc -0.264273 -0.386314 -0.217601\n&apos;,
 &apos;ddd -0.871858 -0.348382  1.100491\n&apos;]
</code></pre><p>采用正则表达式作为分隔符</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = pd.read_table(<span class="string">'ch06/ex3.txt'</span>, sep=<span class="string">'\s+'</span>)</div><div class="line">result</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>A</th><br><th>B</th><br><th>C</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>aaa</th><br><td>-0.264438</td><br><td>-1.026059</td><br><td>-0.619500</td><br></tr><br><tr><br><th>bbb</th><br><td>0.927272</td><br><td>0.302904</td><br><td>-0.032399</td><br></tr><br><tr><br><th>ccc</th><br><td>-0.264273</td><br><td>-0.386314</td><br><td>-0.217601</td><br></tr><br><tr><br><th>ddd</th><br><td>-0.871858</td><br><td>-0.348382</td><br><td>1.100491</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">!more ch06\ex4.csv</div><div class="line">pd.read_csv(<span class="string">'ch06/ex4.csv'</span>, skiprows=[<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>])</div></pre></td></tr></table></figure><pre><code># hey!
a,b,c,d,message
# just wanted to make things more difficult for you
# who reads CSV files with computers, anyway?
1,2,3,4,hello
5,6,7,8,world
9,10,11,12,foo
</code></pre><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br><td>hello</td><br></tr><br><tr><br><th>1</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">!more ch06\ex5.csv</div><div class="line">result = pd.read_csv(<span class="string">'ch06/ex5.csv'</span>)</div><div class="line">result</div><div class="line">pd.isnull(result)</div></pre></td></tr></table></figure><pre><code>something,a,b,c,d,message
one,1,2,3,4,NA
two,5,6,,8,world
three,9,10,11,12,foo
</code></pre><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>something</th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>one</td><br><td>1</td><br><td>2</td><br><td>3.0</td><br><td>4</td><br><td>NaN</td><br></tr><br><tr><br><th>1</th><br><td>two</td><br><td>5</td><br><td>6</td><br><td>NaN</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>three</td><br><td>9</td><br><td>10</td><br><td>11.0</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>something</th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>False</td><br><td>False</td><br><td>False</td><br><td>False</td><br><td>False</td><br><td>True</td><br></tr><br><tr><br><th>1</th><br><td>False</td><br><td>False</td><br><td>False</td><br><td>True</td><br><td>False</td><br><td>False</td><br></tr><br><tr><br><th>2</th><br><td>False</td><br><td>False</td><br><td>False</td><br><td>False</td><br><td>False</td><br><td>False</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = pd.read_csv(<span class="string">'ch06/ex5.csv'</span>, na_values=[<span class="string">'NULL'</span>])</div><div class="line">result</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>something</th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>one</td><br><td>1</td><br><td>2</td><br><td>3.0</td><br><td>4</td><br><td>NaN</td><br></tr><br><tr><br><th>1</th><br><td>two</td><br><td>5</td><br><td>6</td><br><td>NaN</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>three</td><br><td>9</td><br><td>10</td><br><td>11.0</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sentinels = &#123;<span class="string">'message'</span>: [<span class="string">'foo'</span>, <span class="string">'NA'</span>], <span class="string">'something'</span>: [<span class="string">'two'</span>]&#125;</div><div class="line">pd.read_csv(<span class="string">'ch06/ex5.csv'</span>, na_values=sentinels)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>something</th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>one</td><br><td>1</td><br><td>2</td><br><td>3.0</td><br><td>4</td><br><td>NaN</td><br></tr><br><tr><br><th>1</th><br><td>NaN</td><br><td>5</td><br><td>6</td><br><td>NaN</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>three</td><br><td>9</td><br><td>10</td><br><td>11.0</td><br><td>12</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><h3 id="逐块读取文本文件"><a href="#逐块读取文本文件" class="headerlink" title="逐块读取文本文件"></a>逐块读取文本文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = pd.read_csv(<span class="string">'ch06/ex6.csv'</span>)</div><div class="line">result</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br><th>key</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.467976</td><br><td>-0.038649</td><br><td>-0.295344</td><br><td>-1.824726</td><br><td>L</td><br></tr><br><tr><br><th>1</th><br><td>-0.358893</td><br><td>1.404453</td><br><td>0.704965</td><br><td>-0.200638</td><br><td>B</td><br></tr><br><tr><br><th>2</th><br><td>-0.501840</td><br><td>0.659254</td><br><td>-0.421691</td><br><td>-0.057688</td><br><td>G</td><br></tr><br><tr><br><th>3</th><br><td>0.204886</td><br><td>1.074134</td><br><td>1.388361</td><br><td>-0.982404</td><br><td>R</td><br></tr><br><tr><br><th>4</th><br><td>0.354628</td><br><td>-0.133116</td><br><td>0.283763</td><br><td>-0.837063</td><br><td>Q</td><br></tr><br><tr><br><th>5</th><br><td>1.817480</td><br><td>0.742273</td><br><td>0.419395</td><br><td>-2.251035</td><br><td>Q</td><br></tr><br><tr><br><th>6</th><br><td>-0.776764</td><br><td>0.935518</td><br><td>-0.332872</td><br><td>-1.875641</td><br><td>U</td><br></tr><br><tr><br><th>7</th><br><td>-0.913135</td><br><td>1.530624</td><br><td>-0.572657</td><br><td>0.477252</td><br><td>K</td><br></tr><br><tr><br><th>8</th><br><td>0.358480</td><br><td>-0.497572</td><br><td>-0.367016</td><br><td>0.507702</td><br><td>S</td><br></tr><br><tr><br><th>9</th><br><td>-1.740877</td><br><td>-1.160417</td><br><td>-1.637830</td><br><td>2.172201</td><br><td>G</td><br></tr><br><tr><br><th>10</th><br><td>0.240564</td><br><td>-0.328249</td><br><td>1.252155</td><br><td>1.072796</td><br><td>8</td><br></tr><br><tr><br><th>11</th><br><td>0.764018</td><br><td>1.165476</td><br><td>-0.639544</td><br><td>1.495258</td><br><td>R</td><br></tr><br><tr><br><th>12</th><br><td>0.571035</td><br><td>-0.310537</td><br><td>0.582437</td><br><td>-0.298765</td><br><td>1</td><br></tr><br><tr><br><th>13</th><br><td>2.317658</td><br><td>0.430710</td><br><td>-1.334216</td><br><td>0.199679</td><br><td>P</td><br></tr><br><tr><br><th>14</th><br><td>1.547771</td><br><td>-1.119753</td><br><td>-2.277634</td><br><td>0.329586</td><br><td>J</td><br></tr><br><tr><br><th>15</th><br><td>-1.310608</td><br><td>0.401719</td><br><td>-1.000987</td><br><td>1.156708</td><br><td>E</td><br></tr><br><tr><br><th>16</th><br><td>-0.088496</td><br><td>0.634712</td><br><td>0.153324</td><br><td>0.415335</td><br><td>B</td><br></tr><br><tr><br><th>17</th><br><td>-0.018663</td><br><td>-0.247487</td><br><td>-1.446522</td><br><td>0.750938</td><br><td>A</td><br></tr><br><tr><br><th>18</th><br><td>-0.070127</td><br><td>-1.579097</td><br><td>0.120892</td><br><td>0.671432</td><br><td>F</td><br></tr><br><tr><br><th>19</th><br><td>-0.194678</td><br><td>-0.492039</td><br><td>2.359605</td><br><td>0.319810</td><br><td>H</td><br></tr><br><tr><br><th>20</th><br><td>-0.248618</td><br><td>0.868707</td><br><td>-0.492226</td><br><td>-0.717959</td><br><td>W</td><br></tr><br><tr><br><th>21</th><br><td>-1.091549</td><br><td>-0.867110</td><br><td>-0.647760</td><br><td>-0.832562</td><br><td>C</td><br></tr><br><tr><br><th>22</th><br><td>0.641404</td><br><td>-0.138822</td><br><td>-0.621963</td><br><td>-0.284839</td><br><td>C</td><br></tr><br><tr><br><th>23</th><br><td>1.216408</td><br><td>0.992687</td><br><td>0.165162</td><br><td>-0.069619</td><br><td>V</td><br></tr><br><tr><br><th>24</th><br><td>-0.564474</td><br><td>0.792832</td><br><td>0.747053</td><br><td>0.571675</td><br><td>I</td><br></tr><br><tr><br><th>25</th><br><td>1.759879</td><br><td>-0.515666</td><br><td>-0.230481</td><br><td>1.362317</td><br><td>S</td><br></tr><br><tr><br><th>26</th><br><td>0.126266</td><br><td>0.309281</td><br><td>0.382820</td><br><td>-0.239199</td><br><td>L</td><br></tr><br><tr><br><th>27</th><br><td>1.334360</td><br><td>-0.100152</td><br><td>-0.840731</td><br><td>-0.643967</td><br><td>6</td><br></tr><br><tr><br><th>28</th><br><td>-0.737620</td><br><td>0.278087</td><br><td>-0.053235</td><br><td>-0.950972</td><br><td>J</td><br></tr><br><tr><br><th>29</th><br><td>-1.148486</td><br><td>-0.986292</td><br><td>-0.144963</td><br><td>0.124362</td><br><td>Y</td><br></tr><br><tr><br><th>…</th><br><td>…</td><br><td>…</td><br><td>…</td><br><td>…</td><br><td>…</td><br></tr><br><tr><br><th>9970</th><br><td>0.633495</td><br><td>-0.186524</td><br><td>0.927627</td><br><td>0.143164</td><br><td>4</td><br></tr><br><tr><br><th>9971</th><br><td>0.308636</td><br><td>-0.112857</td><br><td>0.762842</td><br><td>-1.072977</td><br><td>1</td><br></tr><br><tr><br><th>9972</th><br><td>-1.627051</td><br><td>-0.978151</td><br><td>0.154745</td><br><td>-1.229037</td><br><td>Z</td><br></tr><br><tr><br><th>9973</th><br><td>0.314847</td><br><td>0.097989</td><br><td>0.199608</td><br><td>0.955193</td><br><td>P</td><br></tr><br><tr><br><th>9974</th><br><td>1.666907</td><br><td>0.992005</td><br><td>0.496128</td><br><td>-0.686391</td><br><td>S</td><br></tr><br><tr><br><th>9975</th><br><td>0.010603</td><br><td>0.708540</td><br><td>-1.258711</td><br><td>0.226541</td><br><td>K</td><br></tr><br><tr><br><th>9976</th><br><td>0.118693</td><br><td>-0.714455</td><br><td>-0.501342</td><br><td>-0.254764</td><br><td>K</td><br></tr><br><tr><br><th>9977</th><br><td>0.302616</td><br><td>-2.011527</td><br><td>-0.628085</td><br><td>0.768827</td><br><td>H</td><br></tr><br><tr><br><th>9978</th><br><td>-0.098572</td><br><td>1.769086</td><br><td>-0.215027</td><br><td>-0.053076</td><br><td>A</td><br></tr><br><tr><br><th>9979</th><br><td>-0.019058</td><br><td>1.964994</td><br><td>0.738538</td><br><td>-0.883776</td><br><td>F</td><br></tr><br><tr><br><th>9980</th><br><td>-0.595349</td><br><td>0.001781</td><br><td>-1.423355</td><br><td>-1.458477</td><br><td>M</td><br></tr><br><tr><br><th>9981</th><br><td>1.392170</td><br><td>-1.396560</td><br><td>-1.425306</td><br><td>-0.847535</td><br><td>H</td><br></tr><br><tr><br><th>9982</th><br><td>-0.896029</td><br><td>-0.152287</td><br><td>1.924483</td><br><td>0.365184</td><br><td>6</td><br></tr><br><tr><br><th>9983</th><br><td>-2.274642</td><br><td>-0.901874</td><br><td>1.500352</td><br><td>0.996541</td><br><td>N</td><br></tr><br><tr><br><th>9984</th><br><td>-0.301898</td><br><td>1.019906</td><br><td>1.102160</td><br><td>2.624526</td><br><td>I</td><br></tr><br><tr><br><th>9985</th><br><td>-2.548389</td><br><td>-0.585374</td><br><td>1.496201</td><br><td>-0.718815</td><br><td>D</td><br></tr><br><tr><br><th>9986</th><br><td>-0.064588</td><br><td>0.759292</td><br><td>-1.568415</td><br><td>-0.420933</td><br><td>E</td><br></tr><br><tr><br><th>9987</th><br><td>-0.143365</td><br><td>-1.111760</td><br><td>-1.815581</td><br><td>0.435274</td><br><td>2</td><br></tr><br><tr><br><th>9988</th><br><td>-0.070412</td><br><td>-1.055921</td><br><td>0.338017</td><br><td>-0.440763</td><br><td>X</td><br></tr><br><tr><br><th>9989</th><br><td>0.649148</td><br><td>0.994273</td><br><td>-1.384227</td><br><td>0.485120</td><br><td>Q</td><br></tr><br><tr><br><th>9990</th><br><td>-0.370769</td><br><td>0.404356</td><br><td>-1.051628</td><br><td>-1.050899</td><br><td>8</td><br></tr><br><tr><br><th>9991</th><br><td>-0.409980</td><br><td>0.155627</td><br><td>-0.818990</td><br><td>1.277350</td><br><td>W</td><br></tr><br><tr><br><th>9992</th><br><td>0.301214</td><br><td>-1.111203</td><br><td>0.668258</td><br><td>0.671922</td><br><td>A</td><br></tr><br><tr><br><th>9993</th><br><td>1.821117</td><br><td>0.416445</td><br><td>0.173874</td><br><td>0.505118</td><br><td>X</td><br></tr><br><tr><br><th>9994</th><br><td>0.068804</td><br><td>1.322759</td><br><td>0.802346</td><br><td>0.223618</td><br><td>H</td><br></tr><br><tr><br><th>9995</th><br><td>2.311896</td><br><td>-0.417070</td><br><td>-1.409599</td><br><td>-0.515821</td><br><td>L</td><br></tr><br><tr><br><th>9996</th><br><td>-0.479893</td><br><td>-0.650419</td><br><td>0.745152</td><br><td>-0.646038</td><br><td>E</td><br></tr><br><tr><br><th>9997</th><br><td>0.523331</td><br><td>0.787112</td><br><td>0.486066</td><br><td>1.093156</td><br><td>K</td><br></tr><br><tr><br><th>9998</th><br><td>-0.362559</td><br><td>0.598894</td><br><td>-1.843201</td><br><td>0.887292</td><br><td>G</td><br></tr><br><tr><br><th>9999</th><br><td>-0.096376</td><br><td>-1.012999</td><br><td>-0.657431</td><br><td>-0.573315</td><br><td>0</td><br></tr><br><br></tbody><br></table><br><p>10000 rows × 5 columns</p><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.read_csv(<span class="string">'ch06/ex6.csv'</span>, nrows=<span class="number">5</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br><th>key</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.467976</td><br><td>-0.038649</td><br><td>-0.295344</td><br><td>-1.824726</td><br><td>L</td><br></tr><br><tr><br><th>1</th><br><td>-0.358893</td><br><td>1.404453</td><br><td>0.704965</td><br><td>-0.200638</td><br><td>B</td><br></tr><br><tr><br><th>2</th><br><td>-0.501840</td><br><td>0.659254</td><br><td>-0.421691</td><br><td>-0.057688</td><br><td>G</td><br></tr><br><tr><br><th>3</th><br><td>0.204886</td><br><td>1.074134</td><br><td>1.388361</td><br><td>-0.982404</td><br><td>R</td><br></tr><br><tr><br><th>4</th><br><td>0.354628</td><br><td>-0.133116</td><br><td>0.283763</td><br><td>-0.837063</td><br><td>Q</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chunker = pd.read_csv(<span class="string">'ch06/ex6.csv'</span>, chunksize=<span class="number">1000</span>)</div><div class="line">chunker</div></pre></td></tr></table></figure><pre><code>&lt;pandas.io.parsers.TextFileReader at 0x2035229de80&gt;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">chunker = pd.read_csv(<span class="string">'ch06/ex6.csv'</span>, chunksize=<span class="number">1000</span>)</div><div class="line"></div><div class="line">tot = Series([])</div><div class="line"><span class="keyword">for</span> piece <span class="keyword">in</span> chunker:</div><div class="line">    tot = tot.add(piece[<span class="string">'key'</span>].value_counts(), fill_value=<span class="number">0</span>)</div><div class="line"></div><div class="line">tot = tot.sort_values(ascending=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tot[:<span class="number">10</span>]</div></pre></td></tr></table></figure><pre><code>E    368.0
X    364.0
L    346.0
O    343.0
Q    340.0
M    338.0
J    337.0
F    335.0
K    334.0
H    330.0
dtype: float64
</code></pre><h3 id="将数据写出到文本格式"><a href="#将数据写出到文本格式" class="headerlink" title="将数据写出到文本格式"></a>将数据写出到文本格式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data = pd.read_csv(<span class="string">'ch06/ex5.csv'</span>)</div><div class="line">data</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>something</th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>one</td><br><td>1</td><br><td>2</td><br><td>3.0</td><br><td>4</td><br><td>NaN</td><br></tr><br><tr><br><th>1</th><br><td>two</td><br><td>5</td><br><td>6</td><br><td>NaN</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>three</td><br><td>9</td><br><td>10</td><br><td>11.0</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data.to_csv(<span class="string">'ch06/out.csv'</span>)</div><div class="line">!more ch06\out.csv</div></pre></td></tr></table></figure><pre><code>,something,a,b,c,d,message
0,one,1,2,3.0,4,
1,two,5,6,,8,world
2,three,9,10,11.0,12,foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.to_csv(sys.stdout, sep=<span class="string">'|'</span>)</div></pre></td></tr></table></figure><pre><code>|something|a|b|c|d|message
0|one|1|2|3.0|4|
1|two|5|6||8|world
2|three|9|10|11.0|12|foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.to_csv(sys.stdout, na_rep=<span class="string">'NULL'</span>)</div></pre></td></tr></table></figure><pre><code>,something,a,b,c,d,message
0,one,1,2,3.0,4,NULL
1,two,5,6,NULL,8,world
2,three,9,10,11.0,12,foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.to_csv(sys.stdout, index=<span class="keyword">False</span>, header=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><pre><code>one,1,2,3.0,4,
two,5,6,,8,world
three,9,10,11.0,12,foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.to_csv(sys.stdout, index=<span class="keyword">False</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div></pre></td></tr></table></figure><pre><code>a,b,c
1,2,3.0
5,6,
9,10,11.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">dates = pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">7</span>)</div><div class="line">dates</div><div class="line">ts = Series(np.arange(<span class="number">7</span>), index=dates)</div><div class="line">ts</div><div class="line">ts.to_csv(<span class="string">'ch06/tseries.csv'</span>)</div><div class="line">!more ch06\tseries.csv</div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&apos;2000-01-01&apos;, &apos;2000-01-02&apos;, &apos;2000-01-03&apos;, &apos;2000-01-04&apos;,
               &apos;2000-01-05&apos;, &apos;2000-01-06&apos;, &apos;2000-01-07&apos;],
              dtype=&apos;datetime64[ns]&apos;, freq=&apos;D&apos;)






2000-01-01    0
2000-01-02    1
2000-01-03    2
2000-01-04    3
2000-01-05    4
2000-01-06    5
2000-01-07    6
Freq: D, dtype: int32



2000-01-01,0
2000-01-02,1
2000-01-03,2
2000-01-04,3
2000-01-05,4
2000-01-06,5
2000-01-07,6
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Series.from_csv(<span class="string">'ch06/tseries.csv'</span>, parse_dates=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><pre><code>2000-01-01    0
2000-01-02    1
2000-01-03    2
2000-01-04    3
2000-01-05    4
2000-01-06    5
2000-01-07    6
dtype: int64
</code></pre><h3 id="手动处理分隔符格式"><a href="#手动处理分隔符格式" class="headerlink" title="手动处理分隔符格式"></a>手动处理分隔符格式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!more ch06\ex7.csv</div></pre></td></tr></table></figure><pre><code>&quot;a&quot;,&quot;b&quot;,&quot;c&quot;
&quot;1&quot;,&quot;2&quot;,&quot;3&quot;
&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> csv</div><div class="line">f = open(<span class="string">'ch06/ex7.csv'</span>)</div><div class="line"></div><div class="line">reader = csv.reader(f)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> line <span class="keyword">in</span> reader:</div><div class="line">    print(line)</div></pre></td></tr></table></figure><pre><code>[&apos;a&apos;, &apos;b&apos;, &apos;c&apos;]
[&apos;1&apos;, &apos;2&apos;, &apos;3&apos;]
[&apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">lines = list(csv.reader(open(<span class="string">'ch06/ex7.csv'</span>)))</div><div class="line">header, values = lines[<span class="number">0</span>], lines[<span class="number">1</span>:]</div><div class="line"><span class="keyword">for</span> item <span class="keyword">in</span> zip(*values):</div><div class="line">    print(item)</div><div class="line">    </div><div class="line"><span class="keyword">for</span> h, v <span class="keyword">in</span> zip(header, zip(*values)):</div><div class="line">    print(h, v)</div><div class="line"></div><div class="line">data_dict = &#123;h: v <span class="keyword">for</span> h, v <span class="keyword">in</span> zip(header, zip(*values))&#125;</div><div class="line">data_dict</div></pre></td></tr></table></figure><pre><code>(&apos;1&apos;, &apos;1&apos;)
(&apos;2&apos;, &apos;2&apos;)
(&apos;3&apos;, &apos;3&apos;)
a (&apos;1&apos;, &apos;1&apos;)
b (&apos;2&apos;, &apos;2&apos;)
c (&apos;3&apos;, &apos;3&apos;)





{&apos;a&apos;: (&apos;1&apos;, &apos;1&apos;), &apos;b&apos;: (&apos;2&apos;, &apos;2&apos;), &apos;c&apos;: (&apos;3&apos;, &apos;3&apos;)}
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">my_dialect</span><span class="params">(csv.Dialect)</span>:</span></div><div class="line">    lineterminator = <span class="string">'\n'</span></div><div class="line">    delimiter = <span class="string">';'</span></div><div class="line">    quotechar = <span class="string">'"'</span></div><div class="line">    quoting = csv.QUOTE_MINIMAL</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> open(<span class="string">'mydata.csv'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</div><div class="line">    writer = csv.writer(f, dialect=my_dialect)</div><div class="line">    writer.writerow((<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>))</div><div class="line">    writer.writerow((<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>))</div><div class="line">    writer.writerow((<span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>))</div><div class="line">    writer.writerow((<span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>))</div></pre></td></tr></table></figure><pre><code>14






6






6






6
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!more mydata.csv</div></pre></td></tr></table></figure><pre><code>one;two;three
1;2;3
4;5;6
7;8;9
</code></pre><h3 id="JSON数据"><a href="#JSON数据" class="headerlink" title="JSON数据"></a>JSON数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">obj = <span class="string">"""</span></div><div class="line">&#123;"name": "Wes",</div><div class="line"> "places_lived": ["United States", "Spain", "Germany"],</div><div class="line"> "pet": null,</div><div class="line"> "siblings": [&#123;"name": "Scott", "age": 25, "pet": "Zuko"&#125;,</div><div class="line">              &#123;"name": "Katie", "age": 33, "pet": "Cisco"&#125;]</div><div class="line">&#125;</div><div class="line">"""</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> json</div><div class="line">result = json.loads(obj)</div><div class="line">result</div></pre></td></tr></table></figure><pre><code>{&apos;name&apos;: &apos;Wes&apos;,
 &apos;pet&apos;: None,
 &apos;places_lived&apos;: [&apos;United States&apos;, &apos;Spain&apos;, &apos;Germany&apos;],
 &apos;siblings&apos;: [{&apos;age&apos;: 25, &apos;name&apos;: &apos;Scott&apos;, &apos;pet&apos;: &apos;Zuko&apos;},
  {&apos;age&apos;: 33, &apos;name&apos;: &apos;Katie&apos;, &apos;pet&apos;: &apos;Cisco&apos;}]}
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">asjson = json.dumps(result) <span class="comment"># convert to json</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">siblings = DataFrame(result[<span class="string">'siblings'</span>], columns=[<span class="string">'name'</span>, <span class="string">'age'</span>])</div><div class="line">siblings</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>name</th><br><th>age</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>Scott</td><br><td>25</td><br></tr><br><tr><br><th>1</th><br><td>Katie</td><br><td>33</td><br></tr><br><br></tbody><br></table><br></div><h3 id="XML和HTML：-Web信息收集"><a href="#XML和HTML：-Web信息收集" class="headerlink" title="XML和HTML： Web信息收集"></a>XML和HTML： Web信息收集</h3><p><strong>NB. The Yahoo! Finance API has changed and this example no longer works</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> lxml.html <span class="keyword">import</span> parse</div><div class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</div><div class="line"></div><div class="line">parsed = parse(urlopen(<span class="string">'http://finance.yahoo.com/q/op?s=AAPL+Options'</span>))</div><div class="line"></div><div class="line">doc = parsed.getroot()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">links = doc.findall(<span class="string">'.//a'</span>)</div><div class="line">links[<span class="number">15</span>:<span class="number">20</span>]</div></pre></td></tr></table></figure><pre><code>[&lt;Element a at 0x20352cad598&gt;,
 &lt;Element a at 0x20352cad5e8&gt;,
 &lt;Element a at 0x20352cad638&gt;,
 &lt;Element a at 0x20352cad688&gt;,
 &lt;Element a at 0x20352cad6d8&gt;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">lnk = links[<span class="number">28</span>]</div><div class="line">lnk</div><div class="line">lnk.get(<span class="string">'href'</span>)</div><div class="line">lnk.text_content()</div></pre></td></tr></table></figure><pre><code>&lt;Element a at 0x20352cad9a8&gt;






&apos;/quote/NFLX?p=NFLX&apos;






&apos;NFLX&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">urls = [lnk.get(<span class="string">'href'</span>) <span class="keyword">for</span> lnk <span class="keyword">in</span> doc.findall(<span class="string">'.//a'</span>)]</div><div class="line">urls[<span class="number">-10</span>:]</div></pre></td></tr></table></figure><pre><code>[&apos;//finance.yahoo.com/broker-comparison?bypass=true&apos;,
 &apos;https://help.yahoo.com/kb/index?page=content&amp;y=PROD_MAIL_ML&amp;locale=en_US&amp;id=SLN2310&amp;actp=productlink&apos;,
 &apos;http://help.yahoo.com/l/us/yahoo/finance/&apos;,
 &apos;https://yahoo.uservoice.com/forums/382977&apos;,
 &apos;http://info.yahoo.com/privacy/us/yahoo/&apos;,
 &apos;http://info.yahoo.com/relevantads/&apos;,
 &apos;http://info.yahoo.com/legal/us/yahoo/utos/utos-173.html&apos;,
 &apos;http://twitter.com/YahooFinance&apos;,
 &apos;http://facebook.com/yahoofinance&apos;,
 &apos;http://yahoofinance.tumblr.com&apos;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">tables = doc.findall(<span class="string">'.//table'</span>)</div><div class="line">len(tables)</div><div class="line">calls = tables[<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>1
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rows = calls.findall(<span class="string">'.//tr'</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_unpack</span><span class="params">(row, kind=<span class="string">'td'</span>)</span>:</span></div><div class="line">    elts = row.findall(<span class="string">'.//%s'</span> % kind)</div><div class="line">    <span class="keyword">return</span> [val.text_content() <span class="keyword">for</span> val <span class="keyword">in</span> elts]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_unpack(rows[<span class="number">0</span>], kind=<span class="string">'th'</span>)</div><div class="line">_unpack(rows[<span class="number">1</span>], kind=<span class="string">'td'</span>)</div></pre></td></tr></table></figure><pre><code>[]




---------------------------------------------------------------------------

IndexError                                Traceback (most recent call last)

&lt;ipython-input-87-7d371ed47023&gt; in &lt;module&gt;()
      1 _unpack(rows[0], kind=&apos;th&apos;)
----&gt; 2 _unpack(rows[1], kind=&apos;td&apos;)


IndexError: list index out of range
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pandas.io.parsers <span class="keyword">import</span> TextParser</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_options_data</span><span class="params">(table)</span>:</span></div><div class="line">    rows = table.findall(<span class="string">'.//tr'</span>)</div><div class="line">    header = _unpack(rows[<span class="number">0</span>], kind=<span class="string">'th'</span>)</div><div class="line">    data = [_unpack(r) <span class="keyword">for</span> r <span class="keyword">in</span> rows[<span class="number">1</span>:]]</div><div class="line">    <span class="keyword">return</span> TextParser(data, names=header).get_chunk()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">call_data = parse_options_data(calls)</div><div class="line">put_data = parse_options_data(puts)</div><div class="line">call_data[:<span class="number">10</span>]</div></pre></td></tr></table></figure><h4 id="Parsing-XML-with-lxml-objectify"><a href="#Parsing-XML-with-lxml-objectify" class="headerlink" title="Parsing XML with lxml.objectify"></a>Parsing XML with lxml.objectify</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> objectify</div><div class="line"></div><div class="line">path = <span class="string">'.\ch06\mta_perf\Performance_MNR.xml'</span></div><div class="line">parsed = objectify.parse(open(path))</div><div class="line">root = parsed.getroot()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">data = []</div><div class="line"></div><div class="line">skip_fields = [<span class="string">'PARENT_SEQ'</span>, <span class="string">'INDICATOR_SEQ'</span>,</div><div class="line">               <span class="string">'DESIRED_CHANGE'</span>, <span class="string">'DECIMAL_PLACES'</span>]</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">for</span> elt <span class="keyword">in</span> root.INDICATOR:</div><div class="line">    el_data = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> child <span class="keyword">in</span> elt.getchildren():</div><div class="line">        <span class="keyword">if</span> child.tag <span class="keyword">in</span> skip_fields:</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        el_data[child.tag] = child.pyval</div><div class="line">    data.append(el_data)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">perf = DataFrame(data)</div><div class="line">perf.ix[:<span class="number">10</span>, <span class="number">5</span>:]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>INDICATOR_UNIT</th><br><th>MONTHLY_ACTUAL</th><br><th>MONTHLY_TARGET</th><br><th>PERIOD_MONTH</th><br><th>PERIOD_YEAR</th><br><th>YTD_ACTUAL</th><br><th>YTD_TARGET</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>%</td><br><td>96.9</td><br><td>95</td><br><td>1</td><br><td>2008</td><br><td>96.9</td><br><td>95</td><br></tr><br><tr><br><th>1</th><br><td>%</td><br><td>95</td><br><td>95</td><br><td>2</td><br><td>2008</td><br><td>96</td><br><td>95</td><br></tr><br><tr><br><th>2</th><br><td>%</td><br><td>96.9</td><br><td>95</td><br><td>3</td><br><td>2008</td><br><td>96.3</td><br><td>95</td><br></tr><br><tr><br><th>3</th><br><td>%</td><br><td>98.3</td><br><td>95</td><br><td>4</td><br><td>2008</td><br><td>96.8</td><br><td>95</td><br></tr><br><tr><br><th>4</th><br><td>%</td><br><td>95.8</td><br><td>95</td><br><td>5</td><br><td>2008</td><br><td>96.6</td><br><td>95</td><br></tr><br><tr><br><th>5</th><br><td>%</td><br><td>94.4</td><br><td>95</td><br><td>6</td><br><td>2008</td><br><td>96.2</td><br><td>95</td><br></tr><br><tr><br><th>6</th><br><td>%</td><br><td>96</td><br><td>95</td><br><td>7</td><br><td>2008</td><br><td>96.2</td><br><td>95</td><br></tr><br><tr><br><th>7</th><br><td>%</td><br><td>96.4</td><br><td>95</td><br><td>8</td><br><td>2008</td><br><td>96.2</td><br><td>95</td><br></tr><br><tr><br><th>8</th><br><td>%</td><br><td>93.7</td><br><td>95</td><br><td>9</td><br><td>2008</td><br><td>95.9</td><br><td>95</td><br></tr><br><tr><br><th>9</th><br><td>%</td><br><td>96.4</td><br><td>95</td><br><td>10</td><br><td>2008</td><br><td>96</td><br><td>95</td><br></tr><br><tr><br><th>10</th><br><td>%</td><br><td>96.9</td><br><td>95</td><br><td>11</td><br><td>2008</td><br><td>96.1</td><br><td>95</td><br></tr><br><br></tbody><br></table><br></div><h2 id="二进制数据格式"><a href="#二进制数据格式" class="headerlink" title="二进制数据格式"></a>二进制数据格式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame = pd.read_csv(<span class="string">'ch06/ex1.csv'</span>)</div><div class="line">frame</div><div class="line">frame.to_pickle(<span class="string">'ch06/frame_pickle'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br><td>hello</td><br></tr><br><tr><br><th>1</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.read_pickle(<span class="string">'ch06/frame_pickle'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br><td>hello</td><br></tr><br><tr><br><th>1</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><h3 id="使用HDF5格式"><a href="#使用HDF5格式" class="headerlink" title="使用HDF5格式"></a>使用HDF5格式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">store = pd.HDFStore(<span class="string">'mydata.h5'</span>)</div><div class="line">store[<span class="string">'obj1'</span>] = frame</div><div class="line">store[<span class="string">'obj1_col'</span>] = frame[<span class="string">'a'</span>]</div><div class="line">store</div></pre></td></tr></table></figure><pre><code>&lt;class &apos;pandas.io.pytables.HDFStore&apos;&gt;
File path: mydata.h5
/obj1                frame        (shape-&gt;[3,5])
/obj1_col            series       (shape-&gt;[3])  
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">store[<span class="string">'obj1'</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br><td>hello</td><br></tr><br><tr><br><th>1</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">store.close()</div><div class="line">os.remove(<span class="string">'mydata.h5'</span>)</div></pre></td></tr></table></figure><h2 id="使用数据库"><a href="#使用数据库" class="headerlink" title="使用数据库"></a>使用数据库</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sqlite3</div><div class="line"></div><div class="line">query = <span class="string">"""</span></div><div class="line">CREATE TABLE test</div><div class="line">(a VARCHAR(20), b VARCHAR(20),</div><div class="line"> c REAL,        d INTEGER</div><div class="line">);"""</div><div class="line"></div><div class="line">con = sqlite3.connect(<span class="string">':memory:'</span>)</div><div class="line">con.execute(query)</div><div class="line">con.commit()</div></pre></td></tr></table></figure><pre><code>&lt;sqlite3.Cursor at 0x2035487c880&gt;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">data = [(<span class="string">'Atlanta'</span>, <span class="string">'Georgia'</span>, <span class="number">1.25</span>, <span class="number">6</span>),</div><div class="line">        (<span class="string">'Tallahassee'</span>, <span class="string">'Florida'</span>, <span class="number">2.6</span>, <span class="number">3</span>),</div><div class="line">        (<span class="string">'Sacramento'</span>, <span class="string">'California'</span>, <span class="number">1.7</span>, <span class="number">5</span>)]</div><div class="line">stmt = <span class="string">"INSERT INTO test VALUES(?, ?, ?, ?)"</span></div><div class="line"></div><div class="line">con.executemany(stmt, data)</div><div class="line">con.commit()</div></pre></td></tr></table></figure><pre><code>&lt;sqlite3.Cursor at 0x2035487c810&gt;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cursor = con.execute(<span class="string">'select * from test'</span>)</div><div class="line">rows = cursor.fetchall()</div><div class="line">rows</div></pre></td></tr></table></figure><pre><code>[(&apos;Atlanta&apos;, &apos;Georgia&apos;, 1.25, 6),
 (&apos;Tallahassee&apos;, &apos;Florida&apos;, 2.6, 3),
 (&apos;Sacramento&apos;, &apos;California&apos;, 1.7, 5)]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas.io.sql <span class="keyword">as</span> sql</div><div class="line">sql.read_sql(<span class="string">'select * from test'</span>, con)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>Atlanta</td><br><td>Georgia</td><br><td>1.25</td><br><td>6</td><br></tr><br><tr><br><th>1</th><br><td>Tallahassee</td><br><td>Florida</td><br><td>2.60</td><br><td>3</td><br></tr><br><tr><br><th>2</th><br><td>Sacramento</td><br><td>California</td><br><td>1.70</td><br><td>5</td><br></tr><br><br></tbody><br></table><br></div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/28/Python-data-analysis-Learning-note-ch05/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracadabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracadabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/2017/02/28/Python-data-analysis-Learning-note-ch05/" itemprop="url">Python data analysis Learning note ch05</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-28T18:05:03+08:00">2017-02-28 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/02/28/Python-data-analysis-Learning-note-ch05/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2017/02/28/Python-data-analysis-Learning-note-ch05/" itemprop="commentsCount"></span> </a></span><span id="/2017/02/28/Python-data-analysis-Learning-note-ch05/" class="leancloud_visitors" data-flag-title="Python data analysis Learning note ch05"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="pandas入门"><a href="#pandas入门" class="headerlink" title="pandas入门"></a>pandas入门</h1><p>按照以下约定引用相关package</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">np.random.seed(<span class="number">12345</span>)</div><div class="line">plt.rc(<span class="string">'figure'</span>, figsize=(<span class="number">10</span>, <span class="number">6</span>))</div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">np.set_printoptions(precision=<span class="number">4</span>)</div><div class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</div><div class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></div></pre></td></tr></table></figure><h2 id="pandas数据结构介绍"><a href="#pandas数据结构介绍" class="headerlink" title="pandas数据结构介绍"></a>pandas数据结构介绍</h2><h3 id="Series"><a href="#Series" class="headerlink" title="Series"></a>Series</h3><p>Series是一种类似于一维数组的对象，由一组数据以及一组与之相关的数据标签（类似于字典的键）组成，所以可以看成是一个<strong>有序</strong>的字典</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">4</span>, <span class="number">7</span>, <span class="number">-5</span>, <span class="number">3</span>])</div><div class="line">obj</div></pre></td></tr></table></figure><pre><code>0    4
1    7
2   -5
3    3
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj.values</div><div class="line">obj.index</div></pre></td></tr></table></figure><pre><code>array([ 4,  7, -5,  3], dtype=int64)






RangeIndex(start=0, stop=4, step=1)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj2 = Series([<span class="number">4</span>, <span class="number">7</span>, <span class="number">-5</span>, <span class="number">3</span>], index=[<span class="string">'d'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>])</div><div class="line">obj2</div></pre></td></tr></table></figure><pre><code>d    4
b    7
a   -5
c    3
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj2.index</div></pre></td></tr></table></figure><pre><code>Index([&apos;d&apos;, &apos;b&apos;, &apos;a&apos;, &apos;c&apos;], dtype=&apos;object&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj2[<span class="string">'a'</span>]</div></pre></td></tr></table></figure><pre><code>-5
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj2[<span class="string">'d'</span>] = <span class="number">6</span></div><div class="line">obj2[[<span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]]</div></pre></td></tr></table></figure><pre><code>c    3
a   -5
d    6
dtype: int64
</code></pre><p>各种Numpy运算都是作用在数据上，同时索引与数据的链接会一直保持</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj2[obj2 &gt; <span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>d    6
b    7
c    3
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj2 * <span class="number">2</span></div></pre></td></tr></table></figure><pre><code>d    12
b    14
a   -10
c     6
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.exp(obj2)</div></pre></td></tr></table></figure><pre><code>d     403.428793
b    1096.633158
a       0.006738
c      20.085537
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">'b'</span> <span class="keyword">in</span> obj2</div></pre></td></tr></table></figure><pre><code>True
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">'e'</span> <span class="keyword">in</span> obj2</div></pre></td></tr></table></figure><pre><code>False
</code></pre><p>因此可以直接根据Numpy的Dict来创建Series</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sdata = &#123;<span class="string">'Ohio'</span>: <span class="number">35000</span>, <span class="string">'Texas'</span>: <span class="number">71000</span>, <span class="string">'Oregon'</span>: <span class="number">16000</span>, <span class="string">'Utah'</span>: <span class="number">5000</span>&#125;</div><div class="line">obj3 = Series(sdata)</div><div class="line">obj3</div></pre></td></tr></table></figure><pre><code>Ohio      35000
Oregon    16000
Texas     71000
Utah       5000
dtype: int64
</code></pre><p>如果传入了index参数的话，那么就会与传入的Dict做键匹配，没有匹配上的就设为NaN</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">states = [<span class="string">'California'</span>, <span class="string">'Ohio'</span>, <span class="string">'Oregon'</span>, <span class="string">'Texas'</span>]</div><div class="line">obj4 = Series(sdata, index=states)</div><div class="line">obj4</div></pre></td></tr></table></figure><pre><code>California        NaN
Ohio          35000.0
Oregon        16000.0
Texas         71000.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.isnull(obj4)</div></pre></td></tr></table></figure><pre><code>California     True
Ohio          False
Oregon        False
Texas         False
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.notnull(obj4)</div></pre></td></tr></table></figure><pre><code>California    False
Ohio           True
Oregon         True
Texas          True
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj4.isnull()</div></pre></td></tr></table></figure><pre><code>California     True
Ohio          False
Oregon        False
Texas         False
dtype: bool
</code></pre><p>Series有一个非常重要的数据对齐的功能</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj3</div></pre></td></tr></table></figure><pre><code>Ohio      35000
Oregon    16000
Texas     71000
Utah       5000
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj4</div></pre></td></tr></table></figure><pre><code>California        NaN
Ohio          35000.0
Oregon        16000.0
Texas         71000.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj3 + obj4</div></pre></td></tr></table></figure><pre><code>California         NaN
Ohio           70000.0
Oregon         32000.0
Texas         142000.0
Utah               NaN
dtype: float64
</code></pre><p>Series本身以及其索引都有一个叫做name的属性，这个属性十分重要，以后很多高级功能都会用到</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">obj4.name = <span class="string">'population'</span></div><div class="line">obj4.index.name = <span class="string">'state'</span></div><div class="line">obj4</div></pre></td></tr></table></figure><pre><code>state
California        NaN
Ohio          35000.0
Oregon        16000.0
Texas         71000.0
Name: population, dtype: float64
</code></pre><p>可以通过直接赋值的方式修改index属性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj.index = [<span class="string">'Bob'</span>, <span class="string">'Steve'</span>, <span class="string">'Jeff'</span>, <span class="string">'Ryan'</span>]</div><div class="line">obj</div></pre></td></tr></table></figure><pre><code>Bob      4
Steve    7
Jeff    -5
Ryan     3
dtype: int64
</code></pre><h3 id="DataFrame"><a href="#DataFrame" class="headerlink" title="DataFrame"></a>DataFrame</h3><p>DataFrame是一个表格型的数据结构，可以看成由Series组成的字典，只不过这些Series共用一套索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = &#123;<span class="string">'state'</span>: [<span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Nevada'</span>, <span class="string">'Nevada'</span>],</div><div class="line">        <span class="string">'year'</span>: [<span class="number">2000</span>, <span class="number">2001</span>, <span class="number">2002</span>, <span class="number">2001</span>, <span class="number">2002</span>],</div><div class="line">        <span class="string">'pop'</span>: [<span class="number">1.5</span>, <span class="number">1.7</span>, <span class="number">3.6</span>, <span class="number">2.4</span>, <span class="number">2.9</span>]&#125;</div><div class="line">frame = DataFrame(data)</div></pre></td></tr></table></figure><p>数据会被排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>pop</th><br><th>state</th><br><th>year</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1.5</td><br><td>Ohio</td><br><td>2000</td><br></tr><br><tr><br><th>1</th><br><td>1.7</td><br><td>Ohio</td><br><td>2001</td><br></tr><br><tr><br><th>2</th><br><td>3.6</td><br><td>Ohio</td><br><td>2002</td><br></tr><br><tr><br><th>3</th><br><td>2.4</td><br><td>Nevada</td><br><td>2001</td><br></tr><br><tr><br><th>4</th><br><td>2.9</td><br><td>Nevada</td><br><td>2002</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">DataFrame(data, columns=[<span class="string">'year'</span>, <span class="string">'state'</span>, <span class="string">'pop'</span>])</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>year</th><br><th>state</th><br><th>pop</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>2000</td><br><td>Ohio</td><br><td>1.5</td><br></tr><br><tr><br><th>1</th><br><td>2001</td><br><td>Ohio</td><br><td>1.7</td><br></tr><br><tr><br><th>2</th><br><td>2002</td><br><td>Ohio</td><br><td>3.6</td><br></tr><br><tr><br><th>3</th><br><td>2001</td><br><td>Nevada</td><br><td>2.4</td><br></tr><br><tr><br><th>4</th><br><td>2002</td><br><td>Nevada</td><br><td>2.9</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame2 = DataFrame(data, columns=[<span class="string">'year'</span>, <span class="string">'state'</span>, <span class="string">'pop'</span>, <span class="string">'debt'</span>],</div><div class="line">                   index=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>, <span class="string">'five'</span>])</div><div class="line">frame2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>year</th><br><th>state</th><br><th>pop</th><br><th>debt</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>one</th><br><td>2000</td><br><td>Ohio</td><br><td>1.5</td><br><td>NaN</td><br></tr><br><tr><br><th>two</th><br><td>2001</td><br><td>Ohio</td><br><td>1.7</td><br><td>NaN</td><br></tr><br><tr><br><th>three</th><br><td>2002</td><br><td>Ohio</td><br><td>3.6</td><br><td>NaN</td><br></tr><br><tr><br><th>four</th><br><td>2001</td><br><td>Nevada</td><br><td>2.4</td><br><td>NaN</td><br></tr><br><tr><br><th>five</th><br><td>2002</td><br><td>Nevada</td><br><td>2.9</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2.columns</div></pre></td></tr></table></figure><pre><code>Index([&apos;year&apos;, &apos;state&apos;, &apos;pop&apos;, &apos;debt&apos;], dtype=&apos;object&apos;)
</code></pre><p>DataFrame每一个Key对应的Value都是一个Series</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2[<span class="string">'state'</span>]</div></pre></td></tr></table></figure><pre><code>one        Ohio
two        Ohio
three      Ohio
four     Nevada
five     Nevada
Name: state, dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2.year</div></pre></td></tr></table></figure><pre><code>one      2000
two      2001
three    2002
four     2001
five     2002
Name: year, dtype: int64
</code></pre><p>注意到name属性也已经被设置好了</p><p>ix相当于一个行索引？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2.ix[<span class="string">'three'</span>]</div></pre></td></tr></table></figure><pre><code>year     2002
state    Ohio
pop       3.6
debt      NaN
Name: three, dtype: object
</code></pre><p>可以利用Numpy的广播功能</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame2[<span class="string">'debt'</span>] = <span class="number">16.5</span></div><div class="line">frame2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>year</th><br><th>state</th><br><th>pop</th><br><th>debt</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>one</th><br><td>2000</td><br><td>Ohio</td><br><td>1.5</td><br><td>16.5</td><br></tr><br><tr><br><th>two</th><br><td>2001</td><br><td>Ohio</td><br><td>1.7</td><br><td>16.5</td><br></tr><br><tr><br><th>three</th><br><td>2002</td><br><td>Ohio</td><br><td>3.6</td><br><td>16.5</td><br></tr><br><tr><br><th>four</th><br><td>2001</td><br><td>Nevada</td><br><td>2.4</td><br><td>16.5</td><br></tr><br><tr><br><th>five</th><br><td>2002</td><br><td>Nevada</td><br><td>2.9</td><br><td>16.5</td><br></tr><br><br></tbody><br></table><br></div><p>也可以赋值一个列表，但是长度必须匹配</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame2[<span class="string">'debt'</span>] = np.arange(<span class="number">5.</span>)</div><div class="line">frame2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>year</th><br><th>state</th><br><th>pop</th><br><th>debt</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>one</th><br><td>2000</td><br><td>Ohio</td><br><td>1.5</td><br><td>0.0</td><br></tr><br><tr><br><th>two</th><br><td>2001</td><br><td>Ohio</td><br><td>1.7</td><br><td>1.0</td><br></tr><br><tr><br><th>three</th><br><td>2002</td><br><td>Ohio</td><br><td>3.6</td><br><td>2.0</td><br></tr><br><tr><br><th>four</th><br><td>2001</td><br><td>Nevada</td><br><td>2.4</td><br><td>3.0</td><br></tr><br><tr><br><th>five</th><br><td>2002</td><br><td>Nevada</td><br><td>2.9</td><br><td>4.0</td><br></tr><br><br></tbody><br></table><br></div><p>如果是赋值一个Series，则会匹配上索引，没有匹配上的就是置为NaN</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">val = Series([<span class="number">-1.2</span>, <span class="number">-1.5</span>, <span class="number">-1.7</span>], index=[<span class="string">'two'</span>, <span class="string">'four'</span>, <span class="string">'five'</span>])</div><div class="line">frame2[<span class="string">'debt'</span>] = val</div><div class="line">frame2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>year</th><br><th>state</th><br><th>pop</th><br><th>debt</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>one</th><br><td>2000</td><br><td>Ohio</td><br><td>1.5</td><br><td>NaN</td><br></tr><br><tr><br><th>two</th><br><td>2001</td><br><td>Ohio</td><br><td>1.7</td><br><td>-1.2</td><br></tr><br><tr><br><th>three</th><br><td>2002</td><br><td>Ohio</td><br><td>3.6</td><br><td>NaN</td><br></tr><br><tr><br><th>four</th><br><td>2001</td><br><td>Nevada</td><br><td>2.4</td><br><td>-1.5</td><br></tr><br><tr><br><th>five</th><br><td>2002</td><br><td>Nevada</td><br><td>2.9</td><br><td>-1.7</td><br></tr><br><br></tbody><br></table><br></div><p>也可以进行逻辑操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame2[<span class="string">'eastern'</span>] = frame2.state == <span class="string">'Ohio'</span></div><div class="line">frame2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>year</th><br><th>state</th><br><th>pop</th><br><th>debt</th><br><th>eastern</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>one</th><br><td>2000</td><br><td>Ohio</td><br><td>1.5</td><br><td>NaN</td><br><td>True</td><br></tr><br><tr><br><th>two</th><br><td>2001</td><br><td>Ohio</td><br><td>1.7</td><br><td>-1.2</td><br><td>True</td><br></tr><br><tr><br><th>three</th><br><td>2002</td><br><td>Ohio</td><br><td>3.6</td><br><td>NaN</td><br><td>True</td><br></tr><br><tr><br><th>four</th><br><td>2001</td><br><td>Nevada</td><br><td>2.4</td><br><td>-1.5</td><br><td>False</td><br></tr><br><tr><br><th>five</th><br><td>2002</td><br><td>Nevada</td><br><td>2.9</td><br><td>-1.7</td><br><td>False</td><br></tr><br><br></tbody><br></table><br></div><p>del用于删除一列</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">del</span> frame2[<span class="string">'eastern'</span>]</div><div class="line">frame2.columns</div></pre></td></tr></table></figure><pre><code>Index([&apos;year&apos;, &apos;state&apos;, &apos;pop&apos;, &apos;debt&apos;], dtype=&apos;object&apos;)
</code></pre><p><strong>只要是通过索引方式进行的操作，都是直接在原数据上进行的操作，不是一个副本</strong></p><p>嵌套的字典也可直接生成DataFrame，只不过内层的键被当作index，外层的键被当作colums</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pop = &#123;<span class="string">'Nevada'</span>: &#123;<span class="number">2001</span>: <span class="number">2.4</span>, <span class="number">2002</span>: <span class="number">2.9</span>&#125;,</div><div class="line">       <span class="string">'Ohio'</span>: &#123;<span class="number">2000</span>: <span class="number">1.5</span>, <span class="number">2001</span>: <span class="number">1.7</span>, <span class="number">2002</span>: <span class="number">3.6</span>&#125;&#125;</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame3 = DataFrame(pop)</div><div class="line">frame3</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Nevada</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000</th><br><td>NaN</td><br><td>1.5</td><br></tr><br><tr><br><th>2001</th><br><td>2.4</td><br><td>1.7</td><br></tr><br><tr><br><th>2002</th><br><td>2.9</td><br><td>3.6</td><br></tr><br><br></tbody><br></table><br></div><p>同样可以进行转置，这样的话index和column就会互换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame3.T</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>2000</th><br><th>2001</th><br><th>2002</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Nevada</th><br><td>NaN</td><br><td>2.4</td><br><td>2.9</td><br></tr><br><tr><br><th>Ohio</th><br><td>1.5</td><br><td>1.7</td><br><td>3.6</td><br></tr><br><br></tbody><br></table><br></div><p>显式地指定索引，不匹配的会置为NaN</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">DataFrame(pop, index=[<span class="number">2001</span>, <span class="number">2002</span>, <span class="number">2003</span>])</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Nevada</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2001</th><br><td>2.4</td><br><td>1.7</td><br></tr><br><tr><br><th>2002</th><br><td>2.9</td><br><td>3.6</td><br></tr><br><tr><br><th>2003</th><br><td>NaN</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame3</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Nevada</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000</th><br><td>NaN</td><br><td>1.5</td><br></tr><br><tr><br><th>2001</th><br><td>2.4</td><br><td>1.7</td><br></tr><br><tr><br><th>2002</th><br><td>2.9</td><br><td>3.6</td><br></tr><br><br></tbody><br></table><br></div><p>还可以这样构建</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pdata = &#123;<span class="string">'Ohio'</span>: frame3[<span class="string">'Ohio'</span>][:<span class="number">-1</span>],</div><div class="line">         <span class="string">'Nevada'</span>: frame3[<span class="string">'Nevada'</span>][:<span class="number">2</span>]&#125;</div><div class="line">DataFrame(pdata)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Nevada</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000</th><br><td>NaN</td><br><td>1.5</td><br></tr><br><tr><br><th>2001</th><br><td>2.4</td><br><td>1.7</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame3</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Nevada</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000</th><br><td>NaN</td><br><td>1.5</td><br></tr><br><tr><br><th>2001</th><br><td>2.4</td><br><td>1.7</td><br></tr><br><tr><br><th>2002</th><br><td>2.9</td><br><td>3.6</td><br></tr><br><br></tbody><br></table><br></div><p>name属性也会在表格中显示出来</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame3.index.name = <span class="string">'year'</span>; frame3.columns.name = <span class="string">'state'</span></div><div class="line">frame3</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th>state</th><br><th>Nevada</th><br><th>Ohio</th><br></tr><br><tr><br><th>year</th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000</th><br><td>NaN</td><br><td>1.5</td><br></tr><br><tr><br><th>2001</th><br><td>2.4</td><br><td>1.7</td><br></tr><br><tr><br><th>2002</th><br><td>2.9</td><br><td>3.6</td><br></tr><br><br></tbody><br></table><br></div><p>values方法只返回数据，不返回index以及key</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame3.values</div></pre></td></tr></table></figure><pre><code>array([[ nan,  1.5],
       [ 2.4,  1.7],
       [ 2.9,  3.6]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>year</th><br><th>state</th><br><th>pop</th><br><th>debt</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>one</th><br><td>2000</td><br><td>Ohio</td><br><td>1.5</td><br><td>NaN</td><br></tr><br><tr><br><th>two</th><br><td>2001</td><br><td>Ohio</td><br><td>1.7</td><br><td>-1.2</td><br></tr><br><tr><br><th>three</th><br><td>2002</td><br><td>Ohio</td><br><td>3.6</td><br><td>NaN</td><br></tr><br><tr><br><th>four</th><br><td>2001</td><br><td>Nevada</td><br><td>2.4</td><br><td>-1.5</td><br></tr><br><tr><br><th>five</th><br><td>2002</td><br><td>Nevada</td><br><td>2.9</td><br><td>-1.7</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2.values</div></pre></td></tr></table></figure><pre><code>array([[2000, &apos;Ohio&apos;, 1.5, nan],
       [2001, &apos;Ohio&apos;, 1.7, -1.2],
       [2002, &apos;Ohio&apos;, 3.6, nan],
       [2001, &apos;Nevada&apos;, 2.4, -1.5],
       [2002, &apos;Nevada&apos;, 2.9, -1.7]], dtype=object)
</code></pre><h3 id="索引对象"><a href="#索引对象" class="headerlink" title="索引对象"></a>索引对象</h3><p>Index是一个可以单独提取出来的对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">obj = Series(range(<span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">index = obj.index</div><div class="line">index</div></pre></td></tr></table></figure><pre><code>Index([&apos;a&apos;, &apos;b&apos;, &apos;c&apos;], dtype=&apos;object&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">index[<span class="number">1</span>:]</div></pre></td></tr></table></figure><pre><code>Index([&apos;b&apos;, &apos;c&apos;], dtype=&apos;object&apos;)
</code></pre><p>不可修改~！</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">index[<span class="number">1</span>] = <span class="string">'d'</span></div></pre></td></tr></table></figure><pre><code>---------------------------------------------------------------------------

TypeError                                 Traceback (most recent call last)

&lt;ipython-input-52-676fdeb26a68&gt; in &lt;module&gt;()
----&gt; 1 index[1] = &apos;d&apos;


C:\Users\Ewan\Anaconda3\lib\site-packages\pandas\indexes\base.py in __setitem__(self, key, value)
   1243 
   1244     def __setitem__(self, key, value):
-&gt; 1245         raise TypeError(&quot;Index does not support mutable operations&quot;)
   1246 
   1247     def __getitem__(self, key):


TypeError: Index does not support mutable operations
</code></pre><p>直接创建Index对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">index = pd.Index(np.arange(<span class="number">3</span>))</div><div class="line">obj2 = Series([<span class="number">1.5</span>, <span class="number">-2.5</span>, <span class="number">0</span>], index=index)</div><div class="line">obj2.index <span class="keyword">is</span> index</div></pre></td></tr></table></figure><pre><code>True
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame3</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th>state</th><br><th>Nevada</th><br><th>Ohio</th><br></tr><br><tr><br><th>year</th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000</th><br><td>NaN</td><br><td>1.5</td><br></tr><br><tr><br><th>2001</th><br><td>2.4</td><br><td>1.7</td><br></tr><br><tr><br><th>2002</th><br><td>2.9</td><br><td>3.6</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">'Ohio'</span> <span class="keyword">in</span> frame3.columns</div></pre></td></tr></table></figure><pre><code>True
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="number">2003</span> <span class="keyword">in</span> frame3.index</div></pre></td></tr></table></figure><pre><code>False
</code></pre><h2 id="基本功能"><a href="#基本功能" class="headerlink" title="基本功能"></a>基本功能</h2><h3 id="重新索引"><a href="#重新索引" class="headerlink" title="重新索引"></a>重新索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">4.5</span>, <span class="number">7.2</span>, <span class="number">-5.3</span>, <span class="number">3.6</span>], index=[<span class="string">'d'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>])</div><div class="line">obj</div></pre></td></tr></table></figure><pre><code>d    4.5
b    7.2
a   -5.3
c    3.6
dtype: float64
</code></pre><p>重排索引形成新对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj2 = obj.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">obj2</div></pre></td></tr></table></figure><pre><code>a   -5.3
b    7.2
c    3.6
d    4.5
e    NaN
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>], fill_value=<span class="number">0</span>)</div></pre></td></tr></table></figure><pre><code>a   -5.3
b    7.2
c    3.6
d    4.5
e    0.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj3 = Series([<span class="string">'blue'</span>, <span class="string">'purple'</span>, <span class="string">'yellow'</span>], index=[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>])</div><div class="line">obj3.reindex(range(<span class="number">6</span>), method=<span class="string">'ffill'</span>) <span class="comment"># 前向填充</span></div></pre></td></tr></table></figure><pre><code>0      blue
1      blue
2    purple
3    purple
4    yellow
5    yellow
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">9</span>).reshape((<span class="number">3</span>, <span class="number">3</span>)), index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>],</div><div class="line">                  columns=[<span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'California'</span>])</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Ohio</th><br><th>Texas</th><br><th>California</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>0</td><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>c</th><br><td>3</td><br><td>4</td><br><td>5</td><br></tr><br><tr><br><th>d</th><br><td>6</td><br><td>7</td><br><td>8</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame2 = frame.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">frame2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Ohio</th><br><th>Texas</th><br><th>California</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>0.0</td><br><td>1.0</td><br><td>2.0</td><br></tr><br><tr><br><th>b</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>c</th><br><td>3.0</td><br><td>4.0</td><br><td>5.0</td><br></tr><br><tr><br><th>d</th><br><td>6.0</td><br><td>7.0</td><br><td>8.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">states = [<span class="string">'Texas'</span>, <span class="string">'Utah'</span>, <span class="string">'California'</span>]</div><div class="line">frame.reindex(columns=states)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Texas</th><br><th>Utah</th><br><th>California</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>1</td><br><td>NaN</td><br><td>2</td><br></tr><br><tr><br><th>c</th><br><td>4</td><br><td>NaN</td><br><td>5</td><br></tr><br><tr><br><th>d</th><br><td>7</td><br><td>NaN</td><br><td>8</td><br></tr><br><br></tbody><br></table><br></div><p>插值只能按行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame.reindex(index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], method=<span class="string">'ffill'</span>,</div><div class="line">              columns=states)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Texas</th><br><th>Utah</th><br><th>California</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>1</td><br><td>NaN</td><br><td>2</td><br></tr><br><tr><br><th>b</th><br><td>1</td><br><td>NaN</td><br><td>2</td><br></tr><br><tr><br><th>c</th><br><td>4</td><br><td>NaN</td><br><td>5</td><br></tr><br><tr><br><th>d</th><br><td>7</td><br><td>NaN</td><br><td>8</td><br></tr><br><br></tbody><br></table><br></div><p>用ix方法进行重新索引操作会使得代码很简洁</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.ix[[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], states]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Texas</th><br><th>Utah</th><br><th>California</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>1.0</td><br><td>NaN</td><br><td>2.0</td><br></tr><br><tr><br><th>b</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>c</th><br><td>4.0</td><br><td>NaN</td><br><td>5.0</td><br></tr><br><tr><br><th>d</th><br><td>7.0</td><br><td>NaN</td><br><td>8.0</td><br></tr><br><br></tbody><br></table><br></div><h3 id="丢弃指定轴上的项"><a href="#丢弃指定轴上的项" class="headerlink" title="丢弃指定轴上的项"></a>丢弃指定轴上的项</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.ix[[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], states]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Texas</th><br><th>Utah</th><br><th>California</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>1.0</td><br><td>NaN</td><br><td>2.0</td><br></tr><br><tr><br><th>b</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>c</th><br><td>4.0</td><br><td>NaN</td><br><td>5.0</td><br></tr><br><tr><br><th>d</th><br><td>7.0</td><br><td>NaN</td><br><td>8.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">obj = Series(np.arange(<span class="number">5.</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">new_obj = obj.drop(<span class="string">'c'</span>)</div><div class="line">new_obj</div></pre></td></tr></table></figure><pre><code>a    0.0
b    1.0
d    3.0
e    4.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.drop([<span class="string">'d'</span>, <span class="string">'c'</span>])</div></pre></td></tr></table></figure><pre><code>a    0.0
b    1.0
e    4.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(np.arange(<span class="number">16</span>).reshape((<span class="number">4</span>, <span class="number">4</span>)),</div><div class="line">                 index=[<span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>, <span class="string">'Utah'</span>, <span class="string">'New York'</span>],</div><div class="line">                 columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>])</div><div class="line">data</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>0</td><br><td>1</td><br><td>2</td><br><td>3</td><br></tr><br><tr><br><th>Colorado</th><br><td>4</td><br><td>5</td><br><td>6</td><br><td>7</td><br></tr><br><tr><br><th>Utah</th><br><td>8</td><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><tr><br><th>New York</th><br><td>12</td><br><td>13</td><br><td>14</td><br><td>15</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.drop([<span class="string">'Colorado'</span>, <span class="string">'Ohio'</span>])</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>8</td><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><tr><br><th>New York</th><br><td>12</td><br><td>13</td><br><td>14</td><br><td>15</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.drop(<span class="string">'two'</span>, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>three</th><br><th>four</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>0</td><br><td>2</td><br><td>3</td><br></tr><br><tr><br><th>Colorado</th><br><td>4</td><br><td>6</td><br><td>7</td><br></tr><br><tr><br><th>Utah</th><br><td>8</td><br><td>10</td><br><td>11</td><br></tr><br><tr><br><th>New York</th><br><td>12</td><br><td>14</td><br><td>15</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.drop([<span class="string">'two'</span>, <span class="string">'four'</span>], axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>three</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>0</td><br><td>2</td><br></tr><br><tr><br><th>Colorado</th><br><td>4</td><br><td>6</td><br></tr><br><tr><br><th>Utah</th><br><td>8</td><br><td>10</td><br></tr><br><tr><br><th>New York</th><br><td>12</td><br><td>14</td><br></tr><br><br></tbody><br></table><br></div><h3 id="索引，选取和过滤"><a href="#索引，选取和过滤" class="headerlink" title="索引，选取和过滤"></a>索引，选取和过滤</h3><p>多种索引方式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">obj = Series(np.arange(<span class="number">4.</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">obj</div><div class="line">obj[<span class="string">'b'</span>]</div></pre></td></tr></table></figure><pre><code>a    0.0
b    1.0
c    2.0
d    3.0
dtype: float64






1.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[<span class="number">1</span>]</div></pre></td></tr></table></figure><pre><code>1.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[<span class="number">2</span>:<span class="number">4</span>]</div></pre></td></tr></table></figure><pre><code>c    2.0
d    3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[[<span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]]</div></pre></td></tr></table></figure><pre><code>b    1.0
a    0.0
d    3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[[<span class="number">1</span>, <span class="number">3</span>]]</div></pre></td></tr></table></figure><pre><code>b    1.0
d    3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[obj &lt; <span class="number">2</span>] <span class="comment"># 直接对data进行操作</span></div></pre></td></tr></table></figure><pre><code>a    0.0
b    1.0
dtype: float64
</code></pre><p>这种切片方式…<br>末端包含</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[<span class="string">'b'</span>:<span class="string">'c'</span>]</div></pre></td></tr></table></figure><pre><code>b    1.0
c    2.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj[<span class="string">'b'</span>:<span class="string">'c'</span>] = <span class="number">5</span></div><div class="line">obj</div></pre></td></tr></table></figure><pre><code>a    0.0
b    5.0
c    5.0
d    3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(np.arange(<span class="number">16</span>).reshape((<span class="number">4</span>, <span class="number">4</span>)),</div><div class="line">                 index=[<span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>, <span class="string">'Utah'</span>, <span class="string">'New York'</span>],</div><div class="line">                 columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>])</div><div class="line">data</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>0</td><br><td>1</td><br><td>2</td><br><td>3</td><br></tr><br><tr><br><th>Colorado</th><br><td>4</td><br><td>5</td><br><td>6</td><br><td>7</td><br></tr><br><tr><br><th>Utah</th><br><td>8</td><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><tr><br><th>New York</th><br><td>12</td><br><td>13</td><br><td>14</td><br><td>15</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'two'</span>]</div></pre></td></tr></table></figure><pre><code>Ohio         1
Colorado     5
Utah         9
New York    13
Name: two, dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[[<span class="string">'three'</span>, <span class="string">'one'</span>]]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>three</th><br><th>one</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>2</td><br><td>0</td><br></tr><br><tr><br><th>Colorado</th><br><td>6</td><br><td>4</td><br></tr><br><tr><br><th>Utah</th><br><td>10</td><br><td>8</td><br></tr><br><tr><br><th>New York</th><br><td>14</td><br><td>12</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[:<span class="number">2</span>] <span class="comment"># axis=0</span></div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>0</td><br><td>1</td><br><td>2</td><br><td>3</td><br></tr><br><tr><br><th>Colorado</th><br><td>4</td><br><td>5</td><br><td>6</td><br><td>7</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[data[<span class="string">'three'</span>] &gt; <span class="number">5</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Colorado</th><br><td>4</td><br><td>5</td><br><td>6</td><br><td>7</td><br></tr><br><tr><br><th>Utah</th><br><td>8</td><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><tr><br><th>New York</th><br><td>12</td><br><td>13</td><br><td>14</td><br><td>15</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data &lt; <span class="number">5</span></div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>True</td><br><td>True</td><br><td>True</td><br><td>True</td><br></tr><br><tr><br><th>Colorado</th><br><td>True</td><br><td>False</td><br><td>False</td><br><td>False</td><br></tr><br><tr><br><th>Utah</th><br><td>False</td><br><td>False</td><br><td>False</td><br><td>False</td><br></tr><br><tr><br><th>New York</th><br><td>False</td><br><td>False</td><br><td>False</td><br><td>False</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[data &lt; <span class="number">5</span>] = <span class="number">0</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>0</td><br><td>0</td><br><td>0</td><br><td>0</td><br></tr><br><tr><br><th>Colorado</th><br><td>0</td><br><td>5</td><br><td>6</td><br><td>7</td><br></tr><br><tr><br><th>Utah</th><br><td>8</td><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><tr><br><th>New York</th><br><td>12</td><br><td>13</td><br><td>14</td><br><td>15</td><br></tr><br><br></tbody><br></table><br></div><p>索引的另外一种选择</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[<span class="string">'Colorado'</span>, [<span class="string">'two'</span>, <span class="string">'three'</span>]]</div></pre></td></tr></table></figure><pre><code>two      5
three    6
Name: Colorado, dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[[<span class="string">'Colorado'</span>, <span class="string">'Utah'</span>], [<span class="number">3</span>, <span class="number">0</span>, <span class="number">1</span>]]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>four</th><br><th>one</th><br><th>two</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Colorado</th><br><td>7</td><br><td>0</td><br><td>5</td><br></tr><br><tr><br><th>Utah</th><br><td>11</td><br><td>8</td><br><td>9</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[<span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>one       8
two       9
three    10
four     11
Name: Utah, dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[:<span class="string">'Utah'</span>, <span class="string">'two'</span>]</div></pre></td></tr></table></figure><pre><code>Ohio        0
Colorado    5
Utah        9
Name: two, dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[data.three &gt; <span class="number">5</span>, :<span class="number">3</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Colorado</th><br><td>0</td><br><td>5</td><br><td>6</td><br></tr><br><tr><br><th>Utah</th><br><td>8</td><br><td>9</td><br><td>10</td><br></tr><br><tr><br><th>New York</th><br><td>12</td><br><td>13</td><br><td>14</td><br></tr><br><br></tbody><br></table><br></div><p>总结一下就是说，DataFrame是一个二维的数组，只不过每一维的索引方式除了序号之外，还可以用name属性来进行索引，且一切行为与序号无异</p><h3 id="算术运算和数据对齐"><a href="#算术运算和数据对齐" class="headerlink" title="算术运算和数据对齐"></a>算术运算和数据对齐</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">s1 = Series([<span class="number">7.3</span>, <span class="number">-2.5</span>, <span class="number">3.4</span>, <span class="number">1.5</span>], index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">s2 = Series([<span class="number">-2.1</span>, <span class="number">3.6</span>, <span class="number">-1.5</span>, <span class="number">4</span>, <span class="number">3.1</span>], index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">s1</div></pre></td></tr></table></figure><pre><code>a    7.3
c   -2.5
d    3.4
e    1.5
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">s2</div></pre></td></tr></table></figure><pre><code>a   -2.1
c    3.6
e   -1.5
f    4.0
g    3.1
dtype: float64
</code></pre><p>数据对齐操作就是一种特殊的并集操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">s1 + s2</div></pre></td></tr></table></figure><pre><code>a    5.2
c    1.1
d    NaN
e    0.0
f    NaN
g    NaN
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(np.arange(<span class="number">9.</span>).reshape((<span class="number">3</span>, <span class="number">3</span>)), columns=list(<span class="string">'bcd'</span>),</div><div class="line">                index=[<span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Colorado'</span>])</div><div class="line">df2 = DataFrame(np.arange(<span class="number">12.</span>).reshape((<span class="number">4</span>, <span class="number">3</span>)), columns=list(<span class="string">'bde'</span>),</div><div class="line">                index=[<span class="string">'Utah'</span>, <span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Oregon'</span>])</div><div class="line">df1</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>c</th><br><th>d</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>0.0</td><br><td>1.0</td><br><td>2.0</td><br></tr><br><tr><br><th>Texas</th><br><td>3.0</td><br><td>4.0</td><br><td>5.0</td><br></tr><br><tr><br><th>Colorado</th><br><td>6.0</td><br><td>7.0</td><br><td>8.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>0.0</td><br><td>1.0</td><br><td>2.0</td><br></tr><br><tr><br><th>Ohio</th><br><td>3.0</td><br><td>4.0</td><br><td>5.0</td><br></tr><br><tr><br><th>Texas</th><br><td>6.0</td><br><td>7.0</td><br><td>8.0</td><br></tr><br><tr><br><th>Oregon</th><br><td>9.0</td><br><td>10.0</td><br><td>11.0</td><br></tr><br><br></tbody><br></table><br></div><p>并且数据对齐操作是在所有维度上同时进行的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df1 + df2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Colorado</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>Ohio</th><br><td>3.0</td><br><td>NaN</td><br><td>6.0</td><br><td>NaN</td><br></tr><br><tr><br><th>Oregon</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>Texas</th><br><td>9.0</td><br><td>NaN</td><br><td>12.0</td><br><td>NaN</td><br></tr><br><tr><br><th>Utah</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><h4 id="在算术方法中填充词"><a href="#在算术方法中填充词" class="headerlink" title="在算术方法中填充词"></a>在算术方法中填充词</h4><p>下面这种定义column的方式值得注意</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(np.arange(<span class="number">12.</span>).reshape((<span class="number">3</span>, <span class="number">4</span>)), columns=list(<span class="string">'abcd'</span>))</div><div class="line">df2 = DataFrame(np.arange(<span class="number">20.</span>).reshape((<span class="number">4</span>, <span class="number">5</span>)), columns=list(<span class="string">'abcde'</span>))</div><div class="line">df1</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.0</td><br><td>1.0</td><br><td>2.0</td><br><td>3.0</td><br></tr><br><tr><br><th>1</th><br><td>4.0</td><br><td>5.0</td><br><td>6.0</td><br><td>7.0</td><br></tr><br><tr><br><th>2</th><br><td>8.0</td><br><td>9.0</td><br><td>10.0</td><br><td>11.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.0</td><br><td>1.0</td><br><td>2.0</td><br><td>3.0</td><br><td>4.0</td><br></tr><br><tr><br><th>1</th><br><td>5.0</td><br><td>6.0</td><br><td>7.0</td><br><td>8.0</td><br><td>9.0</td><br></tr><br><tr><br><th>2</th><br><td>10.0</td><br><td>11.0</td><br><td>12.0</td><br><td>13.0</td><br><td>14.0</td><br></tr><br><tr><br><th>3</th><br><td>15.0</td><br><td>16.0</td><br><td>17.0</td><br><td>18.0</td><br><td>19.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df1 + df2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.0</td><br><td>2.0</td><br><td>4.0</td><br><td>6.0</td><br><td>NaN</td><br></tr><br><tr><br><th>1</th><br><td>9.0</td><br><td>11.0</td><br><td>13.0</td><br><td>15.0</td><br><td>NaN</td><br></tr><br><tr><br><th>2</th><br><td>18.0</td><br><td>20.0</td><br><td>22.0</td><br><td>24.0</td><br><td>NaN</td><br></tr><br><tr><br><th>3</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><p>要想填充值必须使用add方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df1.add(df2, fill_value=<span class="number">0</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.0</td><br><td>2.0</td><br><td>4.0</td><br><td>6.0</td><br><td>4.0</td><br></tr><br><tr><br><th>1</th><br><td>9.0</td><br><td>11.0</td><br><td>13.0</td><br><td>15.0</td><br><td>9.0</td><br></tr><br><tr><br><th>2</th><br><td>18.0</td><br><td>20.0</td><br><td>22.0</td><br><td>24.0</td><br><td>14.0</td><br></tr><br><tr><br><th>3</th><br><td>15.0</td><br><td>16.0</td><br><td>17.0</td><br><td>18.0</td><br><td>19.0</td><br></tr><br><br></tbody><br></table><br></div><p>reindex方法与add方法还是存在差异的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df1.reindex(columns=df2.columns, fill_value=<span class="number">0</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.0</td><br><td>1.0</td><br><td>2.0</td><br><td>3.0</td><br><td>0</td><br></tr><br><tr><br><th>1</th><br><td>4.0</td><br><td>5.0</td><br><td>6.0</td><br><td>7.0</td><br><td>0</td><br></tr><br><tr><br><th>2</th><br><td>8.0</td><br><td>9.0</td><br><td>10.0</td><br><td>11.0</td><br><td>0</td><br></tr><br><br></tbody><br></table><br></div><h4 id="DataFrame和Series之间的运算"><a href="#DataFrame和Series之间的运算" class="headerlink" title="DataFrame和Series之间的运算"></a>DataFrame和Series之间的运算</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">12.</span>).reshape((<span class="number">3</span>, <span class="number">4</span>))</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[  0.,   1.,   2.,   3.],
       [  4.,   5.,   6.,   7.],
       [  8.,   9.,  10.,  11.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr[<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>array([ 0.,  1.,  2.,  3.])
</code></pre><p>广播操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr - arr[<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>array([[ 0.,  0.,  0.,  0.],
       [ 4.,  4.,  4.,  4.],
       [ 8.,  8.,  8.,  8.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">12.</span>).reshape((<span class="number">4</span>, <span class="number">3</span>)), columns=list(<span class="string">'bde'</span>),</div><div class="line">                  index=[<span class="string">'Utah'</span>, <span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Oregon'</span>])</div><div class="line">series = frame.ix[<span class="number">0</span>]</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>0.0</td><br><td>1.0</td><br><td>2.0</td><br></tr><br><tr><br><th>Ohio</th><br><td>3.0</td><br><td>4.0</td><br><td>5.0</td><br></tr><br><tr><br><th>Texas</th><br><td>6.0</td><br><td>7.0</td><br><td>8.0</td><br></tr><br><tr><br><th>Oregon</th><br><td>9.0</td><br><td>10.0</td><br><td>11.0</td><br></tr><br><br></tbody><br></table><br></div><p>Series的name等于DataFrame的切片属性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">series</div></pre></td></tr></table></figure><pre><code>b    0.0
d    1.0
e    2.0
Name: Utah, dtype: float64
</code></pre><p>默认情况下，DataFrame和Series之间的算术运算会将Series的index匹配到DataFrame的column, 然后沿着行向下广播</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame - series</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>0.0</td><br><td>0.0</td><br><td>0.0</td><br></tr><br><tr><br><th>Ohio</th><br><td>3.0</td><br><td>3.0</td><br><td>3.0</td><br></tr><br><tr><br><th>Texas</th><br><td>6.0</td><br><td>6.0</td><br><td>6.0</td><br></tr><br><tr><br><th>Oregon</th><br><td>9.0</td><br><td>9.0</td><br><td>9.0</td><br></tr><br><br></tbody><br></table><br></div><p>如果Series的index与DataFrame的column不匹配，则进行数据对齐</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">series2 = Series(range(<span class="number">3</span>), index=[<span class="string">'b'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>])</div><div class="line">frame + series2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br><th>f</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>0.0</td><br><td>NaN</td><br><td>3.0</td><br><td>NaN</td><br></tr><br><tr><br><th>Ohio</th><br><td>3.0</td><br><td>NaN</td><br><td>6.0</td><br><td>NaN</td><br></tr><br><tr><br><th>Texas</th><br><td>6.0</td><br><td>NaN</td><br><td>9.0</td><br><td>NaN</td><br></tr><br><tr><br><th>Oregon</th><br><td>9.0</td><br><td>NaN</td><br><td>12.0</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">series3 = frame[<span class="string">'d'</span>]</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>0.0</td><br><td>1.0</td><br><td>2.0</td><br></tr><br><tr><br><th>Ohio</th><br><td>3.0</td><br><td>4.0</td><br><td>5.0</td><br></tr><br><tr><br><th>Texas</th><br><td>6.0</td><br><td>7.0</td><br><td>8.0</td><br></tr><br><tr><br><th>Oregon</th><br><td>9.0</td><br><td>10.0</td><br><td>11.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">series3</div></pre></td></tr></table></figure><pre><code>Utah       1.0
Ohio       4.0
Texas      7.0
Oregon    10.0
Name: d, dtype: float64
</code></pre><p>匹配行并且在列上进行广播， 就必须要指定axis</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame.sub(series3, axis=<span class="number">0</span>)</div><div class="line">frame.sub(series3, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>-1.0</td><br><td>0.0</td><br><td>1.0</td><br></tr><br><tr><br><th>Ohio</th><br><td>-1.0</td><br><td>0.0</td><br><td>1.0</td><br></tr><br><tr><br><th>Texas</th><br><td>-1.0</td><br><td>0.0</td><br><td>1.0</td><br></tr><br><tr><br><th>Oregon</th><br><td>-1.0</td><br><td>0.0</td><br><td>1.0</td><br></tr><br><br></tbody><br></table><br></div><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Ohio</th><br><th>Oregon</th><br><th>Texas</th><br><th>Utah</th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>Ohio</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>Texas</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>Oregon</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><h3 id="函数应用和映射"><a href="#函数应用和映射" class="headerlink" title="函数应用和映射"></a>函数应用和映射</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.random.randn(<span class="number">4</span>, <span class="number">3</span>), columns=list(<span class="string">'bde'</span>),</div><div class="line">                  index=[<span class="string">'Utah'</span>, <span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Oregon'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>-0.204708</td><br><td>0.478943</td><br><td>-0.519439</td><br></tr><br><tr><br><th>Ohio</th><br><td>-0.555730</td><br><td>1.965781</td><br><td>1.393406</td><br></tr><br><tr><br><th>Texas</th><br><td>0.092908</td><br><td>0.281746</td><br><td>0.769023</td><br></tr><br><tr><br><th>Oregon</th><br><td>1.246435</td><br><td>1.007189</td><br><td>-1.296221</td><br></tr><br><br></tbody><br></table><br></div><p>Numpy的元素级方法也可以应用到DataFrame上，直接把DataFrame当作二维的Numpy.array即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.abs(frame)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>0.204708</td><br><td>0.478943</td><br><td>0.519439</td><br></tr><br><tr><br><th>Ohio</th><br><td>0.555730</td><br><td>1.965781</td><br><td>1.393406</td><br></tr><br><tr><br><th>Texas</th><br><td>0.092908</td><br><td>0.281746</td><br><td>0.769023</td><br></tr><br><tr><br><th>Oregon</th><br><td>1.246435</td><br><td>1.007189</td><br><td>1.296221</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">f = <span class="keyword">lambda</span> x: x.max() - x.min()</div></pre></td></tr></table></figure><p>apply方法将函数映射到由各行或者各列形成的一维数组上</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.apply(f) <span class="comment"># axis=0</span></div></pre></td></tr></table></figure><pre><code>b    1.802165
d    1.684034
e    2.689627
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.apply(f, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><pre><code>Utah      0.998382
Ohio      2.521511
Texas     0.676115
Oregon    2.542656
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span></div><div class="line">    <span class="keyword">return</span> Series([x.min(), x.max()], index=[<span class="string">'min'</span>, <span class="string">'max'</span>])</div><div class="line">frame.apply(f)</div><div class="line">frame.apply(f, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>min</th><br><td>-0.555730</td><br><td>0.281746</td><br><td>-1.296221</td><br></tr><br><tr><br><th>max</th><br><td>1.246435</td><br><td>1.965781</td><br><td>1.393406</td><br></tr><br><br></tbody><br></table><br></div><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>min</th><br><th>max</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>-0.519439</td><br><td>0.478943</td><br></tr><br><tr><br><th>Ohio</th><br><td>-0.555730</td><br><td>1.965781</td><br></tr><br><tr><br><th>Texas</th><br><td>0.092908</td><br><td>0.769023</td><br></tr><br><tr><br><th>Oregon</th><br><td>-1.296221</td><br><td>1.246435</td><br></tr><br><br></tbody><br></table><br></div><p>元素级的函数映射applymap， 之所以叫这个名字是因为Series有一个元素级的映射函数map</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">format = <span class="keyword">lambda</span> x: <span class="string">'%.2f'</span> % x</div><div class="line">frame.applymap(format)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>-0.20</td><br><td>0.48</td><br><td>-0.52</td><br></tr><br><tr><br><th>Ohio</th><br><td>-0.56</td><br><td>1.97</td><br><td>1.39</td><br></tr><br><tr><br><th>Texas</th><br><td>0.09</td><br><td>0.28</td><br><td>0.77</td><br></tr><br><tr><br><th>Oregon</th><br><td>1.25</td><br><td>1.01</td><br><td>-1.30</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame[<span class="string">'e'</span>].map(format)</div></pre></td></tr></table></figure><pre><code>Utah      -0.52
Ohio       1.39
Texas      0.77
Oregon    -1.30
Name: e, dtype: object
</code></pre><h3 id="排序和排名"><a href="#排序和排名" class="headerlink" title="排序和排名"></a>排序和排名</h3><p>对索引或者column进行（字典）排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series(range(<span class="number">4</span>), index=[<span class="string">'d'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">obj.sort_index()</div></pre></td></tr></table></figure><pre><code>a    1
b    2
c    3
d    0
dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">8</span>).reshape((<span class="number">2</span>, <span class="number">4</span>)), index=[<span class="string">'three'</span>, <span class="string">'one'</span>],</div><div class="line">                  columns=[<span class="string">'d'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">frame.sort_index()</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>d</th><br><th>a</th><br><th>b</th><br><th>c</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>one</th><br><td>4</td><br><td>5</td><br><td>6</td><br><td>7</td><br></tr><br><tr><br><th>three</th><br><td>0</td><br><td>1</td><br><td>2</td><br><td>3</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sort_index(axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>three</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>0</td><br></tr><br><tr><br><th>one</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>4</td><br></tr><br><br></tbody><br></table><br></div><p>降序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sort_index(axis=<span class="number">1</span>, ascending=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>d</th><br><th>c</th><br><th>b</th><br><th>a</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>three</th><br><td>0</td><br><td>3</td><br><td>2</td><br><td>1</td><br></tr><br><tr><br><th>one</th><br><td>4</td><br><td>7</td><br><td>6</td><br><td>5</td><br></tr><br><br></tbody><br></table><br></div><p>按照data进行排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">4</span>, <span class="number">7</span>, <span class="number">-3</span>, <span class="number">2</span>])</div><div class="line">obj.sort_values()</div></pre></td></tr></table></figure><pre><code>2   -3
3    2
0    4
1    7
dtype: int64
</code></pre><p>在排序时，任何缺失值默认都会被放到Series的末尾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">4</span>, np.nan, <span class="number">7</span>, np.nan, <span class="number">-3</span>, <span class="number">2</span>])</div><div class="line">obj.sort_values()</div></pre></td></tr></table></figure><pre><code>4   -3.0
5    2.0
0    4.0
2    7.0
1    NaN
3    NaN
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(&#123;<span class="string">'b'</span>: [<span class="number">4</span>, <span class="number">7</span>, <span class="number">-3</span>, <span class="number">2</span>], <span class="string">'a'</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]&#125;)</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0</td><br><td>4</td><br></tr><br><tr><br><th>1</th><br><td>1</td><br><td>7</td><br></tr><br><tr><br><th>2</th><br><td>0</td><br><td>-3</td><br></tr><br><tr><br><th>3</th><br><td>1</td><br><td>2</td><br></tr><br><br></tbody><br></table><br></div><p>对指定index或者column进行排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sort_values(by=<span class="string">'b'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2</th><br><td>0</td><br><td>-3</td><br></tr><br><tr><br><th>3</th><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>0</th><br><td>0</td><br><td>4</td><br></tr><br><tr><br><th>1</th><br><td>1</td><br><td>7</td><br></tr><br><br></tbody><br></table><br></div><p>或者根据multi-index亦或multi-column进行排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sort_values(by=[<span class="string">'a'</span>, <span class="string">'b'</span>])</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2</th><br><td>0</td><br><td>-3</td><br></tr><br><tr><br><th>0</th><br><td>0</td><br><td>4</td><br></tr><br><tr><br><th>3</th><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>1</th><br><td>1</td><br><td>7</td><br></tr><br><br></tbody><br></table><br></div><p>默认情况下，rank方法通过“为各组分配一个平均排名”的方式破坏平级关系。也就是说，如果有多个相同的值，则这些值的rank就是这些相同值rand的算术平均。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">7</span>, <span class="number">-5</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">4</span>])</div><div class="line">obj.rank()</div></pre></td></tr></table></figure><pre><code>0    7.5
1    1.0
2    7.5
3    5.0
4    3.0
5    2.0
6    5.0
7    5.0
dtype: float64
</code></pre><p>如果想按照一般方式排名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.rank(method=<span class="string">'first'</span>)</div></pre></td></tr></table></figure><pre><code>0    7.0
1    1.0
2    8.0
3    4.0
4    3.0
5    2.0
6    5.0
7    6.0
dtype: float64
</code></pre><p>使用每个分组的最大排名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.rank(ascending=<span class="keyword">False</span>, method=<span class="string">'max'</span>)</div></pre></td></tr></table></figure><pre><code>0    2.0
1    8.0
2    2.0
3    5.0
4    6.0
5    7.0
6    5.0
7    5.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(&#123;<span class="string">'b'</span>: [<span class="number">4.3</span>, <span class="number">7</span>, <span class="number">-3</span>, <span class="number">2</span>], <span class="string">'a'</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</div><div class="line">                   <span class="string">'c'</span>: [<span class="number">-2</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">-2.5</span>]&#125;)</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0</td><br><td>4.3</td><br><td>-2.0</td><br></tr><br><tr><br><th>1</th><br><td>1</td><br><td>7.0</td><br><td>5.0</td><br></tr><br><tr><br><th>2</th><br><td>0</td><br><td>-3.0</td><br><td>8.0</td><br></tr><br><tr><br><th>3</th><br><td>1</td><br><td>2.0</td><br><td>-2.5</td><br></tr><br><br></tbody><br></table><br></div><p>指定维度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.rank(axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>2.0</td><br><td>3.0</td><br><td>1.0</td><br></tr><br><tr><br><th>1</th><br><td>1.0</td><br><td>3.0</td><br><td>2.0</td><br></tr><br><tr><br><th>2</th><br><td>2.0</td><br><td>1.0</td><br><td>3.0</td><br></tr><br><tr><br><th>3</th><br><td>2.0</td><br><td>3.0</td><br><td>1.0</td><br></tr><br><br></tbody><br></table><br></div><h3 id="带有重复值的轴索引"><a href="#带有重复值的轴索引" class="headerlink" title="带有重复值的轴索引"></a>带有重复值的轴索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series(range(<span class="number">5</span>), index=[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">obj</div></pre></td></tr></table></figure><pre><code>a    0
a    1
b    2
b    3
c    4
dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.index.is_unique</div></pre></td></tr></table></figure><pre><code>False
</code></pre><p>返回一个Series</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[<span class="string">'a'</span>]</div></pre></td></tr></table></figure><pre><code>a    0
a    1
dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[<span class="string">'c'</span>]</div></pre></td></tr></table></figure><pre><code>4
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(np.random.randn(<span class="number">4</span>, <span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>])</div><div class="line">df</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>0.274992</td><br><td>0.228913</td><br><td>1.352917</td><br></tr><br><tr><br><th>a</th><br><td>0.886429</td><br><td>-2.001637</td><br><td>-0.371843</td><br></tr><br><tr><br><th>b</th><br><td>1.669025</td><br><td>-0.438570</td><br><td>-0.539741</td><br></tr><br><tr><br><th>b</th><br><td>0.476985</td><br><td>3.248944</td><br><td>-1.021228</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.ix[<span class="string">'b'</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>b</th><br><td>1.669025</td><br><td>-0.438570</td><br><td>-0.539741</td><br></tr><br><tr><br><th>b</th><br><td>0.476985</td><br><td>3.248944</td><br><td>-1.021228</td><br></tr><br><br></tbody><br></table><br></div><h2 id="汇总和计算描述统计"><a href="#汇总和计算描述统计" class="headerlink" title="汇总和计算描述统计"></a>汇总和计算描述统计</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">df = DataFrame([[<span class="number">1.4</span>, np.nan], [<span class="number">7.1</span>, <span class="number">-4.5</span>],</div><div class="line">                [np.nan, np.nan], [<span class="number">0.75</span>, <span class="number">-1.3</span>]],</div><div class="line">               index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>],</div><div class="line">               columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</div><div class="line">df</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>1.40</td><br><td>NaN</td><br></tr><br><tr><br><th>b</th><br><td>7.10</td><br><td>-4.5</td><br></tr><br><tr><br><th>c</th><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>d</th><br><td>0.75</td><br><td>-1.3</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.sum() <span class="comment"># axis=0 skipna=True</span></div></pre></td></tr></table></figure><pre><code>one    9.25
two   -5.80
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.sum(axis=<span class="number">1</span>) <span class="comment"># skipna=True</span></div></pre></td></tr></table></figure><pre><code>a    1.40
b    2.60
c    0.00
d   -0.55
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.mean(axis=<span class="number">1</span>, skipna=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><pre><code>a      NaN
b    1.300
c      NaN
d   -0.275
dtype: float64
</code></pre><p>返回的是索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.idxmax()</div></pre></td></tr></table></figure><pre><code>one    b
two    d
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.cumsum()</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>1.40</td><br><td>NaN</td><br></tr><br><tr><br><th>b</th><br><td>8.50</td><br><td>-4.5</td><br></tr><br><tr><br><th>c</th><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>d</th><br><td>9.25</td><br><td>-5.8</td><br></tr><br><br></tbody><br></table><br></div><p>describe对于数值型和非数值型数据的行为不一样</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.describe()</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\numpy\lib\function_base.py:3834: RuntimeWarning: Invalid value encountered in percentile
  RuntimeWarning)
</code></pre><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>count</th><br><td>3.000000</td><br><td>2.000000</td><br></tr><br><tr><br><th>mean</th><br><td>3.083333</td><br><td>-2.900000</td><br></tr><br><tr><br><th>std</th><br><td>3.493685</td><br><td>2.262742</td><br></tr><br><tr><br><th>min</th><br><td>0.750000</td><br><td>-4.500000</td><br></tr><br><tr><br><th>25%</th><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>50%</th><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>75%</th><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>max</th><br><td>7.100000</td><br><td>-1.300000</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>] * <span class="number">4</span>)</div><div class="line">obj</div><div class="line">obj.describe()</div></pre></td></tr></table></figure><pre><code>0     a
1     a
2     b
3     c
4     a
5     a
6     b
7     c
8     a
9     a
10    b
11    c
12    a
13    a
14    b
15    c
dtype: object






count     16
unique     3
top        a
freq       8
dtype: object
</code></pre><h3 id="相关系数和xi"><a href="#相关系数和xi" class="headerlink" title="相关系数和xi"></a>相关系数和xi</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas_datareader.data <span class="keyword">as</span> web</div><div class="line"></div><div class="line">all_data = &#123;&#125;</div><div class="line"><span class="keyword">for</span> ticker <span class="keyword">in</span> [<span class="string">'AAPL'</span>, <span class="string">'IBM'</span>, <span class="string">'MSFT'</span>, <span class="string">'GOOG'</span>]:</div><div class="line">    all_data[ticker] = web.get_data_yahoo(ticker)</div><div class="line"></div><div class="line">price = DataFrame(&#123;tic: data[<span class="string">'Adj Close'</span>]</div><div class="line">                   <span class="keyword">for</span> tic, data <span class="keyword">in</span> all_data.items()&#125;)</div><div class="line">volume = DataFrame(&#123;tic: data[<span class="string">'Volume'</span>]</div><div class="line">                    <span class="keyword">for</span> tic, data <span class="keyword">in</span> all_data.items()&#125;)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">price[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>AAPL</th><br><th>GOOG</th><br><th>IBM</th><br><th>MSFT</th><br></tr><br><tr><br><th>Date</th><br><th></th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2010-01-04</th><br><td>27.727039</td><br><td>313.062468</td><br><td>111.405000</td><br><td>25.555485</td><br></tr><br><tr><br><th>2010-01-05</th><br><td>27.774976</td><br><td>311.683844</td><br><td>110.059232</td><br><td>25.563741</td><br></tr><br><tr><br><th>2010-01-06</th><br><td>27.333178</td><br><td>303.826685</td><br><td>109.344283</td><br><td>25.406859</td><br></tr><br><tr><br><th>2010-01-07</th><br><td>27.282650</td><br><td>296.753749</td><br><td>108.965786</td><br><td>25.142634</td><br></tr><br><tr><br><th>2010-01-08</th><br><td>27.464034</td><br><td>300.709808</td><br><td>110.059232</td><br><td>25.316031</td><br></tr><br><tr><br><th>2010-01-11</th><br><td>27.221758</td><br><td>300.255255</td><br><td>108.906903</td><br><td>24.994007</td><br></tr><br><tr><br><th>2010-01-12</th><br><td>26.912110</td><br><td>294.945572</td><br><td>109.773245</td><br><td>24.828866</td><br></tr><br><tr><br><th>2010-01-13</th><br><td>27.291720</td><br><td>293.252243</td><br><td>109.537735</td><br><td>25.060064</td><br></tr><br><tr><br><th>2010-01-14</th><br><td>27.133657</td><br><td>294.630868</td><br><td>111.287245</td><br><td>25.563741</td><br></tr><br><tr><br><th>2010-01-15</th><br><td>26.680198</td><br><td>289.710772</td><br><td>110.841458</td><br><td>25.481172</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">volume[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>AAPL</th><br><th>GOOG</th><br><th>IBM</th><br><th>MSFT</th><br></tr><br><tr><br><th>Date</th><br><th></th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2010-01-04</th><br><td>123432400</td><br><td>3927000</td><br><td>6155300</td><br><td>38409100</td><br></tr><br><tr><br><th>2010-01-05</th><br><td>150476200</td><br><td>6031900</td><br><td>6841400</td><br><td>49749600</td><br></tr><br><tr><br><th>2010-01-06</th><br><td>138040000</td><br><td>7987100</td><br><td>5605300</td><br><td>58182400</td><br></tr><br><tr><br><th>2010-01-07</th><br><td>119282800</td><br><td>12876600</td><br><td>5840600</td><br><td>50559700</td><br></tr><br><tr><br><th>2010-01-08</th><br><td>111902700</td><br><td>9483900</td><br><td>4197200</td><br><td>51197400</td><br></tr><br><tr><br><th>2010-01-11</th><br><td>115557400</td><br><td>14479800</td><br><td>5730400</td><br><td>68754700</td><br></tr><br><tr><br><th>2010-01-12</th><br><td>148614900</td><br><td>9742900</td><br><td>8081500</td><br><td>65912100</td><br></tr><br><tr><br><th>2010-01-13</th><br><td>151473000</td><br><td>13041800</td><br><td>6455400</td><br><td>51863500</td><br></tr><br><tr><br><th>2010-01-14</th><br><td>108223500</td><br><td>8511900</td><br><td>7111800</td><br><td>63228100</td><br></tr><br><tr><br><th>2010-01-15</th><br><td>148516900</td><br><td>10909600</td><br><td>8494400</td><br><td>79913200</td><br></tr><br><br></tbody><br></table><br></div><p><strong>price.pct_change</strong></p><p><strong>Signature</strong>: price.pct_change(periods=1, fill_method=’pad’, limit=None, freq=None, **kwargs)<br><strong>Docstring</strong>:<br>Percent change over given number of periods.</p><p><strong>Parameters</strong></p><p>periods : int, default 1<br>Periods to shift for forming percent change</p><p>fill_method : str, default ‘pad’<br>How to handle NAs before computing percent changes</p><p>limit : int, default None<br>The number of consecutive NAs to fill before stopping</p><p>freq : DateOffset, timedelta, or offset alias string, optional<br>Increment to use from time series API (e.g. ‘M’ or BDay())</p><p><strong>Returns</strong></p><p>chg : NDFrame</p><p><strong>Notes</strong></p><p>By default, the percentage change is calculated along the stat<br>axis: 0, or <code>Index</code>, for <code>DataFrame</code> and 1, or <code>minor</code> for<br><code>Panel</code>. You can change this with the <code>axis</code> keyword argument.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">returns = price.pct_change()</div><div class="line">returns.tail()</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>AAPL</th><br><th>GOOG</th><br><th>IBM</th><br><th>MSFT</th><br></tr><br><tr><br><th>Date</th><br><th></th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2017-02-21</th><br><td>0.007221</td><br><td>0.004335</td><br><td>-0.002269</td><br><td>-0.002012</td><br></tr><br><tr><br><th>2017-02-22</th><br><td>0.002999</td><br><td>-0.001082</td><br><td>0.004937</td><br><td>-0.002016</td><br></tr><br><tr><br><th>2017-02-23</th><br><td>-0.004230</td><br><td>0.000686</td><br><td>0.002760</td><br><td>0.004040</td><br></tr><br><tr><br><th>2017-02-24</th><br><td>0.000952</td><br><td>-0.003236</td><br><td>-0.001651</td><br><td>0.000000</td><br></tr><br><tr><br><th>2017-02-27</th><br><td>0.001976</td><br><td>0.000772</td><br><td>-0.010753</td><br><td>-0.006035</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.MSFT.corr(returns.IBM)</div></pre></td></tr></table></figure><pre><code>0.49525655865062668
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.MSFT.cov(returns.IBM)</div></pre></td></tr></table></figure><pre><code>8.5880535146740545e-05
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.corr()</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>AAPL</th><br><th>GOOG</th><br><th>IBM</th><br><th>MSFT</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>AAPL</th><br><td>1.000000</td><br><td>0.409523</td><br><td>0.381374</td><br><td>0.388875</td><br></tr><br><tr><br><th>GOOG</th><br><td>0.409523</td><br><td>1.000000</td><br><td>0.402781</td><br><td>0.470781</td><br></tr><br><tr><br><th>IBM</th><br><td>0.381374</td><br><td>0.402781</td><br><td>1.000000</td><br><td>0.495257</td><br></tr><br><tr><br><th>MSFT</th><br><td>0.388875</td><br><td>0.470781</td><br><td>0.495257</td><br><td>1.000000</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.cov()</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>AAPL</th><br><th>GOOG</th><br><th>IBM</th><br><th>MSFT</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>AAPL</th><br><td>0.000269</td><br><td>0.000105</td><br><td>0.000075</td><br><td>0.000092</td><br></tr><br><tr><br><th>GOOG</th><br><td>0.000105</td><br><td>0.000244</td><br><td>0.000075</td><br><td>0.000106</td><br></tr><br><tr><br><th>IBM</th><br><td>0.000075</td><br><td>0.000075</td><br><td>0.000144</td><br><td>0.000086</td><br></tr><br><tr><br><th>MSFT</th><br><td>0.000092</td><br><td>0.000106</td><br><td>0.000086</td><br><td>0.000209</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.corrwith(returns.IBM)</div></pre></td></tr></table></figure><pre><code>AAPL    0.381374
GOOG    0.402781
IBM     1.000000
MSFT    0.495257
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.corrwith(volume)</div></pre></td></tr></table></figure><pre><code>AAPL   -0.074055
GOOG   -0.009543
IBM    -0.194107
MSFT   -0.090724
dtype: float64
</code></pre><h3 id="唯一值，-值计数以及成员资格"><a href="#唯一值，-值计数以及成员资格" class="headerlink" title="唯一值， 值计数以及成员资格"></a>唯一值， 值计数以及成员资格</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'c'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">uniques = obj.unique()</div><div class="line">uniques</div></pre></td></tr></table></figure><pre><code>array([&apos;c&apos;, &apos;a&apos;, &apos;d&apos;, &apos;b&apos;], dtype=object)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.value_counts()</div></pre></td></tr></table></figure><pre><code>c    3
a    3
b    2
d    1
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.value_counts(obj.values, sort=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><pre><code>a    3
d    1
b    2
c    3
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mask = obj.isin([<span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">mask</div></pre></td></tr></table></figure><pre><code>0     True
1    False
2    False
3    False
4    False
5     True
6     True
7     True
8     True
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[mask]</div></pre></td></tr></table></figure><pre><code>0    c
5    b
6    b
7    c
8    c
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(&#123;<span class="string">'Qu1'</span>: [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>],</div><div class="line">                  <span class="string">'Qu2'</span>: [<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</div><div class="line">                  <span class="string">'Qu3'</span>: [<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>]&#125;)</div><div class="line">data</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Qu1</th><br><th>Qu2</th><br><th>Qu3</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>1</td><br></tr><br><tr><br><th>1</th><br><td>3</td><br><td>3</td><br><td>5</td><br></tr><br><tr><br><th>2</th><br><td>4</td><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>3</th><br><td>3</td><br><td>2</td><br><td>4</td><br></tr><br><tr><br><th>4</th><br><td>4</td><br><td>3</td><br><td>4</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = data.apply(pd.value_counts).fillna(<span class="number">0</span>)</div><div class="line">result</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Qu1</th><br><th>Qu2</th><br><th>Qu3</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>1</th><br><td>1.0</td><br><td>1.0</td><br><td>1.0</td><br></tr><br><tr><br><th>2</th><br><td>0.0</td><br><td>2.0</td><br><td>1.0</td><br></tr><br><tr><br><th>3</th><br><td>2.0</td><br><td>2.0</td><br><td>0.0</td><br></tr><br><tr><br><th>4</th><br><td>2.0</td><br><td>0.0</td><br><td>2.0</td><br></tr><br><tr><br><th>5</th><br><td>0.0</td><br><td>0.0</td><br><td>1.0</td><br></tr><br><br></tbody><br></table><br></div><h2 id="处理缺失数据"><a href="#处理缺失数据" class="headerlink" title="处理缺失数据"></a>处理缺失数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">string_data = Series([<span class="string">'aardvark'</span>, <span class="string">'artichoke'</span>, np.nan, <span class="string">'avocado'</span>])</div><div class="line">string_data</div></pre></td></tr></table></figure><pre><code>0     aardvark
1    artichoke
2          NaN
3      avocado
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">string_data.isnull()</div></pre></td></tr></table></figure><pre><code>0    False
1    False
2     True
3    False
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">string_data[<span class="number">0</span>] = <span class="keyword">None</span></div><div class="line">string_data.isnull()</div></pre></td></tr></table></figure><pre><code>0     True
1    False
2     True
3    False
dtype: bool
</code></pre><h3 id="滤除缺失数据"><a href="#滤除缺失数据" class="headerlink" title="滤除缺失数据"></a>滤除缺失数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> nan <span class="keyword">as</span> NA</div><div class="line">data = Series([<span class="number">1</span>, NA, <span class="number">3.5</span>, NA, <span class="number">7</span>])</div><div class="line">data.dropna()</div></pre></td></tr></table></figure><pre><code>0    1.0
2    3.5
4    7.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[data.notnull()]</div></pre></td></tr></table></figure><pre><code>0    1.0
2    3.5
4    7.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame([[<span class="number">1.</span>, <span class="number">6.5</span>, <span class="number">3.</span>], [<span class="number">1.</span>, NA, NA],</div><div class="line">                  [NA, NA, NA], [NA, <span class="number">6.5</span>, <span class="number">3.</span>]])</div><div class="line">cleaned = data.dropna()</div><div class="line">data</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1.0</td><br><td>6.5</td><br><td>3.0</td><br></tr><br><tr><br><th>1</th><br><td>1.0</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>3</th><br><td>NaN</td><br><td>6.5</td><br><td>3.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cleaned</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1.0</td><br><td>6.5</td><br><td>3.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.dropna(how=<span class="string">'all'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1.0</td><br><td>6.5</td><br><td>3.0</td><br></tr><br><tr><br><th>1</th><br><td>1.0</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>3</th><br><td>NaN</td><br><td>6.5</td><br><td>3.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data[<span class="number">4</span>] = NA</div><div class="line">data</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br><th>4</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1.0</td><br><td>6.5</td><br><td>3.0</td><br><td>NaN</td><br></tr><br><tr><br><th>1</th><br><td>1.0</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>3</th><br><td>NaN</td><br><td>6.5</td><br><td>3.0</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.dropna(axis=<span class="number">1</span>, how=<span class="string">'all'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1.0</td><br><td>6.5</td><br><td>3.0</td><br></tr><br><tr><br><th>1</th><br><td>1.0</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>3</th><br><td>NaN</td><br><td>6.5</td><br><td>3.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(np.random.randn(<span class="number">7</span>, <span class="number">3</span>))</div><div class="line">df.ix[:<span class="number">4</span>, <span class="number">1</span>] = NA; df.ix[:<span class="number">2</span>, <span class="number">2</span>] = NA</div><div class="line">df</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>-0.204708</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>1</th><br><td>-0.555730</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2</th><br><td>0.092908</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>3</th><br><td>1.246435</td><br><td>NaN</td><br><td>-1.296221</td><br></tr><br><tr><br><th>4</th><br><td>0.274992</td><br><td>NaN</td><br><td>1.352917</td><br></tr><br><tr><br><th>5</th><br><td>0.886429</td><br><td>-2.001637</td><br><td>-0.371843</td><br></tr><br><tr><br><th>6</th><br><td>1.669025</td><br><td>-0.438570</td><br><td>-0.539741</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.dropna(thresh=<span class="number">2</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>3</th><br><td>1.246435</td><br><td>NaN</td><br><td>-1.296221</td><br></tr><br><tr><br><th>4</th><br><td>0.274992</td><br><td>NaN</td><br><td>1.352917</td><br></tr><br><tr><br><th>5</th><br><td>0.886429</td><br><td>-2.001637</td><br><td>-0.371843</td><br></tr><br><tr><br><th>6</th><br><td>1.669025</td><br><td>-0.438570</td><br><td>-0.539741</td><br></tr><br><br></tbody><br></table><br></div><h3 id="填充缺失数据"><a href="#填充缺失数据" class="headerlink" title="填充缺失数据"></a>填充缺失数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.fillna(<span class="number">0</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>-0.204708</td><br><td>0.000000</td><br><td>0.000000</td><br></tr><br><tr><br><th>1</th><br><td>-0.555730</td><br><td>0.000000</td><br><td>0.000000</td><br></tr><br><tr><br><th>2</th><br><td>0.092908</td><br><td>0.000000</td><br><td>0.000000</td><br></tr><br><tr><br><th>3</th><br><td>1.246435</td><br><td>0.000000</td><br><td>-1.296221</td><br></tr><br><tr><br><th>4</th><br><td>0.274992</td><br><td>0.000000</td><br><td>1.352917</td><br></tr><br><tr><br><th>5</th><br><td>0.886429</td><br><td>-2.001637</td><br><td>-0.371843</td><br></tr><br><tr><br><th>6</th><br><td>1.669025</td><br><td>-0.438570</td><br><td>-0.539741</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.fillna(&#123;<span class="number">1</span>: <span class="number">0.5</span>, <span class="number">3</span>: <span class="number">-1</span>&#125;)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>-0.204708</td><br><td>0.500000</td><br><td>NaN</td><br></tr><br><tr><br><th>1</th><br><td>-0.555730</td><br><td>0.500000</td><br><td>NaN</td><br></tr><br><tr><br><th>2</th><br><td>0.092908</td><br><td>0.500000</td><br><td>NaN</td><br></tr><br><tr><br><th>3</th><br><td>1.246435</td><br><td>0.500000</td><br><td>-1.296221</td><br></tr><br><tr><br><th>4</th><br><td>0.274992</td><br><td>0.500000</td><br><td>1.352917</td><br></tr><br><tr><br><th>5</th><br><td>0.886429</td><br><td>-2.001637</td><br><td>-0.371843</td><br></tr><br><tr><br><th>6</th><br><td>1.669025</td><br><td>-0.438570</td><br><td>-0.539741</td><br></tr><br><br></tbody><br></table><br></div><p>fillna默认返回新对象，但也可以对现有对象就地修改</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># always returns a reference to the filled object</span></div><div class="line">_ = df.fillna(<span class="number">0</span>, inplace=<span class="keyword">True</span>)</div><div class="line">df</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>-0.204708</td><br><td>0.000000</td><br><td>0.000000</td><br></tr><br><tr><br><th>1</th><br><td>-0.555730</td><br><td>0.000000</td><br><td>0.000000</td><br></tr><br><tr><br><th>2</th><br><td>0.092908</td><br><td>0.000000</td><br><td>0.000000</td><br></tr><br><tr><br><th>3</th><br><td>1.246435</td><br><td>0.000000</td><br><td>-1.296221</td><br></tr><br><tr><br><th>4</th><br><td>0.274992</td><br><td>0.000000</td><br><td>1.352917</td><br></tr><br><tr><br><th>5</th><br><td>0.886429</td><br><td>-2.001637</td><br><td>-0.371843</td><br></tr><br><tr><br><th>6</th><br><td>1.669025</td><br><td>-0.438570</td><br><td>-0.539741</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(np.random.randn(<span class="number">6</span>, <span class="number">3</span>))</div><div class="line">df.ix[<span class="number">2</span>:, <span class="number">1</span>] = NA; df.ix[<span class="number">4</span>:, <span class="number">2</span>] = NA</div><div class="line">df</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.476985</td><br><td>3.248944</td><br><td>-1.021228</td><br></tr><br><tr><br><th>1</th><br><td>-0.577087</td><br><td>0.124121</td><br><td>0.302614</td><br></tr><br><tr><br><th>2</th><br><td>0.523772</td><br><td>NaN</td><br><td>1.343810</td><br></tr><br><tr><br><th>3</th><br><td>-0.713544</td><br><td>NaN</td><br><td>-2.370232</td><br></tr><br><tr><br><th>4</th><br><td>-1.860761</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>5</th><br><td>-1.265934</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.fillna(method=<span class="string">'ffill'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.476985</td><br><td>3.248944</td><br><td>-1.021228</td><br></tr><br><tr><br><th>1</th><br><td>-0.577087</td><br><td>0.124121</td><br><td>0.302614</td><br></tr><br><tr><br><th>2</th><br><td>0.523772</td><br><td>0.124121</td><br><td>1.343810</td><br></tr><br><tr><br><th>3</th><br><td>-0.713544</td><br><td>0.124121</td><br><td>-2.370232</td><br></tr><br><tr><br><th>4</th><br><td>-1.860761</td><br><td>0.124121</td><br><td>-2.370232</td><br></tr><br><tr><br><th>5</th><br><td>-1.265934</td><br><td>0.124121</td><br><td>-2.370232</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.fillna(method=<span class="string">'ffill'</span>, limit=<span class="number">2</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.476985</td><br><td>3.248944</td><br><td>-1.021228</td><br></tr><br><tr><br><th>1</th><br><td>-0.577087</td><br><td>0.124121</td><br><td>0.302614</td><br></tr><br><tr><br><th>2</th><br><td>0.523772</td><br><td>0.124121</td><br><td>1.343810</td><br></tr><br><tr><br><th>3</th><br><td>-0.713544</td><br><td>0.124121</td><br><td>-2.370232</td><br></tr><br><tr><br><th>4</th><br><td>-1.860761</td><br><td>NaN</td><br><td>-2.370232</td><br></tr><br><tr><br><th>5</th><br><td>-1.265934</td><br><td>NaN</td><br><td>-2.370232</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data = Series([<span class="number">1.</span>, NA, <span class="number">3.5</span>, NA, <span class="number">7</span>])</div><div class="line">data.fillna(data.mean())</div></pre></td></tr></table></figure><pre><code>0    1.000000
1    3.833333
2    3.500000
3    3.833333
4    7.000000
dtype: float64
</code></pre><h2 id="层次索引"><a href="#层次索引" class="headerlink" title="层次索引"></a>层次索引</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = Series(np.random.randn(<span class="number">10</span>),</div><div class="line">              index=[[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'d'</span>],</div><div class="line">                     [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]])</div><div class="line">data</div></pre></td></tr></table></figure><pre><code>a  1    0.332883
   2   -2.359419
   3   -0.199543
b  1   -1.541996
   2   -0.970736
   3   -1.307030
c  1    0.286350
   2    0.377984
d  2   -0.753887
   3    0.331286
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.index</div></pre></td></tr></table></figure><pre><code>MultiIndex(levels=[[&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;], [1, 2, 3]],
           labels=[[0, 0, 0, 1, 1, 1, 2, 2, 3, 3], [0, 1, 2, 0, 1, 2, 0, 1, 1, 2]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'b'</span>]</div></pre></td></tr></table></figure><pre><code>1   -1.541996
2   -0.970736
3   -1.307030
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'b'</span>:<span class="string">'c'</span>]</div></pre></td></tr></table></figure><pre><code>b  1   -1.541996
   2   -0.970736
   3   -1.307030
c  1    0.286350
   2    0.377984
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[[<span class="string">'b'</span>, <span class="string">'d'</span>]]</div></pre></td></tr></table></figure><pre><code>b  1   -1.541996
   2   -0.970736
   3   -1.307030
d  2   -0.753887
   3    0.331286
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[:, <span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>a   -2.359419
b   -0.970736
c    0.377984
d   -0.753887
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.unstack()</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>1</th><br><th>2</th><br><th>3</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>0.332883</td><br><td>-2.359419</td><br><td>-0.199543</td><br></tr><br><tr><br><th>b</th><br><td>-1.541996</td><br><td>-0.970736</td><br><td>-1.307030</td><br></tr><br><tr><br><th>c</th><br><td>0.286350</td><br><td>0.377984</td><br><td>NaN</td><br></tr><br><tr><br><th>d</th><br><td>NaN</td><br><td>-0.753887</td><br><td>0.331286</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.unstack().stack()</div></pre></td></tr></table></figure><pre><code>a  1    0.332883
   2   -2.359419
   3   -0.199543
b  1   -1.541996
   2   -0.970736
   3   -1.307030
c  1    0.286350
   2    0.377984
d  2   -0.753887
   3    0.331286
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">4</span>, <span class="number">3</span>)),</div><div class="line">                  index=[[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>]],</div><div class="line">                  columns=[[<span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>],</div><div class="line">                           [<span class="string">'Green'</span>, <span class="string">'Red'</span>, <span class="string">'Green'</span>]])</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr><br><th></th><br><th></th><br><th colspan="2" halign="left">Ohio</th><br><th>Colorado</th><br></tr><br><tr><br><th></th><br><th></th><br><th>Green</th><br><th>Red</th><br><th>Green</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="2" valign="top">a</th><br><th>1</th><br><td>0</td><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>2</th><br><td>3</td><br><td>4</td><br><td>5</td><br></tr><br><tr><br><th rowspan="2" valign="top">b</th><br><th>1</th><br><td>6</td><br><td>7</td><br><td>8</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame.index.names = [<span class="string">'key1'</span>, <span class="string">'key2'</span>]</div><div class="line">frame.columns.names = [<span class="string">'state'</span>, <span class="string">'color'</span>]</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr><br><th></th><br><th>state</th><br><th colspan="2" halign="left">Ohio</th><br><th>Colorado</th><br></tr><br><tr><br><th></th><br><th>color</th><br><th>Green</th><br><th>Red</th><br><th>Green</th><br></tr><br><tr><br><th>key1</th><br><th>key2</th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="2" valign="top">a</th><br><th>1</th><br><td>0</td><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>2</th><br><td>3</td><br><td>4</td><br><td>5</td><br></tr><br><tr><br><th rowspan="2" valign="top">b</th><br><th>1</th><br><td>6</td><br><td>7</td><br><td>8</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame[<span class="string">'Ohio'</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>color</th><br><th>Green</th><br><th>Red</th><br></tr><br><tr><br><th>key1</th><br><th>key2</th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="2" valign="top">a</th><br><th>1</th><br><td>0</td><br><td>1</td><br></tr><br><tr><br><th>2</th><br><td>3</td><br><td>4</td><br></tr><br><tr><br><th rowspan="2" valign="top">b</th><br><th>1</th><br><td>6</td><br><td>7</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br></tr><br><br></tbody><br></table><br></div><p><strong>创建MultiIndex对象复用</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MultiIndex.from_arrays([[&apos;Ohio&apos;, &apos;Ohio&apos;, &apos;Colorado&apos;], [&apos;Green&apos;, &apos;Red&apos;, &apos;Green&apos;]],</div><div class="line">                       names=[&apos;state&apos;, &apos;color&apos;])</div></pre></td></tr></table></figure><p></p><h3 id="重排分级顺序"><a href="#重排分级顺序" class="headerlink" title="重排分级顺序"></a>重排分级顺序</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.swaplevel(<span class="string">'key1'</span>, <span class="string">'key2'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr><br><th></th><br><th>state</th><br><th colspan="2" halign="left">Ohio</th><br><th>Colorado</th><br></tr><br><tr><br><th></th><br><th>color</th><br><th>Green</th><br><th>Red</th><br><th>Green</th><br></tr><br><tr><br><th>key2</th><br><th>key1</th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>1</th><br><th>a</th><br><td>0</td><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>2</th><br><th>a</th><br><td>3</td><br><td>4</td><br><td>5</td><br></tr><br><tr><br><th>1</th><br><th>b</th><br><td>6</td><br><td>7</td><br><td>8</td><br></tr><br><tr><br><th>2</th><br><th>b</th><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sortlevel(<span class="number">1</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr><br><th></th><br><th>state</th><br><th colspan="2" halign="left">Ohio</th><br><th>Colorado</th><br></tr><br><tr><br><th></th><br><th>color</th><br><th>Green</th><br><th>Red</th><br><th>Green</th><br></tr><br><tr><br><th>key1</th><br><th>key2</th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><th>1</th><br><td>0</td><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>b</th><br><th>1</th><br><td>6</td><br><td>7</td><br><td>8</td><br></tr><br><tr><br><th>a</th><br><th>2</th><br><td>3</td><br><td>4</td><br><td>5</td><br></tr><br><tr><br><th>b</th><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.swaplevel(<span class="number">0</span>, <span class="number">1</span>).sortlevel(<span class="number">0</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr><br><th></th><br><th>state</th><br><th colspan="2" halign="left">Ohio</th><br><th>Colorado</th><br></tr><br><tr><br><th></th><br><th>color</th><br><th>Green</th><br><th>Red</th><br><th>Green</th><br></tr><br><tr><br><th>key2</th><br><th>key1</th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="2" valign="top">1</th><br><th>a</th><br><td>0</td><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>b</th><br><td>6</td><br><td>7</td><br><td>8</td><br></tr><br><tr><br><th rowspan="2" valign="top">2</th><br><th>a</th><br><td>3</td><br><td>4</td><br><td>5</td><br></tr><br><tr><br><th>b</th><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><br></tbody><br></table><br></div><h3 id="根据级别汇总统计"><a href="#根据级别汇总统计" class="headerlink" title="根据级别汇总统计"></a>根据级别汇总统计</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sum(level=<span class="string">'key2'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr><br><th>state</th><br><th colspan="2" halign="left">Ohio</th><br><th>Colorado</th><br></tr><br><tr><br><th>color</th><br><th>Green</th><br><th>Red</th><br><th>Green</th><br></tr><br><tr><br><th>key2</th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>1</th><br><td>6</td><br><td>8</td><br><td>10</td><br></tr><br><tr><br><th>2</th><br><td>12</td><br><td>14</td><br><td>16</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sum(level=<span class="string">'color'</span>, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>color</th><br><th>Green</th><br><th>Red</th><br></tr><br><tr><br><th>key1</th><br><th>key2</th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="2" valign="top">a</th><br><th>1</th><br><td>2</td><br><td>1</td><br></tr><br><tr><br><th>2</th><br><td>8</td><br><td>4</td><br></tr><br><tr><br><th rowspan="2" valign="top">b</th><br><th>1</th><br><td>14</td><br><td>7</td><br></tr><br><tr><br><th>2</th><br><td>20</td><br><td>10</td><br></tr><br><br></tbody><br></table><br></div><h3 id="使用DataFrame的列"><a href="#使用DataFrame的列" class="headerlink" title="使用DataFrame的列"></a>使用DataFrame的列</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(&#123;<span class="string">'a'</span>: range(<span class="number">7</span>), <span class="string">'b'</span>: range(<span class="number">7</span>, <span class="number">0</span>, <span class="number">-1</span>),</div><div class="line">                   <span class="string">'c'</span>: [<span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'two'</span>, <span class="string">'two'</span>, <span class="string">'two'</span>],</div><div class="line">                   <span class="string">'d'</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;)</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0</td><br><td>7</td><br><td>one</td><br><td>0</td><br></tr><br><tr><br><th>1</th><br><td>1</td><br><td>6</td><br><td>one</td><br><td>1</td><br></tr><br><tr><br><th>2</th><br><td>2</td><br><td>5</td><br><td>one</td><br><td>2</td><br></tr><br><tr><br><th>3</th><br><td>3</td><br><td>4</td><br><td>two</td><br><td>0</td><br></tr><br><tr><br><th>4</th><br><td>4</td><br><td>3</td><br><td>two</td><br><td>1</td><br></tr><br><tr><br><th>5</th><br><td>5</td><br><td>2</td><br><td>two</td><br><td>2</td><br></tr><br><tr><br><th>6</th><br><td>6</td><br><td>1</td><br><td>two</td><br><td>3</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame2 = frame.set_index([<span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">frame2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th></th><br><th>a</th><br><th>b</th><br></tr><br><tr><br><th>c</th><br><th>d</th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="3" valign="top">one</th><br><th>0</th><br><td>0</td><br><td>7</td><br></tr><br><tr><br><th>1</th><br><td>1</td><br><td>6</td><br></tr><br><tr><br><th>2</th><br><td>2</td><br><td>5</td><br></tr><br><tr><br><th rowspan="4" valign="top">two</th><br><th>0</th><br><td>3</td><br><td>4</td><br></tr><br><tr><br><th>1</th><br><td>4</td><br><td>3</td><br></tr><br><tr><br><th>2</th><br><td>5</td><br><td>2</td><br></tr><br><tr><br><th>3</th><br><td>6</td><br><td>1</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.set_index([<span class="string">'c'</span>, <span class="string">'d'</span>], drop=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br></tr><br><tr><br><th>c</th><br><th>d</th><br><th></th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="3" valign="top">one</th><br><th>0</th><br><td>0</td><br><td>7</td><br><td>one</td><br><td>0</td><br></tr><br><tr><br><th>1</th><br><td>1</td><br><td>6</td><br><td>one</td><br><td>1</td><br></tr><br><tr><br><th>2</th><br><td>2</td><br><td>5</td><br><td>one</td><br><td>2</td><br></tr><br><tr><br><th rowspan="4" valign="top">two</th><br><th>0</th><br><td>3</td><br><td>4</td><br><td>two</td><br><td>0</td><br></tr><br><tr><br><th>1</th><br><td>4</td><br><td>3</td><br><td>two</td><br><td>1</td><br></tr><br><tr><br><th>2</th><br><td>5</td><br><td>2</td><br><td>two</td><br><td>2</td><br></tr><br><tr><br><th>3</th><br><td>6</td><br><td>1</td><br><td>two</td><br><td>3</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2.reset_index()</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>c</th><br><th>d</th><br><th>a</th><br><th>b</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>one</td><br><td>0</td><br><td>0</td><br><td>7</td><br></tr><br><tr><br><th>1</th><br><td>one</td><br><td>1</td><br><td>1</td><br><td>6</td><br></tr><br><tr><br><th>2</th><br><td>one</td><br><td>2</td><br><td>2</td><br><td>5</td><br></tr><br><tr><br><th>3</th><br><td>two</td><br><td>0</td><br><td>3</td><br><td>4</td><br></tr><br><tr><br><th>4</th><br><td>two</td><br><td>1</td><br><td>4</td><br><td>3</td><br></tr><br><tr><br><th>5</th><br><td>two</td><br><td>2</td><br><td>5</td><br><td>2</td><br></tr><br><tr><br><th>6</th><br><td>two</td><br><td>3</td><br><td>6</td><br><td>1</td><br></tr><br><br></tbody><br></table><br></div><h2 id="拓展话题"><a href="#拓展话题" class="headerlink" title="拓展话题"></a>拓展话题</h2><h3 id="整数索引"><a href="#整数索引" class="headerlink" title="整数索引"></a>整数索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ser = Series(np.arange(<span class="number">3.</span>))</div><div class="line">ser.iloc[<span class="number">-1</span>]</div></pre></td></tr></table></figure><pre><code>2.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ser</div></pre></td></tr></table></figure><pre><code>0    0.0
1    1.0
2    2.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ser2 = Series(np.arange(<span class="number">3.</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">ser2[<span class="number">-1</span>]</div></pre></td></tr></table></figure><pre><code>2.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ser.ix[:<span class="number">1</span>]</div></pre></td></tr></table></figure><pre><code>0    0.0
1    1.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ser3 = Series(range(<span class="number">3</span>), index=[<span class="number">-5</span>, <span class="number">1</span>, <span class="number">3</span>])</div><div class="line">ser3.iloc[<span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>2
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">6</span>).reshape((<span class="number">3</span>, <span class="number">2</span>)), index=[<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>])</div><div class="line">frame</div><div class="line">frame.iloc[<span class="number">0</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2</th><br><td>0</td><br><td>1</td><br></tr><br><tr><br><th>0</th><br><td>2</td><br><td>3</td><br></tr><br><tr><br><th>1</th><br><td>4</td><br><td>5</td><br></tr><br><br></tbody><br></table><br></div><pre><code>0    0
1    1
Name: 2, dtype: int32
</code></pre><h3 id="面板数据"><a href="#面板数据" class="headerlink" title="面板数据"></a>面板数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas_datareader.data <span class="keyword">as</span> web</div><div class="line"></div><div class="line">pdata = pd.Panel(dict((stk, web.get_data_yahoo(stk))</div><div class="line">                       <span class="keyword">for</span> stk <span class="keyword">in</span> [<span class="string">'AAPL'</span>, <span class="string">'GOOG'</span>, <span class="string">'MSFT'</span>, <span class="string">'DELL'</span>]))</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pdata</div></pre></td></tr></table></figure><pre><code>&lt;class &apos;pandas.core.panel.Panel&apos;&gt;
Dimensions: 4 (items) x 1820 (major_axis) x 6 (minor_axis)
Items axis: AAPL to MSFT
Major_axis axis: 2010-01-04 00:00:00 to 2017-02-27 00:00:00
Minor_axis axis: Open to Adj Close
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pdata = pdata.swapaxes(<span class="string">'items'</span>, <span class="string">'minor'</span>)</div><div class="line">pdata[<span class="string">'Adj Close'</span>].iloc[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>AAPL</th><br><th>DELL</th><br><th>GOOG</th><br><th>MSFT</th><br></tr><br><tr><br><th>Date</th><br><th></th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2010-01-04</th><br><td>27.727039</td><br><td>14.06528</td><br><td>313.062468</td><br><td>25.555485</td><br></tr><br><tr><br><th>2010-01-05</th><br><td>27.774976</td><br><td>14.38450</td><br><td>311.683844</td><br><td>25.563741</td><br></tr><br><tr><br><th>2010-01-06</th><br><td>27.333178</td><br><td>14.10397</td><br><td>303.826685</td><br><td>25.406859</td><br></tr><br><tr><br><th>2010-01-07</th><br><td>27.282650</td><br><td>14.23940</td><br><td>296.753749</td><br><td>25.142634</td><br></tr><br><tr><br><th>2010-01-08</th><br><td>27.464034</td><br><td>14.36516</td><br><td>300.709808</td><br><td>25.316031</td><br></tr><br><tr><br><th>2010-01-11</th><br><td>27.221758</td><br><td>14.37483</td><br><td>300.255255</td><br><td>24.994007</td><br></tr><br><tr><br><th>2010-01-12</th><br><td>26.912110</td><br><td>14.56830</td><br><td>294.945572</td><br><td>24.828866</td><br></tr><br><tr><br><th>2010-01-13</th><br><td>27.291720</td><br><td>14.57797</td><br><td>293.252243</td><br><td>25.060064</td><br></tr><br><tr><br><th>2010-01-14</th><br><td>27.133657</td><br><td>14.22005</td><br><td>294.630868</td><br><td>25.563741</td><br></tr><br><tr><br><th>2010-01-15</th><br><td>26.680198</td><br><td>13.92985</td><br><td>289.710772</td><br><td>25.481172</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pdata.ix[:, <span class="string">'6/1/2012'</span>, :]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Open</th><br><th>High</th><br><th>Low</th><br><th>Close</th><br><th>Volume</th><br><th>Adj Close</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>AAPL</th><br><td>569.159996</td><br><td>572.650009</td><br><td>560.520012</td><br><td>560.989983</td><br><td>130246900.0</td><br><td>72.681610</td><br></tr><br><tr><br><th>DELL</th><br><td>12.150000</td><br><td>12.300000</td><br><td>12.045000</td><br><td>12.070000</td><br><td>19397600.0</td><br><td>11.675920</td><br></tr><br><tr><br><th>GOOG</th><br><td>571.790972</td><br><td>572.650996</td><br><td>568.350996</td><br><td>570.981000</td><br><td>6138700.0</td><br><td>285.205295</td><br></tr><br><tr><br><th>MSFT</th><br><td>28.760000</td><br><td>28.959999</td><br><td>28.440001</td><br><td>28.450001</td><br><td>56634300.0</td><br><td>24.942239</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pdata.ix[<span class="string">'Adj Close'</span>, <span class="string">'5/22/2012'</span>:, :].iloc[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>AAPL</th><br><th>DELL</th><br><th>GOOG</th><br><th>MSFT</th><br></tr><br><tr><br><th>Date</th><br><th></th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2012-05-22</th><br><td>72.160786</td><br><td>14.58765</td><br><td>300.100412</td><br><td>26.090721</td><br></tr><br><tr><br><th>2012-05-23</th><br><td>73.921494</td><br><td>12.08221</td><br><td>304.426106</td><br><td>25.520864</td><br></tr><br><tr><br><th>2012-05-24</th><br><td>73.242607</td><br><td>12.04351</td><br><td>301.528978</td><br><td>25.485795</td><br></tr><br><tr><br><th>2012-05-25</th><br><td>72.850038</td><br><td>12.05319</td><br><td>295.470050</td><br><td>25.477028</td><br></tr><br><tr><br><th>2012-05-28</th><br><td>NaN</td><br><td>12.05319</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2012-05-29</th><br><td>74.143041</td><br><td>12.24666</td><br><td>296.873645</td><br><td>25.915380</td><br></tr><br><tr><br><th>2012-05-30</th><br><td>75.037005</td><br><td>12.14992</td><br><td>293.821674</td><br><td>25.722505</td><br></tr><br><tr><br><th>2012-05-31</th><br><td>74.850442</td><br><td>11.92743</td><br><td>290.140354</td><br><td>25.591000</td><br></tr><br><tr><br><th>2012-06-01</th><br><td>72.681610</td><br><td>11.67592</td><br><td>285.205295</td><br><td>24.942239</td><br></tr><br><tr><br><th>2012-06-04</th><br><td>73.109156</td><br><td>11.60821</td><br><td>289.006480</td><br><td>25.029908</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">stacked = pdata.ix[:, <span class="string">'5/30/2012'</span>:, :].to_frame()</div><div class="line">stacked</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th></th><br><th>Open</th><br><th>High</th><br><th>Low</th><br><th>Close</th><br><th>Volume</th><br><th>Adj Close</th><br></tr><br><tr><br><th>Date</th><br><th>minor</th><br><th></th><br><th></th><br><th></th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="4" valign="top">2012-05-30</th><br><th>AAPL</th><br><td>569.199997</td><br><td>579.989990</td><br><td>566.559990</td><br><td>579.169998</td><br><td>132357400.0</td><br><td>75.037005</td><br></tr><br><tr><br><th>DELL</th><br><td>12.590000</td><br><td>12.700000</td><br><td>12.460000</td><br><td>12.560000</td><br><td>19787800.0</td><br><td>12.149920</td><br></tr><br><tr><br><th>GOOG</th><br><td>588.161028</td><br><td>591.901014</td><br><td>583.530999</td><br><td>588.230992</td><br><td>3827600.0</td><br><td>293.821674</td><br></tr><br><tr><br><th>MSFT</th><br><td>29.350000</td><br><td>29.480000</td><br><td>29.120001</td><br><td>29.340000</td><br><td>41585500.0</td><br><td>25.722505</td><br></tr><br><tr><br><th rowspan="4" valign="top">2012-05-31</th><br><th>AAPL</th><br><td>580.740021</td><br><td>581.499985</td><br><td>571.460022</td><br><td>577.730019</td><br><td>122918600.0</td><br><td>74.850442</td><br></tr><br><tr><br><th>DELL</th><br><td>12.530000</td><br><td>12.540000</td><br><td>12.330000</td><br><td>12.330000</td><br><td>19955600.0</td><br><td>11.927430</td><br></tr><br><tr><br><th>GOOG</th><br><td>588.720982</td><br><td>590.001032</td><br><td>579.001013</td><br><td>580.860990</td><br><td>5958800.0</td><br><td>290.140354</td><br></tr><br><tr><br><th>MSFT</th><br><td>29.299999</td><br><td>29.420000</td><br><td>28.940001</td><br><td>29.190001</td><br><td>39134000.0</td><br><td>25.591000</td><br></tr><br><tr><br><th rowspan="4" valign="top">2012-06-01</th><br><th>AAPL</th><br><td>569.159996</td><br><td>572.650009</td><br><td>560.520012</td><br><td>560.989983</td><br><td>130246900.0</td><br><td>72.681610</td><br></tr><br><tr><br><th>DELL</th><br><td>12.150000</td><br><td>12.300000</td><br><td>12.045000</td><br><td>12.070000</td><br><td>19397600.0</td><br><td>11.675920</td><br></tr><br><tr><br><th>GOOG</th><br><td>571.790972</td><br><td>572.650996</td><br><td>568.350996</td><br><td>570.981000</td><br><td>6138700.0</td><br><td>285.205295</td><br></tr><br><tr><br><th>MSFT</th><br><td>28.760000</td><br><td>28.959999</td><br><td>28.440001</td><br><td>28.450001</td><br><td>56634300.0</td><br><td>24.942239</td><br></tr><br><tr><br><th rowspan="4" valign="top">2012-06-04</th><br><th>AAPL</th><br><td>561.500008</td><br><td>567.499985</td><br><td>548.499977</td><br><td>564.289978</td><br><td>139248900.0</td><br><td>73.109156</td><br></tr><br><tr><br><th>DELL</th><br><td>12.110000</td><br><td>12.112500</td><br><td>11.800000</td><br><td>12.000000</td><br><td>17015700.0</td><br><td>11.608210</td><br></tr><br><tr><br><th>GOOG</th><br><td>570.220958</td><br><td>580.491016</td><br><td>570.011006</td><br><td>578.590973</td><br><td>4883500.0</td><br><td>289.006480</td><br></tr><br><tr><br><th>MSFT</th><br><td>28.620001</td><br><td>28.780001</td><br><td>28.320000</td><br><td>28.549999</td><br><td>47926300.0</td><br><td>25.029908</td><br></tr><br><tr><br><th rowspan="4" valign="top">2012-06-05</th><br><th>AAPL</th><br><td>561.269989</td><br><td>566.470001</td><br><td>558.330002</td><br><td>562.830025</td><br><td>97053600.0</td><br><td>72.920005</td><br></tr><br><tr><br><th>DELL</th><br><td>11.950000</td><br><td>12.240000</td><br><td>11.950000</td><br><td>12.160000</td><br><td>15620900.0</td><br><td>11.762980</td><br></tr><br><tr><br><th>GOOG</th><br><td>575.451008</td><br><td>578.131003</td><br><td>566.470986</td><br><td>570.410999</td><br><td>4697200.0</td><br><td>284.920579</td><br></tr><br><tr><br><th>MSFT</th><br><td>28.510000</td><br><td>28.750000</td><br><td>28.389999</td><br><td>28.510000</td><br><td>45715400.0</td><br><td>24.994841</td><br></tr><br><tr><br><th rowspan="4" valign="top">2012-06-06</th><br><th>AAPL</th><br><td>567.770004</td><br><td>573.849983</td><br><td>565.499992</td><br><td>571.460022</td><br><td>100363900.0</td><br><td>74.038104</td><br></tr><br><tr><br><th>DELL</th><br><td>12.210000</td><br><td>12.280000</td><br><td>12.090000</td><br><td>12.215000</td><br><td>20779900.0</td><br><td>11.816190</td><br></tr><br><tr><br><th>GOOG</th><br><td>576.480979</td><br><td>581.970971</td><br><td>573.611004</td><br><td>580.570966</td><br><td>4207200.0</td><br><td>289.995487</td><br></tr><br><tr><br><th>MSFT</th><br><td>28.879999</td><br><td>29.370001</td><br><td>28.809999</td><br><td>29.350000</td><br><td>46860500.0</td><br><td>25.731273</td><br></tr><br><tr><br><th rowspan="4" valign="top">2012-06-07</th><br><th>AAPL</th><br><td>577.290009</td><br><td>577.320023</td><br><td>570.500000</td><br><td>571.720001</td><br><td>94941700.0</td><br><td>74.071787</td><br></tr><br><tr><br><th>DELL</th><br><td>12.320000</td><br><td>12.410000</td><br><td>12.120000</td><br><td>12.130000</td><br><td>20074000.0</td><br><td>11.733960</td><br></tr><br><tr><br><th>GOOG</th><br><td>587.601014</td><br><td>587.891038</td><br><td>577.251006</td><br><td>578.230986</td><br><td>3530100.0</td><br><td>288.826666</td><br></tr><br><tr><br><th>MSFT</th><br><td>29.639999</td><br><td>29.700001</td><br><td>29.170000</td><br><td>29.230000</td><br><td>37792800.0</td><br><td>25.626067</td><br></tr><br><tr><br><th rowspan="2" valign="top">2012-06-08</th><br><th>AAPL</th><br><td>571.599998</td><br><td>580.580017</td><br><td>568.999992</td><br><td>580.319984</td><br><td>86879100.0</td><br><td>75.185997</td><br></tr><br><tr><br><th>DELL</th><br><td>12.130000</td><br><td>12.225000</td><br><td>12.020000</td><br><td>12.120000</td><br><td>18155600.0</td><br><td>11.724290</td><br></tr><br><tr><br><th>…</th><br><th>…</th><br><td>…</td><br><td>…</td><br><td>…</td><br><td>…</td><br><td>…</td><br><td>…</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-13</th><br><th>AAPL</th><br><td>133.080002</td><br><td>133.820007</td><br><td>132.750000</td><br><td>133.289993</td><br><td>23035400.0</td><br><td>133.289993</td><br></tr><br><tr><br><th>GOOG</th><br><td>816.000000</td><br><td>820.958984</td><br><td>815.489990</td><br><td>819.239990</td><br><td>1198100.0</td><br><td>819.239990</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.239998</td><br><td>64.860001</td><br><td>64.129997</td><br><td>64.720001</td><br><td>22920100.0</td><br><td>64.330000</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-14</th><br><th>AAPL</th><br><td>133.470001</td><br><td>135.089996</td><br><td>133.250000</td><br><td>135.020004</td><br><td>32815500.0</td><br><td>135.020004</td><br></tr><br><tr><br><th>GOOG</th><br><td>819.000000</td><br><td>823.000000</td><br><td>816.000000</td><br><td>820.450012</td><br><td>1053600.0</td><br><td>820.450012</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.410004</td><br><td>64.720001</td><br><td>64.019997</td><br><td>64.570000</td><br><td>23065900.0</td><br><td>64.570000</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-15</th><br><th>AAPL</th><br><td>135.520004</td><br><td>136.270004</td><br><td>134.619995</td><br><td>135.509995</td><br><td>35501600.0</td><br><td>135.509995</td><br></tr><br><tr><br><th>GOOG</th><br><td>819.359985</td><br><td>823.000000</td><br><td>818.469971</td><br><td>818.979980</td><br><td>1304000.0</td><br><td>818.979980</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.500000</td><br><td>64.570000</td><br><td>64.160004</td><br><td>64.529999</td><br><td>16917000.0</td><br><td>64.529999</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-16</th><br><th>AAPL</th><br><td>135.669998</td><br><td>135.899994</td><br><td>134.839996</td><br><td>135.350006</td><br><td>22118000.0</td><br><td>135.350006</td><br></tr><br><tr><br><th>GOOG</th><br><td>819.929993</td><br><td>824.400024</td><br><td>818.979980</td><br><td>824.159973</td><br><td>1281700.0</td><br><td>824.159973</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.739998</td><br><td>65.239998</td><br><td>64.440002</td><br><td>64.519997</td><br><td>20524700.0</td><br><td>64.519997</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-17</th><br><th>AAPL</th><br><td>135.100006</td><br><td>135.830002</td><br><td>135.100006</td><br><td>135.720001</td><br><td>22084500.0</td><br><td>135.720001</td><br></tr><br><tr><br><th>GOOG</th><br><td>823.020020</td><br><td>828.070007</td><br><td>821.655029</td><br><td>828.070007</td><br><td>1597800.0</td><br><td>828.070007</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.470001</td><br><td>64.690002</td><br><td>64.300003</td><br><td>64.620003</td><br><td>21234600.0</td><br><td>64.620003</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-21</th><br><th>AAPL</th><br><td>136.229996</td><br><td>136.750000</td><br><td>135.979996</td><br><td>136.699997</td><br><td>24265100.0</td><br><td>136.699997</td><br></tr><br><tr><br><th>GOOG</th><br><td>828.659973</td><br><td>833.450012</td><br><td>828.349976</td><br><td>831.659973</td><br><td>1247700.0</td><br><td>831.659973</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.610001</td><br><td>64.949997</td><br><td>64.449997</td><br><td>64.489998</td><br><td>19384900.0</td><br><td>64.489998</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-22</th><br><th>AAPL</th><br><td>136.429993</td><br><td>137.119995</td><br><td>136.110001</td><br><td>137.110001</td><br><td>20745300.0</td><br><td>137.110001</td><br></tr><br><tr><br><th>GOOG</th><br><td>828.659973</td><br><td>833.250000</td><br><td>828.640015</td><br><td>830.760010</td><br><td>982900.0</td><br><td>830.760010</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.330002</td><br><td>64.389999</td><br><td>64.050003</td><br><td>64.360001</td><br><td>19259700.0</td><br><td>64.360001</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-23</th><br><th>AAPL</th><br><td>137.380005</td><br><td>137.479996</td><br><td>136.300003</td><br><td>136.529999</td><br><td>20704100.0</td><br><td>136.529999</td><br></tr><br><tr><br><th>GOOG</th><br><td>830.119995</td><br><td>832.460022</td><br><td>822.880005</td><br><td>831.330017</td><br><td>1470100.0</td><br><td>831.330017</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.419998</td><br><td>64.730003</td><br><td>64.190002</td><br><td>64.620003</td><br><td>20235200.0</td><br><td>64.620003</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-24</th><br><th>AAPL</th><br><td>135.910004</td><br><td>136.660004</td><br><td>135.279999</td><br><td>136.660004</td><br><td>21690900.0</td><br><td>136.660004</td><br></tr><br><tr><br><th>GOOG</th><br><td>827.729980</td><br><td>829.000000</td><br><td>824.200012</td><br><td>828.640015</td><br><td>1386600.0</td><br><td>828.640015</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.529999</td><br><td>64.800003</td><br><td>64.139999</td><br><td>64.620003</td><br><td>21705200.0</td><br><td>64.620003</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-27</th><br><th>AAPL</th><br><td>137.139999</td><br><td>137.440002</td><br><td>136.279999</td><br><td>136.929993</td><br><td>20196400.0</td><br><td>136.929993</td><br></tr><br><tr><br><th>GOOG</th><br><td>824.549988</td><br><td>830.500000</td><br><td>824.000000</td><br><td>829.280029</td><br><td>1099500.0</td><br><td>829.280029</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.540001</td><br><td>64.540001</td><br><td>64.050003</td><br><td>64.230003</td><br><td>15850400.0</td><br><td>64.230003</td><br></tr><br><br></tbody><br></table><br><p>3952 rows × 6 columns</p><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">stacked.to_panel()</div></pre></td></tr></table></figure><pre><code>&lt;class &apos;pandas.core.panel.Panel&apos;&gt;
Dimensions: 6 (items) x 1207 (major_axis) x 4 (minor_axis)
Items axis: Open to Adj Close
Major_axis axis: 2012-05-30 00:00:00 to 2017-02-27 00:00:00
Minor_axis axis: AAPL to MSFT
</code></pre></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></section><nav class="pagination"><a class="extend prev" rel="prev" href="/page/21/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><span class="page-number current">22</span><a class="page-number" href="/page/23/">23</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/23/"><i class="fa fa-angle-right"></i></a></nav></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview sidebar-panel sidebar-panel-active"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Ewan Li"><p class="site-author-name" itemprop="name">Ewan Li</p><p class="site-description motion-element" itemprop="description">Ewan's IT Blog</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">122</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-tags"><a href="/tags"><span class="site-state-item-count">58</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ewanlee" target="_blank" title="Github"><i class="fa fa-fw fa-globe"></i> Github </a></span><span class="links-of-author-item"><a href="http://weibo.com/3946248928/profile?topnav=1&wvr=6" target="_blank" title="Weibo"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Ewan Li</span></div><div class="powered-by">Powered by <a class="theme-link" href="https://hexo.io">Hexo</a></div><div class="theme-info">Theme - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user">本站访客数</i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span>人次</span> <span class="site-pv"><i class="fa fa-eye">本站总访问量</i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script><script type="text/javascript">_hcwp=window._hcwp||[],_hcwp.push({widget:"Bloggerstream",widget_id:89825,selector:".hc-comment-count",label:"{%COUNT%}"}),function(){if(!("HC_LOAD_INIT"in window)){HC_LOAD_INIT=!0;var t=(navigator.language||navigator.systemLanguage||navigator.userLanguage||"en").substr(0,2).toLowerCase(),e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https":"http")+"://w.hypercomments.com/widget/hc/89825/"+t+"/widget.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n.nextSibling)}}()</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path,searchFunc=function(e,t,a){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var r=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),c=document.getElementById(t),n=document.getElementById(a);c.addEventListener("input",function(){var e=0,t='<ul class="search-result-list">',a=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length>1&&r.forEach(function(r){var c=!1,n=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),o=decodeURIComponent(r.url),i=-1,l=-1,p=-1;if(""!=n&&a.forEach(function(e,t){i=n.indexOf(e),l=s.indexOf(e),(i>=0||l>=0)&&(c=!0,0==t&&(p=l))}),c){e+=1,t+="<li><a href='"+o+"' class='search-result-title'>"+n+"</a>";var h=r.content.trim().replace(/<[^>]+>/g,"");if(p>=0){var u=p-20,d=p+80;u<0&&(u=0),0==u&&(d=50),d>h.length&&(d=h.length);var f=h.substring(u,d);a.forEach(function(e){var t=new RegExp(e,"gi");f=f.replace(t,'<b class="search-keyword">'+e+"</b>")}),t+='<p class="search-result">'+f+"...</p>"}t+="</li>"}}),t+="</ul>",0==e&&(t='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==a&&(t='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),n.innerHTML=t}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("e27VKX5tTklQLCtF7iNMmhcA-gzGzoHsz","nnQn2znNgXXEdK7W2bVJ3bfK")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var r=e[i],s=r.get("url"),l=r.get("time"),c=document.getElementById(s);$(c).find(t).text(l)}for(var i=0;i<n.length;i++){var s=n[i],c=document.getElementById(s),u=$(c).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script></body></html>