<!doctype html><html class="theme-next mist use-motion" lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css"><meta name="keywords" content="Hexo, NexT"><link rel="alternate" href="/atom.xml" title="Abracadabra" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0"><meta name="description" content="Ewan&apos;s IT Blog"><meta property="og:type" content="website"><meta property="og:title" content="Abracadabra"><meta property="og:url" content="http://yoursite.com/page/22/index.html"><meta property="og:site_name" content="Abracadabra"><meta property="og:description" content="Ewan&apos;s IT Blog"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Abracadabra"><meta name="twitter:description" content="Ewan&apos;s IT Blog"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://yoursite.com/page/22/"><title>Abracadabra</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?dc405a79ad500922134d14cdf288f646";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-left page-home"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Abracadabra</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Do it yourself</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>Categories</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>About</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>Tags</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>Sitemap</a></li><li class="menu-item menu-item-commonweal"><a href="/404.html" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div><span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><section id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/02/cs231n-Assignment-1-kNN/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracadabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracadabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/2017/03/02/cs231n-Assignment-1-kNN/" itemprop="url">cs231n Assignment#1 kNN</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-02T22:26:57+08:00">2017-03-02 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/03/02/cs231n-Assignment-1-kNN/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2017/03/02/cs231n-Assignment-1-kNN/" itemprop="commentsCount"></span> </a></span><span id="/2017/03/02/cs231n-Assignment-1-kNN/" class="leancloud_visitors" data-flag-title="cs231n Assignment#1 kNN"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="k-Nearest-Neighbor-kNN-exercise"><a href="#k-Nearest-Neighbor-kNN-exercise" class="headerlink" title="k-Nearest Neighbor (kNN) exercise"></a>k-Nearest Neighbor (kNN) exercise</h1><p><em>Complete and hand in this completed worksheet (including its outputs and any supporting code outside of the worksheet) with your assignment submission. For more details see the <a href="http://vision.stanford.edu/teaching/cs231n/assignments.html" target="_blank" rel="external">assignments page</a> on the course website.</em></p><p>The kNN classifier consists of two stages:</p><ul><li>During training, the classifier takes the training data and simply remembers it</li><li>During testing, kNN classifies every test image by comparing to all training images and transfering the labels of the k most similar training examples</li><li>The value of k is cross-validated</li></ul><p>In this exercise you will implement these steps and understand the basic Image Classification pipeline, cross-validation, and gain proficiency in writing efficient, vectorized code.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Run some setup code for this notebook.</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> random</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> cs231n.data_utils <span class="keyword">import</span> load_CIFAR10</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"></div><div class="line"><span class="comment"># This is a bit of magic to make matplotlib figures appear inline in the notebook</span></div><div class="line"><span class="comment"># rather than in a new window.</span></div><div class="line">%matplotlib inline</div><div class="line">plt.rcParams[<span class="string">'figure.figsize'</span>] = (<span class="number">10.0</span>, <span class="number">8.0</span>) <span class="comment"># set default size of plots</span></div><div class="line">plt.rcParams[<span class="string">'image.interpolation'</span>] = <span class="string">'nearest'</span></div><div class="line">plt.rcParams[<span class="string">'image.cmap'</span>] = <span class="string">'gray'</span></div><div class="line"></div><div class="line"><span class="comment"># Some more magic so that the notebook will reload external python modules;</span></div><div class="line"><span class="comment"># see http://stackoverflow.com/questions/1907993/autoreload-of-modules-in-ipython</span></div><div class="line">%load_ext autoreload</div><div class="line">%autoreload <span class="number">2</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Load the raw CIFAR-10 data.</span></div><div class="line">cifar10_dir = <span class="string">'cs231n/datasets/cifar-10-batches-py'</span></div><div class="line">X_train, y_train, X_test, y_test = load_CIFAR10(cifar10_dir)</div><div class="line"></div><div class="line"><span class="comment"># As a sanity check, we print out the size of the training and test data.</span></div><div class="line"><span class="keyword">print</span> <span class="string">'Training data shape: '</span>, X_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Training labels shape: '</span>, y_train.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test data shape: '</span>, X_test.shape</div><div class="line"><span class="keyword">print</span> <span class="string">'Test labels shape: '</span>, y_test.shape</div></pre></td></tr></table></figure><pre><code>Training data shape:  (50000L, 32L, 32L, 3L)
Training labels shape:  (50000L,)
Test data shape:  (10000L, 32L, 32L, 3L)
Test labels shape:  (10000L,)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Visualize some examples from the dataset.</span></div><div class="line"><span class="comment"># We show a few examples of training images from each class.</span></div><div class="line">classes = [<span class="string">'plane'</span>, <span class="string">'car'</span>, <span class="string">'bird'</span>, <span class="string">'cat'</span>, <span class="string">'deer'</span>, <span class="string">'dog'</span>, <span class="string">'frog'</span>, <span class="string">'horse'</span>, <span class="string">'ship'</span>, <span class="string">'truck'</span>]</div><div class="line">num_classes = len(classes)</div><div class="line">samples_per_class = <span class="number">7</span></div><div class="line"><span class="keyword">for</span> y, cls <span class="keyword">in</span> enumerate(classes):</div><div class="line">    idxs = np.flatnonzero(y_train == y)</div><div class="line">    idxs = np.random.choice(idxs, samples_per_class, replace=<span class="keyword">False</span>)</div><div class="line">    <span class="keyword">for</span> i, idx <span class="keyword">in</span> enumerate(idxs):</div><div class="line">        plt_idx = i * num_classes + y + <span class="number">1</span></div><div class="line">        plt.subplot(samples_per_class, num_classes, plt_idx)</div><div class="line">        plt.imshow(X_train[idx].astype(<span class="string">'uint8'</span>))</div><div class="line">        plt.axis(<span class="string">'off'</span>)</div><div class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:</div><div class="line">            plt.title(cls)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/knn/sample.png" alt="sample"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Subsample the data for more efficient code execution in this exercise</span></div><div class="line">num_training = <span class="number">5000</span></div><div class="line">mask = range(num_training)</div><div class="line">X_train = X_train[mask]</div><div class="line">y_train = y_train[mask]</div><div class="line"></div><div class="line">num_test = <span class="number">500</span></div><div class="line">mask = range(num_test)</div><div class="line">X_test = X_test[mask]</div><div class="line">y_test = y_test[mask]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Reshape the image data into rows</span></div><div class="line">X_train = np.reshape(X_train, (X_train.shape[<span class="number">0</span>], <span class="number">-1</span>)) <span class="comment"># Wow~</span></div><div class="line">X_test = np.reshape(X_test, (X_test.shape[<span class="number">0</span>], <span class="number">-1</span>))</div><div class="line"><span class="keyword">print</span> X_train.shape, X_test.shape</div></pre></td></tr></table></figure><pre><code>(5000L, 3072L) (500L, 3072L)
</code></pre><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> cs231n.classifiers <span class="keyword">import</span> KNearestNeighbor</div><div class="line"></div><div class="line"><span class="comment"># Create a kNN classifier instance. </span></div><div class="line"><span class="comment"># Remember that training a kNN classifier is a noop: </span></div><div class="line"><span class="comment"># the Classifier simply remembers the data and does no further processing </span></div><div class="line">classifier = KNearestNeighbor()</div><div class="line">classifier.train(X_train, y_train)</div></pre></td></tr></table></figure><p>We would now like to classify the test data with the kNN classifier. Recall that we can break down this process into two steps:</p><ol><li>First we must compute the distances between all test examples and all train examples.</li><li>Given these distances, for each test example we find the k nearest examples and have them vote for the label</li></ol><p>Lets begin with computing the distance matrix between all training and test examples. For example, if there are <strong>Ntr</strong> training examples and <strong>Nte</strong> test examples, this stage should result in a <strong>Nte x Ntr</strong> matrix where each element (i,j) is the distance between the i-th test and j-th train example.</p><p>First, open <code>cs231n/classifiers/k_nearest_neighbor.py</code> and implement the function <code>compute_distances_two_loops</code> that uses a (very inefficient) double loop over all pairs of (test, train) examples and computes the distance matrix one element at a time.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Open cs231n/classifiers/k_nearest_neighbor.py and implement</span></div><div class="line"><span class="comment"># compute_distances_two_loops.</span></div><div class="line"></div><div class="line"><span class="comment"># Test your implementation:</span></div><div class="line">dists = classifier.compute_distances_two_loops(X_test)</div><div class="line"><span class="keyword">print</span> dists.shape</div></pre></td></tr></table></figure><pre><code>(500L, 5000L)
</code></pre><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># We can visualize the distance matrix: each row is a single test example and</span></div><div class="line"><span class="comment"># its distances to training examples</span></div><div class="line">plt.imshow(dists, interpolation=<span class="string">'none'</span>)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/knn/dists.png" alt="dists"></p><p><strong>Inline Question #1:</strong> Notice the structured patterns in the distance matrix, where some rows or columns are visible brighter. (Note that with the default color scheme black indicates low distances while white indicates high distances.)</p><ul><li>What in the data is the cause behind the distinctly bright rows?</li><li>What causes the columns?</li></ul><p><strong>Your Answer</strong>: <em>Maybe exists noises in test data set and train data set.</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Now implement the function predict_labels and run the code below:</span></div><div class="line"><span class="comment"># We use k = 1 (which is Nearest Neighbor).</span></div><div class="line">y_test_pred = classifier.predict_labels(dists, k=<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="comment"># Compute and print the fraction of correctly predicted examples</span></div><div class="line">num_correct = np.sum(y_test_pred == y_test)</div><div class="line">accuracy = float(num_correct) / num_test</div><div class="line"><span class="keyword">print</span> <span class="string">'Got %d / %d correct =&gt; accuracy: %f'</span> % (num_correct, num_test, accuracy)</div></pre></td></tr></table></figure><pre><code>Got 137 / 500 correct =&gt; accuracy: 0.274000
</code></pre><p>​</p><p>You should expect to see approximately <code>27%</code> accuracy. Now lets try out a larger <code>k</code>, say <code>k = 5</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">y_test_pred = classifier.predict_labels(dists, k=<span class="number">5</span>)</div><div class="line">num_correct = np.sum(y_test_pred == y_test)</div><div class="line">accuracy = float(num_correct) / num_test</div><div class="line"><span class="keyword">print</span> <span class="string">'Got %d / %d correct =&gt; accuracy: %f'</span> % (num_correct, num_test, accuracy)</div></pre></td></tr></table></figure><pre><code>Got 142 / 500 correct =&gt; accuracy: 0.284000
</code></pre><p>​</p><p>You should expect to see a slightly better performance than with <code>k = 1</code>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Now lets speed up distance matrix computation by using partial vectorization</span></div><div class="line"><span class="comment"># with one loop. Implement the function compute_distances_one_loop and run the</span></div><div class="line"><span class="comment"># code below:</span></div><div class="line">dists_one = classifier.compute_distances_one_loop(X_test)</div><div class="line"></div><div class="line"><span class="comment"># To ensure that our vectorized implementation is correct, we make sure that it</span></div><div class="line"><span class="comment"># agrees with the naive implementation. There are many ways to decide whether</span></div><div class="line"><span class="comment"># two matrices are similar; one of the simplest is the Frobenius norm. In case</span></div><div class="line"><span class="comment"># you haven't seen it before, the Frobenius norm of two matrices is the square</span></div><div class="line"><span class="comment"># root of the squared sum of differences of all elements; in other words, reshape</span></div><div class="line"><span class="comment"># the matrices into vectors and compute the Euclidean distance between them.</span></div><div class="line">difference = np.linalg.norm(dists - dists_one, ord=<span class="string">'fro'</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">'Difference was: %f'</span> % (difference, )</div><div class="line"><span class="keyword">if</span> difference &lt; <span class="number">0.001</span>:</div><div class="line">  <span class="keyword">print</span> <span class="string">'Good! The distance matrices are the same'</span></div><div class="line"><span class="keyword">else</span>:</div><div class="line">  <span class="keyword">print</span> <span class="string">'Uh-oh! The distance matrices are different'</span></div></pre></td></tr></table></figure><pre><code>Difference was: 0.000000
Good! The distance matrices are the same
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Now implement the fully vectorized version inside compute_distances_no_loops</span></div><div class="line"><span class="comment"># and run the code</span></div><div class="line">dists_two = classifier.compute_distances_no_loops(X_test)</div><div class="line"></div><div class="line"><span class="comment"># check that the distance matrix agrees with the one we computed before:</span></div><div class="line">difference = np.linalg.norm(dists - dists_two, ord=<span class="string">'fro'</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">'Difference was: %f'</span> % (difference, )</div><div class="line"><span class="keyword">if</span> difference &lt; <span class="number">0.001</span>:</div><div class="line">  <span class="keyword">print</span> <span class="string">'Good! The distance matrices are the same'</span></div><div class="line"><span class="keyword">else</span>:</div><div class="line">  <span class="keyword">print</span> <span class="string">'Uh-oh! The distance matrices are different'</span></div></pre></td></tr></table></figure><pre><code>Difference was: 0.000000
Good! The distance matrices are the same
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Let's compare how fast the implementations are</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">time_function</span><span class="params">(f, *args)</span>:</span></div><div class="line">  <span class="string">"""</span></div><div class="line">  Call a function f with args and return the time (in seconds) that it took to execute.</div><div class="line">  """</div><div class="line">  <span class="keyword">import</span> time</div><div class="line">  tic = time.time()</div><div class="line">  f(*args)</div><div class="line">  toc = time.time()</div><div class="line">  <span class="keyword">return</span> toc - tic</div><div class="line"></div><div class="line">two_loop_time = time_function(classifier.compute_distances_two_loops, X_test)</div><div class="line"><span class="keyword">print</span> <span class="string">'Two loop version took %f seconds'</span> % two_loop_time</div><div class="line"></div><div class="line">one_loop_time = time_function(classifier.compute_distances_one_loop, X_test)</div><div class="line"><span class="keyword">print</span> <span class="string">'One loop version took %f seconds'</span> % one_loop_time</div><div class="line"></div><div class="line">no_loop_time = time_function(classifier.compute_distances_no_loops, X_test)</div><div class="line"><span class="keyword">print</span> <span class="string">'No loop version took %f seconds'</span> % no_loop_time</div><div class="line"></div><div class="line"><span class="comment"># you should see significantly faster performance with the fully vectorized implementation</span></div></pre></td></tr></table></figure><pre><code>Two loop version took 27.001000 seconds
One loop version took 59.630000 seconds
No loop version took 0.205000 seconds
</code></pre><h3 id="Cross-validation"><a href="#Cross-validation" class="headerlink" title="Cross-validation"></a>Cross-validation</h3><p>We have implemented the k-Nearest Neighbor classifier but we set the value k = 5 arbitrarily. We will now determine the best value of this hyperparameter with cross-validation.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">num_folds = <span class="number">5</span></div><div class="line">k_choices = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">20</span>, <span class="number">50</span>, <span class="number">100</span>]</div><div class="line"></div><div class="line">X_train_folds = []</div><div class="line">y_train_folds = []</div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment"># <span class="doctag">TODO:</span>                                                                        #</span></div><div class="line"><span class="comment"># Split up the training data into folds. After splitting, X_train_folds and    #</span></div><div class="line"><span class="comment"># y_train_folds should each be lists of length num_folds, where                #</span></div><div class="line"><span class="comment"># y_train_folds[i] is the label vector for the points in X_train_folds[i].     #</span></div><div class="line"><span class="comment"># Hint: Look up the numpy array_split function.                                #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line">X_train_folds = np.array_split(X_train, num_folds)</div><div class="line">y_train_folds = np.array_split(y_train, num_folds)</div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment">#                                 END OF YOUR CODE                             #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"></div><div class="line"><span class="comment"># A dictionary holding the accuracies for different values of k that we find</span></div><div class="line"><span class="comment"># when running cross-validation. After running cross-validation,</span></div><div class="line"><span class="comment"># k_to_accuracies[k] should be a list of length num_folds giving the different</span></div><div class="line"><span class="comment"># accuracy values that we found when using that value of k.</span></div><div class="line">k_to_accuracies = &#123;&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment"># <span class="doctag">TODO:</span>                                                                        #</span></div><div class="line"><span class="comment"># Perform k-fold cross validation to find the best value of k. For each        #</span></div><div class="line"><span class="comment"># possible value of k, run the k-nearest-neighbor algorithm num_folds times,   #</span></div><div class="line"><span class="comment"># where in each case you use all but one of the folds as training data and the #</span></div><div class="line"><span class="comment"># last fold as a validation set. Store the accuracies for all fold and all     #</span></div><div class="line"><span class="comment"># values of k in the k_to_accuracies dictionary.                               #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="keyword">for</span> k <span class="keyword">in</span> k_choices:</div><div class="line">    k_to_accuracies[k] = []</div><div class="line">    <span class="keyword">for</span> fold <span class="keyword">in</span> xrange(num_folds):</div><div class="line">        train_X = np.append(</div><div class="line">            X_train_folds[:fold], X_train_folds[fold+<span class="number">1</span>:]).reshape(</div><div class="line">            (X_train.shape[<span class="number">0</span>] - X_train.shape[<span class="number">0</span>]/num_folds, <span class="number">-1</span>))</div><div class="line">        train_y = np.append(</div><div class="line">            y_train_folds[:fold], y_train_folds[fold+<span class="number">1</span>:]).reshape(</div><div class="line">            (y_train.shape[<span class="number">0</span>] - y_train.shape[<span class="number">0</span>]/num_folds, <span class="number">-1</span>)).flatten()</div><div class="line">        classifier.train(train_X, train_y)</div><div class="line">        dists = classifier.compute_distances_no_loops(X_train_folds[fold])</div><div class="line">        y_test_pred = classifier.predict_labels(dists, k)</div><div class="line">        </div><div class="line">        num_correct = np.sum(y_test_pred == y_train_folds[fold])</div><div class="line">        accuracy = float(num_correct) / len(y_train_folds[fold])</div><div class="line">        k_to_accuracies[k].append(accuracy)</div><div class="line">        </div><div class="line"><span class="comment">################################################################################</span></div><div class="line"><span class="comment">#                                 END OF YOUR CODE                             #</span></div><div class="line"><span class="comment">################################################################################</span></div><div class="line"></div><div class="line"><span class="comment"># Print out the computed accuracies</span></div><div class="line"><span class="keyword">for</span> k <span class="keyword">in</span> sorted(k_to_accuracies):</div><div class="line">    <span class="keyword">for</span> accuracy <span class="keyword">in</span> k_to_accuracies[k]:</div><div class="line">        <span class="keyword">print</span> <span class="string">'k = %d, accuracy = %f'</span> % (k, accuracy)</div></pre></td></tr></table></figure><pre><code>k = 1, accuracy = 0.263000
k = 1, accuracy = 0.257000
k = 1, accuracy = 0.264000
k = 1, accuracy = 0.278000
k = 1, accuracy = 0.266000
k = 3, accuracy = 0.241000
k = 3, accuracy = 0.249000
k = 3, accuracy = 0.243000
k = 3, accuracy = 0.273000
k = 3, accuracy = 0.264000
k = 5, accuracy = 0.258000
k = 5, accuracy = 0.273000
k = 5, accuracy = 0.281000
k = 5, accuracy = 0.290000
k = 5, accuracy = 0.272000
k = 8, accuracy = 0.263000
k = 8, accuracy = 0.288000
k = 8, accuracy = 0.278000
k = 8, accuracy = 0.285000
k = 8, accuracy = 0.277000
k = 10, accuracy = 0.265000
k = 10, accuracy = 0.296000
k = 10, accuracy = 0.278000
k = 10, accuracy = 0.284000
k = 10, accuracy = 0.286000
k = 12, accuracy = 0.260000
k = 12, accuracy = 0.294000
k = 12, accuracy = 0.281000
k = 12, accuracy = 0.282000
k = 12, accuracy = 0.281000
k = 15, accuracy = 0.255000
k = 15, accuracy = 0.290000
k = 15, accuracy = 0.281000
k = 15, accuracy = 0.281000
k = 15, accuracy = 0.276000
k = 20, accuracy = 0.270000
k = 20, accuracy = 0.281000
k = 20, accuracy = 0.280000
k = 20, accuracy = 0.282000
k = 20, accuracy = 0.284000
k = 50, accuracy = 0.271000
k = 50, accuracy = 0.288000
k = 50, accuracy = 0.278000
k = 50, accuracy = 0.269000
k = 50, accuracy = 0.266000
k = 100, accuracy = 0.256000
k = 100, accuracy = 0.270000
k = 100, accuracy = 0.263000
k = 100, accuracy = 0.256000
k = 100, accuracy = 0.263000
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># plot the raw observations</span></div><div class="line"><span class="keyword">for</span> k <span class="keyword">in</span> k_choices:</div><div class="line">  accuracies = k_to_accuracies[k]</div><div class="line">  plt.scatter([k] * len(accuracies), accuracies)</div><div class="line"></div><div class="line"><span class="comment"># plot the trend line with error bars that correspond to standard deviation</span></div><div class="line">accuracies_mean = np.array([np.mean(v) <span class="keyword">for</span> k,v <span class="keyword">in</span> sorted(k_to_accuracies.items())])</div><div class="line">accuracies_std = np.array([np.std(v) <span class="keyword">for</span> k,v <span class="keyword">in</span> sorted(k_to_accuracies.items())])</div><div class="line">plt.errorbar(k_choices, accuracies_mean, yerr=accuracies_std)</div><div class="line">plt.title(<span class="string">'Cross-validation on k'</span>)</div><div class="line">plt.xlabel(<span class="string">'k'</span>)</div><div class="line">plt.ylabel(<span class="string">'Cross-validation accuracy'</span>)</div><div class="line">plt.show()</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/cs231n/assignment/01/knn/cv.png" alt="cv"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Based on the cross-validation results above, choose the best value for k,   </span></div><div class="line"><span class="comment"># retrain the classifier using all the training data, and test it on the test</span></div><div class="line"><span class="comment"># data. You should be able to get above 28% accuracy on the test data.</span></div><div class="line">best_k = <span class="number">10</span></div><div class="line"></div><div class="line">classifier = KNearestNeighbor()</div><div class="line">classifier.train(X_train, y_train)</div><div class="line">y_test_pred = classifier.predict(X_test, k=best_k)</div><div class="line"></div><div class="line"><span class="comment"># Compute and display the accuracy</span></div><div class="line">num_correct = np.sum(y_test_pred == y_test)</div><div class="line">accuracy = float(num_correct) / num_test</div><div class="line"><span class="keyword">print</span> <span class="string">'Got %d / %d correct =&gt; accuracy: %f'</span> % (num_correct, num_test, accuracy)</div></pre></td></tr></table></figure><pre><code>Got 139 / 500 correct =&gt; accuracy: 0.278000
</code></pre><p>​</p><h1 id="k-nearest-neighbor-py"><a href="#k-nearest-neighbor-py" class="headerlink" title="k_nearest_neighbor.py"></a>k_nearest_neighbor.py</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> operator</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">KNearestNeighbor</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="string">""" a kNN classifier with L2 distance """</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self, X, y)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Train the classifier. For k-nearest neighbors this is just</div><div class="line">        memorizing the training data.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - X: A numpy array of shape (num_train, D) containing the training data</div><div class="line">          consisting of num_train samples each of dimension D.</div><div class="line">        - y: A numpy array of shape (N,) containing the training labels, where</div><div class="line">             y[i] is the label for X[i].</div><div class="line">        """</div><div class="line">        self.X_train = X</div><div class="line">        self.y_train = y</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict</span><span class="params">(self, X, k=<span class="number">1</span>, num_loops=<span class="number">0</span>)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Predict labels for test data using this classifier.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - X: A numpy array of shape (num_test, D) containing</div><div class="line">             test data consisting of num_test samples each of dimension D.</div><div class="line">        - k: The number of nearest neighbors that vote for</div><div class="line">             the predicted labels.</div><div class="line">        - num_loops: Determines which implementation to use</div><div class="line">                     to compute distances</div><div class="line">          between training points and testing points.</div><div class="line"></div><div class="line">        Returns:</div><div class="line">        - y: A numpy array of shape (num_test,)</div><div class="line">             containing predicted labels for the</div><div class="line">             test data, where y[i] is the predicted</div><div class="line">             label for the test point X[i].</div><div class="line">        """</div><div class="line">        <span class="keyword">if</span> num_loops == <span class="number">0</span>:</div><div class="line">            dists = self.compute_distances_no_loops(X)</div><div class="line">        <span class="keyword">elif</span> num_loops == <span class="number">1</span>:</div><div class="line">            dists = self.compute_distances_one_loop(X)</div><div class="line">        <span class="keyword">elif</span> num_loops == <span class="number">2</span>:</div><div class="line">            dists = self.compute_distances_two_loops(X)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'Invalid value %d for num_loops'</span> % num_loops)</div><div class="line"></div><div class="line">        <span class="keyword">return</span> self.predict_labels(dists, k=k)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compute_distances_two_loops</span><span class="params">(self, X)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Compute the distance between each test point in X and each training</div><div class="line">        point in self.X_train using a nested loop over both the training data</div><div class="line">        and the test data.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - X: A numpy array of shape (num_test, D) containing test data.</div><div class="line"></div><div class="line">        Returns:</div><div class="line">        - dists: A numpy array of shape (num_test, num_train) where dists[i, j]</div><div class="line">          is the Euclidean distance between the ith test point and the jth</div><div class="line">          training point.</div><div class="line">        """</div><div class="line">        num_test = X.shape[<span class="number">0</span>]</div><div class="line">        num_train = self.X_train.shape[<span class="number">0</span>]</div><div class="line">        dists = np.zeros((num_test, num_train))</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(num_test):</div><div class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> xrange(num_train):</div><div class="line">                <span class="comment">###############################################################</span></div><div class="line">                <span class="comment"># <span class="doctag">TODO:</span>                                                             #</span></div><div class="line">                <span class="comment"># Compute the l2 distance between the ith test point and the jth    #</span></div><div class="line">                <span class="comment"># training point, and store the result in dists[i, j]. You should   #</span></div><div class="line">                <span class="comment"># not use a loop over dimension.                                    #</span></div><div class="line">                <span class="comment">###############################################################</span></div><div class="line">                dists[i, j] = np.sqrt(np.sum((X[i, :] - self.X_train[j, :]) ** <span class="number">2</span>))</div><div class="line">            <span class="comment">###############################################################</span></div><div class="line">            <span class="comment">#                       END OF YOUR CODE                            #</span></div><div class="line">            <span class="comment">###############################################################</span></div><div class="line">        <span class="keyword">return</span> dists</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compute_distances_one_loop</span><span class="params">(self, X)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Compute the distance between each test point in X and each training point</div><div class="line">        in self.X_train using a single loop over the test data.</div><div class="line"></div><div class="line">        Input / Output: Same as compute_distances_two_loops</div><div class="line">        """</div><div class="line">        num_test = X.shape[<span class="number">0</span>]</div><div class="line">        num_train = self.X_train.shape[<span class="number">0</span>]</div><div class="line">        dists = np.zeros((num_test, num_train))</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(num_test):</div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            <span class="comment"># <span class="doctag">TODO:</span>                                                               #</span></div><div class="line">            <span class="comment"># Compute the l2 distance between the ith test point and all training #</span></div><div class="line">            <span class="comment"># points, and store the result in dists[i, :].                        #</span></div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            dists[i, :] = np.sqrt(np.sum(np.square(X[i, :] - self.X_train), axis=<span class="number">1</span>))</div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            <span class="comment">#                         END OF YOUR CODE                            #</span></div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">        <span class="keyword">return</span> dists</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compute_distances_no_loops</span><span class="params">(self, X)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Compute the distance between each test point in X and each training point</div><div class="line">        in self.X_train using no explicit loops.</div><div class="line"></div><div class="line">        Input / Output: Same as compute_distances_two_loops</div><div class="line">        """</div><div class="line">        num_test = X.shape[<span class="number">0</span>]</div><div class="line">        num_train = self.X_train.shape[<span class="number">0</span>]</div><div class="line">        dists = np.zeros((num_test, num_train))</div><div class="line">        <span class="comment">#######################################################################</span></div><div class="line">        <span class="comment"># <span class="doctag">TODO:</span>                                                                 #</span></div><div class="line">        <span class="comment"># Compute the l2 distance between all test points and all training      #</span></div><div class="line">        <span class="comment"># points without using any explicit loops, and store the result in      #</span></div><div class="line">        <span class="comment"># dists.                                                                #</span></div><div class="line">        <span class="comment">#                                                                       #</span></div><div class="line">        <span class="comment"># You should implement this function using only basic array operations; #</span></div><div class="line">        <span class="comment"># in particular you should not use functions from scipy.                #</span></div><div class="line">        <span class="comment">#                                                                       #</span></div><div class="line">        <span class="comment"># HINT: Try to formulate the l2 distance using matrix multiplication    #</span></div><div class="line">        <span class="comment">#       and two broadcast sums.                                         #</span></div><div class="line">        <span class="comment">#######################################################################</span></div><div class="line">        dists = np.sqrt(np.multiply(np.dot(X, self.X_train.T), <span class="number">-2</span>) +</div><div class="line">                        np.sum(self.X_train ** <span class="number">2</span>, axis=<span class="number">1</span>) +</div><div class="line">                        np.sum(X ** <span class="number">2</span>, axis=<span class="number">1</span>)[:, np.newaxis])</div><div class="line">        <span class="comment">#######################################################################</span></div><div class="line">        <span class="comment">#                         END OF YOUR CODE                              #</span></div><div class="line">        <span class="comment">#######################################################################</span></div><div class="line">        <span class="keyword">return</span> dists</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">predict_labels</span><span class="params">(self, dists, k=<span class="number">1</span>)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        Given a matrix of distances between test points and training points,</div><div class="line">        predict a label for each test point.</div><div class="line"></div><div class="line">        Inputs:</div><div class="line">        - dists: A numpy array of shape (num_test, num_train) where dists[i, j]</div><div class="line">          gives the distance betwen the ith test point and the jth training point.</div><div class="line"></div><div class="line">        Returns:</div><div class="line">        - y: A numpy array of shape (num_test,) containing predicted labels for the</div><div class="line">          test data, where y[i] is the predicted label for the test point X[i].</div><div class="line">        """</div><div class="line">        num_test = dists.shape[<span class="number">0</span>]</div><div class="line">        y_pred = np.zeros(num_test)</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(num_test):</div><div class="line">            <span class="comment"># A list of length k storing the labels of the k nearest neighbors to</span></div><div class="line">            <span class="comment"># the ith test point.</span></div><div class="line">            closest_y = []</div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            <span class="comment"># <span class="doctag">TODO:</span>                                                                 #</span></div><div class="line">            <span class="comment"># Use the distance matrix to find the k nearest neighbors of the ith    #</span></div><div class="line">            <span class="comment"># testing point, and use self.y_train to find the labels of these       #</span></div><div class="line">            <span class="comment"># neighbors. Store these labels in closest_y.                           #</span></div><div class="line">            <span class="comment"># Hint: Look up the function numpy.argsort.                             #</span></div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            k_nearest_index = np.argsort(dists[i, :])[:k]</div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            <span class="comment"># <span class="doctag">TODO:</span>                                                                 #</span></div><div class="line">            <span class="comment"># Now that you have found the labels of the k nearest neighbors, you    #</span></div><div class="line">            <span class="comment"># need to find the most common label in the list closest_y of labels.   #</span></div><div class="line">            <span class="comment"># Store this label in y_pred[i]. Break ties by choosing the smaller     #</span></div><div class="line">            <span class="comment"># label.                                                                #</span></div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            closest_y = self.y_train[k_nearest_index]</div><div class="line">            labels_counts = &#123;&#125;</div><div class="line">            <span class="keyword">for</span> label <span class="keyword">in</span> closest_y:</div><div class="line">                <span class="keyword">if</span> label <span class="keyword">in</span> labels_counts.keys():</div><div class="line">                    labels_counts[label] += <span class="number">1</span></div><div class="line">                <span class="keyword">else</span>:</div><div class="line">                    labels_counts[label] = <span class="number">0</span></div><div class="line">            sorted_labels_counts = sorted(</div><div class="line">                labels_counts.items(), key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="keyword">True</span>)</div><div class="line">            y_pred[i] = sorted_labels_counts[<span class="number">0</span>][<span class="number">0</span>]</div><div class="line">            <span class="comment">###################################################################</span></div><div class="line">            <span class="comment">#                           END OF YOUR CODE                            #</span></div><div class="line">            <span class="comment">###################################################################</span></div><div class="line"></div><div class="line">        <span class="keyword">return</span> y_pred</div></pre></td></tr></table></figure></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/28/Python-data-analysis-Learning-note-Ch06/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracadabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracadabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/2017/02/28/Python-data-analysis-Learning-note-Ch06/" itemprop="url">Python data analysis Learning note Ch06</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-28T21:15:17+08:00">2017-02-28 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/02/28/Python-data-analysis-Learning-note-Ch06/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2017/02/28/Python-data-analysis-Learning-note-Ch06/" itemprop="commentsCount"></span> </a></span><span id="/2017/02/28/Python-data-analysis-Learning-note-Ch06/" class="leancloud_visitors" data-flag-title="Python data analysis Learning note Ch06"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="Data-loading-storage-and-file-formats"><a href="#Data-loading-storage-and-file-formats" class="headerlink" title="Data loading, storage, and file formats"></a>Data loading, storage, and file formats</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">np.random.seed(<span class="number">12345</span>)</div><div class="line">plt.rc(<span class="string">'figure'</span>, figsize=(<span class="number">10</span>, <span class="number">6</span>))</div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">np.set_printoptions(precision=<span class="number">4</span>)</div><div class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</div><div class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">%pwd</div></pre></td></tr></table></figure><pre><code>&apos;C:\\Users\\Ewan\\Downloads\\pydata-book-master&apos;
</code></pre><h2 id="Reading-and-Writing-Data-in-Text-Format"><a href="#Reading-and-Writing-Data-in-Text-Format" class="headerlink" title="Reading and Writing Data in Text Format"></a>Reading and Writing Data in Text Format</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!more ch06\ex1.csv</div></pre></td></tr></table></figure><pre><code>a,b,c,d,message
1,2,3,4,hello
5,6,7,8,world
9,10,11,12,foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">df = pd.read_csv(<span class="string">'ch06/ex1.csv'</span>)</div><div class="line">df</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br><td>hello</td><br></tr><br><tr><br><th>1</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.read_table(<span class="string">'ch06/ex1.csv'</span>, sep=<span class="string">','</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br><td>hello</td><br></tr><br><tr><br><th>1</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!more ch06\ex2.csv</div></pre></td></tr></table></figure><pre><code>1,2,3,4,hello
5,6,7,8,world
9,10,11,12,foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pd.read_csv(<span class="string">'ch06/ex2.csv'</span>, header=<span class="keyword">None</span>)</div><div class="line">pd.read_csv(<span class="string">'ch06/ex2.csv'</span>, names=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'message'</span>])</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br><th>3</th><br><th>4</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br><td>hello</td><br></tr><br><tr><br><th>1</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br><td>hello</td><br></tr><br><tr><br><th>1</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">names = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'message'</span>]</div><div class="line">pd.read_csv(<span class="string">'ch06/ex2.csv'</span>, names=names, index_col=<span class="string">'message'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br></tr><br><tr><br><th>message</th><br><th></th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>hello</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br></tr><br><tr><br><th>world</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br></tr><br><tr><br><th>foo</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">!more ch06\csv_mindex.csv</div><div class="line">parsed = pd.read_csv(<span class="string">'ch06/csv_mindex.csv'</span>, index_col=[<span class="string">'key1'</span>, <span class="string">'key2'</span>])</div><div class="line">parsed</div></pre></td></tr></table></figure><pre><code>key1,key2,value1,value2
one,a,1,2
one,b,3,4
one,c,5,6
one,d,7,8
two,a,9,10
two,b,11,12
two,c,13,14
two,d,15,16
</code></pre><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th></th><br><th>value1</th><br><th>value2</th><br></tr><br><tr><br><th>key1</th><br><th>key2</th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="4" valign="top">one</th><br><th>a</th><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>b</th><br><td>3</td><br><td>4</td><br></tr><br><tr><br><th>c</th><br><td>5</td><br><td>6</td><br></tr><br><tr><br><th>d</th><br><td>7</td><br><td>8</td><br></tr><br><tr><br><th rowspan="4" valign="top">two</th><br><th>a</th><br><td>9</td><br><td>10</td><br></tr><br><tr><br><th>b</th><br><td>11</td><br><td>12</td><br></tr><br><tr><br><th>c</th><br><td>13</td><br><td>14</td><br></tr><br><tr><br><th>d</th><br><td>15</td><br><td>16</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">list(open(<span class="string">'ch06/ex3.txt'</span>))</div></pre></td></tr></table></figure><pre><code>[&apos;            A         B         C\n&apos;,
 &apos;aaa -0.264438 -1.026059 -0.619500\n&apos;,
 &apos;bbb  0.927272  0.302904 -0.032399\n&apos;,
 &apos;ccc -0.264273 -0.386314 -0.217601\n&apos;,
 &apos;ddd -0.871858 -0.348382  1.100491\n&apos;]
</code></pre><p>采用正则表达式作为分隔符</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = pd.read_table(<span class="string">'ch06/ex3.txt'</span>, sep=<span class="string">'\s+'</span>)</div><div class="line">result</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>A</th><br><th>B</th><br><th>C</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>aaa</th><br><td>-0.264438</td><br><td>-1.026059</td><br><td>-0.619500</td><br></tr><br><tr><br><th>bbb</th><br><td>0.927272</td><br><td>0.302904</td><br><td>-0.032399</td><br></tr><br><tr><br><th>ccc</th><br><td>-0.264273</td><br><td>-0.386314</td><br><td>-0.217601</td><br></tr><br><tr><br><th>ddd</th><br><td>-0.871858</td><br><td>-0.348382</td><br><td>1.100491</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">!more ch06\ex4.csv</div><div class="line">pd.read_csv(<span class="string">'ch06/ex4.csv'</span>, skiprows=[<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>])</div></pre></td></tr></table></figure><pre><code># hey!
a,b,c,d,message
# just wanted to make things more difficult for you
# who reads CSV files with computers, anyway?
1,2,3,4,hello
5,6,7,8,world
9,10,11,12,foo
</code></pre><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br><td>hello</td><br></tr><br><tr><br><th>1</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">!more ch06\ex5.csv</div><div class="line">result = pd.read_csv(<span class="string">'ch06/ex5.csv'</span>)</div><div class="line">result</div><div class="line">pd.isnull(result)</div></pre></td></tr></table></figure><pre><code>something,a,b,c,d,message
one,1,2,3,4,NA
two,5,6,,8,world
three,9,10,11,12,foo
</code></pre><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>something</th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>one</td><br><td>1</td><br><td>2</td><br><td>3.0</td><br><td>4</td><br><td>NaN</td><br></tr><br><tr><br><th>1</th><br><td>two</td><br><td>5</td><br><td>6</td><br><td>NaN</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>three</td><br><td>9</td><br><td>10</td><br><td>11.0</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>something</th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>False</td><br><td>False</td><br><td>False</td><br><td>False</td><br><td>False</td><br><td>True</td><br></tr><br><tr><br><th>1</th><br><td>False</td><br><td>False</td><br><td>False</td><br><td>True</td><br><td>False</td><br><td>False</td><br></tr><br><tr><br><th>2</th><br><td>False</td><br><td>False</td><br><td>False</td><br><td>False</td><br><td>False</td><br><td>False</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = pd.read_csv(<span class="string">'ch06/ex5.csv'</span>, na_values=[<span class="string">'NULL'</span>])</div><div class="line">result</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>something</th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>one</td><br><td>1</td><br><td>2</td><br><td>3.0</td><br><td>4</td><br><td>NaN</td><br></tr><br><tr><br><th>1</th><br><td>two</td><br><td>5</td><br><td>6</td><br><td>NaN</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>three</td><br><td>9</td><br><td>10</td><br><td>11.0</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sentinels = &#123;<span class="string">'message'</span>: [<span class="string">'foo'</span>, <span class="string">'NA'</span>], <span class="string">'something'</span>: [<span class="string">'two'</span>]&#125;</div><div class="line">pd.read_csv(<span class="string">'ch06/ex5.csv'</span>, na_values=sentinels)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>something</th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>one</td><br><td>1</td><br><td>2</td><br><td>3.0</td><br><td>4</td><br><td>NaN</td><br></tr><br><tr><br><th>1</th><br><td>NaN</td><br><td>5</td><br><td>6</td><br><td>NaN</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>three</td><br><td>9</td><br><td>10</td><br><td>11.0</td><br><td>12</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><h3 id="逐块读取文本文件"><a href="#逐块读取文本文件" class="headerlink" title="逐块读取文本文件"></a>逐块读取文本文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = pd.read_csv(<span class="string">'ch06/ex6.csv'</span>)</div><div class="line">result</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br><th>key</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.467976</td><br><td>-0.038649</td><br><td>-0.295344</td><br><td>-1.824726</td><br><td>L</td><br></tr><br><tr><br><th>1</th><br><td>-0.358893</td><br><td>1.404453</td><br><td>0.704965</td><br><td>-0.200638</td><br><td>B</td><br></tr><br><tr><br><th>2</th><br><td>-0.501840</td><br><td>0.659254</td><br><td>-0.421691</td><br><td>-0.057688</td><br><td>G</td><br></tr><br><tr><br><th>3</th><br><td>0.204886</td><br><td>1.074134</td><br><td>1.388361</td><br><td>-0.982404</td><br><td>R</td><br></tr><br><tr><br><th>4</th><br><td>0.354628</td><br><td>-0.133116</td><br><td>0.283763</td><br><td>-0.837063</td><br><td>Q</td><br></tr><br><tr><br><th>5</th><br><td>1.817480</td><br><td>0.742273</td><br><td>0.419395</td><br><td>-2.251035</td><br><td>Q</td><br></tr><br><tr><br><th>6</th><br><td>-0.776764</td><br><td>0.935518</td><br><td>-0.332872</td><br><td>-1.875641</td><br><td>U</td><br></tr><br><tr><br><th>7</th><br><td>-0.913135</td><br><td>1.530624</td><br><td>-0.572657</td><br><td>0.477252</td><br><td>K</td><br></tr><br><tr><br><th>8</th><br><td>0.358480</td><br><td>-0.497572</td><br><td>-0.367016</td><br><td>0.507702</td><br><td>S</td><br></tr><br><tr><br><th>9</th><br><td>-1.740877</td><br><td>-1.160417</td><br><td>-1.637830</td><br><td>2.172201</td><br><td>G</td><br></tr><br><tr><br><th>10</th><br><td>0.240564</td><br><td>-0.328249</td><br><td>1.252155</td><br><td>1.072796</td><br><td>8</td><br></tr><br><tr><br><th>11</th><br><td>0.764018</td><br><td>1.165476</td><br><td>-0.639544</td><br><td>1.495258</td><br><td>R</td><br></tr><br><tr><br><th>12</th><br><td>0.571035</td><br><td>-0.310537</td><br><td>0.582437</td><br><td>-0.298765</td><br><td>1</td><br></tr><br><tr><br><th>13</th><br><td>2.317658</td><br><td>0.430710</td><br><td>-1.334216</td><br><td>0.199679</td><br><td>P</td><br></tr><br><tr><br><th>14</th><br><td>1.547771</td><br><td>-1.119753</td><br><td>-2.277634</td><br><td>0.329586</td><br><td>J</td><br></tr><br><tr><br><th>15</th><br><td>-1.310608</td><br><td>0.401719</td><br><td>-1.000987</td><br><td>1.156708</td><br><td>E</td><br></tr><br><tr><br><th>16</th><br><td>-0.088496</td><br><td>0.634712</td><br><td>0.153324</td><br><td>0.415335</td><br><td>B</td><br></tr><br><tr><br><th>17</th><br><td>-0.018663</td><br><td>-0.247487</td><br><td>-1.446522</td><br><td>0.750938</td><br><td>A</td><br></tr><br><tr><br><th>18</th><br><td>-0.070127</td><br><td>-1.579097</td><br><td>0.120892</td><br><td>0.671432</td><br><td>F</td><br></tr><br><tr><br><th>19</th><br><td>-0.194678</td><br><td>-0.492039</td><br><td>2.359605</td><br><td>0.319810</td><br><td>H</td><br></tr><br><tr><br><th>20</th><br><td>-0.248618</td><br><td>0.868707</td><br><td>-0.492226</td><br><td>-0.717959</td><br><td>W</td><br></tr><br><tr><br><th>21</th><br><td>-1.091549</td><br><td>-0.867110</td><br><td>-0.647760</td><br><td>-0.832562</td><br><td>C</td><br></tr><br><tr><br><th>22</th><br><td>0.641404</td><br><td>-0.138822</td><br><td>-0.621963</td><br><td>-0.284839</td><br><td>C</td><br></tr><br><tr><br><th>23</th><br><td>1.216408</td><br><td>0.992687</td><br><td>0.165162</td><br><td>-0.069619</td><br><td>V</td><br></tr><br><tr><br><th>24</th><br><td>-0.564474</td><br><td>0.792832</td><br><td>0.747053</td><br><td>0.571675</td><br><td>I</td><br></tr><br><tr><br><th>25</th><br><td>1.759879</td><br><td>-0.515666</td><br><td>-0.230481</td><br><td>1.362317</td><br><td>S</td><br></tr><br><tr><br><th>26</th><br><td>0.126266</td><br><td>0.309281</td><br><td>0.382820</td><br><td>-0.239199</td><br><td>L</td><br></tr><br><tr><br><th>27</th><br><td>1.334360</td><br><td>-0.100152</td><br><td>-0.840731</td><br><td>-0.643967</td><br><td>6</td><br></tr><br><tr><br><th>28</th><br><td>-0.737620</td><br><td>0.278087</td><br><td>-0.053235</td><br><td>-0.950972</td><br><td>J</td><br></tr><br><tr><br><th>29</th><br><td>-1.148486</td><br><td>-0.986292</td><br><td>-0.144963</td><br><td>0.124362</td><br><td>Y</td><br></tr><br><tr><br><th>…</th><br><td>…</td><br><td>…</td><br><td>…</td><br><td>…</td><br><td>…</td><br></tr><br><tr><br><th>9970</th><br><td>0.633495</td><br><td>-0.186524</td><br><td>0.927627</td><br><td>0.143164</td><br><td>4</td><br></tr><br><tr><br><th>9971</th><br><td>0.308636</td><br><td>-0.112857</td><br><td>0.762842</td><br><td>-1.072977</td><br><td>1</td><br></tr><br><tr><br><th>9972</th><br><td>-1.627051</td><br><td>-0.978151</td><br><td>0.154745</td><br><td>-1.229037</td><br><td>Z</td><br></tr><br><tr><br><th>9973</th><br><td>0.314847</td><br><td>0.097989</td><br><td>0.199608</td><br><td>0.955193</td><br><td>P</td><br></tr><br><tr><br><th>9974</th><br><td>1.666907</td><br><td>0.992005</td><br><td>0.496128</td><br><td>-0.686391</td><br><td>S</td><br></tr><br><tr><br><th>9975</th><br><td>0.010603</td><br><td>0.708540</td><br><td>-1.258711</td><br><td>0.226541</td><br><td>K</td><br></tr><br><tr><br><th>9976</th><br><td>0.118693</td><br><td>-0.714455</td><br><td>-0.501342</td><br><td>-0.254764</td><br><td>K</td><br></tr><br><tr><br><th>9977</th><br><td>0.302616</td><br><td>-2.011527</td><br><td>-0.628085</td><br><td>0.768827</td><br><td>H</td><br></tr><br><tr><br><th>9978</th><br><td>-0.098572</td><br><td>1.769086</td><br><td>-0.215027</td><br><td>-0.053076</td><br><td>A</td><br></tr><br><tr><br><th>9979</th><br><td>-0.019058</td><br><td>1.964994</td><br><td>0.738538</td><br><td>-0.883776</td><br><td>F</td><br></tr><br><tr><br><th>9980</th><br><td>-0.595349</td><br><td>0.001781</td><br><td>-1.423355</td><br><td>-1.458477</td><br><td>M</td><br></tr><br><tr><br><th>9981</th><br><td>1.392170</td><br><td>-1.396560</td><br><td>-1.425306</td><br><td>-0.847535</td><br><td>H</td><br></tr><br><tr><br><th>9982</th><br><td>-0.896029</td><br><td>-0.152287</td><br><td>1.924483</td><br><td>0.365184</td><br><td>6</td><br></tr><br><tr><br><th>9983</th><br><td>-2.274642</td><br><td>-0.901874</td><br><td>1.500352</td><br><td>0.996541</td><br><td>N</td><br></tr><br><tr><br><th>9984</th><br><td>-0.301898</td><br><td>1.019906</td><br><td>1.102160</td><br><td>2.624526</td><br><td>I</td><br></tr><br><tr><br><th>9985</th><br><td>-2.548389</td><br><td>-0.585374</td><br><td>1.496201</td><br><td>-0.718815</td><br><td>D</td><br></tr><br><tr><br><th>9986</th><br><td>-0.064588</td><br><td>0.759292</td><br><td>-1.568415</td><br><td>-0.420933</td><br><td>E</td><br></tr><br><tr><br><th>9987</th><br><td>-0.143365</td><br><td>-1.111760</td><br><td>-1.815581</td><br><td>0.435274</td><br><td>2</td><br></tr><br><tr><br><th>9988</th><br><td>-0.070412</td><br><td>-1.055921</td><br><td>0.338017</td><br><td>-0.440763</td><br><td>X</td><br></tr><br><tr><br><th>9989</th><br><td>0.649148</td><br><td>0.994273</td><br><td>-1.384227</td><br><td>0.485120</td><br><td>Q</td><br></tr><br><tr><br><th>9990</th><br><td>-0.370769</td><br><td>0.404356</td><br><td>-1.051628</td><br><td>-1.050899</td><br><td>8</td><br></tr><br><tr><br><th>9991</th><br><td>-0.409980</td><br><td>0.155627</td><br><td>-0.818990</td><br><td>1.277350</td><br><td>W</td><br></tr><br><tr><br><th>9992</th><br><td>0.301214</td><br><td>-1.111203</td><br><td>0.668258</td><br><td>0.671922</td><br><td>A</td><br></tr><br><tr><br><th>9993</th><br><td>1.821117</td><br><td>0.416445</td><br><td>0.173874</td><br><td>0.505118</td><br><td>X</td><br></tr><br><tr><br><th>9994</th><br><td>0.068804</td><br><td>1.322759</td><br><td>0.802346</td><br><td>0.223618</td><br><td>H</td><br></tr><br><tr><br><th>9995</th><br><td>2.311896</td><br><td>-0.417070</td><br><td>-1.409599</td><br><td>-0.515821</td><br><td>L</td><br></tr><br><tr><br><th>9996</th><br><td>-0.479893</td><br><td>-0.650419</td><br><td>0.745152</td><br><td>-0.646038</td><br><td>E</td><br></tr><br><tr><br><th>9997</th><br><td>0.523331</td><br><td>0.787112</td><br><td>0.486066</td><br><td>1.093156</td><br><td>K</td><br></tr><br><tr><br><th>9998</th><br><td>-0.362559</td><br><td>0.598894</td><br><td>-1.843201</td><br><td>0.887292</td><br><td>G</td><br></tr><br><tr><br><th>9999</th><br><td>-0.096376</td><br><td>-1.012999</td><br><td>-0.657431</td><br><td>-0.573315</td><br><td>0</td><br></tr><br><br></tbody><br></table><br><p>10000 rows × 5 columns</p><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.read_csv(<span class="string">'ch06/ex6.csv'</span>, nrows=<span class="number">5</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br><th>key</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.467976</td><br><td>-0.038649</td><br><td>-0.295344</td><br><td>-1.824726</td><br><td>L</td><br></tr><br><tr><br><th>1</th><br><td>-0.358893</td><br><td>1.404453</td><br><td>0.704965</td><br><td>-0.200638</td><br><td>B</td><br></tr><br><tr><br><th>2</th><br><td>-0.501840</td><br><td>0.659254</td><br><td>-0.421691</td><br><td>-0.057688</td><br><td>G</td><br></tr><br><tr><br><th>3</th><br><td>0.204886</td><br><td>1.074134</td><br><td>1.388361</td><br><td>-0.982404</td><br><td>R</td><br></tr><br><tr><br><th>4</th><br><td>0.354628</td><br><td>-0.133116</td><br><td>0.283763</td><br><td>-0.837063</td><br><td>Q</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chunker = pd.read_csv(<span class="string">'ch06/ex6.csv'</span>, chunksize=<span class="number">1000</span>)</div><div class="line">chunker</div></pre></td></tr></table></figure><pre><code>&lt;pandas.io.parsers.TextFileReader at 0x2035229de80&gt;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">chunker = pd.read_csv(<span class="string">'ch06/ex6.csv'</span>, chunksize=<span class="number">1000</span>)</div><div class="line"></div><div class="line">tot = Series([])</div><div class="line"><span class="keyword">for</span> piece <span class="keyword">in</span> chunker:</div><div class="line">    tot = tot.add(piece[<span class="string">'key'</span>].value_counts(), fill_value=<span class="number">0</span>)</div><div class="line"></div><div class="line">tot = tot.sort_values(ascending=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tot[:<span class="number">10</span>]</div></pre></td></tr></table></figure><pre><code>E    368.0
X    364.0
L    346.0
O    343.0
Q    340.0
M    338.0
J    337.0
F    335.0
K    334.0
H    330.0
dtype: float64
</code></pre><h3 id="将数据写出到文本格式"><a href="#将数据写出到文本格式" class="headerlink" title="将数据写出到文本格式"></a>将数据写出到文本格式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data = pd.read_csv(<span class="string">'ch06/ex5.csv'</span>)</div><div class="line">data</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>something</th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>one</td><br><td>1</td><br><td>2</td><br><td>3.0</td><br><td>4</td><br><td>NaN</td><br></tr><br><tr><br><th>1</th><br><td>two</td><br><td>5</td><br><td>6</td><br><td>NaN</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>three</td><br><td>9</td><br><td>10</td><br><td>11.0</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data.to_csv(<span class="string">'ch06/out.csv'</span>)</div><div class="line">!more ch06\out.csv</div></pre></td></tr></table></figure><pre><code>,something,a,b,c,d,message
0,one,1,2,3.0,4,
1,two,5,6,,8,world
2,three,9,10,11.0,12,foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.to_csv(sys.stdout, sep=<span class="string">'|'</span>)</div></pre></td></tr></table></figure><pre><code>|something|a|b|c|d|message
0|one|1|2|3.0|4|
1|two|5|6||8|world
2|three|9|10|11.0|12|foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.to_csv(sys.stdout, na_rep=<span class="string">'NULL'</span>)</div></pre></td></tr></table></figure><pre><code>,something,a,b,c,d,message
0,one,1,2,3.0,4,NULL
1,two,5,6,NULL,8,world
2,three,9,10,11.0,12,foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.to_csv(sys.stdout, index=<span class="keyword">False</span>, header=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><pre><code>one,1,2,3.0,4,
two,5,6,,8,world
three,9,10,11.0,12,foo
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.to_csv(sys.stdout, index=<span class="keyword">False</span>, columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div></pre></td></tr></table></figure><pre><code>a,b,c
1,2,3.0
5,6,
9,10,11.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">dates = pd.date_range(<span class="string">'1/1/2000'</span>, periods=<span class="number">7</span>)</div><div class="line">dates</div><div class="line">ts = Series(np.arange(<span class="number">7</span>), index=dates)</div><div class="line">ts</div><div class="line">ts.to_csv(<span class="string">'ch06/tseries.csv'</span>)</div><div class="line">!more ch06\tseries.csv</div></pre></td></tr></table></figure><pre><code>DatetimeIndex([&apos;2000-01-01&apos;, &apos;2000-01-02&apos;, &apos;2000-01-03&apos;, &apos;2000-01-04&apos;,
               &apos;2000-01-05&apos;, &apos;2000-01-06&apos;, &apos;2000-01-07&apos;],
              dtype=&apos;datetime64[ns]&apos;, freq=&apos;D&apos;)






2000-01-01    0
2000-01-02    1
2000-01-03    2
2000-01-04    3
2000-01-05    4
2000-01-06    5
2000-01-07    6
Freq: D, dtype: int32



2000-01-01,0
2000-01-02,1
2000-01-03,2
2000-01-04,3
2000-01-05,4
2000-01-06,5
2000-01-07,6
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Series.from_csv(<span class="string">'ch06/tseries.csv'</span>, parse_dates=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><pre><code>2000-01-01    0
2000-01-02    1
2000-01-03    2
2000-01-04    3
2000-01-05    4
2000-01-06    5
2000-01-07    6
dtype: int64
</code></pre><h3 id="手动处理分隔符格式"><a href="#手动处理分隔符格式" class="headerlink" title="手动处理分隔符格式"></a>手动处理分隔符格式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!more ch06\ex7.csv</div></pre></td></tr></table></figure><pre><code>&quot;a&quot;,&quot;b&quot;,&quot;c&quot;
&quot;1&quot;,&quot;2&quot;,&quot;3&quot;
&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> csv</div><div class="line">f = open(<span class="string">'ch06/ex7.csv'</span>)</div><div class="line"></div><div class="line">reader = csv.reader(f)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> line <span class="keyword">in</span> reader:</div><div class="line">    print(line)</div></pre></td></tr></table></figure><pre><code>[&apos;a&apos;, &apos;b&apos;, &apos;c&apos;]
[&apos;1&apos;, &apos;2&apos;, &apos;3&apos;]
[&apos;1&apos;, &apos;2&apos;, &apos;3&apos;, &apos;4&apos;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">lines = list(csv.reader(open(<span class="string">'ch06/ex7.csv'</span>)))</div><div class="line">header, values = lines[<span class="number">0</span>], lines[<span class="number">1</span>:]</div><div class="line"><span class="keyword">for</span> item <span class="keyword">in</span> zip(*values):</div><div class="line">    print(item)</div><div class="line">    </div><div class="line"><span class="keyword">for</span> h, v <span class="keyword">in</span> zip(header, zip(*values)):</div><div class="line">    print(h, v)</div><div class="line"></div><div class="line">data_dict = &#123;h: v <span class="keyword">for</span> h, v <span class="keyword">in</span> zip(header, zip(*values))&#125;</div><div class="line">data_dict</div></pre></td></tr></table></figure><pre><code>(&apos;1&apos;, &apos;1&apos;)
(&apos;2&apos;, &apos;2&apos;)
(&apos;3&apos;, &apos;3&apos;)
a (&apos;1&apos;, &apos;1&apos;)
b (&apos;2&apos;, &apos;2&apos;)
c (&apos;3&apos;, &apos;3&apos;)





{&apos;a&apos;: (&apos;1&apos;, &apos;1&apos;), &apos;b&apos;: (&apos;2&apos;, &apos;2&apos;), &apos;c&apos;: (&apos;3&apos;, &apos;3&apos;)}
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">my_dialect</span><span class="params">(csv.Dialect)</span>:</span></div><div class="line">    lineterminator = <span class="string">'\n'</span></div><div class="line">    delimiter = <span class="string">';'</span></div><div class="line">    quotechar = <span class="string">'"'</span></div><div class="line">    quoting = csv.QUOTE_MINIMAL</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> open(<span class="string">'mydata.csv'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</div><div class="line">    writer = csv.writer(f, dialect=my_dialect)</div><div class="line">    writer.writerow((<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>))</div><div class="line">    writer.writerow((<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>))</div><div class="line">    writer.writerow((<span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>))</div><div class="line">    writer.writerow((<span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>))</div></pre></td></tr></table></figure><pre><code>14






6






6






6
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!more mydata.csv</div></pre></td></tr></table></figure><pre><code>one;two;three
1;2;3
4;5;6
7;8;9
</code></pre><h3 id="JSON数据"><a href="#JSON数据" class="headerlink" title="JSON数据"></a>JSON数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">obj = <span class="string">"""</span></div><div class="line">&#123;"name": "Wes",</div><div class="line"> "places_lived": ["United States", "Spain", "Germany"],</div><div class="line"> "pet": null,</div><div class="line"> "siblings": [&#123;"name": "Scott", "age": 25, "pet": "Zuko"&#125;,</div><div class="line">              &#123;"name": "Katie", "age": 33, "pet": "Cisco"&#125;]</div><div class="line">&#125;</div><div class="line">"""</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> json</div><div class="line">result = json.loads(obj)</div><div class="line">result</div></pre></td></tr></table></figure><pre><code>{&apos;name&apos;: &apos;Wes&apos;,
 &apos;pet&apos;: None,
 &apos;places_lived&apos;: [&apos;United States&apos;, &apos;Spain&apos;, &apos;Germany&apos;],
 &apos;siblings&apos;: [{&apos;age&apos;: 25, &apos;name&apos;: &apos;Scott&apos;, &apos;pet&apos;: &apos;Zuko&apos;},
  {&apos;age&apos;: 33, &apos;name&apos;: &apos;Katie&apos;, &apos;pet&apos;: &apos;Cisco&apos;}]}
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">asjson = json.dumps(result) <span class="comment"># convert to json</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">siblings = DataFrame(result[<span class="string">'siblings'</span>], columns=[<span class="string">'name'</span>, <span class="string">'age'</span>])</div><div class="line">siblings</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>name</th><br><th>age</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>Scott</td><br><td>25</td><br></tr><br><tr><br><th>1</th><br><td>Katie</td><br><td>33</td><br></tr><br><br></tbody><br></table><br></div><h3 id="XML和HTML：-Web信息收集"><a href="#XML和HTML：-Web信息收集" class="headerlink" title="XML和HTML： Web信息收集"></a>XML和HTML： Web信息收集</h3><p><strong>NB. The Yahoo! Finance API has changed and this example no longer works</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> lxml.html <span class="keyword">import</span> parse</div><div class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</div><div class="line"></div><div class="line">parsed = parse(urlopen(<span class="string">'http://finance.yahoo.com/q/op?s=AAPL+Options'</span>))</div><div class="line"></div><div class="line">doc = parsed.getroot()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">links = doc.findall(<span class="string">'.//a'</span>)</div><div class="line">links[<span class="number">15</span>:<span class="number">20</span>]</div></pre></td></tr></table></figure><pre><code>[&lt;Element a at 0x20352cad598&gt;,
 &lt;Element a at 0x20352cad5e8&gt;,
 &lt;Element a at 0x20352cad638&gt;,
 &lt;Element a at 0x20352cad688&gt;,
 &lt;Element a at 0x20352cad6d8&gt;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">lnk = links[<span class="number">28</span>]</div><div class="line">lnk</div><div class="line">lnk.get(<span class="string">'href'</span>)</div><div class="line">lnk.text_content()</div></pre></td></tr></table></figure><pre><code>&lt;Element a at 0x20352cad9a8&gt;






&apos;/quote/NFLX?p=NFLX&apos;






&apos;NFLX&apos;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">urls = [lnk.get(<span class="string">'href'</span>) <span class="keyword">for</span> lnk <span class="keyword">in</span> doc.findall(<span class="string">'.//a'</span>)]</div><div class="line">urls[<span class="number">-10</span>:]</div></pre></td></tr></table></figure><pre><code>[&apos;//finance.yahoo.com/broker-comparison?bypass=true&apos;,
 &apos;https://help.yahoo.com/kb/index?page=content&amp;y=PROD_MAIL_ML&amp;locale=en_US&amp;id=SLN2310&amp;actp=productlink&apos;,
 &apos;http://help.yahoo.com/l/us/yahoo/finance/&apos;,
 &apos;https://yahoo.uservoice.com/forums/382977&apos;,
 &apos;http://info.yahoo.com/privacy/us/yahoo/&apos;,
 &apos;http://info.yahoo.com/relevantads/&apos;,
 &apos;http://info.yahoo.com/legal/us/yahoo/utos/utos-173.html&apos;,
 &apos;http://twitter.com/YahooFinance&apos;,
 &apos;http://facebook.com/yahoofinance&apos;,
 &apos;http://yahoofinance.tumblr.com&apos;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">tables = doc.findall(<span class="string">'.//table'</span>)</div><div class="line">len(tables)</div><div class="line">calls = tables[<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>1
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rows = calls.findall(<span class="string">'.//tr'</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">_unpack</span><span class="params">(row, kind=<span class="string">'td'</span>)</span>:</span></div><div class="line">    elts = row.findall(<span class="string">'.//%s'</span> % kind)</div><div class="line">    <span class="keyword">return</span> [val.text_content() <span class="keyword">for</span> val <span class="keyword">in</span> elts]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_unpack(rows[<span class="number">0</span>], kind=<span class="string">'th'</span>)</div><div class="line">_unpack(rows[<span class="number">1</span>], kind=<span class="string">'td'</span>)</div></pre></td></tr></table></figure><pre><code>[]




---------------------------------------------------------------------------

IndexError                                Traceback (most recent call last)

&lt;ipython-input-87-7d371ed47023&gt; in &lt;module&gt;()
      1 _unpack(rows[0], kind=&apos;th&apos;)
----&gt; 2 _unpack(rows[1], kind=&apos;td&apos;)


IndexError: list index out of range
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pandas.io.parsers <span class="keyword">import</span> TextParser</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_options_data</span><span class="params">(table)</span>:</span></div><div class="line">    rows = table.findall(<span class="string">'.//tr'</span>)</div><div class="line">    header = _unpack(rows[<span class="number">0</span>], kind=<span class="string">'th'</span>)</div><div class="line">    data = [_unpack(r) <span class="keyword">for</span> r <span class="keyword">in</span> rows[<span class="number">1</span>:]]</div><div class="line">    <span class="keyword">return</span> TextParser(data, names=header).get_chunk()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">call_data = parse_options_data(calls)</div><div class="line">put_data = parse_options_data(puts)</div><div class="line">call_data[:<span class="number">10</span>]</div></pre></td></tr></table></figure><h4 id="Parsing-XML-with-lxml-objectify"><a href="#Parsing-XML-with-lxml-objectify" class="headerlink" title="Parsing XML with lxml.objectify"></a>Parsing XML with lxml.objectify</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> objectify</div><div class="line"></div><div class="line">path = <span class="string">'.\ch06\mta_perf\Performance_MNR.xml'</span></div><div class="line">parsed = objectify.parse(open(path))</div><div class="line">root = parsed.getroot()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">data = []</div><div class="line"></div><div class="line">skip_fields = [<span class="string">'PARENT_SEQ'</span>, <span class="string">'INDICATOR_SEQ'</span>,</div><div class="line">               <span class="string">'DESIRED_CHANGE'</span>, <span class="string">'DECIMAL_PLACES'</span>]</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">for</span> elt <span class="keyword">in</span> root.INDICATOR:</div><div class="line">    el_data = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> child <span class="keyword">in</span> elt.getchildren():</div><div class="line">        <span class="keyword">if</span> child.tag <span class="keyword">in</span> skip_fields:</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        el_data[child.tag] = child.pyval</div><div class="line">    data.append(el_data)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">perf = DataFrame(data)</div><div class="line">perf.ix[:<span class="number">10</span>, <span class="number">5</span>:]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>INDICATOR_UNIT</th><br><th>MONTHLY_ACTUAL</th><br><th>MONTHLY_TARGET</th><br><th>PERIOD_MONTH</th><br><th>PERIOD_YEAR</th><br><th>YTD_ACTUAL</th><br><th>YTD_TARGET</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>%</td><br><td>96.9</td><br><td>95</td><br><td>1</td><br><td>2008</td><br><td>96.9</td><br><td>95</td><br></tr><br><tr><br><th>1</th><br><td>%</td><br><td>95</td><br><td>95</td><br><td>2</td><br><td>2008</td><br><td>96</td><br><td>95</td><br></tr><br><tr><br><th>2</th><br><td>%</td><br><td>96.9</td><br><td>95</td><br><td>3</td><br><td>2008</td><br><td>96.3</td><br><td>95</td><br></tr><br><tr><br><th>3</th><br><td>%</td><br><td>98.3</td><br><td>95</td><br><td>4</td><br><td>2008</td><br><td>96.8</td><br><td>95</td><br></tr><br><tr><br><th>4</th><br><td>%</td><br><td>95.8</td><br><td>95</td><br><td>5</td><br><td>2008</td><br><td>96.6</td><br><td>95</td><br></tr><br><tr><br><th>5</th><br><td>%</td><br><td>94.4</td><br><td>95</td><br><td>6</td><br><td>2008</td><br><td>96.2</td><br><td>95</td><br></tr><br><tr><br><th>6</th><br><td>%</td><br><td>96</td><br><td>95</td><br><td>7</td><br><td>2008</td><br><td>96.2</td><br><td>95</td><br></tr><br><tr><br><th>7</th><br><td>%</td><br><td>96.4</td><br><td>95</td><br><td>8</td><br><td>2008</td><br><td>96.2</td><br><td>95</td><br></tr><br><tr><br><th>8</th><br><td>%</td><br><td>93.7</td><br><td>95</td><br><td>9</td><br><td>2008</td><br><td>95.9</td><br><td>95</td><br></tr><br><tr><br><th>9</th><br><td>%</td><br><td>96.4</td><br><td>95</td><br><td>10</td><br><td>2008</td><br><td>96</td><br><td>95</td><br></tr><br><tr><br><th>10</th><br><td>%</td><br><td>96.9</td><br><td>95</td><br><td>11</td><br><td>2008</td><br><td>96.1</td><br><td>95</td><br></tr><br><br></tbody><br></table><br></div><h2 id="二进制数据格式"><a href="#二进制数据格式" class="headerlink" title="二进制数据格式"></a>二进制数据格式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame = pd.read_csv(<span class="string">'ch06/ex1.csv'</span>)</div><div class="line">frame</div><div class="line">frame.to_pickle(<span class="string">'ch06/frame_pickle'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br><td>hello</td><br></tr><br><tr><br><th>1</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.read_pickle(<span class="string">'ch06/frame_pickle'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br><td>hello</td><br></tr><br><tr><br><th>1</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><h3 id="使用HDF5格式"><a href="#使用HDF5格式" class="headerlink" title="使用HDF5格式"></a>使用HDF5格式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">store = pd.HDFStore(<span class="string">'mydata.h5'</span>)</div><div class="line">store[<span class="string">'obj1'</span>] = frame</div><div class="line">store[<span class="string">'obj1_col'</span>] = frame[<span class="string">'a'</span>]</div><div class="line">store</div></pre></td></tr></table></figure><pre><code>&lt;class &apos;pandas.io.pytables.HDFStore&apos;&gt;
File path: mydata.h5
/obj1                frame        (shape-&gt;[3,5])
/obj1_col            series       (shape-&gt;[3])  
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">store[<span class="string">'obj1'</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>message</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>4</td><br><td>hello</td><br></tr><br><tr><br><th>1</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>8</td><br><td>world</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br><td>12</td><br><td>foo</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">store.close()</div><div class="line">os.remove(<span class="string">'mydata.h5'</span>)</div></pre></td></tr></table></figure><h2 id="使用数据库"><a href="#使用数据库" class="headerlink" title="使用数据库"></a>使用数据库</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sqlite3</div><div class="line"></div><div class="line">query = <span class="string">"""</span></div><div class="line">CREATE TABLE test</div><div class="line">(a VARCHAR(20), b VARCHAR(20),</div><div class="line"> c REAL,        d INTEGER</div><div class="line">);"""</div><div class="line"></div><div class="line">con = sqlite3.connect(<span class="string">':memory:'</span>)</div><div class="line">con.execute(query)</div><div class="line">con.commit()</div></pre></td></tr></table></figure><pre><code>&lt;sqlite3.Cursor at 0x2035487c880&gt;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">data = [(<span class="string">'Atlanta'</span>, <span class="string">'Georgia'</span>, <span class="number">1.25</span>, <span class="number">6</span>),</div><div class="line">        (<span class="string">'Tallahassee'</span>, <span class="string">'Florida'</span>, <span class="number">2.6</span>, <span class="number">3</span>),</div><div class="line">        (<span class="string">'Sacramento'</span>, <span class="string">'California'</span>, <span class="number">1.7</span>, <span class="number">5</span>)]</div><div class="line">stmt = <span class="string">"INSERT INTO test VALUES(?, ?, ?, ?)"</span></div><div class="line"></div><div class="line">con.executemany(stmt, data)</div><div class="line">con.commit()</div></pre></td></tr></table></figure><pre><code>&lt;sqlite3.Cursor at 0x2035487c810&gt;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cursor = con.execute(<span class="string">'select * from test'</span>)</div><div class="line">rows = cursor.fetchall()</div><div class="line">rows</div></pre></td></tr></table></figure><pre><code>[(&apos;Atlanta&apos;, &apos;Georgia&apos;, 1.25, 6),
 (&apos;Tallahassee&apos;, &apos;Florida&apos;, 2.6, 3),
 (&apos;Sacramento&apos;, &apos;California&apos;, 1.7, 5)]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas.io.sql <span class="keyword">as</span> sql</div><div class="line">sql.read_sql(<span class="string">'select * from test'</span>, con)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>Atlanta</td><br><td>Georgia</td><br><td>1.25</td><br><td>6</td><br></tr><br><tr><br><th>1</th><br><td>Tallahassee</td><br><td>Florida</td><br><td>2.60</td><br><td>3</td><br></tr><br><tr><br><th>2</th><br><td>Sacramento</td><br><td>California</td><br><td>1.70</td><br><td>5</td><br></tr><br><br></tbody><br></table><br></div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/28/Python-data-analysis-Learning-note-ch05/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracadabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracadabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/2017/02/28/Python-data-analysis-Learning-note-ch05/" itemprop="url">Python data analysis Learning note ch05</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-28T18:05:03+08:00">2017-02-28 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/02/28/Python-data-analysis-Learning-note-ch05/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2017/02/28/Python-data-analysis-Learning-note-ch05/" itemprop="commentsCount"></span> </a></span><span id="/2017/02/28/Python-data-analysis-Learning-note-ch05/" class="leancloud_visitors" data-flag-title="Python data analysis Learning note ch05"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="pandas入门"><a href="#pandas入门" class="headerlink" title="pandas入门"></a>pandas入门</h1><p>按照以下约定引用相关package</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">np.random.seed(<span class="number">12345</span>)</div><div class="line">plt.rc(<span class="string">'figure'</span>, figsize=(<span class="number">10</span>, <span class="number">6</span>))</div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">np.set_printoptions(precision=<span class="number">4</span>)</div><div class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</div><div class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></div></pre></td></tr></table></figure><h2 id="pandas数据结构介绍"><a href="#pandas数据结构介绍" class="headerlink" title="pandas数据结构介绍"></a>pandas数据结构介绍</h2><h3 id="Series"><a href="#Series" class="headerlink" title="Series"></a>Series</h3><p>Series是一种类似于一维数组的对象，由一组数据以及一组与之相关的数据标签（类似于字典的键）组成，所以可以看成是一个<strong>有序</strong>的字典</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">4</span>, <span class="number">7</span>, <span class="number">-5</span>, <span class="number">3</span>])</div><div class="line">obj</div></pre></td></tr></table></figure><pre><code>0    4
1    7
2   -5
3    3
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj.values</div><div class="line">obj.index</div></pre></td></tr></table></figure><pre><code>array([ 4,  7, -5,  3], dtype=int64)






RangeIndex(start=0, stop=4, step=1)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj2 = Series([<span class="number">4</span>, <span class="number">7</span>, <span class="number">-5</span>, <span class="number">3</span>], index=[<span class="string">'d'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>])</div><div class="line">obj2</div></pre></td></tr></table></figure><pre><code>d    4
b    7
a   -5
c    3
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj2.index</div></pre></td></tr></table></figure><pre><code>Index([&apos;d&apos;, &apos;b&apos;, &apos;a&apos;, &apos;c&apos;], dtype=&apos;object&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj2[<span class="string">'a'</span>]</div></pre></td></tr></table></figure><pre><code>-5
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj2[<span class="string">'d'</span>] = <span class="number">6</span></div><div class="line">obj2[[<span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]]</div></pre></td></tr></table></figure><pre><code>c    3
a   -5
d    6
dtype: int64
</code></pre><p>各种Numpy运算都是作用在数据上，同时索引与数据的链接会一直保持</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj2[obj2 &gt; <span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>d    6
b    7
c    3
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj2 * <span class="number">2</span></div></pre></td></tr></table></figure><pre><code>d    12
b    14
a   -10
c     6
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.exp(obj2)</div></pre></td></tr></table></figure><pre><code>d     403.428793
b    1096.633158
a       0.006738
c      20.085537
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">'b'</span> <span class="keyword">in</span> obj2</div></pre></td></tr></table></figure><pre><code>True
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">'e'</span> <span class="keyword">in</span> obj2</div></pre></td></tr></table></figure><pre><code>False
</code></pre><p>因此可以直接根据Numpy的Dict来创建Series</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sdata = &#123;<span class="string">'Ohio'</span>: <span class="number">35000</span>, <span class="string">'Texas'</span>: <span class="number">71000</span>, <span class="string">'Oregon'</span>: <span class="number">16000</span>, <span class="string">'Utah'</span>: <span class="number">5000</span>&#125;</div><div class="line">obj3 = Series(sdata)</div><div class="line">obj3</div></pre></td></tr></table></figure><pre><code>Ohio      35000
Oregon    16000
Texas     71000
Utah       5000
dtype: int64
</code></pre><p>如果传入了index参数的话，那么就会与传入的Dict做键匹配，没有匹配上的就设为NaN</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">states = [<span class="string">'California'</span>, <span class="string">'Ohio'</span>, <span class="string">'Oregon'</span>, <span class="string">'Texas'</span>]</div><div class="line">obj4 = Series(sdata, index=states)</div><div class="line">obj4</div></pre></td></tr></table></figure><pre><code>California        NaN
Ohio          35000.0
Oregon        16000.0
Texas         71000.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.isnull(obj4)</div></pre></td></tr></table></figure><pre><code>California     True
Ohio          False
Oregon        False
Texas         False
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.notnull(obj4)</div></pre></td></tr></table></figure><pre><code>California    False
Ohio           True
Oregon         True
Texas          True
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj4.isnull()</div></pre></td></tr></table></figure><pre><code>California     True
Ohio          False
Oregon        False
Texas         False
dtype: bool
</code></pre><p>Series有一个非常重要的数据对齐的功能</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj3</div></pre></td></tr></table></figure><pre><code>Ohio      35000
Oregon    16000
Texas     71000
Utah       5000
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj4</div></pre></td></tr></table></figure><pre><code>California        NaN
Ohio          35000.0
Oregon        16000.0
Texas         71000.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj3 + obj4</div></pre></td></tr></table></figure><pre><code>California         NaN
Ohio           70000.0
Oregon         32000.0
Texas         142000.0
Utah               NaN
dtype: float64
</code></pre><p>Series本身以及其索引都有一个叫做name的属性，这个属性十分重要，以后很多高级功能都会用到</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">obj4.name = <span class="string">'population'</span></div><div class="line">obj4.index.name = <span class="string">'state'</span></div><div class="line">obj4</div></pre></td></tr></table></figure><pre><code>state
California        NaN
Ohio          35000.0
Oregon        16000.0
Texas         71000.0
Name: population, dtype: float64
</code></pre><p>可以通过直接赋值的方式修改index属性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj.index = [<span class="string">'Bob'</span>, <span class="string">'Steve'</span>, <span class="string">'Jeff'</span>, <span class="string">'Ryan'</span>]</div><div class="line">obj</div></pre></td></tr></table></figure><pre><code>Bob      4
Steve    7
Jeff    -5
Ryan     3
dtype: int64
</code></pre><h3 id="DataFrame"><a href="#DataFrame" class="headerlink" title="DataFrame"></a>DataFrame</h3><p>DataFrame是一个表格型的数据结构，可以看成由Series组成的字典，只不过这些Series共用一套索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = &#123;<span class="string">'state'</span>: [<span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Nevada'</span>, <span class="string">'Nevada'</span>],</div><div class="line">        <span class="string">'year'</span>: [<span class="number">2000</span>, <span class="number">2001</span>, <span class="number">2002</span>, <span class="number">2001</span>, <span class="number">2002</span>],</div><div class="line">        <span class="string">'pop'</span>: [<span class="number">1.5</span>, <span class="number">1.7</span>, <span class="number">3.6</span>, <span class="number">2.4</span>, <span class="number">2.9</span>]&#125;</div><div class="line">frame = DataFrame(data)</div></pre></td></tr></table></figure><p>数据会被排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>pop</th><br><th>state</th><br><th>year</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1.5</td><br><td>Ohio</td><br><td>2000</td><br></tr><br><tr><br><th>1</th><br><td>1.7</td><br><td>Ohio</td><br><td>2001</td><br></tr><br><tr><br><th>2</th><br><td>3.6</td><br><td>Ohio</td><br><td>2002</td><br></tr><br><tr><br><th>3</th><br><td>2.4</td><br><td>Nevada</td><br><td>2001</td><br></tr><br><tr><br><th>4</th><br><td>2.9</td><br><td>Nevada</td><br><td>2002</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">DataFrame(data, columns=[<span class="string">'year'</span>, <span class="string">'state'</span>, <span class="string">'pop'</span>])</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>year</th><br><th>state</th><br><th>pop</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>2000</td><br><td>Ohio</td><br><td>1.5</td><br></tr><br><tr><br><th>1</th><br><td>2001</td><br><td>Ohio</td><br><td>1.7</td><br></tr><br><tr><br><th>2</th><br><td>2002</td><br><td>Ohio</td><br><td>3.6</td><br></tr><br><tr><br><th>3</th><br><td>2001</td><br><td>Nevada</td><br><td>2.4</td><br></tr><br><tr><br><th>4</th><br><td>2002</td><br><td>Nevada</td><br><td>2.9</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame2 = DataFrame(data, columns=[<span class="string">'year'</span>, <span class="string">'state'</span>, <span class="string">'pop'</span>, <span class="string">'debt'</span>],</div><div class="line">                   index=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>, <span class="string">'five'</span>])</div><div class="line">frame2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>year</th><br><th>state</th><br><th>pop</th><br><th>debt</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>one</th><br><td>2000</td><br><td>Ohio</td><br><td>1.5</td><br><td>NaN</td><br></tr><br><tr><br><th>two</th><br><td>2001</td><br><td>Ohio</td><br><td>1.7</td><br><td>NaN</td><br></tr><br><tr><br><th>three</th><br><td>2002</td><br><td>Ohio</td><br><td>3.6</td><br><td>NaN</td><br></tr><br><tr><br><th>four</th><br><td>2001</td><br><td>Nevada</td><br><td>2.4</td><br><td>NaN</td><br></tr><br><tr><br><th>five</th><br><td>2002</td><br><td>Nevada</td><br><td>2.9</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2.columns</div></pre></td></tr></table></figure><pre><code>Index([&apos;year&apos;, &apos;state&apos;, &apos;pop&apos;, &apos;debt&apos;], dtype=&apos;object&apos;)
</code></pre><p>DataFrame每一个Key对应的Value都是一个Series</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2[<span class="string">'state'</span>]</div></pre></td></tr></table></figure><pre><code>one        Ohio
two        Ohio
three      Ohio
four     Nevada
five     Nevada
Name: state, dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2.year</div></pre></td></tr></table></figure><pre><code>one      2000
two      2001
three    2002
four     2001
five     2002
Name: year, dtype: int64
</code></pre><p>注意到name属性也已经被设置好了</p><p>ix相当于一个行索引？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2.ix[<span class="string">'three'</span>]</div></pre></td></tr></table></figure><pre><code>year     2002
state    Ohio
pop       3.6
debt      NaN
Name: three, dtype: object
</code></pre><p>可以利用Numpy的广播功能</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame2[<span class="string">'debt'</span>] = <span class="number">16.5</span></div><div class="line">frame2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>year</th><br><th>state</th><br><th>pop</th><br><th>debt</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>one</th><br><td>2000</td><br><td>Ohio</td><br><td>1.5</td><br><td>16.5</td><br></tr><br><tr><br><th>two</th><br><td>2001</td><br><td>Ohio</td><br><td>1.7</td><br><td>16.5</td><br></tr><br><tr><br><th>three</th><br><td>2002</td><br><td>Ohio</td><br><td>3.6</td><br><td>16.5</td><br></tr><br><tr><br><th>four</th><br><td>2001</td><br><td>Nevada</td><br><td>2.4</td><br><td>16.5</td><br></tr><br><tr><br><th>five</th><br><td>2002</td><br><td>Nevada</td><br><td>2.9</td><br><td>16.5</td><br></tr><br><br></tbody><br></table><br></div><p>也可以赋值一个列表，但是长度必须匹配</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame2[<span class="string">'debt'</span>] = np.arange(<span class="number">5.</span>)</div><div class="line">frame2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>year</th><br><th>state</th><br><th>pop</th><br><th>debt</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>one</th><br><td>2000</td><br><td>Ohio</td><br><td>1.5</td><br><td>0.0</td><br></tr><br><tr><br><th>two</th><br><td>2001</td><br><td>Ohio</td><br><td>1.7</td><br><td>1.0</td><br></tr><br><tr><br><th>three</th><br><td>2002</td><br><td>Ohio</td><br><td>3.6</td><br><td>2.0</td><br></tr><br><tr><br><th>four</th><br><td>2001</td><br><td>Nevada</td><br><td>2.4</td><br><td>3.0</td><br></tr><br><tr><br><th>five</th><br><td>2002</td><br><td>Nevada</td><br><td>2.9</td><br><td>4.0</td><br></tr><br><br></tbody><br></table><br></div><p>如果是赋值一个Series，则会匹配上索引，没有匹配上的就是置为NaN</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">val = Series([<span class="number">-1.2</span>, <span class="number">-1.5</span>, <span class="number">-1.7</span>], index=[<span class="string">'two'</span>, <span class="string">'four'</span>, <span class="string">'five'</span>])</div><div class="line">frame2[<span class="string">'debt'</span>] = val</div><div class="line">frame2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>year</th><br><th>state</th><br><th>pop</th><br><th>debt</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>one</th><br><td>2000</td><br><td>Ohio</td><br><td>1.5</td><br><td>NaN</td><br></tr><br><tr><br><th>two</th><br><td>2001</td><br><td>Ohio</td><br><td>1.7</td><br><td>-1.2</td><br></tr><br><tr><br><th>three</th><br><td>2002</td><br><td>Ohio</td><br><td>3.6</td><br><td>NaN</td><br></tr><br><tr><br><th>four</th><br><td>2001</td><br><td>Nevada</td><br><td>2.4</td><br><td>-1.5</td><br></tr><br><tr><br><th>five</th><br><td>2002</td><br><td>Nevada</td><br><td>2.9</td><br><td>-1.7</td><br></tr><br><br></tbody><br></table><br></div><p>也可以进行逻辑操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame2[<span class="string">'eastern'</span>] = frame2.state == <span class="string">'Ohio'</span></div><div class="line">frame2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>year</th><br><th>state</th><br><th>pop</th><br><th>debt</th><br><th>eastern</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>one</th><br><td>2000</td><br><td>Ohio</td><br><td>1.5</td><br><td>NaN</td><br><td>True</td><br></tr><br><tr><br><th>two</th><br><td>2001</td><br><td>Ohio</td><br><td>1.7</td><br><td>-1.2</td><br><td>True</td><br></tr><br><tr><br><th>three</th><br><td>2002</td><br><td>Ohio</td><br><td>3.6</td><br><td>NaN</td><br><td>True</td><br></tr><br><tr><br><th>four</th><br><td>2001</td><br><td>Nevada</td><br><td>2.4</td><br><td>-1.5</td><br><td>False</td><br></tr><br><tr><br><th>five</th><br><td>2002</td><br><td>Nevada</td><br><td>2.9</td><br><td>-1.7</td><br><td>False</td><br></tr><br><br></tbody><br></table><br></div><p>del用于删除一列</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">del</span> frame2[<span class="string">'eastern'</span>]</div><div class="line">frame2.columns</div></pre></td></tr></table></figure><pre><code>Index([&apos;year&apos;, &apos;state&apos;, &apos;pop&apos;, &apos;debt&apos;], dtype=&apos;object&apos;)
</code></pre><p><strong>只要是通过索引方式进行的操作，都是直接在原数据上进行的操作，不是一个副本</strong></p><p>嵌套的字典也可直接生成DataFrame，只不过内层的键被当作index，外层的键被当作colums</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pop = &#123;<span class="string">'Nevada'</span>: &#123;<span class="number">2001</span>: <span class="number">2.4</span>, <span class="number">2002</span>: <span class="number">2.9</span>&#125;,</div><div class="line">       <span class="string">'Ohio'</span>: &#123;<span class="number">2000</span>: <span class="number">1.5</span>, <span class="number">2001</span>: <span class="number">1.7</span>, <span class="number">2002</span>: <span class="number">3.6</span>&#125;&#125;</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame3 = DataFrame(pop)</div><div class="line">frame3</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Nevada</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000</th><br><td>NaN</td><br><td>1.5</td><br></tr><br><tr><br><th>2001</th><br><td>2.4</td><br><td>1.7</td><br></tr><br><tr><br><th>2002</th><br><td>2.9</td><br><td>3.6</td><br></tr><br><br></tbody><br></table><br></div><p>同样可以进行转置，这样的话index和column就会互换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame3.T</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>2000</th><br><th>2001</th><br><th>2002</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Nevada</th><br><td>NaN</td><br><td>2.4</td><br><td>2.9</td><br></tr><br><tr><br><th>Ohio</th><br><td>1.5</td><br><td>1.7</td><br><td>3.6</td><br></tr><br><br></tbody><br></table><br></div><p>显式地指定索引，不匹配的会置为NaN</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">DataFrame(pop, index=[<span class="number">2001</span>, <span class="number">2002</span>, <span class="number">2003</span>])</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Nevada</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2001</th><br><td>2.4</td><br><td>1.7</td><br></tr><br><tr><br><th>2002</th><br><td>2.9</td><br><td>3.6</td><br></tr><br><tr><br><th>2003</th><br><td>NaN</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame3</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Nevada</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000</th><br><td>NaN</td><br><td>1.5</td><br></tr><br><tr><br><th>2001</th><br><td>2.4</td><br><td>1.7</td><br></tr><br><tr><br><th>2002</th><br><td>2.9</td><br><td>3.6</td><br></tr><br><br></tbody><br></table><br></div><p>还可以这样构建</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pdata = &#123;<span class="string">'Ohio'</span>: frame3[<span class="string">'Ohio'</span>][:<span class="number">-1</span>],</div><div class="line">         <span class="string">'Nevada'</span>: frame3[<span class="string">'Nevada'</span>][:<span class="number">2</span>]&#125;</div><div class="line">DataFrame(pdata)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Nevada</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000</th><br><td>NaN</td><br><td>1.5</td><br></tr><br><tr><br><th>2001</th><br><td>2.4</td><br><td>1.7</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame3</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Nevada</th><br><th>Ohio</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000</th><br><td>NaN</td><br><td>1.5</td><br></tr><br><tr><br><th>2001</th><br><td>2.4</td><br><td>1.7</td><br></tr><br><tr><br><th>2002</th><br><td>2.9</td><br><td>3.6</td><br></tr><br><br></tbody><br></table><br></div><p>name属性也会在表格中显示出来</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame3.index.name = <span class="string">'year'</span>; frame3.columns.name = <span class="string">'state'</span></div><div class="line">frame3</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th>state</th><br><th>Nevada</th><br><th>Ohio</th><br></tr><br><tr><br><th>year</th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000</th><br><td>NaN</td><br><td>1.5</td><br></tr><br><tr><br><th>2001</th><br><td>2.4</td><br><td>1.7</td><br></tr><br><tr><br><th>2002</th><br><td>2.9</td><br><td>3.6</td><br></tr><br><br></tbody><br></table><br></div><p>values方法只返回数据，不返回index以及key</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame3.values</div></pre></td></tr></table></figure><pre><code>array([[ nan,  1.5],
       [ 2.4,  1.7],
       [ 2.9,  3.6]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>year</th><br><th>state</th><br><th>pop</th><br><th>debt</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>one</th><br><td>2000</td><br><td>Ohio</td><br><td>1.5</td><br><td>NaN</td><br></tr><br><tr><br><th>two</th><br><td>2001</td><br><td>Ohio</td><br><td>1.7</td><br><td>-1.2</td><br></tr><br><tr><br><th>three</th><br><td>2002</td><br><td>Ohio</td><br><td>3.6</td><br><td>NaN</td><br></tr><br><tr><br><th>four</th><br><td>2001</td><br><td>Nevada</td><br><td>2.4</td><br><td>-1.5</td><br></tr><br><tr><br><th>five</th><br><td>2002</td><br><td>Nevada</td><br><td>2.9</td><br><td>-1.7</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2.values</div></pre></td></tr></table></figure><pre><code>array([[2000, &apos;Ohio&apos;, 1.5, nan],
       [2001, &apos;Ohio&apos;, 1.7, -1.2],
       [2002, &apos;Ohio&apos;, 3.6, nan],
       [2001, &apos;Nevada&apos;, 2.4, -1.5],
       [2002, &apos;Nevada&apos;, 2.9, -1.7]], dtype=object)
</code></pre><h3 id="索引对象"><a href="#索引对象" class="headerlink" title="索引对象"></a>索引对象</h3><p>Index是一个可以单独提取出来的对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">obj = Series(range(<span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">index = obj.index</div><div class="line">index</div></pre></td></tr></table></figure><pre><code>Index([&apos;a&apos;, &apos;b&apos;, &apos;c&apos;], dtype=&apos;object&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">index[<span class="number">1</span>:]</div></pre></td></tr></table></figure><pre><code>Index([&apos;b&apos;, &apos;c&apos;], dtype=&apos;object&apos;)
</code></pre><p>不可修改~！</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">index[<span class="number">1</span>] = <span class="string">'d'</span></div></pre></td></tr></table></figure><pre><code>---------------------------------------------------------------------------

TypeError                                 Traceback (most recent call last)

&lt;ipython-input-52-676fdeb26a68&gt; in &lt;module&gt;()
----&gt; 1 index[1] = &apos;d&apos;


C:\Users\Ewan\Anaconda3\lib\site-packages\pandas\indexes\base.py in __setitem__(self, key, value)
   1243 
   1244     def __setitem__(self, key, value):
-&gt; 1245         raise TypeError(&quot;Index does not support mutable operations&quot;)
   1246 
   1247     def __getitem__(self, key):


TypeError: Index does not support mutable operations
</code></pre><p>直接创建Index对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">index = pd.Index(np.arange(<span class="number">3</span>))</div><div class="line">obj2 = Series([<span class="number">1.5</span>, <span class="number">-2.5</span>, <span class="number">0</span>], index=index)</div><div class="line">obj2.index <span class="keyword">is</span> index</div></pre></td></tr></table></figure><pre><code>True
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame3</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th>state</th><br><th>Nevada</th><br><th>Ohio</th><br></tr><br><tr><br><th>year</th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2000</th><br><td>NaN</td><br><td>1.5</td><br></tr><br><tr><br><th>2001</th><br><td>2.4</td><br><td>1.7</td><br></tr><br><tr><br><th>2002</th><br><td>2.9</td><br><td>3.6</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">'Ohio'</span> <span class="keyword">in</span> frame3.columns</div></pre></td></tr></table></figure><pre><code>True
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="number">2003</span> <span class="keyword">in</span> frame3.index</div></pre></td></tr></table></figure><pre><code>False
</code></pre><h2 id="基本功能"><a href="#基本功能" class="headerlink" title="基本功能"></a>基本功能</h2><h3 id="重新索引"><a href="#重新索引" class="headerlink" title="重新索引"></a>重新索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">4.5</span>, <span class="number">7.2</span>, <span class="number">-5.3</span>, <span class="number">3.6</span>], index=[<span class="string">'d'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>])</div><div class="line">obj</div></pre></td></tr></table></figure><pre><code>d    4.5
b    7.2
a   -5.3
c    3.6
dtype: float64
</code></pre><p>重排索引形成新对象</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj2 = obj.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">obj2</div></pre></td></tr></table></figure><pre><code>a   -5.3
b    7.2
c    3.6
d    4.5
e    NaN
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>], fill_value=<span class="number">0</span>)</div></pre></td></tr></table></figure><pre><code>a   -5.3
b    7.2
c    3.6
d    4.5
e    0.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj3 = Series([<span class="string">'blue'</span>, <span class="string">'purple'</span>, <span class="string">'yellow'</span>], index=[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>])</div><div class="line">obj3.reindex(range(<span class="number">6</span>), method=<span class="string">'ffill'</span>) <span class="comment"># 前向填充</span></div></pre></td></tr></table></figure><pre><code>0      blue
1      blue
2    purple
3    purple
4    yellow
5    yellow
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">9</span>).reshape((<span class="number">3</span>, <span class="number">3</span>)), index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>],</div><div class="line">                  columns=[<span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'California'</span>])</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Ohio</th><br><th>Texas</th><br><th>California</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>0</td><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>c</th><br><td>3</td><br><td>4</td><br><td>5</td><br></tr><br><tr><br><th>d</th><br><td>6</td><br><td>7</td><br><td>8</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame2 = frame.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">frame2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Ohio</th><br><th>Texas</th><br><th>California</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>0.0</td><br><td>1.0</td><br><td>2.0</td><br></tr><br><tr><br><th>b</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>c</th><br><td>3.0</td><br><td>4.0</td><br><td>5.0</td><br></tr><br><tr><br><th>d</th><br><td>6.0</td><br><td>7.0</td><br><td>8.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">states = [<span class="string">'Texas'</span>, <span class="string">'Utah'</span>, <span class="string">'California'</span>]</div><div class="line">frame.reindex(columns=states)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Texas</th><br><th>Utah</th><br><th>California</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>1</td><br><td>NaN</td><br><td>2</td><br></tr><br><tr><br><th>c</th><br><td>4</td><br><td>NaN</td><br><td>5</td><br></tr><br><tr><br><th>d</th><br><td>7</td><br><td>NaN</td><br><td>8</td><br></tr><br><br></tbody><br></table><br></div><p>插值只能按行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame.reindex(index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], method=<span class="string">'ffill'</span>,</div><div class="line">              columns=states)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Texas</th><br><th>Utah</th><br><th>California</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>1</td><br><td>NaN</td><br><td>2</td><br></tr><br><tr><br><th>b</th><br><td>1</td><br><td>NaN</td><br><td>2</td><br></tr><br><tr><br><th>c</th><br><td>4</td><br><td>NaN</td><br><td>5</td><br></tr><br><tr><br><th>d</th><br><td>7</td><br><td>NaN</td><br><td>8</td><br></tr><br><br></tbody><br></table><br></div><p>用ix方法进行重新索引操作会使得代码很简洁</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.ix[[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], states]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Texas</th><br><th>Utah</th><br><th>California</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>1.0</td><br><td>NaN</td><br><td>2.0</td><br></tr><br><tr><br><th>b</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>c</th><br><td>4.0</td><br><td>NaN</td><br><td>5.0</td><br></tr><br><tr><br><th>d</th><br><td>7.0</td><br><td>NaN</td><br><td>8.0</td><br></tr><br><br></tbody><br></table><br></div><h3 id="丢弃指定轴上的项"><a href="#丢弃指定轴上的项" class="headerlink" title="丢弃指定轴上的项"></a>丢弃指定轴上的项</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.ix[[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], states]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Texas</th><br><th>Utah</th><br><th>California</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>1.0</td><br><td>NaN</td><br><td>2.0</td><br></tr><br><tr><br><th>b</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>c</th><br><td>4.0</td><br><td>NaN</td><br><td>5.0</td><br></tr><br><tr><br><th>d</th><br><td>7.0</td><br><td>NaN</td><br><td>8.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">obj = Series(np.arange(<span class="number">5.</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">new_obj = obj.drop(<span class="string">'c'</span>)</div><div class="line">new_obj</div></pre></td></tr></table></figure><pre><code>a    0.0
b    1.0
d    3.0
e    4.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.drop([<span class="string">'d'</span>, <span class="string">'c'</span>])</div></pre></td></tr></table></figure><pre><code>a    0.0
b    1.0
e    4.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(np.arange(<span class="number">16</span>).reshape((<span class="number">4</span>, <span class="number">4</span>)),</div><div class="line">                 index=[<span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>, <span class="string">'Utah'</span>, <span class="string">'New York'</span>],</div><div class="line">                 columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>])</div><div class="line">data</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>0</td><br><td>1</td><br><td>2</td><br><td>3</td><br></tr><br><tr><br><th>Colorado</th><br><td>4</td><br><td>5</td><br><td>6</td><br><td>7</td><br></tr><br><tr><br><th>Utah</th><br><td>8</td><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><tr><br><th>New York</th><br><td>12</td><br><td>13</td><br><td>14</td><br><td>15</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.drop([<span class="string">'Colorado'</span>, <span class="string">'Ohio'</span>])</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>8</td><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><tr><br><th>New York</th><br><td>12</td><br><td>13</td><br><td>14</td><br><td>15</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.drop(<span class="string">'two'</span>, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>three</th><br><th>four</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>0</td><br><td>2</td><br><td>3</td><br></tr><br><tr><br><th>Colorado</th><br><td>4</td><br><td>6</td><br><td>7</td><br></tr><br><tr><br><th>Utah</th><br><td>8</td><br><td>10</td><br><td>11</td><br></tr><br><tr><br><th>New York</th><br><td>12</td><br><td>14</td><br><td>15</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.drop([<span class="string">'two'</span>, <span class="string">'four'</span>], axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>three</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>0</td><br><td>2</td><br></tr><br><tr><br><th>Colorado</th><br><td>4</td><br><td>6</td><br></tr><br><tr><br><th>Utah</th><br><td>8</td><br><td>10</td><br></tr><br><tr><br><th>New York</th><br><td>12</td><br><td>14</td><br></tr><br><br></tbody><br></table><br></div><h3 id="索引，选取和过滤"><a href="#索引，选取和过滤" class="headerlink" title="索引，选取和过滤"></a>索引，选取和过滤</h3><p>多种索引方式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">obj = Series(np.arange(<span class="number">4.</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">obj</div><div class="line">obj[<span class="string">'b'</span>]</div></pre></td></tr></table></figure><pre><code>a    0.0
b    1.0
c    2.0
d    3.0
dtype: float64






1.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[<span class="number">1</span>]</div></pre></td></tr></table></figure><pre><code>1.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[<span class="number">2</span>:<span class="number">4</span>]</div></pre></td></tr></table></figure><pre><code>c    2.0
d    3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[[<span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]]</div></pre></td></tr></table></figure><pre><code>b    1.0
a    0.0
d    3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[[<span class="number">1</span>, <span class="number">3</span>]]</div></pre></td></tr></table></figure><pre><code>b    1.0
d    3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[obj &lt; <span class="number">2</span>] <span class="comment"># 直接对data进行操作</span></div></pre></td></tr></table></figure><pre><code>a    0.0
b    1.0
dtype: float64
</code></pre><p>这种切片方式…<br>末端包含</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[<span class="string">'b'</span>:<span class="string">'c'</span>]</div></pre></td></tr></table></figure><pre><code>b    1.0
c    2.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj[<span class="string">'b'</span>:<span class="string">'c'</span>] = <span class="number">5</span></div><div class="line">obj</div></pre></td></tr></table></figure><pre><code>a    0.0
b    5.0
c    5.0
d    3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(np.arange(<span class="number">16</span>).reshape((<span class="number">4</span>, <span class="number">4</span>)),</div><div class="line">                 index=[<span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>, <span class="string">'Utah'</span>, <span class="string">'New York'</span>],</div><div class="line">                 columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>])</div><div class="line">data</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>0</td><br><td>1</td><br><td>2</td><br><td>3</td><br></tr><br><tr><br><th>Colorado</th><br><td>4</td><br><td>5</td><br><td>6</td><br><td>7</td><br></tr><br><tr><br><th>Utah</th><br><td>8</td><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><tr><br><th>New York</th><br><td>12</td><br><td>13</td><br><td>14</td><br><td>15</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'two'</span>]</div></pre></td></tr></table></figure><pre><code>Ohio         1
Colorado     5
Utah         9
New York    13
Name: two, dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[[<span class="string">'three'</span>, <span class="string">'one'</span>]]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>three</th><br><th>one</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>2</td><br><td>0</td><br></tr><br><tr><br><th>Colorado</th><br><td>6</td><br><td>4</td><br></tr><br><tr><br><th>Utah</th><br><td>10</td><br><td>8</td><br></tr><br><tr><br><th>New York</th><br><td>14</td><br><td>12</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[:<span class="number">2</span>] <span class="comment"># axis=0</span></div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>0</td><br><td>1</td><br><td>2</td><br><td>3</td><br></tr><br><tr><br><th>Colorado</th><br><td>4</td><br><td>5</td><br><td>6</td><br><td>7</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[data[<span class="string">'three'</span>] &gt; <span class="number">5</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Colorado</th><br><td>4</td><br><td>5</td><br><td>6</td><br><td>7</td><br></tr><br><tr><br><th>Utah</th><br><td>8</td><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><tr><br><th>New York</th><br><td>12</td><br><td>13</td><br><td>14</td><br><td>15</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data &lt; <span class="number">5</span></div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>True</td><br><td>True</td><br><td>True</td><br><td>True</td><br></tr><br><tr><br><th>Colorado</th><br><td>True</td><br><td>False</td><br><td>False</td><br><td>False</td><br></tr><br><tr><br><th>Utah</th><br><td>False</td><br><td>False</td><br><td>False</td><br><td>False</td><br></tr><br><tr><br><th>New York</th><br><td>False</td><br><td>False</td><br><td>False</td><br><td>False</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[data &lt; <span class="number">5</span>] = <span class="number">0</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br><th>four</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>0</td><br><td>0</td><br><td>0</td><br><td>0</td><br></tr><br><tr><br><th>Colorado</th><br><td>0</td><br><td>5</td><br><td>6</td><br><td>7</td><br></tr><br><tr><br><th>Utah</th><br><td>8</td><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><tr><br><th>New York</th><br><td>12</td><br><td>13</td><br><td>14</td><br><td>15</td><br></tr><br><br></tbody><br></table><br></div><p>索引的另外一种选择</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[<span class="string">'Colorado'</span>, [<span class="string">'two'</span>, <span class="string">'three'</span>]]</div></pre></td></tr></table></figure><pre><code>two      5
three    6
Name: Colorado, dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[[<span class="string">'Colorado'</span>, <span class="string">'Utah'</span>], [<span class="number">3</span>, <span class="number">0</span>, <span class="number">1</span>]]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>four</th><br><th>one</th><br><th>two</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Colorado</th><br><td>7</td><br><td>0</td><br><td>5</td><br></tr><br><tr><br><th>Utah</th><br><td>11</td><br><td>8</td><br><td>9</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[<span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>one       8
two       9
three    10
four     11
Name: Utah, dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[:<span class="string">'Utah'</span>, <span class="string">'two'</span>]</div></pre></td></tr></table></figure><pre><code>Ohio        0
Colorado    5
Utah        9
Name: two, dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[data.three &gt; <span class="number">5</span>, :<span class="number">3</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br><th>three</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Colorado</th><br><td>0</td><br><td>5</td><br><td>6</td><br></tr><br><tr><br><th>Utah</th><br><td>8</td><br><td>9</td><br><td>10</td><br></tr><br><tr><br><th>New York</th><br><td>12</td><br><td>13</td><br><td>14</td><br></tr><br><br></tbody><br></table><br></div><p>总结一下就是说，DataFrame是一个二维的数组，只不过每一维的索引方式除了序号之外，还可以用name属性来进行索引，且一切行为与序号无异</p><h3 id="算术运算和数据对齐"><a href="#算术运算和数据对齐" class="headerlink" title="算术运算和数据对齐"></a>算术运算和数据对齐</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">s1 = Series([<span class="number">7.3</span>, <span class="number">-2.5</span>, <span class="number">3.4</span>, <span class="number">1.5</span>], index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">s2 = Series([<span class="number">-2.1</span>, <span class="number">3.6</span>, <span class="number">-1.5</span>, <span class="number">4</span>, <span class="number">3.1</span>], index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">s1</div></pre></td></tr></table></figure><pre><code>a    7.3
c   -2.5
d    3.4
e    1.5
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">s2</div></pre></td></tr></table></figure><pre><code>a   -2.1
c    3.6
e   -1.5
f    4.0
g    3.1
dtype: float64
</code></pre><p>数据对齐操作就是一种特殊的并集操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">s1 + s2</div></pre></td></tr></table></figure><pre><code>a    5.2
c    1.1
d    NaN
e    0.0
f    NaN
g    NaN
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(np.arange(<span class="number">9.</span>).reshape((<span class="number">3</span>, <span class="number">3</span>)), columns=list(<span class="string">'bcd'</span>),</div><div class="line">                index=[<span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Colorado'</span>])</div><div class="line">df2 = DataFrame(np.arange(<span class="number">12.</span>).reshape((<span class="number">4</span>, <span class="number">3</span>)), columns=list(<span class="string">'bde'</span>),</div><div class="line">                index=[<span class="string">'Utah'</span>, <span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Oregon'</span>])</div><div class="line">df1</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>c</th><br><th>d</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Ohio</th><br><td>0.0</td><br><td>1.0</td><br><td>2.0</td><br></tr><br><tr><br><th>Texas</th><br><td>3.0</td><br><td>4.0</td><br><td>5.0</td><br></tr><br><tr><br><th>Colorado</th><br><td>6.0</td><br><td>7.0</td><br><td>8.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>0.0</td><br><td>1.0</td><br><td>2.0</td><br></tr><br><tr><br><th>Ohio</th><br><td>3.0</td><br><td>4.0</td><br><td>5.0</td><br></tr><br><tr><br><th>Texas</th><br><td>6.0</td><br><td>7.0</td><br><td>8.0</td><br></tr><br><tr><br><th>Oregon</th><br><td>9.0</td><br><td>10.0</td><br><td>11.0</td><br></tr><br><br></tbody><br></table><br></div><p>并且数据对齐操作是在所有维度上同时进行的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df1 + df2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Colorado</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>Ohio</th><br><td>3.0</td><br><td>NaN</td><br><td>6.0</td><br><td>NaN</td><br></tr><br><tr><br><th>Oregon</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>Texas</th><br><td>9.0</td><br><td>NaN</td><br><td>12.0</td><br><td>NaN</td><br></tr><br><tr><br><th>Utah</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><h4 id="在算术方法中填充词"><a href="#在算术方法中填充词" class="headerlink" title="在算术方法中填充词"></a>在算术方法中填充词</h4><p>下面这种定义column的方式值得注意</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(np.arange(<span class="number">12.</span>).reshape((<span class="number">3</span>, <span class="number">4</span>)), columns=list(<span class="string">'abcd'</span>))</div><div class="line">df2 = DataFrame(np.arange(<span class="number">20.</span>).reshape((<span class="number">4</span>, <span class="number">5</span>)), columns=list(<span class="string">'abcde'</span>))</div><div class="line">df1</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.0</td><br><td>1.0</td><br><td>2.0</td><br><td>3.0</td><br></tr><br><tr><br><th>1</th><br><td>4.0</td><br><td>5.0</td><br><td>6.0</td><br><td>7.0</td><br></tr><br><tr><br><th>2</th><br><td>8.0</td><br><td>9.0</td><br><td>10.0</td><br><td>11.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.0</td><br><td>1.0</td><br><td>2.0</td><br><td>3.0</td><br><td>4.0</td><br></tr><br><tr><br><th>1</th><br><td>5.0</td><br><td>6.0</td><br><td>7.0</td><br><td>8.0</td><br><td>9.0</td><br></tr><br><tr><br><th>2</th><br><td>10.0</td><br><td>11.0</td><br><td>12.0</td><br><td>13.0</td><br><td>14.0</td><br></tr><br><tr><br><th>3</th><br><td>15.0</td><br><td>16.0</td><br><td>17.0</td><br><td>18.0</td><br><td>19.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df1 + df2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.0</td><br><td>2.0</td><br><td>4.0</td><br><td>6.0</td><br><td>NaN</td><br></tr><br><tr><br><th>1</th><br><td>9.0</td><br><td>11.0</td><br><td>13.0</td><br><td>15.0</td><br><td>NaN</td><br></tr><br><tr><br><th>2</th><br><td>18.0</td><br><td>20.0</td><br><td>22.0</td><br><td>24.0</td><br><td>NaN</td><br></tr><br><tr><br><th>3</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><p>要想填充值必须使用add方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df1.add(df2, fill_value=<span class="number">0</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.0</td><br><td>2.0</td><br><td>4.0</td><br><td>6.0</td><br><td>4.0</td><br></tr><br><tr><br><th>1</th><br><td>9.0</td><br><td>11.0</td><br><td>13.0</td><br><td>15.0</td><br><td>9.0</td><br></tr><br><tr><br><th>2</th><br><td>18.0</td><br><td>20.0</td><br><td>22.0</td><br><td>24.0</td><br><td>14.0</td><br></tr><br><tr><br><th>3</th><br><td>15.0</td><br><td>16.0</td><br><td>17.0</td><br><td>18.0</td><br><td>19.0</td><br></tr><br><br></tbody><br></table><br></div><p>reindex方法与add方法还是存在差异的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df1.reindex(columns=df2.columns, fill_value=<span class="number">0</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.0</td><br><td>1.0</td><br><td>2.0</td><br><td>3.0</td><br><td>0</td><br></tr><br><tr><br><th>1</th><br><td>4.0</td><br><td>5.0</td><br><td>6.0</td><br><td>7.0</td><br><td>0</td><br></tr><br><tr><br><th>2</th><br><td>8.0</td><br><td>9.0</td><br><td>10.0</td><br><td>11.0</td><br><td>0</td><br></tr><br><br></tbody><br></table><br></div><h4 id="DataFrame和Series之间的运算"><a href="#DataFrame和Series之间的运算" class="headerlink" title="DataFrame和Series之间的运算"></a>DataFrame和Series之间的运算</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">12.</span>).reshape((<span class="number">3</span>, <span class="number">4</span>))</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[  0.,   1.,   2.,   3.],
       [  4.,   5.,   6.,   7.],
       [  8.,   9.,  10.,  11.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr[<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>array([ 0.,  1.,  2.,  3.])
</code></pre><p>广播操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr - arr[<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>array([[ 0.,  0.,  0.,  0.],
       [ 4.,  4.,  4.,  4.],
       [ 8.,  8.,  8.,  8.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">12.</span>).reshape((<span class="number">4</span>, <span class="number">3</span>)), columns=list(<span class="string">'bde'</span>),</div><div class="line">                  index=[<span class="string">'Utah'</span>, <span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Oregon'</span>])</div><div class="line">series = frame.ix[<span class="number">0</span>]</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>0.0</td><br><td>1.0</td><br><td>2.0</td><br></tr><br><tr><br><th>Ohio</th><br><td>3.0</td><br><td>4.0</td><br><td>5.0</td><br></tr><br><tr><br><th>Texas</th><br><td>6.0</td><br><td>7.0</td><br><td>8.0</td><br></tr><br><tr><br><th>Oregon</th><br><td>9.0</td><br><td>10.0</td><br><td>11.0</td><br></tr><br><br></tbody><br></table><br></div><p>Series的name等于DataFrame的切片属性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">series</div></pre></td></tr></table></figure><pre><code>b    0.0
d    1.0
e    2.0
Name: Utah, dtype: float64
</code></pre><p>默认情况下，DataFrame和Series之间的算术运算会将Series的index匹配到DataFrame的column, 然后沿着行向下广播</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame - series</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>0.0</td><br><td>0.0</td><br><td>0.0</td><br></tr><br><tr><br><th>Ohio</th><br><td>3.0</td><br><td>3.0</td><br><td>3.0</td><br></tr><br><tr><br><th>Texas</th><br><td>6.0</td><br><td>6.0</td><br><td>6.0</td><br></tr><br><tr><br><th>Oregon</th><br><td>9.0</td><br><td>9.0</td><br><td>9.0</td><br></tr><br><br></tbody><br></table><br></div><p>如果Series的index与DataFrame的column不匹配，则进行数据对齐</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">series2 = Series(range(<span class="number">3</span>), index=[<span class="string">'b'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>])</div><div class="line">frame + series2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br><th>f</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>0.0</td><br><td>NaN</td><br><td>3.0</td><br><td>NaN</td><br></tr><br><tr><br><th>Ohio</th><br><td>3.0</td><br><td>NaN</td><br><td>6.0</td><br><td>NaN</td><br></tr><br><tr><br><th>Texas</th><br><td>6.0</td><br><td>NaN</td><br><td>9.0</td><br><td>NaN</td><br></tr><br><tr><br><th>Oregon</th><br><td>9.0</td><br><td>NaN</td><br><td>12.0</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">series3 = frame[<span class="string">'d'</span>]</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>0.0</td><br><td>1.0</td><br><td>2.0</td><br></tr><br><tr><br><th>Ohio</th><br><td>3.0</td><br><td>4.0</td><br><td>5.0</td><br></tr><br><tr><br><th>Texas</th><br><td>6.0</td><br><td>7.0</td><br><td>8.0</td><br></tr><br><tr><br><th>Oregon</th><br><td>9.0</td><br><td>10.0</td><br><td>11.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">series3</div></pre></td></tr></table></figure><pre><code>Utah       1.0
Ohio       4.0
Texas      7.0
Oregon    10.0
Name: d, dtype: float64
</code></pre><p>匹配行并且在列上进行广播， 就必须要指定axis</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame.sub(series3, axis=<span class="number">0</span>)</div><div class="line">frame.sub(series3, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>-1.0</td><br><td>0.0</td><br><td>1.0</td><br></tr><br><tr><br><th>Ohio</th><br><td>-1.0</td><br><td>0.0</td><br><td>1.0</td><br></tr><br><tr><br><th>Texas</th><br><td>-1.0</td><br><td>0.0</td><br><td>1.0</td><br></tr><br><tr><br><th>Oregon</th><br><td>-1.0</td><br><td>0.0</td><br><td>1.0</td><br></tr><br><br></tbody><br></table><br></div><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Ohio</th><br><th>Oregon</th><br><th>Texas</th><br><th>Utah</th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>Ohio</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>Texas</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>Oregon</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><h3 id="函数应用和映射"><a href="#函数应用和映射" class="headerlink" title="函数应用和映射"></a>函数应用和映射</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.random.randn(<span class="number">4</span>, <span class="number">3</span>), columns=list(<span class="string">'bde'</span>),</div><div class="line">                  index=[<span class="string">'Utah'</span>, <span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Oregon'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>-0.204708</td><br><td>0.478943</td><br><td>-0.519439</td><br></tr><br><tr><br><th>Ohio</th><br><td>-0.555730</td><br><td>1.965781</td><br><td>1.393406</td><br></tr><br><tr><br><th>Texas</th><br><td>0.092908</td><br><td>0.281746</td><br><td>0.769023</td><br></tr><br><tr><br><th>Oregon</th><br><td>1.246435</td><br><td>1.007189</td><br><td>-1.296221</td><br></tr><br><br></tbody><br></table><br></div><p>Numpy的元素级方法也可以应用到DataFrame上，直接把DataFrame当作二维的Numpy.array即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.abs(frame)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>0.204708</td><br><td>0.478943</td><br><td>0.519439</td><br></tr><br><tr><br><th>Ohio</th><br><td>0.555730</td><br><td>1.965781</td><br><td>1.393406</td><br></tr><br><tr><br><th>Texas</th><br><td>0.092908</td><br><td>0.281746</td><br><td>0.769023</td><br></tr><br><tr><br><th>Oregon</th><br><td>1.246435</td><br><td>1.007189</td><br><td>1.296221</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">f = <span class="keyword">lambda</span> x: x.max() - x.min()</div></pre></td></tr></table></figure><p>apply方法将函数映射到由各行或者各列形成的一维数组上</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.apply(f) <span class="comment"># axis=0</span></div></pre></td></tr></table></figure><pre><code>b    1.802165
d    1.684034
e    2.689627
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.apply(f, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><pre><code>Utah      0.998382
Ohio      2.521511
Texas     0.676115
Oregon    2.542656
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span></div><div class="line">    <span class="keyword">return</span> Series([x.min(), x.max()], index=[<span class="string">'min'</span>, <span class="string">'max'</span>])</div><div class="line">frame.apply(f)</div><div class="line">frame.apply(f, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>min</th><br><td>-0.555730</td><br><td>0.281746</td><br><td>-1.296221</td><br></tr><br><tr><br><th>max</th><br><td>1.246435</td><br><td>1.965781</td><br><td>1.393406</td><br></tr><br><br></tbody><br></table><br></div><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>min</th><br><th>max</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>-0.519439</td><br><td>0.478943</td><br></tr><br><tr><br><th>Ohio</th><br><td>-0.555730</td><br><td>1.965781</td><br></tr><br><tr><br><th>Texas</th><br><td>0.092908</td><br><td>0.769023</td><br></tr><br><tr><br><th>Oregon</th><br><td>-1.296221</td><br><td>1.246435</td><br></tr><br><br></tbody><br></table><br></div><p>元素级的函数映射applymap， 之所以叫这个名字是因为Series有一个元素级的映射函数map</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">format = <span class="keyword">lambda</span> x: <span class="string">'%.2f'</span> % x</div><div class="line">frame.applymap(format)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>b</th><br><th>d</th><br><th>e</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>Utah</th><br><td>-0.20</td><br><td>0.48</td><br><td>-0.52</td><br></tr><br><tr><br><th>Ohio</th><br><td>-0.56</td><br><td>1.97</td><br><td>1.39</td><br></tr><br><tr><br><th>Texas</th><br><td>0.09</td><br><td>0.28</td><br><td>0.77</td><br></tr><br><tr><br><th>Oregon</th><br><td>1.25</td><br><td>1.01</td><br><td>-1.30</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame[<span class="string">'e'</span>].map(format)</div></pre></td></tr></table></figure><pre><code>Utah      -0.52
Ohio       1.39
Texas      0.77
Oregon    -1.30
Name: e, dtype: object
</code></pre><h3 id="排序和排名"><a href="#排序和排名" class="headerlink" title="排序和排名"></a>排序和排名</h3><p>对索引或者column进行（字典）排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series(range(<span class="number">4</span>), index=[<span class="string">'d'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">obj.sort_index()</div></pre></td></tr></table></figure><pre><code>a    1
b    2
c    3
d    0
dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">8</span>).reshape((<span class="number">2</span>, <span class="number">4</span>)), index=[<span class="string">'three'</span>, <span class="string">'one'</span>],</div><div class="line">                  columns=[<span class="string">'d'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">frame.sort_index()</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>d</th><br><th>a</th><br><th>b</th><br><th>c</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>one</th><br><td>4</td><br><td>5</td><br><td>6</td><br><td>7</td><br></tr><br><tr><br><th>three</th><br><td>0</td><br><td>1</td><br><td>2</td><br><td>3</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sort_index(axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>three</th><br><td>1</td><br><td>2</td><br><td>3</td><br><td>0</td><br></tr><br><tr><br><th>one</th><br><td>5</td><br><td>6</td><br><td>7</td><br><td>4</td><br></tr><br><br></tbody><br></table><br></div><p>降序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sort_index(axis=<span class="number">1</span>, ascending=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>d</th><br><th>c</th><br><th>b</th><br><th>a</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>three</th><br><td>0</td><br><td>3</td><br><td>2</td><br><td>1</td><br></tr><br><tr><br><th>one</th><br><td>4</td><br><td>7</td><br><td>6</td><br><td>5</td><br></tr><br><br></tbody><br></table><br></div><p>按照data进行排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">4</span>, <span class="number">7</span>, <span class="number">-3</span>, <span class="number">2</span>])</div><div class="line">obj.sort_values()</div></pre></td></tr></table></figure><pre><code>2   -3
3    2
0    4
1    7
dtype: int64
</code></pre><p>在排序时，任何缺失值默认都会被放到Series的末尾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">4</span>, np.nan, <span class="number">7</span>, np.nan, <span class="number">-3</span>, <span class="number">2</span>])</div><div class="line">obj.sort_values()</div></pre></td></tr></table></figure><pre><code>4   -3.0
5    2.0
0    4.0
2    7.0
1    NaN
3    NaN
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(&#123;<span class="string">'b'</span>: [<span class="number">4</span>, <span class="number">7</span>, <span class="number">-3</span>, <span class="number">2</span>], <span class="string">'a'</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]&#125;)</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0</td><br><td>4</td><br></tr><br><tr><br><th>1</th><br><td>1</td><br><td>7</td><br></tr><br><tr><br><th>2</th><br><td>0</td><br><td>-3</td><br></tr><br><tr><br><th>3</th><br><td>1</td><br><td>2</td><br></tr><br><br></tbody><br></table><br></div><p>对指定index或者column进行排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sort_values(by=<span class="string">'b'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2</th><br><td>0</td><br><td>-3</td><br></tr><br><tr><br><th>3</th><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>0</th><br><td>0</td><br><td>4</td><br></tr><br><tr><br><th>1</th><br><td>1</td><br><td>7</td><br></tr><br><br></tbody><br></table><br></div><p>或者根据multi-index亦或multi-column进行排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sort_values(by=[<span class="string">'a'</span>, <span class="string">'b'</span>])</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2</th><br><td>0</td><br><td>-3</td><br></tr><br><tr><br><th>0</th><br><td>0</td><br><td>4</td><br></tr><br><tr><br><th>3</th><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>1</th><br><td>1</td><br><td>7</td><br></tr><br><br></tbody><br></table><br></div><p>默认情况下，rank方法通过“为各组分配一个平均排名”的方式破坏平级关系。也就是说，如果有多个相同的值，则这些值的rank就是这些相同值rand的算术平均。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">7</span>, <span class="number">-5</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">4</span>])</div><div class="line">obj.rank()</div></pre></td></tr></table></figure><pre><code>0    7.5
1    1.0
2    7.5
3    5.0
4    3.0
5    2.0
6    5.0
7    5.0
dtype: float64
</code></pre><p>如果想按照一般方式排名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.rank(method=<span class="string">'first'</span>)</div></pre></td></tr></table></figure><pre><code>0    7.0
1    1.0
2    8.0
3    4.0
4    3.0
5    2.0
6    5.0
7    6.0
dtype: float64
</code></pre><p>使用每个分组的最大排名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.rank(ascending=<span class="keyword">False</span>, method=<span class="string">'max'</span>)</div></pre></td></tr></table></figure><pre><code>0    2.0
1    8.0
2    2.0
3    5.0
4    6.0
5    7.0
6    5.0
7    5.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(&#123;<span class="string">'b'</span>: [<span class="number">4.3</span>, <span class="number">7</span>, <span class="number">-3</span>, <span class="number">2</span>], <span class="string">'a'</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</div><div class="line">                   <span class="string">'c'</span>: [<span class="number">-2</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">-2.5</span>]&#125;)</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0</td><br><td>4.3</td><br><td>-2.0</td><br></tr><br><tr><br><th>1</th><br><td>1</td><br><td>7.0</td><br><td>5.0</td><br></tr><br><tr><br><th>2</th><br><td>0</td><br><td>-3.0</td><br><td>8.0</td><br></tr><br><tr><br><th>3</th><br><td>1</td><br><td>2.0</td><br><td>-2.5</td><br></tr><br><br></tbody><br></table><br></div><p>指定维度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.rank(axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>2.0</td><br><td>3.0</td><br><td>1.0</td><br></tr><br><tr><br><th>1</th><br><td>1.0</td><br><td>3.0</td><br><td>2.0</td><br></tr><br><tr><br><th>2</th><br><td>2.0</td><br><td>1.0</td><br><td>3.0</td><br></tr><br><tr><br><th>3</th><br><td>2.0</td><br><td>3.0</td><br><td>1.0</td><br></tr><br><br></tbody><br></table><br></div><h3 id="带有重复值的轴索引"><a href="#带有重复值的轴索引" class="headerlink" title="带有重复值的轴索引"></a>带有重复值的轴索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj = Series(range(<span class="number">5</span>), index=[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">obj</div></pre></td></tr></table></figure><pre><code>a    0
a    1
b    2
b    3
c    4
dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.index.is_unique</div></pre></td></tr></table></figure><pre><code>False
</code></pre><p>返回一个Series</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[<span class="string">'a'</span>]</div></pre></td></tr></table></figure><pre><code>a    0
a    1
dtype: int32
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[<span class="string">'c'</span>]</div></pre></td></tr></table></figure><pre><code>4
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(np.random.randn(<span class="number">4</span>, <span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>])</div><div class="line">df</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>0.274992</td><br><td>0.228913</td><br><td>1.352917</td><br></tr><br><tr><br><th>a</th><br><td>0.886429</td><br><td>-2.001637</td><br><td>-0.371843</td><br></tr><br><tr><br><th>b</th><br><td>1.669025</td><br><td>-0.438570</td><br><td>-0.539741</td><br></tr><br><tr><br><th>b</th><br><td>0.476985</td><br><td>3.248944</td><br><td>-1.021228</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.ix[<span class="string">'b'</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>b</th><br><td>1.669025</td><br><td>-0.438570</td><br><td>-0.539741</td><br></tr><br><tr><br><th>b</th><br><td>0.476985</td><br><td>3.248944</td><br><td>-1.021228</td><br></tr><br><br></tbody><br></table><br></div><h2 id="汇总和计算描述统计"><a href="#汇总和计算描述统计" class="headerlink" title="汇总和计算描述统计"></a>汇总和计算描述统计</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">df = DataFrame([[<span class="number">1.4</span>, np.nan], [<span class="number">7.1</span>, <span class="number">-4.5</span>],</div><div class="line">                [np.nan, np.nan], [<span class="number">0.75</span>, <span class="number">-1.3</span>]],</div><div class="line">               index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>],</div><div class="line">               columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</div><div class="line">df</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>1.40</td><br><td>NaN</td><br></tr><br><tr><br><th>b</th><br><td>7.10</td><br><td>-4.5</td><br></tr><br><tr><br><th>c</th><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>d</th><br><td>0.75</td><br><td>-1.3</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.sum() <span class="comment"># axis=0 skipna=True</span></div></pre></td></tr></table></figure><pre><code>one    9.25
two   -5.80
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.sum(axis=<span class="number">1</span>) <span class="comment"># skipna=True</span></div></pre></td></tr></table></figure><pre><code>a    1.40
b    2.60
c    0.00
d   -0.55
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.mean(axis=<span class="number">1</span>, skipna=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><pre><code>a      NaN
b    1.300
c      NaN
d   -0.275
dtype: float64
</code></pre><p>返回的是索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.idxmax()</div></pre></td></tr></table></figure><pre><code>one    b
two    d
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.cumsum()</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>1.40</td><br><td>NaN</td><br></tr><br><tr><br><th>b</th><br><td>8.50</td><br><td>-4.5</td><br></tr><br><tr><br><th>c</th><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>d</th><br><td>9.25</td><br><td>-5.8</td><br></tr><br><br></tbody><br></table><br></div><p>describe对于数值型和非数值型数据的行为不一样</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.describe()</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\numpy\lib\function_base.py:3834: RuntimeWarning: Invalid value encountered in percentile
  RuntimeWarning)
</code></pre><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>one</th><br><th>two</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>count</th><br><td>3.000000</td><br><td>2.000000</td><br></tr><br><tr><br><th>mean</th><br><td>3.083333</td><br><td>-2.900000</td><br></tr><br><tr><br><th>std</th><br><td>3.493685</td><br><td>2.262742</td><br></tr><br><tr><br><th>min</th><br><td>0.750000</td><br><td>-4.500000</td><br></tr><br><tr><br><th>25%</th><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>50%</th><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>75%</th><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>max</th><br><td>7.100000</td><br><td>-1.300000</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>] * <span class="number">4</span>)</div><div class="line">obj</div><div class="line">obj.describe()</div></pre></td></tr></table></figure><pre><code>0     a
1     a
2     b
3     c
4     a
5     a
6     b
7     c
8     a
9     a
10    b
11    c
12    a
13    a
14    b
15    c
dtype: object






count     16
unique     3
top        a
freq       8
dtype: object
</code></pre><h3 id="相关系数和xi"><a href="#相关系数和xi" class="headerlink" title="相关系数和xi"></a>相关系数和xi</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas_datareader.data <span class="keyword">as</span> web</div><div class="line"></div><div class="line">all_data = &#123;&#125;</div><div class="line"><span class="keyword">for</span> ticker <span class="keyword">in</span> [<span class="string">'AAPL'</span>, <span class="string">'IBM'</span>, <span class="string">'MSFT'</span>, <span class="string">'GOOG'</span>]:</div><div class="line">    all_data[ticker] = web.get_data_yahoo(ticker)</div><div class="line"></div><div class="line">price = DataFrame(&#123;tic: data[<span class="string">'Adj Close'</span>]</div><div class="line">                   <span class="keyword">for</span> tic, data <span class="keyword">in</span> all_data.items()&#125;)</div><div class="line">volume = DataFrame(&#123;tic: data[<span class="string">'Volume'</span>]</div><div class="line">                    <span class="keyword">for</span> tic, data <span class="keyword">in</span> all_data.items()&#125;)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">price[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>AAPL</th><br><th>GOOG</th><br><th>IBM</th><br><th>MSFT</th><br></tr><br><tr><br><th>Date</th><br><th></th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2010-01-04</th><br><td>27.727039</td><br><td>313.062468</td><br><td>111.405000</td><br><td>25.555485</td><br></tr><br><tr><br><th>2010-01-05</th><br><td>27.774976</td><br><td>311.683844</td><br><td>110.059232</td><br><td>25.563741</td><br></tr><br><tr><br><th>2010-01-06</th><br><td>27.333178</td><br><td>303.826685</td><br><td>109.344283</td><br><td>25.406859</td><br></tr><br><tr><br><th>2010-01-07</th><br><td>27.282650</td><br><td>296.753749</td><br><td>108.965786</td><br><td>25.142634</td><br></tr><br><tr><br><th>2010-01-08</th><br><td>27.464034</td><br><td>300.709808</td><br><td>110.059232</td><br><td>25.316031</td><br></tr><br><tr><br><th>2010-01-11</th><br><td>27.221758</td><br><td>300.255255</td><br><td>108.906903</td><br><td>24.994007</td><br></tr><br><tr><br><th>2010-01-12</th><br><td>26.912110</td><br><td>294.945572</td><br><td>109.773245</td><br><td>24.828866</td><br></tr><br><tr><br><th>2010-01-13</th><br><td>27.291720</td><br><td>293.252243</td><br><td>109.537735</td><br><td>25.060064</td><br></tr><br><tr><br><th>2010-01-14</th><br><td>27.133657</td><br><td>294.630868</td><br><td>111.287245</td><br><td>25.563741</td><br></tr><br><tr><br><th>2010-01-15</th><br><td>26.680198</td><br><td>289.710772</td><br><td>110.841458</td><br><td>25.481172</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">volume[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>AAPL</th><br><th>GOOG</th><br><th>IBM</th><br><th>MSFT</th><br></tr><br><tr><br><th>Date</th><br><th></th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2010-01-04</th><br><td>123432400</td><br><td>3927000</td><br><td>6155300</td><br><td>38409100</td><br></tr><br><tr><br><th>2010-01-05</th><br><td>150476200</td><br><td>6031900</td><br><td>6841400</td><br><td>49749600</td><br></tr><br><tr><br><th>2010-01-06</th><br><td>138040000</td><br><td>7987100</td><br><td>5605300</td><br><td>58182400</td><br></tr><br><tr><br><th>2010-01-07</th><br><td>119282800</td><br><td>12876600</td><br><td>5840600</td><br><td>50559700</td><br></tr><br><tr><br><th>2010-01-08</th><br><td>111902700</td><br><td>9483900</td><br><td>4197200</td><br><td>51197400</td><br></tr><br><tr><br><th>2010-01-11</th><br><td>115557400</td><br><td>14479800</td><br><td>5730400</td><br><td>68754700</td><br></tr><br><tr><br><th>2010-01-12</th><br><td>148614900</td><br><td>9742900</td><br><td>8081500</td><br><td>65912100</td><br></tr><br><tr><br><th>2010-01-13</th><br><td>151473000</td><br><td>13041800</td><br><td>6455400</td><br><td>51863500</td><br></tr><br><tr><br><th>2010-01-14</th><br><td>108223500</td><br><td>8511900</td><br><td>7111800</td><br><td>63228100</td><br></tr><br><tr><br><th>2010-01-15</th><br><td>148516900</td><br><td>10909600</td><br><td>8494400</td><br><td>79913200</td><br></tr><br><br></tbody><br></table><br></div><p><strong>price.pct_change</strong></p><p><strong>Signature</strong>: price.pct_change(periods=1, fill_method=’pad’, limit=None, freq=None, **kwargs)<br><strong>Docstring</strong>:<br>Percent change over given number of periods.</p><p><strong>Parameters</strong></p><p>periods : int, default 1<br>Periods to shift for forming percent change</p><p>fill_method : str, default ‘pad’<br>How to handle NAs before computing percent changes</p><p>limit : int, default None<br>The number of consecutive NAs to fill before stopping</p><p>freq : DateOffset, timedelta, or offset alias string, optional<br>Increment to use from time series API (e.g. ‘M’ or BDay())</p><p><strong>Returns</strong></p><p>chg : NDFrame</p><p><strong>Notes</strong></p><p>By default, the percentage change is calculated along the stat<br>axis: 0, or <code>Index</code>, for <code>DataFrame</code> and 1, or <code>minor</code> for<br><code>Panel</code>. You can change this with the <code>axis</code> keyword argument.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">returns = price.pct_change()</div><div class="line">returns.tail()</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>AAPL</th><br><th>GOOG</th><br><th>IBM</th><br><th>MSFT</th><br></tr><br><tr><br><th>Date</th><br><th></th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2017-02-21</th><br><td>0.007221</td><br><td>0.004335</td><br><td>-0.002269</td><br><td>-0.002012</td><br></tr><br><tr><br><th>2017-02-22</th><br><td>0.002999</td><br><td>-0.001082</td><br><td>0.004937</td><br><td>-0.002016</td><br></tr><br><tr><br><th>2017-02-23</th><br><td>-0.004230</td><br><td>0.000686</td><br><td>0.002760</td><br><td>0.004040</td><br></tr><br><tr><br><th>2017-02-24</th><br><td>0.000952</td><br><td>-0.003236</td><br><td>-0.001651</td><br><td>0.000000</td><br></tr><br><tr><br><th>2017-02-27</th><br><td>0.001976</td><br><td>0.000772</td><br><td>-0.010753</td><br><td>-0.006035</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.MSFT.corr(returns.IBM)</div></pre></td></tr></table></figure><pre><code>0.49525655865062668
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.MSFT.cov(returns.IBM)</div></pre></td></tr></table></figure><pre><code>8.5880535146740545e-05
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.corr()</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>AAPL</th><br><th>GOOG</th><br><th>IBM</th><br><th>MSFT</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>AAPL</th><br><td>1.000000</td><br><td>0.409523</td><br><td>0.381374</td><br><td>0.388875</td><br></tr><br><tr><br><th>GOOG</th><br><td>0.409523</td><br><td>1.000000</td><br><td>0.402781</td><br><td>0.470781</td><br></tr><br><tr><br><th>IBM</th><br><td>0.381374</td><br><td>0.402781</td><br><td>1.000000</td><br><td>0.495257</td><br></tr><br><tr><br><th>MSFT</th><br><td>0.388875</td><br><td>0.470781</td><br><td>0.495257</td><br><td>1.000000</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.cov()</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>AAPL</th><br><th>GOOG</th><br><th>IBM</th><br><th>MSFT</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>AAPL</th><br><td>0.000269</td><br><td>0.000105</td><br><td>0.000075</td><br><td>0.000092</td><br></tr><br><tr><br><th>GOOG</th><br><td>0.000105</td><br><td>0.000244</td><br><td>0.000075</td><br><td>0.000106</td><br></tr><br><tr><br><th>IBM</th><br><td>0.000075</td><br><td>0.000075</td><br><td>0.000144</td><br><td>0.000086</td><br></tr><br><tr><br><th>MSFT</th><br><td>0.000092</td><br><td>0.000106</td><br><td>0.000086</td><br><td>0.000209</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.corrwith(returns.IBM)</div></pre></td></tr></table></figure><pre><code>AAPL    0.381374
GOOG    0.402781
IBM     1.000000
MSFT    0.495257
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">returns.corrwith(volume)</div></pre></td></tr></table></figure><pre><code>AAPL   -0.074055
GOOG   -0.009543
IBM    -0.194107
MSFT   -0.090724
dtype: float64
</code></pre><h3 id="唯一值，-值计数以及成员资格"><a href="#唯一值，-值计数以及成员资格" class="headerlink" title="唯一值， 值计数以及成员资格"></a>唯一值， 值计数以及成员资格</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'c'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">uniques = obj.unique()</div><div class="line">uniques</div></pre></td></tr></table></figure><pre><code>array([&apos;c&apos;, &apos;a&apos;, &apos;d&apos;, &apos;b&apos;], dtype=object)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj.value_counts()</div></pre></td></tr></table></figure><pre><code>c    3
a    3
b    2
d    1
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.value_counts(obj.values, sort=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><pre><code>a    3
d    1
b    2
c    3
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mask = obj.isin([<span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">mask</div></pre></td></tr></table></figure><pre><code>0     True
1    False
2    False
3    False
4    False
5     True
6     True
7     True
8     True
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">obj[mask]</div></pre></td></tr></table></figure><pre><code>0    c
5    b
6    b
7    c
8    c
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(&#123;<span class="string">'Qu1'</span>: [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>],</div><div class="line">                  <span class="string">'Qu2'</span>: [<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</div><div class="line">                  <span class="string">'Qu3'</span>: [<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>]&#125;)</div><div class="line">data</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Qu1</th><br><th>Qu2</th><br><th>Qu3</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1</td><br><td>2</td><br><td>1</td><br></tr><br><tr><br><th>1</th><br><td>3</td><br><td>3</td><br><td>5</td><br></tr><br><tr><br><th>2</th><br><td>4</td><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>3</th><br><td>3</td><br><td>2</td><br><td>4</td><br></tr><br><tr><br><th>4</th><br><td>4</td><br><td>3</td><br><td>4</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = data.apply(pd.value_counts).fillna(<span class="number">0</span>)</div><div class="line">result</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Qu1</th><br><th>Qu2</th><br><th>Qu3</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>1</th><br><td>1.0</td><br><td>1.0</td><br><td>1.0</td><br></tr><br><tr><br><th>2</th><br><td>0.0</td><br><td>2.0</td><br><td>1.0</td><br></tr><br><tr><br><th>3</th><br><td>2.0</td><br><td>2.0</td><br><td>0.0</td><br></tr><br><tr><br><th>4</th><br><td>2.0</td><br><td>0.0</td><br><td>2.0</td><br></tr><br><tr><br><th>5</th><br><td>0.0</td><br><td>0.0</td><br><td>1.0</td><br></tr><br><br></tbody><br></table><br></div><h2 id="处理缺失数据"><a href="#处理缺失数据" class="headerlink" title="处理缺失数据"></a>处理缺失数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">string_data = Series([<span class="string">'aardvark'</span>, <span class="string">'artichoke'</span>, np.nan, <span class="string">'avocado'</span>])</div><div class="line">string_data</div></pre></td></tr></table></figure><pre><code>0     aardvark
1    artichoke
2          NaN
3      avocado
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">string_data.isnull()</div></pre></td></tr></table></figure><pre><code>0    False
1    False
2     True
3    False
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">string_data[<span class="number">0</span>] = <span class="keyword">None</span></div><div class="line">string_data.isnull()</div></pre></td></tr></table></figure><pre><code>0     True
1    False
2     True
3    False
dtype: bool
</code></pre><h3 id="滤除缺失数据"><a href="#滤除缺失数据" class="headerlink" title="滤除缺失数据"></a>滤除缺失数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> nan <span class="keyword">as</span> NA</div><div class="line">data = Series([<span class="number">1</span>, NA, <span class="number">3.5</span>, NA, <span class="number">7</span>])</div><div class="line">data.dropna()</div></pre></td></tr></table></figure><pre><code>0    1.0
2    3.5
4    7.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[data.notnull()]</div></pre></td></tr></table></figure><pre><code>0    1.0
2    3.5
4    7.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame([[<span class="number">1.</span>, <span class="number">6.5</span>, <span class="number">3.</span>], [<span class="number">1.</span>, NA, NA],</div><div class="line">                  [NA, NA, NA], [NA, <span class="number">6.5</span>, <span class="number">3.</span>]])</div><div class="line">cleaned = data.dropna()</div><div class="line">data</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1.0</td><br><td>6.5</td><br><td>3.0</td><br></tr><br><tr><br><th>1</th><br><td>1.0</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>3</th><br><td>NaN</td><br><td>6.5</td><br><td>3.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cleaned</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1.0</td><br><td>6.5</td><br><td>3.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.dropna(how=<span class="string">'all'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1.0</td><br><td>6.5</td><br><td>3.0</td><br></tr><br><tr><br><th>1</th><br><td>1.0</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>3</th><br><td>NaN</td><br><td>6.5</td><br><td>3.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data[<span class="number">4</span>] = NA</div><div class="line">data</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br><th>4</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1.0</td><br><td>6.5</td><br><td>3.0</td><br><td>NaN</td><br></tr><br><tr><br><th>1</th><br><td>1.0</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>3</th><br><td>NaN</td><br><td>6.5</td><br><td>3.0</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.dropna(axis=<span class="number">1</span>, how=<span class="string">'all'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>1.0</td><br><td>6.5</td><br><td>3.0</td><br></tr><br><tr><br><th>1</th><br><td>1.0</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2</th><br><td>NaN</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>3</th><br><td>NaN</td><br><td>6.5</td><br><td>3.0</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(np.random.randn(<span class="number">7</span>, <span class="number">3</span>))</div><div class="line">df.ix[:<span class="number">4</span>, <span class="number">1</span>] = NA; df.ix[:<span class="number">2</span>, <span class="number">2</span>] = NA</div><div class="line">df</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>-0.204708</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>1</th><br><td>-0.555730</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2</th><br><td>0.092908</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>3</th><br><td>1.246435</td><br><td>NaN</td><br><td>-1.296221</td><br></tr><br><tr><br><th>4</th><br><td>0.274992</td><br><td>NaN</td><br><td>1.352917</td><br></tr><br><tr><br><th>5</th><br><td>0.886429</td><br><td>-2.001637</td><br><td>-0.371843</td><br></tr><br><tr><br><th>6</th><br><td>1.669025</td><br><td>-0.438570</td><br><td>-0.539741</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.dropna(thresh=<span class="number">2</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>3</th><br><td>1.246435</td><br><td>NaN</td><br><td>-1.296221</td><br></tr><br><tr><br><th>4</th><br><td>0.274992</td><br><td>NaN</td><br><td>1.352917</td><br></tr><br><tr><br><th>5</th><br><td>0.886429</td><br><td>-2.001637</td><br><td>-0.371843</td><br></tr><br><tr><br><th>6</th><br><td>1.669025</td><br><td>-0.438570</td><br><td>-0.539741</td><br></tr><br><br></tbody><br></table><br></div><h3 id="填充缺失数据"><a href="#填充缺失数据" class="headerlink" title="填充缺失数据"></a>填充缺失数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.fillna(<span class="number">0</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>-0.204708</td><br><td>0.000000</td><br><td>0.000000</td><br></tr><br><tr><br><th>1</th><br><td>-0.555730</td><br><td>0.000000</td><br><td>0.000000</td><br></tr><br><tr><br><th>2</th><br><td>0.092908</td><br><td>0.000000</td><br><td>0.000000</td><br></tr><br><tr><br><th>3</th><br><td>1.246435</td><br><td>0.000000</td><br><td>-1.296221</td><br></tr><br><tr><br><th>4</th><br><td>0.274992</td><br><td>0.000000</td><br><td>1.352917</td><br></tr><br><tr><br><th>5</th><br><td>0.886429</td><br><td>-2.001637</td><br><td>-0.371843</td><br></tr><br><tr><br><th>6</th><br><td>1.669025</td><br><td>-0.438570</td><br><td>-0.539741</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.fillna(&#123;<span class="number">1</span>: <span class="number">0.5</span>, <span class="number">3</span>: <span class="number">-1</span>&#125;)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>-0.204708</td><br><td>0.500000</td><br><td>NaN</td><br></tr><br><tr><br><th>1</th><br><td>-0.555730</td><br><td>0.500000</td><br><td>NaN</td><br></tr><br><tr><br><th>2</th><br><td>0.092908</td><br><td>0.500000</td><br><td>NaN</td><br></tr><br><tr><br><th>3</th><br><td>1.246435</td><br><td>0.500000</td><br><td>-1.296221</td><br></tr><br><tr><br><th>4</th><br><td>0.274992</td><br><td>0.500000</td><br><td>1.352917</td><br></tr><br><tr><br><th>5</th><br><td>0.886429</td><br><td>-2.001637</td><br><td>-0.371843</td><br></tr><br><tr><br><th>6</th><br><td>1.669025</td><br><td>-0.438570</td><br><td>-0.539741</td><br></tr><br><br></tbody><br></table><br></div><p>fillna默认返回新对象，但也可以对现有对象就地修改</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># always returns a reference to the filled object</span></div><div class="line">_ = df.fillna(<span class="number">0</span>, inplace=<span class="keyword">True</span>)</div><div class="line">df</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>-0.204708</td><br><td>0.000000</td><br><td>0.000000</td><br></tr><br><tr><br><th>1</th><br><td>-0.555730</td><br><td>0.000000</td><br><td>0.000000</td><br></tr><br><tr><br><th>2</th><br><td>0.092908</td><br><td>0.000000</td><br><td>0.000000</td><br></tr><br><tr><br><th>3</th><br><td>1.246435</td><br><td>0.000000</td><br><td>-1.296221</td><br></tr><br><tr><br><th>4</th><br><td>0.274992</td><br><td>0.000000</td><br><td>1.352917</td><br></tr><br><tr><br><th>5</th><br><td>0.886429</td><br><td>-2.001637</td><br><td>-0.371843</td><br></tr><br><tr><br><th>6</th><br><td>1.669025</td><br><td>-0.438570</td><br><td>-0.539741</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(np.random.randn(<span class="number">6</span>, <span class="number">3</span>))</div><div class="line">df.ix[<span class="number">2</span>:, <span class="number">1</span>] = NA; df.ix[<span class="number">4</span>:, <span class="number">2</span>] = NA</div><div class="line">df</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.476985</td><br><td>3.248944</td><br><td>-1.021228</td><br></tr><br><tr><br><th>1</th><br><td>-0.577087</td><br><td>0.124121</td><br><td>0.302614</td><br></tr><br><tr><br><th>2</th><br><td>0.523772</td><br><td>NaN</td><br><td>1.343810</td><br></tr><br><tr><br><th>3</th><br><td>-0.713544</td><br><td>NaN</td><br><td>-2.370232</td><br></tr><br><tr><br><th>4</th><br><td>-1.860761</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>5</th><br><td>-1.265934</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.fillna(method=<span class="string">'ffill'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.476985</td><br><td>3.248944</td><br><td>-1.021228</td><br></tr><br><tr><br><th>1</th><br><td>-0.577087</td><br><td>0.124121</td><br><td>0.302614</td><br></tr><br><tr><br><th>2</th><br><td>0.523772</td><br><td>0.124121</td><br><td>1.343810</td><br></tr><br><tr><br><th>3</th><br><td>-0.713544</td><br><td>0.124121</td><br><td>-2.370232</td><br></tr><br><tr><br><th>4</th><br><td>-1.860761</td><br><td>0.124121</td><br><td>-2.370232</td><br></tr><br><tr><br><th>5</th><br><td>-1.265934</td><br><td>0.124121</td><br><td>-2.370232</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.fillna(method=<span class="string">'ffill'</span>, limit=<span class="number">2</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br><th>2</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0.476985</td><br><td>3.248944</td><br><td>-1.021228</td><br></tr><br><tr><br><th>1</th><br><td>-0.577087</td><br><td>0.124121</td><br><td>0.302614</td><br></tr><br><tr><br><th>2</th><br><td>0.523772</td><br><td>0.124121</td><br><td>1.343810</td><br></tr><br><tr><br><th>3</th><br><td>-0.713544</td><br><td>0.124121</td><br><td>-2.370232</td><br></tr><br><tr><br><th>4</th><br><td>-1.860761</td><br><td>NaN</td><br><td>-2.370232</td><br></tr><br><tr><br><th>5</th><br><td>-1.265934</td><br><td>NaN</td><br><td>-2.370232</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data = Series([<span class="number">1.</span>, NA, <span class="number">3.5</span>, NA, <span class="number">7</span>])</div><div class="line">data.fillna(data.mean())</div></pre></td></tr></table></figure><pre><code>0    1.000000
1    3.833333
2    3.500000
3    3.833333
4    7.000000
dtype: float64
</code></pre><h2 id="层次索引"><a href="#层次索引" class="headerlink" title="层次索引"></a>层次索引</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = Series(np.random.randn(<span class="number">10</span>),</div><div class="line">              index=[[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'d'</span>],</div><div class="line">                     [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]])</div><div class="line">data</div></pre></td></tr></table></figure><pre><code>a  1    0.332883
   2   -2.359419
   3   -0.199543
b  1   -1.541996
   2   -0.970736
   3   -1.307030
c  1    0.286350
   2    0.377984
d  2   -0.753887
   3    0.331286
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.index</div></pre></td></tr></table></figure><pre><code>MultiIndex(levels=[[&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;], [1, 2, 3]],
           labels=[[0, 0, 0, 1, 1, 1, 2, 2, 3, 3], [0, 1, 2, 0, 1, 2, 0, 1, 1, 2]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'b'</span>]</div></pre></td></tr></table></figure><pre><code>1   -1.541996
2   -0.970736
3   -1.307030
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'b'</span>:<span class="string">'c'</span>]</div></pre></td></tr></table></figure><pre><code>b  1   -1.541996
   2   -0.970736
   3   -1.307030
c  1    0.286350
   2    0.377984
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.ix[[<span class="string">'b'</span>, <span class="string">'d'</span>]]</div></pre></td></tr></table></figure><pre><code>b  1   -1.541996
   2   -0.970736
   3   -1.307030
d  2   -0.753887
   3    0.331286
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[:, <span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>a   -2.359419
b   -0.970736
c    0.377984
d   -0.753887
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.unstack()</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>1</th><br><th>2</th><br><th>3</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><td>0.332883</td><br><td>-2.359419</td><br><td>-0.199543</td><br></tr><br><tr><br><th>b</th><br><td>-1.541996</td><br><td>-0.970736</td><br><td>-1.307030</td><br></tr><br><tr><br><th>c</th><br><td>0.286350</td><br><td>0.377984</td><br><td>NaN</td><br></tr><br><tr><br><th>d</th><br><td>NaN</td><br><td>-0.753887</td><br><td>0.331286</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.unstack().stack()</div></pre></td></tr></table></figure><pre><code>a  1    0.332883
   2   -2.359419
   3   -0.199543
b  1   -1.541996
   2   -0.970736
   3   -1.307030
c  1    0.286350
   2    0.377984
d  2   -0.753887
   3    0.331286
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">4</span>, <span class="number">3</span>)),</div><div class="line">                  index=[[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>]],</div><div class="line">                  columns=[[<span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>],</div><div class="line">                           [<span class="string">'Green'</span>, <span class="string">'Red'</span>, <span class="string">'Green'</span>]])</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr><br><th></th><br><th></th><br><th colspan="2" halign="left">Ohio</th><br><th>Colorado</th><br></tr><br><tr><br><th></th><br><th></th><br><th>Green</th><br><th>Red</th><br><th>Green</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="2" valign="top">a</th><br><th>1</th><br><td>0</td><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>2</th><br><td>3</td><br><td>4</td><br><td>5</td><br></tr><br><tr><br><th rowspan="2" valign="top">b</th><br><th>1</th><br><td>6</td><br><td>7</td><br><td>8</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame.index.names = [<span class="string">'key1'</span>, <span class="string">'key2'</span>]</div><div class="line">frame.columns.names = [<span class="string">'state'</span>, <span class="string">'color'</span>]</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr><br><th></th><br><th>state</th><br><th colspan="2" halign="left">Ohio</th><br><th>Colorado</th><br></tr><br><tr><br><th></th><br><th>color</th><br><th>Green</th><br><th>Red</th><br><th>Green</th><br></tr><br><tr><br><th>key1</th><br><th>key2</th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="2" valign="top">a</th><br><th>1</th><br><td>0</td><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>2</th><br><td>3</td><br><td>4</td><br><td>5</td><br></tr><br><tr><br><th rowspan="2" valign="top">b</th><br><th>1</th><br><td>6</td><br><td>7</td><br><td>8</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame[<span class="string">'Ohio'</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>color</th><br><th>Green</th><br><th>Red</th><br></tr><br><tr><br><th>key1</th><br><th>key2</th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="2" valign="top">a</th><br><th>1</th><br><td>0</td><br><td>1</td><br></tr><br><tr><br><th>2</th><br><td>3</td><br><td>4</td><br></tr><br><tr><br><th rowspan="2" valign="top">b</th><br><th>1</th><br><td>6</td><br><td>7</td><br></tr><br><tr><br><th>2</th><br><td>9</td><br><td>10</td><br></tr><br><br></tbody><br></table><br></div><p><strong>创建MultiIndex对象复用</strong><br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MultiIndex.from_arrays([[&apos;Ohio&apos;, &apos;Ohio&apos;, &apos;Colorado&apos;], [&apos;Green&apos;, &apos;Red&apos;, &apos;Green&apos;]],</div><div class="line">                       names=[&apos;state&apos;, &apos;color&apos;])</div></pre></td></tr></table></figure><p></p><h3 id="重排分级顺序"><a href="#重排分级顺序" class="headerlink" title="重排分级顺序"></a>重排分级顺序</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.swaplevel(<span class="string">'key1'</span>, <span class="string">'key2'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr><br><th></th><br><th>state</th><br><th colspan="2" halign="left">Ohio</th><br><th>Colorado</th><br></tr><br><tr><br><th></th><br><th>color</th><br><th>Green</th><br><th>Red</th><br><th>Green</th><br></tr><br><tr><br><th>key2</th><br><th>key1</th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>1</th><br><th>a</th><br><td>0</td><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>2</th><br><th>a</th><br><td>3</td><br><td>4</td><br><td>5</td><br></tr><br><tr><br><th>1</th><br><th>b</th><br><td>6</td><br><td>7</td><br><td>8</td><br></tr><br><tr><br><th>2</th><br><th>b</th><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sortlevel(<span class="number">1</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr><br><th></th><br><th>state</th><br><th colspan="2" halign="left">Ohio</th><br><th>Colorado</th><br></tr><br><tr><br><th></th><br><th>color</th><br><th>Green</th><br><th>Red</th><br><th>Green</th><br></tr><br><tr><br><th>key1</th><br><th>key2</th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>a</th><br><th>1</th><br><td>0</td><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>b</th><br><th>1</th><br><td>6</td><br><td>7</td><br><td>8</td><br></tr><br><tr><br><th>a</th><br><th>2</th><br><td>3</td><br><td>4</td><br><td>5</td><br></tr><br><tr><br><th>b</th><br><th>2</th><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.swaplevel(<span class="number">0</span>, <span class="number">1</span>).sortlevel(<span class="number">0</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr><br><th></th><br><th>state</th><br><th colspan="2" halign="left">Ohio</th><br><th>Colorado</th><br></tr><br><tr><br><th></th><br><th>color</th><br><th>Green</th><br><th>Red</th><br><th>Green</th><br></tr><br><tr><br><th>key2</th><br><th>key1</th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="2" valign="top">1</th><br><th>a</th><br><td>0</td><br><td>1</td><br><td>2</td><br></tr><br><tr><br><th>b</th><br><td>6</td><br><td>7</td><br><td>8</td><br></tr><br><tr><br><th rowspan="2" valign="top">2</th><br><th>a</th><br><td>3</td><br><td>4</td><br><td>5</td><br></tr><br><tr><br><th>b</th><br><td>9</td><br><td>10</td><br><td>11</td><br></tr><br><br></tbody><br></table><br></div><h3 id="根据级别汇总统计"><a href="#根据级别汇总统计" class="headerlink" title="根据级别汇总统计"></a>根据级别汇总统计</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sum(level=<span class="string">'key2'</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr><br><th>state</th><br><th colspan="2" halign="left">Ohio</th><br><th>Colorado</th><br></tr><br><tr><br><th>color</th><br><th>Green</th><br><th>Red</th><br><th>Green</th><br></tr><br><tr><br><th>key2</th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>1</th><br><td>6</td><br><td>8</td><br><td>10</td><br></tr><br><tr><br><th>2</th><br><td>12</td><br><td>14</td><br><td>16</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.sum(level=<span class="string">'color'</span>, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>color</th><br><th>Green</th><br><th>Red</th><br></tr><br><tr><br><th>key1</th><br><th>key2</th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="2" valign="top">a</th><br><th>1</th><br><td>2</td><br><td>1</td><br></tr><br><tr><br><th>2</th><br><td>8</td><br><td>4</td><br></tr><br><tr><br><th rowspan="2" valign="top">b</th><br><th>1</th><br><td>14</td><br><td>7</td><br></tr><br><tr><br><th>2</th><br><td>20</td><br><td>10</td><br></tr><br><br></tbody><br></table><br></div><h3 id="使用DataFrame的列"><a href="#使用DataFrame的列" class="headerlink" title="使用DataFrame的列"></a>使用DataFrame的列</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(&#123;<span class="string">'a'</span>: range(<span class="number">7</span>), <span class="string">'b'</span>: range(<span class="number">7</span>, <span class="number">0</span>, <span class="number">-1</span>),</div><div class="line">                   <span class="string">'c'</span>: [<span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'two'</span>, <span class="string">'two'</span>, <span class="string">'two'</span>],</div><div class="line">                   <span class="string">'d'</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;)</div><div class="line">frame</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>0</td><br><td>7</td><br><td>one</td><br><td>0</td><br></tr><br><tr><br><th>1</th><br><td>1</td><br><td>6</td><br><td>one</td><br><td>1</td><br></tr><br><tr><br><th>2</th><br><td>2</td><br><td>5</td><br><td>one</td><br><td>2</td><br></tr><br><tr><br><th>3</th><br><td>3</td><br><td>4</td><br><td>two</td><br><td>0</td><br></tr><br><tr><br><th>4</th><br><td>4</td><br><td>3</td><br><td>two</td><br><td>1</td><br></tr><br><tr><br><th>5</th><br><td>5</td><br><td>2</td><br><td>two</td><br><td>2</td><br></tr><br><tr><br><th>6</th><br><td>6</td><br><td>1</td><br><td>two</td><br><td>3</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame2 = frame.set_index([<span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">frame2</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th></th><br><th>a</th><br><th>b</th><br></tr><br><tr><br><th>c</th><br><th>d</th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="3" valign="top">one</th><br><th>0</th><br><td>0</td><br><td>7</td><br></tr><br><tr><br><th>1</th><br><td>1</td><br><td>6</td><br></tr><br><tr><br><th>2</th><br><td>2</td><br><td>5</td><br></tr><br><tr><br><th rowspan="4" valign="top">two</th><br><th>0</th><br><td>3</td><br><td>4</td><br></tr><br><tr><br><th>1</th><br><td>4</td><br><td>3</td><br></tr><br><tr><br><th>2</th><br><td>5</td><br><td>2</td><br></tr><br><tr><br><th>3</th><br><td>6</td><br><td>1</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame.set_index([<span class="string">'c'</span>, <span class="string">'d'</span>], drop=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th></th><br><th>a</th><br><th>b</th><br><th>c</th><br><th>d</th><br></tr><br><tr><br><th>c</th><br><th>d</th><br><th></th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="3" valign="top">one</th><br><th>0</th><br><td>0</td><br><td>7</td><br><td>one</td><br><td>0</td><br></tr><br><tr><br><th>1</th><br><td>1</td><br><td>6</td><br><td>one</td><br><td>1</td><br></tr><br><tr><br><th>2</th><br><td>2</td><br><td>5</td><br><td>one</td><br><td>2</td><br></tr><br><tr><br><th rowspan="4" valign="top">two</th><br><th>0</th><br><td>3</td><br><td>4</td><br><td>two</td><br><td>0</td><br></tr><br><tr><br><th>1</th><br><td>4</td><br><td>3</td><br><td>two</td><br><td>1</td><br></tr><br><tr><br><th>2</th><br><td>5</td><br><td>2</td><br><td>two</td><br><td>2</td><br></tr><br><tr><br><th>3</th><br><td>6</td><br><td>1</td><br><td>two</td><br><td>3</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">frame2.reset_index()</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>c</th><br><th>d</th><br><th>a</th><br><th>b</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>0</th><br><td>one</td><br><td>0</td><br><td>0</td><br><td>7</td><br></tr><br><tr><br><th>1</th><br><td>one</td><br><td>1</td><br><td>1</td><br><td>6</td><br></tr><br><tr><br><th>2</th><br><td>one</td><br><td>2</td><br><td>2</td><br><td>5</td><br></tr><br><tr><br><th>3</th><br><td>two</td><br><td>0</td><br><td>3</td><br><td>4</td><br></tr><br><tr><br><th>4</th><br><td>two</td><br><td>1</td><br><td>4</td><br><td>3</td><br></tr><br><tr><br><th>5</th><br><td>two</td><br><td>2</td><br><td>5</td><br><td>2</td><br></tr><br><tr><br><th>6</th><br><td>two</td><br><td>3</td><br><td>6</td><br><td>1</td><br></tr><br><br></tbody><br></table><br></div><h2 id="拓展话题"><a href="#拓展话题" class="headerlink" title="拓展话题"></a>拓展话题</h2><h3 id="整数索引"><a href="#整数索引" class="headerlink" title="整数索引"></a>整数索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ser = Series(np.arange(<span class="number">3.</span>))</div><div class="line">ser.iloc[<span class="number">-1</span>]</div></pre></td></tr></table></figure><pre><code>2.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ser</div></pre></td></tr></table></figure><pre><code>0    0.0
1    1.0
2    2.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ser2 = Series(np.arange(<span class="number">3.</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">ser2[<span class="number">-1</span>]</div></pre></td></tr></table></figure><pre><code>2.0
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ser.ix[:<span class="number">1</span>]</div></pre></td></tr></table></figure><pre><code>0    0.0
1    1.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ser3 = Series(range(<span class="number">3</span>), index=[<span class="number">-5</span>, <span class="number">1</span>, <span class="number">3</span>])</div><div class="line">ser3.iloc[<span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>2
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">6</span>).reshape((<span class="number">3</span>, <span class="number">2</span>)), index=[<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>])</div><div class="line">frame</div><div class="line">frame.iloc[<span class="number">0</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>0</th><br><th>1</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2</th><br><td>0</td><br><td>1</td><br></tr><br><tr><br><th>0</th><br><td>2</td><br><td>3</td><br></tr><br><tr><br><th>1</th><br><td>4</td><br><td>5</td><br></tr><br><br></tbody><br></table><br></div><pre><code>0    0
1    1
Name: 2, dtype: int32
</code></pre><h3 id="面板数据"><a href="#面板数据" class="headerlink" title="面板数据"></a>面板数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas_datareader.data <span class="keyword">as</span> web</div><div class="line"></div><div class="line">pdata = pd.Panel(dict((stk, web.get_data_yahoo(stk))</div><div class="line">                       <span class="keyword">for</span> stk <span class="keyword">in</span> [<span class="string">'AAPL'</span>, <span class="string">'GOOG'</span>, <span class="string">'MSFT'</span>, <span class="string">'DELL'</span>]))</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pdata</div></pre></td></tr></table></figure><pre><code>&lt;class &apos;pandas.core.panel.Panel&apos;&gt;
Dimensions: 4 (items) x 1820 (major_axis) x 6 (minor_axis)
Items axis: AAPL to MSFT
Major_axis axis: 2010-01-04 00:00:00 to 2017-02-27 00:00:00
Minor_axis axis: Open to Adj Close
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pdata = pdata.swapaxes(<span class="string">'items'</span>, <span class="string">'minor'</span>)</div><div class="line">pdata[<span class="string">'Adj Close'</span>].iloc[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>AAPL</th><br><th>DELL</th><br><th>GOOG</th><br><th>MSFT</th><br></tr><br><tr><br><th>Date</th><br><th></th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2010-01-04</th><br><td>27.727039</td><br><td>14.06528</td><br><td>313.062468</td><br><td>25.555485</td><br></tr><br><tr><br><th>2010-01-05</th><br><td>27.774976</td><br><td>14.38450</td><br><td>311.683844</td><br><td>25.563741</td><br></tr><br><tr><br><th>2010-01-06</th><br><td>27.333178</td><br><td>14.10397</td><br><td>303.826685</td><br><td>25.406859</td><br></tr><br><tr><br><th>2010-01-07</th><br><td>27.282650</td><br><td>14.23940</td><br><td>296.753749</td><br><td>25.142634</td><br></tr><br><tr><br><th>2010-01-08</th><br><td>27.464034</td><br><td>14.36516</td><br><td>300.709808</td><br><td>25.316031</td><br></tr><br><tr><br><th>2010-01-11</th><br><td>27.221758</td><br><td>14.37483</td><br><td>300.255255</td><br><td>24.994007</td><br></tr><br><tr><br><th>2010-01-12</th><br><td>26.912110</td><br><td>14.56830</td><br><td>294.945572</td><br><td>24.828866</td><br></tr><br><tr><br><th>2010-01-13</th><br><td>27.291720</td><br><td>14.57797</td><br><td>293.252243</td><br><td>25.060064</td><br></tr><br><tr><br><th>2010-01-14</th><br><td>27.133657</td><br><td>14.22005</td><br><td>294.630868</td><br><td>25.563741</td><br></tr><br><tr><br><th>2010-01-15</th><br><td>26.680198</td><br><td>13.92985</td><br><td>289.710772</td><br><td>25.481172</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pdata.ix[:, <span class="string">'6/1/2012'</span>, :]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Open</th><br><th>High</th><br><th>Low</th><br><th>Close</th><br><th>Volume</th><br><th>Adj Close</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>AAPL</th><br><td>569.159996</td><br><td>572.650009</td><br><td>560.520012</td><br><td>560.989983</td><br><td>130246900.0</td><br><td>72.681610</td><br></tr><br><tr><br><th>DELL</th><br><td>12.150000</td><br><td>12.300000</td><br><td>12.045000</td><br><td>12.070000</td><br><td>19397600.0</td><br><td>11.675920</td><br></tr><br><tr><br><th>GOOG</th><br><td>571.790972</td><br><td>572.650996</td><br><td>568.350996</td><br><td>570.981000</td><br><td>6138700.0</td><br><td>285.205295</td><br></tr><br><tr><br><th>MSFT</th><br><td>28.760000</td><br><td>28.959999</td><br><td>28.440001</td><br><td>28.450001</td><br><td>56634300.0</td><br><td>24.942239</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pdata.ix[<span class="string">'Adj Close'</span>, <span class="string">'5/22/2012'</span>:, :].iloc[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>AAPL</th><br><th>DELL</th><br><th>GOOG</th><br><th>MSFT</th><br></tr><br><tr><br><th>Date</th><br><th></th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>2012-05-22</th><br><td>72.160786</td><br><td>14.58765</td><br><td>300.100412</td><br><td>26.090721</td><br></tr><br><tr><br><th>2012-05-23</th><br><td>73.921494</td><br><td>12.08221</td><br><td>304.426106</td><br><td>25.520864</td><br></tr><br><tr><br><th>2012-05-24</th><br><td>73.242607</td><br><td>12.04351</td><br><td>301.528978</td><br><td>25.485795</td><br></tr><br><tr><br><th>2012-05-25</th><br><td>72.850038</td><br><td>12.05319</td><br><td>295.470050</td><br><td>25.477028</td><br></tr><br><tr><br><th>2012-05-28</th><br><td>NaN</td><br><td>12.05319</td><br><td>NaN</td><br><td>NaN</td><br></tr><br><tr><br><th>2012-05-29</th><br><td>74.143041</td><br><td>12.24666</td><br><td>296.873645</td><br><td>25.915380</td><br></tr><br><tr><br><th>2012-05-30</th><br><td>75.037005</td><br><td>12.14992</td><br><td>293.821674</td><br><td>25.722505</td><br></tr><br><tr><br><th>2012-05-31</th><br><td>74.850442</td><br><td>11.92743</td><br><td>290.140354</td><br><td>25.591000</td><br></tr><br><tr><br><th>2012-06-01</th><br><td>72.681610</td><br><td>11.67592</td><br><td>285.205295</td><br><td>24.942239</td><br></tr><br><tr><br><th>2012-06-04</th><br><td>73.109156</td><br><td>11.60821</td><br><td>289.006480</td><br><td>25.029908</td><br></tr><br><br></tbody><br></table><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">stacked = pdata.ix[:, <span class="string">'5/30/2012'</span>:, :].to_frame()</div><div class="line">stacked</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th></th><br><th>Open</th><br><th>High</th><br><th>Low</th><br><th>Close</th><br><th>Volume</th><br><th>Adj Close</th><br></tr><br><tr><br><th>Date</th><br><th>minor</th><br><th></th><br><th></th><br><th></th><br><th></th><br><th></th><br><th></th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th rowspan="4" valign="top">2012-05-30</th><br><th>AAPL</th><br><td>569.199997</td><br><td>579.989990</td><br><td>566.559990</td><br><td>579.169998</td><br><td>132357400.0</td><br><td>75.037005</td><br></tr><br><tr><br><th>DELL</th><br><td>12.590000</td><br><td>12.700000</td><br><td>12.460000</td><br><td>12.560000</td><br><td>19787800.0</td><br><td>12.149920</td><br></tr><br><tr><br><th>GOOG</th><br><td>588.161028</td><br><td>591.901014</td><br><td>583.530999</td><br><td>588.230992</td><br><td>3827600.0</td><br><td>293.821674</td><br></tr><br><tr><br><th>MSFT</th><br><td>29.350000</td><br><td>29.480000</td><br><td>29.120001</td><br><td>29.340000</td><br><td>41585500.0</td><br><td>25.722505</td><br></tr><br><tr><br><th rowspan="4" valign="top">2012-05-31</th><br><th>AAPL</th><br><td>580.740021</td><br><td>581.499985</td><br><td>571.460022</td><br><td>577.730019</td><br><td>122918600.0</td><br><td>74.850442</td><br></tr><br><tr><br><th>DELL</th><br><td>12.530000</td><br><td>12.540000</td><br><td>12.330000</td><br><td>12.330000</td><br><td>19955600.0</td><br><td>11.927430</td><br></tr><br><tr><br><th>GOOG</th><br><td>588.720982</td><br><td>590.001032</td><br><td>579.001013</td><br><td>580.860990</td><br><td>5958800.0</td><br><td>290.140354</td><br></tr><br><tr><br><th>MSFT</th><br><td>29.299999</td><br><td>29.420000</td><br><td>28.940001</td><br><td>29.190001</td><br><td>39134000.0</td><br><td>25.591000</td><br></tr><br><tr><br><th rowspan="4" valign="top">2012-06-01</th><br><th>AAPL</th><br><td>569.159996</td><br><td>572.650009</td><br><td>560.520012</td><br><td>560.989983</td><br><td>130246900.0</td><br><td>72.681610</td><br></tr><br><tr><br><th>DELL</th><br><td>12.150000</td><br><td>12.300000</td><br><td>12.045000</td><br><td>12.070000</td><br><td>19397600.0</td><br><td>11.675920</td><br></tr><br><tr><br><th>GOOG</th><br><td>571.790972</td><br><td>572.650996</td><br><td>568.350996</td><br><td>570.981000</td><br><td>6138700.0</td><br><td>285.205295</td><br></tr><br><tr><br><th>MSFT</th><br><td>28.760000</td><br><td>28.959999</td><br><td>28.440001</td><br><td>28.450001</td><br><td>56634300.0</td><br><td>24.942239</td><br></tr><br><tr><br><th rowspan="4" valign="top">2012-06-04</th><br><th>AAPL</th><br><td>561.500008</td><br><td>567.499985</td><br><td>548.499977</td><br><td>564.289978</td><br><td>139248900.0</td><br><td>73.109156</td><br></tr><br><tr><br><th>DELL</th><br><td>12.110000</td><br><td>12.112500</td><br><td>11.800000</td><br><td>12.000000</td><br><td>17015700.0</td><br><td>11.608210</td><br></tr><br><tr><br><th>GOOG</th><br><td>570.220958</td><br><td>580.491016</td><br><td>570.011006</td><br><td>578.590973</td><br><td>4883500.0</td><br><td>289.006480</td><br></tr><br><tr><br><th>MSFT</th><br><td>28.620001</td><br><td>28.780001</td><br><td>28.320000</td><br><td>28.549999</td><br><td>47926300.0</td><br><td>25.029908</td><br></tr><br><tr><br><th rowspan="4" valign="top">2012-06-05</th><br><th>AAPL</th><br><td>561.269989</td><br><td>566.470001</td><br><td>558.330002</td><br><td>562.830025</td><br><td>97053600.0</td><br><td>72.920005</td><br></tr><br><tr><br><th>DELL</th><br><td>11.950000</td><br><td>12.240000</td><br><td>11.950000</td><br><td>12.160000</td><br><td>15620900.0</td><br><td>11.762980</td><br></tr><br><tr><br><th>GOOG</th><br><td>575.451008</td><br><td>578.131003</td><br><td>566.470986</td><br><td>570.410999</td><br><td>4697200.0</td><br><td>284.920579</td><br></tr><br><tr><br><th>MSFT</th><br><td>28.510000</td><br><td>28.750000</td><br><td>28.389999</td><br><td>28.510000</td><br><td>45715400.0</td><br><td>24.994841</td><br></tr><br><tr><br><th rowspan="4" valign="top">2012-06-06</th><br><th>AAPL</th><br><td>567.770004</td><br><td>573.849983</td><br><td>565.499992</td><br><td>571.460022</td><br><td>100363900.0</td><br><td>74.038104</td><br></tr><br><tr><br><th>DELL</th><br><td>12.210000</td><br><td>12.280000</td><br><td>12.090000</td><br><td>12.215000</td><br><td>20779900.0</td><br><td>11.816190</td><br></tr><br><tr><br><th>GOOG</th><br><td>576.480979</td><br><td>581.970971</td><br><td>573.611004</td><br><td>580.570966</td><br><td>4207200.0</td><br><td>289.995487</td><br></tr><br><tr><br><th>MSFT</th><br><td>28.879999</td><br><td>29.370001</td><br><td>28.809999</td><br><td>29.350000</td><br><td>46860500.0</td><br><td>25.731273</td><br></tr><br><tr><br><th rowspan="4" valign="top">2012-06-07</th><br><th>AAPL</th><br><td>577.290009</td><br><td>577.320023</td><br><td>570.500000</td><br><td>571.720001</td><br><td>94941700.0</td><br><td>74.071787</td><br></tr><br><tr><br><th>DELL</th><br><td>12.320000</td><br><td>12.410000</td><br><td>12.120000</td><br><td>12.130000</td><br><td>20074000.0</td><br><td>11.733960</td><br></tr><br><tr><br><th>GOOG</th><br><td>587.601014</td><br><td>587.891038</td><br><td>577.251006</td><br><td>578.230986</td><br><td>3530100.0</td><br><td>288.826666</td><br></tr><br><tr><br><th>MSFT</th><br><td>29.639999</td><br><td>29.700001</td><br><td>29.170000</td><br><td>29.230000</td><br><td>37792800.0</td><br><td>25.626067</td><br></tr><br><tr><br><th rowspan="2" valign="top">2012-06-08</th><br><th>AAPL</th><br><td>571.599998</td><br><td>580.580017</td><br><td>568.999992</td><br><td>580.319984</td><br><td>86879100.0</td><br><td>75.185997</td><br></tr><br><tr><br><th>DELL</th><br><td>12.130000</td><br><td>12.225000</td><br><td>12.020000</td><br><td>12.120000</td><br><td>18155600.0</td><br><td>11.724290</td><br></tr><br><tr><br><th>…</th><br><th>…</th><br><td>…</td><br><td>…</td><br><td>…</td><br><td>…</td><br><td>…</td><br><td>…</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-13</th><br><th>AAPL</th><br><td>133.080002</td><br><td>133.820007</td><br><td>132.750000</td><br><td>133.289993</td><br><td>23035400.0</td><br><td>133.289993</td><br></tr><br><tr><br><th>GOOG</th><br><td>816.000000</td><br><td>820.958984</td><br><td>815.489990</td><br><td>819.239990</td><br><td>1198100.0</td><br><td>819.239990</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.239998</td><br><td>64.860001</td><br><td>64.129997</td><br><td>64.720001</td><br><td>22920100.0</td><br><td>64.330000</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-14</th><br><th>AAPL</th><br><td>133.470001</td><br><td>135.089996</td><br><td>133.250000</td><br><td>135.020004</td><br><td>32815500.0</td><br><td>135.020004</td><br></tr><br><tr><br><th>GOOG</th><br><td>819.000000</td><br><td>823.000000</td><br><td>816.000000</td><br><td>820.450012</td><br><td>1053600.0</td><br><td>820.450012</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.410004</td><br><td>64.720001</td><br><td>64.019997</td><br><td>64.570000</td><br><td>23065900.0</td><br><td>64.570000</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-15</th><br><th>AAPL</th><br><td>135.520004</td><br><td>136.270004</td><br><td>134.619995</td><br><td>135.509995</td><br><td>35501600.0</td><br><td>135.509995</td><br></tr><br><tr><br><th>GOOG</th><br><td>819.359985</td><br><td>823.000000</td><br><td>818.469971</td><br><td>818.979980</td><br><td>1304000.0</td><br><td>818.979980</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.500000</td><br><td>64.570000</td><br><td>64.160004</td><br><td>64.529999</td><br><td>16917000.0</td><br><td>64.529999</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-16</th><br><th>AAPL</th><br><td>135.669998</td><br><td>135.899994</td><br><td>134.839996</td><br><td>135.350006</td><br><td>22118000.0</td><br><td>135.350006</td><br></tr><br><tr><br><th>GOOG</th><br><td>819.929993</td><br><td>824.400024</td><br><td>818.979980</td><br><td>824.159973</td><br><td>1281700.0</td><br><td>824.159973</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.739998</td><br><td>65.239998</td><br><td>64.440002</td><br><td>64.519997</td><br><td>20524700.0</td><br><td>64.519997</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-17</th><br><th>AAPL</th><br><td>135.100006</td><br><td>135.830002</td><br><td>135.100006</td><br><td>135.720001</td><br><td>22084500.0</td><br><td>135.720001</td><br></tr><br><tr><br><th>GOOG</th><br><td>823.020020</td><br><td>828.070007</td><br><td>821.655029</td><br><td>828.070007</td><br><td>1597800.0</td><br><td>828.070007</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.470001</td><br><td>64.690002</td><br><td>64.300003</td><br><td>64.620003</td><br><td>21234600.0</td><br><td>64.620003</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-21</th><br><th>AAPL</th><br><td>136.229996</td><br><td>136.750000</td><br><td>135.979996</td><br><td>136.699997</td><br><td>24265100.0</td><br><td>136.699997</td><br></tr><br><tr><br><th>GOOG</th><br><td>828.659973</td><br><td>833.450012</td><br><td>828.349976</td><br><td>831.659973</td><br><td>1247700.0</td><br><td>831.659973</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.610001</td><br><td>64.949997</td><br><td>64.449997</td><br><td>64.489998</td><br><td>19384900.0</td><br><td>64.489998</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-22</th><br><th>AAPL</th><br><td>136.429993</td><br><td>137.119995</td><br><td>136.110001</td><br><td>137.110001</td><br><td>20745300.0</td><br><td>137.110001</td><br></tr><br><tr><br><th>GOOG</th><br><td>828.659973</td><br><td>833.250000</td><br><td>828.640015</td><br><td>830.760010</td><br><td>982900.0</td><br><td>830.760010</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.330002</td><br><td>64.389999</td><br><td>64.050003</td><br><td>64.360001</td><br><td>19259700.0</td><br><td>64.360001</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-23</th><br><th>AAPL</th><br><td>137.380005</td><br><td>137.479996</td><br><td>136.300003</td><br><td>136.529999</td><br><td>20704100.0</td><br><td>136.529999</td><br></tr><br><tr><br><th>GOOG</th><br><td>830.119995</td><br><td>832.460022</td><br><td>822.880005</td><br><td>831.330017</td><br><td>1470100.0</td><br><td>831.330017</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.419998</td><br><td>64.730003</td><br><td>64.190002</td><br><td>64.620003</td><br><td>20235200.0</td><br><td>64.620003</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-24</th><br><th>AAPL</th><br><td>135.910004</td><br><td>136.660004</td><br><td>135.279999</td><br><td>136.660004</td><br><td>21690900.0</td><br><td>136.660004</td><br></tr><br><tr><br><th>GOOG</th><br><td>827.729980</td><br><td>829.000000</td><br><td>824.200012</td><br><td>828.640015</td><br><td>1386600.0</td><br><td>828.640015</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.529999</td><br><td>64.800003</td><br><td>64.139999</td><br><td>64.620003</td><br><td>21705200.0</td><br><td>64.620003</td><br></tr><br><tr><br><th rowspan="3" valign="top">2017-02-27</th><br><th>AAPL</th><br><td>137.139999</td><br><td>137.440002</td><br><td>136.279999</td><br><td>136.929993</td><br><td>20196400.0</td><br><td>136.929993</td><br></tr><br><tr><br><th>GOOG</th><br><td>824.549988</td><br><td>830.500000</td><br><td>824.000000</td><br><td>829.280029</td><br><td>1099500.0</td><br><td>829.280029</td><br></tr><br><tr><br><th>MSFT</th><br><td>64.540001</td><br><td>64.540001</td><br><td>64.050003</td><br><td>64.230003</td><br><td>15850400.0</td><br><td>64.230003</td><br></tr><br><br></tbody><br></table><br><p>3952 rows × 6 columns</p><br></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">stacked.to_panel()</div></pre></td></tr></table></figure><pre><code>&lt;class &apos;pandas.core.panel.Panel&apos;&gt;
Dimensions: 6 (items) x 1207 (major_axis) x 4 (minor_axis)
Items axis: Open to Adj Close
Major_axis axis: 2012-05-30 00:00:00 to 2017-02-27 00:00:00
Minor_axis axis: AAPL to MSFT
</code></pre></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/24/Correlation-Analysis/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracadabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracadabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/2017/02/24/Correlation-Analysis/" itemprop="url">Correlation Analysis</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-24T10:22:42+08:00">2017-02-24 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/02/24/Correlation-Analysis/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2017/02/24/Correlation-Analysis/" itemprop="commentsCount"></span> </a></span><span id="/2017/02/24/Correlation-Analysis/" class="leancloud_visitors" data-flag-title="Correlation Analysis"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>最近有一个关于关联分析的小作业，问题描述如下：</p><p>孩子的情感状况、品行症状、亲社会行为等等与很多因素相关，这个作业主要着眼点在于孩子每天看视频的时间是否对于以上这些指标有着重要的影响，因此需要对输入特征与输出标签之间的相关关系做一个分析。</p><p>属性描述如下：</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/features.png" alt="features"></p><p>由以上属性描述表可以看出，属性类型同时包括类别以及数值，因此进行相关分析时针对这两种情况需要采用不同的方法，这里采用的策略如下：</p><ol><li>对于离散-离散的情况，采用卡方检验</li><li>对于连续-离散的情况，采用ANOVA方差检验</li></ol><p>下面对于这两种检验方法进行介绍。</p><h1 id="卡方检验"><a href="#卡方检验" class="headerlink" title="卡方检验"></a>卡方检验</h1><h2 id="一维情况"><a href="#一维情况" class="headerlink" title="一维情况"></a>一维情况</h2><p>假设一条河里有三种鱼，gumpies, sticklebarbs, 以及spotheads。如果这条河的生态环境没有遭到干扰，那么这三种鱼的数量是相等的（下表第三行）。现在从河里进行300次抽样，最后抽样得到的结果如下表第二行所示：</p><table><thead><tr><th></th><th>gumpies</th><th>sticklebarbs</th><th>spothheads</th><th>Totals</th></tr></thead><tbody><tr><td>观察到的频数</td><td>89</td><td>120</td><td>91</td><td>300</td></tr><tr><td>期望的频数</td><td>100</td><td>100</td><td>100</td><td>300</td></tr></tbody></table><p>现在需要解决的问题是，是否这条河的生态环境收到了干扰？我们假设生态环境正常，这是我们的原假设。</p><p>（注意，期望的频数是根据实际情况自行定义的）</p><p>很容易想到的是，我们可以建立一种度量来衡量现实情况与原假设的偏离程度，例如：</p><p>$$\frac{观察值 - 期望值}{期望值}$$</p><p>把实际的数据带入，可以得到以下的结果：</p><p>gumpies: $\frac{89 - 100}{100} = -0.11$</p><p>sticklebarbs: $\frac{120 - 100}{100} = +0.20$</p><p>spothheads: $\frac{91 - 100}{100} = -0.09$</p><p>发现结果还不错，但是这只能用来衡量单个类别的偏差程度，而不能用来衡量整体的偏差程度，因为这三者的加和为零。既然这样，很容易想到可以对之前的度量进行简单的修改，变成这样：</p><p>$$\frac{(观察值 - 期望值)^2}{期望值}$$</p><p>再把数据带入看看：</p><p>gumpies: $\frac{(89 - 100)^2}{100} = 1.21$</p><p>sticklebarbs: $\frac{(120 - 100)^2}{100} = 4.0$</p><p>spothheads: $\frac{(91 - 100)}{100} = 0.81$</p><p>sum: $1.21 + 4.0 + 0.81 = 6.02$</p><p>这样一来问题便得到了解决，而这也正是卡方检验所采取的方式。而这个sum值就是卡方（chi-square），记作$\chi^2$， 为了更加形式化地表示，我们把观察值记为$O$， 期望值记为$E$， 那么有如下等式成立：</p><p>$$\chi^2 = \sum \frac{(O - E) ^ 2}{E}$$</p><p>下面的问题是，我们达到了卡方值，但是这个值到底好还是不好呢？是更加支持原假设还是拒绝原假设呢？</p><p>可以设想这样一种情况，我们假设河里的鱼服从原假设的分布，也就是三种鱼出现的概率相等。然后我们把三百次采样看作一次实验，每一次实验完毕之后记录下采样出的300条鱼中每一种鱼的频数，然后计算卡方值。在进行很多次这样的实验之后，我们可以画一个柱状图，这个图记录下了卡方值的分布情况。然后再把实际的观察值（也就是上面表格的第二行）计算的卡方值（6.02）带入进去，看看大于或者等于这个值在柱状图中所有卡方值中占有多少比例。如果占有的比例很大，说明这个值是由跟原假设很近似的假设得出的，这就证明了原假设是对的；反之。如果这个比例很小，说明如果分布服从原假设，那么所计算出的卡方值基本不可能包含这个观测出的卡方值，表明原假设是不对的，我们就可以拒绝原假设。</p><p>其实统计检验的基本思想就是这样。但是存在一个问题，我们不可能进行真实的采样（从河里抓鱼），所以一般采用计算机模拟的方式，具体步骤如下所示：</p><ol><li>等概率的产生a（代表gumpies）, b（代表sticklebarbs）, c（代表spothheads）的序列</li><li>计算一个大小为300的序列中a, b, c三者的频数，作为观察值，然后将a = b = c = 100作为期望值，计算并记录下算出的卡方值</li><li>重复1~2步10000次， 画出柱状图如下：</li></ol><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/chi-square-distribution.gif" alt="chi-square-distribution"></p><p>可以看出只有5%左右的值大于6.02，说明我们可以以95%的置信度拒绝原假设。</p><h2 id="二维情况"><a href="#二维情况" class="headerlink" title="二维情况"></a>二维情况</h2><p>对于二维的情况，卡方检验又被称为卡方关联度检验，也就是检验两个变量之间的相关程度（独立程度），考虑下面这个数据表$O$：</p><table><thead><tr><th></th><th></th><th>Alzhemer’s onset -</th><th>during 5-year period</th><th></th></tr></thead><tbody><tr><td></td><td></td><td>no</td><td>yes</td><td></td></tr><tr><td>recieved-</td><td>yes</td><td>147</td><td>9</td><td>156</td></tr><tr><td>estrogen</td><td>no</td><td>810</td><td>158</td><td>968</td></tr><tr><td></td><td></td><td>957</td><td>167</td><td>1124</td></tr></tbody></table><p>这是观察值，为了计算卡方值，很明显我们需要计算期望值。</p><p>为了方便表示，把上表变成如下形式：</p><table><thead><tr><th></th><th></th><th>（A）Alzhemer’s onset -</th><th>during 5-year period</th><th></th></tr></thead><tbody><tr><td></td><td></td><td>no</td><td>yes</td><td></td></tr><tr><td>(R) recieved-</td><td>yes</td><td>[cell a]</td><td>[cell b]</td><td>156</td></tr><tr><td>estrogen</td><td>no</td><td>[cell c]</td><td>[cell d]</td><td>968</td></tr><tr><td></td><td></td><td>957</td><td>167</td><td>1124</td></tr></tbody></table><p>拿a做例子：</p><p>$$E_a = \frac{156}{1124} \times \frac{957}{1124} \times 1124$$</p><p>这个式子如何解释呢？如果这两个变量是独立的，那么$A$变量取$no$值与$R$变量取$yes$值这两个事件之间就是独立的，那么$[cell_a]$事件发生的概率就是两者相乘，也就是上述等式右边前两个数相乘，最后的期望值自然就是概率乘以实验总数。</p><p>上面的解释比较不正式，换一种较为正式的表达方式。假设我们要求$cell$的期望值，设$R$为$cell$所在列的边缘事件总数，$C$为$cell$所在行的边缘事件总数，$N$为实验总数目，这样就有：</p><p>$$E_{cell} =\frac{R}{N} \times \frac{C}{N} \times N$$</p><p>所以就有期望值$E$数据表如下：</p><table><thead><tr><th></th><th></th><th>（A）Alzhemer’s onset -</th><th>during 5-year period</th><th></th></tr></thead><tbody><tr><td></td><td></td><td>no</td><td>yes</td><td></td></tr><tr><td>(R) recieved-</td><td>yes</td><td>$E_a = \frac{156 \times 957}{1124} = 132.82$</td><td>$E_b = \frac{156 \times 167}{1124} = 23.18$</td><td>156</td></tr><tr><td>estrogen</td><td>no</td><td>$E_c = \frac{968 \times 957}{1124} = 824.18$</td><td>$E_d = \frac{968 \times 167}{1124} = 143.82$</td><td>968</td></tr><tr><td></td><td></td><td>957</td><td>167</td><td>1124</td></tr></tbody></table><p>这样就可以调用公式：</p><p>$$\chi^2 = \sum \frac{(O - E) ^ 2}{E}$$</p><p>特别地，当行数以及列数都为2时，上述公式需要进行一下修改：</p><p>$$\chi^2 = \sum \frac{(|O - E| - 0.5) ^ 2}{E}$$</p><p>这样算出来的卡方值为$11.01$</p><p>最后涉及到自由度的问题，因为比较简单，所以只写出结论：</p><p>$$df = (r - 1)(c - 1)$$</p><p><strong>r = number of rows</strong></p><p><strong>c = number of columns</strong></p><h1 id="ANOVA方差检验"><a href="#ANOVA方差检验" class="headerlink" title="ANOVA方差检验"></a>ANOVA方差检验</h1><p>为了方便比较，同样采用上述阿尔兹海默病的例子。研究表明，老年痴呆症患者患病之后会经常经历情绪非常不稳定地阶段，原因是因为患者患病之前的生活中经常有恐惧或者焦虑的体验，正是这些一直存在于脑海中的记忆出发了患病后的不稳定情绪的产生。</p><p>现在我们假设有一个实验团队发明了一种药物，可以缓解这种情绪问题，他们对小白鼠进行了实验。实验设计如下：</p><ol><li>将小白鼠随机分为四组A， B， C， D</li><li>A组作为参照组，不给药；B， C， D三组分别注射一个单位，两个单位，三个单位的药剂</li><li>记录实验结果，数值越低表明实验效果越好</li></ol><p>实验结果如下：</p><table><thead><tr><th>A</th><th>B</th><th>C</th><th>D</th><th>Total</th></tr></thead><tbody><tr><td>27.0</td><td>22.8</td><td>21.9</td><td>23.5</td><td></td></tr><tr><td>26.2</td><td>23.1</td><td>23.4</td><td>19.6</td><td></td></tr><tr><td>28.8</td><td>27.7</td><td>20.1</td><td>23.7</td><td></td></tr><tr><td>33.5</td><td>27.6</td><td>27.8</td><td>20.8</td><td></td></tr><tr><td>28.8</td><td>24.0</td><td>19.3</td><td>23.9</td><td></td></tr><tr><td>$M_a = 28.86$</td><td>$M_b = 25.04$</td><td>$M_c = 22.50$</td><td>$M_d = 22.30$</td><td>$M_T = 24.68$</td></tr></tbody></table><p>下面需要进行一下相关性分析，判断药物是否对症状的缓解产生作用。</p><p>和卡方检验一样，ANOVA检验最后也有一个衡量指标，记为$F$，定义如下：</p><p>$$F = \frac{MS_{bg}}{MS_{wg}} = \frac{组间相似度}{组内相似度}$$</p><p>具体的计算步骤如下所示（推导过程省略）</p><p>（1） 首先计算出如下值：</p><table><thead><tr><th>A</th><th>B</th><th>C</th><th>D</th><th>Total</th></tr></thead><tbody><tr><td>$N_A = 5$</td><td>$N_B = 5$</td><td>$N_C = 5$</td><td>$N_D = 5$</td><td>$N_T = 20$</td></tr><tr><td>$\sum X_{Ai} = 144.30$</td><td>$\sum X_{Bi} = 125.20$</td><td>$\sum X_{Ci} = 112.50$</td><td>$\sum X_{Di} = 111.50$</td><td>$\sum X_{Ti} = 493.50$</td></tr><tr><td>$\sum X^2_{Ai} = 4196.57$</td><td>$\sum X^2_{Bi} = 3158.50$</td><td>$\sum X^2_{Ci} = 2576.51$</td><td>$\sum X^2_{Di} = 2501.95$</td><td>$\sum X^2_{Ti} = 12433.53$</td></tr><tr><td>$SS_A = 32.07$</td><td>$SS_B = 23.49$</td><td>$SS_C = 45.26$</td><td>$SS_D = 15.50$</td><td>$SS_T = 256.42$</td></tr></tbody></table><p>其中：</p><p>$$SS = \sum X^2_i - \frac{(\sum X_i)^2}{N}$$</p><p>（2）计算$SS_{wg}$以及$SS_{bg}$</p><p>$$SS_{wg} = SS_A + SS_B + SS_C + SS_D$$</p><p>$$SS_{bg} = SS_T - SS_{wg}$$</p><p>（4）计算相关自由度</p><p>$$df_{bg} = k - 1 = 4 - 1 = 3$$</p><p>$$df_{wg} = (N_A - 1) + (N_B - 1) + (N_C - 1) + (N_D - 1)$$</p><p>（5）计算 $MS_{bg}$以及$MS_{wg}$</p><p>$$MS_{bg} = \frac{SS_{bg}}{df_{bg}}$$</p><p>$$MS_{wg} = \frac{SS_{wg}}{df_{wg}}$$</p><p>（6）计算$F$</p><p>最后得出F = 6.42 （df = 3, 16）</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/f_distribution.png" alt="f_distribution"></p><h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> xlrd</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> scipy.stats <span class="keyword">as</span> stats</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">GetChildDetailLab</span><span class="params">(combine=True)</span>:</span></div><div class="line">    <span class="string">""" Get the detail labs of each child data.</span></div><div class="line"></div><div class="line">    Returns:</div><div class="line">        child_detail_lab: the detail labs.</div><div class="line">    """</div><div class="line"></div><div class="line">    CHILDS_FEATURE_LAB = [<span class="string">'tid'</span>, <span class="string">'age_m'</span>, <span class="string">'female'</span>, <span class="string">'onlychild'</span>, <span class="string">'divorce'</span>,</div><div class="line">                          <span class="string">'medu_newcat'</span>, <span class="string">'income_newcat'</span>, <span class="string">'scr_ave'</span>, <span class="string">'edu_ave'</span>,</div><div class="line">                          <span class="string">'edu_of_scr'</span>, <span class="string">'scr_h_cat'</span>, <span class="string">'mediacoview'</span>,</div><div class="line">                          <span class="string">'mediacontact'</span>]</div><div class="line">    CHILDS_CAT_LAB = [<span class="string">'emo_cat'</span>, <span class="string">'con_cat'</span>, <span class="string">'hyp_cat'</span>, <span class="string">'pee_cat'</span>,</div><div class="line">                      <span class="string">'difficulties_cat'</span>, <span class="string">'pro_cat'</span>]</div><div class="line"></div><div class="line">    <span class="keyword">if</span> combine:</div><div class="line">        CHILDS_DETAIL_LAB = CHILDS_FEATURE_LAB</div><div class="line">        CHILDS_DETAIL_LAB.extend(CHILDS_CAT_LAB)</div><div class="line">        <span class="keyword">return</span> CHILDS_DETAIL_LAB</div><div class="line"></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> CHILDS_FEATURE_LAB, CHILDS_CAT_LAB</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ReadChildInfoFromExcel</span><span class="params">(</span></span></div><div class="line">        file_name=<span class="string">'屏幕暴露与SDQ.xlsx'</span>, sheet_name=<span class="string">'data'</span>):</div><div class="line">    <span class="string">""" Read the screen-exposed vs.SDQ detail information</span></div><div class="line">        of each child from the excel-type file.</div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        file_name: the name of the excel-type file.</div><div class="line">        sheet_name: the name of the sheet of the excel file.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        child_scr_exp_sdq: A list that contains the detail</div><div class="line">                           information of each child.</div><div class="line">        labs: The lab corresponds to each colume of the data.</div><div class="line">    """</div><div class="line"></div><div class="line">    CHILDS_FILE_NAME = <span class="string">'child_scr_exp_sdq.npy'</span></div><div class="line">    CHILDS_DETAIL_LAB = GetChildDetailLab()</div><div class="line">    <span class="comment"># print(CHILDS_DETAIL_LAB)</span></div><div class="line">    NOT_INT_LAB_INDEIES = [CHILDS_DETAIL_LAB.index(<span class="string">'age_m'</span>),</div><div class="line">                           CHILDS_DETAIL_LAB.index(<span class="string">'scr_ave'</span>),</div><div class="line">                           CHILDS_DETAIL_LAB.index(<span class="string">'edu_ave'</span>),</div><div class="line">                           CHILDS_DETAIL_LAB.index(<span class="string">'edu_of_scr'</span>)]</div><div class="line"></div><div class="line">    child_scr_exp_sdq = []</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (os.path.isfile(CHILDS_FILE_NAME)):</div><div class="line">        <span class="keyword">with</span> open(CHILDS_FILE_NAME, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</div><div class="line">            child_scr_exp_sdq = np.load(f)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        workBook = xlrd.open_workbook(file_name)</div><div class="line">        bookSheet = workBook.sheet_by_name(sheet_name)</div><div class="line">        <span class="comment"># read from second row because of the first row has tabs</span></div><div class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> range(<span class="number">1</span>, bookSheet.nrows):</div><div class="line">            child_row = []</div><div class="line">            <span class="keyword">for</span> col <span class="keyword">in</span> range(bookSheet.ncols):</div><div class="line">                cel = bookSheet.cell(row, col)</div><div class="line">                <span class="keyword">try</span>:</div><div class="line">                    val = str(cel.value)</div><div class="line">                    <span class="comment"># tolerant the value error</span></div><div class="line">                    <span class="keyword">if</span> val == <span class="string">''</span>:</div><div class="line">                        val = <span class="string">'-1.0'</span></div><div class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">                    print(e)</div><div class="line"></div><div class="line">                <span class="comment"># because of the type is different</span></div><div class="line">                <span class="keyword">try</span>:</div><div class="line">                    <span class="keyword">if</span> col <span class="keyword">in</span> NOT_INT_LAB_INDEIES:</div><div class="line">                        val = float(val)</div><div class="line">                    <span class="keyword">else</span>:</div><div class="line">                        <span class="comment"># in Excel, if cel.value is 1, then str(cel.value) is</span></div><div class="line">                        <span class="comment"># '1.0'</span></div><div class="line">                        val = val.split(<span class="string">'.'</span>)[<span class="number">0</span>]</div><div class="line">                        val = int(val)</div><div class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">                    print(e)</div><div class="line">                    val = <span class="number">-1</span></div><div class="line">                child_row.append(val)</div><div class="line">            child_scr_exp_sdq.append(child_row)</div><div class="line">        child_scr_exp_sdq = np.array(child_scr_exp_sdq)</div><div class="line">        <span class="keyword">with</span> open(CHILDS_FILE_NAME, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</div><div class="line">            np.save(f, child_scr_exp_sdq)</div><div class="line">    <span class="keyword">return</span> child_scr_exp_sdq, CHILDS_DETAIL_LAB</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">SplitDataSet</span><span class="params">(data_set, feature, cat)</span>:</span></div><div class="line">    <span class="string">""" Split the data set to two column, that is feature and cat</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        data_set: the source data set.</div><div class="line">        feature: the input vector</div><div class="line">        cat: the correspond category.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        splited_data_set: self-explation.</div><div class="line">    """</div><div class="line"></div><div class="line">    CHILDS_DETAIL_LAB = GetChildDetailLab()</div><div class="line">    feature_index = CHILDS_DETAIL_LAB.index(feature)</div><div class="line">    cat_index = CHILDS_DETAIL_LAB.index(cat)</div><div class="line">    <span class="comment"># print(feature_index, cat_index)</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> data_set[:, (feature_index, cat_index)]</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">CalChi2</span><span class="params">(data_set)</span>:</span></div><div class="line">    <span class="string">""" Calculate the chi-square value and p-value corresponds to the data set.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        data_set: the object data set.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        chi2: the chi-square value.</div><div class="line">        p: the p-value.</div><div class="line">    """</div><div class="line"></div><div class="line">    rows_number = len(set(data_set[:, <span class="number">-1</span>]))</div><div class="line">    columns_number = len(set(data_set[:, <span class="number">0</span>]))</div><div class="line">    <span class="comment"># print(rows_number, columns_number)</span></div><div class="line">    counts = np.zeros((rows_number, columns_number))</div><div class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> data_set:</div><div class="line">        <span class="keyword">if</span> row[<span class="number">-1</span>] != <span class="number">-1</span>:</div><div class="line">            <span class="keyword">if</span> row[<span class="number">0</span>] != <span class="number">-1</span>:</div><div class="line">                <span class="keyword">try</span>:</div><div class="line">                    counts[int(row[<span class="number">-1</span>])][int(row[<span class="number">0</span>])] += <span class="number">1</span></div><div class="line">                <span class="keyword">except</span>:</div><div class="line">                    <span class="keyword">pass</span></div><div class="line">    <span class="comment"># drop the row that all item is 0</span></div><div class="line">    del_row_index = []</div><div class="line">    <span class="keyword">for</span> index, count <span class="keyword">in</span> enumerate(counts):</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> count.any():</div><div class="line">            del_row_index.append(index)</div><div class="line">    counts = np.delete(counts, tuple(del_row_index), axis=<span class="number">0</span>)</div><div class="line"></div><div class="line">    <span class="comment"># drop the column that all item is 0</span></div><div class="line">    del_col_index = []</div><div class="line">    <span class="keyword">for</span> index, count <span class="keyword">in</span> enumerate(counts.T):</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> count.any():</div><div class="line">            del_col_index.append(index)</div><div class="line">    counts = np.delete(counts, tuple(del_col_index), axis=<span class="number">1</span>)</div><div class="line">    <span class="comment"># print(counts)</span></div><div class="line"></div><div class="line">    <span class="comment"># calculate the chi-square value and correspond p-value</span></div><div class="line">    chi2, p, dof, excepted = stats.chi2_contingency(counts)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> chi2, p</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">ANOVATest</span><span class="params">(data_set)</span>:</span></div><div class="line">    <span class="string">""" Implement a ANOVA test on the data set.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        data_set: the object data set.</div><div class="line"></div><div class="line">    Return:</div><div class="line">        f: The computed F-value of the test.</div><div class="line">        p: The associated p-value from the F-distribution.</div><div class="line">    """</div><div class="line"></div><div class="line">    <span class="comment"># Initial the three categories</span></div><div class="line">    normal = []</div><div class="line">    critical = []</div><div class="line">    abnormal = []</div><div class="line"></div><div class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> data_set:</div><div class="line">        <span class="keyword">if</span> data[<span class="number">0</span>] != <span class="number">-1</span>:</div><div class="line">            <span class="keyword">if</span> data[<span class="number">-1</span>] == <span class="number">0</span>:</div><div class="line">                normal.append(data[<span class="number">0</span>])</div><div class="line">            <span class="keyword">elif</span> data[<span class="number">-1</span>] == <span class="number">1</span>:</div><div class="line">                critical.append(data[<span class="number">0</span>])</div><div class="line">            <span class="keyword">elif</span> data[<span class="number">-1</span>] == <span class="number">2</span>:</div><div class="line">                abnormal.append(data[<span class="number">0</span>])</div><div class="line"></div><div class="line">    f, p = stats.f_oneway(normal, critical, abnormal)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> f, p</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">GenerateCoffMatrix</span><span class="params">(data_set)</span>:</span></div><div class="line">    <span class="string">""" Calculate the chi-square and p-value of each feature-category pair.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        data_set: the source data set.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        coff_matrix: the final cofficient matrix.</div><div class="line">    """</div><div class="line"></div><div class="line">    coff_matrix = &#123;&#125;</div><div class="line">    CHILDS_FEATURE_LAB, CHILDS_CAT_LAB = GetChildDetailLab(combine=<span class="keyword">False</span>)</div><div class="line">    NOT_KEEP_FEATURE_LAB = [<span class="string">'tid'</span>, <span class="string">'age_m'</span>, <span class="string">'scr_ave'</span>, <span class="string">'edu_ave'</span>, <span class="string">'edu_of_scr'</span>]</div><div class="line">    <span class="keyword">for</span> feature <span class="keyword">in</span> CHILDS_FEATURE_LAB:</div><div class="line">        <span class="keyword">if</span> feature <span class="keyword">in</span> NOT_KEEP_FEATURE_LAB:</div><div class="line">            <span class="keyword">if</span> feature != NOT_KEEP_FEATURE_LAB[<span class="number">0</span>]:</div><div class="line">                <span class="keyword">for</span> cat <span class="keyword">in</span> CHILDS_CAT_LAB:</div><div class="line">                    splited_data_set = SplitDataSet(data_set, feature, cat)</div><div class="line">                    <span class="comment"># print(feature, cat)</span></div><div class="line">                    f, p = ANOVATest(splited_data_set)</div><div class="line">                    key = feature + <span class="string">'-'</span> + cat</div><div class="line">                    coff_matrix[key] = (f, p)</div><div class="line"></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">for</span> cat <span class="keyword">in</span> CHILDS_CAT_LAB:</div><div class="line">                splited_data_set = SplitDataSet(data_set, feature, cat)</div><div class="line">                <span class="comment"># print(feature, cat)</span></div><div class="line">                chi2, p = CalChi2(splited_data_set)</div><div class="line">                key = feature + <span class="string">'-'</span> + cat</div><div class="line">                coff_matrix[key] = (chi2, p)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> coff_matrix</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">SiftRelativeFeature</span><span class="params">(coff_matrix, conf=<span class="number">1e-5</span>)</span>:</span></div><div class="line">    <span class="string">""" Sift the feature that satisfy the caonfident condition.</span></div><div class="line"></div><div class="line">    Arguemnts:</div><div class="line">        coff_matrix: the calculated cofficient matrix for</div><div class="line">                     all features and categories.</div><div class="line">        conf: the confident.</div><div class="line"></div><div class="line">    Returns:</div><div class="line">        relative_feature_matrix: the satisfied feature and correspond</div><div class="line">                                 category and chi2 and p-value.</div><div class="line">    """</div><div class="line"></div><div class="line">    relative_feature_matrix = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> coff_matrix.keys():</div><div class="line">        <span class="keyword">if</span> coff_matrix[key][<span class="number">-1</span>] &lt;= conf:</div><div class="line">            relative_feature_matrix[key] = coff_matrix[key]</div><div class="line"></div><div class="line">    <span class="keyword">return</span> relative_feature_matrix</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">WriteResult</span><span class="params">(coff_matrix, file_name=<span class="string">'result.txt'</span>)</span>:</span></div><div class="line">    <span class="string">""" Write the result to file.</span></div><div class="line"></div><div class="line">    Arguments:</div><div class="line">        relative_feature_matrix: the satisfied feature and correspond</div><div class="line">                                 category and chi2 and p-value.</div><div class="line">        file_name: the result file name.</div><div class="line">    """</div><div class="line"></div><div class="line">    <span class="comment"># Sort</span></div><div class="line">    sorted_coff_matrix = sorted(coff_matrix.items(),</div><div class="line">                                key=<span class="keyword">lambda</span> item: item[<span class="number">1</span>][<span class="number">-1</span>], reverse=<span class="keyword">False</span>)</div><div class="line"></div><div class="line">    <span class="comment"># print(sorted_coff_matrix)</span></div><div class="line"></div><div class="line">    <span class="keyword">with</span> open(file_name, <span class="string">'w'</span>) <span class="keyword">as</span> f:</div><div class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> sorted_coff_matrix:</div><div class="line">            f.write(str(item))</div><div class="line">            f.write(<span class="string">'\n'</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    data_set, labels = ReadChildInfoFromExcel()</div><div class="line">    <span class="comment"># splited_data_set = SplitDataSet(data_set, 'female', 'difficulties_cat')</span></div><div class="line">    <span class="comment"># chi2, p = CalChi2(splited_data_set)</span></div><div class="line">    coff_matrix = GenerateCoffMatrix(data_set)</div><div class="line">    <span class="comment"># relative_feature = SiftRelativeFeature(coff_matrix, 1)</span></div><div class="line">    WriteResult(coff_matrix)</div></pre></td></tr></table></figure><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/anova_chi_result.png" alt="result"></p><h1 id="因子分析"><a href="#因子分析" class="headerlink" title="因子分析"></a>因子分析</h1><p>先说说因子分析与主成分分析的区别，下面的话<strong>引自知乎</strong>(<a href="https://www.zhihu.com/question/24524693" target="_blank" rel="external">https://www.zhihu.com/question/24524693</a>)</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/pca_fa_compare_1.png" alt="pca_fa_1"></p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/pca_fa_compare_2.png" alt="pca_fa_2"></p><p>具体实现使用SPSS软件进行实现：</p><p>操作步骤如下(<strong>引自 SPSS数据分析从入门到精通-陈胜可</strong>)：</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/spss_1.png" alt="spss_1"></p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/spss_2.png" alt="spss_2"></p><p>实验结果如下：</p><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/fa_result.png" alt="fa_result"></p><hr><p>2017.2.27 Updates</p><h1 id="决策树"><a href="#决策树" class="headerlink" title="决策树"></a>决策树</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> tree</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> cross_val_score</div><div class="line"></div><div class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</div><div class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></div></pre></td></tr></table></figure><h2 id="Read-data"><a href="#Read-data" class="headerlink" title="Read data"></a>Read data</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data = pd.read_excel(<span class="string">'./scr_SDQ.xlsx'</span>, sheetname=<span class="string">'data'</span>, index_col=<span class="number">0</span>).dropna().sort_index()</div></pre></td></tr></table></figure><h2 id="Convert-the-data-format"><a href="#Convert-the-data-format" class="headerlink" title="Convert the data format"></a>Convert the data format</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">float_columns = [<span class="string">'scr_ave'</span>, <span class="string">'edu_ave'</span>,<span class="string">'scr_of_edu'</span>]</div><div class="line"><span class="keyword">for</span> column <span class="keyword">in</span> data.columns:</div><div class="line">    <span class="keyword">if</span> column <span class="keyword">not</span> <span class="keyword">in</span> float_columns:</div><div class="line">        data[column] = data[column].astype(int)</div></pre></td></tr></table></figure><h2 id="Split-the-data"><a href="#Split-the-data" class="headerlink" title="Split the data"></a>Split the data</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data_feature_with_edu_ave = data.ix[:, :<span class="string">'mediacontact'</span>].drop(<span class="string">'scr_of_edu'</span>, axis=<span class="number">1</span>)</div><div class="line">data_feature_with_scr_of_edu = data.ix[:, :<span class="string">'mediacontact'</span>].drop(<span class="string">'edu_ave'</span>, axis=<span class="number">1</span>)</div><div class="line">data_classes = data.ix[:, <span class="string">'emo_cat'</span>:]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># dtree = tree.DecisionTreeClassifier(min_samples_leaf=500)</span></div><div class="line"><span class="comment"># cross_val_score(dtree,data_feature_with_edu_ave, data_classes['difficulties_cat'], cv=10)</span></div></pre></td></tr></table></figure><pre><code>array([ 0.64356436,  0.64356436,  0.64391855,  0.64391855,  0.64407713,
        0.64407713,  0.64407713,  0.64407713,  0.64407713,  0.64407713])
</code></pre><h2 id="difficulties-cat"><a href="#difficulties-cat" class="headerlink" title="difficulties_cat"></a>difficulties_cat</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">dtree_with_edu_ave = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_edu_ave = dtree_with_edu_ave.fit(data_feature_with_edu_ave, data_classes[<span class="string">'difficulties_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_edu_ave.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_edu_ave.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line">dtree_with_scr_of_edu = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_scr_of_edu = dtree_with_scr_of_edu.fit(data_feature_with_scr_of_edu, data_classes[<span class="string">'difficulties_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_scr_of_edu.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_scr_of_edu.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line"><span class="comment"># dtree_with_edu_ave_diff.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_edu_ave_diff.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_edu_ave, out_file=dot_file, feature_names=data_feature_with_edu_ave.columns)</div><div class="line"><span class="comment"># dtree_with_scr_of_edu_diff.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_scr_of_edu_diff.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_scr_of_edu, out_file=dot_file, feature_names=data_feature_with_scr_of_edu.columns)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><tr style="text-align:right"><br><br><th></th><br><th>Imp</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>scr_ave</th><br><td>0.553782</td><br></tr><br><tr><br><th>medu_newcat</th><br><td>0.217218</td><br></tr><br><tr><br><th>age_m</th><br><td>0.085820</td><br></tr><br><tr><br><th>income_newcat</th><br><td>0.048912</td><br></tr><br><tr><br><th>edu_ave</th><br><td>0.029740</td><br></tr><br><tr><br><th>female</th><br><td>0.026161</td><br></tr><br><tr><br><th>onlychild</th><br><td>0.021336</td><br></tr><br><tr><br><th>mediacontact</th><br><td>0.017030</td><br></tr><br><tr><br><th>divorce</th><br><td>0.000000</td><br></tr><br><tr><br><th>scr_h_cat</th><br><td>0.000000</td><br></tr><br><tr><br><th>mediacoview</th><br><td>0.000000</td><br></tr><br><br></tbody><br></table><br></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_edu_ave_diff.png" alt="edu_ave_diff"></p><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Imp</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>scr_ave</th><br><td>0.525587</td><br></tr><br><tr><br><th>medu_newcat</th><br><td>0.213067</td><br></tr><br><tr><br><th>age_m</th><br><td>0.084708</td><br></tr><br><tr><br><th>scr_of_edu</th><br><td>0.080575</td><br></tr><br><tr><br><th>mediacontact</th><br><td>0.029232</td><br></tr><br><tr><br><th>female</th><br><td>0.025661</td><br></tr><br><tr><br><th>onlychild</th><br><td>0.020929</td><br></tr><br><tr><br><th>income_newcat</th><br><td>0.020240</td><br></tr><br><tr><br><th>divorce</th><br><td>0.000000</td><br></tr><br><tr><br><th>scr_h_cat</th><br><td>0.000000</td><br></tr><br><tr><br><th>mediacoview</th><br><td>0.000000</td><br></tr><br><br></tbody><br></table><br></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_scr_of_edu_diff.png" alt="scr_of_edu_diff"></p><h2 id="emo-cat"><a href="#emo-cat" class="headerlink" title="emo_cat"></a>emo_cat</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">dtree_with_edu_ave = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_edu_ave = dtree_with_edu_ave.fit(data_feature_with_edu_ave, data_classes[<span class="string">'emo_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_edu_ave.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_edu_ave.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line">dtree_with_scr_of_edu = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_scr_of_edu = dtree_with_scr_of_edu.fit(data_feature_with_scr_of_edu, data_classes[<span class="string">'emo_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_scr_of_edu.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_scr_of_edu.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line"><span class="comment"># dtree_with_edu_ave_emo.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_edu_ave_emo.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_edu_ave, out_file=dot_file, feature_names=data_feature_with_edu_ave.columns)</div><div class="line"><span class="comment"># dtree_with_scr_of_edu_emo.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_scr_of_edu_emo.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_scr_of_edu, out_file=dot_file, feature_names=data_feature_with_scr_of_edu.columns)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Imp</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>scr_ave</th><br><td>0.521694</td><br></tr><br><tr><br><th>medu_newcat</th><br><td>0.159798</td><br></tr><br><tr><br><th>income_newcat</th><br><td>0.147978</td><br></tr><br><tr><br><th>edu_ave</th><br><td>0.083233</td><br></tr><br><tr><br><th>age_m</th><br><td>0.040750</td><br></tr><br><tr><br><th>female</th><br><td>0.023781</td><br></tr><br><tr><br><th>mediacontact</th><br><td>0.019127</td><br></tr><br><tr><br><th>mediacoview</th><br><td>0.003639</td><br></tr><br><tr><br><th>onlychild</th><br><td>0.000000</td><br></tr><br><tr><br><th>divorce</th><br><td>0.000000</td><br></tr><br><tr><br><th>scr_h_cat</th><br><td>0.000000</td><br></tr><br><br></tbody><br></table><br></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_edu_ave_emo.png" alt="edu_ave_emo"></p><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Imp</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>scr_ave</th><br><td>0.520711</td><br></tr><br><tr><br><th>income_newcat</th><br><td>0.155111</td><br></tr><br><tr><br><th>medu_newcat</th><br><td>0.146762</td><br></tr><br><tr><br><th>scr_of_edu</th><br><td>0.115745</td><br></tr><br><tr><br><th>age_m</th><br><td>0.023767</td><br></tr><br><tr><br><th>female</th><br><td>0.021924</td><br></tr><br><tr><br><th>mediacontact</th><br><td>0.011410</td><br></tr><br><tr><br><th>mediacoview</th><br><td>0.004571</td><br></tr><br><tr><br><th>onlychild</th><br><td>0.000000</td><br></tr><br><tr><br><th>divorce</th><br><td>0.000000</td><br></tr><br><tr><br><th>scr_h_cat</th><br><td>0.000000</td><br></tr><br><br></tbody><br></table><br></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_scr_of_edu_emo.png" alt="scr_of_edu_emo"></p><h2 id="con-cat"><a href="#con-cat" class="headerlink" title="con_cat"></a>con_cat</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">dtree_with_edu_ave = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_edu_ave = dtree_with_edu_ave.fit(data_feature_with_edu_ave, data_classes[<span class="string">'con_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_edu_ave.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_edu_ave.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line">dtree_with_scr_of_edu = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_scr_of_edu = dtree_with_scr_of_edu.fit(data_feature_with_scr_of_edu, data_classes[<span class="string">'con_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_scr_of_edu.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_scr_of_edu.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line"><span class="comment"># dtree_with_edu_ave_con.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_edu_ave_con.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_edu_ave, out_file=dot_file, feature_names=data_feature_with_edu_ave.columns)</div><div class="line"><span class="comment"># dtree_with_scr_of_edu_con.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_scr_of_edu_con.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_scr_of_edu, out_file=dot_file, feature_names=data_feature_with_scr_of_edu.columns)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Imp</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>scr_ave</th><br><td>0.562325</td><br></tr><br><tr><br><th>medu_newcat</th><br><td>0.098819</td><br></tr><br><tr><br><th>mediacontact</th><br><td>0.095089</td><br></tr><br><tr><br><th>edu_ave</th><br><td>0.077572</td><br></tr><br><tr><br><th>female</th><br><td>0.064213</td><br></tr><br><tr><br><th>income_newcat</th><br><td>0.056334</td><br></tr><br><tr><br><th>age_m</th><br><td>0.023696</td><br></tr><br><tr><br><th>onlychild</th><br><td>0.013513</td><br></tr><br><tr><br><th>mediacoview</th><br><td>0.008440</td><br></tr><br><tr><br><th>divorce</th><br><td>0.000000</td><br></tr><br><tr><br><th>scr_h_cat</th><br><td>0.000000</td><br></tr><br><br></tbody><br></table><br></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_edu_ave_con.png" alt="edu_ave_con"></p><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Imp</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>scr_ave</th><br><td>0.511282</td><br></tr><br><tr><br><th>scr_of_edu</th><br><td>0.110155</td><br></tr><br><tr><br><th>medu_newcat</th><br><td>0.097473</td><br></tr><br><tr><br><th>mediacontact</th><br><td>0.093793</td><br></tr><br><tr><br><th>female</th><br><td>0.082843</td><br></tr><br><tr><br><th>income_newcat</th><br><td>0.055566</td><br></tr><br><tr><br><th>age_m</th><br><td>0.035552</td><br></tr><br><tr><br><th>onlychild</th><br><td>0.013335</td><br></tr><br><tr><br><th>divorce</th><br><td>0.000000</td><br></tr><br><tr><br><th>scr_h_cat</th><br><td>0.000000</td><br></tr><br><tr><br><th>mediacoview</th><br><td>0.000000</td><br></tr><br><br></tbody><br></table><br></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_scr_of_edu_con.png" alt="scr_of_edu_con"></p><h2 id="hyp-cat"><a href="#hyp-cat" class="headerlink" title="hyp_cat"></a>hyp_cat</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">dtree_with_edu_ave = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_edu_ave = dtree_with_edu_ave.fit(data_feature_with_edu_ave, data_classes[<span class="string">'hyp_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_edu_ave.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_edu_ave.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line">dtree_with_scr_of_edu = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_scr_of_edu = dtree_with_scr_of_edu.fit(data_feature_with_scr_of_edu, data_classes[<span class="string">'hyp_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_scr_of_edu.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_scr_of_edu.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line"><span class="comment"># dtree_with_edu_ave_hyp.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_edu_ave_hyp.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_edu_ave, out_file=dot_file, feature_names=data_feature_with_edu_ave.columns)</div><div class="line"><span class="comment"># dtree_with_scr_of_edu_hyp.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_scr_of_edu_hyp.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_scr_of_edu, out_file=dot_file, feature_names=data_feature_with_scr_of_edu.columns)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Imp</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>medu_newcat</th><br><td>0.343448</td><br></tr><br><tr><br><th>scr_ave</th><br><td>0.265652</td><br></tr><br><tr><br><th>onlychild</th><br><td>0.165487</td><br></tr><br><tr><br><th>edu_ave</th><br><td>0.076194</td><br></tr><br><tr><br><th>income_newcat</th><br><td>0.054466</td><br></tr><br><tr><br><th>age_m</th><br><td>0.046774</td><br></tr><br><tr><br><th>mediacontact</th><br><td>0.020992</td><br></tr><br><tr><br><th>mediacoview</th><br><td>0.015532</td><br></tr><br><tr><br><th>female</th><br><td>0.011454</td><br></tr><br><tr><br><th>divorce</th><br><td>0.000000</td><br></tr><br><tr><br><th>scr_h_cat</th><br><td>0.000000</td><br></tr><br><br></tbody><br></table><br></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_edu_ave_hyp.png" alt="edu_ave_hyp"></p><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Imp</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>medu_newcat</th><br><td>0.335192</td><br></tr><br><tr><br><th>scr_ave</th><br><td>0.257218</td><br></tr><br><tr><br><th>onlychild</th><br><td>0.161509</td><br></tr><br><tr><br><th>scr_of_edu</th><br><td>0.105471</td><br></tr><br><tr><br><th>age_m</th><br><td>0.065618</td><br></tr><br><tr><br><th>income_newcat</th><br><td>0.033129</td><br></tr><br><tr><br><th>mediacontact</th><br><td>0.022542</td><br></tr><br><tr><br><th>mediacoview</th><br><td>0.012901</td><br></tr><br><tr><br><th>female</th><br><td>0.006421</td><br></tr><br><tr><br><th>divorce</th><br><td>0.000000</td><br></tr><br><tr><br><th>scr_h_cat</th><br><td>0.000000</td><br></tr><br><br></tbody><br></table><br></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_scr_of_edu_hyp.png" alt="scr_of_edu_hyp"></p><h2 id="pee-cat"><a href="#pee-cat" class="headerlink" title="pee_cat"></a>pee_cat</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">dtree_with_edu_ave = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_edu_ave = dtree_with_edu_ave.fit(data_feature_with_edu_ave, data_classes[<span class="string">'pee_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_edu_ave.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_edu_ave.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line">dtree_with_scr_of_edu = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_scr_of_edu = dtree_with_scr_of_edu.fit(data_feature_with_scr_of_edu, data_classes[<span class="string">'pee_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_scr_of_edu.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_scr_of_edu.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line"><span class="comment"># dtree_with_edu_ave_pee.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_edu_ave_pee.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_edu_ave, out_file=dot_file, feature_names=data_feature_with_edu_ave.columns)</div><div class="line"></div><div class="line"><span class="comment"># dtree_with_scr_of_edu_pee.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_scr_of_edu_pee.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_scr_of_edu, out_file=dot_file, feature_names=data_feature_with_scr_of_edu.columns)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Imp</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>scr_ave</th><br><td>0.441246</td><br></tr><br><tr><br><th>income_newcat</th><br><td>0.210646</td><br></tr><br><tr><br><th>female</th><br><td>0.152568</td><br></tr><br><tr><br><th>age_m</th><br><td>0.151888</td><br></tr><br><tr><br><th>medu_newcat</th><br><td>0.033530</td><br></tr><br><tr><br><th>mediacoview</th><br><td>0.009625</td><br></tr><br><tr><br><th>edu_ave</th><br><td>0.000498</td><br></tr><br><tr><br><th>onlychild</th><br><td>0.000000</td><br></tr><br><tr><br><th>divorce</th><br><td>0.000000</td><br></tr><br><tr><br><th>scr_h_cat</th><br><td>0.000000</td><br></tr><br><tr><br><th>mediacontact</th><br><td>0.000000</td><br></tr><br><br></tbody><br></table><br></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_edu_ave_pee.png" alt="edu_ave_pee"></p><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Imp</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>scr_ave</th><br><td>0.430946</td><br></tr><br><tr><br><th>income_newcat</th><br><td>0.200188</td><br></tr><br><tr><br><th>age_m</th><br><td>0.151286</td><br></tr><br><tr><br><th>female</th><br><td>0.139104</td><br></tr><br><tr><br><th>medu_newcat</th><br><td>0.033289</td><br></tr><br><tr><br><th>scr_of_edu</th><br><td>0.033259</td><br></tr><br><tr><br><th>mediacoview</th><br><td>0.011927</td><br></tr><br><tr><br><th>onlychild</th><br><td>0.000000</td><br></tr><br><tr><br><th>divorce</th><br><td>0.000000</td><br></tr><br><tr><br><th>scr_h_cat</th><br><td>0.000000</td><br></tr><br><tr><br><th>mediacontact</th><br><td>0.000000</td><br></tr><br><br></tbody><br></table><br></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_scr_of_edu_pee.png" alt="scr_of_edu_pee"></p><h2 id="pro-cat"><a href="#pro-cat" class="headerlink" title="pro_cat"></a>pro_cat</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">dtree_with_edu_ave = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_edu_ave = dtree_with_edu_ave.fit(data_feature_with_edu_ave, data_classes[<span class="string">'pro_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_edu_ave.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_edu_ave.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line">dtree_with_scr_of_edu = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_with_scr_of_edu = dtree_with_scr_of_edu.fit(data_feature_with_scr_of_edu, data_classes[<span class="string">'pro_cat'</span>])</div><div class="line">pd.DataFrame(dtree_with_scr_of_edu.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_feature_with_scr_of_edu.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line"><span class="comment"># dtree_with_edu_ave_pro.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_edu_ave_pro.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_edu_ave, out_file=dot_file, feature_names=data_feature_with_edu_ave.columns)</div><div class="line"><span class="comment"># dtree_with_scr_of_edu_pro.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_with_scr_of_edu_pro.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_with_scr_of_edu, out_file=dot_file, feature_names=data_feature_with_scr_of_edu.columns)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Imp</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>female</th><br><td>0.295389</td><br></tr><br><tr><br><th>scr_ave</th><br><td>0.252091</td><br></tr><br><tr><br><th>mediacontact</th><br><td>0.145010</td><br></tr><br><tr><br><th>age_m</th><br><td>0.137453</td><br></tr><br><tr><br><th>income_newcat</th><br><td>0.085421</td><br></tr><br><tr><br><th>edu_ave</th><br><td>0.062697</td><br></tr><br><tr><br><th>medu_newcat</th><br><td>0.021938</td><br></tr><br><tr><br><th>onlychild</th><br><td>0.000000</td><br></tr><br><tr><br><th>divorce</th><br><td>0.000000</td><br></tr><br><tr><br><th>scr_h_cat</th><br><td>0.000000</td><br></tr><br><tr><br><th>mediacoview</th><br><td>0.000000</td><br></tr><br><br></tbody><br></table><br></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_edu_ave_pro.png" alt="edu_ave_pro"></p><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Imp</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>female</th><br><td>0.299316</td><br></tr><br><tr><br><th>scr_ave</th><br><td>0.204496</td><br></tr><br><tr><br><th>mediacontact</th><br><td>0.131972</td><br></tr><br><tr><br><th>age_m</th><br><td>0.125169</td><br></tr><br><tr><br><th>scr_of_edu</th><br><td>0.111909</td><br></tr><br><tr><br><th>income_newcat</th><br><td>0.080072</td><br></tr><br><tr><br><th>medu_newcat</th><br><td>0.047066</td><br></tr><br><tr><br><th>onlychild</th><br><td>0.000000</td><br></tr><br><tr><br><th>divorce</th><br><td>0.000000</td><br></tr><br><tr><br><th>scr_h_cat</th><br><td>0.000000</td><br></tr><br><tr><br><th>mediacoview</th><br><td>0.000000</td><br></tr><br><br></tbody><br></table><br></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_with_scr_of_edu_pro.png" alt="scr_of_edu_pro"></p><h2 id="Convert-continuous-variables-to-categorical-variables"><a href="#Convert-continuous-variables-to-categorical-variables" class="headerlink" title="Convert continuous variables to categorical variables"></a>Convert continuous variables to categorical variables</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data_category = data.copy()</div><div class="line"><span class="keyword">for</span> column <span class="keyword">in</span> data_category.columns:</div><div class="line">    <span class="keyword">if</span> column <span class="keyword">in</span> float_columns:</div><div class="line">        data_category[column] = pd.cut(data_category[column], <span class="number">10</span>, labels=np.arange(<span class="number">10</span>))</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data_cate_feature_with_edu_ave = data_category.ix[:, :<span class="string">'mediacontact'</span>].drop(<span class="string">'scr_of_edu'</span>, axis=<span class="number">1</span>)</div><div class="line">data_cate_feature_with_scr_of_edu = data_category.ix[:, :<span class="string">'mediacontact'</span>].drop(<span class="string">'edu_ave'</span>, axis=<span class="number">1</span>)</div><div class="line">data_cate_classes = data.ix[:, <span class="string">'emo_cat'</span>:]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dtree_cate = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">50</span>)</div><div class="line">cross_val_score(dtree_cate,data_cate_feature_with_edu_ave, data_cate_classes[<span class="string">'difficulties_cat'</span>], cv=<span class="number">10</span>).sum() / <span class="number">10</span></div></pre></td></tr></table></figure><pre><code>0.63948514409153423
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">dtree_cate_with_edu_ave = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_cate_with_edu_ave = dtree_with_edu_ave.fit(data_cate_feature_with_edu_ave, data_cate_classes[<span class="string">'difficulties_cat'</span>])</div><div class="line">pd.DataFrame(dtree_cate_with_edu_ave.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_cate_feature_with_edu_ave.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line">dtree_cate_with_scr_of_edu = tree.DecisionTreeClassifier(min_samples_leaf=<span class="number">500</span>)</div><div class="line">dtree_cate_with_scr_of_edu = dtree_cate_with_scr_of_edu.fit(data_cate_feature_with_scr_of_edu, data_cate_classes[<span class="string">'difficulties_cat'</span>])</div><div class="line">pd.DataFrame(dtree_cate_with_scr_of_edu.feature_importances_, columns = [<span class="string">"Imp"</span>], </div><div class="line">             index = data_cate_feature_with_scr_of_edu.columns).sort_values(by=<span class="string">'Imp'</span>, ascending = <span class="keyword">False</span>)</div><div class="line"></div><div class="line"><span class="comment"># dtree_cate_with_edu_ave_diff.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_cate_with_edu_ave_diff.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_cate_with_edu_ave, out_file=dot_file, feature_names=data_cate_feature_with_edu_ave.columns)</div><div class="line"><span class="comment"># dtree_cate_with_scr_of_edu_diff.png</span></div><div class="line"><span class="keyword">with</span> open(<span class="string">'dtree_cate_with_scr_of_edu_diff.dot'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> dot_file:</div><div class="line">    tree.export_graphviz(dtree_cate_with_scr_of_edu, out_file=dot_file, feature_names=data_cate_feature_with_scr_of_edu.columns)</div></pre></td></tr></table></figure><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Imp</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>scr_h_cat</th><br><td>0.528976</td><br></tr><br><tr><br><th>medu_newcat</th><br><td>0.221779</td><br></tr><br><tr><br><th>age_m</th><br><td>0.092168</td><br></tr><br><tr><br><th>income_newcat</th><br><td>0.057032</td><br></tr><br><tr><br><th>onlychild</th><br><td>0.034724</td><br></tr><br><tr><br><th>mediacontact</th><br><td>0.027193</td><br></tr><br><tr><br><th>female</th><br><td>0.021036</td><br></tr><br><tr><br><th>scr_ave</th><br><td>0.011653</td><br></tr><br><tr><br><th>mediacoview</th><br><td>0.005439</td><br></tr><br><tr><br><th>divorce</th><br><td>0.000000</td><br></tr><br><tr><br><th>edu_ave</th><br><td>0.000000</td><br></tr><br><br></tbody><br></table><br></div><div><br><table border="1" class="dataframe"><br><thead><br><br><tr style="text-align:right"><br><th></th><br><th>Imp</th><br></tr><br><br></thead><br><tbody><br><br><tr><br><th>scr_h_cat</th><br><td>0.507678</td><br></tr><br><tr><br><th>medu_newcat</th><br><td>0.215210</td><br></tr><br><tr><br><th>age_m</th><br><td>0.089438</td><br></tr><br><tr><br><th>scr_of_edu</th><br><td>0.042832</td><br></tr><br><tr><br><th>mediacontact</th><br><td>0.041463</td><br></tr><br><tr><br><th>income_newcat</th><br><td>0.035742</td><br></tr><br><tr><br><th>onlychild</th><br><td>0.033695</td><br></tr><br><tr><br><th>female</th><br><td>0.020413</td><br></tr><br><tr><br><th>scr_ave</th><br><td>0.013527</td><br></tr><br><tr><br><th>divorce</th><br><td>0.000000</td><br></tr><br><tr><br><th>mediacoview</th><br><td>0.000000</td><br></tr><br><br></tbody><br></table><br></div><p><img src="http://o7ie0tcjk.bkt.clouddn.com/Correlation-Analysis/dtree_cate_with_scr_of_edu_diff.png" alt="cate_scr_of_edu_diff"></p></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/26/Python-data-analysis-Learning-note-Ch04/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracadabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracadabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/2017/02/26/Python-data-analysis-Learning-note-Ch04/" itemprop="url">Python data analysis-Learning note-Ch04</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-26T11:25:50+08:00">2017-02-26 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/02/26/Python-data-analysis-Learning-note-Ch04/#comments" itemprop="discussionUrl"><span class="post-comments-count hc-comment-count" data-xid="2017/02/26/Python-data-analysis-Learning-note-Ch04/" itemprop="commentsCount"></span> </a></span><span id="/2017/02/26/Python-data-analysis-Learning-note-Ch04/" class="leancloud_visitors" data-flag-title="Python data analysis-Learning note-Ch04"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="Numpy基础：数组和矢量计算"><a href="#Numpy基础：数组和矢量计算" class="headerlink" title="Numpy基础：数组和矢量计算"></a>Numpy基础：数组和矢量计算</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">%matplotlib inline</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line">np.set_printoptions(precision=<span class="number">4</span>, suppress=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</div><div class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></div></pre></td></tr></table></figure><h2 id="NumPy-ndarray-一种多维数组对象"><a href="#NumPy-ndarray-一种多维数组对象" class="headerlink" title="NumPy ndarray: 一种多维数组对象"></a>NumPy ndarray: 一种多维数组对象</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data = randn(<span class="number">2</span>, <span class="number">3</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data</div><div class="line">data * <span class="number">10</span></div><div class="line">data + data</div></pre></td></tr></table></figure><pre><code>array([[ 0.1584,  0.299 , -0.2555],
       [ 0.3277, -0.6934,  1.3191]])






array([[  1.5842,   2.9896,  -2.5545],
       [  3.2767,  -6.9342,  13.1913]])






array([[ 0.3168,  0.5979, -0.5109],
       [ 0.6553, -1.3868,  2.6383]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data.shape</div><div class="line">data.dtype</div></pre></td></tr></table></figure><pre><code>(2, 3)






dtype(&apos;float64&apos;)
</code></pre><h3 id="创建ndarray"><a href="#创建ndarray" class="headerlink" title="创建ndarray"></a>创建ndarray</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data1 = [<span class="number">6</span>, <span class="number">7.5</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">1</span>]</div><div class="line">arr1 = np.array(data1)</div><div class="line">arr1</div></pre></td></tr></table></figure><pre><code>array([ 6. ,  7.5,  8. ,  0. ,  1. ])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">data2 = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]]</div><div class="line">arr2 = np.array(data2)</div><div class="line">arr2</div><div class="line">arr2.ndim</div><div class="line">arr2.shape</div></pre></td></tr></table></figure><pre><code>array([[1, 2, 3, 4],
       [5, 6, 7, 8]])






2






(2, 4)
</code></pre><p>除非显示说明，np.array会尝试为新建的数组选择一个合适的类型</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr1.dtype</div><div class="line">arr2.dtype</div></pre></td></tr></table></figure><pre><code>dtype(&apos;float64&apos;)






dtype(&apos;int32&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">np.zeros(<span class="number">10</span>)</div><div class="line">np.zeros((<span class="number">3</span>, <span class="number">6</span>))</div><div class="line">np.empty((<span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>))</div></pre></td></tr></table></figure><pre><code>array([ 0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.])






array([[ 0.,  0.,  0.,  0.,  0.,  0.],
       [ 0.,  0.,  0.,  0.,  0.,  0.],
       [ 0.,  0.,  0.,  0.,  0.,  0.]])






array([[[ 0.,  0.],
        [ 0.,  0.],
        [ 0.,  0.]],

       [[ 0.,  0.],
        [ 0.,  0.],
        [ 0.,  0.]]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.arange(<span class="number">15</span>)</div></pre></td></tr></table></figure><pre><code>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14])
</code></pre><p>ones_like, zeros_like, empty_like这三个方法接受一个数组为对象，创建和这个数组形状和dtype一样的全1， 全0和分配的初始空间</p><h3 id="ndarray的数据类型"><a href="#ndarray的数据类型" class="headerlink" title="ndarray的数据类型"></a>ndarray的数据类型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr1 = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=np.float64)</div><div class="line">arr2 = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=np.int32)</div><div class="line">arr1.dtype</div><div class="line">arr2.dtype</div></pre></td></tr></table></figure><pre><code>dtype(&apos;float64&apos;)






dtype(&apos;int32&apos;)
</code></pre><p>当需要控制数据在内存和磁盘中的存储方式时（尤其是对大数据集），那就得了解如何控制存储类型</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line">arr.dtype</div><div class="line">float_arr = arr.astype(np.float64) </div><div class="line">float_arr.dtype</div></pre></td></tr></table></figure><pre><code>dtype(&apos;int32&apos;)






dtype(&apos;float64&apos;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.array([<span class="number">3.7</span>, <span class="number">-1.2</span>, <span class="number">-2.6</span>, <span class="number">0.5</span>, <span class="number">12.9</span>, <span class="number">10.1</span>])</div><div class="line">arr</div><div class="line">arr.astype(np.int32)</div></pre></td></tr></table></figure><pre><code>array([  3.7,  -1.2,  -2.6,   0.5,  12.9,  10.1])






array([ 3, -1, -2,  0, 12, 10])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">numeric_strings = np.array([<span class="string">'1.25'</span>, <span class="string">'-9.6'</span>, <span class="string">'42'</span>], dtype=np.string_)</div><div class="line">numeric_strings.astype(float)</div></pre></td></tr></table></figure><pre><code>array([  1.25,  -9.6 ,  42.  ])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">int_array = np.arange(<span class="number">10</span>)</div><div class="line">calibers = np.array([<span class="number">.22</span>, <span class="number">.270</span>, <span class="number">.357</span>, <span class="number">.380</span>, <span class="number">.44</span>, <span class="number">.50</span>], dtype=np.float64)</div><div class="line">int_array.astype(calibers.dtype)</div></pre></td></tr></table></figure><pre><code>array([ 0.,  1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9.])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">empty_uint32 = np.empty(<span class="number">8</span>, dtype=<span class="string">'u4'</span>)</div><div class="line">empty_uint32</div></pre></td></tr></table></figure><pre><code>array([1, 2, 3, 4, 5, 6, 7, 8], dtype=uint32)
</code></pre><p>调用astype会创建原数组的一份拷贝</p><h3 id="数组和标量之间的运算"><a href="#数组和标量之间的运算" class="headerlink" title="数组和标量之间的运算"></a>数组和标量之间的运算</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = np.array([[<span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>], [<span class="number">4.</span>, <span class="number">5.</span>, <span class="number">6.</span>]])</div><div class="line">arr</div><div class="line">arr * arr</div><div class="line">arr - arr</div></pre></td></tr></table></figure><pre><code>array([[ 1.,  2.,  3.],
       [ 4.,  5.,  6.]])






array([[  1.,   4.,   9.],
       [ 16.,  25.,  36.]])






array([[ 0.,  0.,  0.],
       [ 0.,  0.,  0.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span> / arr</div><div class="line">arr ** <span class="number">0.5</span></div></pre></td></tr></table></figure><pre><code>array([[ 1.    ,  0.5   ,  0.3333],
       [ 0.25  ,  0.2   ,  0.1667]])






array([[ 1.    ,  1.4142,  1.7321],
       [ 2.    ,  2.2361,  2.4495]])
</code></pre><h3 id="基本的索引和切片"><a href="#基本的索引和切片" class="headerlink" title="基本的索引和切片"></a>基本的索引和切片</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">10</span>)</div><div class="line">arr</div><div class="line">arr[<span class="number">5</span>]</div><div class="line">arr[<span class="number">5</span>:<span class="number">8</span>]</div><div class="line">arr[<span class="number">5</span>:<span class="number">8</span>] = <span class="number">12</span></div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])






5






array([5, 6, 7])






array([ 0,  1,  2,  3,  4, 12, 12, 12,  8,  9])
</code></pre><p>切片直接在原数组上操作<br>如果想要得到一个复制的版本，需要显示地调用copy()方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">arr_slice = arr[<span class="number">5</span>:<span class="number">8</span>]</div><div class="line">arr_slice[<span class="number">1</span>] = <span class="number">12345</span></div><div class="line">arr</div><div class="line">arr_slice[:] = <span class="number">64</span></div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([    0,     1,     2,     3,     4,    12, 12345,    12,     8,     9])






array([ 0,  1,  2,  3,  4, 64, 64, 64,  8,  9])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr2d = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]])</div><div class="line">arr2d[<span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>array([7, 8, 9])
</code></pre><p>注意下面这种索引方式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr2d[<span class="number">0</span>][<span class="number">2</span>]</div><div class="line">arr2d[<span class="number">0</span>, <span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>3






3
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr3d = np.array([[[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]], [[<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>], [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]]])</div><div class="line">arr3d</div></pre></td></tr></table></figure><pre><code>array([[[ 1,  2,  3],
        [ 4,  5,  6]],

       [[ 7,  8,  9],
        [10, 11, 12]]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr3d[<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>array([[1, 2, 3],
       [4, 5, 6]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">old_values = arr3d[<span class="number">0</span>].copy()</div><div class="line">arr3d[<span class="number">0</span>] = <span class="number">42</span></div><div class="line">arr3d</div><div class="line">arr3d[<span class="number">0</span>] = old_values</div><div class="line">arr3d</div></pre></td></tr></table></figure><pre><code>array([[[42, 42, 42],
        [42, 42, 42]],

       [[ 7,  8,  9],
        [10, 11, 12]]])






array([[[ 1,  2,  3],
        [ 4,  5,  6]],

       [[ 7,  8,  9],
        [10, 11, 12]]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr3d[<span class="number">1</span>, <span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>array([7, 8, 9])
</code></pre><h4 id="切片索引"><a href="#切片索引" class="headerlink" title="切片索引"></a>切片索引</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr[<span class="number">1</span>:<span class="number">6</span>]</div></pre></td></tr></table></figure><pre><code>array([ 1,  2,  3,  4, 64])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr2d</div><div class="line">arr2d[:<span class="number">2</span>]</div></pre></td></tr></table></figure><pre><code>array([[1, 2, 3],
       [4, 5, 6],
       [7, 8, 9]])






array([[1, 2, 3],
       [4, 5, 6]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr2d[:<span class="number">2</span>, <span class="number">1</span>:]</div></pre></td></tr></table></figure><pre><code>array([[2, 3],
       [5, 6]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr2d[<span class="number">1</span>, :<span class="number">2</span>]</div><div class="line">arr2d[<span class="number">2</span>, :<span class="number">1</span>]</div></pre></td></tr></table></figure><pre><code>array([4, 5])






array([7])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr2d[:, :<span class="number">1</span>]</div></pre></td></tr></table></figure><pre><code>array([[1],
       [4],
       [7]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr2d[:<span class="number">2</span>, <span class="number">1</span>:] = <span class="number">0</span></div></pre></td></tr></table></figure><h3 id="布尔型索引"><a href="#布尔型索引" class="headerlink" title="布尔型索引"></a>布尔型索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">names = np.array([<span class="string">'Bob'</span>, <span class="string">'Joe'</span>, <span class="string">'Will'</span>, <span class="string">'Bob'</span>, <span class="string">'Will'</span>, <span class="string">'Joe'</span>, <span class="string">'Joe'</span>])</div><div class="line">data = randn(<span class="number">7</span>, <span class="number">4</span>)</div><div class="line">names</div><div class="line">data</div></pre></td></tr></table></figure><pre><code>array([&apos;Bob&apos;, &apos;Joe&apos;, &apos;Will&apos;, &apos;Bob&apos;, &apos;Will&apos;, &apos;Joe&apos;, &apos;Joe&apos;], 
      dtype=&apos;&lt;U4&apos;)






array([[-2.9033,  1.4721,  0.9512,  1.7727],
       [ 2.2303, -1.0259,  1.0664,  0.534 ],
       [-0.9725,  0.2226, -0.1538, -0.4994],
       [-1.4289,  0.1665, -1.2874, -1.0817],
       [ 1.3581, -1.0734, -0.1387,  0.1673],
       [ 1.2816,  1.8883,  0.5699, -0.5843],
       [-0.0464, -0.9633,  0.2855, -0.6473]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">names == <span class="string">'Bob'</span></div></pre></td></tr></table></figure><pre><code>array([ True, False, False,  True, False, False, False], dtype=bool)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[names == <span class="string">'Bob'</span>]</div></pre></td></tr></table></figure><pre><code>array([[-2.9033,  1.4721,  0.9512,  1.7727],
       [-1.4289,  0.1665, -1.2874, -1.0817]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data[names == <span class="string">'Bob'</span>, <span class="number">2</span>:]</div><div class="line">data[names == <span class="string">'Bob'</span>, <span class="number">3</span>]</div></pre></td></tr></table></figure><pre><code>array([[ 0.9512,  1.7727],
       [-1.2874, -1.0817]])






array([ 1.7727, -1.0817])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">names != <span class="string">'Bob'</span></div><div class="line">data[~(names == <span class="string">'Bob'</span>)]</div></pre></td></tr></table></figure><pre><code>array([False,  True,  True, False,  True,  True,  True], dtype=bool)






array([[ 2.2303, -1.0259,  1.0664,  0.534 ],
       [-0.9725,  0.2226, -0.1538, -0.4994],
       [ 1.3581, -1.0734, -0.1387,  0.1673],
       [ 1.2816,  1.8883,  0.5699, -0.5843],
       [-0.0464, -0.9633,  0.2855, -0.6473]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mask = (names == <span class="string">'Bob'</span>) | (names == <span class="string">'Will'</span>)</div><div class="line">mask</div><div class="line">data[mask]</div></pre></td></tr></table></figure><pre><code>array([ True, False,  True,  True,  True, False, False], dtype=bool)






array([[-2.9033,  1.4721,  0.9512,  1.7727],
       [-0.9725,  0.2226, -0.1538, -0.4994],
       [-1.4289,  0.1665, -1.2874, -1.0817],
       [ 1.3581, -1.0734, -0.1387,  0.1673]])
</code></pre><p><strong>Python关键字and和or在布尔型数组中无效</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data[data &lt; <span class="number">0</span>] = <span class="number">0</span></div><div class="line">data</div></pre></td></tr></table></figure><pre><code>array([[ 0.    ,  1.4721,  0.9512,  1.7727],
       [ 2.2303,  0.    ,  1.0664,  0.534 ],
       [ 0.    ,  0.2226,  0.    ,  0.    ],
       [ 0.    ,  0.1665,  0.    ,  0.    ],
       [ 1.3581,  0.    ,  0.    ,  0.1673],
       [ 1.2816,  1.8883,  0.5699,  0.    ],
       [ 0.    ,  0.    ,  0.2855,  0.    ]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data[names != <span class="string">'Joe'</span>] = <span class="number">7</span></div><div class="line">data</div></pre></td></tr></table></figure><pre><code>array([[ 7.    ,  7.    ,  7.    ,  7.    ],
       [ 2.2303,  0.    ,  1.0664,  0.534 ],
       [ 7.    ,  7.    ,  7.    ,  7.    ],
       [ 7.    ,  7.    ,  7.    ,  7.    ],
       [ 7.    ,  7.    ,  7.    ,  7.    ],
       [ 1.2816,  1.8883,  0.5699,  0.    ],
       [ 0.    ,  0.    ,  0.2855,  0.    ]])
</code></pre><h3 id="花式索引"><a href="#花式索引" class="headerlink" title="花式索引"></a>花式索引</h3><p>花式索引创建新的数组</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = np.empty((<span class="number">8</span>, <span class="number">4</span>))</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</div><div class="line">    arr[i] = i</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[ 0.,  0.,  0.,  0.],
       [ 1.,  1.,  1.,  1.],
       [ 2.,  2.,  2.,  2.],
       [ 3.,  3.,  3.,  3.],
       [ 4.,  4.,  4.,  4.],
       [ 5.,  5.,  5.,  5.],
       [ 6.,  6.,  6.,  6.],
       [ 7.,  7.,  7.,  7.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr[[<span class="number">4</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">6</span>]]</div></pre></td></tr></table></figure><pre><code>array([[ 4.,  4.,  4.,  4.],
       [ 3.,  3.,  3.,  3.],
       [ 0.,  0.,  0.,  0.],
       [ 6.,  6.,  6.,  6.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr[[<span class="number">-3</span>, <span class="number">-5</span>, <span class="number">-7</span>]]</div></pre></td></tr></table></figure><pre><code>array([[ 5.,  5.,  5.,  5.],
       [ 3.,  3.,  3.,  3.],
       [ 1.,  1.,  1.,  1.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># more on reshape in Chapter 12</span></div><div class="line">arr = np.arange(<span class="number">32</span>).reshape((<span class="number">8</span>, <span class="number">4</span>))</div><div class="line">arr</div><div class="line">arr[[<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">2</span>], [<span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>]]</div></pre></td></tr></table></figure><pre><code>array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11],
       [12, 13, 14, 15],
       [16, 17, 18, 19],
       [20, 21, 22, 23],
       [24, 25, 26, 27],
       [28, 29, 30, 31]])






array([ 4, 23, 29, 10])
</code></pre><p>根据以上可知，传入两个索引数组相当于进行了同位置组合</p><p>注意以下这种方式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr[[<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">2</span>]][:, [<span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>]]</div></pre></td></tr></table></figure><pre><code>array([[ 4,  7,  5,  6],
       [20, 23, 21, 22],
       [28, 31, 29, 30],
       [ 8, 11,  9, 10]])
</code></pre><p>np.ix_方法将两个一维数组转换为一个矩形区域的索引选择器</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr[np.ix_([<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">2</span>], [<span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>])]</div></pre></td></tr></table></figure><pre><code>array([[ 4,  7,  5,  6],
       [20, 23, 21, 22],
       [28, 31, 29, 30],
       [ 8, 11,  9, 10]])
</code></pre><h3 id="数组转置和轴对换"><a href="#数组转置和轴对换" class="headerlink" title="数组转置和轴对换"></a>数组转置和轴对换</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">15</span>).reshape((<span class="number">3</span>, <span class="number">5</span>))</div><div class="line">arr</div><div class="line">arr.T</div></pre></td></tr></table></figure><pre><code>array([[ 0,  1,  2,  3,  4],
       [ 5,  6,  7,  8,  9],
       [10, 11, 12, 13, 14]])






array([[ 0,  5, 10],
       [ 1,  6, 11],
       [ 2,  7, 12],
       [ 3,  8, 13],
       [ 4,  9, 14]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = np.random.randn(<span class="number">6</span>, <span class="number">3</span>)</div><div class="line">np.dot(arr.T, arr)</div></pre></td></tr></table></figure><pre><code>array([[ 3.6804,  0.0133,  1.0388],
       [ 0.0133,  1.6074,  0.1836],
       [ 1.0388,  0.1836,  3.5281]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">16</span>).reshape((<span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>))</div><div class="line">arr</div><div class="line">arr.transpose((<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>))</div></pre></td></tr></table></figure><pre><code>array([[[ 0,  1,  2,  3],
        [ 4,  5,  6,  7]],

       [[ 8,  9, 10, 11],
        [12, 13, 14, 15]]])






array([[[ 0,  1,  2,  3],
        [ 8,  9, 10, 11]],

       [[ 4,  5,  6,  7],
        [12, 13, 14, 15]]])
</code></pre><p>Refered from <a href="http://stackoverflow.com/questions/32034237/how-does-numpy-ndarray-transpose-permute-the-axis-of-n-d-array" target="_blank" rel="external">here</a>.</p><p>In short: transposing an array means that NumPy just needs to permute the stride and shape information for each axis:</p><pre><code>&gt;&gt;&gt; arr.strides
(64, 32, 8)

&gt;&gt;&gt; arr.transpose(1, 0, 2).strides
(32, 64, 8)
</code></pre><p>Notice that the strides for the first and second axes were swapped here. This means that no data needs to be copied; NumPy can simply change how it looks at the memory to construct the array.</p><hr><p>What are strides?</p><p>The values in a 3D array <code>arr</code> are stored in a contiguous block of memory like this:</p><pre><code>[ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15]
</code></pre><p>In the case of <code>arr</code>, each integer takes up 8 bytes of memory (i.e. we’re using the int64 dtype).</p><p>A stride tells NumPy how many bytes to skip in order to move to the next value along an axis. For example, to get the next value in a row in <code>arr</code> (axis 2), we just need to move 8 bytes (1 number).</p><p>The strides for <code>arr.transpose(1, 0, 2)</code> are (32, 64, 8). To move along the first axis, instead of 64 bytes (8 numbers) NumPy will now only skip 32 bytes (4 numbers) each time:</p><pre><code>[[[0    ...]
  [...  ...]]

 [[4    ...]
  [...  ...]]]
</code></pre><p>Similarly, NumPy will now skip 64 bytes (8 numbers) in order to move along axis 1:</p><pre><code>[[[0    ...]
  [8    ...]]

 [[4    ...]
  [12   ...]]]
</code></pre><p>The actual code that does the transposing is written in C and can be found <a href="https://github.com/numpy/numpy/blob/467d4e16d77a2e7c131aac53c639e82b754578c7/numpy/core/src/multiarray/shape.c#l692" target="_blank" rel="external">here</a>.</p><p>也可以使用swapaxes方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr</div><div class="line">arr.swapaxes(<span class="number">1</span>, <span class="number">2</span>)</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[[ 0,  1,  2,  3],
        [ 4,  5,  6,  7]],

       [[ 8,  9, 10, 11],
        [12, 13, 14, 15]]])






array([[[ 0,  4],
        [ 1,  5],
        [ 2,  6],
        [ 3,  7]],

       [[ 8, 12],
        [ 9, 13],
        [10, 14],
        [11, 15]]])






array([[[ 0,  1,  2,  3],
        [ 4,  5,  6,  7]],

       [[ 8,  9, 10, 11],
        [12, 13, 14, 15]]])
</code></pre><h2 id="通用函数：快速的元素级数组函数"><a href="#通用函数：快速的元素级数组函数" class="headerlink" title="通用函数：快速的元素级数组函数"></a>通用函数：快速的元素级数组函数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">10</span>)</div><div class="line">np.sqrt(arr)</div><div class="line">np.exp(arr)</div></pre></td></tr></table></figure><pre><code>array([ 0.    ,  1.    ,  1.4142,  1.7321,  2.    ,  2.2361,  2.4495,
        2.6458,  2.8284,  3.    ])






array([    1.    ,     2.7183,     7.3891,    20.0855,    54.5982,
         148.4132,   403.4288,  1096.6332,  2980.958 ,  8103.0839])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x = randn(<span class="number">8</span>)</div><div class="line">y = randn(<span class="number">8</span>)</div><div class="line">x</div><div class="line">y</div><div class="line">np.maximum(x, y) <span class="comment"># 对应元素进行比较</span></div></pre></td></tr></table></figure><pre><code>array([ 0.811 , -0.0214, -0.3702, -0.4856,  1.1449, -0.4246,  0.9396,
        0.0382])






array([-1.223 ,  0.3271, -1.7197, -2.2636, -0.1154, -1.4122, -0.0989,
        0.4477])






array([ 0.811 ,  0.3271, -0.3702, -0.4856,  1.1449, -0.4246,  0.9396,
        0.4477])
</code></pre><p>modf函数挺有意思</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">7</span>) * <span class="number">5</span></div><div class="line">arr</div><div class="line">np.modf(arr)</div></pre></td></tr></table></figure><pre><code>array([ 10.3171,  -4.733 ,  -6.3358,   3.2457,  -7.3823,   2.7036,  -2.6173])






(array([ 0.3171, -0.733 , -0.3358,  0.2457, -0.3823,  0.7036, -0.6173]),
 array([ 10.,  -4.,  -6.,   3.,  -7.,   2.,  -2.]))
</code></pre><h2 id="利用数组进行数据处理"><a href="#利用数组进行数据处理" class="headerlink" title="利用数组进行数据处理"></a>利用数组进行数据处理</h2><p>meshgrid产生两个二维数组，对应points中所有的二元组</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">points = np.arange(<span class="number">-5</span>, <span class="number">5</span>, <span class="number">0.01</span>) <span class="comment"># 1000 equally spaced points</span></div><div class="line">xs, ys = np.meshgrid(points, points)</div><div class="line">xs</div><div class="line">ys</div></pre></td></tr></table></figure><pre><code>array([[-5.  , -4.99, -4.98, ...,  4.97,  4.98,  4.99],
       [-5.  , -4.99, -4.98, ...,  4.97,  4.98,  4.99],
       [-5.  , -4.99, -4.98, ...,  4.97,  4.98,  4.99],
       ..., 
       [-5.  , -4.99, -4.98, ...,  4.97,  4.98,  4.99],
       [-5.  , -4.99, -4.98, ...,  4.97,  4.98,  4.99],
       [-5.  , -4.99, -4.98, ...,  4.97,  4.98,  4.99]])






array([[-5.  , -5.  , -5.  , ..., -5.  , -5.  , -5.  ],
       [-4.99, -4.99, -4.99, ..., -4.99, -4.99, -4.99],
       [-4.98, -4.98, -4.98, ..., -4.98, -4.98, -4.98],
       ..., 
       [ 4.97,  4.97,  4.97, ...,  4.97,  4.97,  4.97],
       [ 4.98,  4.98,  4.98, ...,  4.98,  4.98,  4.98],
       [ 4.99,  4.99,  4.99, ...,  4.99,  4.99,  4.99]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> matplotlib.pyplot <span class="keyword">import</span> imshow, title</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">z = np.sqrt(xs ** <span class="number">2</span> + ys ** <span class="number">2</span>)</div><div class="line">z</div><div class="line">plt.imshow(z, cmap=plt.cm.gray); plt.colorbar()</div><div class="line">plt.title(<span class="string">"Image plot of $\sqrt&#123;x^2 + y^2&#125;$ for a grid of values"</span>)</div></pre></td></tr></table></figure><pre><code>array([[ 7.0711,  7.064 ,  7.0569, ...,  7.0499,  7.0569,  7.064 ],
       [ 7.064 ,  7.0569,  7.0499, ...,  7.0428,  7.0499,  7.0569],
       [ 7.0569,  7.0499,  7.0428, ...,  7.0357,  7.0428,  7.0499],
       ..., 
       [ 7.0499,  7.0428,  7.0357, ...,  7.0286,  7.0357,  7.0428],
       [ 7.0569,  7.0499,  7.0428, ...,  7.0357,  7.0428,  7.0499],
       [ 7.064 ,  7.0569,  7.0499, ...,  7.0428,  7.0499,  7.0569]])






&lt;matplotlib.image.AxesImage at 0x23400a22b38&gt;






&lt;matplotlib.colorbar.Colorbar at 0x23400a7c7b8&gt;






&lt;matplotlib.text.Text at 0x23400a03da0&gt;
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch04/meshgrid.png" alt="meshgrid"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">plt.draw()</div></pre></td></tr></table></figure><pre><code>&lt;matplotlib.figure.Figure at 0x23401396eb8&gt;
</code></pre><h3 id="将条件逻辑表述为数组运算"><a href="#将条件逻辑表述为数组运算" class="headerlink" title="将条件逻辑表述为数组运算"></a>将条件逻辑表述为数组运算</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">xarr = np.array([<span class="number">1.1</span>, <span class="number">1.2</span>, <span class="number">1.3</span>, <span class="number">1.4</span>, <span class="number">1.5</span>])</div><div class="line">yarr = np.array([<span class="number">2.1</span>, <span class="number">2.2</span>, <span class="number">2.3</span>, <span class="number">2.4</span>, <span class="number">2.5</span>])</div><div class="line">cond = np.array([<span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">True</span>, <span class="keyword">True</span>, <span class="keyword">False</span>])</div></pre></td></tr></table></figure><p>注意下面列表生成式的写法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">result = [(x <span class="keyword">if</span> c <span class="keyword">else</span> y)</div><div class="line">          <span class="keyword">for</span> x, y, c <span class="keyword">in</span> zip(xarr, yarr, cond)]</div><div class="line">result</div></pre></td></tr></table></figure><pre><code>[1.1000000000000001, 2.2000000000000002, 1.3, 1.3999999999999999, 2.5]
</code></pre><p>上述方法具有一些缺点：</p><ol><li>大数组处理速度慢（纯Python实现）</li><li>无法处理多维数组</li></ol><p>所以可以使用下面这种方法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = np.where(cond, xarr, yarr)</div><div class="line">result</div></pre></td></tr></table></figure><pre><code>array([ 1.1,  2.2,  1.3,  1.4,  2.5])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">4</span>, <span class="number">4</span>)</div><div class="line">arr</div><div class="line">np.where(arr &gt; <span class="number">0</span>, <span class="number">2</span>, <span class="number">-2</span>)</div><div class="line">np.where(arr &gt; <span class="number">0</span>, <span class="number">2</span>, arr) <span class="comment"># set only positive values to 2</span></div></pre></td></tr></table></figure><pre><code>array([[-0.7355, -0.3188, -0.2358,  0.3137],
       [-0.6196, -0.5803, -0.5504, -1.1508],
       [ 0.1719, -1.1599, -0.7115,  1.7869],
       [-0.2306,  0.2068,  1.5366,  1.6154]])






array([[-2, -2, -2,  2],
       [-2, -2, -2, -2],
       [ 2, -2, -2,  2],
       [-2,  2,  2,  2]])






array([[-0.7355, -0.3188, -0.2358,  2.    ],
       [-0.6196, -0.5803, -0.5504, -1.1508],
       [ 2.    , -1.1599, -0.7115,  2.    ],
       [-0.2306,  2.    ,  2.    ,  2.    ]])
</code></pre><p>显然<code>where</code>还可以应用于更复杂的操作。<br>考虑下面这种逻辑：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">result = []</div><div class="line">for i in range(n):</div><div class="line">    if cond1[i] and cond2[i]:</div><div class="line">        result.append(0)</div><div class="line">    elif cond1[i]:</div><div class="line">        result.append(1)</div><div class="line">    elif cond2[i]:</div><div class="line">        result.append(2)</div><div class="line">    else:</div><div class="line">        result.append(3)</div></pre></td></tr></table></figure><p>用<code>where</code>可以这样实现：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">np.where(cond1 &amp; cond2, 0,</div><div class="line">         np.where(cond1, 1,</div><div class="line">                  np.where(cond2, 2, 3)))</div></pre></td></tr></table></figure><p>更加magic一点：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">result = 1 * cond1 + 2 * cond2 + 3 * -(cond1 | cond2)</div></pre></td></tr></table></figure><h3 id="数学和统计方法"><a href="#数学和统计方法" class="headerlink" title="数学和统计方法"></a>数学和统计方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">arr = np.random.randn(<span class="number">5</span>, <span class="number">4</span>) <span class="comment"># 正态分布</span></div><div class="line">arr</div><div class="line"><span class="comment"># 下面两种方式都可以使用</span></div><div class="line">arr.mean()</div><div class="line">np.mean(arr)</div><div class="line">arr.sum()</div></pre></td></tr></table></figure><pre><code>array([[ 1.4513, -0.8225,  0.7011, -0.617 ],
       [ 1.5872,  1.2937,  1.0151,  0.7123],
       [-0.2012, -0.0168, -0.3847,  0.5274],
       [-0.6312, -0.2762,  0.4869,  0.0462],
       [-0.5268, -1.1071,  1.8642,  0.2282]])






0.26650934393195791






0.26650934393195791






5.3301868786391582
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr.mean(axis=<span class="number">1</span>)</div><div class="line">arr.sum(<span class="number">0</span>) <span class="comment"># axis=0</span></div></pre></td></tr></table></figure><pre><code>array([ 0.1782,  1.1521, -0.0188, -0.0936,  0.1146])






array([ 1.6793, -0.9289,  3.6826,  0.8971])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = np.array([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]])</div><div class="line">arr</div><div class="line">arr.cumsum(<span class="number">0</span>) <span class="comment"># axis=0</span></div><div class="line">arr.cumprod(<span class="number">1</span>) <span class="comment"># axis=1</span></div></pre></td></tr></table></figure><pre><code>array([[0, 1, 2],
       [3, 4, 5],
       [6, 7, 8]])






array([[ 0,  1,  2],
       [ 3,  5,  7],
       [ 9, 12, 15]], dtype=int32)






array([[  0,   0,   0],
       [  3,  12,  60],
       [  6,  42, 336]], dtype=int32)
</code></pre><h3 id="用于布尔数组的方法"><a href="#用于布尔数组的方法" class="headerlink" title="用于布尔数组的方法"></a>用于布尔数组的方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">100</span>)</div><div class="line">arr</div><div class="line">(arr &gt; <span class="number">0</span>).sum() <span class="comment"># Number of positive values</span></div></pre></td></tr></table></figure><pre><code>array([ 0.7828,  0.1372, -0.6264,  1.8927, -0.2104,  0.2822, -0.3672,
       -0.3601,  0.5918,  0.9285,  0.1808, -0.4021,  0.4086, -0.2949,
        0.5633, -0.7462, -0.1635,  0.1482, -0.3226, -1.2127, -0.9821,
        0.0536, -0.1772, -0.4714, -0.9002, -0.0037,  0.7352,  0.5675,
       -1.1612,  0.5288,  0.3319,  0.7315,  0.6841, -0.6881,  1.5654,
       -0.4605, -0.5423,  0.0184, -0.8153, -0.1313,  0.4594,  0.0228,
        0.255 , -2.2361,  0.8703, -1.5153, -0.9458,  0.2769,  0.9986,
        0.7699, -0.7948, -1.2508,  1.7059,  0.1805, -1.0265, -0.0181,
       -0.9415,  0.1265, -0.2576,  0.6791,  0.3969,  0.8027, -0.6792,
       -0.7487, -1.9949, -0.9595,  0.5706, -0.5727, -1.0204,  0.1521,
       -0.9755, -0.4094,  0.67  ,  0.212 ,  0.4081, -0.1435,  0.3964,
       -0.1865, -0.6018, -2.6185, -0.5073, -0.6328, -0.2631,  0.6637,
       -0.5586,  1.3346, -0.5317,  0.8572,  1.1159,  0.9563, -0.0434,
       -1.0534,  0.5869,  0.0502, -0.0479, -0.8673,  0.1531,  1.0646,
       -0.2624, -0.3726])






47
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">bools = np.array([<span class="keyword">False</span>, <span class="keyword">False</span>, <span class="keyword">True</span>, <span class="keyword">False</span>])</div><div class="line">bools</div><div class="line">bools.any()</div><div class="line">bools.all()</div></pre></td></tr></table></figure><pre><code>array([False, False,  True, False], dtype=bool)






True






False
</code></pre><h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">8</span>)</div><div class="line">arr</div><div class="line">arr.sort()</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([ 1.0584,  1.9062, -0.2923,  0.7169,  0.5186, -0.6089, -2.0444,
       -0.5661])






array([-2.0444, -0.6089, -0.5661, -0.2923,  0.5186,  0.7169,  1.0584,
        1.9062])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">5</span>, <span class="number">3</span>)</div><div class="line">arr</div><div class="line">arr.sort(<span class="number">1</span>) <span class="comment"># axis=1</span></div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[ 0.0118, -2.8916, -0.4477],
       [-1.9768,  1.859 , -1.128 ],
       [-2.6262,  0.5791,  0.7594],
       [-0.5254, -0.9059,  0.0203],
       [-1.4029, -1.8566,  0.1892]])






array([[-2.8916, -0.4477,  0.0118],
       [-1.9768, -1.128 ,  1.859 ],
       [-2.6262,  0.5791,  0.7594],
       [-0.9059, -0.5254,  0.0203],
       [-1.8566, -1.4029,  0.1892]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">large_arr = randn(<span class="number">1000</span>)</div><div class="line">large_arr</div><div class="line">large_arr.sort()</div><div class="line">large_arr</div><div class="line">large_arr[int(<span class="number">0.05</span> * len(large_arr))] <span class="comment"># 5% quantile</span></div></pre></td></tr></table></figure><pre><code>array([ 1.2296,  0.3794, -0.1526,  2.1223, -0.0675,  0.6867, -0.5742,
       -1.4291,  0.6856,  0.1364, -0.3966, -0.7793,  0.4965,  0.2447,
       -0.7487,  0.7695,  0.5358, -0.4813,  0.9949, -0.6489, -0.3656,
        1.9551,  0.8327,  1.497 , -0.4431, -0.8357, -0.821 , -0.7348,
        1.9294, -0.3144,  0.1396, -0.9111,  0.0943,  0.8043,  1.067 ,
        0.9362, -2.2574,  0.7475, -1.0152, -1.1234, -0.3774,  1.076 ,
        0.8743,  1.1864,  0.0801,  0.3995,  0.2536, -0.9371, -1.669 ,
       -2.2444,  1.2544,  1.0539, -0.7579,  0.2963,  0.7496, -1.3655,
        0.1552, -0.6259,  0.2621, -1.5415, -0.1036, -0.5794,  1.2098,
        1.3388,  0.3159,  1.0998,  0.5109, -0.3927,  1.4797, -1.4891,
        0.3624,  0.966 ,  0.0756, -0.4703,  0.1859,  1.6091,  0.662 ,
       -0.4808,  0.8744,  0.4738,  1.1351,  0.0251, -1.017 , -0.849 ,
       -0.1602, -1.5392,  0.0601,  1.7323,  1.1837,  0.4657,  0.8858,
       -0.211 ,  0.1865,  0.673 ,  0.3086, -1.2527, -0.7802,  0.407 ,
       -1.118 , -0.2058,  0.7921,  0.5284, -2.3038, -0.4038, -1.1087,
       -0.827 , -2.6518,  0.3711, -0.0244,  1.1103,  0.2748, -0.7962,
        1.9456,  0.5347,  0.1862, -0.3734, -0.3036,  0.6831, -0.9419,
        1.4848, -0.1247, -0.4138, -0.601 ,  0.6138,  1.1334,  0.4386,
        0.0466, -0.0588,  0.6883, -1.2912, -0.2381,  0.3934,  0.2132,
       -0.4143,  1.0844, -0.5258, -0.9944,  1.0977,  0.3528,  1.9928,
        1.421 ,  0.8634,  0.1973, -1.1799, -2.9433,  2.697 ,  0.4778,
        0.6464,  0.049 , -0.2339,  1.6945, -0.6568, -0.5972, -0.8324,
       -0.6443,  0.0882, -0.3686,  0.0419,  0.5119, -0.641 ,  1.1545,
        1.0735, -0.5329, -0.1126,  0.0375, -1.0699, -1.3153, -1.6097,
        2.5671, -0.9516, -0.388 , -0.0129, -0.0171, -1.0763, -0.7125,
        0.767 ,  0.2254, -0.7638, -0.2065,  1.2797,  0.0784, -0.7762,
        1.7106, -0.0136, -0.4435,  1.2946, -2.5489,  0.4241,  0.5675,
       -0.7596,  0.6128,  1.1161, -1.2456, -0.131 , -0.2684,  1.6461,
       -0.2497, -0.4294,  1.122 ,  0.5969,  0.3335, -0.0453,  1.1567,
        0.0216, -0.7277, -2.5465, -2.4542, -1.5895,  0.4607, -0.8303,
        0.0263,  0.0301, -1.2365, -0.146 , -0.8632,  0.6449,  0.1958,
       -0.6914, -0.3223,  0.4037,  0.9918, -0.3542,  0.8442,  0.7751,
       -1.6248,  2.6081,  0.3524,  1.5298,  0.4421,  1.5228, -1.5263,
       -1.3994,  0.0285, -0.5389,  1.4047, -2.1117, -1.0397,  0.6495,
        0.9073,  1.8738,  0.2913, -1.069 , -0.7835, -0.6437,  0.6739,
        0.3272, -0.8483, -0.2971,  0.2882,  0.1778, -0.6705, -1.4129,
       -0.1935,  0.6615, -0.4423, -1.2472, -0.9816,  0.927 , -2.2774,
        0.5736,  1.3996,  1.1653, -0.3253, -0.2074, -0.2447,  0.4925,
        1.8415, -1.1551, -0.5131, -0.6407,  0.5033, -0.817 ,  0.0479,
       -0.9106,  1.4391, -1.5824, -0.4652,  1.253 , -0.6051,  0.6699,
        0.3803,  1.0767,  1.5449,  0.106 , -0.7215, -0.354 ,  0.1016,
       -1.3191, -0.6596, -0.9632, -0.3655,  0.8411, -0.2314,  1.9493,
       -0.6966, -1.2598,  0.4023,  0.1704, -0.452 ,  1.5924,  0.381 ,
       -0.4731, -1.2467, -0.4264, -0.2298, -0.1792, -0.5009, -1.0032,
        1.0126,  0.5436,  1.1366, -1.0318,  1.3289,  0.3218, -0.2828,
        0.5597, -0.0213, -0.078 ,  0.7667, -0.3984, -1.0263, -0.5557,
       -2.0724, -0.9343, -0.6877,  1.0567, -0.605 ,  1.7923,  0.6351,
       -1.769 ,  0.4175,  0.8266,  0.3767, -0.1508, -0.4301, -0.3397,
        0.7248,  0.188 ,  1.1632, -1.0831, -0.5726, -0.475 ,  0.092 ,
       -0.1566,  1.9074, -1.4261,  1.8589, -0.7534, -1.0767, -0.2704,
        0.7567,  0.5903, -1.5612, -1.1097,  0.3504, -0.9086, -0.1691,
        0.6714, -0.6033,  1.8315, -0.8141,  0.5968, -0.408 , -1.1843,
        0.5146,  0.6201,  0.4293,  0.9797,  1.066 , -1.3325, -1.733 ,
        0.8545,  0.3993, -0.2041, -0.4624,  0.0272, -0.005 ,  0.9237,
       -0.5523,  0.9975, -0.4374,  0.1351, -0.6148,  0.3185,  0.0572,
       -0.3002,  0.0889, -0.0894, -0.5617, -2.0553, -0.2923,  0.7227,
        0.604 , -0.6623, -0.6126, -0.4991,  0.0923, -0.6982,  0.2099,
       -0.6853, -0.4752, -1.625 ,  0.0443,  2.5507, -1.1597,  0.3504,
       -0.7654, -1.4366, -1.3755,  0.3702, -1.7853, -0.7326, -1.2803,
       -0.6089, -0.4472,  0.462 ,  0.7799,  0.3141,  0.8064, -1.0487,
        0.7317, -0.2446,  0.3061,  0.1384, -0.572 , -0.0311,  0.3572,
       -0.6371, -0.2236,  0.0806,  0.6648, -0.148 , -0.2547,  1.3649,
       -0.1595,  1.3632, -0.8858,  1.1801,  0.5533,  2.3306,  0.2724,
        0.7073, -0.5605, -0.8849,  0.9533,  0.3683, -0.2901, -0.0453,
        0.1064,  1.3342, -0.7036,  0.7127,  1.2156,  0.9017,  1.2378,
       -1.1017,  1.0558,  1.4273,  0.7003,  1.1649,  0.0334,  0.3433,
       -0.3997, -0.1195,  1.3725, -0.3746,  0.8444,  0.961 , -0.2644,
        0.3245, -1.3583,  0.387 ,  1.2944,  0.0274, -0.5057,  0.15  ,
        0.6   , -0.5752,  0.3746,  1.7114, -0.0026, -0.1221, -0.8084,
       -0.9521, -0.6332,  0.7254,  1.7032, -0.0879,  0.3329, -1.9525,
       -0.7083, -0.4113,  1.163 ,  0.9018, -0.3667,  0.8419,  0.4417,
        0.2904,  0.1666,  1.3722, -0.4455, -1.4876,  0.4103,  2.3672,
        0.3569, -0.8546,  0.5152,  0.9623,  1.1777,  1.6789, -1.7793,
       -0.7797, -1.0923,  0.07  , -0.8974, -0.3151, -0.3675, -1.9851,
       -2.3352,  0.3566,  1.1929,  1.5275,  1.4349, -1.4742, -0.1913,
        1.5874, -0.7264, -0.5594,  0.3166, -0.9377, -0.6452,  0.394 ,
       -0.2238, -1.1239, -0.0324,  1.3866, -0.6174, -0.1301, -0.0328,
       -0.92  ,  1.8067,  0.2576, -0.5248,  0.4114,  0.1655, -0.1674,
        0.2743,  0.0835, -0.145 ,  1.1658,  1.2624,  0.0404,  2.0929,
        0.6047,  1.0317, -0.4956, -1.5666,  1.1729,  0.484 ,  0.955 ,
        1.0546,  0.0106,  0.5062,  0.3211,  0.8503,  0.4706,  1.9953,
       -0.9362,  0.6326, -0.3154,  1.4987, -0.1695,  1.0906, -0.686 ,
        0.2501, -0.316 ,  0.3032,  0.4873,  0.6402, -0.1209, -0.1857,
       -0.3707, -0.3082, -0.4769, -0.858 , -0.1521, -0.3403, -0.9853,
       -0.5049,  0.3338, -0.3197, -0.5789, -0.7124, -0.8867, -0.0228,
       -1.5519,  1.8517,  0.5229,  0.7613, -0.5586,  0.4827, -1.3011,
       -0.5284, -0.3806, -0.7719,  1.6304,  0.0375, -0.9122, -0.1006,
        0.382 ,  0.0969,  1.7784,  0.1831, -1.8866,  0.2996,  0.4778,
       -0.2491, -1.6537,  0.022 , -0.101 ,  0.5912, -0.2249, -1.1422,
       -0.6436, -1.4096, -0.7446,  0.8055,  1.0727,  0.2426, -0.8079,
       -1.4692,  0.062 , -0.4466,  0.3786, -2.0461,  0.7238, -1.6195,
        1.4005,  0.4881, -0.8161, -0.582 ,  0.3456,  1.2922,  0.2469,
        1.9035,  0.9072, -0.0729, -0.9424, -1.1129,  0.8922, -0.5628,
        1.6215, -0.7022,  0.8395, -0.3423,  0.6048, -0.248 ,  0.7411,
        0.3546,  0.6176, -0.8221, -0.338 , -2.1051, -1.0049, -0.0659,
        0.0917, -0.6661, -0.5234,  0.9574, -0.6316, -0.0047, -0.4773,
        0.1562, -0.116 , -1.6255, -0.9108, -1.4767, -0.7765, -1.7101,
        0.0557,  0.8112,  0.7382,  1.8806,  0.9239,  1.8638,  0.8426,
        0.0359,  0.2743,  1.9204,  1.2223,  0.4575, -0.3408,  0.3727,
        0.5036,  0.5392, -1.3331, -0.4008, -0.1341, -1.5197,  0.1923,
        0.2128,  1.1533, -1.4284, -0.7483, -0.4092,  1.2843, -0.4489,
       -0.6624,  0.9255, -0.0895,  0.3199, -0.2564, -0.1166, -1.4701,
        1.1799, -1.6238,  0.0508,  0.2312,  0.7322, -1.3623, -0.232 ,
       -0.2206,  0.566 ,  1.2411, -1.1563,  1.1777, -1.1481, -0.6716,
        0.4596, -0.2422, -0.8654,  0.4441,  0.1869,  1.4626,  0.7621,
        0.4249,  0.252 ,  0.632 ,  0.5626, -0.7925,  1.1995,  1.5665,
        0.6096,  0.4821, -0.7324, -0.7624,  1.858 , -0.8434, -0.4408,
        0.2011,  0.7552, -0.8955, -1.3255,  0.7022,  0.1507,  0.662 ,
       -1.2229,  0.5199,  0.9837, -0.3947, -0.5262, -1.0424, -1.4582,
        0.5126, -0.3606,  0.4427, -2.3922,  1.2784, -0.8382, -0.0198,
        1.2136, -0.4212, -0.7798, -1.3387, -0.7141,  0.9581, -0.8575,
       -0.2255,  0.8436, -2.2162,  0.0742,  0.9683, -0.3633, -0.0227,
       -1.2176,  1.1482, -0.6697,  0.9643, -1.2802, -0.3651, -1.29  ,
        0.851 ,  1.0167,  1.0011, -1.3014, -0.7205,  1.3621, -0.692 ,
        1.0637,  0.5637,  0.0851,  2.1514, -0.272 ,  0.3136,  0.2179,
        0.7035, -1.3028, -0.1032,  0.0611,  1.2002, -0.7346,  0.9991,
       -0.3747,  0.7908, -0.9573, -0.5114, -0.8607, -0.6711,  1.3335,
       -0.6671, -0.1687,  0.4601,  0.5747, -0.0767, -0.8428,  0.3372,
       -1.7756, -2.5264, -1.503 , -0.5669,  0.0167, -1.961 ,  0.8861,
        1.1902,  2.239 ,  0.2481,  0.7361, -1.1103,  0.8368, -1.0434,
        0.6809, -0.0839, -0.6972, -1.5492, -1.4129,  0.5889,  0.2138,
        1.7689, -0.4861, -0.1124,  0.2032,  1.0664, -0.369 ,  2.3793,
        0.4406, -1.1741,  1.0812,  1.3965, -0.149 ,  0.8793,  1.3494,
        1.2159, -0.0001,  1.1929, -0.1966, -0.1666,  1.7097, -0.4273,
        0.4831, -0.2411, -1.4517, -0.7317,  0.099 ,  1.7922,  0.2313,
       -0.5031, -0.0849,  0.7331, -0.1483, -0.8003,  1.1897,  0.031 ,
       -0.3624, -1.1133,  1.4647,  2.5653, -1.9536, -0.4528, -1.693 ,
        0.4847,  0.1368,  0.6859, -0.9872,  0.8425, -0.1492, -0.1335,
       -0.0229, -0.0903, -0.4381,  1.2552,  1.5763,  0.2375, -0.7597,
        0.0845,  0.0894, -1.6022, -0.1988,  0.3095, -1.0785, -1.6044,
       -0.4922,  0.4583,  0.3168, -2.0485, -1.2147, -0.2803, -0.2071,
        0.0767,  1.9544, -1.7648,  0.2873, -0.4029, -0.8128, -0.1081,
        0.0332,  2.5288,  0.9933,  0.4378, -0.8208, -0.2451,  0.3472,
       -0.2917,  2.0775,  1.7381, -0.467 , -0.8943, -1.4171, -0.3905,
        0.2591,  0.8118, -0.643 ,  1.0387,  0.0049,  1.7299, -0.6882,
       -1.4132, -1.0893,  0.4606, -1.546 , -2.87  ,  0.3492, -1.5968,
        0.9858,  0.1384, -0.6016, -0.9632, -0.9088,  0.3711,  1.3509,
        0.4601, -1.4963, -0.043 ,  0.5588,  0.2638, -1.1118, -0.9376,
       -0.9139,  0.6551,  0.4876, -1.7039, -0.2915,  0.3867, -0.1795,
        1.2298,  0.0893, -0.6019,  1.4109, -1.1918,  0.5009,  0.0157,
       -1.1307,  1.0407,  1.9742, -1.0377, -0.6151, -0.8398,  1.4096,
       -0.012 , -1.5323,  0.3323,  0.0539,  0.2383, -0.4059,  2.285 ,
        0.1536,  0.3838,  0.3623, -0.4326, -0.0975, -1.8119])






array([-2.9433, -2.87  , -2.6518, -2.5489, -2.5465, -2.5264, -2.4542,
       -2.3922, -2.3352, -2.3038, -2.2774, -2.2574, -2.2444, -2.2162,
       -2.1117, -2.1051, -2.0724, -2.0553, -2.0485, -2.0461, -1.9851,
       -1.961 , -1.9536, -1.9525, -1.8866, -1.8119, -1.7853, -1.7793,
       -1.7756, -1.769 , -1.7648, -1.733 , -1.7101, -1.7039, -1.693 ,
       -1.669 , -1.6537, -1.6255, -1.625 , -1.6248, -1.6238, -1.6195,
       -1.6097, -1.6044, -1.6022, -1.5968, -1.5895, -1.5824, -1.5666,
       -1.5612, -1.5519, -1.5492, -1.546 , -1.5415, -1.5392, -1.5323,
       -1.5263, -1.5197, -1.503 , -1.4963, -1.4891, -1.4876, -1.4767,
       -1.4742, -1.4701, -1.4692, -1.4582, -1.4517, -1.4366, -1.4291,
       -1.4284, -1.4261, -1.4171, -1.4132, -1.4129, -1.4129, -1.4096,
       -1.3994, -1.3755, -1.3655, -1.3623, -1.3583, -1.3387, -1.3331,
       -1.3325, -1.3255, -1.3191, -1.3153, -1.3028, -1.3014, -1.3011,
       -1.2912, -1.29  , -1.2803, -1.2802, -1.2598, -1.2527, -1.2472,
       -1.2467, -1.2456, -1.2365, -1.2229, -1.2176, -1.2147, -1.1918,
       -1.1843, -1.1799, -1.1741, -1.1597, -1.1563, -1.1551, -1.1481,
       -1.1422, -1.1307, -1.1239, -1.1234, -1.118 , -1.1133, -1.1129,
       -1.1118, -1.1103, -1.1097, -1.1087, -1.1017, -1.0923, -1.0893,
       -1.0831, -1.0785, -1.0767, -1.0763, -1.0699, -1.069 , -1.0487,
       -1.0434, -1.0424, -1.0397, -1.0377, -1.0318, -1.0263, -1.017 ,
       -1.0152, -1.0049, -1.0032, -0.9944, -0.9872, -0.9853, -0.9816,
       -0.9632, -0.9632, -0.9573, -0.9521, -0.9516, -0.9424, -0.9419,
       -0.9377, -0.9376, -0.9371, -0.9362, -0.9343, -0.92  , -0.9139,
       -0.9122, -0.9111, -0.9108, -0.9106, -0.9088, -0.9086, -0.8974,
       -0.8955, -0.8943, -0.8867, -0.8858, -0.8849, -0.8654, -0.8632,
       -0.8607, -0.858 , -0.8575, -0.8546, -0.849 , -0.8483, -0.8434,
       -0.8428, -0.8398, -0.8382, -0.8357, -0.8324, -0.8303, -0.827 ,
       -0.8221, -0.821 , -0.8208, -0.817 , -0.8161, -0.8141, -0.8128,
       -0.8084, -0.8079, -0.8003, -0.7962, -0.7925, -0.7835, -0.7802,
       -0.7798, -0.7797, -0.7793, -0.7765, -0.7762, -0.7719, -0.7654,
       -0.7638, -0.7624, -0.7597, -0.7596, -0.7579, -0.7534, -0.7487,
       -0.7483, -0.7446, -0.7348, -0.7346, -0.7326, -0.7324, -0.7317,
       -0.7277, -0.7264, -0.7215, -0.7205, -0.7141, -0.7125, -0.7124,
       -0.7083, -0.7036, -0.7022, -0.6982, -0.6972, -0.6966, -0.692 ,
       -0.6914, -0.6882, -0.6877, -0.686 , -0.6853, -0.6716, -0.6711,
       -0.6705, -0.6697, -0.6671, -0.6661, -0.6624, -0.6623, -0.6596,
       -0.6568, -0.6489, -0.6452, -0.6443, -0.6437, -0.6436, -0.643 ,
       -0.641 , -0.6407, -0.6371, -0.6332, -0.6316, -0.6259, -0.6174,
       -0.6151, -0.6148, -0.6126, -0.6089, -0.6051, -0.605 , -0.6033,
       -0.6019, -0.6016, -0.601 , -0.5972, -0.582 , -0.5794, -0.5789,
       -0.5752, -0.5742, -0.5726, -0.572 , -0.5669, -0.5628, -0.5617,
       -0.5605, -0.5594, -0.5586, -0.5557, -0.5523, -0.5389, -0.5329,
       -0.5284, -0.5262, -0.5258, -0.5248, -0.5234, -0.5131, -0.5114,
       -0.5057, -0.5049, -0.5031, -0.5009, -0.4991, -0.4956, -0.4922,
       -0.4861, -0.4813, -0.4808, -0.4773, -0.4769, -0.4752, -0.475 ,
       -0.4731, -0.4703, -0.467 , -0.4652, -0.4624, -0.4528, -0.452 ,
       -0.4489, -0.4472, -0.4466, -0.4455, -0.4435, -0.4431, -0.4423,
       -0.4408, -0.4381, -0.4374, -0.4326, -0.4301, -0.4294, -0.4273,
       -0.4264, -0.4212, -0.4143, -0.4138, -0.4113, -0.4092, -0.408 ,
       -0.4059, -0.4038, -0.4029, -0.4008, -0.3997, -0.3984, -0.3966,
       -0.3947, -0.3927, -0.3905, -0.388 , -0.3806, -0.3774, -0.3747,
       -0.3746, -0.3734, -0.3707, -0.369 , -0.3686, -0.3675, -0.3667,
       -0.3656, -0.3655, -0.3651, -0.3633, -0.3624, -0.3606, -0.3542,
       -0.354 , -0.3423, -0.3408, -0.3403, -0.3397, -0.338 , -0.3253,
       -0.3223, -0.3197, -0.316 , -0.3154, -0.3151, -0.3144, -0.3082,
       -0.3036, -0.3002, -0.2971, -0.2923, -0.2917, -0.2915, -0.2901,
       -0.2828, -0.2803, -0.272 , -0.2704, -0.2684, -0.2644, -0.2564,
       -0.2547, -0.2497, -0.2491, -0.248 , -0.2451, -0.2447, -0.2446,
       -0.2422, -0.2411, -0.2381, -0.2339, -0.232 , -0.2314, -0.2298,
       -0.2255, -0.2249, -0.2238, -0.2236, -0.2206, -0.211 , -0.2074,
       -0.2071, -0.2065, -0.2058, -0.2041, -0.1988, -0.1966, -0.1935,
       -0.1913, -0.1857, -0.1795, -0.1792, -0.1695, -0.1691, -0.1687,
       -0.1674, -0.1666, -0.1602, -0.1595, -0.1566, -0.1526, -0.1521,
       -0.1508, -0.1492, -0.149 , -0.1483, -0.148 , -0.146 , -0.145 ,
       -0.1341, -0.1335, -0.131 , -0.1301, -0.1247, -0.1221, -0.1209,
       -0.1195, -0.1166, -0.116 , -0.1126, -0.1124, -0.1081, -0.1036,
       -0.1032, -0.101 , -0.1006, -0.0975, -0.0903, -0.0895, -0.0894,
       -0.0879, -0.0849, -0.0839, -0.078 , -0.0767, -0.0729, -0.0675,
       -0.0659, -0.0588, -0.0453, -0.0453, -0.043 , -0.0328, -0.0324,
       -0.0311, -0.0244, -0.0229, -0.0228, -0.0227, -0.0213, -0.0198,
       -0.0171, -0.0136, -0.0129, -0.012 , -0.005 , -0.0047, -0.0026,
       -0.0001,  0.0049,  0.0106,  0.0157,  0.0167,  0.0216,  0.022 ,
        0.0251,  0.0263,  0.0272,  0.0274,  0.0285,  0.0301,  0.031 ,
        0.0332,  0.0334,  0.0359,  0.0375,  0.0375,  0.0404,  0.0419,
        0.0443,  0.0466,  0.0479,  0.049 ,  0.0508,  0.0539,  0.0557,
        0.0572,  0.0601,  0.0611,  0.062 ,  0.07  ,  0.0742,  0.0756,
        0.0767,  0.0784,  0.0801,  0.0806,  0.0835,  0.0845,  0.0851,
        0.0882,  0.0889,  0.0893,  0.0894,  0.0917,  0.092 ,  0.0923,
        0.0943,  0.0969,  0.099 ,  0.1016,  0.106 ,  0.1064,  0.1351,
        0.1364,  0.1368,  0.1384,  0.1384,  0.1396,  0.15  ,  0.1507,
        0.1536,  0.1552,  0.1562,  0.1655,  0.1666,  0.1704,  0.1778,
        0.1831,  0.1859,  0.1862,  0.1865,  0.1869,  0.188 ,  0.1923,
        0.1958,  0.1973,  0.2011,  0.2032,  0.2099,  0.2128,  0.2132,
        0.2138,  0.2179,  0.2254,  0.2312,  0.2313,  0.2375,  0.2383,
        0.2426,  0.2447,  0.2469,  0.2481,  0.2501,  0.252 ,  0.2536,
        0.2576,  0.2591,  0.2621,  0.2638,  0.2724,  0.2743,  0.2743,
        0.2748,  0.2873,  0.2882,  0.2904,  0.2913,  0.2963,  0.2996,
        0.3032,  0.3061,  0.3086,  0.3095,  0.3136,  0.3141,  0.3159,
        0.3166,  0.3168,  0.3185,  0.3199,  0.3211,  0.3218,  0.3245,
        0.3272,  0.3323,  0.3329,  0.3335,  0.3338,  0.3372,  0.3433,
        0.3456,  0.3472,  0.3492,  0.3504,  0.3504,  0.3524,  0.3528,
        0.3546,  0.3566,  0.3569,  0.3572,  0.3623,  0.3624,  0.3683,
        0.3702,  0.3711,  0.3711,  0.3727,  0.3746,  0.3767,  0.3786,
        0.3794,  0.3803,  0.381 ,  0.382 ,  0.3838,  0.3867,  0.387 ,
        0.3934,  0.394 ,  0.3993,  0.3995,  0.4023,  0.4037,  0.407 ,
        0.4103,  0.4114,  0.4175,  0.4241,  0.4249,  0.4293,  0.4378,
        0.4386,  0.4406,  0.4417,  0.4421,  0.4427,  0.4441,  0.4575,
        0.4583,  0.4596,  0.4601,  0.4601,  0.4606,  0.4607,  0.462 ,
        0.4657,  0.4706,  0.4738,  0.4778,  0.4778,  0.4821,  0.4827,
        0.4831,  0.484 ,  0.4847,  0.4873,  0.4876,  0.4881,  0.4925,
        0.4965,  0.5009,  0.5033,  0.5036,  0.5062,  0.5109,  0.5119,
        0.5126,  0.5146,  0.5152,  0.5199,  0.5229,  0.5284,  0.5347,
        0.5358,  0.5392,  0.5436,  0.5533,  0.5588,  0.5597,  0.5626,
        0.5637,  0.566 ,  0.5675,  0.5736,  0.5747,  0.5889,  0.5903,
        0.5912,  0.5968,  0.5969,  0.6   ,  0.604 ,  0.6047,  0.6048,
        0.6096,  0.6128,  0.6138,  0.6176,  0.6201,  0.632 ,  0.6326,
        0.6351,  0.6402,  0.6449,  0.6464,  0.6495,  0.6551,  0.6615,
        0.662 ,  0.662 ,  0.6648,  0.6699,  0.6714,  0.673 ,  0.6739,
        0.6809,  0.6831,  0.6856,  0.6859,  0.6867,  0.6883,  0.7003,
        0.7022,  0.7035,  0.7073,  0.7127,  0.7227,  0.7238,  0.7248,
        0.7254,  0.7317,  0.7322,  0.7331,  0.7361,  0.7382,  0.7411,
        0.7475,  0.7496,  0.7552,  0.7567,  0.7613,  0.7621,  0.7667,
        0.767 ,  0.7695,  0.7751,  0.7799,  0.7908,  0.7921,  0.8043,
        0.8055,  0.8064,  0.8112,  0.8118,  0.8266,  0.8327,  0.8368,
        0.8395,  0.8411,  0.8419,  0.8425,  0.8426,  0.8436,  0.8442,
        0.8444,  0.8503,  0.851 ,  0.8545,  0.8634,  0.8743,  0.8744,
        0.8793,  0.8858,  0.8861,  0.8922,  0.9017,  0.9018,  0.9072,
        0.9073,  0.9237,  0.9239,  0.9255,  0.927 ,  0.9362,  0.9533,
        0.955 ,  0.9574,  0.9581,  0.961 ,  0.9623,  0.9643,  0.966 ,
        0.9683,  0.9797,  0.9837,  0.9858,  0.9918,  0.9933,  0.9949,
        0.9975,  0.9991,  1.0011,  1.0126,  1.0167,  1.0317,  1.0387,
        1.0407,  1.0539,  1.0546,  1.0558,  1.0567,  1.0637,  1.066 ,
        1.0664,  1.067 ,  1.0727,  1.0735,  1.076 ,  1.0767,  1.0812,
        1.0844,  1.0906,  1.0977,  1.0998,  1.1103,  1.1161,  1.122 ,
        1.1334,  1.1351,  1.1366,  1.1482,  1.1533,  1.1545,  1.1567,
        1.163 ,  1.1632,  1.1649,  1.1653,  1.1658,  1.1729,  1.1777,
        1.1777,  1.1799,  1.1801,  1.1837,  1.1864,  1.1897,  1.1902,
        1.1929,  1.1929,  1.1995,  1.2002,  1.2098,  1.2136,  1.2156,
        1.2159,  1.2223,  1.2296,  1.2298,  1.2378,  1.2411,  1.253 ,
        1.2544,  1.2552,  1.2624,  1.2784,  1.2797,  1.2843,  1.2922,
        1.2944,  1.2946,  1.3289,  1.3335,  1.3342,  1.3388,  1.3494,
        1.3509,  1.3621,  1.3632,  1.3649,  1.3722,  1.3725,  1.3866,
        1.3965,  1.3996,  1.4005,  1.4047,  1.4096,  1.4109,  1.421 ,
        1.4273,  1.4349,  1.4391,  1.4626,  1.4647,  1.4797,  1.4848,
        1.497 ,  1.4987,  1.5228,  1.5275,  1.5298,  1.5449,  1.5665,
        1.5763,  1.5874,  1.5924,  1.6091,  1.6215,  1.6304,  1.6461,
        1.6789,  1.6945,  1.7032,  1.7097,  1.7106,  1.7114,  1.7299,
        1.7323,  1.7381,  1.7689,  1.7784,  1.7922,  1.7923,  1.8067,
        1.8315,  1.8415,  1.8517,  1.858 ,  1.8589,  1.8638,  1.8738,
        1.8806,  1.9035,  1.9074,  1.9204,  1.9294,  1.9456,  1.9493,
        1.9544,  1.9551,  1.9742,  1.9928,  1.9953,  2.0775,  2.0929,
        2.1223,  2.1514,  2.239 ,  2.285 ,  2.3306,  2.3672,  2.3793,
        2.5288,  2.5507,  2.5653,  2.5671,  2.6081,  2.697 ])






-1.5519406239259821
</code></pre><h3 id="唯一化以及其他的集合逻辑"><a href="#唯一化以及其他的集合逻辑" class="headerlink" title="唯一化以及其他的集合逻辑"></a>唯一化以及其他的集合逻辑</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">names = np.array([<span class="string">'Bob'</span>, <span class="string">'Joe'</span>, <span class="string">'Will'</span>, <span class="string">'Bob'</span>, <span class="string">'Will'</span>, <span class="string">'Joe'</span>, <span class="string">'Joe'</span>])</div><div class="line">np.unique(names)</div><div class="line">ints = np.array([<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">4</span>])</div><div class="line">np.unique(ints)</div></pre></td></tr></table></figure><pre><code>array([&apos;Bob&apos;, &apos;Joe&apos;, &apos;Will&apos;], 
      dtype=&apos;&lt;U4&apos;)






array([1, 2, 3, 4])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sorted(set(names))</div></pre></td></tr></table></figure><pre><code>[&apos;Bob&apos;, &apos;Joe&apos;, &apos;Will&apos;]
</code></pre><p>in1d感觉挺有用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">values = np.array([<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>])</div><div class="line">np.in1d(values, [<span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>])</div></pre></td></tr></table></figure><pre><code>array([ True, False, False,  True,  True, False,  True], dtype=bool)
</code></pre><h2 id="用于数组的文件输入输出"><a href="#用于数组的文件输入输出" class="headerlink" title="用于数组的文件输入输出"></a>用于数组的文件输入输出</h2><h3 id="将数组以二进制的形式保存到磁盘"><a href="#将数组以二进制的形式保存到磁盘" class="headerlink" title="将数组以二进制的形式保存到磁盘"></a>将数组以二进制的形式保存到磁盘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">10</span>)</div><div class="line">np.save(<span class="string">'some_array'</span>, arr)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.load(<span class="string">'some_array.npy'</span>)</div></pre></td></tr></table></figure><pre><code>array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
</code></pre><p>压缩存储，并且可以存储多个</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.savez(<span class="string">'array_archive.npz'</span>, a=arr[:<span class="number">4</span>], b=arr)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arch = np.load(<span class="string">'array_archive.npz'</span>)</div><div class="line">arch[<span class="string">'a'</span>]</div><div class="line">arch[<span class="string">'b'</span>]</div></pre></td></tr></table></figure><pre><code>array([0, 1, 2, 3])






array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])
</code></pre><h3 id="存取文本文件"><a href="#存取文本文件" class="headerlink" title="存取文本文件"></a>存取文本文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">!more ch04\array_ex.txt</div></pre></td></tr></table></figure><pre><code>0.580052,0.186730,1.040717,1.134411
0.194163,-0.636917,-0.938659,0.124094
-0.126410,0.268607,-0.695724,0.047428
-1.484413,0.004176,-0.744203,0.005487
2.302869,0.200131,1.670238,-1.881090
-0.193230,1.047233,0.482803,0.960334
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = np.loadtxt(<span class="string">'.\\ch04\\array_ex.txt'</span>, delimiter=<span class="string">','</span>)</div><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[ 0.5801,  0.1867,  1.0407,  1.1344],
       [ 0.1942, -0.6369, -0.9387,  0.1241],
       [-0.1264,  0.2686, -0.6957,  0.0474],
       [-1.4844,  0.0042, -0.7442,  0.0055],
       [ 2.3029,  0.2001,  1.6702, -1.8811],
       [-0.1932,  1.0472,  0.4828,  0.9603]])
</code></pre><h2 id="线性代数"><a href="#线性代数" class="headerlink" title="线性代数"></a>线性代数</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">x = np.array([[<span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>], [<span class="number">4.</span>, <span class="number">5.</span>, <span class="number">6.</span>]])</div><div class="line">y = np.array([[<span class="number">6.</span>, <span class="number">23.</span>], [<span class="number">-1</span>, <span class="number">7</span>], [<span class="number">8</span>, <span class="number">9</span>]])</div><div class="line">x</div><div class="line">y</div><div class="line">x.dot(y)  <span class="comment"># equivalently np.dot(x, y)</span></div></pre></td></tr></table></figure><pre><code>array([[ 1.,  2.,  3.],
       [ 4.,  5.,  6.]])






array([[  6.,  23.],
       [ -1.,   7.],
       [  8.,   9.]])






array([[  28.,   64.],
       [  67.,  181.]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.dot(x, np.ones(<span class="number">3</span>))</div></pre></td></tr></table></figure><pre><code>array([  6.,  15.])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.random.seed(<span class="number">12345</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> numpy.linalg <span class="keyword">import</span> inv, qr</div><div class="line">X = randn(<span class="number">5</span>, <span class="number">5</span>)</div><div class="line">X</div><div class="line">mat = X.T.dot(X)</div><div class="line">mat</div><div class="line">inv(mat)</div><div class="line">mat.dot(inv(mat))</div><div class="line">q, r = qr(mat) <span class="comment"># QR分解</span></div><div class="line">r</div></pre></td></tr></table></figure><pre><code>array([[-0.5031, -0.6223, -0.9212, -0.7262,  0.2229],
       [ 0.0513, -1.1577,  0.8167,  0.4336,  1.0107],
       [ 1.8249, -0.9975,  0.8506, -0.1316,  0.9124],
       [ 0.1882,  2.1695, -0.1149,  2.0037,  0.0296],
       [ 0.7953,  0.1181, -0.7485,  0.585 ,  0.1527]])






array([[ 4.2538, -1.0645,  1.4407,  0.9898,  1.7318],
       [-1.0645,  7.4431, -1.5585,  4.4972, -2.1367],
       [ 1.4407, -1.5585,  2.8126,  0.243 ,  1.2786],
       [ 0.9898,  4.4972,  0.243 ,  5.0897,  0.305 ],
       [ 1.7318, -2.1367,  1.2786,  0.305 ,  1.928 ]])






array([[ 0.4057, -0.1875, -0.0764,  0.1229, -0.541 ],
       [-0.1875,  2.462 ,  0.2537, -2.3367,  3.0984],
       [-0.0764,  0.2537,  0.5435, -0.2369,  0.0268],
       [ 0.1229, -2.3367, -0.2369,  2.4239, -2.9264],
       [-0.541 ,  3.0984,  0.0268, -2.9264,  4.8837]])






array([[ 1.,  0., -0., -0., -0.],
       [ 0.,  1., -0., -0., -0.],
       [ 0.,  0.,  1.,  0., -0.],
       [ 0., -0.,  0.,  1.,  0.],
       [ 0.,  0., -0.,  0.,  1.]])






array([[-5.0281,  2.7734, -2.8428, -1.0619, -3.0078],
       [ 0.    , -8.7212,  1.2925, -6.5614,  1.622 ],
       [ 0.    ,  0.    , -2.0873, -1.0487, -0.6291],
       [ 0.    ,  0.    ,  0.    , -1.408 , -0.955 ],
       [ 0.    ,  0.    ,  0.    ,  0.    ,  0.1537]])
</code></pre><h2 id="随机数生成"><a href="#随机数生成" class="headerlink" title="随机数生成"></a>随机数生成</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">samples = np.random.normal(size=(<span class="number">4</span>, <span class="number">4</span>))</div><div class="line">samples</div></pre></td></tr></table></figure><pre><code>array([[-0.5196,  1.297 ,  0.9062,  0.5809],
       [ 1.2233, -1.3301,  1.0483,  0.357 ],
       [-0.7935, -0.406 , -0.0096, -0.596 ],
       [ 1.3833, -0.2029, -1.0547, -0.9795]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> random <span class="keyword">import</span> normalvariate</div><div class="line">N = <span class="number">1000000</span></div><div class="line">%timeit samples = [normalvariate(<span class="number">0</span>, <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> range(N)]</div><div class="line">%timeit np.random.normal(size=N)</div></pre></td></tr></table></figure><pre><code>1 loop, best of 3: 814 ms per loop
10 loops, best of 3: 28.4 ms per loop
</code></pre><p>可以看出numpy确实要快很多</p><h2 id="Example-随机游走"><a href="#Example-随机游走" class="headerlink" title="Example: 随机游走"></a>Example: 随机游走</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> random</div><div class="line"></div><div class="line">position = <span class="number">0</span></div><div class="line">walk = [position]</div><div class="line">steps = <span class="number">1000</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(steps):</div><div class="line">    step = <span class="number">1</span> <span class="keyword">if</span> random.randint(<span class="number">0</span>, <span class="number">1</span>) <span class="keyword">else</span> <span class="number">-1</span></div><div class="line">    position += step</div><div class="line">    walk.append(position)</div></pre></td></tr></table></figure><p>通过numpy来实现上述过程</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.random.seed(<span class="number">12345</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">nsteps = <span class="number">1000</span></div><div class="line">draws = np.random.randint(<span class="number">0</span>, <span class="number">2</span>, size=nsteps)</div><div class="line">steps = np.where(draws &gt; <span class="number">0</span>, <span class="number">1</span>, <span class="number">-1</span>)</div><div class="line">walk = steps.cumsum()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"></div><div class="line">index = [x + <span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(len(walk))]</div><div class="line">plt.plot(index, walk)</div></pre></td></tr></table></figure><pre><code>[&lt;matplotlib.lines.Line2D at 0x234014e9f98&gt;]
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata/ch04/random_walk.png" alt="random_walk"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">walk.min()</div><div class="line">walk.max()</div></pre></td></tr></table></figure><pre><code>-3






31
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(np.abs(walk) &gt;= <span class="number">10</span>).argmax() <span class="comment"># the first index</span></div></pre></td></tr></table></figure><pre><code>37
</code></pre><h3 id="一次模拟多次随机漫步"><a href="#一次模拟多次随机漫步" class="headerlink" title="一次模拟多次随机漫步"></a>一次模拟多次随机漫步</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">nwalks = <span class="number">5000</span> <span class="comment"># 5000 random walk</span></div><div class="line">nsteps = <span class="number">1000</span></div><div class="line">draws = np.random.randint(<span class="number">0</span>, <span class="number">2</span>, size=(nwalks, nsteps)) <span class="comment"># 0 or 1</span></div><div class="line">steps = np.where(draws &gt; <span class="number">0</span>, <span class="number">1</span>, <span class="number">-1</span>)</div><div class="line">walks = steps.cumsum(<span class="number">1</span>)</div><div class="line">walks</div></pre></td></tr></table></figure><pre><code>array([[ -1,   0,  -1, ...,  24,  23,  22],
       [ -1,   0,  -1, ..., -36, -37, -36],
       [  1,   2,   3, ..., -42, -41, -40],
       ..., 
       [  1,   0,  -1, ...,  48,  49,  50],
       [ -1,  -2,  -3, ..., -38, -39, -40],
       [ -1,   0,   1, ..., -48, -47, -48]], dtype=int32)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">walks.max()</div><div class="line">walks.min()</div></pre></td></tr></table></figure><pre><code>130






-117
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">hits30 = (np.abs(walks) &gt;= <span class="number">30</span>).any(<span class="number">1</span>)</div><div class="line">hits30</div><div class="line">hits30.sum() <span class="comment"># Number that hit 30 or -30</span></div></pre></td></tr></table></figure><pre><code>array([ True,  True,  True, ...,  True,  True,  True], dtype=bool)






3412
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">crossing_times = (np.abs(walks[hits30]) &gt;= <span class="number">30</span>).argmax(<span class="number">1</span>)</div><div class="line">crossing_times.mean()</div></pre></td></tr></table></figure><pre><code>497.04103165298943
</code></pre></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></section><nav class="pagination"><a class="extend prev" rel="prev" href="/page/21/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><span class="page-number current">22</span><a class="page-number" href="/page/23/">23</a><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/23/"><i class="fa fa-angle-right"></i></a></nav></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview sidebar-panel sidebar-panel-active"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Ewan Li"><p class="site-author-name" itemprop="name">Ewan Li</p><p class="site-description motion-element" itemprop="description">Ewan's IT Blog</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">120</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-tags"><a href="/tags"><span class="site-state-item-count">58</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ewanlee" target="_blank" title="Github"><i class="fa fa-fw fa-globe"></i> Github </a></span><span class="links-of-author-item"><a href="http://weibo.com/3946248928/profile?topnav=1&wvr=6" target="_blank" title="Weibo"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Ewan Li</span></div><div class="powered-by">Powered by <a class="theme-link" href="https://hexo.io">Hexo</a></div><div class="theme-info">Theme - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user">本站访客数</i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span>人次</span> <span class="site-pv"><i class="fa fa-eye">本站总访问量</i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script><script type="text/javascript">_hcwp=window._hcwp||[],_hcwp.push({widget:"Bloggerstream",widget_id:89825,selector:".hc-comment-count",label:"{%COUNT%}"}),function(){if(!("HC_LOAD_INIT"in window)){HC_LOAD_INIT=!0;var t=(navigator.language||navigator.systemLanguage||navigator.userLanguage||"en").substr(0,2).toLowerCase(),e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https":"http")+"://w.hypercomments.com/widget/hc/89825/"+t+"/widget.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n.nextSibling)}}()</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path,searchFunc=function(e,t,a){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var r=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),c=document.getElementById(t),n=document.getElementById(a);c.addEventListener("input",function(){var e=0,t='<ul class="search-result-list">',a=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length>1&&r.forEach(function(r){var c=!1,n=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),o=decodeURIComponent(r.url),i=-1,l=-1,p=-1;if(""!=n&&a.forEach(function(e,t){i=n.indexOf(e),l=s.indexOf(e),(i>=0||l>=0)&&(c=!0,0==t&&(p=l))}),c){e+=1,t+="<li><a href='"+o+"' class='search-result-title'>"+n+"</a>";var h=r.content.trim().replace(/<[^>]+>/g,"");if(p>=0){var u=p-20,d=p+80;u<0&&(u=0),0==u&&(d=50),d>h.length&&(d=h.length);var f=h.substring(u,d);a.forEach(function(e){var t=new RegExp(e,"gi");f=f.replace(t,'<b class="search-keyword">'+e+"</b>")}),t+='<p class="search-result">'+f+"...</p>"}t+="</li>"}}),t+="</ul>",0==e&&(t='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==a&&(t='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),n.innerHTML=t}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("e27VKX5tTklQLCtF7iNMmhcA-gzGzoHsz","nnQn2znNgXXEdK7W2bVJ3bfK")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var r=e[i],s=r.get("url"),l=r.get("time"),c=document.getElementById(s);$(c).find(t).text(l)}for(var i=0;i<n.length;i++){var s=n[i],c=document.getElementById(s),u=$(c).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script></body></html>