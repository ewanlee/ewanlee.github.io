<!doctype html><html class="theme-next mist use-motion" lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css"><meta name="keywords" content="Hexo, NexT"><link rel="alternate" href="/atom.xml" title="Abracdabra" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0"><meta name="description" content="Ewan&apos;s IT Blog"><meta property="og:type" content="website"><meta property="og:title" content="Abracdabra"><meta property="og:url" content="http://yoursite.com/page/25/index.html"><meta property="og:site_name" content="Abracdabra"><meta property="og:description" content="Ewan&apos;s IT Blog"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Abracdabra"><meta name="twitter:description" content="Ewan&apos;s IT Blog"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"Author"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://yoursite.com/page/25/"><title>Abracdabra</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?dc405a79ad500922134d14cdf288f646";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-left page-home"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Abracdabra</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Do it yourself</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>Categories</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>About</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>Tags</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i><br>Sitemap</a></li><li class="menu-item menu-item-commonweal"><a href="/404.html" rel="section"><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div><span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><section id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/28/Python-data-analysis-Learning-note-Ch07/"><span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Ewan Li"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Abracdabra"><span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Abracdabra" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"><a class="post-title-link" href="/2017/02/28/Python-data-analysis-Learning-note-Ch07/" itemprop="url">Python data analysis Learning note Ch07</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-28T22:36:30+08:00">2017-02-28 </time></span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2017/02/28/Python-data-analysis-Learning-note-Ch07/#comments" itemprop="discussionUrl"><span class="post-comments-count ds-thread-count" data-thread-key="2017/02/28/Python-data-analysis-Learning-note-Ch07/" itemprop="commentCount"></span> </a></span><span id="/2017/02/28/Python-data-analysis-Learning-note-Ch07/" class="leancloud_visitors" data-flag-title="Python data analysis Learning note Ch07"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">Visitors </span><span class="leancloud-visitors-count"></span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="数据规整化：清理、转换、合并、重塑"><a href="#数据规整化：清理、转换、合并、重塑" class="headerlink" title="数据规整化：清理、转换、合并、重塑"></a>数据规整化：清理、转换、合并、重塑</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">np.random.seed(<span class="number">12345</span>)</div><div class="line">plt.rc(<span class="string">'figure'</span>, figsize=(<span class="number">10</span>, <span class="number">6</span>))</div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="keyword">import</span> pandas</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">np.set_printoptions(precision=<span class="number">4</span>, threshold=<span class="number">500</span>)</div><div class="line">pd.options.display.max_rows = <span class="number">100</span></div><div class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</div><div class="line">InteractiveShell.ast_node_interactivity = <span class="string">"all"</span></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">%matplotlib inline</div></pre></td></tr></table></figure><h2 id="合并数据集"><a href="#合并数据集" class="headerlink" title="合并数据集"></a>合并数据集</h2><h3 id="数据库风格的DataFrame合并"><a href="#数据库风格的DataFrame合并" class="headerlink" title="数据库风格的DataFrame合并"></a>数据库风格的DataFrame合并</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(&#123;<span class="string">'key'</span>: [<span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>],</div><div class="line">                 <span class="string">'data1'</span>: range(<span class="number">7</span>)&#125;)</div><div class="line">df2 = DataFrame(&#123;<span class="string">'key'</span>: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'d'</span>],</div><div class="line">                 <span class="string">'data2'</span>: range(<span class="number">3</span>)&#125;)</div><div class="line">df1</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td></tr><tr><th>1</th><td>1</td><td>b</td></tr><tr><th>2</th><td>2</td><td>a</td></tr><tr><th>3</th><td>3</td><td>c</td></tr><tr><th>4</th><td>4</td><td>a</td></tr><tr><th>5</th><td>5</td><td>a</td></tr><tr><th>6</th><td>6</td><td>b</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data2</th><th>key</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>a</td></tr><tr><th>1</th><td>1</td><td>b</td></tr><tr><th>2</th><td>2</td><td>d</td></tr></tbody></table></div><p>默认情况下根据重叠的列名进行合并</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df1, df2)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key</th><th>data2</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td><td>1</td></tr><tr><th>1</th><td>1</td><td>b</td><td>1</td></tr><tr><th>2</th><td>6</td><td>b</td><td>1</td></tr><tr><th>3</th><td>2</td><td>a</td><td>0</td></tr><tr><th>4</th><td>4</td><td>a</td><td>0</td></tr><tr><th>5</th><td>5</td><td>a</td><td>0</td></tr></tbody></table></div><p>最好进行显式地指定</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df1, df2, on=<span class="string">'key'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key</th><th>data2</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td><td>1</td></tr><tr><th>1</th><td>1</td><td>b</td><td>1</td></tr><tr><th>2</th><td>6</td><td>b</td><td>1</td></tr><tr><th>3</th><td>2</td><td>a</td><td>0</td></tr><tr><th>4</th><td>4</td><td>a</td><td>0</td></tr><tr><th>5</th><td>5</td><td>a</td><td>0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">df3 = DataFrame(&#123;<span class="string">'lkey'</span>: [<span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>],</div><div class="line">                 <span class="string">'data1'</span>: range(<span class="number">7</span>)&#125;)</div><div class="line">df4 = DataFrame(&#123;<span class="string">'rkey'</span>: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'d'</span>],</div><div class="line">                 <span class="string">'data2'</span>: range(<span class="number">3</span>)&#125;)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df3</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>lkey</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td></tr><tr><th>1</th><td>1</td><td>b</td></tr><tr><th>2</th><td>2</td><td>a</td></tr><tr><th>3</th><td>3</td><td>c</td></tr><tr><th>4</th><td>4</td><td>a</td></tr><tr><th>5</th><td>5</td><td>a</td></tr><tr><th>6</th><td>6</td><td>b</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df4</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data2</th><th>rkey</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>a</td></tr><tr><th>1</th><td>1</td><td>b</td></tr><tr><th>2</th><td>2</td><td>d</td></tr></tbody></table></div><p>如果两个对象的列名不同，那么就需要分别指定</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df3, df4, left_on=<span class="string">'lkey'</span>, right_on=<span class="string">'rkey'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>lkey</th><th>data2</th><th>rkey</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td><td>1</td><td>b</td></tr><tr><th>1</th><td>1</td><td>b</td><td>1</td><td>b</td></tr><tr><th>2</th><td>6</td><td>b</td><td>1</td><td>b</td></tr><tr><th>3</th><td>2</td><td>a</td><td>0</td><td>a</td></tr><tr><th>4</th><td>4</td><td>a</td><td>0</td><td>a</td></tr><tr><th>5</th><td>5</td><td>a</td><td>0</td><td>a</td></tr></tbody></table></div><p>默认是进行inner连接（交集）， outer是求取并集</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df1, df2, how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key</th><th>data2</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>b</td><td>1.0</td></tr><tr><th>1</th><td>1.0</td><td>b</td><td>1.0</td></tr><tr><th>2</th><td>6.0</td><td>b</td><td>1.0</td></tr><tr><th>3</th><td>2.0</td><td>a</td><td>0.0</td></tr><tr><th>4</th><td>4.0</td><td>a</td><td>0.0</td></tr><tr><th>5</th><td>5.0</td><td>a</td><td>0.0</td></tr><tr><th>6</th><td>3.0</td><td>c</td><td>NaN</td></tr><tr><th>7</th><td>NaN</td><td>d</td><td>2.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(&#123;<span class="string">'key'</span>: [<span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>],</div><div class="line">                 <span class="string">'data1'</span>: range(<span class="number">6</span>)&#125;)</div><div class="line">df2 = DataFrame(&#123;<span class="string">'key'</span>: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'d'</span>],</div><div class="line">                 <span class="string">'data2'</span>: range(<span class="number">5</span>)&#125;)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df1</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td></tr><tr><th>1</th><td>1</td><td>b</td></tr><tr><th>2</th><td>2</td><td>a</td></tr><tr><th>3</th><td>3</td><td>c</td></tr><tr><th>4</th><td>4</td><td>a</td></tr><tr><th>5</th><td>5</td><td>b</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data2</th><th>key</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>a</td></tr><tr><th>1</th><td>1</td><td>b</td></tr><tr><th>2</th><td>2</td><td>a</td></tr><tr><th>3</th><td>3</td><td>b</td></tr><tr><th>4</th><td>4</td><td>d</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df1, df2, on=<span class="string">'key'</span>, how=<span class="string">'left'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key</th><th>data2</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td><td>1.0</td></tr><tr><th>1</th><td>0</td><td>b</td><td>3.0</td></tr><tr><th>2</th><td>1</td><td>b</td><td>1.0</td></tr><tr><th>3</th><td>1</td><td>b</td><td>3.0</td></tr><tr><th>4</th><td>2</td><td>a</td><td>0.0</td></tr><tr><th>5</th><td>2</td><td>a</td><td>2.0</td></tr><tr><th>6</th><td>3</td><td>c</td><td>NaN</td></tr><tr><th>7</th><td>4</td><td>a</td><td>0.0</td></tr><tr><th>8</th><td>4</td><td>a</td><td>2.0</td></tr><tr><th>9</th><td>5</td><td>b</td><td>1.0</td></tr><tr><th>10</th><td>5</td><td>b</td><td>3.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df1, df2, how=<span class="string">'inner'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key</th><th>data2</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td><td>1</td></tr><tr><th>1</th><td>0</td><td>b</td><td>3</td></tr><tr><th>2</th><td>1</td><td>b</td><td>1</td></tr><tr><th>3</th><td>1</td><td>b</td><td>3</td></tr><tr><th>4</th><td>5</td><td>b</td><td>1</td></tr><tr><th>5</th><td>5</td><td>b</td><td>3</td></tr><tr><th>6</th><td>2</td><td>a</td><td>0</td></tr><tr><th>7</th><td>2</td><td>a</td><td>2</td></tr><tr><th>8</th><td>4</td><td>a</td><td>0</td></tr><tr><th>9</th><td>4</td><td>a</td><td>2</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">left = DataFrame(&#123;<span class="string">'key1'</span>: [<span class="string">'foo'</span>, <span class="string">'foo'</span>, <span class="string">'bar'</span>],</div><div class="line">                  <span class="string">'key2'</span>: [<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'one'</span>],</div><div class="line">                  <span class="string">'lval'</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;)</div><div class="line">right = DataFrame(&#123;<span class="string">'key1'</span>: [<span class="string">'foo'</span>, <span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'bar'</span>],</div><div class="line">                   <span class="string">'key2'</span>: [<span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>],</div><div class="line">                   <span class="string">'rval'</span>: [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]&#125;)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">left</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key1</th><th>key2</th><th>lval</th></tr></thead><tbody><tr><th>0</th><td>foo</td><td>one</td><td>1</td></tr><tr><th>1</th><td>foo</td><td>two</td><td>2</td></tr><tr><th>2</th><td>bar</td><td>one</td><td>3</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">right</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key1</th><th>key2</th><th>rval</th></tr></thead><tbody><tr><th>0</th><td>foo</td><td>one</td><td>4</td></tr><tr><th>1</th><td>foo</td><td>one</td><td>5</td></tr><tr><th>2</th><td>bar</td><td>one</td><td>6</td></tr><tr><th>3</th><td>bar</td><td>two</td><td>7</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(left, right, on=[<span class="string">'key1'</span>, <span class="string">'key2'</span>], how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key1</th><th>key2</th><th>lval</th><th>rval</th></tr></thead><tbody><tr><th>0</th><td>foo</td><td>one</td><td>1.0</td><td>4.0</td></tr><tr><th>1</th><td>foo</td><td>one</td><td>1.0</td><td>5.0</td></tr><tr><th>2</th><td>foo</td><td>two</td><td>2.0</td><td>NaN</td></tr><tr><th>3</th><td>bar</td><td>one</td><td>3.0</td><td>6.0</td></tr><tr><th>4</th><td>bar</td><td>two</td><td>NaN</td><td>7.0</td></tr></tbody></table></div><p>列名重复问题</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(left, right, on=<span class="string">'key1'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key1</th><th>key2_x</th><th>lval</th><th>key2_y</th><th>rval</th></tr></thead><tbody><tr><th>0</th><td>foo</td><td>one</td><td>1</td><td>one</td><td>4</td></tr><tr><th>1</th><td>foo</td><td>one</td><td>1</td><td>one</td><td>5</td></tr><tr><th>2</th><td>foo</td><td>two</td><td>2</td><td>one</td><td>4</td></tr><tr><th>3</th><td>foo</td><td>two</td><td>2</td><td>one</td><td>5</td></tr><tr><th>4</th><td>bar</td><td>one</td><td>3</td><td>one</td><td>6</td></tr><tr><th>5</th><td>bar</td><td>one</td><td>3</td><td>two</td><td>7</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(left, right, on=<span class="string">'key1'</span>, suffixes=(<span class="string">'_left'</span>, <span class="string">'_right'</span>))</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key1</th><th>key2_left</th><th>lval</th><th>key2_right</th><th>rval</th></tr></thead><tbody><tr><th>0</th><td>foo</td><td>one</td><td>1</td><td>one</td><td>4</td></tr><tr><th>1</th><td>foo</td><td>one</td><td>1</td><td>one</td><td>5</td></tr><tr><th>2</th><td>foo</td><td>two</td><td>2</td><td>one</td><td>4</td></tr><tr><th>3</th><td>foo</td><td>two</td><td>2</td><td>one</td><td>5</td></tr><tr><th>4</th><td>bar</td><td>one</td><td>3</td><td>one</td><td>6</td></tr><tr><th>5</th><td>bar</td><td>one</td><td>3</td><td>two</td><td>7</td></tr></tbody></table></div><h3 id="索引上的合并"><a href="#索引上的合并" class="headerlink" title="索引上的合并"></a>索引上的合并</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">left1 = DataFrame(&#123;<span class="string">'key'</span>: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>],</div><div class="line">                  <span class="string">'value'</span>: range(<span class="number">6</span>)&#125;)</div><div class="line">right1 = DataFrame(&#123;<span class="string">'group_val'</span>: [<span class="number">3.5</span>, <span class="number">7</span>]&#125;, index=[<span class="string">'a'</span>, <span class="string">'b'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">left1</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key</th><th>value</th></tr></thead><tbody><tr><th>0</th><td>a</td><td>0</td></tr><tr><th>1</th><td>b</td><td>1</td></tr><tr><th>2</th><td>a</td><td>2</td></tr><tr><th>3</th><td>a</td><td>3</td></tr><tr><th>4</th><td>b</td><td>4</td></tr><tr><th>5</th><td>c</td><td>5</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">right1</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>group_val</th></tr></thead><tbody><tr><th>a</th><td>3.5</td></tr><tr><th>b</th><td>7.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(left1, right1, left_on=<span class="string">'key'</span>, right_index=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key</th><th>value</th><th>group_val</th></tr></thead><tbody><tr><th>0</th><td>a</td><td>0</td><td>3.5</td></tr><tr><th>2</th><td>a</td><td>2</td><td>3.5</td></tr><tr><th>3</th><td>a</td><td>3</td><td>3.5</td></tr><tr><th>1</th><td>b</td><td>1</td><td>7.0</td></tr><tr><th>4</th><td>b</td><td>4</td><td>7.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(left1, right1, left_on=<span class="string">'key'</span>, right_index=<span class="keyword">True</span>, how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key</th><th>value</th><th>group_val</th></tr></thead><tbody><tr><th>0</th><td>a</td><td>0</td><td>3.5</td></tr><tr><th>2</th><td>a</td><td>2</td><td>3.5</td></tr><tr><th>3</th><td>a</td><td>3</td><td>3.5</td></tr><tr><th>1</th><td>b</td><td>1</td><td>7.0</td></tr><tr><th>4</th><td>b</td><td>4</td><td>7.0</td></tr><tr><th>5</th><td>c</td><td>5</td><td>NaN</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">lefth = DataFrame(&#123;<span class="string">'key1'</span>: [<span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Nevada'</span>, <span class="string">'Nevada'</span>],</div><div class="line">                   <span class="string">'key2'</span>: [<span class="number">2000</span>, <span class="number">2001</span>, <span class="number">2002</span>, <span class="number">2001</span>, <span class="number">2002</span>],</div><div class="line">                   <span class="string">'data'</span>: np.arange(<span class="number">5.</span>)&#125;)</div><div class="line">righth = DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">6</span>, <span class="number">2</span>)),</div><div class="line">                   index=[[<span class="string">'Nevada'</span>, <span class="string">'Nevada'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>],</div><div class="line">                          [<span class="number">2001</span>, <span class="number">2000</span>, <span class="number">2000</span>, <span class="number">2000</span>, <span class="number">2001</span>, <span class="number">2002</span>]],</div><div class="line">                   columns=[<span class="string">'event1'</span>, <span class="string">'event2'</span>])</div><div class="line">lefth</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data</th><th>key1</th><th>key2</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>Ohio</td><td>2000</td></tr><tr><th>1</th><td>1.0</td><td>Ohio</td><td>2001</td></tr><tr><th>2</th><td>2.0</td><td>Ohio</td><td>2002</td></tr><tr><th>3</th><td>3.0</td><td>Nevada</td><td>2001</td></tr><tr><th>4</th><td>4.0</td><td>Nevada</td><td>2002</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">righth</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th></th><th>event1</th><th>event2</th></tr></thead><tbody><tr><th rowspan="2" valign="top">Nevada</th><th>2001</th><td>0</td><td>1</td></tr><tr><th>2000</th><td>2</td><td>3</td></tr><tr><th rowspan="4" valign="top">Ohio</th><th>2000</th><td>4</td><td>5</td></tr><tr><th>2000</th><td>6</td><td>7</td></tr><tr><th>2001</th><td>8</td><td>9</td></tr><tr><th>2002</th><td>10</td><td>11</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(lefth, righth, left_on=[<span class="string">'key1'</span>, <span class="string">'key2'</span>], right_index=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data</th><th>key1</th><th>key2</th><th>event1</th><th>event2</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>Ohio</td><td>2000</td><td>4</td><td>5</td></tr><tr><th>0</th><td>0.0</td><td>Ohio</td><td>2000</td><td>6</td><td>7</td></tr><tr><th>1</th><td>1.0</td><td>Ohio</td><td>2001</td><td>8</td><td>9</td></tr><tr><th>2</th><td>2.0</td><td>Ohio</td><td>2002</td><td>10</td><td>11</td></tr><tr><th>3</th><td>3.0</td><td>Nevada</td><td>2001</td><td>0</td><td>1</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pd.merge(lefth, righth, left_on=[<span class="string">'key1'</span>, <span class="string">'key2'</span>],</div><div class="line">         right_index=<span class="keyword">True</span>, how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data</th><th>key1</th><th>key2</th><th>event1</th><th>event2</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>Ohio</td><td>2000.0</td><td>4.0</td><td>5.0</td></tr><tr><th>0</th><td>0.0</td><td>Ohio</td><td>2000.0</td><td>6.0</td><td>7.0</td></tr><tr><th>1</th><td>1.0</td><td>Ohio</td><td>2001.0</td><td>8.0</td><td>9.0</td></tr><tr><th>2</th><td>2.0</td><td>Ohio</td><td>2002.0</td><td>10.0</td><td>11.0</td></tr><tr><th>3</th><td>3.0</td><td>Nevada</td><td>2001.0</td><td>0.0</td><td>1.0</td></tr><tr><th>4</th><td>4.0</td><td>Nevada</td><td>2002.0</td><td>NaN</td><td>NaN</td></tr><tr><th>4</th><td>NaN</td><td>Nevada</td><td>2000.0</td><td>2.0</td><td>3.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">left2 = DataFrame([[<span class="number">1.</span>, <span class="number">2.</span>], [<span class="number">3.</span>, <span class="number">4.</span>], [<span class="number">5.</span>, <span class="number">6.</span>]], index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>],</div><div class="line">                 columns=[<span class="string">'Ohio'</span>, <span class="string">'Nevada'</span>])</div><div class="line">right2 = DataFrame([[<span class="number">7.</span>, <span class="number">8.</span>], [<span class="number">9.</span>, <span class="number">10.</span>], [<span class="number">11.</span>, <span class="number">12.</span>], [<span class="number">13</span>, <span class="number">14</span>]],</div><div class="line">                   index=[<span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>], columns=[<span class="string">'Missouri'</span>, <span class="string">'Alabama'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">left2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Ohio</th><th>Nevada</th></tr></thead><tbody><tr><th>a</th><td>1.0</td><td>2.0</td></tr><tr><th>c</th><td>3.0</td><td>4.0</td></tr><tr><th>e</th><td>5.0</td><td>6.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">right2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Missouri</th><th>Alabama</th></tr></thead><tbody><tr><th>b</th><td>7.0</td><td>8.0</td></tr><tr><th>c</th><td>9.0</td><td>10.0</td></tr><tr><th>d</th><td>11.0</td><td>12.0</td></tr><tr><th>e</th><td>13.0</td><td>14.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(left2, right2, how=<span class="string">'outer'</span>, left_index=<span class="keyword">True</span>, right_index=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Ohio</th><th>Nevada</th><th>Missouri</th><th>Alabama</th></tr></thead><tbody><tr><th>a</th><td>1.0</td><td>2.0</td><td>NaN</td><td>NaN</td></tr><tr><th>b</th><td>NaN</td><td>NaN</td><td>7.0</td><td>8.0</td></tr><tr><th>c</th><td>3.0</td><td>4.0</td><td>9.0</td><td>10.0</td></tr><tr><th>d</th><td>NaN</td><td>NaN</td><td>11.0</td><td>12.0</td></tr><tr><th>e</th><td>5.0</td><td>6.0</td><td>13.0</td><td>14.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">left2.join(right2, how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Ohio</th><th>Nevada</th><th>Missouri</th><th>Alabama</th></tr></thead><tbody><tr><th>a</th><td>1.0</td><td>2.0</td><td>NaN</td><td>NaN</td></tr><tr><th>b</th><td>NaN</td><td>NaN</td><td>7.0</td><td>8.0</td></tr><tr><th>c</th><td>3.0</td><td>4.0</td><td>9.0</td><td>10.0</td></tr><tr><th>d</th><td>NaN</td><td>NaN</td><td>11.0</td><td>12.0</td></tr><tr><th>e</th><td>5.0</td><td>6.0</td><td>13.0</td><td>14.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">left1.join(right1, on=<span class="string">'key'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key</th><th>value</th><th>group_val</th></tr></thead><tbody><tr><th>0</th><td>a</td><td>0</td><td>3.5</td></tr><tr><th>1</th><td>b</td><td>1</td><td>7.0</td></tr><tr><th>2</th><td>a</td><td>2</td><td>3.5</td></tr><tr><th>3</th><td>a</td><td>3</td><td>3.5</td></tr><tr><th>4</th><td>b</td><td>4</td><td>7.0</td></tr><tr><th>5</th><td>c</td><td>5</td><td>NaN</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">another = DataFrame([[<span class="number">7.</span>, <span class="number">8.</span>], [<span class="number">9.</span>, <span class="number">10.</span>], [<span class="number">11.</span>, <span class="number">12.</span>], [<span class="number">16.</span>, <span class="number">17.</span>]],</div><div class="line">                    index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>], columns=[<span class="string">'New York'</span>, <span class="string">'Oregon'</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>New York</th><th>Oregon</th></tr></thead><tbody><tr><th>a</th><td>7.0</td><td>8.0</td></tr><tr><th>c</th><td>9.0</td><td>10.0</td></tr><tr><th>e</th><td>11.0</td><td>12.0</td></tr><tr><th>f</th><td>16.0</td><td>17.0</td></tr></tbody></table></div><p>相当于三个表进行合并</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">left2</div><div class="line">right2</div><div class="line">another</div><div class="line">left2.join([right2, another])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Ohio</th><th>Nevada</th></tr></thead><tbody><tr><th>a</th><td>1.0</td><td>2.0</td></tr><tr><th>c</th><td>3.0</td><td>4.0</td></tr><tr><th>e</th><td>5.0</td><td>6.0</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Missouri</th><th>Alabama</th></tr></thead><tbody><tr><th>b</th><td>7.0</td><td>8.0</td></tr><tr><th>c</th><td>9.0</td><td>10.0</td></tr><tr><th>d</th><td>11.0</td><td>12.0</td></tr><tr><th>e</th><td>13.0</td><td>14.0</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>New York</th><th>Oregon</th></tr></thead><tbody><tr><th>a</th><td>7.0</td><td>8.0</td></tr><tr><th>c</th><td>9.0</td><td>10.0</td></tr><tr><th>e</th><td>11.0</td><td>12.0</td></tr><tr><th>f</th><td>16.0</td><td>17.0</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Ohio</th><th>Nevada</th><th>Missouri</th><th>Alabama</th><th>New York</th><th>Oregon</th></tr></thead><tbody><tr><th>a</th><td>1.0</td><td>2.0</td><td>NaN</td><td>NaN</td><td>7.0</td><td>8.0</td></tr><tr><th>c</th><td>3.0</td><td>4.0</td><td>9.0</td><td>10.0</td><td>9.0</td><td>10.0</td></tr><tr><th>e</th><td>5.0</td><td>6.0</td><td>13.0</td><td>14.0</td><td>11.0</td><td>12.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">left2.join([right2, another], how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure><h3 id="轴向连接"><a href="#轴向连接" class="headerlink" title="轴向连接"></a>轴向连接</h3><p>之前指的都是行级别的连接操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>, <span class="number">4</span>))</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arr</div></pre></td></tr></table></figure><pre><code>array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.concatenate([arr, arr], axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><pre><code>array([[ 0,  1,  2,  3,  0,  1,  2,  3],
       [ 4,  5,  6,  7,  4,  5,  6,  7],
       [ 8,  9, 10, 11,  8,  9, 10, 11]])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">s1 = Series([<span class="number">0</span>, <span class="number">1</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>])</div><div class="line">s2 = Series([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], index=[<span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">s3 = Series([<span class="number">5</span>, <span class="number">6</span>], index=[<span class="string">'f'</span>, <span class="string">'g'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.concat([s1, s2, s3])</div></pre></td></tr></table></figure><pre><code>a    0
b    1
c    2
d    3
e    4
f    5
g    6
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.concat([s1, s2, s3], axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th></tr></thead><tbody><tr><th>a</th><td>0.0</td><td>NaN</td><td>NaN</td></tr><tr><th>b</th><td>1.0</td><td>NaN</td><td>NaN</td></tr><tr><th>c</th><td>NaN</td><td>2.0</td><td>NaN</td></tr><tr><th>d</th><td>NaN</td><td>3.0</td><td>NaN</td></tr><tr><th>e</th><td>NaN</td><td>4.0</td><td>NaN</td></tr><tr><th>f</th><td>NaN</td><td>NaN</td><td>5.0</td></tr><tr><th>g</th><td>NaN</td><td>NaN</td><td>6.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">s4 = pd.concat([s1 * <span class="number">5</span>, s3])</div><div class="line">s4</div></pre></td></tr></table></figure><pre><code>a    0
b    5
f    5
g    6
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.concat([s1, s4], axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th></tr></thead><tbody><tr><th>a</th><td>0.0</td><td>0</td></tr><tr><th>b</th><td>1.0</td><td>5</td></tr><tr><th>f</th><td>NaN</td><td>5</td></tr><tr><th>g</th><td>NaN</td><td>6</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.concat([s1, s4], axis=<span class="number">1</span>, join=<span class="string">'inner'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th></tr></thead><tbody><tr><th>a</th><td>0</td><td>0</td></tr><tr><th>b</th><td>1</td><td>5</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.concat([s1, s4], axis=<span class="number">1</span>, join_axes=[[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'e'</span>]])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th></tr></thead><tbody><tr><th>a</th><td>0.0</td><td>0.0</td></tr><tr><th>c</th><td>NaN</td><td>NaN</td></tr><tr><th>b</th><td>1.0</td><td>5.0</td></tr><tr><th>e</th><td>NaN</td><td>NaN</td></tr></tbody></table></div><p>在连接轴上建立一个层次化索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">s1</div><div class="line">s3</div><div class="line">result = pd.concat([s1, s1, s3], keys=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>])</div></pre></td></tr></table></figure><pre><code>a    0
b    1
dtype: int64






f    5
g    6
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">result</div></pre></td></tr></table></figure><pre><code>one    a    0
       b    1
two    a    0
       b    1
three  f    5
       g    6
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Much more on the unstack function later</span></div><div class="line">result.unstack()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>f</th><th>g</th></tr></thead><tbody><tr><th>one</th><td>0.0</td><td>1.0</td><td>NaN</td><td>NaN</td></tr><tr><th>two</th><td>0.0</td><td>1.0</td><td>NaN</td><td>NaN</td></tr><tr><th>three</th><td>NaN</td><td>NaN</td><td>5.0</td><td>6.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.concat([s1, s2, s3], axis=<span class="number">1</span>, keys=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th></tr></thead><tbody><tr><th>a</th><td>0.0</td><td>NaN</td><td>NaN</td></tr><tr><th>b</th><td>1.0</td><td>NaN</td><td>NaN</td></tr><tr><th>c</th><td>NaN</td><td>2.0</td><td>NaN</td></tr><tr><th>d</th><td>NaN</td><td>3.0</td><td>NaN</td></tr><tr><th>e</th><td>NaN</td><td>4.0</td><td>NaN</td></tr><tr><th>f</th><td>NaN</td><td>NaN</td><td>5.0</td></tr><tr><th>g</th><td>NaN</td><td>NaN</td><td>6.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(np.arange(<span class="number">6</span>).reshape(<span class="number">3</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>],</div><div class="line">                columns=[<span class="string">'one'</span>, <span class="string">'two'</span>])</div><div class="line">df2 = DataFrame(<span class="number">5</span> + np.arange(<span class="number">4</span>).reshape(<span class="number">2</span>, <span class="number">2</span>), index=[<span class="string">'a'</span>, <span class="string">'c'</span>],</div><div class="line">                columns=[<span class="string">'three'</span>, <span class="string">'four'</span>])</div><div class="line">df1</div><div class="line">df2</div><div class="line">pd.concat([df1, df2], keys=[<span class="string">'level1'</span>, <span class="string">'level2'</span>])</div><div class="line">pd.concat([df1, df2], axis=<span class="number">1</span>, keys=[<span class="string">'level1'</span>, <span class="string">'level2'</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th></tr></thead><tbody><tr><th>a</th><td>0</td><td>1</td></tr><tr><th>b</th><td>2</td><td>3</td></tr><tr><th>c</th><td>4</td><td>5</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>three</th><th>four</th></tr></thead><tbody><tr><th>a</th><td>5</td><td>6</td></tr><tr><th>c</th><td>7</td><td>8</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th></th><th>four</th><th>one</th><th>three</th><th>two</th></tr></thead><tbody><tr><th rowspan="3" valign="top">level1</th><th>a</th><td>NaN</td><td>0.0</td><td>NaN</td><td>1.0</td></tr><tr><th>b</th><td>NaN</td><td>2.0</td><td>NaN</td><td>3.0</td></tr><tr><th>c</th><td>NaN</td><td>4.0</td><td>NaN</td><td>5.0</td></tr><tr><th rowspan="2" valign="top">level2</th><th>a</th><td>6.0</td><td>NaN</td><td>5.0</td><td>NaN</td></tr><tr><th>c</th><td>8.0</td><td>NaN</td><td>7.0</td><td>NaN</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr><th></th><th colspan="2" halign="left">level1</th><th colspan="2" halign="left">level2</th></tr><tr><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>a</th><td>0</td><td>1</td><td>5.0</td><td>6.0</td></tr><tr><th>b</th><td>2</td><td>3</td><td>NaN</td><td>NaN</td></tr><tr><th>c</th><td>4</td><td>5</td><td>7.0</td><td>8.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pd.concat(&#123;<span class="string">'level1'</span>: df1, <span class="string">'level2'</span>: df2&#125;, axis=<span class="number">0</span>)</div><div class="line">pd.concat(&#123;<span class="string">'level1'</span>: df1, <span class="string">'level2'</span>: df2&#125;, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th></th><th>four</th><th>one</th><th>three</th><th>two</th></tr></thead><tbody><tr><th rowspan="3" valign="top">level1</th><th>a</th><td>NaN</td><td>0.0</td><td>NaN</td><td>1.0</td></tr><tr><th>b</th><td>NaN</td><td>2.0</td><td>NaN</td><td>3.0</td></tr><tr><th>c</th><td>NaN</td><td>4.0</td><td>NaN</td><td>5.0</td></tr><tr><th rowspan="2" valign="top">level2</th><th>a</th><td>6.0</td><td>NaN</td><td>5.0</td><td>NaN</td></tr><tr><th>c</th><td>8.0</td><td>NaN</td><td>7.0</td><td>NaN</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr><th></th><th colspan="2" halign="left">level1</th><th colspan="2" halign="left">level2</th></tr><tr><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>a</th><td>0</td><td>1</td><td>5.0</td><td>6.0</td></tr><tr><th>b</th><td>2</td><td>3</td><td>NaN</td><td>NaN</td></tr><tr><th>c</th><td>4</td><td>5</td><td>7.0</td><td>8.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pd.concat([df1, df2], axis=<span class="number">1</span>, keys=[<span class="string">'level1'</span>, <span class="string">'level2'</span>],</div><div class="line">          names=[<span class="string">'upper'</span>, <span class="string">'lower'</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr><th>upper</th><th colspan="2" halign="left">level1</th><th colspan="2" halign="left">level2</th></tr><tr><th>lower</th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>a</th><td>0</td><td>1</td><td>5.0</td><td>6.0</td></tr><tr><th>b</th><td>2</td><td>3</td><td>NaN</td><td>NaN</td></tr><tr><th>c</th><td>4</td><td>5</td><td>7.0</td><td>8.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(np.random.randn(<span class="number">3</span>, <span class="number">4</span>), columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">df2 = DataFrame(np.random.randn(<span class="number">2</span>, <span class="number">3</span>), columns=[<span class="string">'b'</span>, <span class="string">'d'</span>, <span class="string">'a'</span>])</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df1</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th></tr></thead><tbody><tr><th>0</th><td>-0.204708</td><td>0.478943</td><td>-0.519439</td><td>-0.555730</td></tr><tr><th>1</th><td>1.965781</td><td>1.393406</td><td>0.092908</td><td>0.281746</td></tr><tr><th>2</th><td>0.769023</td><td>1.246435</td><td>1.007189</td><td>-1.296221</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df2</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>b</th><th>d</th><th>a</th></tr></thead><tbody><tr><th>0</th><td>0.274992</td><td>0.228913</td><td>1.352917</td></tr><tr><th>1</th><td>0.886429</td><td>-2.001637</td><td>-0.371843</td></tr></tbody></table></div><p>去除无关的行索引</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pd.concat([df1, df2], ignore_index=<span class="keyword">False</span>)</div><div class="line">pd.concat([df1, df2], ignore_index=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th></tr></thead><tbody><tr><th>0</th><td>-0.204708</td><td>0.478943</td><td>-0.519439</td><td>-0.555730</td></tr><tr><th>1</th><td>1.965781</td><td>1.393406</td><td>0.092908</td><td>0.281746</td></tr><tr><th>2</th><td>0.769023</td><td>1.246435</td><td>1.007189</td><td>-1.296221</td></tr><tr><th>0</th><td>1.352917</td><td>0.274992</td><td>NaN</td><td>0.228913</td></tr><tr><th>1</th><td>-0.371843</td><td>0.886429</td><td>NaN</td><td>-2.001637</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th></tr></thead><tbody><tr><th>0</th><td>-0.204708</td><td>0.478943</td><td>-0.519439</td><td>-0.555730</td></tr><tr><th>1</th><td>1.965781</td><td>1.393406</td><td>0.092908</td><td>0.281746</td></tr><tr><th>2</th><td>0.769023</td><td>1.246435</td><td>1.007189</td><td>-1.296221</td></tr><tr><th>3</th><td>1.352917</td><td>0.274992</td><td>NaN</td><td>0.228913</td></tr><tr><th>4</th><td>-0.371843</td><td>0.886429</td><td>NaN</td><td>-2.001637</td></tr></tbody></table></div><h3 id="合并重叠数据"><a href="#合并重叠数据" class="headerlink" title="合并重叠数据"></a>合并重叠数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">a = Series([np.nan, <span class="number">2.5</span>, np.nan, <span class="number">3.5</span>, <span class="number">4.5</span>, np.nan],</div><div class="line">           index=[<span class="string">'f'</span>, <span class="string">'e'</span>, <span class="string">'d'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>])</div><div class="line">b = Series(np.arange(len(a), dtype=np.float64),</div><div class="line">           index=[<span class="string">'f'</span>, <span class="string">'e'</span>, <span class="string">'d'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>])</div><div class="line">b[<span class="number">-1</span>] = np.nan</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a</div></pre></td></tr></table></figure><pre><code>f    NaN
e    2.5
d    NaN
c    3.5
b    4.5
a    NaN
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">b</div></pre></td></tr></table></figure><pre><code>f    0.0
e    1.0
d    2.0
c    3.0
b    4.0
a    NaN
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.where(pd.isnull(a), b, a)</div></pre></td></tr></table></figure><pre><code>array([ 0. ,  2.5,  2. ,  3.5,  4.5,  nan])
</code></pre><p>combine_first, 重叠值合并，且进行数据对其</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">b[:<span class="number">-2</span>].combine_first(a[<span class="number">2</span>:])</div></pre></td></tr></table></figure><pre><code>a    NaN
b    4.5
c    3.0
d    2.0
e    1.0
f    0.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(&#123;<span class="string">'a'</span>: [<span class="number">1.</span>, np.nan, <span class="number">5.</span>, np.nan],</div><div class="line">                 <span class="string">'b'</span>: [np.nan, <span class="number">2.</span>, np.nan, <span class="number">6.</span>],</div><div class="line">                 <span class="string">'c'</span>: range(<span class="number">2</span>, <span class="number">18</span>, <span class="number">4</span>)&#125;)</div><div class="line">df2 = DataFrame(&#123;<span class="string">'a'</span>: [<span class="number">5.</span>, <span class="number">4.</span>, np.nan, <span class="number">3.</span>, <span class="number">7.</span>],</div><div class="line">                 <span class="string">'b'</span>: [np.nan, <span class="number">3.</span>, <span class="number">4.</span>, <span class="number">6.</span>, <span class="number">8.</span>]&#125;)</div><div class="line">df1</div><div class="line">df2</div><div class="line">df1.combine_first(df2)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th></tr></thead><tbody><tr><th>0</th><td>1.0</td><td>NaN</td><td>2</td></tr><tr><th>1</th><td>NaN</td><td>2.0</td><td>6</td></tr><tr><th>2</th><td>5.0</td><td>NaN</td><td>10</td></tr><tr><th>3</th><td>NaN</td><td>6.0</td><td>14</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th></tr></thead><tbody><tr><th>0</th><td>5.0</td><td>NaN</td></tr><tr><th>1</th><td>4.0</td><td>3.0</td></tr><tr><th>2</th><td>NaN</td><td>4.0</td></tr><tr><th>3</th><td>3.0</td><td>6.0</td></tr><tr><th>4</th><td>7.0</td><td>8.0</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th></tr></thead><tbody><tr><th>0</th><td>1.0</td><td>NaN</td><td>2.0</td></tr><tr><th>1</th><td>4.0</td><td>2.0</td><td>6.0</td></tr><tr><th>2</th><td>5.0</td><td>4.0</td><td>10.0</td></tr><tr><th>3</th><td>3.0</td><td>6.0</td><td>14.0</td></tr><tr><th>4</th><td>7.0</td><td>8.0</td><td>NaN</td></tr></tbody></table></div><h2 id="重塑和轴向旋转"><a href="#重塑和轴向旋转" class="headerlink" title="重塑和轴向旋转"></a>重塑和轴向旋转</h2><h3 id="重塑层次化索引"><a href="#重塑层次化索引" class="headerlink" title="重塑层次化索引"></a>重塑层次化索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(np.arange(<span class="number">6</span>).reshape((<span class="number">2</span>, <span class="number">3</span>)),</div><div class="line">                 index=pd.Index([<span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>], name=<span class="string">'state'</span>),</div><div class="line">                 columns=pd.Index([<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>], name=<span class="string">'number'</span>))</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>number</th><th>one</th><th>two</th><th>three</th></tr><tr><th>state</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>Ohio</th><td>0</td><td>1</td><td>2</td></tr><tr><th>Colorado</th><td>3</td><td>4</td><td>5</td></tr></tbody></table></div><p>stack将列旋转为行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = data.stack()</div><div class="line">result</div></pre></td></tr></table></figure><pre><code>state     number
Ohio      one       0
          two       1
          three     2
Colorado  one       3
          two       4
          three     5
dtype: int32
</code></pre><p>unstack将行旋转为列，默认操作最内层</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">result.unstack()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>number</th><th>one</th><th>two</th><th>three</th></tr><tr><th>state</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>Ohio</th><td>0</td><td>1</td><td>2</td></tr><tr><th>Colorado</th><td>3</td><td>4</td><td>5</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">result.unstack(<span class="number">0</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>state</th><th>Ohio</th><th>Colorado</th></tr><tr><th>number</th><th></th><th></th></tr></thead><tbody><tr><th>one</th><td>0</td><td>3</td></tr><tr><th>two</th><td>1</td><td>4</td></tr><tr><th>three</th><td>2</td><td>5</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">result.unstack(<span class="string">'state'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>state</th><th>Ohio</th><th>Colorado</th></tr><tr><th>number</th><th></th><th></th></tr></thead><tbody><tr><th>one</th><td>0</td><td>3</td></tr><tr><th>two</th><td>1</td><td>4</td></tr><tr><th>three</th><td>2</td><td>5</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">s1 = Series([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">s2 = Series([<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], index=[<span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">s1</div><div class="line">s2</div><div class="line">data2 = pd.concat([s1, s2], keys=[<span class="string">'one'</span>, <span class="string">'two'</span>])</div><div class="line">data2</div><div class="line">data2.unstack()</div></pre></td></tr></table></figure><pre><code>a    0
b    1
c    2
d    3
dtype: int64






c    4
d    5
e    6
dtype: int64






one  a    0
     b    1
     c    2
     d    3
two  c    4
     d    5
     e    6
dtype: int64
</code></pre><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th><th>d</th><th>e</th></tr></thead><tbody><tr><th>one</th><td>0.0</td><td>1.0</td><td>2.0</td><td>3.0</td><td>NaN</td></tr><tr><th>two</th><td>NaN</td><td>NaN</td><td>4.0</td><td>5.0</td><td>6.0</td></tr></tbody></table></div><p>stack默认会滤除缺失值，因此两者可逆</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data2.unstack().stack()</div></pre></td></tr></table></figure><pre><code>one  a    0.0
     b    1.0
     c    2.0
     d    3.0
two  c    4.0
     d    5.0
     e    6.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data2.unstack().stack(dropna=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><pre><code>one  a    0.0
     b    1.0
     c    2.0
     d    3.0
     e    NaN
two  a    NaN
     b    NaN
     c    4.0
     d    5.0
     e    6.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">result</div><div class="line">df = DataFrame(&#123;<span class="string">'left'</span>: result, <span class="string">'right'</span>: result + <span class="number">5</span>&#125;,</div><div class="line">               columns=pd.Index([<span class="string">'left'</span>, <span class="string">'right'</span>], name=<span class="string">'side'</span>))</div><div class="line">df</div></pre></td></tr></table></figure><pre><code>state     number
Ohio      one       0
          two       1
          three     2
Colorado  one       3
          two       4
          three     5
dtype: int32
</code></pre><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>side</th><th>left</th><th>right</th></tr><tr><th>state</th><th>number</th><th></th><th></th></tr></thead><tbody><tr><th rowspan="3" valign="top">Ohio</th><th>one</th><td>0</td><td>5</td></tr><tr><th>two</th><td>1</td><td>6</td></tr><tr><th>three</th><td>2</td><td>7</td></tr><tr><th rowspan="3" valign="top">Colorado</th><th>one</th><td>3</td><td>8</td></tr><tr><th>two</th><td>4</td><td>9</td></tr><tr><th>three</th><td>5</td><td>10</td></tr></tbody></table></div><p>DataFrame作为旋转轴的级别将成为结果中的最低级别（axis=MAX）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.unstack(<span class="string">'state'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr><th>side</th><th colspan="2" halign="left">left</th><th colspan="2" halign="left">right</th></tr><tr><th>state</th><th>Ohio</th><th>Colorado</th><th>Ohio</th><th>Colorado</th></tr><tr><th>number</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>one</th><td>0</td><td>3</td><td>5</td><td>8</td></tr><tr><th>two</th><td>1</td><td>4</td><td>6</td><td>9</td></tr><tr><th>three</th><td>2</td><td>5</td><td>7</td><td>10</td></tr></tbody></table></div><p>stack操作将axis-1?</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.unstack(<span class="string">'state'</span>).stack(<span class="string">'side'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>state</th><th>Ohio</th><th>Colorado</th></tr><tr><th>number</th><th>side</th><th></th><th></th></tr></thead><tbody><tr><th rowspan="2" valign="top">one</th><th>left</th><td>0</td><td>3</td></tr><tr><th>right</th><td>5</td><td>8</td></tr><tr><th rowspan="2" valign="top">two</th><th>left</th><td>1</td><td>4</td></tr><tr><th>right</th><td>6</td><td>9</td></tr><tr><th rowspan="2" valign="top">three</th><th>left</th><td>2</td><td>5</td></tr><tr><th>right</th><td>7</td><td>10</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">df.unstack(<span class="string">'state'</span>)</div><div class="line">df.unstack(<span class="string">'state'</span>).stack(<span class="string">'state'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr><th>side</th><th colspan="2" halign="left">left</th><th colspan="2" halign="left">right</th></tr><tr><th>state</th><th>Ohio</th><th>Colorado</th><th>Ohio</th><th>Colorado</th></tr><tr><th>number</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>one</th><td>0</td><td>3</td><td>5</td><td>8</td></tr><tr><th>two</th><td>1</td><td>4</td><td>6</td><td>9</td></tr><tr><th>three</th><td>2</td><td>5</td><td>7</td><td>10</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>side</th><th>left</th><th>right</th></tr><tr><th>number</th><th>state</th><th></th><th></th></tr></thead><tbody><tr><th rowspan="2" valign="top">one</th><th>Ohio</th><td>0</td><td>5</td></tr><tr><th>Colorado</th><td>3</td><td>8</td></tr><tr><th rowspan="2" valign="top">two</th><th>Ohio</th><td>1</td><td>6</td></tr><tr><th>Colorado</th><td>4</td><td>9</td></tr><tr><th rowspan="2" valign="top">three</th><th>Ohio</th><td>2</td><td>7</td></tr><tr><th>Colorado</th><td>5</td><td>10</td></tr></tbody></table></div><h3 id="将长格式旋转为宽格式"><a href="#将长格式旋转为宽格式" class="headerlink" title="将长格式旋转为宽格式"></a>将长格式旋转为宽格式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">data = pd.read_csv(<span class="string">'ch07/macrodata.csv'</span>)</div><div class="line">data[:<span class="number">10</span>]</div><div class="line">periods = pd.PeriodIndex(year=data.year, quarter=data.quarter, name=<span class="string">'date'</span>)</div><div class="line">periods[:<span class="number">10</span>]</div><div class="line">data = DataFrame(data.to_records(),</div><div class="line">                 columns=pd.Index([<span class="string">'realgdp'</span>, <span class="string">'infl'</span>, <span class="string">'unemp'</span>], name=<span class="string">'item'</span>),</div><div class="line">                 index=periods.to_timestamp(<span class="string">'D'</span>, <span class="string">'end'</span>))</div><div class="line"></div><div class="line">data[:<span class="number">10</span>]</div><div class="line">data.to_records()[:<span class="number">10</span>]</div><div class="line">data.stack()[:<span class="number">10</span>]</div><div class="line">ldata = data.stack().reset_index().rename(columns=&#123;<span class="number">0</span>: <span class="string">'value'</span>&#125;)</div><div class="line">wdata = ldata.pivot(<span class="string">'date'</span>, <span class="string">'item'</span>, <span class="string">'value'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>year</th><th>quarter</th><th>realgdp</th><th>realcons</th><th>realinv</th><th>realgovt</th><th>realdpi</th><th>cpi</th><th>m1</th><th>tbilrate</th><th>unemp</th><th>pop</th><th>infl</th><th>realint</th></tr></thead><tbody><tr><th>0</th><td>1959.0</td><td>1.0</td><td>2710.349</td><td>1707.4</td><td>286.898</td><td>470.045</td><td>1886.9</td><td>28.98</td><td>139.7</td><td>2.82</td><td>5.8</td><td>177.146</td><td>0.00</td><td>0.00</td></tr><tr><th>1</th><td>1959.0</td><td>2.0</td><td>2778.801</td><td>1733.7</td><td>310.859</td><td>481.301</td><td>1919.7</td><td>29.15</td><td>141.7</td><td>3.08</td><td>5.1</td><td>177.830</td><td>2.34</td><td>0.74</td></tr><tr><th>2</th><td>1959.0</td><td>3.0</td><td>2775.488</td><td>1751.8</td><td>289.226</td><td>491.260</td><td>1916.4</td><td>29.35</td><td>140.5</td><td>3.82</td><td>5.3</td><td>178.657</td><td>2.74</td><td>1.09</td></tr><tr><th>3</th><td>1959.0</td><td>4.0</td><td>2785.204</td><td>1753.7</td><td>299.356</td><td>484.052</td><td>1931.3</td><td>29.37</td><td>140.0</td><td>4.33</td><td>5.6</td><td>179.386</td><td>0.27</td><td>4.06</td></tr><tr><th>4</th><td>1960.0</td><td>1.0</td><td>2847.699</td><td>1770.5</td><td>331.722</td><td>462.199</td><td>1955.5</td><td>29.54</td><td>139.6</td><td>3.50</td><td>5.2</td><td>180.007</td><td>2.31</td><td>1.19</td></tr><tr><th>5</th><td>1960.0</td><td>2.0</td><td>2834.390</td><td>1792.9</td><td>298.152</td><td>460.400</td><td>1966.1</td><td>29.55</td><td>140.2</td><td>2.68</td><td>5.2</td><td>180.671</td><td>0.14</td><td>2.55</td></tr><tr><th>6</th><td>1960.0</td><td>3.0</td><td>2839.022</td><td>1785.8</td><td>296.375</td><td>474.676</td><td>1967.8</td><td>29.75</td><td>140.9</td><td>2.36</td><td>5.6</td><td>181.528</td><td>2.70</td><td>-0.34</td></tr><tr><th>7</th><td>1960.0</td><td>4.0</td><td>2802.616</td><td>1788.2</td><td>259.764</td><td>476.434</td><td>1966.6</td><td>29.84</td><td>141.1</td><td>2.29</td><td>6.3</td><td>182.287</td><td>1.21</td><td>1.08</td></tr><tr><th>8</th><td>1961.0</td><td>1.0</td><td>2819.264</td><td>1787.7</td><td>266.405</td><td>475.854</td><td>1984.5</td><td>29.81</td><td>142.1</td><td>2.37</td><td>6.8</td><td>182.992</td><td>-0.40</td><td>2.77</td></tr><tr><th>9</th><td>1961.0</td><td>2.0</td><td>2872.005</td><td>1814.3</td><td>286.246</td><td>480.328</td><td>2014.4</td><td>29.92</td><td>142.9</td><td>2.29</td><td>7.0</td><td>183.691</td><td>1.47</td><td>0.81</td></tr></tbody></table></div><pre><code>PeriodIndex([&#39;1959Q1&#39;, &#39;1959Q2&#39;, &#39;1959Q3&#39;, &#39;1959Q4&#39;, &#39;1960Q1&#39;, &#39;1960Q2&#39;,
             &#39;1960Q3&#39;, &#39;1960Q4&#39;, &#39;1961Q1&#39;, &#39;1961Q2&#39;],
            dtype=&#39;int64&#39;, name=&#39;date&#39;, freq=&#39;Q-DEC&#39;)
</code></pre><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>item</th><th>realgdp</th><th>infl</th><th>unemp</th></tr><tr><th>date</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>1959-03-31</th><td>2710.349</td><td>0.00</td><td>5.8</td></tr><tr><th>1959-06-30</th><td>2778.801</td><td>2.34</td><td>5.1</td></tr><tr><th>1959-09-30</th><td>2775.488</td><td>2.74</td><td>5.3</td></tr><tr><th>1959-12-31</th><td>2785.204</td><td>0.27</td><td>5.6</td></tr><tr><th>1960-03-31</th><td>2847.699</td><td>2.31</td><td>5.2</td></tr><tr><th>1960-06-30</th><td>2834.390</td><td>0.14</td><td>5.2</td></tr><tr><th>1960-09-30</th><td>2839.022</td><td>2.70</td><td>5.6</td></tr><tr><th>1960-12-31</th><td>2802.616</td><td>1.21</td><td>6.3</td></tr><tr><th>1961-03-31</th><td>2819.264</td><td>-0.40</td><td>6.8</td></tr><tr><th>1961-06-30</th><td>2872.005</td><td>1.47</td><td>7.0</td></tr></tbody></table></div><pre><code>rec.array([(datetime.datetime(1959, 3, 31, 0, 0), 2710.349, 0.0, 5.8),
 (datetime.datetime(1959, 6, 30, 0, 0), 2778.801, 2.34, 5.1),
 (datetime.datetime(1959, 9, 30, 0, 0), 2775.488, 2.74, 5.3),
 (datetime.datetime(1959, 12, 31, 0, 0), 2785.204, 0.27, 5.6),
 (datetime.datetime(1960, 3, 31, 0, 0), 2847.699, 2.31, 5.2),
 (datetime.datetime(1960, 6, 30, 0, 0), 2834.39, 0.14, 5.2),
 (datetime.datetime(1960, 9, 30, 0, 0), 2839.022, 2.7, 5.6),
 (datetime.datetime(1960, 12, 31, 0, 0), 2802.616, 1.21, 6.3),
 (datetime.datetime(1961, 3, 31, 0, 0), 2819.264, -0.4, 6.8),
 (datetime.datetime(1961, 6, 30, 0, 0), 2872.005, 1.47, 7.0)], 
          dtype=[(&#39;date&#39;, &#39;O&#39;), (&#39;realgdp&#39;, &#39;&lt;f8&#39;), (&#39;infl&#39;, &#39;&lt;f8&#39;), (&#39;unemp&#39;, &#39;&lt;f8&#39;)])






date        item   
1959-03-31  realgdp    2710.349
            infl          0.000
            unemp         5.800
1959-06-30  realgdp    2778.801
            infl          2.340
            unemp         5.100
1959-09-30  realgdp    2775.488
            infl          2.740
            unemp         5.300
1959-12-31  realgdp    2785.204
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ldata[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>date</th><th>item</th><th>value</th></tr></thead><tbody><tr><th>0</th><td>1959-03-31</td><td>realgdp</td><td>2710.349</td></tr><tr><th>1</th><td>1959-03-31</td><td>infl</td><td>0.000</td></tr><tr><th>2</th><td>1959-03-31</td><td>unemp</td><td>5.800</td></tr><tr><th>3</th><td>1959-06-30</td><td>realgdp</td><td>2778.801</td></tr><tr><th>4</th><td>1959-06-30</td><td>infl</td><td>2.340</td></tr><tr><th>5</th><td>1959-06-30</td><td>unemp</td><td>5.100</td></tr><tr><th>6</th><td>1959-09-30</td><td>realgdp</td><td>2775.488</td></tr><tr><th>7</th><td>1959-09-30</td><td>infl</td><td>2.740</td></tr><tr><th>8</th><td>1959-09-30</td><td>unemp</td><td>5.300</td></tr><tr><th>9</th><td>1959-12-31</td><td>realgdp</td><td>2785.204</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pivoted = ldata.pivot(<span class="string">'date'</span>, <span class="string">'item'</span>, <span class="string">'value'</span>)</div><div class="line">pivoted.head()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>item</th><th>infl</th><th>realgdp</th><th>unemp</th></tr><tr><th>date</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>1959-03-31</th><td>0.00</td><td>2710.349</td><td>5.8</td></tr><tr><th>1959-06-30</th><td>2.34</td><td>2778.801</td><td>5.1</td></tr><tr><th>1959-09-30</th><td>2.74</td><td>2775.488</td><td>5.3</td></tr><tr><th>1959-12-31</th><td>0.27</td><td>2785.204</td><td>5.6</td></tr><tr><th>1960-03-31</th><td>2.31</td><td>2847.699</td><td>5.2</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ldata[<span class="string">'value2'</span>] = np.random.randn(len(ldata))</div><div class="line">ldata[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>date</th><th>item</th><th>value</th><th>value2</th></tr></thead><tbody><tr><th>0</th><td>1959-03-31</td><td>realgdp</td><td>2710.349</td><td>-0.204708</td></tr><tr><th>1</th><td>1959-03-31</td><td>infl</td><td>0.000</td><td>0.478943</td></tr><tr><th>2</th><td>1959-03-31</td><td>unemp</td><td>5.800</td><td>-0.519439</td></tr><tr><th>3</th><td>1959-06-30</td><td>realgdp</td><td>2778.801</td><td>-0.555730</td></tr><tr><th>4</th><td>1959-06-30</td><td>infl</td><td>2.340</td><td>1.965781</td></tr><tr><th>5</th><td>1959-06-30</td><td>unemp</td><td>5.100</td><td>1.393406</td></tr><tr><th>6</th><td>1959-09-30</td><td>realgdp</td><td>2775.488</td><td>0.092908</td></tr><tr><th>7</th><td>1959-09-30</td><td>infl</td><td>2.740</td><td>0.281746</td></tr><tr><th>8</th><td>1959-09-30</td><td>unemp</td><td>5.300</td><td>0.769023</td></tr><tr><th>9</th><td>1959-12-31</td><td>realgdp</td><td>2785.204</td><td>1.246435</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pivoted = ldata.pivot(<span class="string">'date'</span>, <span class="string">'item'</span>)</div><div class="line">pivoted[:<span class="number">5</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr><th></th><th colspan="3" halign="left">value</th><th colspan="3" halign="left">value2</th></tr><tr><th>item</th><th>infl</th><th>realgdp</th><th>unemp</th><th>infl</th><th>realgdp</th><th>unemp</th></tr><tr><th>date</th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>1959-03-31</th><td>0.00</td><td>2710.349</td><td>5.8</td><td>0.478943</td><td>-0.204708</td><td>-0.519439</td></tr><tr><th>1959-06-30</th><td>2.34</td><td>2778.801</td><td>5.1</td><td>1.965781</td><td>-0.555730</td><td>1.393406</td></tr><tr><th>1959-09-30</th><td>2.74</td><td>2775.488</td><td>5.3</td><td>0.281746</td><td>0.092908</td><td>0.769023</td></tr><tr><th>1959-12-31</th><td>0.27</td><td>2785.204</td><td>5.6</td><td>1.007189</td><td>1.246435</td><td>-1.296221</td></tr><tr><th>1960-03-31</th><td>2.31</td><td>2847.699</td><td>5.2</td><td>0.228913</td><td>0.274992</td><td>1.352917</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pivoted[<span class="string">'value'</span>][:<span class="number">5</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th>item</th><th>infl</th><th>realgdp</th><th>unemp</th></tr><tr><th>date</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>1959-03-31</th><td>0.00</td><td>2710.349</td><td>5.8</td></tr><tr><th>1959-06-30</th><td>2.34</td><td>2778.801</td><td>5.1</td></tr><tr><th>1959-09-30</th><td>2.74</td><td>2775.488</td><td>5.3</td></tr><tr><th>1959-12-31</th><td>0.27</td><td>2785.204</td><td>5.6</td></tr><tr><th>1960-03-31</th><td>2.31</td><td>2847.699</td><td>5.2</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ldata.set_index([<span class="string">'date'</span>, <span class="string">'item'</span>])[:<span class="number">9</span>]</div><div class="line">unstacked = ldata.set_index([<span class="string">'date'</span>, <span class="string">'item'</span>]).unstack(<span class="string">'item'</span>)</div><div class="line">unstacked[:<span class="number">7</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th></th><th>value</th><th>value2</th></tr><tr><th>date</th><th>item</th><th></th><th></th></tr></thead><tbody><tr><th rowspan="3" valign="top">1959-03-31</th><th>realgdp</th><td>2710.349</td><td>-0.204708</td></tr><tr><th>infl</th><td>0.000</td><td>0.478943</td></tr><tr><th>unemp</th><td>5.800</td><td>-0.519439</td></tr><tr><th rowspan="3" valign="top">1959-06-30</th><th>realgdp</th><td>2778.801</td><td>-0.555730</td></tr><tr><th>infl</th><td>2.340</td><td>1.965781</td></tr><tr><th>unemp</th><td>5.100</td><td>1.393406</td></tr><tr><th rowspan="3" valign="top">1959-09-30</th><th>realgdp</th><td>2775.488</td><td>0.092908</td></tr><tr><th>infl</th><td>2.740</td><td>0.281746</td></tr><tr><th>unemp</th><td>5.300</td><td>0.769023</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr><th></th><th colspan="3" halign="left">value</th><th colspan="3" halign="left">value2</th></tr><tr><th>item</th><th>infl</th><th>realgdp</th><th>unemp</th><th>infl</th><th>realgdp</th><th>unemp</th></tr><tr><th>date</th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>1959-03-31</th><td>0.00</td><td>2710.349</td><td>5.8</td><td>0.478943</td><td>-0.204708</td><td>-0.519439</td></tr><tr><th>1959-06-30</th><td>2.34</td><td>2778.801</td><td>5.1</td><td>1.965781</td><td>-0.555730</td><td>1.393406</td></tr><tr><th>1959-09-30</th><td>2.74</td><td>2775.488</td><td>5.3</td><td>0.281746</td><td>0.092908</td><td>0.769023</td></tr><tr><th>1959-12-31</th><td>0.27</td><td>2785.204</td><td>5.6</td><td>1.007189</td><td>1.246435</td><td>-1.296221</td></tr><tr><th>1960-03-31</th><td>2.31</td><td>2847.699</td><td>5.2</td><td>0.228913</td><td>0.274992</td><td>1.352917</td></tr><tr><th>1960-06-30</th><td>0.14</td><td>2834.390</td><td>5.2</td><td>-2.001637</td><td>0.886429</td><td>-0.371843</td></tr><tr><th>1960-09-30</th><td>2.70</td><td>2839.022</td><td>5.6</td><td>-0.438570</td><td>1.669025</td><td>-0.539741</td></tr></tbody></table></div><h2 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h2><h3 id="移除重复值"><a href="#移除重复值" class="headerlink" title="移除重复值"></a>移除重复值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(&#123;<span class="string">'k1'</span>: [<span class="string">'one'</span>] * <span class="number">3</span> + [<span class="string">'two'</span>] * <span class="number">4</span>,</div><div class="line">                  <span class="string">'k2'</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>]&#125;)</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>k1</th><th>k2</th></tr></thead><tbody><tr><th>0</th><td>one</td><td>1</td></tr><tr><th>1</th><td>one</td><td>1</td></tr><tr><th>2</th><td>one</td><td>2</td></tr><tr><th>3</th><td>two</td><td>3</td></tr><tr><th>4</th><td>two</td><td>3</td></tr><tr><th>5</th><td>two</td><td>4</td></tr><tr><th>6</th><td>two</td><td>4</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.duplicated()</div></pre></td></tr></table></figure><pre><code>0    False
1     True
2    False
3    False
4     True
5    False
6     True
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.drop_duplicates()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>k1</th><th>k2</th></tr></thead><tbody><tr><th>0</th><td>one</td><td>1</td></tr><tr><th>2</th><td>one</td><td>2</td></tr><tr><th>3</th><td>two</td><td>3</td></tr><tr><th>5</th><td>two</td><td>4</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'v1'</span>] = range(<span class="number">7</span>)</div><div class="line">data</div><div class="line">data.drop_duplicates([<span class="string">'k1'</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>k1</th><th>k2</th><th>v1</th></tr></thead><tbody><tr><th>0</th><td>one</td><td>1</td><td>0</td></tr><tr><th>1</th><td>one</td><td>1</td><td>1</td></tr><tr><th>2</th><td>one</td><td>2</td><td>2</td></tr><tr><th>3</th><td>two</td><td>3</td><td>3</td></tr><tr><th>4</th><td>two</td><td>3</td><td>4</td></tr><tr><th>5</th><td>two</td><td>4</td><td>5</td></tr><tr><th>6</th><td>two</td><td>4</td><td>6</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>k1</th><th>k2</th><th>v1</th></tr></thead><tbody><tr><th>0</th><td>one</td><td>1</td><td>0</td></tr><tr><th>3</th><td>two</td><td>3</td><td>3</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data.drop_duplicates([<span class="string">'k1'</span>, <span class="string">'k2'</span>], keep=<span class="string">'last'</span>)</div><div class="line">data.drop_duplicates([<span class="string">'k1'</span>, <span class="string">'k2'</span>], keep=<span class="string">'first'</span>)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>k1</th><th>k2</th><th>v1</th></tr></thead><tbody><tr><th>1</th><td>one</td><td>1</td><td>1</td></tr><tr><th>2</th><td>one</td><td>2</td><td>2</td></tr><tr><th>4</th><td>two</td><td>3</td><td>4</td></tr><tr><th>6</th><td>two</td><td>4</td><td>6</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>k1</th><th>k2</th><th>v1</th></tr></thead><tbody><tr><th>0</th><td>one</td><td>1</td><td>0</td></tr><tr><th>2</th><td>one</td><td>2</td><td>2</td></tr><tr><th>3</th><td>two</td><td>3</td><td>3</td></tr><tr><th>5</th><td>two</td><td>4</td><td>5</td></tr></tbody></table></div><h3 id="利用函数或映射进行数据转换"><a href="#利用函数或映射进行数据转换" class="headerlink" title="利用函数或映射进行数据转换"></a>利用函数或映射进行数据转换</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(&#123;<span class="string">'food'</span>: [<span class="string">'bacon'</span>, <span class="string">'pulled pork'</span>, <span class="string">'bacon'</span>, <span class="string">'Pastrami'</span>,</div><div class="line">                           <span class="string">'corned beef'</span>, <span class="string">'Bacon'</span>, <span class="string">'pastrami'</span>, <span class="string">'honey ham'</span>,</div><div class="line">                           <span class="string">'nova lox'</span>],</div><div class="line">                  <span class="string">'ounces'</span>: [<span class="number">4</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">7.5</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>]&#125;)</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>food</th><th>ounces</th></tr></thead><tbody><tr><th>0</th><td>bacon</td><td>4.0</td></tr><tr><th>1</th><td>pulled pork</td><td>3.0</td></tr><tr><th>2</th><td>bacon</td><td>12.0</td></tr><tr><th>3</th><td>Pastrami</td><td>6.0</td></tr><tr><th>4</th><td>corned beef</td><td>7.5</td></tr><tr><th>5</th><td>Bacon</td><td>8.0</td></tr><tr><th>6</th><td>pastrami</td><td>3.0</td></tr><tr><th>7</th><td>honey ham</td><td>5.0</td></tr><tr><th>8</th><td>nova lox</td><td>6.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">meat_to_animal = &#123;</div><div class="line">  <span class="string">'bacon'</span>: <span class="string">'pig'</span>,</div><div class="line">  <span class="string">'pulled pork'</span>: <span class="string">'pig'</span>,</div><div class="line">  <span class="string">'pastrami'</span>: <span class="string">'cow'</span>,</div><div class="line">  <span class="string">'corned beef'</span>: <span class="string">'cow'</span>,</div><div class="line">  <span class="string">'honey ham'</span>: <span class="string">'pig'</span>,</div><div class="line">  <span class="string">'nova lox'</span>: <span class="string">'salmon'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'animal'</span>] = data[<span class="string">'food'</span>].map(str.lower).map(meat_to_animal)</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>food</th><th>ounces</th><th>animal</th></tr></thead><tbody><tr><th>0</th><td>bacon</td><td>4.0</td><td>pig</td></tr><tr><th>1</th><td>pulled pork</td><td>3.0</td><td>pig</td></tr><tr><th>2</th><td>bacon</td><td>12.0</td><td>pig</td></tr><tr><th>3</th><td>Pastrami</td><td>6.0</td><td>cow</td></tr><tr><th>4</th><td>corned beef</td><td>7.5</td><td>cow</td></tr><tr><th>5</th><td>Bacon</td><td>8.0</td><td>pig</td></tr><tr><th>6</th><td>pastrami</td><td>3.0</td><td>cow</td></tr><tr><th>7</th><td>honey ham</td><td>5.0</td><td>pig</td></tr><tr><th>8</th><td>nova lox</td><td>6.0</td><td>salmon</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'food'</span>].map(<span class="keyword">lambda</span> x: meat_to_animal[x.lower()])</div></pre></td></tr></table></figure><pre><code>0       pig
1       pig
2       pig
3       cow
4       cow
5       pig
6       cow
7       pig
8    salmon
Name: food, dtype: object
</code></pre><h3 id="替换值"><a href="#替换值" class="headerlink" title="替换值"></a>替换值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data = Series([<span class="number">1.</span>, <span class="number">-999.</span>, <span class="number">2.</span>, <span class="number">-999.</span>, <span class="number">-1000.</span>, <span class="number">3.</span>])</div><div class="line">data</div></pre></td></tr></table></figure><pre><code>0       1.0
1    -999.0
2       2.0
3    -999.0
4   -1000.0
5       3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.replace(<span class="number">-999</span>, np.nan)</div></pre></td></tr></table></figure><pre><code>0       1.0
1       NaN
2       2.0
3       NaN
4   -1000.0
5       3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.replace([<span class="number">-999</span>, <span class="number">-1000</span>], np.nan)</div></pre></td></tr></table></figure><pre><code>0    1.0
1    NaN
2    2.0
3    NaN
4    NaN
5    3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.replace([<span class="number">-999</span>, <span class="number">-1000</span>], [np.nan, <span class="number">0</span>])</div></pre></td></tr></table></figure><pre><code>0    1.0
1    NaN
2    2.0
3    NaN
4    0.0
5    3.0
dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.replace(&#123;<span class="number">-999</span>: np.nan, <span class="number">-1000</span>: <span class="number">0</span>&#125;)</div></pre></td></tr></table></figure><pre><code>0    1.0
1    NaN
2    2.0
3    NaN
4    0.0
5    3.0
dtype: float64
</code></pre><h3 id="重命名轴索引"><a href="#重命名轴索引" class="headerlink" title="重命名轴索引"></a>重命名轴索引</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>, <span class="number">4</span>)),</div><div class="line">                 index=[<span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>, <span class="string">'New York'</span>],</div><div class="line">                 columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>])</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>Ohio</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>Colorado</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>New York</th><td>8</td><td>9</td><td>10</td><td>11</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.index.map(str.upper)</div></pre></td></tr></table></figure><pre><code>array([&#39;OHIO&#39;, &#39;COLORADO&#39;, &#39;NEW YORK&#39;], dtype=object)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data.index = data.index.map(str.upper)</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>OHIO</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>COLORADO</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>NEW YORK</th><td>8</td><td>9</td><td>10</td><td>11</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.rename(index=str.title, columns=str.upper)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>ONE</th><th>TWO</th><th>THREE</th><th>FOUR</th></tr></thead><tbody><tr><th>Ohio</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>Colorado</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>New York</th><td>8</td><td>9</td><td>10</td><td>11</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data.rename(index=&#123;<span class="string">'OHIO'</span>: <span class="string">'INDIANA'</span>&#125;,</div><div class="line">            columns=&#123;<span class="string">'three'</span>: <span class="string">'peekaboo'</span>&#125;)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>peekaboo</th><th>four</th></tr></thead><tbody><tr><th>INDIANA</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>COLORADO</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>NEW YORK</th><td>8</td><td>9</td><td>10</td><td>11</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Always returns a reference to a DataFrame</span></div><div class="line">_ = data.rename(index=&#123;<span class="string">'OHIO'</span>: <span class="string">'INDIANA'</span>&#125;, inplace=<span class="keyword">True</span>)</div><div class="line">data</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>one</th><th>two</th><th>three</th><th>four</th></tr></thead><tbody><tr><th>INDIANA</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>COLORADO</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>NEW YORK</th><td>8</td><td>9</td><td>10</td><td>11</td></tr></tbody></table></div><h3 id="离散化和面元划分"><a href="#离散化和面元划分" class="headerlink" title="离散化和面元划分"></a>离散化和面元划分</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ages = [<span class="number">20</span>, <span class="number">22</span>, <span class="number">25</span>, <span class="number">27</span>, <span class="number">21</span>, <span class="number">23</span>, <span class="number">37</span>, <span class="number">31</span>, <span class="number">61</span>, <span class="number">45</span>, <span class="number">41</span>, <span class="number">32</span>]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">bins = [<span class="number">18</span>, <span class="number">25</span>, <span class="number">35</span>, <span class="number">60</span>, <span class="number">100</span>]</div><div class="line">cats = pd.cut(ages, bins)</div><div class="line">cats</div></pre></td></tr></table></figure><pre><code>[(18, 25], (18, 25], (18, 25], (25, 35], (18, 25], ..., (25, 35], (60, 100], (35, 60], (35, 60], (25, 35]]
Length: 12
Categories (4, object): [(18, 25] &lt; (25, 35] &lt; (35, 60] &lt; (60, 100]]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cats.codes</div></pre></td></tr></table></figure><pre><code>array([0, 0, 0, 1, 0, 0, 2, 1, 3, 2, 2, 1], dtype=int8)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cats.categories</div></pre></td></tr></table></figure><pre><code>Index([&#39;(18, 25]&#39;, &#39;(25, 35]&#39;, &#39;(35, 60]&#39;, &#39;(60, 100]&#39;], dtype=&#39;object&#39;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.value_counts(cats)</div></pre></td></tr></table></figure><pre><code>(18, 25]     5
(35, 60]     3
(25, 35]     3
(60, 100]    1
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.cut(ages, [<span class="number">18</span>, <span class="number">26</span>, <span class="number">36</span>, <span class="number">61</span>, <span class="number">100</span>], right=<span class="keyword">False</span>)</div></pre></td></tr></table></figure><pre><code>[[18, 26), [18, 26), [18, 26), [26, 36), [18, 26), ..., [26, 36), [61, 100), [36, 61), [36, 61), [26, 36)]
Length: 12
Categories (4, object): [[18, 26) &lt; [26, 36) &lt; [36, 61) &lt; [61, 100)]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">group_names = [<span class="string">'Youth'</span>, <span class="string">'YoungAdult'</span>, <span class="string">'MiddleAged'</span>, <span class="string">'Senior'</span>]</div><div class="line">pd.cut(ages, bins, labels=group_names)</div></pre></td></tr></table></figure><pre><code>[Youth, Youth, Youth, YoungAdult, Youth, ..., YoungAdult, Senior, MiddleAged, MiddleAged, YoungAdult]
Length: 12
Categories (4, object): [Youth &lt; YoungAdult &lt; MiddleAged &lt; Senior]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data = np.random.rand(<span class="number">20</span>)</div><div class="line">pd.cut(data, <span class="number">4</span>, precision=<span class="number">2</span>)</div></pre></td></tr></table></figure><pre><code>[(0.25, 0.49], (0.25, 0.49], (0.73, 0.98], (0.25, 0.49], (0.25, 0.49], ..., (0.25, 0.49], (0.73, 0.98], (0.49, 0.73], (0.49, 0.73], (0.49, 0.73]]
Length: 20
Categories (4, object): [(0.0032, 0.25] &lt; (0.25, 0.49] &lt; (0.49, 0.73] &lt; (0.73, 0.98]]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data = np.random.randn(<span class="number">1000</span>) <span class="comment"># Normally distributed</span></div><div class="line">cats = pd.qcut(data, <span class="number">4</span>) <span class="comment"># Cut into quartiles</span></div><div class="line">cats</div></pre></td></tr></table></figure><pre><code>[(0.636, 3.26], [-3.745, -0.648], (0.636, 3.26], (-0.022, 0.636], (-0.648, -0.022], ..., (0.636, 3.26], (-0.022, 0.636], [-3.745, -0.648], (-0.022, 0.636], (-0.022, 0.636]]
Length: 1000
Categories (4, object): [[-3.745, -0.648] &lt; (-0.648, -0.022] &lt; (-0.022, 0.636] &lt; (0.636, 3.26]]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.value_counts(cats)</div></pre></td></tr></table></figure><pre><code>(0.636, 3.26]       250
(-0.022, 0.636]     250
(-0.648, -0.022]    250
[-3.745, -0.648]    250
dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.qcut(data, [<span class="number">0</span>, <span class="number">0.1</span>, <span class="number">0.5</span>, <span class="number">0.9</span>, <span class="number">1.</span>])</div></pre></td></tr></table></figure><pre><code>[(-0.022, 1.298], [-3.745, -1.274], (-0.022, 1.298], (-0.022, 1.298], (-1.274, -0.022], ..., (-0.022, 1.298], (-0.022, 1.298], [-3.745, -1.274], (-0.022, 1.298], (-0.022, 1.298]]
Length: 1000
Categories (4, object): [[-3.745, -1.274] &lt; (-1.274, -0.022] &lt; (-0.022, 1.298] &lt; (1.298, 3.26]]
</code></pre><h3 id="检测和过滤异常值"><a href="#检测和过滤异常值" class="headerlink" title="检测和过滤异常值"></a>检测和过滤异常值</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">np.random.seed(<span class="number">12345</span>)</div><div class="line">data = DataFrame(np.random.randn(<span class="number">1000</span>, <span class="number">4</span>))</div><div class="line">data.describe()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><th>count</th><td>1000.000000</td><td>1000.000000</td><td>1000.000000</td><td>1000.000000</td></tr><tr><th>mean</th><td>-0.067684</td><td>0.067924</td><td>0.025598</td><td>-0.002298</td></tr><tr><th>std</th><td>0.998035</td><td>0.992106</td><td>1.006835</td><td>0.996794</td></tr><tr><th>min</th><td>-3.428254</td><td>-3.548824</td><td>-3.184377</td><td>-3.745356</td></tr><tr><th>25%</th><td>-0.774890</td><td>-0.591841</td><td>-0.641675</td><td>-0.644144</td></tr><tr><th>50%</th><td>-0.116401</td><td>0.101143</td><td>0.002073</td><td>-0.013611</td></tr><tr><th>75%</th><td>0.616366</td><td>0.780282</td><td>0.680391</td><td>0.654328</td></tr><tr><th>max</th><td>3.366626</td><td>2.653656</td><td>3.260383</td><td>3.927528</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">col = data[<span class="number">3</span>]</div><div class="line">col[np.abs(col) &gt; <span class="number">3</span>]</div></pre></td></tr></table></figure><pre><code>97     3.927528
305   -3.399312
400   -3.745356
Name: 3, dtype: float64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data[(np.abs(data) &gt; <span class="number">3</span>).any(<span class="number">1</span>)]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><th>5</th><td>-0.539741</td><td>0.476985</td><td>3.248944</td><td>-1.021228</td></tr><tr><th>97</th><td>-0.774363</td><td>0.552936</td><td>0.106061</td><td>3.927528</td></tr><tr><th>102</th><td>-0.655054</td><td>-0.565230</td><td>3.176873</td><td>0.959533</td></tr><tr><th>305</th><td>-2.315555</td><td>0.457246</td><td>-0.025907</td><td>-3.399312</td></tr><tr><th>324</th><td>0.050188</td><td>1.951312</td><td>3.260383</td><td>0.963301</td></tr><tr><th>400</th><td>0.146326</td><td>0.508391</td><td>-0.196713</td><td>-3.745356</td></tr><tr><th>499</th><td>-0.293333</td><td>-0.242459</td><td>-3.056990</td><td>1.918403</td></tr><tr><th>523</th><td>-3.428254</td><td>-0.296336</td><td>-0.439938</td><td>-0.867165</td></tr><tr><th>586</th><td>0.275144</td><td>1.179227</td><td>-3.184377</td><td>1.369891</td></tr><tr><th>808</th><td>-0.362528</td><td>-3.548824</td><td>1.553205</td><td>-2.186301</td></tr><tr><th>900</th><td>3.366626</td><td>-2.372214</td><td>0.851010</td><td>1.332846</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data[np.abs(data) &gt; <span class="number">3</span>] = np.sign(data) * <span class="number">3</span></div><div class="line">data.describe()</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><th>count</th><td>1000.000000</td><td>1000.000000</td><td>1000.000000</td><td>1000.000000</td></tr><tr><th>mean</th><td>-0.067623</td><td>0.068473</td><td>0.025153</td><td>-0.002081</td></tr><tr><th>std</th><td>0.995485</td><td>0.990253</td><td>1.003977</td><td>0.989736</td></tr><tr><th>min</th><td>-3.000000</td><td>-3.000000</td><td>-3.000000</td><td>-3.000000</td></tr><tr><th>25%</th><td>-0.774890</td><td>-0.591841</td><td>-0.641675</td><td>-0.644144</td></tr><tr><th>50%</th><td>-0.116401</td><td>0.101143</td><td>0.002073</td><td>-0.013611</td></tr><tr><th>75%</th><td>0.616366</td><td>0.780282</td><td>0.680391</td><td>0.654328</td></tr><tr><th>max</th><td>3.000000</td><td>2.653656</td><td>3.000000</td><td>3.000000</td></tr></tbody></table></div><h3 id="排列和随机采样"><a href="#排列和随机采样" class="headerlink" title="排列和随机采样"></a>排列和随机采样</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(np.arange(<span class="number">5</span> * <span class="number">4</span>).reshape((<span class="number">5</span>, <span class="number">4</span>)))</div><div class="line">sampler = np.random.permutation(<span class="number">5</span>)</div><div class="line">sampler</div></pre></td></tr></table></figure><pre><code>array([1, 0, 2, 3, 4])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>1</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>2</th><td>8</td><td>9</td><td>10</td><td>11</td></tr><tr><th>3</th><td>12</td><td>13</td><td>14</td><td>15</td></tr><tr><th>4</th><td>16</td><td>17</td><td>18</td><td>19</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.take(sampler)</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><th>1</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>0</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>2</th><td>8</td><td>9</td><td>10</td><td>11</td></tr><tr><th>3</th><td>12</td><td>13</td><td>14</td><td>15</td></tr><tr><th>4</th><td>16</td><td>17</td><td>18</td><td>19</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.take(np.random.permutation(len(df))[:<span class="number">3</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><th>1</th><td>4</td><td>5</td><td>6</td><td>7</td></tr><tr><th>0</th><td>0</td><td>1</td><td>2</td><td>3</td></tr><tr><th>4</th><td>16</td><td>17</td><td>18</td><td>19</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">bag = np.array([<span class="number">5</span>, <span class="number">7</span>, <span class="number">-1</span>, <span class="number">6</span>, <span class="number">4</span>])</div><div class="line">sampler = np.random.randint(<span class="number">0</span>, len(bag), size=<span class="number">10</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sampler</div></pre></td></tr></table></figure><pre><code>array([3, 0, 4, 1, 1, 2, 3, 0, 1, 2])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">draws = bag.take(sampler)</div><div class="line">draws</div></pre></td></tr></table></figure><pre><code>array([ 6,  5,  4,  7,  7, -1,  6,  5,  7, -1])
</code></pre><h3 id="计算指标-哑变量"><a href="#计算指标-哑变量" class="headerlink" title="计算指标 / 哑变量"></a>计算指标 / 哑变量</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(&#123;<span class="string">'key'</span>: [<span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>],</div><div class="line">                <span class="string">'data1'</span>: range(<span class="number">6</span>)&#125;)</div><div class="line">df</div><div class="line">pd.get_dummies(df[<span class="string">'key'</span>])</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>b</td></tr><tr><th>1</th><td>1</td><td>b</td></tr><tr><th>2</th><td>2</td><td>a</td></tr><tr><th>3</th><td>3</td><td>c</td></tr><tr><th>4</th><td>4</td><td>a</td></tr><tr><th>5</th><td>5</td><td>b</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>a</th><th>b</th><th>c</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>1</th><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>2</th><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><th>3</th><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>4</th><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><th>5</th><td>0.0</td><td>1.0</td><td>0.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dummies = pd.get_dummies(df[<span class="string">'key'</span>], prefix=<span class="string">'key'</span>)</div><div class="line">dummies</div><div class="line">df_with_dummy = df[[<span class="string">'data1'</span>]].join(dummies)</div><div class="line">df_with_dummy</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>key_a</th><th>key_b</th><th>key_c</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>1</th><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>2</th><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><th>3</th><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>4</th><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><th>5</th><td>0.0</td><td>1.0</td><td>0.0</td></tr></tbody></table></div><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>data1</th><th>key_a</th><th>key_b</th><th>key_c</th></tr></thead><tbody><tr><th>0</th><td>0</td><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>1</th><td>1</td><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>2</th><td>2</td><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><th>3</th><td>3</td><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>4</th><td>4</td><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><th>5</th><td>5</td><td>0.0</td><td>1.0</td><td>0.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mnames = [<span class="string">'movie_id'</span>, <span class="string">'title'</span>, <span class="string">'genres'</span>]</div><div class="line">movies = pd.read_table(<span class="string">'ch02/movielens/movies.dat'</span>, sep=<span class="string">'::'</span>, header=<span class="keyword">None</span>,</div><div class="line">                        names=mnames)</div><div class="line">movies[:<span class="number">10</span>]</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:3: ParserWarning: Falling back to the &#39;python&#39; engine because the &#39;c&#39; engine does not support regex separators (separators &gt; 1 char and different from &#39;\s+&#39; are interpreted as regex); you can avoid this warning by specifying engine=&#39;python&#39;.
  app.launch_new_instance()
</code></pre><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>movie_id</th><th>title</th><th>genres</th></tr></thead><tbody><tr><th>0</th><td>1</td><td>Toy Story (1995)</td><td>Animation|Children's|Comedy</td></tr><tr><th>1</th><td>2</td><td>Jumanji (1995)</td><td>Adventure|Children's|Fantasy</td></tr><tr><th>2</th><td>3</td><td>Grumpier Old Men (1995)</td><td>Comedy|Romance</td></tr><tr><th>3</th><td>4</td><td>Waiting to Exhale (1995)</td><td>Comedy|Drama</td></tr><tr><th>4</th><td>5</td><td>Father of the Bride Part II (1995)</td><td>Comedy</td></tr><tr><th>5</th><td>6</td><td>Heat (1995)</td><td>Action|Crime|Thriller</td></tr><tr><th>6</th><td>7</td><td>Sabrina (1995)</td><td>Comedy|Romance</td></tr><tr><th>7</th><td>8</td><td>Tom and Huck (1995)</td><td>Adventure|Children's</td></tr><tr><th>8</th><td>9</td><td>Sudden Death (1995)</td><td>Action</td></tr><tr><th>9</th><td>10</td><td>GoldenEye (1995)</td><td>Action|Adventure|Thriller</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">genre_iter = (set(x.split(<span class="string">'|'</span>)) <span class="keyword">for</span> x <span class="keyword">in</span> movies.genres)</div><div class="line">genres = sorted(set.union(*genre_iter))</div><div class="line">genres</div></pre></td></tr></table></figure><pre><code>[&#39;Action&#39;,
 &#39;Adventure&#39;,
 &#39;Animation&#39;,
 &quot;Children&#39;s&quot;,
 &#39;Comedy&#39;,
 &#39;Crime&#39;,
 &#39;Documentary&#39;,
 &#39;Drama&#39;,
 &#39;Fantasy&#39;,
 &#39;Film-Noir&#39;,
 &#39;Horror&#39;,
 &#39;Musical&#39;,
 &#39;Mystery&#39;,
 &#39;Romance&#39;,
 &#39;Sci-Fi&#39;,
 &#39;Thriller&#39;,
 &#39;War&#39;,
 &#39;Western&#39;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dummies = DataFrame(np.zeros((len(movies), len(genres))), columns=genres)</div><div class="line">dummies[:<span class="number">10</span>].ix[:, :<span class="number">5</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Action</th><th>Adventure</th><th>Animation</th><th>Children's</th><th>Comedy</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>1</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>2</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>3</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>4</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>5</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>6</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>7</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>8</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>9</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i, gen <span class="keyword">in</span> enumerate(movies.genres):</div><div class="line">    dummies.ix[i, gen.split(<span class="string">'|'</span>)] = <span class="number">1</span></div><div class="line">dummies[:<span class="number">10</span>].ix[:, :<span class="number">5</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>Action</th><th>Adventure</th><th>Animation</th><th>Children's</th><th>Comedy</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>0.0</td><td>1.0</td><td>1.0</td><td>1.0</td></tr><tr><th>1</th><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>2</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>3</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>4</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>5</th><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>6</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>7</th><td>0.0</td><td>1.0</td><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>8</th><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>9</th><td>1.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">movies_windic = movies.join(dummies.add_prefix(<span class="string">'Genre_'</span>))</div><div class="line">movies_windic.ix[<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>movie_id                                       1
title                           Toy Story (1995)
genres               Animation|Children&#39;s|Comedy
Genre_Action                                   0
Genre_Adventure                                0
Genre_Animation                                1
Genre_Children&#39;s                               1
Genre_Comedy                                   1
Genre_Crime                                    0
Genre_Documentary                              0
Genre_Drama                                    0
Genre_Fantasy                                  0
Genre_Film-Noir                                0
Genre_Horror                                   0
Genre_Musical                                  0
Genre_Mystery                                  0
Genre_Romance                                  0
Genre_Sci-Fi                                   0
Genre_Thriller                                 0
Genre_War                                      0
Genre_Western                                  0
Name: 0, dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">np.random.seed(<span class="number">12345</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">values = np.random.rand(<span class="number">10</span>)</div><div class="line">values</div></pre></td></tr></table></figure><pre><code>array([ 0.9296,  0.3164,  0.1839,  0.2046,  0.5677,  0.5955,  0.9645,
        0.6532,  0.7489,  0.6536])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">bins = [<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">0.4</span>, <span class="number">0.6</span>, <span class="number">0.8</span>, <span class="number">1</span>]</div><div class="line">pd.get_dummies(pd.cut(values, bins))</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>(0, 0.2]</th><th>(0.2, 0.4]</th><th>(0.4, 0.6]</th><th>(0.6, 0.8]</th><th>(0.8, 1]</th></tr></thead><tbody><tr><th>0</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>1</th><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>2</th><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>3</th><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>4</th><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><th>5</th><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td><td>0.0</td></tr><tr><th>6</th><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td></tr><tr><th>7</th><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>8</th><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td></tr><tr><th>9</th><td>0.0</td><td>0.0</td><td>0.0</td><td>1.0</td><td>0.0</td></tr></tbody></table></div><h2 id="字符串操作"><a href="#字符串操作" class="headerlink" title="字符串操作"></a>字符串操作</h2><h3 id="字符串对象方法"><a href="#字符串对象方法" class="headerlink" title="字符串对象方法"></a>字符串对象方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">val = <span class="string">'a,b,  guido'</span></div><div class="line">val.split(<span class="string">','</span>)</div></pre></td></tr></table></figure><pre><code>[&#39;a&#39;, &#39;b&#39;, &#39;  guido&#39;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pieces = [x.strip() <span class="keyword">for</span> x <span class="keyword">in</span> val.split(<span class="string">','</span>)]</div><div class="line">pieces</div></pre></td></tr></table></figure><pre><code>[&#39;a&#39;, &#39;b&#39;, &#39;guido&#39;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">first, second, third = pieces</div><div class="line">first + <span class="string">'::'</span> + second + <span class="string">'::'</span> + third</div></pre></td></tr></table></figure><pre><code>&#39;a::b::guido&#39;
</code></pre><p>Surprise :P</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">'::'</span>.join(pieces)</div></pre></td></tr></table></figure><pre><code>&#39;a::b::guido&#39;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">'guido'</span> <span class="keyword">in</span> val</div></pre></td></tr></table></figure><pre><code>True
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">val.index(<span class="string">','</span>)</div></pre></td></tr></table></figure><pre><code>1
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">val.find(<span class="string">':'</span>)</div></pre></td></tr></table></figure><pre><code>-1
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">val.index(<span class="string">':'</span>)</div></pre></td></tr></table></figure><pre><code>---------------------------------------------------------------------------

ValueError                                Traceback (most recent call last)

&lt;ipython-input-110-280f8b2856ce&gt; in &lt;module&gt;()
----&gt; 1 val.index(&#39;:&#39;)


ValueError: substring not found
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">val.count(<span class="string">','</span>)</div></pre></td></tr></table></figure><pre><code>2
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">val.replace(<span class="string">','</span>, <span class="string">'::'</span>)</div></pre></td></tr></table></figure><pre><code>&#39;a::b::  guido&#39;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">val.replace(<span class="string">','</span>, <span class="string">''</span>)</div></pre></td></tr></table></figure><pre><code>&#39;ab  guido&#39;
</code></pre><h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> re</div><div class="line">text = <span class="string">"foo    bar\t baz  \tqux"</span></div><div class="line">re.split(<span class="string">'\s+'</span>, text)</div></pre></td></tr></table></figure><pre><code>[&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;, &#39;qux&#39;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">regex = re.compile(<span class="string">'\s+'</span>)</div><div class="line">regex.split(text)</div></pre></td></tr></table></figure><pre><code>[&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;, &#39;qux&#39;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">regex.findall(text)</div></pre></td></tr></table></figure><pre><code>[&#39;    &#39;, &#39;\t &#39;, &#39;  \t&#39;]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">text = <span class="string">"""Dave dave@google.com</span></div><div class="line">Steve steve@gmail.com</div><div class="line">Rob rob@gmail.com</div><div class="line">Ryan ryan@yahoo.com</div><div class="line">"""</div><div class="line">pattern = <span class="string">r'[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]&#123;2,4&#125;'</span></div><div class="line"></div><div class="line"><span class="comment"># re.IGNORECASE makes the regex case-insensitive</span></div><div class="line">regex = re.compile(pattern, flags=re.IGNORECASE)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">regex.findall(text)</div></pre></td></tr></table></figure><pre><code>[&#39;dave@google.com&#39;, &#39;steve@gmail.com&#39;, &#39;rob@gmail.com&#39;, &#39;ryan@yahoo.com&#39;]
</code></pre><p>Search只返回第一项</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">m = regex.search(text)</div><div class="line">m</div></pre></td></tr></table></figure><pre><code>&lt;_sre.SRE_Match object; span=(5, 20), match=&#39;dave@google.com&#39;&gt;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">text[m.start():m.end()]</div></pre></td></tr></table></figure><pre><code>&#39;dave@google.com&#39;
</code></pre><p>只匹配出现在字符串开头的模式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">print(regex.match(text))</div></pre></td></tr></table></figure><pre><code>None
</code></pre><p>​</p><p>替换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">print(regex.sub(<span class="string">'REDACTED'</span>, text))</div></pre></td></tr></table></figure><pre><code>Dave REDACTED
Steve REDACTED
Rob REDACTED
Ryan REDACTED
</code></pre><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pattern = <span class="string">r'([A-Z0-9._%+-]+)@([A-Z0-9.-]+)\.([A-Z]&#123;2,4&#125;)'</span></div><div class="line">regex = re.compile(pattern, flags=re.IGNORECASE)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">m = regex.match(<span class="string">'wesm@bright.net'</span>)</div><div class="line">m.groups()</div></pre></td></tr></table></figure><pre><code>(&#39;wesm&#39;, &#39;bright&#39;, &#39;net&#39;)
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">regex.findall(text)</div></pre></td></tr></table></figure><pre><code>[(&#39;dave&#39;, &#39;google&#39;, &#39;com&#39;),
 (&#39;steve&#39;, &#39;gmail&#39;, &#39;com&#39;),
 (&#39;rob&#39;, &#39;gmail&#39;, &#39;com&#39;),
 (&#39;ryan&#39;, &#39;yahoo&#39;, &#39;com&#39;)]
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">print(regex.sub(<span class="string">r'Username: \1, Domain: \2, Suffix: \3'</span>, text))</div></pre></td></tr></table></figure><pre><code>Dave Username: dave, Domain: google, Suffix: com
Steve Username: steve, Domain: gmail, Suffix: com
Rob Username: rob, Domain: gmail, Suffix: com
Ryan Username: ryan, Domain: yahoo, Suffix: com
</code></pre><p>​</p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">regex = re.compile(<span class="string">r"""</span></div><div class="line">    (?P&lt;username&gt;[A-Z0-9._%+-]+)</div><div class="line">    @</div><div class="line">    (?P&lt;domain&gt;[A-Z0-9.-]+)</div><div class="line">    \.</div><div class="line">    (?P&lt;suffix&gt;[A-Z]&#123;2,4&#125;)""", flags=re.IGNORECASE|re.VERBOSE)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">m = regex.match(<span class="string">'wesm@bright.net'</span>)</div><div class="line">m.groupdict()</div></pre></td></tr></table></figure><pre><code>{&#39;domain&#39;: &#39;bright&#39;, &#39;suffix&#39;: &#39;net&#39;, &#39;username&#39;: &#39;wesm&#39;}
</code></pre><h3 id="pandas中矢量化的字符串函数"><a href="#pandas中矢量化的字符串函数" class="headerlink" title="pandas中矢量化的字符串函数"></a>pandas中矢量化的字符串函数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data = &#123;<span class="string">'Dave'</span>: <span class="string">'dave@google.com'</span>, <span class="string">'Steve'</span>: <span class="string">'steve@gmail.com'</span>,</div><div class="line">        <span class="string">'Rob'</span>: <span class="string">'rob@gmail.com'</span>, <span class="string">'Wes'</span>: np.nan&#125;</div><div class="line">data = Series(data)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data</div></pre></td></tr></table></figure><pre><code>Dave     dave@google.com
Rob        rob@gmail.com
Steve    steve@gmail.com
Wes                  NaN
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.isnull()</div></pre></td></tr></table></figure><pre><code>Dave     False
Rob      False
Steve    False
Wes       True
dtype: bool
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.str.contains(<span class="string">'gmail'</span>)</div></pre></td></tr></table></figure><pre><code>Dave     False
Rob       True
Steve     True
Wes        NaN
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pattern</div></pre></td></tr></table></figure><pre><code>&#39;([A-Z0-9._%+-]+)@([A-Z0-9.-]+)\\.([A-Z]{2,4})&#39;
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.str.findall(pattern, flags=re.IGNORECASE)</div></pre></td></tr></table></figure><pre><code>Dave     [(dave, google, com)]
Rob        [(rob, gmail, com)]
Steve    [(steve, gmail, com)]
Wes                        NaN
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">matches = data.str.match(pattern, flags=re.IGNORECASE)</div><div class="line">matches</div></pre></td></tr></table></figure><pre><code>C:\Users\Ewan\Anaconda3\lib\site-packages\ipykernel\__main__.py:1: FutureWarning: In future versions of pandas, match will change to always return a bool indexer.
  if __name__ == &#39;__main__&#39;:





Dave     (dave, google, com)
Rob        (rob, gmail, com)
Steve    (steve, gmail, com)
Wes                      NaN
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">matches.str.get(<span class="number">1</span>)</div></pre></td></tr></table></figure><pre><code>Dave     google
Rob       gmail
Steve     gmail
Wes         NaN
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">matches.str[<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>Dave      dave
Rob        rob
Steve    steve
Wes        NaN
dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.str[:<span class="number">5</span>]</div></pre></td></tr></table></figure><pre><code>Dave     dave@
Rob      rob@g
Steve    steve
Wes        NaN
dtype: object
</code></pre><h2 id="Example-USDA-Food-Database"><a href="#Example-USDA-Food-Database" class="headerlink" title="Example: USDA Food Database"></a>Example: USDA Food Database</h2><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  "id": 21441,</div><div class="line">  "description": "KENTUCKY FRIED CHICKEN, Fried Chicken, EXTRA CRISPY,</div><div class="line">Wing, meat and skin with breading",</div><div class="line">  "tags": ["KFC"],</div><div class="line">  "manufacturer": "Kentucky Fried Chicken",</div><div class="line">  "group": "Fast Foods",</div><div class="line">  "portions": [</div><div class="line">    &#123;</div><div class="line">      "amount": 1,</div><div class="line">      "unit": "wing, with skin",</div><div class="line">      "grams": 68.0</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    ...</div><div class="line">  ],</div><div class="line">  "nutrients": [</div><div class="line">    &#123;</div><div class="line">      "value": 20.8,</div><div class="line">      "units": "g",</div><div class="line">      "description": "Protein",</div><div class="line">      "group": "Composition"</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    ...</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> json</div><div class="line">db = json.load(open(<span class="string">'ch07/foods-2011-10-03.json'</span>))</div><div class="line">len(db)</div></pre></td></tr></table></figure><pre><code>6636
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db[<span class="number">0</span>].keys()</div></pre></td></tr></table></figure><pre><code>dict_keys([&#39;id&#39;, &#39;tags&#39;, &#39;portions&#39;, &#39;nutrients&#39;, &#39;description&#39;, &#39;group&#39;, &#39;manufacturer&#39;])
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db[<span class="number">0</span>][<span class="string">'nutrients'</span>][<span class="number">0</span>]</div></pre></td></tr></table></figure><pre><code>{&#39;description&#39;: &#39;Protein&#39;,
 &#39;group&#39;: &#39;Composition&#39;,
 &#39;units&#39;: &#39;g&#39;,
 &#39;value&#39;: 25.18}
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">nutrients = DataFrame(db[<span class="number">0</span>][<span class="string">'nutrients'</span>])</div><div class="line">nutrients[:<span class="number">7</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>description</th><th>group</th><th>units</th><th>value</th></tr></thead><tbody><tr><th>0</th><td>Protein</td><td>Composition</td><td>g</td><td>25.18</td></tr><tr><th>1</th><td>Total lipid (fat)</td><td>Composition</td><td>g</td><td>29.20</td></tr><tr><th>2</th><td>Carbohydrate, by difference</td><td>Composition</td><td>g</td><td>3.06</td></tr><tr><th>3</th><td>Ash</td><td>Other</td><td>g</td><td>3.28</td></tr><tr><th>4</th><td>Energy</td><td>Energy</td><td>kcal</td><td>376.00</td></tr><tr><th>5</th><td>Water</td><td>Composition</td><td>g</td><td>39.28</td></tr><tr><th>6</th><td>Energy</td><td>Energy</td><td>kJ</td><td>1573.00</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">info_keys = [<span class="string">'description'</span>, <span class="string">'group'</span>, <span class="string">'id'</span>, <span class="string">'manufacturer'</span>]</div><div class="line">info = DataFrame(db, columns=info_keys)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">info[:<span class="number">5</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>description</th><th>group</th><th>id</th><th>manufacturer</th></tr></thead><tbody><tr><th>0</th><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td>1008</td><td></td></tr><tr><th>1</th><td>Cheese, cheddar</td><td>Dairy and Egg Products</td><td>1009</td><td></td></tr><tr><th>2</th><td>Cheese, edam</td><td>Dairy and Egg Products</td><td>1018</td><td></td></tr><tr><th>3</th><td>Cheese, feta</td><td>Dairy and Egg Products</td><td>1019</td><td></td></tr><tr><th>4</th><td>Cheese, mozzarella, part skim milk</td><td>Dairy and Egg Products</td><td>1028</td><td></td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.value_counts(info.group)[:<span class="number">10</span>]</div></pre></td></tr></table></figure><pre><code>Vegetables and Vegetable Products    812
Beef Products                        618
Baked Products                       496
Breakfast Cereals                    403
Legumes and Legume Products          365
Fast Foods                           365
Lamb, Veal, and Game Products        345
Sweets                               341
Pork Products                        328
Fruits and Fruit Juices              328
Name: group, dtype: int64
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">nutrients = []</div><div class="line"></div><div class="line"><span class="keyword">for</span> rec <span class="keyword">in</span> db:</div><div class="line">    fnuts = DataFrame(rec[<span class="string">'nutrients'</span>])</div><div class="line">    fnuts[<span class="string">'id'</span>] = rec[<span class="string">'id'</span>]</div><div class="line">    nutrients.append(fnuts)</div><div class="line"></div><div class="line">nutrients = pd.concat(nutrients, ignore_index=<span class="keyword">True</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nutrients[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>description</th><th>group</th><th>units</th><th>value</th><th>id</th></tr></thead><tbody><tr><th>0</th><td>Protein</td><td>Composition</td><td>g</td><td>25.18</td><td>1008</td></tr><tr><th>1</th><td>Total lipid (fat)</td><td>Composition</td><td>g</td><td>29.20</td><td>1008</td></tr><tr><th>2</th><td>Carbohydrate, by difference</td><td>Composition</td><td>g</td><td>3.06</td><td>1008</td></tr><tr><th>3</th><td>Ash</td><td>Other</td><td>g</td><td>3.28</td><td>1008</td></tr><tr><th>4</th><td>Energy</td><td>Energy</td><td>kcal</td><td>376.00</td><td>1008</td></tr><tr><th>5</th><td>Water</td><td>Composition</td><td>g</td><td>39.28</td><td>1008</td></tr><tr><th>6</th><td>Energy</td><td>Energy</td><td>kJ</td><td>1573.00</td><td>1008</td></tr><tr><th>7</th><td>Fiber, total dietary</td><td>Composition</td><td>g</td><td>0.00</td><td>1008</td></tr><tr><th>8</th><td>Calcium, Ca</td><td>Elements</td><td>mg</td><td>673.00</td><td>1008</td></tr><tr><th>9</th><td>Iron, Fe</td><td>Elements</td><td>mg</td><td>0.64</td><td>1008</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nutrients.duplicated().sum()</div></pre></td></tr></table></figure><pre><code>14179
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nutrients = nutrients.drop_duplicates()</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">col_mapping = &#123;<span class="string">'description'</span> : <span class="string">'food'</span>,</div><div class="line">               <span class="string">'group'</span>       : <span class="string">'fgroup'</span>&#125;</div><div class="line">info = info.rename(columns=col_mapping, copy=<span class="keyword">False</span>)</div><div class="line">info[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>food</th><th>fgroup</th><th>id</th><th>manufacturer</th></tr></thead><tbody><tr><th>0</th><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td>1008</td><td></td></tr><tr><th>1</th><td>Cheese, cheddar</td><td>Dairy and Egg Products</td><td>1009</td><td></td></tr><tr><th>2</th><td>Cheese, edam</td><td>Dairy and Egg Products</td><td>1018</td><td></td></tr><tr><th>3</th><td>Cheese, feta</td><td>Dairy and Egg Products</td><td>1019</td><td></td></tr><tr><th>4</th><td>Cheese, mozzarella, part skim milk</td><td>Dairy and Egg Products</td><td>1028</td><td></td></tr><tr><th>5</th><td>Cheese, mozzarella, part skim milk, low moisture</td><td>Dairy and Egg Products</td><td>1029</td><td></td></tr><tr><th>6</th><td>Cheese, romano</td><td>Dairy and Egg Products</td><td>1038</td><td></td></tr><tr><th>7</th><td>Cheese, roquefort</td><td>Dairy and Egg Products</td><td>1039</td><td></td></tr><tr><th>8</th><td>Cheese spread, pasteurized process, american, ...</td><td>Dairy and Egg Products</td><td>1048</td><td></td></tr><tr><th>9</th><td>Cream, fluid, half and half</td><td>Dairy and Egg Products</td><td>1049</td><td></td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">col_mapping = &#123;<span class="string">'description'</span> : <span class="string">'nutrient'</span>,</div><div class="line">               <span class="string">'group'</span> : <span class="string">'nutgroup'</span>&#125;</div><div class="line">nutrients = nutrients.rename(columns=col_mapping, copy=<span class="keyword">False</span>)</div><div class="line">nutrients[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>nutrient</th><th>nutgroup</th><th>units</th><th>value</th><th>id</th></tr></thead><tbody><tr><th>0</th><td>Protein</td><td>Composition</td><td>g</td><td>25.18</td><td>1008</td></tr><tr><th>1</th><td>Total lipid (fat)</td><td>Composition</td><td>g</td><td>29.20</td><td>1008</td></tr><tr><th>2</th><td>Carbohydrate, by difference</td><td>Composition</td><td>g</td><td>3.06</td><td>1008</td></tr><tr><th>3</th><td>Ash</td><td>Other</td><td>g</td><td>3.28</td><td>1008</td></tr><tr><th>4</th><td>Energy</td><td>Energy</td><td>kcal</td><td>376.00</td><td>1008</td></tr><tr><th>5</th><td>Water</td><td>Composition</td><td>g</td><td>39.28</td><td>1008</td></tr><tr><th>6</th><td>Energy</td><td>Energy</td><td>kJ</td><td>1573.00</td><td>1008</td></tr><tr><th>7</th><td>Fiber, total dietary</td><td>Composition</td><td>g</td><td>0.00</td><td>1008</td></tr><tr><th>8</th><td>Calcium, Ca</td><td>Elements</td><td>mg</td><td>673.00</td><td>1008</td></tr><tr><th>9</th><td>Iron, Fe</td><td>Elements</td><td>mg</td><td>0.64</td><td>1008</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ndata = pd.merge(nutrients, info, on=<span class="string">'id'</span>, how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ndata[:<span class="number">10</span>]</div></pre></td></tr></table></figure><div><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>nutrient</th><th>nutgroup</th><th>units</th><th>value</th><th>id</th><th>food</th><th>fgroup</th><th>manufacturer</th></tr></thead><tbody><tr><th>0</th><td>Protein</td><td>Composition</td><td>g</td><td>25.18</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>1</th><td>Total lipid (fat)</td><td>Composition</td><td>g</td><td>29.20</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>2</th><td>Carbohydrate, by difference</td><td>Composition</td><td>g</td><td>3.06</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>3</th><td>Ash</td><td>Other</td><td>g</td><td>3.28</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>4</th><td>Energy</td><td>Energy</td><td>kcal</td><td>376.00</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>5</th><td>Water</td><td>Composition</td><td>g</td><td>39.28</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>6</th><td>Energy</td><td>Energy</td><td>kJ</td><td>1573.00</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>7</th><td>Fiber, total dietary</td><td>Composition</td><td>g</td><td>0.00</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>8</th><td>Calcium, Ca</td><td>Elements</td><td>mg</td><td>673.00</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr><tr><th>9</th><td>Iron, Fe</td><td>Elements</td><td>mg</td><td>0.64</td><td>1008</td><td>Cheese, caraway</td><td>Dairy and Egg Products</td><td></td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ndata.ix[<span class="number">30000</span>]</div></pre></td></tr></table></figure><pre><code>nutrient                                       Glycine
nutgroup                                   Amino Acids
units                                                g
value                                             0.04
id                                                6158
food            Soup, tomato bisque, canned, condensed
fgroup                      Soups, Sauces, and Gravies
manufacturer                                          
Name: 30000, dtype: object
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">result = ndata.groupby([<span class="string">'nutrient'</span>, <span class="string">'fgroup'</span>])[<span class="string">'value'</span>].quantile(<span class="number">0.5</span>)</div><div class="line">result[:<span class="number">10</span>]</div><div class="line">result[<span class="string">'Zinc, Zn'</span>].sort_values().plot(kind=<span class="string">'barh'</span>)</div></pre></td></tr></table></figure><pre><code>nutrient          fgroup                           
Adjusted Protein  Sweets                               12.900
                  Vegetables and Vegetable Products     2.180
Alanine           Baby Foods                            0.085
                  Baked Products                        0.248
                  Beef Products                         1.550
                  Beverages                             0.003
                  Breakfast Cereals                     0.311
                  Cereal Grains and Pasta               0.373
                  Dairy and Egg Products                0.271
                  Ethnic Foods                          1.290
Name: value, dtype: float64






&lt;matplotlib.axes._subplots.AxesSubplot at 0x1ba08c9e780&gt;
</code></pre><p><img src="http://o7ie0tcjk.bkt.clouddn.com/pydata-analysis/ch07/result.png" alt="result"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">by_nutrient = ndata.groupby([<span class="string">'nutgroup'</span>, <span class="string">'nutrient'</span>])</div><div class="line"></div><div class="line">get_maximum = <span class="keyword">lambda</span> x: x.xs(x.value.idxmax())</div><div class="line">get_minimum = <span class="keyword">lambda</span> x: x.xs(x.value.idxmin())</div><div class="line"></div><div class="line">max_foods = by_nutrient.apply(get_maximum)[[<span class="string">'value'</span>, <span class="string">'food'</span>]]</div><div class="line"></div><div class="line"><span class="comment"># make the food a little smaller</span></div><div class="line">max_foods.food = max_foods.food.str[:<span class="number">50</span>]</div></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">max_foods.ix[<span class="string">'Amino Acids'</span>][<span class="string">'food'</span>]</div></pre></td></tr></table></figure><pre><code>nutrient
Alanine                           Gelatins, dry powder, unsweetened
Arginine                               Seeds, sesame flour, low-fat
Aspartic acid                                   Soy protein isolate
Cystine                Seeds, cottonseed flour, low fat (glandless)
Glutamic acid                                   Soy protein isolate
Glycine                           Gelatins, dry powder, unsweetened
Histidine                Whale, beluga, meat, dried (Alaska Native)
Hydroxyproline    KENTUCKY FRIED CHICKEN, Fried Chicken, ORIGINA...
Isoleucine        Soy protein isolate, PROTEIN TECHNOLOGIES INTE...
Leucine           Soy protein isolate, PROTEIN TECHNOLOGIES INTE...
Lysine            Seal, bearded (Oogruk), meat, dried (Alaska Na...
Methionine                    Fish, cod, Atlantic, dried and salted
Phenylalanine     Soy protein isolate, PROTEIN TECHNOLOGIES INTE...
Proline                           Gelatins, dry powder, unsweetened
Serine            Soy protein isolate, PROTEIN TECHNOLOGIES INTE...
Threonine         Soy protein isolate, PROTEIN TECHNOLOGIES INTE...
Tryptophan         Sea lion, Steller, meat with fat (Alaska Native)
Tyrosine          Soy protein isolate, PROTEIN TECHNOLOGIES INTE...
Valine            Soy protein isolate, PROTEIN TECHNOLOGIES INTE...
Name: food, dtype: object
</code></pre></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></section><nav class="pagination"><a class="extend prev" rel="prev" href="/page/24/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><span class="page-number current">25</span><a class="page-number" href="/page/26/">26</a><span class="space">&hellip;</span><a class="page-number" href="/page/39/">39</a><a class="extend next" rel="next" href="/page/26/"><i class="fa fa-angle-right"></i></a></nav></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview sidebar-panel sidebar-panel-active"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Ewan Li"><p class="site-author-name" itemprop="name">Ewan Li</p><p class="site-description motion-element" itemprop="description">Ewan's IT Blog</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">39</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-tags"><a href="/tags"><span class="site-state-item-count">26</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/ewanlee" target="_blank" title="Github"><i class="fa fa-fw fa-globe"></i> Github </a></span><span class="links-of-author-item"><a href="http://weibo.com/3946248928/profile?topnav=1&wvr=6" target="_blank" title="Weibo"><i class="fa fa-fw fa-weibo"></i> Weibo</a></span></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2017</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Ewan Li</span></div><div class="powered-by">Powered by <a class="theme-link" href="https://hexo.io">Hexo</a></div><div class="theme-info">Theme - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div><div class="busuanzi-count"><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="site-uv"><i class="fa fa-user">本站访客数</i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span>人次</span> <span class="site-pv"><i class="fa fa-eye">本站总访问量</i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span>次</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script><script type="text/javascript">var duoshuoQuery={short_name:"ewanlee"};!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.id="duoshuo-script",t.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()</script><script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script><script src="/js/src/hook-duoshuo.js"></script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path,searchFunc=function(e,t,a){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var r=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),c=document.getElementById(t),n=document.getElementById(a);c.addEventListener("input",function(){var e=0,t='<ul class="search-result-list">',a=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length>1&&r.forEach(function(r){var c=!1,n=r.title.trim().toLowerCase(),s=r.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),o=decodeURIComponent(r.url),i=-1,l=-1,p=-1;if(""!=n&&a.forEach(function(e,t){i=n.indexOf(e),l=s.indexOf(e),(i>=0||l>=0)&&(c=!0,0==t&&(p=l))}),c){e+=1,t+="<li><a href='"+o+"' class='search-result-title'>"+n+"</a>";var h=r.content.trim().replace(/<[^>]+>/g,"");if(p>=0){var u=p-20,d=p+80;u<0&&(u=0),0==u&&(d=50),d>h.length&&(d=h.length);var f=h.substring(u,d);a.forEach(function(e){var t=new RegExp(e,"gi");f=f.replace(t,'<b class="search-keyword">'+e+"</b>")}),t+='<p class="search-result">'+f+"...</p>"}t+="</li>"}}),t+="</ul>",0==e&&(t='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==a&&(t='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),n.innerHTML=t}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("e27VKX5tTklQLCtF7iNMmhcA-gzGzoHsz","nnQn2znNgXXEdK7W2bVJ3bfK")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var r=e[i],s=r.get("url"),l=r.get("time"),c=document.getElementById(s);$(c).find(t).text(l)}for(var i=0;i<n.length;i++){var s=n[i],c=document.getElementById(s),u=$(c).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script></body></html>